
**
Description:

The Python micro framework for building web applications.

**
Topics:

flask hacktoberfest jinja pallets python web-framework werkzeug wsgi

**
Titles:

route function quit unexpectedly
mod_wsgi (Apache) Troubleshooting tips needs one more
Add before_first_request_context signal.
Add support for default environ in test_client
try_trigger_before_first_request_functions in test cases
packaging docs outdated
uWSGI / nginx documentation is incorrect
fix docstring for _find_errorhandler
fix doc string
fixed import of werkzeug secure_filename
Flask Documentation PDF is missing
after_request excuted twice
config.from_pyfile() avoid UnicodeDecodeError
Clarify what app.config.from_object accepts
Add X-Forwarded-Proto header to proxy setup example docs
Add pip install --editable . to contributing docs
test_client fails for url with "%2F"
Replace 'I' with 'We'
Move object_hook outside loads method so class can be extend and reused
Call out that teardown functions must never raise
importlib deprecated in 3.4
imp module deprecated. 
Mention that custom converters can be defined for url routes
typo in Quickstart documentation
Built in routes command
get_json raise on empty request body
url_for with multiple query parameters escape '&'
json_encoder not invoked from flask.jsonify
small inaccuracy in get_json documentation
Fix pep8 with logging
Change first argument in a Class methoc to 'self'
Show custom flask cli commands for "no arg" help
Make TaggedJSONSerializer extensible
Flask won't start in the Python 3.4 debugger
Readme cleanup
htmlsafe_dumps doesn't handle lazy strings
Explicit show the content-type of response
Should we cache errorhandlers or not?
stylechecking
Some cleanup for errorhandling refactor
request.json and a lot of other attributes don't use autodoc
Added docs for the error handler rework
errorhandler priority and chaining
Bug in send_file with temp files
Blueprint is ignored
the master version of flask has not module.py, but 0.10.1 has it 
Are there any interest in displaying current_user when logging exceptions?
5 years, still not 1.0! what are you thinking about, pocoo?
Allow custom jinja environments
`request.json` deprecation discussion
Flask reloader adds stdout buffering when used with supervisord
Revert "Fix a few spelling mistakes in the docs"
Fix a few spelling mistakes in the docs
OperationalError: no such table: entries
JSON support for test client and response object
The server stops serving webpages after being deployed for more than a day
Added OpenShift as a free hosting provider alternative
Added note that @errorhandler(500) isn't triggered in debug mode
url_for to another application during request?
Knowing if the App started
Error: entries table doesn't exist
Creating a "collective"
JSON support for the Flask test client
Revert "Revert "Don't use threads in this test""
Generic error handler for any exception
Test_import_migration.py updated
Replaced flask.ext with flask and flask.ext. with flask_
fix bad autodoc signature when functions are decorated
Add support for toplevel arrays
Fix Possible Typo
Add support for toplevel arrays
Propose this file
Oops, didn't mean to post this.
flask.Request should have an is_static field for content served from the static folder
Flask mailing list not accepting my messages
Support for mixins on MethodViews
url_for within different Flask instances
Ignore handled exception when popping the context
AppContext.pop() should use a different sentinel for the exception value.
How to include pages dynamically in flask
before_render_template signal
Always run memory tests
Flask doesn't support resume download to client (no HTTP byte-range support) in 'static' folder
Cannot install Flask on Ubuntu Server 14.10
form.hidden_tag() not XHTML 1.1-compliant
log
request.files is empty after POSTing a file
Fix errorhandler HTTPException normalization
Flask Request Signal - Workflow
Add note to not use plain text passwords to views.rst
Add line of code required to run examples for Other Testing Tricks section
Flask-Mega Tutorial error
link to sqlalchemy declarative has changed
CPU usage increase when debug=True running by virtualenv
Update quickstart.rst doc for awareness of Flask extensions
documentation PDF link is dead
flaskr tutorial doesn't match flaskr repo
When debug mode is enabled, control-c takes forever to quit, and reloads are slow.
Logging Application approaches 
Update send_file() docs to clarify encoding requirement #1286
Snippet “Sign in with Steam ID” has issues
Update api.rst
Update api.rst
Add Bottle-like route sugar
Slowloris DoS Vulnerability
Slash in route affects sorting/matching order
Update information about Python 3
Small Typo fix
Add JSONIFY_END_WITH_NEWLINE config variable
Python 3.4 and PyCharm breakpoints when use_reloader=True
Add absolute_import to Celery docs
Unicode in Flask - Uploading Files
Use RuntimeError instead of asserts
Calling redirect() from Blueprint#before_app_request() 
Confusing line in Uploading Files pattern documentation
Sqlite3 doc page for 0.10.1 missing a function
Make the _external keyword available in the test clients url_for function
solution for running context dependent attributes
hidden attribute
Flask Doc Download Link Broken
Some question about attribute cls.__unicode__ in flask/_compat.py
Need more documentation for usage of instance_path
404 on PDF version of documentation
Minor typos 
Flask fails to start with use_reloader=True when using absolute import
Minor typos
Minor typos fixed
Minor typos fixed
Minor typos fixed
Flask.redirect() bug?
Docs style fixes: ``FOO`` vs `FOO` (reloaded)
Multiple Ports in URL when using redirect behind BrowserSync
url_for extension for REST Apis
explain_template_loading_attempts: docstring
Close <p> tag in flaskr login.html
Tweaked sqlite3 documentation
Minor typos and spelling fixed
New label 'good first bug'
The 'download as PDF and zipped HTML' links on flask.pocoo.org are broken. 
flask-docs.pdf lost
Docs style fixes: ``FOO`` vs `FOO`
Fix broken links on python3.rst in docs (#1228)
Doc link broken
teardown_{request,appcontext} not called on first request if it throws an exception when DEBUG is True
Remove unused 'template' arg to _iter_loaders()
Typo and cosmetic fixes
Starting up a public server.
Improved secret key generation example
Set TEMPLATE_AUTO_RELOAD default value to None
Some grammar and typo fixes
Updating extension guidelines v2
Correct the order of suggested syntax for extension imports
Correct the order of suggested syntax for extension imports
Fix typo: "lated later" >> "added later"
Display Flask Server IP address
Is there a Login Manager?
Switch TEMPLATES_AUTO_RELOAD to False by default
Add trim_namespace argument for app.config.get_namespace (with tests)
itsdangerous.py - "ImportError: cannot import name _compare_digest"
The way Flask handles `www` and subdomains is ambiguous
One namespace for route handlers
Handle a single unusual argument in jsonify
Corrected api docs
broken documentation links on Flask site (http://flask.pocoo.org/)
Deprecate request.json property
Read documentation in pdf does not work
Remove deprecated old module, and start deprecating `request.json`.
Improve jsonify() 'non pretty' compression
Large Dictionaries Not Released From Memory
How do I only enable cookies if the user logs in?
MAX_CONTENT_LENGHT not being respected with JSON payload
make runs superfluous tests when using a virtualenv
Flask accessing and editing config data
pdf documentation
Add unittest for appcontext_tearing_down signal
Link from Debug Mode to Application Errors
wtforms get all errors as list
PDF and HTML docs not available on homepage
Minor typos in sqlite3.rst
Minor typo in errorpages.rst
Blueprint template not found
Test failures with pypy2.4
[Website] Documentation PDF and zipped HTML download links return 404
Stop recommending Tornado as a WSGI server
some grammar fixes in docs/appcontext
Fix typo in changelog
Update config.py
Update quickstart.rst
Deprecate and remove APIs
fix typo in in README of examples (i.e., filename of test files)
Modify docs for new testsuite
Print line after server is started
Ability to override json encoder and decoder arguments
Should jsonify() throw an exception when provided a list?
turn on autoescape for `flask.templating.render_template_string`
Update tests section in README file
docs/_themes/.git is in the tarball at PyPi
python3 -mpdb myflaskapp.py fon ubuntu 14.04
very minor spelling fixes
Documentation on flask.pocoo.org is missing
before_render_template signal
Add support for blueprint-level cli commands
Configure pytest's norecursedirs
Add command line support for ext_migrate tool
Update docs to reflect deprecated ext format
Changed implementation of flash messages to use a dict instead of list
Update README for clarity and to remove redundancy
Added closing paragraph tags
Flask Roadmap
Method `render_template` does not use blueprint specified `template_folder`
Add exception details to response
Ability to disable Flasks internal logger
Add skip to fix unnoticed bug with import migration tool
Support for @blueprint.cli.command
Documentation PDF 404's on flask site
New Watchdog Reloader Is Not Detecting Changes
improve grammar, make format consistent, and improve readability
Reload takes > 60 seconds
Problem running Flask with an ssl_context under Werkzeug 0.10.1
Overloading of JSON Decoder causing cookies decoding problems
Include wheels on the PyPI release
Signals.rst: Grammar and readability fixes
sessions not saved when streaming
Import redirection makes it difficult to catch exceptions
Remove bad security advice about send_file, fixes #1345
flask.send_file gives bad security advice
It's been almost 2 years since the last major update.. is there any realistic date for any new release?
make test_request_preprocessing_early_return more thorough
flask.ext Import Migration Tool #1135
Use PEP440-compatible dev version
Snippets - Decorators: Verify a Google authentication token
It resolves problems with blueprints and url_prefix "/"
Improve docs of signatures of before/after/teardown callback funcs
Fixed `stream_with_context` decorator not working with generator functions that take in arguments
request.url returns decoded version. How to get encoded one?
Update api.rst, fixed spelling
Typo on flask.g documentation section
Error 404 for linked flask-docs.zip
Fixed minor docstring typo for teardown_request()
Fix #1330 Support capital letters in mimetype in is_json
Method is_json does not support capital letters in mimetype
Programatically enforce styleguide
Strange behaviour in app.route decorator 'methods' parameter when using string
AttributeError: 'function' object has no attribute 'name'
Add datetime.date support to JSONEncoder
Clarify contents of request properties.
test_client removes query_string
Extra slashes causes route error
distribute_setup.py link for windows setup has gone bad 
Make it easier to serve 304 (Not Modified) using a database file.
Melvinflask
Error With Quickstart Tutorial - Print url_for('profile'...) 
grammar fixes
flask.wrappers.Request.get_json fails to check for data
ehh .. how to say
Replace TextField with StringField in registration page example
Flaskr tutorial Step 3 is missing content
Added missing import.
pylint errors on all example & template project
Conditionally install default logging handlers
persona example error 
Uploadpattern fix
Replace hard coded path
URL generation rule explained for file uploads
Update copyright year
request.form issue
Dev server fails to terminate, becomes orphan
Happy New Year 2015
testing documentation missing "TESTING" config
Allow to know about Blueprints registeration state
Links to PDF and HTML Zipped Docs return 404 error
Update quickstart.rst
Flask doc unittest error
Fix grammar in testing doc.
麻烦问下， 你的数据库怎么升级啊
register user errorhandler in the right order
Documentation
Project Feedback Site
fix typo
Fixed and intuitivized exception handling
Fixed #1288: app.add_url_rule() should look for OPTIONS methods in a case-insensitive manner
bad content-length default
app.add_url_rule() should look for OPTIONS methods in a case-insensitive manner
Update copyright to 2015
send_file fails when filename contains unicode symbols
Use new container based Travis-CI
`itsdangerous` dependency not marked
response time problem
raise FormDataRoutingRedirect
errorhandler should expect exception classes instead of exception instances 
Update mongokit pattern
Doc inconsistency
Command 'flask' not installed and can't run from module
Documentation fixes (mostly in Tutorial)
Update MethodViewType for supporting Mixin
Include backend argument when instantiating Celery
reloader crashing
Fixed wording
Time for a new release ?
Route parameter types
Fix: add closing dt tag in example
added numpy requirement
Report Security Issue
flask_logo_python
Ensure session_interface.open_session is called after URL matching
Add signed int and float to docs
修复了xxxbug
Allow dependabot to check GitHub actions daily
Bump pytest from 6.0.2 to 6.1.1
Display image in template from binary stored in mongodb
Updated outdated link in errorhandling documentation  
Outdated external link in errorhandling documentation
Parmetrizing tests
Add python 3.9 to CI.
test boom
Enhancement Request: Response Class in Blueprint
Ready flask app for beginners
Raise an error if rule starts or ends with a space
@app.route should either trim urls or throw an error when route ending with space is provided
docs refer to decoder instead of encoder
Check the static URL in advance
Check the static URL in advance
request.endpoint always None in SessionInterface.open_session
flask run error
Bump pytest from 6.0.2 to 6.1.0
Bump greenlet from 0.4.16 to 0.4.17
trying to add some more information :-)
aesthetic: add a space after a comma
why flask create a new thread with the same TID that already exists?
grammar mistake fix
Typo in Flask pallets fileuploads
Update quickstart.rst
我怎么同时使用send_static_file函数和jinjia2语法来获得后端传递的数据呢？
how
could self.session_interface.save_session be run before the after_request_funcs are executed?
cannot set remote_user
Breaking a ref cycle created by default in Flask()
A Flask app holds a reference to itself
GPU memory usage keeps increasing even hybridize with static_alloc when used in flask debug mode after mxnet 1.6.0post0.
Merge pull request #1 from pallets/master
Docs: Sentry is not open source any more
DOC: Simplified loading of favicon
Bump pytest from 6.0.1 to 6.0.2
Use content-encoding from mimetypes check in `helpers.py:send_file`
Bump tox from 3.19.0 to 3.20.0
Discrepancy in logging output between IDLE and Terminal for Flask 0.12.x
Error 302 on Redirect after Form Post
updated doc for mod_wsgi
Random error function mapping over existing endpoint function.
update cache action to v2
Update setup.py
blueprint does not render template relative to the blueprint.
make_response mimetype ignored
Deprecation of itsdangerous.json
fix typo in flask shell help
Bump pre-commit from 2.6.0 to 2.7.1
debug PR please ignore
Fix pre-commit cache key in GitHub Actions
fixed #3738 typo in src/flask/blueprints.py
[Docs] Typo in documentation.
provided possibility to configure digest method with different hashin…
Formatting list routes if environment installed rich lib
test_client() does not close a file opened by send_file()
Bump sphinx from 3.2.0 to 3.2.1
Disable required attributes overriding error output
Increased hand-holding for Windows users
Flask infer MIME type in javascript modules
Update the signature of the teardown function
Support option to disable color escapes in the log
Discover app factory deterministically
Add environment variable to disable loading entrypoint commands from flask.commands
Include samesite and secure keys when removing session cookie
Bump sphinx from 3.1.2 to 3.2.0
templates not showing <h1> element nor any changes applied to layout.html
Fix bad intersphinx link
Bump tox from 3.18.1 to 3.19.0
feature: make test_client API same as requests API
Provide configurable digest_method for SecureCookieSessionInterface
Error: read ECONNRESET
Testing tutorial doc is not working
Example for teardown_appcontext in the docs out of sync with actual codebase
Bump pip-tools from 5.3.0 to 5.3.1
flask
Add command switch tabs for Bash, CMD and Powershell with sphinx-tabs
Bump pytest from 6.0.0 to 6.0.1
cleaner message when CLI can't load app
Add CSS styling to Flask API docs hosted at palletsprojects.com, to aid visual navigation of the page.
Common API Between Flask + Blueprint
Common API Between Blueprints + Flask
jinja2.exceptions.TemplateNotFound
Bump tox from 3.18.0 to 3.18.1
Bump pytest from 5.4.3 to 6.0.0
swapping self.assert_equal for assert
Fixes #1902
Bump pip-tools from 5.2.1 to 5.3.0
Can't set `FLASK_DEBUG` from `config.DEBUG` using the CLI interface
examples for some blueprint uses in docs
remove unnecessary docstrings from tests
Add repl.it to list of deployment hosting options
Add tip for set environment variable with Powershell in the Configuration documentation
logout and factoring cookie problem
imports now together
Any reason to keep g as a property on RequestContext?
Added multi-line imports to app.py file
Add Qovery option to deploy Flask
use Jinja's tojson filter
Update for recent changes in Pallets libraries
[pre-commit.ci] pre-commit autoupdate
Bump pre-commit from 2.9.3 to 2.10.0
Bump greenlet from 0.4.17 to 1.0.0
Bump sphinx-tabs from 1.3.0 to 2.0.0
Bump pytest from 6.2.1 to 6.2.2
Bump sphinx from 3.4.1 to 3.4.3
Bump packaging from 20.8 to 20.9
Bump jinja2 from 2.11.2 to 2.11.3
Bump tox from 3.20.1 to 3.21.3
Debug mode auto-reloader causes Uncaught Exception
Doc update: Clarify got_request_exception signal docs
Views & Routing `methods` input throwing TypeError for tuples
Flask silently overrides Jinja2 tojson filter
Docs update: clarify json error handling
Reload the flask dynamic blueprint by using the @app.route('/reload')
Testing docs example for setting 'g' seems incorrect
Improve some code comments
Increase the point in the comment.
Increase the point in the comment
flask doesn't return http error 413 if file too large
Falsk url redirect with Masking
If using a .env file with Docker, the Flask CLI still tells you to install python-dotenv
Flask's Celery docs are going to start failing with Celery 6 and get deprecation warnings with 5.x today
Leading forward slashes are stripped from path variable
"Request" object has no attribute "is_xhr"
Update views.rst: fix the routes sample code
Update the example in README
Update documentation for easy quickstarts
Requiring endpoints to have a __dict__
The Issues about recv-Q
Document parameter description error
Silence pytest warnings for exception propagation test
Bump packaging from 20.4 to 20.8
Bump pytest from 6.1.2 to 6.2.1
Bump pip-tools from 5.3.1 to 5.5.0
Bump pre-commit from 2.8.2 to 2.9.3
Bump sphinx from 3.2.1 to 3.4.1
[pre-commit.ci] pre-commit autoupdate
postman cant post mp4 file
Flask session cookie secure flag is not getting set. 
raising HTTPException does not cause got_request_exception signal to be emitted
Add link to reference docs in README
Flask master requires Werkzeug master
fix explanation of wheel name
How clear AWS S3 Bucket ClientError in Flask API server? 
PUT route requires a body to work
SESSION_COOKIE_SAMESITE not woking
Update cli.rst, repeated word "that" in line 258
before_request handler in Methodview class
[pre-commit.ci] pre-commit autoupdate
Flask,doesn't redirect page
How to verify a flask web app in the google search console
Explain Allowed_file() func in Uploading file on web via FLASK
session.pop do not actually remove anything
flask.abort() documentation broken
Fix ci environment command syntax
Update deprecated set-env ci command
[pre-commit.ci] pre-commit autoupdate
Web site / documentation: Should tell what Flask *is*
Error during startup
Error during startup
Op2020
flask run error
move send_file and send_from_directory to Werkzeug
update tests for new Werkzeug client
Running a simple Flask app will not work because an older run is cached somehow.
Separate docs page on debug mode
adding an assertion to catch a mistake I made
update requirements
Bump sphinx-tabs from 1.1.13 to 1.3.0
Bump pre-commit from 2.7.1 to 2.8.2
Bump python-dotenv from 0.14.0 to 0.15.0
Bump tox from 3.20.0 to 3.20.1
Bump pytest from 6.1.1 to 6.1.2
Whether flask dev server by default really works single process?
Updating external_url_handler example to Python 3
Error when trying to start flask app from command line
JSONEncoder: Add test for objects with __html__ method
Added link to deploying on Divio how-to guide
Add separate and more detailed issue templates
create hello world added file
Flaskform import not working, no matter what I do.
docs: mkstemp returns a file descriptor and a path
Use list in methods instead of tuple
Clarify it is talking about HTML tags
Link SQL injection to python sqlite3 library doc
cli.load_dotenv: when path provided and python-dotenv not found, extra message
fix html in example 404/500 templates
Can't get page over browsers
[Minor changes] Update documentation by removing outdated information
I think it's a deadly bug in the Flask module.
werkzeug/test.py modifies headers passed to Client.post
Small fixes and improvements
Update documentation about python 3 support in Flask, resolves #1578
improved documentation for config.from_object
Tests with and without simplejson for every existing testenv
Rewrite subclassing example with a better use-case.
Remove old version added and changed tags #1704
url_for now supports no request context and no SERVER_NAME case
Revert "Adds simplejson as a testing target."
Add ipython/bpython support to `flask shell`
Fix Issue 1847 - Adding Current Path when Invoking Flask-Cli Run
Add subclassing pattern/example
Document Runtime Error when running outside of application context
Coverage for test_static_path_deprecated and test_static_url_path
Add last_modified arg for send_file
Added link to deploying documentation
Werkzeug mentions
Remove old version added and changed tags #1704
Adds simplejson as a testing target.
Issue #836: Tweaking tutorial warning about plain text passwords and …
Add issue template, resolves #1773
Remove version info from Werkzeug in the docs
Document flash message size limit
Add clarification for login_required decorator
Remove deprecation warnings for add_etags & mimetype guessing for send_file()
Add version switch to flask cli
Issue using Flask CLI with module layout recommended in Large Applications
Add tests target that uses simplejson
IPython Option for Flask Shell
Middleware doesn't execute inside test_request_context()
Mention the template name conflict issue in blueprint templates docs
[CLI] Option to pass the FLASK_APP variable as an argument 
Guard sys.exc_clear call for people using pypy3
a few more python3-compatible print
Update and rename README to README.md
Fixed typo in filename.
Setting error handler for unknown code fails
ExtDeprecationWarning show file path with deprecated import
Failing test: test_egg_installed_paths
Bringing the copyright date up to 2016.
Fixed link in changelog to documentation.
static url is not correct with subdomain
Show line which caused the DeprecationWarning
Update help to >   set FLASK_APP=hello.py
"[Errno 2] No such file or directory" on flask run with FLASK_DEBUG=1
`flask --version` fails
Convert readthedocs link for their .org -> .io migration for hosted projects
Match the hello.py with the one on homepage
Flask 0.11/httpbin: TypeError: <generator object MultiDict.lists at ...> is not JSON serializable
Consider making StrictUndefined the default in Flask 1.0
Added sentry to docs
Improve application context popping
Added plugin support to the cli
Switch to CLI Light
fix bug in example/flaskr/flaskr.py
fix docstring
Unify versionadded markers (0.11 vs 1.0)
Reference to Flask 1.0 in Flask 0.10 docs
Add special handling of ./ template strings
Fast path for disabled template load explain.
Resolve state issue for url_for with forced scheme
turn 2 prints to py2/py3 compatible syntax
Addressing Issue 1809
Added X-Accel-Redirect support
flask.Flask.register_blueprint is poorly documented
itsdangerous -> derive_key() occasionally returns invalid key.
stop/terminate flask outside request context
Forward ported CLI tests from Flask-CLI and fixed a bug with the CLI's name.
How to bind() when DEBUG = True
'config object has no attribute from_json' error 
'config object has not attribute from_json' error 
Why `from . import views` can solve circle import in Flask?
Fix "with" formatting in doc
ImportError when dropping privileges before running Flask
Does Response() work for anyone?
Fix a grammar mistake in the docs
#1782: Add flag to handle file-like objects
Post on refresh
update docs and refer to setuptools
Slow json decoding for huge objects
[RFC] template load performance, Blueprint.render_template
test_monkeypached_sleep fails on CentOS 6.7.
flaskr example seems to loose data on every launch
'Flash' Silent Error: occurrs when trying to flash a string with too many characters.
Install flask gives error
database: persistent connetion
Failed get_json
g object doesn't work between blueprints
Not possible to set a session cookie without a domain attribute when SERVER_NAME is set
Automatic redirect with "/" breaks routes with different methods
send_file() function tries to get the file from filesystem even if file-like object is passed
minor rewording of get_json documentation for clarity
Question: can flask create 'access.log', and 'error.log'
pluralise "thing"
app.route does not catch // when having <path:> in the directive
The comment didn't make any sense
Determine API for integrating custom shells with Flask such as IPython, etc?
Update the list of Approved Extensions
API versioning with blueprints causes colission
Issue Template
Flask docs need rebuilding
Remove dotCloud host instructions
Delete superfluous branches from the repo?
Update `tox` installation instructions to point to PyPI
Stream download chunked not working?
Flask framework not support html5 video label on safari and iOS devices
Fixed mistake in CONTRIBUTING.rst file, regarding pip install.
When I run 'pip install Flask' in Ubuntu server I got these info
OPTIONS default behavior not compatible with Angularjs
External url scheme is kept accross multiple url_for
multiple processes on windows
Clarify the python versions that flask supports
COC?
Add encoding param in config.from_pyfile
Update config.py
Readme
Injecting Flask vulnerability issue
minor revision of documentation.
why command flask not found
Fix wrong indentation error and get rid of PEP8 warnings in helpers.py
Error running minitwit example
Remove with_statement in flask/ctx.py
When DEBUG=True, OSError: [Errno 88] Socket operation on non-socket
[support] I get None with request.form
Mod wsgi docs
About import OpenID
visual studio code plugin>
template loaders configuration don't support zipped applications
Please update mod_wsgi documentation to use httpd 2.4 syntax
Issue Regarding to instance path in testsuite directory
0.10 maintenance
Allow debugger to be controlled from application configuration
Allow application configurations to control the debugger
Dev server redirects to arbitrary url when path starts with double slash //
0.3 maintenance
Fixed a typo in the appfactories docs
update flaskr example design
Links to download documentation need updating
add before_init param to View.as_view
Catch-All URLs
Exception when client closes stream before flask response
Extend documentation about uwsgi/nginx deployment
Skip tests if redbaron is not installed
Add .cache dir to gitignore
In case a test fails a .cache directory is created
Looks like pytest is not the only minimal dependency
Can't deploy flask in nginx using python 3 (in a subroot) 
Documentation / Quickstart / Debugger - how to activate
Render the code block in mongokit.rst
demo doesn't show the active port
Werkzeug 0.11 does not allow debug
Allow to specify subdomain and/or url_scheme in app.test_request_cont…
xss issue
Flask extremely slow on SQL Server view queries versus pure table queries
Review Flask-DropIn extension for listing and approval
OSError: [Errno 9] Bad file descriptor for python3 + flask
Fix typo.
Documentation on setting up configuration file might cause friction to new users
I can't to custome json decode error handler.
Abh ocean
[Document Bug] get_json(force=False, silent=False, cache=True)
Unicode Error when running in debug mode
Fix typo in app_ctx_globals_class doc in app.py
add BiuBiuBiu~
Fix a typo
Fix typo in templating.rst
Core signals template_rendered doesn't works
New release and updated documentation please?
OPTIONS requests sometimes match the wrong url_rule if there are multiple route handlers for different methods
Added session regenerate/destroy methods
allow using alternative json library
Duplicate: Downloadable documentation files links (pdf and zippe files) are dead
Add session methods to handle destruction and regeneration
PendingDeprecationWarning on use of import imp
Add info about working with VE and Python 3
KWC_code
url_for with alternating schemes
Fixed small typo in comment
travis: python 3.5 support
support timedelta for SEND_FILE_MAX_AGE_DEFAULT config variable
Update CHANGES
Example code leaked when running test
in pluggable views, why not passing url variable parameters to view object?
Make sure we list HEAD as a valid method when GET exists
Updated documentation for Setuptools
url_for: 500 Internal Server Error
No wheel published
Added flake8 for checking Python syntax
Updated documentation for Distribute installation
Unknown error
Enable distribution as a standalone, compiled executible with nuitka
Fix name mismatch in apierrors page
Make SEND_FILE_MAX_AGE_DEFAULT support datetime.timedelta
route parameters
Update docs on the website (at least the python 3 ones)
Warn when using development server
an context confuse when i using the celery 
What is the release schedule for 1.0?
support for rotating secret keys? 
Documentation: Clarify instructions about changing row_factory for SQLite3
 Logging Documentation, Patterns & Extending
@app.after_request should be able to process a non-response into a response
trailing slash redirect doesn't work for route('/')
jsonify and return a list
Fix for a word tense issue in the docs.
Update Extension List
Updated documentation for deploying with Lighttpd
Wrong "Date" http header, breaks clientside caching for static files, lots of 304 responses
control of Session hash_method, serialization_method, expiration behavior
overriding JSONEncoder
Endpoint decorators
Favicon pattern
A typo in the open_resource() doc string.
Typos + favicon pattern
One-Click-Getting-Started Script
fix subdomain for static rule on registering module
OpenID login for AOL broken in Flask website.
docs updates to match new Werkzeug docs
Context processor use is problematic.
Trailing slash URL redirect does not include the query string.
Added closing tags to template examles
Global "messages" when using flash()
UnicodeEncodeError when script is in a folder with non-ascii characters in the name
Allow custom TestClient
pypy 1.4 and Flask Sessions
Passthrough exceptions in TESTING mode
Fix issues like issue 111
Minor spelling fixes
Pointless example for Signal.connected_to
Untitled
Module-local errorhandler
Make tuple to make_response handle response objects
Typo in the security XSS section.
Updated link for 'declarative' in sqlalchemy.rst
Minor changes on docs
Fixed indentation in session API docs
Some minor doc fixes
test_request_context should trigger before_request and after_request
signals.rst
Documentation bug fix
Modules and Lazy Loading
Website
Thoughts about the fabric docs
Proper initial environ for flask's test_app()
Ticket 126
Provide a correct initial environment based on app's config
Fix failing unit tests when using flask under Jython
small change to tutorial 'folders' page
issue in test_request_context method of Flask class
HTTP method decorators
Another small packages documentation change
handful of minor doc touchups
support classes in addition to functions for views
Powered By Flask
minor doc fix
Add domain to module
Small documentation change
A default response body
Added Blueslug to website
JSONP
`static` path has a problem in the module which doesn't have a subdomain.
getting raw POST data for whatever mimetype
[doc] uploaded file validation example
`url_for("static", ...)` with `subdomain` problem
Fabric deploy script `docs/patterns/fabric.rst` does not work (for me)
Typing error in docs/patterns/fabric.rst
`pydoc flask` [or vars(flask)] fails
send_file in flask 0.6 issues
Change the static folder
Wrong import in Errorhandling
Implement jinja's ModuleLoader
Inconsistency in docs/testing.rst
Section 3.8 Sessions - bug in example of escaping session value
Response object mismatch
Automagic OPTIONS: incorrect Allow results for routes with multiple handlers
Application directory
Bug when server handles registered urls?
Flask.signalhandler decorator
typo in HTML history docs
Improve template documentation
Automatic URL variable insertion
Disabling code execution
Metaprogramming
Documentation of server configuration and middleware inclusion
2 little bugs in jqueryexample.py
Module.add_url_route and App.add_url_route not consistent  
Update Docs to mention MAX_CONTENT_LENGTH
Webapp installed into lib of virtualenv cannot find templates
Support conditional GET for static files
The after_request handlers should be called in reverse order
Static URL rule not being added on GAE with static_dir handler
Sessions and SERVER_NAME
If SERVER_NAME is set the cookie does not set itself correctly
remove circular dependency between flask.wrappers and flask.helpers
Flask broken on 2.5 without simplejson
Better autoescaping default configuration
Document that exceptions are swallowed in non-debug Mode
Explain UTF-8 Encoding
Link to Flask-SQLAlchemy and Flask-WTF in the docs
Add support for Nginx "X-Accel-Redirect" header to send_file
Document request.endpoint and request.view_args
Documentation has to explain Flask constructor better
support unicode filename at download attachement by send_file in helper lib
Flask Streaming Jsonify
Url conflict assert
Readme changed to markdown, improved
test
Missing apostophe.
Popping application context after every request
Flask g persisting across requests in test suite
Flask app installed as egg raises builtins.NotADirectoryError for templates
add automatic pep8 test in travis
Fix static route when using host_matching = True
url_for('static', _external=True) gives bogus url with app.url_map.host_matching = True
Update uwsgi/nginx deployment documentation
Attempted to improve readability of code examples.
PDF and zipped HTML doc links are broken in Flask homepage
request.files blocks indefinitely on iOS Safari file upload
Help needed: 404 error on every page dynamic page of the application 
Errors if server runs from in virtualenv.
Flask Truck Factor
Backslash doesn't work with string URL Converter
Flask function decorator run at defintion time and call time?
Formatted readme
Support zero-ceremony sub-app mounting (including Blueprints)
Quickstart > File Uploads > incorrect import: secure_filename
Broken links on website
Request.form data dict... Could we modify the structure?
flask blueprint 
Start recommending Python 3
error correction json array serialization 
Returned 200 for illegal request url
Jinja2 template not found on Large app how to wiki
Improve function with_metaclass()
Moved open_session call from RequestContext.push to wsgi_app
use blueprint specified template folder
Support argument-less factory functions in CLI
Revert "make external_url_handler example py3 compliant"
make external_url_handler example py3 compliant
fix UnboundLocalError in handle_url_build_error
Fixed gevent introduction to use libev instead of libevent
gevent has been updated to use libev instead of livevent, docs needs to be updated
Added missing app.run line in jqueryexample.py
Missing "app.run" in source code of example "AJAX with jQuery"
Application/request stack corruption if unhandled exception is raised in session interface
Update docs at http://flask.pocoo.org/docs/0.10/patterns/fileuploads/
TypeError: unbound method __init__() must be called with AssertionError instance as first argument (got FormDataRoutingRedirect instance instead)
Flask + eventlet slow response time
error in user_timeline
Relative import doesn't work in debug mode
Merge pull request #1 from mitsuhiko/master
Better docs for app context and it's solutions
fixed some punctuation, fixed a few errors, in service of readability
added comma for readability in first sentence of WTForms
Any plans for new versions? Maybe 1.0?
sourcecode from "AJAX with jQuery" not working?
cross domain
turn on autoescape for flask.templating.render_template_string
Update docs/quickstart.rst to be consistent with official website
Does the 'docs/quickstart.rst:A Minimal Application' missed something?
No more than 5XX Requests/Second possible
TaggedJSONSerializer loads(dumps(..)) breaks on certain values
Remove the deprecated Flask.modules property
Add pop and setdefault to AppCtxGlobals
where is SESSION_REFRESH_EACH_REQUEST?
Blueprint url_prefix isn't additive with register_blueprint url_prefix
flash(...) won't work!
JSON Encoding in Python 3
Question:  reload process too slow
How to detect ssl(schema) protocol correctly with request.url_root?
Don't pass version to tox explicitly
Update advanced_foreword.rst
Tutorial    Step 5: The View Functions
Fix project name in CONTRIBUTING.rst
blueprint 404 error handler not honored with url_prefix
Feedback Links - 404 Error
Update title of docstring in flask.cli
Done
Handling HTTP 405 on the blueprint level
Remove mention of abandoned project Flask-Uploads from docs
Any new release ?
Remove the word `trivially` here
Get “insert_id” for one to one relationship in Flask, SqlAlchemy
Add kwarg to disable auto OPTIONS on add_url_rule
If you aren't using classes for `view_func`s, you can't tell Flask not to serve OPTIONS
Update celery.rst
DRY globals definition
Consider adding documentation about script-name-stripping middleware to CGI deployment documentation
Deprecate flask.ext
Show original autodoc signatures
Code fix for issue #1481
pkgutil.get_loader now throws errors on Python3.4
Handle empty deque on errorhandler lookup.
Implement config.from_envjson (with testing)
Flask keep-alive
Remove Blueprint.view_functions
Change documentation entries
Minor flask/json.py documentation change
Add flask laptop decals sale link to the website
Flask server stops responding to new HTTP connections
Add a method to register multiple blueprints at once.
Adding after_server_run
Add self.options so options can be retrived from within the blueprint
New Converters: bool, long etc.?
GET params discarded by flask test client, when using full url
Optional Jinja2
Support other JSON media types in `Request.get_json`
0.10 Documentation - Unit Testing - Error
jsonify response mime type
pocoo docs out of sync
added a note to the api documentation about JSON_SORT_KEYS. Fixes #922
Remove the extra "1"
Add `get_namespace` method on `Config` object for convenient access of namespaced config options
Add support for using jinja2's PackageLoader
Added helper method redirect_url_for
allow auto excaping of .jinja files
Empty response when serving files with WSGI, if app.debug is True
Update appcontext.rst
Validated HTML
flaskr Stored XSS [FIX]
Fix #941 -- allow errorhandlers for HTTPException
Allow developer to override X-Sendfile header when USE_X_SENDFILE is in use
flaskr.py in Flaskr Tutorial, LINE 23
Flaskr should mention Heroku does not support sqlite3
Update fileuploads.rst
Release as universal python wheel (2/3 compat)
Use json method of requests.Response
Use json method
Default JSON encoder handles datetime.date objects.
Added a favicon for the docs 
Updated greenlet links, which were dead.
Registering a handler for HTTPException has no effect
fix @before_first_request rasing exception
Default HTML errors don't tell their encoding and aren't HTML5
Enable tuple responses with headers without status
Can not register a 500 error handler for blueprint
Fix typo in helpers.py
Fixed incorrect grammar in Config.rst
Include favicon in the documentation
Overriding blueprint template does not take effect until restart
Anyway to reload only one app in DispatcherMiddleware
Update celery.rst
fix a etags bug when sending a file stream with a name
Added SESSION_COOKIE_PERMANENT configuration to control permanent session
Load config from JSON file
Read config from JSON file
Number of opened sockets grow unlimited 
Message Flashing's implementation is broken and should be removed anyway
Update sqlite3.rst
Documentation stylesheet unclear link differentiation
Template filter: tojson and sort_keys
Fix relative send_from_directory for package apps
Python3 compatibility: test_client response not UTF-8
List Flask-WebTest in the extensions registry
Sessions on heroku
TypeError in CSRF Token Checking Under Python 3
0.3 maintenance
Update celery.rst
Convincing manager with large high traffic sites using Flask. Any tips?
Print of several 'Running on' ...
Address already in use at Threads
JSONEncoder cast Decimal to string
exception logging: issue #678
Changed the wording of some sentences there were difficult to understand...
Flask needs a way to announce new versions
Unicode error when serving static file with unicode characters
Update github location for Flask-Heroku
Allow subdomains to work with no SERVER_NAME
POST request from Dropzone.js failing in Flask
How to generate a SecureCookie in latest version?
The flask application always hang.
accessing config settings from other files
If an URL path element contains %2F (an escaped "/")  Flask.route considers it as an unescaped slash.
fix typo(there-> their)
g request context is not per request?
URL Reversing in Quickstart Doc #779
Routes for class-based views can't be overloaded when using View.as_view()
Fix typo in docs for error_handler_spec
fix typo.
Added configuration from a dictionary
Too many files open when instantiating the app thousands times
Don't refer to flaskext in app.extensions docs
Documentation fix: Makes the error names consistent
Escaped 'text' keyword in column name.
Added link to Flask Examples on Runnable.com
cannot call methods decorated with setupmethod from before_first_request handlers
Updated some typos
Update url_for documentation for Flask.url_build_error_handlers
Update appfactories.rst, make extension related section clearer
Update appfactories.rst, remove SQLAlchemy related information
app.test_request_context() is affected by except blocks that happen before it
Config - Custom variables must be all uppercase
fix issue #879 and add a test for it
before_app_first_request strange behaviour
quickstart: import `request` in HTTP methods example
Fix a typo on blueprints module name.
Add TEMPLATES_AUTO_RELOAD config key
Minor improvements to documentation.
fix typo (jsonfiy -> jsonify)
tests fails in sample apps on python 3.3
Fix typo
Set up automatic cronjob for updating flask.pocoo.org from repositories
docs: add Hasura as hosted deployment option
Can't install flask on windows 10 
TypeError when serving static files (304 NOT MODIFIED)
Override env var when using python-dotenv 
Flask app can't debug within jpype
Add Support for FLASK_ENV
Flask Multi-Server Development Hooks
Fixed Typo
`flask.g` not reset when using  `test_client()` inside app context
set session.new attribute
Docs: Update CLI for factory pattern
session.new is never true
teardown_request not executing on first request in debug/uwsgi (works without debug)
app.run(debug=True) and @app.template_filter() Bug
Updated cli.rst with a minimal mention of --host and --port options.
Add conftest to flaskr
Better appveyor config
add appveyor configuration
cli.rst: added flask run cli options help
Fix sentry raven install docs
remove tests and docs for python 2.6 and 3.3
fix non-passing tests for logging on pytest >= 3.3.0
Docs: Add missing backslash
Docs: Fixed typo
fix typo
Some of tests fail on running pytest
"Request.is_xhr deprecated" warning during jsonify()
Fix docs, how to get db connection in pattern
Document which servers support wsgi.input_terminated
send_from_directory() and send_file() fails on Windows
Treat errno.ENOTDIR like errno.EISDIR when silently absorbing IOErrors in config.from_pyfile (from_json, etc.)
typos in docs/patterns/distribute page
SyntaxError: Non-UTF-8 code starting with '\x90' in file flask.exe
Documentation fix - quickstart "HTTP Methods" code example
update pycharm instructions
Rename GitHub templates to Markdown.
ImportError: cannot import name BooleanFiled
It works well
Update docs/tutorial packaging.rst
Docs: update built-in server description
Update PyCharm instructions
export FLASK_APP=run.py doesn't recompile .pyc files (BUG)
0.12.2: two test failures
Improved bad factory error handling
Enable threads by default for the dev server
Adding more examples
Fix ValueError for some invalid Range requests
Invalid range with send_file() and xsendfile causes ValueError
Docs: update Twisted Web example
Docs for change default logging format / Log would print twice after add a stream handler
Missing import statement in "Uploading Files" doc section
doc: add a pattern doc for Dramatiq
Flask.create_url_adapter should use SCRIPT_NAME, not APPLICATION_NAME
Don't create View instances for each request
docs: testing: expose init_db function on module
A strange error when a “/a/b/c” route render to a template
Exception while opening session causes auto_pop not to be executed on the context
Minor bug in examples/flaskr/README
Minor fix in flaskr example README
Unable to generate the PDF version of the documentation
Rewrite tutorial and example
Idea: `flask run`-like command for production
No documentation for how to test CLI commands
Improve README for flaskr example
Fixed typo in docs
Provide a "media" route
Percent encoded forward slash is stil treated as a URL component delimiter
add option to use None config for later evaluation
Flask server not running on Arch Linux
Remove IRC notifications from Travis CI
WAV files cannot play in Safari
Fix typo in cli.py
Add CODE OF CONDUCT
Improvements in the final sections of appfactories.rst
doron-test - ignore please
Flask uploaded files successfully and the database changed but can't find the uploaded file in in the server
Support "immutable" Cache-Control extension
Unable to execute Flask.
Support for Config(None) initialization
The FlaskClient.open(test_client) parameter could be explict
Fix misleading documentation
Fix typo in logging.rst
Fixed grammar/typos
Rewrite CLI errors and docs
pickle and cPickle can't find class from import
 "flask_wtf.Form" has been renamed to "FlaskForm" and will be removed in 1.0.
RE: Errors and BeagleBone Black/Flask and Python
Drop unsupported Python 2.6 and 3.3
running flask with debug mode throws an error
Allow users to customize the behavior of flask.abort
AttributeError: 'module' object has no attribute 'app'
TypeError: Decimal('1.600') is not JSON serializable
stop travis irc notifications from forks
Flask complete demo app
Flask crashes on startup
Adding elements to a dictionary global to an app
Add a concept of application teardown
Fix Travis CI argparse import error on Python 2.6
Fix typo in comment
flask thread is always running, can't stop
blueprint in a blueprint
Serial port access problem in DEBUG mode.
Fix inconsistency in testing doc.
[Feature proposal] Add instance folders to the template searchpath
myissues
[Tutorial] Clarify where to run "flask run" command
Examples page
Tutorial: Project Layout - clarify flask run
AJAX with jQuery: Adding conjunction where for clarification
Use https for external links wherever possible
1.0 maintenance
Documentation: Explicitly stating where to run `flask run` command for Tutorial
Docs: Fix deferredcallbacks.rst
Template not update
Docs: replace MongoKit by MongoEngine on docs
Fix #2961：ignore colon followed by slash when split app_import_path
Cache return values to avoid repeated function calls.
Flask doens't run when APP is specified with full path
Deep copy of request in copy_current_request_context function?
Tutorial coverage section needs update
Bug in the Tutorial Testing - Resolved
Fix #2943: Allow bytesio partial content
saving session raises an exception from itsdangerous
add 3 dot
Pin versions to avoid major updates of dependencies
Fix #2952: Pin itsdangerous to below v1
New itsdangerous version invalidates cookie based sessions
Serial port give access denied when running flask in debug
Questions: why do we need if __name__ == '__main__'?
Documentation "Testing Flask Applications" should show client teardown
@app.errorhandler scope too wide
Review Flask-MailboxValidator extension for listing
the app start run error
Query hive from flask
Docs: add warning about custom commands with Click v7.x turning underscores to dashes
Trouble with function send_file and range
Allow positional arguments to @login_required decorator in tutorial
Testing API with 1.0.2: <Response streamed [404 NOT FOUND]>
Fixed typo in app.py
Fix #2937: Ensure the consistency in load_dotenv's return type
flask redirect failed
load_dotenv returns true even if no file exists
Fix #2935: Copy current session object in copy_current_request_context
copy_current_request_context copies old session object
Fix issue #2933: Make sure the attachment filename is text type.
flask.send_file can't handle some attachment_filename with unicode characters
unable to import module InUniKeeper
Click==7.0 incompatibles with Flask 1.0.2
Tutorial: Stop swallowing all OSErrors when creating the instance folder
experimental readthedocs build
Fix #2926 `Default port overrides requesting a system assigned port`
'301' is not a recognized HTTP error code
Default port overrides requesting a system assigned port
Very repeatable timeout issue
Broken link in deployment docs
Timestamps fillup documentation shown by `pydoc3 flask`
Add default returns for Request wrapper class properties
Fix issue #2900: not use app_context context manager while accessing configuration
Docs: fix some typos in config.rst
Docs: fix some errors in errorhandling.rst
Make script output into comments to not break syntax highlighting
fix @click.command example by adding parens
Reduce unnecessary function calls.
Install CONTRIBUTING.rst with MANIFEST.in
Update Sphinx conf for recent theme changes
Flaskr tutorial: auth.py raise a type error: tuple indices must be integers not str
fix issue: no theme named 'flask' found
Double slashed urls are routed erroneously 
[Tutorial] Pytest don't find flaskr package
Remove MongoKit page from "Patterns for Flask" docs section
Flask `test_client` could not find endpoints registred from namesapces
Mocking functions contained in blueprints
add badges to README
when flask request code use multiprocessing, request maybe deadlock.
Infinite load
Pip inclusion of simplejson mysteriously breaks custom json encoder
avoid creating a new app context when using json argument in test client
EXPORT FLASK_APP dont load config in app
Fix #2897 - Add `extra_files` option to `flask run` CLI
Define reloader extra_files in `flask run` CLI 
Spyder not showing output 
To much logic in view url generation
Chained exceptions should be logged properly
Environment variables in .env file not refreshing after re-running application
doc reqcontext fix teardown example
request.get_json(force=True) not working as expected
Broken RTD builds/links
Improve the recommended way to use Celery
No post information from firefox form
Subdomains with dynamic domains
ImportError: cannot import name '_overlapped'
Proposal: Rename `endpoint` to `routename`
app.logger can't work
jinja2 compiled templates not working
RuntimeError: can't start new thread, Exception happened during processing of request from
Sorry for writing here, i'm, really ashamed :(
Document clearly why the flask executable is recommended over app.run()
https://flask.pocoo.org responds 400
`flask.helpers.get_root_path` returns unexpected path
Add prefix for all commands in documentation
static css media print doesn't work
Flask caching allowing unauthenticated users to see files that should be protected
Add hyperlink of contributing-testsuite in CONTRIBUTING
fix typo in request context docs
when I used flask to get POST request, it ouccured "20" Exception
Is it a viable option to use flask with Gunicorn GEVENT
Added escape
jinja2.exceptions.TemplateNotFound:
update docs for new theme
reword extension python version item
Remove old things from docs
from werkzeug.wsgi import DispatcherMiddleware
it's a answer to deploy the flaskr demo project with uWSGI and nginx, if therer's a error: unable to load app 0 (mountpoint='') (callable not found or import error)
how to deploy this demo project with uWSGI+nginx in local environment?
how to deploy this demo project with uWSGI+nginx in local environment?
get_cookie_name in SessionInterface for easier overriding in SecureCookieSessionInterface
get_cookie_name in SessionInterface for easier overriding in SecureCookieSessionInterface
Automatic 308 Redirection does not maintain schema 
Flask+tensorflow Error: The Session graph is empty.  Add operations to the graph before calling run().
send_file method is not sending an updated file
flask does not serve dict as mimetype application/json
Features Request: Remove Python 2 support and add Async
request.form is empty
Custom command for CLI does not raise import exceptions
Add feature flask.cli.with_testrequestcontext,
Flask generates loggers that may collide with package name hierarchy
Flask.send_file incorrectly sends blank files
Accidental occurrence of environ[“REQUEST_METHOD”] key error on my production server, with flask+uwsgi service mode
outdated link to snippets
Add FLASK_ENV_PATH specify dotenv to load file
DOCs: escape import needed to follow quickstart tutorial.
Pandas with flask spins multiple subprocesses 
@app.after_request not running when send_directory 304's
Filename altered after upload
Documentation for older versions of Flask is missing
Update testing.rst
Flask marshall_with many bug after change to version 1.1
register & un-register blueprints
Update logging.rst
Route Decorator redirects improperly
Fix the contibution docs
fix typo: base on -> based on
Using getlist for files is never empty?
ssl_context doesn't work after deploy to apache https
json.dumps throws TypeError 
Does flask plan to support asyncio?
Add deploying on Render link
add a note about named params for execute()
Fix typo in pop documentation
Mypy and ProxyFix
Simple 'if' use a single statement as func `templates_auto_reload` does
Add tip for startup of development server
docs: Change max content length value to megabyte
Python debugger can't find module error 
test_client.set_cookie does not seem to work
Running flask crashes Python on macOS 10.15
fixed typo in logging docstring
`flask run` in debug mode fails with `No module named C:\programs\Python37\Scripts\flask`
Flash messages not showing when route is called by ajax
Upload Image with Flask backend and SwaggerUI for API
cli: optionally silence flask startup messages when using werkzeug
Post No response  
POST NO RESPONSE
Fix github link generator for docs
Version tag mismatch in link to example projects from docs
Flask request.stream doesn't work as expected all times
Provide secure default hash function for SecureCookieSessionInterface digest_method
Fix typo in urlprocessors.rst
Dynamic Subdomain Value Unfilled
clean up outdated code
clean up outdated code
Cant Run a flask server with FLASK_ENV=development or production
documentation - patterns - larger applications - add link to explain why "Python does not want modules in packages to be the startup file"
RequestContext documentation
Change Flask request context to bypass a bug at redirection when referrer is too long. 
Add a minimal Flask application
 Add version '3.7' and a comma in "Running the test" of contributing guide.
`flask run` not using ENV variable set in code.
copy_current_request_context creates new global app context
Update outdated extension doc
Flask documentation links to a page 'Extension Registry' which redirects to the generic Flask website
DeprecationWarning: Using or importing the ABCs from 'collections' - Jinja2
 Window system how to deploy flask
Gunicorn does not support the window system, what can be used in the window system instead of the gunicorn deployment
Warning on old documentation / SEO
pass sys.argv to flask cli
Documentation: Use Python 3.5+
fixed example code in "uploading files" documentation
pycharm  No module named flask.flask    flask 1.1.0 
Custom response class (force_type static method) doesn't work
If arguments are re-written before flask is loaded it sees the original arguments on windows python 2.7
restore and deprecate json_available
Custom Response force_type is now never called
Comment out helpful tips in ISSUE_TEMPLATE so they're visible only when editing
Allow accessing CLI command name from Flask CLI app factory
Removing json_available reduces backward compatibility
Multi-level error handling support broken in ver: 1.1.0
Added table of contents to README.rst
Move dotenv warning to stderr
show warning for old logger config
'cli' is not found in my library 
Remove link to dotCloud on deployment options
Add Zappa To Flask Deploy Guides
Call out that teardown functions must never raise
Remove extmigrate from Flask repo
Remove ext migration tool from source, link to separate package
Change to Pallets project
Raise BadRequest if static file name is invalid
helpers.py - Ensure file is closed if flask opens it
static_file endpoint doesn't love null byte
Run bdist_wheel as a part of release process
update get-pip.py location
Fixed typo
Is there a way to design blueprints to incorporate DELETE?
Want to change the default server address for flask application 
Replace ';' to ','
Fixed minor typo error
Add two missing converters for flask in the docs
what mean
updated readme to markdown to increase readability
Fix minor typo in security doc
JSONEncoder and aware datetimes
Update deprecated references
Fixed stream_with_context not working when decorated function takes parameters
I want to clear the session when I close the program. What shoud I do?
pep8 fixes
auto_find_instance_path() gives inconsistent results
Use pytest.raises() instead of try/catch with assert 0
make hostname configurable
Fix for #1740
Not able to set encoding in open_resource
Add encoding type parameter to fix 'UnicodeDecodeError: cp949'
Updated year 2015 to 2016
thwart giving error 
Documentation download links for PDF and zipped HTML return 404s on http://flask.pocoo.org/
404 on Docs download url
You may want to include this example base Docker image with uWSGI and Nginx in the docs
Update MANIFEST.in with simpler template commands
Registering blueprint couldn't catch hyphen in url_prefix
jsonify does not accept strings
make safe_join behave like os.path.join with *args
Add IPython support to flask shell
Add JSONIFY_MIMETYPE configuration variable
Documentation PDF version is not available
Duplicate key in jsonify
Run Flask in Thread, user the main thread for own logic?
0.3 maintenance
DOC: Remove gendered language
Purpose readme contribution
Fix a typo
Non developer readme contribution
Flask will prevents media downloads while playing -- 
Broken document links.
nginx upstream check, but the access log is wrong.
Fix typo
Add missing return to g.setdefault
Lack of documentation on how to serve Flask under a non-root path
Documentation on Localtunnel link is invalid
Wsgi failure
terminate running port by application in case of exit process
Allow specifying blueprint-local JSON encoder 
Test Custom flask cli commands
I want to know is there a way to share data between multiple request in one application at server side?
TypeError: 'list' object is not callable
Separate Config to its own package
Reload is not active for all my running Flask instances in debug mode
Remove old version added and changed tags
Cleanup jsonify() function
Fix PEP8 issues and enforce PEP8 via pytest-pep8 (i.e. also during CI)
Is it needed to add a decorator like Flask.on_app_start ?
TypeError: object.__new__(Markup) is not safe, use unicode.__new__() in specific cases
Traceback returns KeyError: WERKZEUG
Use indexation instead of slicing for getting the first element.
Unicode with request.path & url_for('auth.index')
Remove copyright year
Built-in support for reverse proxying on a sub folder
Flask.teardown_request always passes an exception on the first request
Flask resumes upload on restart
feedback.flask.pocoo.org 404 page
get_send_file_max_age doesn't work in blueprint
Make it easier to get a response body string in python3
Some searches involving “flash” on the Flask website throws a 500 error
Remove 'flask' from etags to obscure server technologies
WERKZEUG_DEBUG_PIN
400
HTML checker complains about template
Clarified the docstring in method Flask.preprocess_request.
No output from hello world
Using SSL with Flask and eventlet
AttributeError: module 'http.client' has no attribute 'get'
Flask isn't doctestable
Werkzeug should not block propagated exceptions from Flask
Refactored method preprocess_request in Flask.
Download documentation as PDF link is broken
Refactored method Flask.make_response to improve readability
Happy New Year 2016
When using an external debugger, exceptions are not properly propagated
Update 2016 in LICENSE
Happy New Year 2016
Add support for serializing top-level arrays to JSON
Removed extra blank line to fix ReST formatted documentation string in w...
No single entry point for logging documentation.
Update docs/quickstart.rst
Option for jsonify handles dates by converting to isoformat
Changed state of Flask-Bcrypt extension
Remove triple-quotes from print statement in setup.py
use sys.getfilesystemencoding() to join paths if needed
Install docs: pip vs. easy_install consistency
Add flask.raw_context().
Problem with file uploading
Problem with file uploading
Fixed weird string quoting in setup.py
Update docs/patterns/packages.rst
Add hooks for to override url_for behavior.
Remove an unused iteration variable.
not clear how to set charset for static json
fix blohg and pidsim-web urls in powered-by list.
"Example code leaked" on all but Python 2.7
Add app.add_template_filter(…, safe=True)
Tests require simplejson on 2.5, have tox install it
Recent Werkzeug required?
No get_send_file_options on blueprints, test fail on master
Added content length to xsendfile
Debug example with run_simple and flask app.
Update docs/patterns/mongokit.rst
Add Flask-Shelve to the registry
FR: A way to pass parameters to werkzeug's DebuggedApplication
Correct and clarify error handling documentation.
docfix: wrong converter name: unicode -> string  fixes #364
Reword the docs for writing a flask extension
Add new exceptions module, to implement JSONHttpException and JSONBadRequest.
Improve foreword
Review and tweak docs on pull request #384
Specifying Python version metadata in setup
Doc grammar fix from pycon sprints.
sessions documentation (client side vs server side)
Introduced a method to adjust static file cache-control headers based on filename
Review flask-mongokit
Remove dead poweredby links
Fix issue 140
pdf version of docs has strange characters
docfix: "...to ensure beautiful and unique also unique..." -> "...to ensure beautiful and unique..."
add heroku/deploy options to quickstart, and add clearer links in tutorial setup
better docs on message flashing and error handling in quickstart
Partial content support
Allow entire blueprints to have lazy-loaded views despite using route decorators
On JSON requests, the JSON response should have Content-Type: application/json
Allow specifying request_class on a per-blueprint basis
pip/virtualenv flaskext import error
Add radio-exodus.de to the projects list
request.mimetype always empty
Fix the Github "watch" button for 4-digit watchers number.
Fixed assumption made on session implementations
Add Flask-fillin extension
Test and fix for issue #414
"silent" keyword argument only partially implemented by Config.from_envvar
Blueprint example app
Add jsonify_status_code function which allows the user to set status code on JSONified response
Remove redundant words from quickstart.
Preserve request context in the face of new requests
render_template using a list of templates
Update docs/errorhandling.rst
flask does not run in bjoern server
Update docs/patterns/wtforms.rst
Favicon request pops request context in debugger
Convert the Blueprint doc example into a runnable example.
Blueprints Example Broken in Docs
Better error/debugging page
Run example application tests in Flask test runner.
code errors at http://flask.pocoo.org/docs/testing/#testing
Collab me!
21st Century Install Instructions
Add a "ignore_mimetype" parameter to request.json
Flask-Debugtoolbar changed owners
Flask-Debugtoolbar changed owners
Document context processors' variable functions
line continuation
Hyphenate "class-based"
Review Flask-Cake extension
Added PATCH method to the list of HTTP method functions for MethodView
send_from_directory() filename
Flask documentation in ePub/Mobi format as well
documentation: minor stylistic adjustments
Gunicorn and debugging
API change proposal : inconsistency for getting parameters in a request
JSONP inside of jsonify with tests
Add option for disabling "first request decorator" (setupmethod) decorator
Set TRAP_BAD_REQUEST_ERRORS to True as the default when debugging is enabled
Consider debug=True in test client.
Cannot run flask on app engine
Update docs/api.rst a bit to reflect code.
jsonify should set the charset
little documentation error
Blueprints overwrite their templates_folder
typo fix
error in view.rst 
Review Flask-PyMongo for approval
Document Creole syntax for snippets comments
Quickstart: Unique URLs / Redirection Behaviour
Quickstart: Variable Rules Section
Allow wsgi files to specify the application instance in FLASK_APP
Multiple Blueprints mounted at same url_prefix (keyword argument to app#register_blueprint)
teardown_request can't remove session's attribute
Add nested blueprints
HTML output is missing the last few lines.
TypeError: 'ScriptInfo' object is not iterable
import error when running flask via apache
Add tip for dotenv
keep-alive by default
Backport #2359 fix for import warning when using reloader
Fix the bug of cache function in `get_json` method.
Option to change blueprints' templates precedence
Set separate Session Interface for blueprint
Add tips for 413 connection reset issue
`flask run` provides no way to have a port configured by default
blueprint_register with two different controller with subdomain but url_for use first problem
Flask test_client retaining lock on files, preventing os.remove() on Windows
Why flask do not have a cookie object as request object?
Reloader different behavior Windows vs Linux 
Documentation is wrong at https://www.palletsprojects.com/p/flask/
CSRF session Token is missing(400 Bad Request)
Use of multiprocessing in before_first_request causes first request to hang, subsequent requests succeed, only under uwsgi, not standalone
Support for multipart/mixed Content-Type?
Add documentation link in README
get_json's silent option cache None and causes weird side-effect
Docs: Add example for 'any' route converter
error in init_db()
Change PROPAGATE_EXCEPTIONS config default value to False
remove old extension docs
don't use Flask(__name__) in conftest
Flask.test_client() methods should support files argument
Broken link to flaskext_compat.py in all versions of the docs
Url path params <int: matches only unsigned int
Can not download Flask.pdf
Refactor test codes to PEP8 recommendation
Error: request.args.to_dict
flask.pocoo.org points to jinja2 docs
How to trigger a REST API based on a condition in Flask?
rewrite quickstart Unique URLs section
add test_cli_runner for testing app.cli commands
Require opt-in for subdomain matching
url_for fails to use route parameters for non-POST routes during POST requests
Fix the README to reflect locate_app() in flask/cli.py
Unique URLs and relative URLs
Reloader drops datas after tables creation
Fix docs for test_request_context
prevent double slash /a//b when blueprint prefix ends with slash
Add nl2br filter
Docs are inconsistent on what test_request_context() returns
Official Guide on how to structure Flask application
Flask run gives misleading error message on actual import error
update metadata
Remove tojson filter
bump dependency versions
Can't capture custom validator Exception
Add 'python3 -m venv' information to the mod_wsgi docs
[update] license year
Document "routes" command
Issue with sending large-ish CSV files to Flask
A setup function was called after the first request was handled
Flask does not terminate on CTRL+C
2613 avoid code repetition
Dont repeat `len(mapping)` in flask/config.py
No TLS listener with flask run
document testing cli commands
add note about syntax errors in custom scripts
allow nightly to fail on travis
2604 flask shell tab completion
Added support for cookie SameSite attribute
add HTTPS support for flask run command
FLASK_APP factory export doesn't work when invoked with parentheses and quotations but works otherwise
Flask shell: Give readline a completer that is aware of shell context
Update cli help for FLASK_ENV
Server Side Template Injection?
Internal error when requesting route with url-part == defaults
add models 
Usage of deprecated function `Request.is_xhr` in flask.jsonify
Unclear documentation on 'Request' object
pdf link broken (flask 0.12)
Fix for docs issue #2595
Documentation typo in /patterns/fileuploads.rst
add ssl_context option to `flask run`
clean up FLASK_ENV docs
reset standard os env after each test
match run command behavior in app.run
`app.run` does not match behavior of `flask run`
Tests fail when FLASK_DEBUG is set
Remove the imported app module from sys.modules on SyntaxError
Document SameSite cookie and add session support
Bump dependency versions
Generic HTTPException error handler is not called due to logic error in _find_error_handler
Only turn on the reloader on FLASK_ENV development independently of debug mode
Remove python 2.6 and 3.3 everywhere.
cleanup werkzeug import
silence ENOTDIR when loading config file
improve documentation for session attributes
implement session.new for the default session
How to set up the flask listen backlog？
Use string concat in jsonify
Body of 412 responses not sent
Initialization error under Attest
helpers.py docstring error
docstring typo
flask.views.MethodView returns the response body for HEAD
List Flask-WeasyPrint in the extension registry.
Updated docs URL for Flask-Admin
Fix for lighttpd regex
Small improvement to docs
A problem when use `app.config.from_object()`
404 error
Fixing some wording in the design documentation.
Showing how to use Flask in a virtualenv in CGI
Unable to render a template without request context
Get raw data from POST request
Subdomains in blueprints don't work
Endpoints can clash for views defined in modules
Cannot route non-ascii URLs
Reraising an HTTP exception from an error handler isn't the same as not trapping.
USE_RELOADER does not seem to work nor is documented
Added Windows documentation for mod_wsgi usage
DEBUG reloader is too agressive
Remove the unused `ScriptNameStripper.to_strip` in the FastCGI doc example
How to get value of the nested dictionary using ImmutableMultiDict?
Flask automatic stop working sometimes
a doubtful bug fix
I just write a extension for use url_for in javascript
Website
Patch 1
Clarify Cache Documentation
Fix typo in tutorial
Changed tutorial to be more explicit
Update entry in extension list about flask-testing
Fixed codename
CHANGES: July 1th should be July 1st
Add `JSON_ASCII` option to remove unneeded decoding on client side
one typo, one wrong word (please review)
Website
Mention Extensions in the Docs more
Fixes #519 by adding return statement
Fix documention for `after_this_request`
Indentation error in ScriptNameStripper in Configuring Apache section
is_resource_modified return False if etag match while last-modified < mtime
cache_timeout should be always checked not Null
flask in virtualenv: "No module named inspect"
Added link to extensions in "Hook. Extend." section.
unused argument in scripts/flaskext_compat.py
Add flask/ext directory to sys.path when it isn't there already.
Docs: Improvements in docs/deploying/CGI.rst
flask-login does not work when using static_url_path
Remove dead link to "Try Flask"
Quickstart  login example has unclear comment.
Minor refactoring
Emended extensiondev.rst
Login example broke the flow
Travis
Fix failing test: "AssertionError: 'application/javascript' != 'application/json'" in flask/testsuite/helpers.py", line 88
FAIL: test_jsonify
Review Flask-WhooshAlchemy
Review Flask-WhooshAlchemy extension
Can jsonify return array?
Changed docstring according to docs.
Context not available when combining decorators and generators
Flask-Login source link incorrect
Removed link to non existing page in "powered by" section
Cleaned "powered by" section a little.
Fixes issue 376.
Allow blueprint-local routing for errorhandlers
Fixes issue #495.
safe_join with '..'
flaskr, minitwit css style not rendering in firefox 11 
Fixes issue #491
Fixed typo in docs/quickstart
fix for https://github.com/mitsuhiko/flask/issues/494
Removed link to ep.io
padded attribute on jsonify not functioning as expected
Flask.inject_url_defaults() incorrectly splits Blueprint's name
Rectified rampant 'roule'.
Website
host_matching is in Werkzeug since 0.7 but not in Flask
Minor Doc Fix: highlight local weserver only HTTP/1.0
few typos
Add a note about coverage in README
loader.is_package is a optional method
Minor docs fix.
Review Flask-Restless for approval.
Revise updated foreword (rduplain).
Fix spelling.
Evaluate readthedocs.org for Flask.
Add a FORCE_URL_SCHEME option
:inherited-members: does not work for attributes
Removed unneeded print statements form mongokit pattern doc
return jsonify(d), 201 breaks the 'application/json' mimetype
something missing in patterns/mongokit.rst
Website
adds test to check flashed messages based on external session
add test to testsuite/helpers.py
Add Flask-Restless to extensions
Add test for flashed messages using sessions on external storage.
Fix #220: Adds a default JSONEncoder implementation to Flask.json_encoder_class
Website
multiple Set-Cookie fold in one line HTTP Header
The default static folder is being ignored if the number of params to the route are 3
about jinja2 dynamic extends
CORS requests hanging on Chrome
Flask, mod_wsgi, and Apache: ImportError mysql 
Sending POST requests with input data exceeding 10KB results in 400 Bad Request under WSGI
Error accessing static components in subfolder
Added .env support
Add support for custom console-scripts
GAE not displaying error messages for 0.12
KeyError problem 
Python - Headers not decoded properly
CSS and JS TTFB take too long in flask 0.11.1 and 0.12
flask run not work
Merge pull request #1 from pallets/master
AssertionError with webtest when returning 204
Disable debug when FLASK_DEBUG=False
Update docs that request is an object, not a class
add travis badge to readme
use SERVER_NAME to set host and port in app.run()
Fix Request Reference
Connection refused for flask redis session
Use SOURCE_DATE_EPOCH for copyright year to make build reproducible
Added python3.6 support for tests
add missing quotes for dict key in views.rst
Added python 3.6
AttributeError: 'module' object has no attribute 'TCPServer'
Allow default Errorhandler for HTTPException
Unable to infer MIME-type because no filename is available.
Website still lists 0.11 as the latest release even though 0.12 is release
Remove extra HTML tag from fileupload docs
？？？
Flask 0.12 incompatible with Google App Engine?
Fix fastcgi lighttpd example documentation.
How to sovle the error:KeyError: 'socketio'`
Added missing html tag in wtforms docs
Inherit Werkzeug docs
Document change in Request.form behaviour with Werkzeug 0.9
prevent NoAppException when ImportError occurs within imported module
Flask documentation inconsistent with implementation for form parsing
Add larger app ex
Add a largeapp example under flask/examples
How to setup this website?
Socketserver problem in Python 3.6
Why doesn't flask reload when I change my code? It should automatically reload my app
Update Flask-SQLAlchemy link
debugging PIN is not being displayed, no request info displayed
code icon show other
Fix config.from_pyfile on Python 3
Make flaskr.py command line friendlier
cant set session timeout, tried many permutations and asked in irc and stack. to no avail.
Style the flask command consistently
Update README for minitwit
config.from_pyfile crashes on Python 3 when source isn't encoded in default encoding
Added missing testing config
Remove wrong comma
Feature/ascii
Template File will not download file (window.open command in HTML) when run from flask
`flask run` not processing SERVER_NAME for port binding
ImportError: No module named minitwit
Add url_for_self() function to reference current endpoint
Doubt in flask session.py save_session method
app.run(host, port) and SERVER_NAME should correspond to where flask is actually running
Using absolute path in FLASK_APP can't run `flask db init` cli module error
API exception pattern docs do not mention PROPAGATE_EXCEPTIONS
Invalid Host header returns HTTP/500 insetad of HTTP/400
Warn when cookie domain is set to an IP
Happy new year 2016
fix unclosed p tag
Validate Flaskr HTML
Authenticating with NTLM
Header issue with many body request (put, post, etc)
Problems with unicode
add rails style model
Fix typo: star => start
@app.teardown_appcontext fires before request finishes.
added blank line before def
added whitespace before key
use dict instead of if/else logic
Add routes command to flask cli
small refactoring of  is_json function.
remove redundant parameter
Ignore cache on request.get_json(cache=False) call
Add link to AWS EB Flask tutorial
Do not use cache when `Request.get_json(cache=False)` is called.
large file uploads eating up memory
Fix rST rendering of env var
Multiple filters in a single qurery
Application did not run with `flask run` with FLASK_DEBUG=1(But can run by using command`python -m flask run`) in Win10
Error handler support for generic HttpException
Added a link to instructions for PythonAnywhere
switch to packaged sphinx theme
Flask doesn't require blinker
Adding documentation on best practices for Server-sent events and WebSockets
Mention existence of register_error_handler in errorpages.rst
FIX py.test import error
Fix LogRecord class reference
Update errorhandling.rst for readability
Parameterizing test
Remove busy-work.
flask issue
Update docs on larger applications WRT tutorial
fix little grammar detail in flaskr/db.py
amend and edit
Fix grammatical error
update description for database.rst become more understandable
📚 Improve docs about ScriptInfo
Flask reloader problems in development mode using Docker
Solve the redirect problem 
request.full_path shouldn't contain a trailing ? if there was none in the URL
DispatcherMiddleware with different loggers per app in flask 1.0
How to change url before route?
add option timeout for redirect
UnsupportedOperation: not writable utils.py, line 259, in echo  file.write(message)
fix #2824 output more versions related flask
[docs] Fix broken Sphinx cross-references; use :doc: tags where necessary
Use of dotenv causes flask cli to fail.
update README.rst / "docs/tutorial/index.rst"
Remove check against deprecated property is_xhr
Jsonify always returns datetime objects as GMT timezone
An end-to-end workflow: Token based authorization using Flask and rest API.
use ipython when `flask shell`
Update docs to be more clear about from config instantiation
@property for configuration objects?
Examples wiki?
Update Copyright Date to 2018
Fix grammatical error: incorrect verb conjugation
Refactor __init__.py imports
:art: Use `itervalues` instead of `iteritems` when `key` is not necessary
http://127.0.0.1:5000/post/0 not working 
The file name called ‘frozenAccount’  may be shielded
Add `status` kwarg into jsonify()
Update mod_wsgi.rst
:art: Use set literal instead of set method in file uploading example
:fire: Remove code supposed to be removed at v1.0
Flask 1.0: global exception handler handles not found now?
Add Dreamhost deploy doc
Typo in docs
Logging example fails outside request context
Update docs - add command for listing rules.
request points to wrong object in debugger when threading is enabled
Fix pep8 no blank line issue
Remove unnecessary period in documentation
Documentation for testing need to be updated
Add `JSON_STRICT` config option
First example in "Testing Flask Applications" doc fails
Cannot fork Flask repository
Bad import in flash_cache/jinja2ext.py
Update cli tips for .flaskenv
[Fixed 2823] Checking if .env is file before prompting to install dotenv
add init-db call to flask tutorial
Fixes issue #2824 flask --version
flask --version should output werkzeug version
Flask complains a .env file exists when not using python-dotenv, even though that .env is a directory
Flask jsonify is not working. It removes keys from json response.
Exceptions in before_request methods prevent later before_request methods from running
Inconsistent behavior of `static_url_path`
Traceback not flushed immediately 
Render_Template failes after using multithreaded .pyd file
Importing from PWD using `python -m` fails in development environment
No upgrade notes for flask 1.x
Tutorial fails with error
UnicodeDecodeError when rendering template
Allow flexible routing with SERVER_NAME config
Flask start new thread - RuntimeError: Working outside of request context
Add test for routes command when no routes registered
Missing `Content-Disposition` leads to empty `requests.form`
test_url_generation_with_parameter added
fix typos in appcontext.rst
Test added for _AppCtxGlobals __repr__ method
Set uwsgi link to use :ref:
Uwsgi link
encode filenames as ascii instead of latin-1
flask.redirect fails on audio file upload.
Broken link on flask docs
AttributeError: 'FileWrapper' due to click
[0.12.2] Weird error when using custom response object
set FLASK_APP via env for portability across shells
International URLs Implementation
Update cli.py
Session cookie secure by default
Update CHANGES.rst
Python flask threads does not close
Update gevent wsgi documentation
Fix typos in CHANGES.rst
Addition of Click breaks Flask apps in some deployments
Blueprint view function name should not contain dots
AttributeError: 'module' object has no attribute 'SSLContext'
Log level being ignored and example in docs broken
Added parameter to click.echo call
[Docs] Make super() compatible for Python2
Issues run flask tutorial
Add Blueprint level cli registration-- #1357
2778 processes inappropriate exceptions
Adding documentation about precautions about custom error handlers fo…
route app.run through the cli whenever possible
Blueprint error handling with url_prefix and lang_code
TypeErrorTypeError: set_cookie() got an unexpected keyword argument 'samesite'
Registered error handler (using register_error_handler) processes inappropriate exceptions
fix broken sys.argv list
Rewrite deployment docs
BUG in "send_file" and "send_from_directory"
function flash() not working with redirect()
Randomly Unresponsive After Strange Character Requests
run linux command in flask app
Port testsuite to py.test
Adds 2 tests for Flask.run method
Added full_path to the Request object documentation.
typo: "weather" -> "whether"
Fix warnings and code styling in the doc
Don't mention Flask dev releases anymore
Homepage: Wrong PDF and zipped HTML Link
Document building protocol-relative URLs
Add Click to Readme
Add missing `of` to documentation.
`pip install flask==dev` does not work.
consider adding CC-BY license for documentation only
Rewrite docs for context locals, request contexts, and app contexts
"after_response"?
Documention for "The Application Context" is confusing
typos
pdf&epub of docs has wrong version
Flaskr example app hooked up with some Selenium tests running on Sauce Labs and Travis CI
dev version; click subcommands not working as intended
Add app config setting for defaulting _external to True in url_for
Flask needs more opinions on config and deployment
Add documentation about url_for's default scheme
Thread in flask but 2 threads are created instead of one
Fix copy paste mistake in docs/testing.rst
Use PREFERRED_URL_SCHEME in external url_for if scheme is not defined.
Can we make use of the Milestones features of GitHub to have at least an indication of how far we are from the next release?
Wrong Flask.instance_path inside virtualenv
Quoted all HTML attributes.
Quoted all HTML attributes
test
Deprecate flask.ext and create migration tool to flask_*
Quote all HTML attributes
custom rendering view not possible anymore
Update doclinks
How to share endpoints between different apps in Flask
Automatic route redirect changes domain to 127.0.0.1:port
url_for _external does not use PREFERRED_URL_SCHEME
Jinja template docs link is outdated
Keep development out of master
Flask ignore FLASK_STATIC_FOLDER setted outside of constructor.
Add testing best practices and others to wiki
CLI: "flask" command help doesn't list custom commands
Provide examples extending the custom script in cli docs
fixed typo -- missing "are" in docs/signals.rst
Bad link
Fix Doc
from_json document fix
Context processor decorator design
Fix some typos
Update index.html
"Error handling request" with Gunicorn and gevent worker
Race condition in get_flashed_messages()
How to have flask.jsonify take Decimals?
Update python3.rst
Update index.rst with link to source of stable release
Stop recommending Python 2.6
adding application context setup funcs.
Feedback website not working.
adding application context setup funcs.
Weird error with "Flask" in setup_requires.
Fix typo in cli docs
Links to Werkzeug  and Jinja in Document are wrong 
appcontext_setting_up_funcs and signal
Let's kill run
Python 3 docs are quite outdated
The example does not execute
Update schema.rst
Flask Badges 
Update dbinit.rst
Update dbcon.rst
jsonify big numbers
Issue with deferred callbacks pattern when an exception occurs in a @teardown_request decorated function
Add runtime parameter functionality to url_for
Issue with module path/name in imported classes when using from...import on flask.ext.* (Python 3)
relative url_for with a blueprint mounted two times
Update mod_wsgi.rst
Update mod_wsgi.rst
Update installation.rst
Wrong link to Jinja2 website in docs webpage
Fixed typo in _compat.py
use flask.ext instead of flask_
Testing render_template()
Publish 0.10 documentation
Flask eliminates error and stack trace when production mode.
Support X-Sendfile-Temporary
flask redirect not support itms-services
Get rid of _tag->closure->_tag reference cycle
app.cli.command
Update mod_wsgi.rst
terminal no longer echos input after pdb is aborted by reloader
add `Table` to import in `sqlalchemy.rst` example
docs: add import to SQLAlchemy example
Python Flask Gevent stack - Simple “Hello World” app shows as inefficient when benchmarked
incomplete formatted string expression
cannot read static file whose path include Chinese chars under Windows OS
documentation: stylistic adjustments
unused code in app.logger ?
support for HTTP/1.1 Transfer-Encoding: chunked
Added proper </li> closing element.
Correct order of arguments in example in docs
Invalid name of converter in API docs
Review Flask-Bcrypt for approval
Flask HTML form arrays are mangled
send_file uses 2x file's size in memory with conditional = True
Review Flask-SeaSurf extension
Class based view decorators
More examples/documentation for pluggable view decorators
flask_autoindex fails with flask 0.8.0 but works with 0.7.0
FTBFS with python-werkzeug-0.6.2-1.el6.noarch
Added a small project starting script
Update documentation of url_for to indicate more clearly that substitution token values are required (maybe an example?)
MethodViews for API example is missing parameter
Review flask-lettuce extension
session is saved before @after_request callbacks
Endless redirect loop in flask 0.7.2
Simple documentation cleanups
Static files only work for blueprints registered with url_prefix
Session information is not kept around in test_client after redirect
Added option to generate secure URL with url_for()
Fix issue #338
flask memory consumption
Additions to Working with Other Debuggers section 
Config documentation "instance_root" -> "instance_path"
In Flask.run, when the host/port argument is None, it will now use its default value.
Just a little comment clarification
Broken setup.py (SyntaxError:invalid syntax)
TypeError in "Method Views for APIs"
Updated docs - for Response class status_code => status
Allow category filtering in get_flashed_messages to allow rending categories in separate html blocks
Added Note to use PNG instead of ICO since support of ICO seems to "die"
Typo fix
Added PasswordField in docs/patterns/wtforms.rst
Flask.template_test()
static file would not send to browser correctly 
fixed typo, quote "with" statement
Better support for error_handler register without decorator
Review Flask-Peewee for listing, then approval.
Add to sys.path, not sys.path_info
Move Some Context Preservation Logic into App
Rewritten audit command in setup.py and some "touches" for docstrings
Blueprint.app_url_value_preprocessor doesn't work correctly.
SERVER_NAME set to 127.0.0.1:5000 in dev breaks flash method
Fixed typo in docstring of dispatch_request method of flask.views.View
create_global_jinja_loader has outdated docstring
Flask-MongoKit to GitHub
http request methods decorators for routing
Review Flask-ZODB for approval
Review Flask-Sijax for approval.
Review Flask-Exceptional for approval.
'Float' converter in route not working
Add search to website for snippets and mailing list archives.
Example @login_required decorator confusing
use extended dict as app config
Fix for d5cd4f8 which broke install on Windows 
Switch to primitive types in the config
Fix session loading in flask.testing.TestClient.session_transaction()
Typo in documentation
route decorators custom enpoints
make Cookie Path configurable
option to turn off Jinja2
Improve configuration docs a bit
typo
Added closing tag
Add flash_error and get_flashed_errors
Fixed part of issue #290.
make_release.py won't work for August dates
Flask website license
Fix typos
Added decorators
Added some very small changes
Traceback logs not available for POST requests
Add runserver.py filename to match earlier section of example
Allow passing additional `send_file` options to `app.send_static_file`
before_request functions not run before every request
request.json is documented twice
Blueprints and Extensions and SQLAlchemy
Consistent quotes
Setting multiple headers is not(?) supported in response
AttributeError: type object 'EventsCodes' has no attribute 'IN_DELETE_SELF'
Document the debug param for Flask.run, it is not part of **options given
Intersphinx link fixes.
Provide a built-in development server command-line interface.
Minor documentation grammar / typo fixes
Typo: developped -> developed
Bugfixing docs/patterns/fileuploads.rst
route / add_url_rule Documentation
Typos in flask.app.Flask docstrings/comments
Don't use deprecated flask.session in flask.ctx.
Corrected decorators to remove duplicate teardown_request() and add after
typo fix: flask -> flag
fixed typo
fixed typo
Blueprint template filters.
small error in tutorial
Blueprints and URL processors
Adding coverage generation to tox
Update docstring for errorhandler()
Development
Fixes import statement in flaskr
Capitalize occurrences of 'flask'
Process responses generated by exceptions
Cloning flask fails with Git config transfer.fsckobjects = true; repository broken?
why loop redirect with redirect('{0}/{1}'.format(site, page_name), code=301)?
grammar fix
add_resource does not preserve api function docstring
Correct grammar
View.dispatch_request doesn't take args, raises error about that instead of not implemented error
Fix safe_join test behavior on Windows
The file/path provided (flaskr) does not appear to exist. 
add 'caution' section to docs, workaround for zero-padded file modes
Installation documentation for Windows: minor typo
Updated Celery pattern
flask CLOEXEC
Add possible overriding of builtin cli cmds
Address #2051: Fix flaskr import in flaskr/__init__.py
flaskr project (in dev docs and on github) needs to use relative import in __init__.py for Python 3
Many 'requests.post' generates internal ImportError
Cannot run many 'requests.post' against 'app.py'
Binary file corrupted between the server and the client
Default environ
Remove `-a/--app` from Quickstart documentation
A: hello!Flask how to solve this problem
MethodView requires settings "methods" attribute
Assert should not be used outside of testing
Question: Authenticating to a protected API call not working (GAE Flask connecting to ParseServer)
Flask Extension that doesn't require user code changes
fix unclosed HTML tags
Fix unbound error
Updated mod_wsgi.rst to point to new mod_wsgi repo
do you have Extensions for VScode ?
Feature packt book in docs
Modified test_instance_config.py (test_main_module_paths) to reflect flask behavior
Update minitwit.py
failing test for safe_join in windows
time.sleep() swallow FLASH_DEBUG message
make use of range requests if available in werkzeug
Support same-site cookies
Zero-padded file modes in repository 
Fix typo in MethodView doc
Update app factory docs for Flask's CLI
Removed unused import.
removed a nonsensical line
Add license_file to setup.cfg metadata
How should logging in Flask look like?
Fix typo in docs
Address #1980
Default flask.cli commands are not override-able
Do not cause errors for unknown files for sendfile
Fix fileuploads manual page redirect URL
Add scheme to url_build error handler parameters
request.args uncompatible with quote, which lead decode error
fixed deprecated syntax in setup.cfg
Fixed error in errorhandler doc string.
Corrected after response for error handlers
Permission to generate stubs for Flask in typeshed
Broken pipe
changing ip address to string for localhost
Document not updated after the removal of argument -a and --app
AttributeError: 'str' object has no attribute 'write' during unhandled exception logging
Prevent setting `SERVER_NAME` and `SESSION_COOKIE_DOMAIN` to an IP address
Don't passthrough_errors unless instructed.
AttributeError: 'DispatchingApp' object has no attribute 'config'
Correcting Custom Test Client class docs
Fix error in send_file helper
Clean up tutorial docs for installable app pattern with flaskr
Fix small grammar error in Documentation (Of/Or)
Better workflow for flaskr and other basic apps
Proposal : splitting the config logic into a different package.
Spelling
gunicorn and flask to work together...
Only passthrough_errors if PROPAGATE_EXCEPTIONS
No response and No exception traceback when render_template failed and DEBUG=True
dictsort filter fails on nested_dict typed list
Disable logger propagation by default
access app.config via dot
ExtDeprecationWarning pymongo 
Use the Celery result backend setting from the example
Disable OS-level autocorrect in the interactive debugger
Properly remove f.name usage in send_file
Update testing.rst
Setting items on `response.header` with bytestrings results in new headers in Python 3
Update testing.rst
JSON request/response mixin
Session no longer being marked as "modified" in some situations
examples/flaskr test error
Fix line 31 for conformity with PEP-8
"Larger Applications" docs don't play nicely with flask run
flask run does not respect debug config in config files
docs: sqlalchemy pattern document has an invalid import
Set __qualname__ on class-based view function
Use path of socket consistently accross document.
Examples in uWSGI docs are not using the same socket.
POST to Flask has size limit, and provokes "BrokenPipeError: [Errno 32] Broken pipe" whenever no request.data is called
Update for python3
%-encoded / gets included in wrong <path:...> parameter
Reconfigure app when debug is set by run command
JSONEncoder encodes aware datetime objects in non-UTC timezone incorrectly as being in GMT.
document `Flask.register_blueprint` arguments
Add docutils label for class-based views
Add docutils label for templates page
Discussion: from_envvar's behavior
removes a duplicate word docstring for class Flask
Add basic how-to on using envvars for config
mention csp for javascript: uri xss
document inherited attributes for Flask and Blueprint
Remove error handler cache
Include flask.json package in setup()
Fixed several PEP8 errors
Be smarter about adding ".cli" to reloader command
JSON support for test client and Response
python -m flask run raises RuntimeWarning
doc: following web standards
Wrong release version
Only open session if request does not have open session
Clarify documentation for json parsing
Make session serializer extensible
How to set connection read timeout and support flask run in multi-thread mode?
show nice message when registering error handler for unknown code
Adding Couchdb views from blueprint
make debugging bad key errors easier
deprecate app session methods in favor of session_interface
use existing response.vary property to set vary header
Use existing response.vary property to set vary header
APPLICATION_ROOT defaults to '/'
update development resources
#2341: Accept default argument value when args lenght equal 1
If FLASK_APP accept one argument and I do not send it, the default value is not correct, instead I get a ScriptInfo object.
Reduce ci matrix
investigate build stages on travis
cleanup #2326
flask mutable session (with flask-session RedisSessionInterface)
Switch theme to Alabaster
reduce the number of build targets in the travis matrix
Docs sidebar missing space
Fixed typo in docs
PyCharm Run Configuration Guide
Reduce test envs, add coverage reports, other test fixups
Minor edits to tutorial for clarity.
Document how to write a config.py that loads config from the environment
How Can I Make Pagination In Flask??
Docs theme not responsive
Handle app factory with arguments in FLASK_APP
More DRYing up the test suite
Fix for Issue 2313 - refactoring gevent tests into class
Cleanup test_blueprint.py to use test fixtures
Don't overwrite Vary header when setting for cookie access
Add test for Blueprint app-wide url processing
Update click dependency info.
Support `create_app` without script_info or with script_info as named argument
Fix a small oversight in the testing docs
Don't overwrite Vary header when setting for cookie access
Adds provide_automatic_options to Class-based Views
Added documentation for PowerShell environment variables
Added support for generic HTTPException handlers on app and blueprints
Organize the gevent tests into a single class
Replace `modules_tmpdir` fixture with pytest's built-in `tmpdir` fixture
Use the yield syntax in pytest's fixtures
Fix refactoring error in static_folder docstring
Add http headers security notes 
Support for unregistering blueprints (or endpoints).
For Issue #2286: Update unittest references
DRYing up the test suite using pytest fixtures
Updating contributing rst
Added support for generic HTTPException handlers on app and blueprints
Added tests for make_response and get_debug_flag to improve coverage of helpers.py
Added uWSGI and example usage to stand-alone WSGI containers documentation
Add coverage for Blueprint request process methods
Moved WSGI Standalone first in deployment documentation
Add coverage for Blueprint.add_app_template_global
Add coverage for Blueprints.(app_)context_processor
Auto-detect create_app() in find_best_app() #2265
Added reference and link to Werkzeug debugger documentation
Add coverage for Blueprint.app_errorhandler
Auto-detect create_app() in find_best_app() #2265
Debug mode 2261
Investigate adding app and debug args back into the CLI
log a clickable url to home page when listening 0.0.0.0, more beginne…
can i preserve my json output ?
Please tag a release
Set "Vary: Cookie" header when session is accessed
DRY up the test suite using pytest fixtures
Rewrite the testing docs
Review HTTP security
safe_join on Windows uses posixpath
Flask development server segmentation fault on Alpine Linux
Refactor session cookie domain
Document how to set env vars for PowerShell
Cannot add headers to static files
Clean up deferred callback doc
Rewrite installation docs
Improve quickstart's Routing section
Removed unused import
Fix import order to accommodate pocoo style
server has 127 CLOSE_WAIT 
request.input_stream inconsistency btw debug and normal mode
Pins Werkzeug to 0.16.1 due to breaking change
New version of Werkzeug is not compatible with Flask
Got Vulnerability while feeding request.get_json() data to marshmallow directly .
Python flask wont run
Update on line 203
Potential backward incompatibilities brought by the werkzeug v1.0.0 update
Greedy version requirement for werkzeug breaking fresh installs
Incorrect grammar
A better expression for the intended meaning
This is a typo.
how make something like this
Import error from scipy package: pfft 
Project is abandoned?
[Feature Request] Proxy Rewrite Support in url_for
Add missing import for escape in doc
Intersphinx error when building documentation
In section Variable Rules and before, did not mentioned escape should be imported until we can see on URL Building
Incorrect template name in error string
Cannot set SameSite=None on session cookie
TypeError: after_request() takes 0 positional arguments but 1 was given 
Merge pull request #1 from pallets/master
session unavailable, an issue of tutorial.
SERVER_NAME still implicitly changes routing behavior
Werkzeug base_response.py doesn't support Flasks response.set_cookie
Flask celery broker(rabbitmq cluster) failover not working
Remove comment about extensions being reviewed by the core team
Merge pull request #1 from pallets/master
static_folder and static_url_path can be different
AttributeError: 'function' object has no attribute 'name' when blueprint is a function
Fix app.run() when port is not specified and `SERVER_NAME` contains only host name
app.run() doesn't work when port is not specified in `SERVER_NAME`
Fix a bug that the static endpoint will unexpectedly catch all
Flask run command breaking with werkzeug.wrappers
flask.request cannot be patched by unittest.mock.patch in Python 3.8
fix docstring and remove redundant parentheses
Catch-all route doesn't work when static_folder ends in forwardslash
unable to add headers to test_request_context 
Feature request: Access jinja environment options for render_template
Unexpected argument: PyCharm set_cookie samesite
ClientDisconnected error when trying to look up request.data after an exception inside the Werkzeug debugger
Flask crashes when running as a Windows Service (pywin32)
 How to use Sqlalchemy in factories
Suggestion: Improve traceback for routes that return None
challenge load_dotenv and chdir assumption
Files with \xfa (ú) in the filename don't end up in request.files
confusing logging behavior in Blueprints when running test  
“Last-Modified” header gone missing when receiving in the client end from the Python Flask Rest API for 304 HTTP Response
simplify the way we get subdomain and url_prefix at blueprints
Shorter forms for url_for("static", ...)
Updated Issue Template
unable to trigger flask view function using href inside a tag inside select
send_file doesn't allow StringIO
lazy load app on reload only
flask reading .txt files line by line
Document lazy loading and eager loading (fixes #3430)
Only lazy load on reload
eager loading is not documented
Static file with UTF-8 characters can not be served from ubuntu 18.04 with UTF-8 system encoding.
Grammatical error
Update old pocoo links everywhere
Fix: update a URL to the newest version
Update `versionadded` for `Config.from_file`
Request fail on parsing json body with accent character
set cache-control: private when session is used
Getting KeyError: 'REQUEST_METHOD' sometimes
Update documentation to reflect change in Gunicorn 20
Test failures with Python 3.8
Issue 3358 fix
Can't parse bson Object
Can't parse bson object 
Registered URL not found
minor update to converter sample code
Fix typo in documentation
Add `async` support
UnicodeDecodeError: 'utf8' codec can't decode byte 0xab in position 103: invalid start byte
[BUG FIX] Test test_send_from_directory_bad_request fails in Python 3.8.
In PyTest, response.location is None
Make the documentation build reproducibly
add send_from_filepath
Change docs to use f-strings
Add support for decorating MethodViews with @Blueprint.route()
route decorator on MethodView classes
Test test_send_from_directory_bad_request fails in Python 3.8
Declare support for Python 3.8
How to define a custom command (CLI) with an application factory
Runtime generated blueprint code
Support loading configuration from text files
update readme.md
Unable to extend FlaskClient with follow_redirects
Update reqcontext.rst
Change celery to app in documentation
Flask after_request still execute
[QUESTION] Does flask support other templating engine
explain escape at top of quickstart
no hize nada
Cannot raise HTTPException()
Browser doesn't show error message in tutorial
Can not be connected on local area network on macOS 10.15 (Catalina)
Support loading configuration from toml files
flask db init error
Doc fix
Flask-7.0 uses with statement without import in helpers.py (Python2.5 incompatible)
Missed the -w option in uWSGI deployment docs. 
Blueprint template lookup not documented enough
Issue #255: with statement in helpers.py and appengine compatibility fix.
with_statement & appengine compatibility
Add a link to pluggable views docs in the changelog.
Typo fix in code samples for Pluggable Views doc.
Support for Class Based Views
Wrong Enctype Warnings
Fix a link in the changelog.
Make Tests for bluprints with dotted Names
Pronoun gender fixes in documentation
url_for still reference module
editorial touch-ups to docs
Documentation Updates for 0.7
Reports of sessions not working when SERVER_NAME set with port
Added HTTPBin to Apps List
handle_exception doesn't catch everything.
Deploying with Fabric fabfile bugfix
jQuery Documentation Update
Review JSON Security
don't spread JSON FUD
Split up Testsuite
flask.__version__
Minor documentation fix
fixed minor typo
As discussed with rduplain in IRC channel, uwsgi deployment documentation for nginx
Tutorial Step 4 : teardown code sample is not well formated
How to include custom Jinja extensions?
added an argument to jsonify : status code
Clarify in docs that the SERVER_NAME config can also take a port number.
A fix for send_file with unicode filenames.
Add Frozen-Flask to the extension registry
website's twitter.py script requires optional keywords
logging improperly extending directly from Logger class
Prevent runtime error wrt json formdata
Fixes Issue #227 where pop causes the session to be modified.
pip install flask==dev resulting in svn warning
the import order note was meant to be bold, not cursive
don't save session if nothing to save
Corrections to fabfile example
get_flashed_messages() always forces session.should_save
Static files in non-url_prefixed modules don't work.
Application Dispatching > Combining Applications documentation is incorrect
Docs should mention that url_for() skips query string args with value=None
sys.excepthook error
WTFForms: Error Handling for Forms in Templates
Subclassing of Flask should be documented
Custom default function for jsonify
before_request versus HTTP exceptions
Small fix in the docs for deploying behind a proxy
Allow Header: appends an erroneous GET
flask has no programmatically-accessible version number
Add safe_join: returns the filename used by send_from_directory.
Untitled
Updating app.after_request decorator documentation.
Module.after_app_request causes exception (0.6.1)
template and static directory names are hard-coded
Starting the application
url_for does not list HOST:PORT on ".static" entries
Testing, Request Contexts, Extensions and Documentation
Can we simplify Config.from_pyfile?
Issue 198 doc fix
PackageName==dev is required
Extensions docs modifications.
Initial attempt at fixing task 174
silent flag for config.from_pyfile
Extension docs
Wording issues on testing doc page
DispatcherMiddleware and application creating documentation
Config.from_envvar should be able to fail silent
Extension Reviewing
Fix crossref links in docs
Typo fixes for the sprint start.
Open the session after the request context is pushed on the stack
Wording change to the documentation
log exceptions using app.logger
Update the readme
Should link to Werkzeug’s docs prominently
{{ url_for('static', filename='style.css') }} is not working in Python 2.7.1
Please review Flask-FlatPages and Flask-Static
Issue 178 - website fixes
Issue 178
Issue 178
runserver.py was missing from directory listing
Document Auth&Auth
"Nothing is rendered"
Discouraging Foreword in Documentation
Documentation not properly cross referenced
mod_wsgi Deployment Chapter is incomplete
Flask Bugtracker is not obvious
Tutorial should mention deployment with mod_wsgi or something else
Example Application too Basic
Error Handlers versus Werkzeug Exceptions
after_request behavior regarding exceptions
Documentation needs to explain Circular Dependencies Better
Module is a bad name / Bad behavior
Reverse Relative/Absolute Linking for url_for
jsonify doesn't accept a list
Use Werkzeug's JSONMixin class (moved from Flask) and update tests
docs/quickstart.rst - Adding URL Building details and moving it
Fix MethodView inheritance Error (#3138)
Create CODE_OF_CONDUCT.md
docs/quickstart.rst - Adding URL Building details and moving it
Allow "rt" mode for open_resource
fix RST line too long
Allow mode='rt' on open_resource() helper
Add link to official Discord chat server
add test output and a run against Python RC
enhance!
Set up Azure Pipelines
Fix dev-server warning message readability (#3168)
Improve warning about dev server use in production
FactoryBoy data not created using json POST request
removed unused reference to url_join
Unused url_join?
How can I send a post Api from Flask server to Laravel server?
open_resource() does not allow mode='rt'
Update documentation on gunicorn deployment and app discovery
flask.testing uses extraneous app_context for json client requests
No auth keyword arg in the test client for Basic HTTP Auth 
Improved CONTRIBUTING.rst
raise exception instead of using abort()
Fix teardown bug in FlaskClient
update Jinja2 requirement to >=2.10.1 (re CVE-2019-10906)
Bump Jinja2 requirements
More explicit explanation: session testing
cannot run my flask application in conda
tox/pytest: support posargs, move to testpaths
test_instance_config.py fails
[Doc] Fix typo in code example for route defaults
use redirect for uwsgi
Unable to send POST request using Flask test client
Add Dockerfile for flaskr example
Incompatible with JSON
Cannot visit demo web page
Flask throwing AssertionError: View function mapping is overwriting an existing endpoint function: register
I am not an expert, but I want to solve this error: AssertionError: View function mapping is overwriting an existing endpoint function: register
Replaced deprecated sample code in proxy-setup docs
RuntimeError: Attempted to use a closed Session. with flask
Status code on flask.wrappers.Response is incorrect
Deprecated code in proxy-setups document
MethodView methods not inherited
Update CONTRIBUTING.rst discord link + style info
changed / import to ( )
Flask + gevent: possible sockets leaks (in the CLOSE_WAIT state)
static_url_path doesn't work if it ends with a slash
App run with debug mode raise OSError
Need help with getting the SID of the first connection
can't run app with latest Werkzeug
Cannot differentiate between a regular text input field and a non-uploaded file
Fix some HTML injection paths in examples
Fix grammar in docs
Werkzeug 0.15 breaks logging in and out example in testing docs
Import error in dev mode, not with wsgi virtualhost (virtualenv and vagrant)
Use Werkzeug's JSON mixin
fix 'static_url_path' defaulting for empty paths
Response header filename dynamic value
Basic example with Flask -routing does not work 
Update README.rst for beginners
遇到一些pipenv 安装问题
hello can i use the cassandra nosql database in my flask application?
Fix code snippet in config.rst for env vars Fixes #3117
Docs/Config.rst - Configuring From Environment Variables has an invalid code snippet
DeprecationWarning: python 3.8 will not work
flask run command won't run python files with .wsgi extension (or any other than .py)
flask process block twisted 
doc: Improve description for valid view func return value
fix an error in quickstart doc
Allow dictionaries return values as JSON
Testing with TestClient and a custom response_class calls constructor twice
Added closing li tags
config option for "flask run" (e.g. --dotenv/-e)
Due of database access : "Truncated or oversized response headers received from daemon process..."
Please adds init-db in readme
Allow passing cert and key to `flask run` via env var / .flaskenv
moving match_request to RequestContext.push to enable ModelConverter
Fix typos in the documentation
Fix formatting issue in quickstart guide
Little improve on installation doc
Using Flask as a back end system for reviews?
The flask interface does not print request information,Return data directly
The flask interface does not print request information,Return data directly
helpers.py: Fix docs of url_for(..., _external=True)
"flask run" should accept a command line option for FLASK_APP
SOAP requests cause 500's in Flask code
custom error handler not being called for HTTP error 412 
Flask-Angular issue for Uploading file through api call
Flask-Angular issue for Uploading file through api call
Truncated or oversized response headers received from daemon process
"Lift" Flask (et al.) on Tidelift
URL Converters should have access to app context
banner statements not directed to log when app starts
Autoredirect
not able to serve html file with all the css and js linked in flask
Unable to remap dll to same address as parent on cygwin when running in debug mode
Jsonify does not take allow_nan
_compat.py: Use feature detection instead of version detection
What can I do to translate flask documentation to Russian language?
Warn about logging name change
use app.name as app.logger name
Make the changelog UTF-8 compatible
Fixes #3277
CHANGES.rst on master is not UTF-8 -- appares to be some windows encoding
Fixes for PEP451 import loaders and pytest 5.x
[tutorial] flaskr's pytest does not pass due to test_db.py#test_get_close_db fail.
Add closing tags to example's nav bar
flask requires `is_package` from import loaders, however this api is optional since PEP 451
Fix typo
send_file quotes ":/" in UTF-8 filename
don't clear BadRequestKeyError args
Blueprints with url_prefix responding in HTTP 308
update project metadata
use dashes for command names
Flask object Issue: Assertation error on python 2.7.14 in Werkzeug 0.15.4
Use a working example to generate secret_key
always pass InternalServerError instance to 500 handler
flask and escpos
path converter is not matching 
FlaskGroup does not work when nested in a click.group
import urlparse breaks app.cli.command
fix tests failing with server name warnings
adds api error handling example to documentation
flask.ext.mongoalchemy import MongoAlchemy is not changed to flask_mongoalchemy import MongoAlchemy
Question: How to generate coverage report?
File upload code fixed
flask run is not compatible with werkzeug middlewares
Refactored explain_template_loading_attempts method
Refactoring explain_template_loading_attempts method in debughelpers.py
Added :param to the _get_exc_class_and_code method docstring
Should _get_exc_class_and_code method have param entry for the docstring?
ImportError goes away after restart
Can't access localhost using flask
BadRequestKeyError no longer contains the missing key from self.form as of 1.0.3
Added :param to the Blueprint concstructor docstring
fix string concats left over by black
apply reorder-python-imports pre-commit config
move to src directory
Clarify documentation about how url_for uses configuration values (#2759)
Guard against missing request context in logging docs.
"#3211: Don't require ssl module"
Add pre-commit config for flake8
Fix testing documentation to demonstrate using test client with teardown
Comment on bare except usage in _compat.py
Removed unused Class import.
Move python properties to decorator syntax
Do not register empty CLI groups from Blueprint
Better error message when view return type is not supported
#3225: document "del tb"
Issue #3226: Remove unused werkzeug datastructure import
Convert make_test_environ_builder into class (fixes #3207)
Add pre-commit install-hooks to first-time setup
Enable stylecheck tox run on Azure pipelines (fixes #3228)
Fix style issues on master using Black
Meta: run tox -e stylecheck on Azure Pipeline
suspicious unexplained `except: raise`
unused import: werkzeug.datastructures:Range
suspicious/unexplained `del <local_variable>` in last line of function
Blueprint CLIs should not register empty groups
AttributeError: 'NoneType' object has no attribute 'append' in Flask helpers.py
Multiprocess cause AttributeError in windows10
Updated property object to decorator
How to change the body of redirection responses since Flask 1.0.3?
url_for produces relative links with nontrivial APPLICATION_ROOT
Use @property as a decorator
Document Blueprint parameters
Identify the common API between Flask and Blueprint classes
Better error message when view return type is not supported
Add pre-commit to dev dependencies, document it and Black in CONTRIBUTING
Don't require ssl module
a problem with route
Flask with dotenv change the current working directory if .env file is found
FakeSignal should stub connect_via method
Convert make_test_environ_builder into EnvironBuilder subclass
don't push app context for test client json
Add keyword argument support to app factory function signature
azure pipelines ci on 1.0.x branch
add Azure Pipelines to test coverage
insert deliberate bug into flask.cli:main
Changelog button on documentation does not work on Stable
Remove unused url_join of blueprints.py - 1.0 maintenance
Fix various small spelling errors.
Adding closing list tags in code example within the Docs - 'templates.rst' file
Allow selecting a different shell for the "flask shell" command
Fix misplaced paren in docs
Support dataclass in JSONEncoder (if available)
Flask can't find the app name when the project is added to Atom
Flask Session variable not available in threads
Update __init__.py
replace "otherwise" with "or" to complete the "either" statement in templates doc
Make jinja_options a dict rather than ImmutaleDict
"OSError: [Errno 8] Exec format error" when execute bit is set
headers vanish inside app.before_request when trying to use them 
Catch-all route does not work if url has another handler even if method is different
Replace IRC with Discord in CONTRIBUTING file
Simplify flask.cli.main
Upload test results for Azure Pipelines
Pre-commit: Black
Remove ending slash from static_url_path
logout and factoring cookie problem
imports now together
Any reason to keep g as a property on RequestContext?
Added multi-line imports to app.py file
Add Qovery option to deploy Flask
use Jinja's tojson filter
Update for recent changes in Pallets libraries
[pre-commit.ci] pre-commit autoupdate
Bump pre-commit from 2.9.3 to 2.10.0
Bump greenlet from 0.4.17 to 1.0.0
Bump sphinx-tabs from 1.3.0 to 2.0.0
Bump pytest from 6.2.1 to 6.2.2
Bump sphinx from 3.4.1 to 3.4.3
Bump packaging from 20.8 to 20.9
Bump jinja2 from 2.11.2 to 2.11.3
Bump tox from 3.20.1 to 3.21.3
Debug mode auto-reloader causes Uncaught Exception
Doc update: Clarify got_request_exception signal docs
Views & Routing `methods` input throwing TypeError for tuples
Flask silently overrides Jinja2 tojson filter
Docs update: clarify json error handling
Reload the flask dynamic blueprint by using the @app.route('/reload')
Testing docs example for setting 'g' seems incorrect
Improve some code comments
Increase the point in the comment.
Increase the point in the comment
flask doesn't return http error 413 if file too large
Falsk url redirect with Masking
If using a .env file with Docker, the Flask CLI still tells you to install python-dotenv
Flask's Celery docs are going to start failing with Celery 6 and get deprecation warnings with 5.x today
Leading forward slashes are stripped from path variable
"Request" object has no attribute "is_xhr"
Update views.rst: fix the routes sample code
Update the example in README
Update documentation for easy quickstarts
Requiring endpoints to have a __dict__
The Issues about recv-Q
Document parameter description error
Silence pytest warnings for exception propagation test
Bump packaging from 20.4 to 20.8
Bump pytest from 6.1.2 to 6.2.1
Bump pip-tools from 5.3.1 to 5.5.0
Bump pre-commit from 2.8.2 to 2.9.3
Bump sphinx from 3.2.1 to 3.4.1
[pre-commit.ci] pre-commit autoupdate
postman cant post mp4 file
Flask session cookie secure flag is not getting set. 
raising HTTPException does not cause got_request_exception signal to be emitted
Add link to reference docs in README
Flask master requires Werkzeug master
fix explanation of wheel name
How clear AWS S3 Bucket ClientError in Flask API server? 
PUT route requires a body to work
SESSION_COOKIE_SAMESITE not woking
Update cli.rst, repeated word "that" in line 258
before_request handler in Methodview class
[pre-commit.ci] pre-commit autoupdate
Flask,doesn't redirect page
How to verify a flask web app in the google search console
Explain Allowed_file() func in Uploading file on web via FLASK
session.pop do not actually remove anything
flask.abort() documentation broken
Fix ci environment command syntax
Update deprecated set-env ci command
[pre-commit.ci] pre-commit autoupdate
Web site / documentation: Should tell what Flask *is*
Error during startup
Error during startup
Op2020
flask run error
move send_file and send_from_directory to Werkzeug
update tests for new Werkzeug client
Running a simple Flask app will not work because an older run is cached somehow.
Separate docs page on debug mode
adding an assertion to catch a mistake I made
update requirements
Bump sphinx-tabs from 1.1.13 to 1.3.0
Bump pre-commit from 2.7.1 to 2.8.2
Bump python-dotenv from 0.14.0 to 0.15.0
Bump tox from 3.20.0 to 3.20.1
Bump pytest from 6.1.1 to 6.1.2
Whether flask dev server by default really works single process?
Updating external_url_handler example to Python 3
Error when trying to start flask app from command line
JSONEncoder: Add test for objects with __html__ method
Added link to deploying on Divio how-to guide
Add separate and more detailed issue templates
create hello world added file
Flaskform import not working, no matter what I do.
docs: mkstemp returns a file descriptor and a path
Use list in methods instead of tuple
Clarify it is talking about HTML tags
Link SQL injection to python sqlite3 library doc
cli.load_dotenv: when path provided and python-dotenv not found, extra message
fix html in example 404/500 templates
Can't get page over browsers
[Minor changes] Update documentation by removing outdated information
I think it's a deadly bug in the Flask module.
werkzeug/test.py modifies headers passed to Client.post
Small fixes and improvements
Implement RFC 7233
FLASK_APP variable isn't behaving as specified.
Yield don't work on Chrome
from flask import current_app appears to have side effects
Remove unused Redbaron dependency
flask app bundle with py2exe issue (AttributeError: function 'PyObject_GetBuffer' not found)
Added a missing module to import statement
Logbook integration?
isolate templates between blueprints
failing tests
Improve the layout example
Document the rest arguments of abort function
Not working on AWS Windows instance?
May flask support live settings like django-constance
May flask support live settings like django-constance
Update allowed_file function in fileuploads.rst
Flask Test Client fails to get on subdomains with explicit port 80
Update minitwit & improve testing for examples
Update minitwit & improve testing for examples
Flask-paginate shows all results on same page
close <li> tag in lines (16,18)
adding in try around __import__ to catch invalid files/paths
CLI fails during create database in Flaskr tutorial
Documentation for Flask + mod_wsgi + pyvenv + Python 3 doesn't work
Persona example - deprecated
Added 127.0.0.0/8 to the session cookie 'localhost' exception.
Address #1902: Converts example/flaskr to have a setup.py
Address #1902: Converts example/flaskr to have a setup.py
{{ }} has trouble with method calls and array indexes in single call
clarify blueprint 404 error handling in docs
Flask fails to reload upon Traceback
Added a property is_body_json
Check for empty request data prior to loading JSON, fix for #1933
`flask run` allows no way to run server on a unix socket
FLASK_APP should be set to [app].py, not just [app]
Add the ability to combine MethodViews
blueprint error handler not working??
Helper method send_file not closing file handle.
JSON Parsing on empty request content with RequestParser
fix docs: name of url_value_preprocessor method
dialogue box?
Merge pull request #1 from mitsuhiko/master
TypeError when trying to parse request with int data
re-add passthrough_errors to cli runner
Removed easy_install method from installation docs
Unhelpful Error Message on FLASK_APP to Bad Path
Converts example/flaskr to have a setup.py
Next/Back Buttons in Documentation
TaggedJSONSerializer encodes Python 2 strings as bytes
HTTPMethodOverrideMiddleware docs example doesnt work with latest version
'be' was omitted
Update installation documentation for using 'pip' command
Remove easy_install from installation docs
Update documentation for upgrading Flask using 'pip' command
wtforms: Add missing closing tags
Document option to use simplejson
Use pip in upgrade documentation instead of easy_install
 Fix problems with examples and CLI #1902
Fix #1911
Revert "Addressing Issue 1809"
Wrong import json library
Enable template auto-reloading in app.run()
fix pypy3-3.3 alpha usage
TaggedJSONSerializer does not preserve int keys in dicts
Jinja templates do not auto reload if Flask app debug enabled solely via app.run(debug=True)
SessionInterface shouldn't hard code a fix for localhost when it comes to cookies
Documentation with minor incorrection?!?
Can't reload code on Python 3, Win 10, latest version of flask
AttributeError: 'module' object has no attribute 'exc_clear'
Import error with some examples
Google App Engine ImportError: No module named msvcrt
Demonstrate how to add multiple urls to the same function endpoint #981
test_client post cannot handle JSON list
Per blueprint jsoncoding #1710
Missing import on Flask 0.11.1
Added make target for test coverage, simplified contributing doc
Blueprint static content only works when response.direct_passthrough is False
Test Python 3.5
Travis 3.3-devel job fails with error about urllib2 in Werkzeug
Updating url in errorhandling.rst to a valid link
Fix spelling
Clarify wording in App Context documentation.
Test side effect
sessions documentation (client side vs server side) #434
enumerates the states in which code is executed...
Enhance code coverage for Blueprint.endpoint
Improve test coverage of flask.json
Add test for get_version (CLI)
Expanding contribution documentation
Enhance tests.test_cli.test_find_best_app
Add test for find_default_import_path
Link to contributing.rst from the main Flask docs
test_main_module_paths fails on RHEL and Ubuntu when using Amazon EC2
Use recwarn everywhere
jsonify no longer causes Content-Length to be set on returned Response object
Add negative test for json.jsonify
Add a link to Extension Development
Comment out old version added and changed tags. Fix #1704
Using `setup.cfg` with fabric
Clitest update
cannot call app.run() from custom cli command
Hi, I just translate readme.rst to Korean
Remove now obsolete 'audit' command from Makefile
make audit still available, whereas the corresponding setup command is gone
"flask init-db" isn't working
can't run flask demo direct with F5 (idle) after upgrade to flask1.0?
Merge pull request #1 from pallets/master
Remove test
Traceback shown when running `flask` without any args or an app
[Regression] Test client's response.status_code is always 500 when an exception is raised
send_file: latin-1 encoding not compatible with gunicorn
Add option to not overwrite debug flag in cli
docs: installation: Fix "now you can continue" link
Request files are left in memory
url_for() breaks just before POSTing to a specific endpoint
Proper Using Blueprint (prefixed with lang_code) URLs in Html
send_file bug
Flask in subpath doesn't work as expected
run "flask init-db" first before executing "flask run"
functions added by after_request execute in reversed order
templates_auto_reload workaround
templates_auto_reload not taken into account
Fixed LaTeX errors on documentation PDF generation
1.0 release codename
Check whether there are registered routes
`flask routes` crashes if there is no route available
Broken links on pypi
Inline variable
Fix blueprint route for ""
add missing port to localhost URL
allow empty prefix and no lead slash in bp route
Update quickstart.rst
Issue loading images when threading is enabled
Documentation search broken
Flask 1.0 backwards incompatible root url_prefix
Better exception handling when env vars are missing for flask CLI
Adding Windows PowerShell specfic docs
Only trap key errors by default in debug, not all BadRequest errors
merge slashes between blueprint prefix and rule
fix #2736 - remove explicit check for list as a return value in make_response
make_response changes breaks custom response class
flask.abort() behavioral change in debug mode
Running pytest on flask 1.0 (ModuleNotFoundError: No module named 'flask.json.tag'; 'flask.json' is not a package)
Fixed Debug default value in the docs
support for " url_for('api.book', book_id='${bookId}') "
Flask 1.0 backwards-incompat with double-slash/no-slash re. #2629
Fix registering partials as view functions
Added short note about Werkzeug redirect behaviour
Wrong wheel for Flask 0.12.3 in PyPI
error on file upload document
New tuple requirement for response is restrictive
[help] flask 1.0 app run in click 
Use env var to disable loading dotenv
Where are all the issues?
Add a parameter to disable load dotenv using Flask CLI
Add `python_requires` metadata for PyPI
Add project_urls so that PyPI will show GitHub stats.
Fix typo in docs
Why can not load a sklearn model by the request for Flask
Add LICENSE in README
Port Issue
E-commerce
Flask website has broken links
Support for more environment variables for Flask CLI
Typo in fileuploads guide?
Minor session serializer fixes.
backport #2709 use theme provided by pallets-sphinx-themes
use theme provided by pallets-sphinx-themes
flask.flash() not working
Add a message `Serving Flask app (module "app.py" will be lazily loaded)` to `flask run` related to #2706
Different app discovery behavior on commands run and shell 
os.stat(path) TypeError: stat() argument 1 must be encoded string without null bytes, not str 
Cannot change default formatter
Error: Failed to find application in module "flaskr".  Are you sure it contains a Flask application?  Maybe you wrapped it in a WSGI middleware or you are using a factory function.
Ability to check if client connection is still open
Flask Python Login w/LDAP Auth
TypeError: is not JSON serializable
add javascript ajax example
Flask logging issue with gunicorn 
use builtin total_seconds of timedelta object
Tutorial: Use different names for top-level directory, subdirectory, and .py file rather than using "flaskr" for all three
backport #2691 detect UTF encodings when loading json
backport #2359 fix python -m import warning
add Response.max_cookie_size config
Backport #2691 detect JSON encoding
detect UTF encodings when loading json
MAX_CONTENT_LENGTH is not respected
How to install this module in ironpython?
PEP484 static typing support
Suggest: support post json.dumps with unicode.
document blueprint static folder without prefix
rework context docs
[New Feature] Flask init utility
Merge pull request #1 from pallets/master
I want to send a json from the front end and update it to the postgresql DB with that data.
How to return also json and render_template in Flask?
Hooks in session_interface
Incorrect endpoint name in fileuploads doc
AssertionError on app.test_client().session_transaction()
rewrite tutorial docs and example
Error: The file/path provided (server) does not appear to exist.  Please verify the path is correct. 
nvm
Link to PDF version of docs on website is broken
[ImgBot] optimizes images
url_for uses _request_ctx for its choice of default_methods, this seems wrong
helpers.send_file doesn't close file
Add additional information in the url_rule docs
Flask Custom jinja2 extension caching template states after new request
Mention Flask instead of Jinja in the issue template
flask hang up during debug mode enabled
parse cli command's args with the application context
Missing module Markupsafe on "flask run"
Command to set FLASK_APP variable in flask/examples/flasker README is not compatible with released version of Flask(0.12.2)
Apps importing grequests crash when a restart/reload is attempted
jsonify() silently strips timezone from datetime objects
Float converter does not match number values lacking a decimal
Update App Engine link
The request method to another website in views function didn't run correctly
The link for downloadable PDF documentation is not working
Changes documentation screenshots for a more recent UI
Cannot login with Google provider
Feature request : Highlight 'user code' in traceback interpreter output
Dynamically appending templates one after another
Blueprint view function name should not contain dots
Flask Python3 ?
Changing SESSION_COOKIE_NAME invalidates session cookies earlier than permanent_session_lifetime
Fix typos and formatting
replace @pytest.yield_fixture by @pytest.fixture
Add version warning to Flaskr tutorial
While streaming back long responses, Flask loses encodings or alters the stream
Casting the value received from the Web Server in the request object …
corrected indentations for pypi description
web: URL to PDF on home doesn't work
Suggestion : decorated blueprints
Add clean command to flask cli
Adds support DEBUG variable from config.
The example flaskr can't easily be run by a beginner in Flask framework
Simplify logging
Execute/debug flask CLI from IDE
Idiomatic way to stop pylint complaining about flask route unused function names?
Suggestion for jsonify
Distribute documentation mis-formatted
TCP port 5000 blocked by corporate firewalls
make_test_environ_builder: use url_scheme from path if provided
Tagging builds section in docs have misleading information
Werid behaviour of BuildError
Flask mangles traceback for Syntax Errors
PDF version of docs unavailable
give context about purpose of this section, #2421
The reloader fails on SyntaxError when using a custom cli entry point
Reloader fails to reload after SyntaxError when the app is in an __init__.py file
Add more information to doc regarding PERMANENT_SESSION_LIFETIME config.
Tutorial: step 3 (Installing as package) needs rationale
Typeo in readme for flaskr example
Fixed typo in documentation
[0.11.x] Remove outdated text on flask.ext redirect package
[0.12.x] Remove outdated text on flask.ext redirect package
Add .env support
404 error when using debug=True
FLASK_APP doesn't require .py extension for local packages
Flaskr example code RuntimeError
support passing environ to test client
TestClient: EnvironBuilder cannot be passed in
Flask CLI doesn't support application context in argument callbacks
Clarify docs and tests for exception handling in Flask.teardown_appcontext()
Suggestions for Tutorial
Integrate flask log messages to Gunicorn log files
The exception of installing 
Custom JSON encoder doesn't work for dictionary keys
datetime json encoding is one sided: Fix for JSONDecoder is needed
Remove unused import from test_basic.
render_template_string() recompiles the template every time
formatting of setup.cfg code snippet
setup.cfg code snippet not formatted correctly
clean up secret key docs
fix variable substitution in error message
Un-deprecate Request.json
Remove old 0.7 upgrade script
Remove deprecated flask.ext
Remove deprecated code
Remove deprecated code from app.py
jsonify response converts datetime object into string with GMT regardless of objects tzinfo.
Flask fails silently when it does not have permission to SSL cert/key files
Bad interaction between flask.json.load() and werkzeug LimitedStream
Flaskr fails being run from cli
pdf link on home page is broken
Flask app doesn't run when importing Python-Markdown module
Add command to CLI to generate secure random strings
Remove deprecated code
Problem with partial video content: send_from_directory() + x-sendfile + mod_wsgi
Don't require FLASK_APP to have .py extension
FLASK_APP var is not being parsed correctly for paths, imports system and third party modules.
removed bug in memory sqlite uri
Maybe view function names should not be used as default endpoints
Odd behavior with send_from_directory
Import app from wsgi.py or app.py if FLASK_APP is not defined
flask command should not require .py extension
flask command should auto-detect module
Add .env support, take 2
Correctly JSON-encode datetimes aware of non-UTC timezones
How to catch the whole request lifetime in Flask
Flask re-raise exception that already been processed.
JSONEncoder support for datetime.date and datetime.time serialization
Documentation .mobi file not found
Fixed a typo.
PREFERRED_URL_SCHEME behavior question
Ambiguity in Advanced Foreword
Small grammar fixes and re-wording.
Doc for add check upload file
fix for Blueprint view with same name will be override
Blueprint view with same name will be override
flask-uploads
Fixed a small typo with flask.g docstring
Fixes #1051
Allow the jinja2 environment class to be overridden.
Fix a tiny spelling error: untilization -> utilization
fix a small mistake in setup.rst
fix syntax of wtf html example.
fixed import for python 3
Docs: cli.rst typos
Docs: fixes
Set DEBUG and TESTING config value to default to None, not False.
cannot run example flaskr
testsuite status, 0.10.; FAILED (failures=3, errors=2)
unittest loader discover throwing "AssertionError: View function mapping is overwriting an existing endpoint function"
static content mime-type always text/plain
Cannot run `flask` from command line
Why isn't there `Blueprint.after_last_app_request`?
404 .mobi format of the Documentation
Feature: override defaults from a config file
Fixed typo.
Fix a docstring type in cli.py.
security hazard in app.route decorator ordering
Documentation - link to Jinja website
Website Badges
Updating extension guidelines
Add etag and last-modified helpers to improve cachability
admin notification when rate limit is reached
few mispelling errors
Serving static files from root static folder rather than blueprint's static folder
Fix typos in docstrings and comments in run.py
Updating Jinja2 and Werkzeug URLs.
Log template errors to stdout when debugging.
Flask authentication
Append `Vary: Cookies` header to response when session is accessed
Calling post method in loop yields unexpected results
Flask performance issue
About flask docs translations
Fix minor typo
Change testsuite to be compatible with py.test and nose
Odd error while running run-tests.py under coverage.py
fix typo
Clarified that the code is meant to be saved as a file called hello.py.
Protect against python 3.4 pkgutil change
Flash category constants
Add flask-bouncer to extension registry
Fix when release date is not today
Adding jinja2 environment variables as a keyword arg in the flask constr...
missed word.
Python 3.4 changed `pkgutil.get_loader` behavior
Tweaks to docs/patterns/viewdecorators.rst
Ajax render selected complete EmbeddedDocument
The Flask Mailinglist page is out of date
Flask can't read multipart form boundaries from custom HTTP clients
Set app.jinja_env.undefined to something better when debug = True
Using encodings other than UTF-8 in Response
Small punctuation change in unicode doc
Add env RUN_FLASK_MEMORY_TESTS to travis.yml
Allow using |tojson in double-quoted HTML attributes again
Please document PyCharm support
harmless comment fixes/typos
send_file in combination with chrome on android
SERVER_NAME configuration should not implicitly change routing behavior.
Clarify the after_request argument
Tutorial Typo: tutorial/views/#tutorial-views  -- add_entry() 
Update send_file() docstring - file name required
Added 'import os' statement
Attempted implicit sequence conversion but the response object is in direct passthrough mode
Pass keyword args from `test_client` method to client class constructor
Fix broken tutorial code
Review Flask-User extension for listing, and approval
Typo in fastcgi docs
Parent task (with debug=True) doesn't properly kill children
Add edit_entry and delete_entry to flaskr
Remove or downplay Tornado recommendation
Add not_modified shortcut
Teardown functions sometimes receive spurious exceptions from Gunicorn
Can't customize url_for external links without causing 404 errors
Add required import os for tutorial
Cannot lazily load views in 0.10.1
Update docs copyright date
Add an "import os" to tutorial
autoescape false doesn't work as expected
Update windows installation and other notes
"import os" statement missing from tutorial
Update copyright year in license
jsonify() ignores the sort order of an OrderedDict
Test client unicode bug
Explicitly pass the Celery instance name.
Debug output only show error line in own scripts possible?
update README to markdown
babel can't extract text from template with "with" statement
adding `_scheme` parameter to `url_for`
The mailing list for Flask hosted on librelist is not accepting any questions.
Update docs/patterns/deferredcallbacks.rst
problem with example in deferred callbacks documentation
Double '/' in URLs causes static content not to load?
AppEngine environments: Flask ExtensionImporter class (flask.ext) is getting in the way when flask extensions import external modules 
@app.teardown_request function doesn't called in debug mode [NOT-A-BUG]
WSGI specification has finalized for Python 3
"flaskext.mail" documentation
The problem with _micro_ frameworks is a lack of structure
Add template_global decorator
Dont show tweets with the same text tweeted by different users
SQLite doesn't recognize data type "string"
Fixing my own pull request #647
docs/extensiondev: Use `current_app` instead of `self.app`
Add troubleshooting sphinx tip
Cannot start Flask application in a thread other than main
wiki: Large app how to, incompete and not runnable
Fix a typo in the deferred-callbacks docs.
Problem with non-escaped chars in URL.
Added hint about print statements in CGI.
Please improve CGI documentation slightly.
Missing linebreaks on homepage
user could customs non-OK entry body
Change readme file to use the reStructuredText format
Flaskr tests - 3 errors
Design issue with flask.logger.create_logger().
Use stevedore to load extensions
Get HTTP_REFERER in flask
Added Facebook group link.
Flask not sending 304 Not Modified even if last_modified<=if_modified_since.
Ended your paragraph tag.
Replace obsolete website reference with successor
correcting typo
send_file breaks when flask app run as nobody
session_transaction does not setup request
Add config parser to blueprints
Fix #623
Use current_app in Flask_SQLite3 example
Benchmarking fails with 3 requests
Support Python 3 using 2to3 - passes tests with py25-27,py32,pypy
correcting typo
 Use sqlite3.Row factory in Flaskr (#588)
missing ' in templating example
missing text in url_for() app context RuntimeError message
Review Flask-S3
Local extensions fail to import
Documentation on IIS deployment.
Fix missing argument in find_module of flaskext_compat.py
Issue #524 was not one and flaskext_compat does not work anymore
jQuery example: submit on enter, focus field on load, ajax to callback function, " to '.
FR: Make stream_template from the docs available in Flask
UnicodeDecodeError when passing session to simplejson dumps
Minor fix to views.py testsuite.
Fix #611
blueprint options from register_blueprint
Minor typo in Tutorial, but possibly confusing
[BUG]TypeError: 'JsonObject' object is not callable
docs/deploying/wsgi-standalone: Add Twisted Web.
Putting extension in flask.ext: the import loader in ext/__init__.py raises unnecessary error
Update docs/quickstart.rst
LazyView, why not include it in Flask?
Regarding JSON inside <script> tag and HTML5 parser
make_test_environ_builder was not working correctly with subdomains
Fixed typo occours to occurs
Misspelling in docs @ flask.Flask.handle_exception
Getting raw POST data for whatever mimetype
cannot run testsuite on Windows
Use `env` for virtualenv in docs
Fixes typo
Add @template_test() decorator for creating custom jinja2 tests.  Fixes #332
sdist from master creates "devdev" version.
sdist from master creates "devdev" version.
Update flask/templating.py
Nestable blueprints
Incorrect Pluggable Views documentation?
fixed some typos
Fixed small error in SQLAlchemy patterns documentation
pyinstaller + flask
sqlite dict cursors
Python 3 port is available
Session workaround in case cookie is disabled
Multiple URL rules pointing to lambdas in the same scope do not work
Handling of vendor trees and parameters in MIME Media Types
fixed issue #524
Implement support for X-HTTP-Method-Override in flask.views.MethodView.
Corrected some minor errors in comments
POST with accidental tuple is very difficult to debug
Fix code example in pluggable views documentation
fixed Issue #507
Added _ to fix link to extensions in Hook. Extend.
Fix the appcontext_tearing_down example in docs
Import flask.appcontext_tearing_down at top-level
Updated information about flask-admin
Debugging mode is not propagate to mounted apps (DispatcherMiddleware)
INFO don't get logged for custom logger handle
Doc improvements for url_for()
Warn or raise when overriding an endpoint
Unexpected Hello word
Add missing import on SQLAlchemy documentation page
Deploying Flask on AWS linked in QuickStart?
Fixed import (would lead into an import error)
InstanceTestCase tests fail when run by a non-standard user
Update docs on Approved Extensions
Make the decorators attribute on View a tuple by default
Fix typo.
Minor test fixes
Disable modules by default
debug=True triggers SyntaxError: can't assign to operator
Add a non-decorator version of the error handler register function
Patch for tutorial (minor code error)
Exception when trying to run Flask app via CGIHandler
typo in quickstart.rst 
Typo in documentation for FastCGI
SSL Issue
"no such table" with sqlite3
installation.rst typo
Adding Flask-Misaka to the extensions page
Multiple request headers with same name
make app.config callable
Merge pull request #1 from mitsuhiko/master
Merge pull request #1 from mitsuhiko/master
Splitting flask.Flask logic into multiple "mixins"
change the url_prefix attribute of the blueprint to the real used url_prefix
Fix typo
corrected documentation for Request get_json()
Fixed when release date is not today, The fails have no args.
Documentation MOBI for Download is outdated
Fix typo in docstring
Check error handlers for classes before HTTP status codes
get_cookie_path: fix docstring
Flask-0.10.1 test failures
Tutorial stores passwords in plaintext
jsonify a Decimal
How to get the serialized version of the session cookie in 0.10?
mod_wsgi docuementation
URLSafeTimedSerializer may be vulnerable to a CRIME or BREACH style attack in some implemtations?
Fixed tiny but distracting typo.
Update blueprints.rst - Add Error Handlers
Making redirecting safe / Deprecating redirects to 3rd party hosts
itsdangerous dependency missing LICENSE file
Add ability to configure app with a JSON file
Reloader changes sys.path
Incomplete mod_wsgi documentation
url_for(*args, _external=True) doesn't add the port to the full url
fixed quote problem in init_db code snippet
Feature request. Regex in url rules
Support mapping multiple subdomains to a single blueprint
app.py: Link to correct EnvironBuilder docs
Changed sort_json test to test str sorting
In the Flaskr Exemple - Change '/ tmp / flaskr.db' to 'flaskr.db'
Fix doc bug in patterns/sqlite3, clarify use of make_dicts
Fix #815
methods argument of Flask.route should be validated at import time
Fix a typo
Correct typo: FastCgiServer should be FastCgiExternalServer when using a standalone FCGI server (Gunicorn, etc.)
flash(my_message) raised 'is not JSON serializable' when Flask 0.9 migrate to 0.10 
Remove Werkzeug bug workaround from flask/app.py
Running flask with unbuffered stdout exits upon reload
add test case to reproduce the bug for #798
Fix #782 -- /tmp/ in tutorial
Fix #783 -- config in tutorial
Update example for Apache FCGI config to use worker processes
Run an applicaton with another server
Instructions for configuring FastCGI under Apache are incorrect
can not correctly handle the POST param with "_" underscore
Acquire SSL client certificate from development server
Given absolute URL, testclient discards query params
cleared up confusion for from_envvar in docs
api.rst: fix some spelling/typos
Fix set cookie every request
Can't find requet.form or requesrt.values items with post request for flask 0.10.1
Compatibility problems between 0.9 - 0.10?
route to view_func with same decorators
Pluggable Method Views broken by fix for #570
How to use the multi url_prefix with same Blueprint?
Static files url_for bug with Windows-like file path.
os.system in a own thread blocks the REST request if Response is a generator
Fixed json.jsonify
Adjust documentation on testing to reflect changes to ``flask.g``
json.py use bson.json_util
changed werkzeug.serving.run_simple to werkzeug.run_simple in app.run do...
Missing `s` in a plural word
No way create url with `url_for` to another host
quickstart guide - wording changes for clarity
flaskr tutorial suggestion: Omit or isolate the text about "from_envvar"
Flaskr tutorial suggestion - Use DATABASE='flaskr' instead of DATABASE='/tmp/flaskr'
test_appcontext_signals() fails with blinker installed
test_json_key_sorting() fails with simplejson installed
Doc suggestion: In QuickStart 10.1 define "Reversing" before using it
repr(request) is broken if the query string or url contains non-ascii characters
infinite processes with multiprocessing and app.run(debug=True)
Fix typo
Add Flask.config_class attribute
Add a way to give feedback from the command line.
url_for + redirect does not respect http vs https
Flask 0.10.x and Werkzeug 0.9.x encoding issue
url_to does not correctly url encode params
[Future] Option to get decoded urls in log
Collapse old changelog directives
after_request func called too early for streaming responses
Flaskr application problem
Catch-all errorhandler does not catch BadRequestKeyError
Flask error handler caching leads to inconsistent behavior
Support create_app that doesn't take ScriptInfo as first argument
Detect `create_app` when FLASK_APP doesn't specify app object
Handle app factory in FLASK_APP
"Cookie header" munge bad and good cookies together
Py36 json support added
Documentation: Term "development mode" is unclear
Flask does not detect route collisions between blueprints and app
Add routes command
Clean up preprocess_request docs
QueueHandler logging does not work behind uwsgi
refactor make_response to be easier to follow
Generating relative url with app context should not require SERVER_NAME
Ensure error while opening session pops context
Flask installation issue
Continue #1936: Add the ability to combine MethodViews
Class-based View should set provide_automatic_options attr in as_view
circular import error with flask cli is misleading
Continue #1489: Add kwarg to disable auto OPTIONS on add_url_rule 
Fixes typo in app.py
0.12 maintenance
CLI silences ImportError
file input request filepath.
Remove empty XML tag.
Take advantage of Py3.6 json support for bytes
get mtime in utc
Documentation on Larger Applications could reference Blueprints (0.12.1)
update send_file cache control timeout=-1 no-cache
Bind to IPv6 and IPv4 simultanously (Dual Stack operation)
filename can be latin-1, not just ascii
spelling fix
Bug in url_for() function when you run a Flask application through CGI
Import error while config the app
Add example for virtualenv integration in cli docs
Does Flask support regular expressions in its subdomain
FLASK_DEBUG=1 causes ModuleNotFoundError: No module named 'flask' 
Update out of date jsonify documentation
Correct imports in file upload example
Chunked uploads missing body data.
Add blueprint and the app factory pattern into the flaskr example
flask.pocoo.org not updated with latest release (0.12.1)
Enable TRAP_BAD_REQUEST_ERRORS when in debug mode
Debugging during bootstrapping
Per blueprint errorhandlers.
Fix send_file's attachment_filename to work with non-ascii filenames
Handle BaseExceptions
Flask treats SystemExit and other BaseExceptions as indicating success
app.run(port='5000', debug=True) error
Spruce-up the README to a Markdown version with logo
Werkzeug 0.12.0 changed how abort works
shorten output when ImportError due to app bug.
EOFError during GET request due to broken session file.
Support for dict-like arguments in request.args
Flask blames FLASK_APP on all ImportErrors
Issue #2212: documentation: virtualenv and python3
Documentation: Installing and virtual environment under python3
Fix static route when using host_matching = True
Clarify APPLICATION_ROOT documentation
Print a stacktrace on CLI error (closes #2208)
Do not swallow exceptions if CLI fails to load
Edit debug mode attention for new version Werkzeug
Missing headers on CSV file
Connection reset when posting data
Python 3 syntax error in Quickstart docs
[docstring] Documenting host SERVER_NAME config
Fix broken link in the docs 
docs: Fix typos/grammar
Can't start in debug mode.
Close <li> tag in lines (16,18) (#1951)
Add instructions for running Flask with PyCharm
Allow error handler to pass on decision to subsequent handlers
Add tips for debug config with flask cli
Windows Server - Gevent Deployment
Issue with installing app debugger
Don't rely on X-Requested-With for pretty print json response
Inconsistent behaviour on request.get_json(cache=False) #2181 (solution)
Updated documentation for being able to use init_db method
testing.rst is missing flask import
Suggestion: Support callables as parameter for url_for
Input stream not automatically drained at teardown.
Fix non-working  setup.cfg in tutorial docs with working copy from sa…
Fix typo in docs/tutorial/templates.rst
Connection Timed Out
There is no way to add a link in flask.abort() function.
Missing documentation about how URL/queries are quoted/unquoted
Fixed typo in module header
Inconsistent behaviour on request.get_json(cache=False)
Migrate various docs links to https
bdist_wheel replaces wheel
Callback on `app.run`
Possibly incorrect handling of from-data
Running tests with nested objects in the data input
Update 4.4.3 HTTP Methods Example
Security Considerations Oversight
py.test => pytest
Increase a max header size, when using the GET request
request.authorization.password missing characters
Flask==1.1.x no longer calls force_type on user-defined types
Problem sending post request from Angular frontend to Flask backend
Documentation - Configuration Handling
Add support for IPython shell when using `flask shell`
upstream prematurely closed 
RuntimeError: Working outside of application context.
RuntimeError: Working outside of application context.
Why is it so difficult for flask_apscheduler to get the flask context??
Add support for gzip compression on json outputs
Another missing import and instantiation
Missing Flask module import and Flask app variable
Officially support using pathlib.Path for static_folder.
flask + Process pool
File Upload with Angular towards a Flask (Python) Webservice
When route does not exists, url_for in template doesn't raise error
app.send_static_file(filename,data=123)
Adding error message to an assert
Clean up docs about error handling
Blueprint's errorhandler has no effect.
werkzeug.routing.BuildError: Could not build url for endpoint 'cap.mjpg' no. 2
werkzeug.routing.BuildError: Could not build url for endpoint 'cap.mjpg'
Clarify in the changelog that 1.1.2 is the last release to support py2.7 and py3.5
Problem with "flask run" command
Fix flake8 repo url in .pre-commit-config.yaml
1.1.2: test suite is failing
How to deal with multiple slashes in URL
use ast to parse FLASK_APP
deprecate passing script_info to factory
Remove simplejson and deprecate encoding options
flask.cli.NoAppException raised when .env/.flaskenv exists in parent directory and python-dotenv installed
Stop change CWD to .env/.flaskenv location
Different logging (handler) behavior when running app with pycharm debugger
Flask webserver and TCP server run at the same time
use pathlib internally
Reloader does not work correctly with lazy loading
Remove simplejson
Drop Python 2
Use ast.parse to validate FLASK_APP
Deprecate passing `script_info` to app factory
url  //  404
Tensorflow and Flask reloader not playing nicely
Missing slash in app route
Problem itterating through arrays in Javascript
Request | request.files access is too slow.
Testing docs are out of date
Grammar and clarity fix
itty bitty typo
how remove response header server 
Clarify that static_folder must be a relative path
Memory leak running Flask in debug mode
how to solve Connection was closed cleanly . scrapy flask gevent Process 
FLASK_APP does not work with bound methods
Update deprecated for config.from_json
docs: update "Deploying on Google App Engine"
Confusion when silently chdir to the directory where an `.env` file was found (with `python-dotenv`)
unexpected variable evaluation on url with encoded slashes
Add async support for flask
Code reload prevents server start 
A problem about request.json
docs: testing.rst function def missing colon
Move HTML escaping example back to Variable Rules.
Errorhandler not work for ValidationError from marshmallow
Flask Quickstart on master branch; minimal example fails with NameError
`@app.route('route')` not relative to root url
app.route(
Remove deprecated `license_file` option
Flask dev server not working with Python 3.6 on Anaconda
Creating realtime API with flask
Fix property name in description
Description contradicts code sample
Flask test_client returns 405 error using flask_restful
Expose JSONDecodeError in flask.json
typo fix
flask how to stop after run() called
JSONEncoder uses _dump_date from werkzeug.http which doesn't format dates with years < 1000 correctly
Make code more easy to read
Add run part
Can not compress response json uses jsonify
Change in return part
Static files sent as content type text/html when redirecting from app.before_request
threads are not running in the background
Remove outdated Pycharm instructions
url_for behavior is different in production than under test
app.teardown_request and app.errorhandler investigation
Flask 0.12.4 pulls an incompatible version of Werkzeug (1.0.0)
how to set flask session key value in multithreading
Large JSON is truncated for over 1MB in Flask
View returned none exception contains endpoint name
Pin Werkzeug < 1.0 for 0.12
Add .vscode to .gitignore
Flask >=1.1.0: app.logger RecursionError: maximum recursion depth exceeded
SESSION_REFRESH_EACH_REQUEST seems pointless in SecureCookieSessionInterface
Flask 0.12.2 fresh install broken due to Werkzeug 1.0.0
CLI checks for cryptography library
Handle breaking changes of Werkzeug v1.0.0
Incompatibility issues with werkzeug 1.0
Disallow werkzeug>=1.0
Forces specific version of Werkzeug to prevent breaking Flask
Deploying doc mod_wsgi.rst is specific to Python 2.X
Bump tox from 3.17.1 to 3.18.0
remove lowest version test until next release
Common API between Flask + Blueprint
templates not showing changes in cloned repo 
Update Discord invite links
Prevent duplicate Content-Type header
How to make a database for each html page in my web application? flask, python, html,sql
Concurrent requests are taking more time then single request for python api code(using flask + waitres WSGI server)
Bump tox from 3.17.0 to 3.17.1
Bump tox from 3.16.1 to 3.17.0
Flask using same styling on different flask projects
make_response uses headers.update
Fixing small html issues in flashing patterns docs
Trying to store Dicts, or dictionaries, in session.
fix typo
Some small doc fixes
Feature request
Cherry-pick 7ba35c4 from master (support pathlib.Path for static_folder)
Bump sphinx from 3.1.1 to 3.1.2
Bump python-dotenv from 0.13.0 to 0.14.0
Making the docs for blueprints more explicit about usecases with some examples.
Added very small clarification to quickstart.rst
API docs - changed flask.request description
class route decorator error
Bump pre-commit from 2.5.1 to 2.6.0
revising/consolidating error docs
Error Docs Revision/Consolidation
Bump tox from 3.16.0 to 3.16.1
Bump tox from 3.15.2 to 3.16.0
Flask does not reload modified code when running under WSL
Consolidated error docs
Show change log entries on PyPi / Include change log entries in the long description
Removed misleading DEBUG variable from examples
So sorry! Can you explain it to me? There is no answer in other forums
about flask document! The Part Of Request
[docs] streaming contents: use app.response_class
Simply control flow for existence checks
Update app.py
Simplify control flow existence checks
send_file returns part of a file to a client when running with gevent worker on python 2.7.x
"ValueError: signal only works in main thread" message when running scrapy in a flask app
Flash is not working if used after session
Use valid HTML in base template
Bump sphinx from 3.1.0 to 3.1.1
Python3 Flask route variable shows up as the variable name instead of value passed from postman
Bump pre-commit from 2.5.0 to 2.5.1
Bump pip-tools from 5.2.0 to 5.2.1
Bump pre-commit from 2.4.0 to 2.5.0
minor changes to tutorial conftest
Bump sphinx from 3.0.4 to 3.1.0
Bump tox from 3.15.1 to 3.15.2
simplify and modernize some stuff for the tutorial project
update code-block typo
(docs): enabled syntax highlighting in logging.rst
Bump greenlet from 0.4.15 to 0.4.16
Appkit problem 
Incorrect handling of filename* in Content-Disposition header causes a double quote to appear at the end of a non-ASCII file name
Cannot patch flask.g in python 3.8+
Bump pytest from 5.4.2 to 5.4.3
Error on Flask run command
Flask POST python script can´t run in Raspbian on startup
security.rst: Add section on copy/paste security
shlex.parse fails to parse quoted args inside a Flask application
Flask app prints environment variable as object instead of string returned from os.getenv
stream_with_context use large memory
Returning Response and headers causes duplicate headers
Bump pip-tools from 5.1.2 to 5.2.0
TypeError: '<' not supported between instances of 'str' and 'NoneType'
项目
Bump sphinx from 3.0.3 to 3.0.4
flask可以做为后端框架和基于vue的nuxtjs集成使用吗
add function REGEXP
use GitHub Actions for CI
use pip-compile to pin dev requirements
Add a function app.parse_route()
Question: Get socket fileno() from flask.request
Flask 1.1.x custom error handler fills up the console with tons of exceptions
add readthedocs config
App config(debug set to true but it still appears as false). Is this a bug?
upgrade to Jquery3.5.1
question about "quickstart"
Discuss terminal copy/paste issues on security page
is flask compatible to python3? 
flaskenv is not read on windows
Add cli_group_help parameter for Blueprint
Blueprint cli commands cannot provide help for cli groups
after_request executed if exception raised
update /docs/testing.rst based on new tutorial tests
add support to override commands
don't show trace for --help without FLASK_APP
Fix docs link for Flask-Uploads
This error pops up every time I try to run flask
Fix function name in example
Fix issue arising when tojson or flask.json.dumps is applied on dict with key None
Error when apply tojson or flask.json.dumps on dict with None as key
FLASK_DEBUG=1 and/or FLASK_ENV=development causes flask.cli.NoAppException: Could not import
When in DEBUG or Development getting flask.cli.NoAppException: Could not import ...
Python 3.8.x - Error on flask import
consolidate error handling docs
Fixed a typo
Difference in flask.g behaviour between Python 2.7 and Python 3.3
Correct small typo in internal link
Fix error message spelling (plural apostrophe)
Fixed class-based views support
Flask-MakeStatic listing and approval
Fix typo
Documentation for Flask.route() incorrect
Debug mode crashes with python 3.3.1 on Windows 8
Flask.run() uses SERVER_NAME config if available.
blueprint.route methods argument typo throws unclear exception 
Broken `g.var is defined` behaviour
Location header key is unicode in case of relative redirects, breaks uwsgi
Is there best solution for http client connection pool?
Flask-doc Korean translation.
teardown_appcontext missing exception when PRESERVE_CONTEXT_ON_EXCEPTION is set
non-latin urls python 3
It does not instantiate MethodView by per request
FireLogger / FirePython integration?
fixing issues found while debugging, fix error in 1 test
Blueprints: Added register_blueprint() method
Flask not working in Virtualenv setup (from S.O.)
update urls on extensions registry page
replace 1/0 by 1 // 0 to get rid of DeprecationWarning (and PEP8 issue)
fix typos
fix data types in after_request test
2 small fixes for metaclass and import usage
fix iterator in testsuite helpers
fix minitwit/flaskr test errors, improve docs about file open mode
Fixed typo in app.blueprints docstring
Adds Flask-Classy to extensions registry
Fix leak in leak detection code
URLConf like Django -> urls.py
Fix some literals
some more work on py 3.3 port
introduce six lib, used python-modernize + manual fix
automated change using python-modernize: fix methodattrs
automated change using python-modernize: replace execfile
automated change using python-modernize: use 'as' in except
document python 2.6 minimum requirement, remove stuff that refers to 2.5
Random website fixes
Move core Flask repositories to an organization
CRUD
Patch external_url_handler example.
added flask-canvas extension
Explicitly state that the jsonify method changes on request
Added a missing comma
Fixed documentation in 'Design Decisions in Flask'
Flask on IIS
Second mini-example on flask.pocoo.org might suggest the dev server is production ready
Add Sentry to error logging documentation
Syntax highlighting for PyPI long description
Update flask online documentation
Add restful route helpers.
Request.data should be unicode
Fixed url_for() incorrect external_url_handler example doc.
Fixed documentation typo
Add ability to app.route pluggable views
HTML5 Video problem on iOS devices when using Flask development server
Note about limitations of static files in blueprints
Documentation page missing from Table of Contents
Update README of example Flaskr
Blueprint.after_request causes Flask to ignore @after_this_request
Mention register_error_handler in errorhandler doc
Review flask-mongo-sessions for approval
Ajax example wrapped html attribute values in quotes
Memory leakage: leaking threads
Using dot will be cleaner.
AJAX with jQuery documentation update
Fixed a few typos in the quickstart doc
Add import to jsonify example
Allow UUID encoding in JSONEncoder
MANIFEST.in updates
JavaScript setRequestHeader of custom X-value not retrievable via Flask request.headers.get()
Raise 400 JSONBadRequest instead of KeyError - Fixes #686
Added signal for registration of blueprints
Fixing werkzeug secure_filename example 
Added more information about app factories.
fix typo in quickstart guide
Request to add a callback hook while registering blueprint.
Semicolon in filename truncates following characters
Update css.rst
Review Flask-Funnel
Flash messages signals
Raise 400 JSONBadRequest instead of KeyError when accessing JSON request data
Review Flask-Mobility
Allow most iterables as return values.
Tiny changes to docs
Several issues with the mailing list (librelist), time to look for an alternative?
fixes #677 - mistype in docs/quickstart
url_for() problem with CGI and .htaccess
Problem with sending form with enctype="multipart/form-data".
Flask exception logging has a catch-22
Minor typo in quickstart
Database improperly closed in the test case within this tutorial
Need instructions about pylint/pychecker setup
Can't jsonify list object
Curious about logo images in your web sites
`redirect` calls are not caught by `handle_http_exception` while RequestRedirect is.
Prefer attachment_filename for mime type guessing in send_file
Session variable is not saved
1.0 maintenance
setuptools finds flask-mail instead of flask
Fix typo in CHANGES.rst
The data for app.url_map.converters is not passed to the blueprint
Updated CLI documentation to mention the issue with underscores and click 7
send_file doesn't urlencode ':/' in unicode attachment_filename
Add link to Render deployment
new installation of flask, can't get around the 404 Not Found error locally
fix the typo
Allow customizing url map class
remove encoding from method override pattern
clarify where to call flask run from in tutorial
disable slow travis osx env
use "-m virtualenv" in installation doc
fix docs build
clear KeyError in production for Werkzeug 0.15
Add comment about using factory function in __init__.py
Fail to run flask when flask test
Fix DeprecationWarning: invlid escape sequence in make-release.py
Add support for PathLike objects in static file helpers
[Docs] Mention how to skip subsets of exceptions in errorpages.rst
Flask auto reload does not refresh browser
Fix syntax warning in docstring
How to connect SQL sever/MSSQL database with flask are there any libraries available
Fix DeprecationWarning on collections import in flask.sessions
DeprecationWarning in flask.sessions
Getter and setter right way for App Config
[Docs] Improve tojson docs (additions, clarifications, & fixes)
Exposed the reloader interval as a flask command line argument
Corrected a typo in a docstring: "Help object" --> "Helper object"
Add a tool to decode session cookie
 Force endpoint name to string in Python 2
View returning 204 takes very long (+65s) when using NGINX and any WSGI implementation
Advice on Flask hooks
Add Python 3.7 to CI.
test_basic.test_trapping_of_bad_request_key_errors failed in Travis-CI
my bad
Fix typo in class name
docs: Update virtualenv creation process for Fedora
I need to manually refresh the web page when I use the “redirect” function
Docstring changed for flask app route
get data from mongodb please discuss it i attached screenshot
Creating flask_wtf forms for a list of values  through a for loop generates the same inputs several times within each form
yum install virtualenv instead of python-virtualenv on Fedora
404 for all routes
TypeError: __name__ must be set to a string object 
request.path doesn't include request.script_root when running under a subdirectory
Fix typos found while completing the Flask tutorial
[Docs] Add simple analogy to app factories doc
Execution time not stable
View Args Contain url escape characters
Flask==1.0.2 is not compatible with python-env
paginate error:paginated page returned 404.
static_host not requesting https
Cross-Site Scripting when using templates
cli shouldn't mess with sys.argv
add classifiers
Build error when using url_for(request.endpoint)
Clarify prefixing of urls for blueprint endpoints
Update README.rst
Issues while using redis session
Request multiple files - New update old syntax does not work
Lighttpd configuration: deploy script link
server banner seems works not as expected
I cant run more than one test case in flask
I can't get cookies in the decorator
Use imperative tense for CLI help text
Requests stop being processed when basic auth is expected but not provided
Use imperative tense for CLI help text
Unprintable characters found in log file
it is not working using flask_apscheduler in flask withoud reload
How can I achieve this structure?
Default help messages for Flask CLI use inconsistent tenses (in English)
Document 'flask run --host' and '--port'
Stop raising FormDataRoutingRedirect
cannot deepcopy flask request ?
1.0 maintenance
Online documentation correction (Standalone WSGI Containers)
Running flask in a thread with Kivy causes no requests to be printed out
Using logging's root logger before app.run() breaks Flask logging
Update app.py
[Docs] Add Single-Page Web Application pattern
How to get a handle_request method for just handle one request
Handle errors during create_url_adapter
Update documentation for users to use flask-caching instead of Werkzeug cache
Custom exception handler not working when an exception is thrown from streaming a generator
Fixes for sentry docs
Update sentry error handling documentation
Flask doesn't auto-escape files not ending in html, htm, xml, xhtml
Relationship error
Documentation: Request object API documentation refers to "trusted_hosts" - not clear
Do not handle RoutingExceptions with app error handlers
Improper digest_method
HTTPException handler catches non-error exceptions like RequestRedirect
Don't pass unexpected exception types to error handlers
Added one tip to use this pattern in Python3.
Patterns Method Overrides
Hot Reloader Causing Re-initialization Issues after Exception
Importing module breaks Flask logging

**
Bodies:

When I call a python wrapper of C++ code in a flask route function, the flask route function quit unexpectedly. But if I call the wrapper from a normal python script ,everything goes well. Is there any condition that flask route function quit automatically?

In http://flask.pocoo.org/docs/0.10/deploying/mod_wsgi/
I ran into an issue when following the guide to configure a current working Flask app for Apache.  It would have been much easier to discover the cause if the following tip was given:

Problem: application runs but can not access other files:

For WSGI applications, all paths used should always be absolute path names.  Even though the app will work fine using relative paths with the simpler python serving method, they will not work with WSGI.

I essentially cloned what `before_first_request` does.

Intention is to get the registration of the static route out of `__init__`, and register it instead right before the first request. (for a feature I mentioned in issue #1466)

~~Another possibility would be to pass `environ` along, to make it possible to modify it (for whatever reasons) before it get's passed to `RequestContext` - if desired.~~ well, not actually reasonable for before__first__request_context.

It would be nice if `test_client()` would accept default environ dictionary. That would stop us doing hacks like [this](http://stackoverflow.com/questions/15278285/setting-mocking-request-headers-for-flask-app-unit-test) over and over.

For example:

```
test_client = app.test_client(defailt_environ = {
    "REMOTE_ADDR": "127.0.0.1"
})
```

`default_environ` should be then passed down all the way to `environment_base` args of `EnvironBuilder` in test.py.

Thank you!

Hi,

I'm currently testing a feature (knitori@f2ae742d163300a22b7b03ca2ac60810ed1de59b) that required to move the registration of the static url from `__init__` to a method, and register that method using `before_first_request` (knitori@6bc77363ed9ee1a9ba00d3536f0479ab0967a8bd).

It works pretty well with a normal application, but it fails one test (`tests/test_basic.py::test_static_files FAILED`). And I realized, that the registered `before_first_request` functions are never actually called with the test client `testing.FlaskClient`. I fixed that locally by adding `self.application.try_trigger_before_first_request_functions()` right before the return statement of `testing.FlaskClient.open` (or should it even go to `Client.open`?).

I'm wondering if there is a rationale behind not calling the registered functions? Or has there just never been a case where it's actually required?

**Edit**

I realized this doesn't work. If the first request is to a static URL, it will return 404, because the RequestContext was created before the static route was registered. If anything, I probably need another even like `before_first_request_context` or something like that. Maybe called inside of `Flask.request_context`.

I'm sorry, it seems this turned into a completely different issue. 

from here ->  http://flask.pocoo.org/docs/0.10/patterns/distribute/

distribute has gone the way of the norwegian blue, hence dead link at  http://python-distribute.org/distribute_setup.py  should be cleaned up

The Flask documentation for how to use it with uWSGI and nginx is incorrect. As the uWSGI docs say at http://uwsgi-docs.readthedocs.org/en/latest/Nginx.html#hosting-multiple-apps-in-the-same-process-aka-managing-script-name-and-path-info, "ancient uWSGI versions used to support the so called “uwsgi_modifier1 30” approach. Do not do it. it is a really ugly hack". The documentation should be updated to talk about the `manage-script-name` and `mount` options instead.

Drop  #1462 for this one. Maybe it  is much more clear now.

the doc string for  `_find_error_handler` is incomplete.

minor inconsistency in docs

Flask Documentation PDF is missing

Read the documentation or download as PDF and zipped HTML
Links to http://flask.pocoo.org/docs/flask-docs.pdf and http://flask.pocoo.org/docs/flask-docs.zip

Both of which are missing.

Use plugin：flask-restful
in app.py:(please see my annotation)  
def process_response(self, response):
        ctx = _request_ctx_stack.top
        bp = ctx.request.blueprint
        funcs = ctx._after_request_functions         # here is None
        if bp is not None and bp in self.after_request_funcs:
            funcs = chain(funcs, reversed(self.after_request_funcs[bp]))
        if None in self.after_request_funcs: 
            funcs = chain(funcs, reversed(self.after_request_funcs[None]))     # here is <itertools.chain object at 0x000000000449FFD0>
        for handler in funcs:               #  then this loop be excuted twice
            response = handler(response)
        if not self.session_interface.is_null_session(ctx.session):
            self.save_session(ctx.session, response)
        return response

please help..

If the local variables (LC_*) are not properly configured, Python
use ASCII as the default encoding. This is fine and Flask works properly.

If the configuration file come with non ASCII caractere, an
UnicodeDecodeError exception will be raised as soon as read() will
try to decode the byte stream.

io.open() as been introduced in Py26 and the ability to specify
the encoding of the file. We use it to force the use of binary mode.

```
$ python
Python 2.7.9 (default, Apr 29 2015, 18:34:06) 
[GCC 4.9.2] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import flask
>>> conf = {"DEBUG": True}
>>> app = flask.Flask(__name__)                                                
>>> app.config.from_object(conf)
>>> app.debug
False
```

Expected behavior would be to accept to setting in the flask application object.

```
>>> flask.__version__
'0.10.1'
```

```
>>> conf = {"SECRET_KEY": "honey"}                                                                                                                                      
>>> app = flask.Flask(__name__)                                                                                                                                         
>>> app.config.from_object(conf)                                                                                                                                        
>>> app.secret_key
```

The `ProxyFix` middleware provided by Werkzeug uses this header for
returning accurate values from request.is_secure and request.scheme.
Without adding this header, Flask won't properly detect when it is being
served over HTTPS and will fail to generate proper external links and
cause certain extensions (e.g. Flask-OAuthlib) to function improperly.
Adding this header to the example setup should reduce issues encountered
by developers when following this guide.

Credit where due: I tend to find this information when I need it in a [blog post](http://cramer.io/2013/06/27/serving-python-web-applications/) by David Cramer.


I'm working with a parameterized url such as:

``` python
"/api/<string:apiToken>"
```

When I send this token containing "%2F" the url encoded form of "/" I get a 404 from the test client. However, the running app works fine.

I'm using Flask 0.10.1 and a minimal test example looks like the following:

``` python
import unittest
import flask
class TestTestClient(unittest.TestCase):
    def test_url(self):
        app = flask.Flask(__name__)
        @app.route('/<string:parameter>')
        def hello_world(parameter):
            return parameter

        test_client = app.test_client()

        response = test_client.get("/FOO")
        self.assertEqual(response.status_code, 200)  # Passes
        self.assertEqual(response.data, "FOO")  # Passes

        response = test_client.get("/%%2F")
        self.assertEqual(response.status_code, 200) # Fails with 404
```

To be consistent with the usage elsewhere in the README

Wanted to be able to extend the session serializer class without duplicating all the code for object hook - as with the _tag function above.

Also add a more detailed explanation of how the request context and app
context interact.

Replace the use of importlib by types.ModuleType in 3.4+

closes gh-1449

Not sure how to make a test for it, either I need to monkeypatch stdlib, or have the tests run with `-W error` which I'm not sure how.

The `imp` module has been deprected in 3.4 and seem to be used in 2 places : `flask/config.py`  and `scripts/flaskext_compat.py` to create modules. 

It should be easy to replace with `types.ModuleType(name)` I guess. 

discovered because I'm running with `-W error`  on another project, which change the warning in errors, and I fail here even before reaching the other lib where I'm trying to find where the warning are coming from. 

I'll try to see if i can send  PR to fix that, 

Thanks

I had no idea about this for far too long. Adding this short sentence right after listing the built-in converters should go a long way to making this more clear for others, I think. I never stumbled across the (excellent) explanation under [`flask.Flask.url_map`](http://flask.pocoo.org/docs/0.10/api/#flask.Flask.url_map) before because the name `url_map` doesn't really indicate to me that you can learn about custom converters there.

"ommited" should be "omitted"

I don't want to spam the builtin command namespace (anyway, why not? Django have a lot of builtin commands and works pretty well) but this is the first command I always implement when I start using flask, and my collegues were doing this also.
It shows all the endpoints registered for the app. Routes can be ordered by rules, endpoints and methods.
This is a WIP, because I did not wrote tests for it yet and did not tried with 2.6 and 2.7.
I would like to have some feedback on this and I can work out the details.

Dont know if this is a desired behavior, but if I send a request like this:

> Content-Type: application/json
> Content-Length: 0

and access `get_json` it raises a 'Cant not decode' error.
Imho it would be better to just return `None` as if `is_json == False`.

Working with: Flask 0.11.dev0

```
# cat templates/t.html 
{{ url_for('url', key1='val1', key2='val2') }}
```

```
from flask import Flask, render_template
app = Flask(__name__)

@app.route('/url')
def url(): pass

with app.test_request_context():
    print render_template('t.html')
```

This script produce such output:

```
/url?key2=val2&amp;key1=val1
```

I see that query string params separator '&' escaped -> '&amp;'
is it bug ?

I created a custom JSON encoder class extended from flask.json.JSONEncoder but it is not called when calling flask.jsonify. Additionally, I removed my custom JSON encoder and confirmed that  flask.json.JSONEncoder isn't called either via a break statement in Pycharm.

```
from flask import Flask
from flask import jsonify
from flask.json import JSONEncoder

class MyEncoder(JSONEncoder):
    def default(self, obj):
        if hasattr(obj, '__json__'):
            return obj.__json__()
        else:
            try:
                iterable = iter(obj)
            except TypeError:
                pass
            else:
                return list(iterable)

        return JSONEncoder.default(self, obj)


class MyClass(object):
    key = 'a'
    value = 'b'

    def __json__(self):
        return {'key': self.key, 'value': self.value}

app = Flask(__name__)
app.json_encoder = MyEncoder

@app.route('/')
def hello_world():
    return jsonify(MyClass())


if __name__ == '__main__':
    app.run(debug=True)
```

In the documentation for [`get_json`](http://flask.pocoo.org/docs/0.10/api/#flask.Request.get_json), the _silent_ parameter is described as "if set to _False_ this method will fail silently and return _False_". It should probably say "if set to _True_ [...]" instead.

This should make the logging module more pep8 compatible. This PR fix problem issued in #1440 .

I made this PR to update first argument of class method in logging module from `x` to `self` in **master** branch. However, i can not make sure if i should at the same time make a PR to also clean the `logging` module in **0.10-maintenance**.

BTW, is the maintenance branch read-only(i checked out that last commit in **0.10-maintenance** is about years ago)? If so, what is the difference between a tag and this maintenance branch.

I recently run into the **app.logger** usage. However, when i read the source code in flask **v0.10.1** , i find that it uses `x` instead of `self` as the first method argument in class [**DebugLogger**](https://github.com/mitsuhiko/flask/blob/0.10.1/flask/logging.py#L26) and [**DebugHandler**](https://github.com/mitsuhiko/flask/blob/0.10.1/flask/logging.py#L32).

Can we just update this calling convention.

Running `flask` CLI without args should be equivalent to running `flask --help`, displaying help for any custom commands in addition to standard command help.

Fixes #1124 

My suggestion would be to add a method to the class that lets you register custom types, e.g. like this:

```
session_json_serializer.register_type('md', MultiDict)
```

This would use the `' md'` prefix when encountering a `MultiDict` object (`type(x) is MultiDict` as subclasses probably shouldn't be handled). To serialize/deserialize I'd simply use `__getstate__` and `__setstate__`.

Test code:

```
import flask
app = flask.Flask()
app.run
```

Run like this:

```
$ pdb3 test.py
> /home/tkcook/scratch/python/test.py(1)<module>()
-> import flask
(Pdb) cont
Traceback (most recent call last):
  File "/usr/lib/python3.4/importlib/util.py", line 95, in find_spec
    spec = module.__spec__
AttributeError: 'module' object has no attribute '__spec__'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.4/pkgutil.py", line 481, in find_loader
    spec = importlib.util.find_spec(fullname)
  File "/usr/lib/python3.4/importlib/util.py", line 97, in find_spec
    raise ValueError('{}.__spec__ is not set'.format(name))
ValueError: __main__.__spec__ is not set

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/lib/python3.4/pdb.py", line 1661, in main
    pdb._runscript(mainpyfile)
  File "/usr/lib/python3.4/pdb.py", line 1542, in _runscript
    self.run(statement)
  File "/usr/lib/python3.4/bdb.py", line 431, in run
    exec(cmd, globals, locals)
  File "<string>", line 1, in <module>
  File "/home/tkcook/scratch/python/test.py", line 1, in <module>
    import flask
  File "/usr/lib/python3/dist-packages/flask/app.py", line 331, in __init__
    instance_path = self.auto_find_instance_path()
  File "/usr/lib/python3/dist-packages/flask/app.py", line 622, in auto_find_instance_path
    prefix, package_path = find_package(self.import_name)
  File "/usr/lib/python3/dist-packages/flask/helpers.py", line 661, in find_package
    loader = pkgutil.get_loader(root_mod_name)
  File "/usr/lib/python3.4/pkgutil.py", line 467, in get_loader
    return find_loader(fullname)
  File "/usr/lib/python3.4/pkgutil.py", line 487, in find_loader
    raise ImportError(msg.format(fullname, type(ex), ex)) from ex
ImportError: Error while finding loader for '__main__' (<class 'ValueError'>: __main__.__spec__ is not set)
Uncaught exception. Entering post mortem debugging
Running 'cont' or 'step' will restart the program
> /usr/lib/python3.4/pkgutil.py(487)find_loader()
-> raise ImportError(msg.format(fullname, type(ex), ex)) from ex
```

Is there a workaround for this?


I need to be able to handle lazy strings in the Jinja2 `|tojson` filter and was thinking about some way to do it: as of now, the `_iterencode_dict` raises a TypeError exception, as expected:

```
Traceback (most recent call last):
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask/app.py", line 1836, in __call__
    return self.wsgi_app(environ, start_response)
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask/app.py", line 1820, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask/app.py", line 1403, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask/app.py", line 1817, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask/app.py", line 1477, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask/app.py", line 1381, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask/app.py", line 1475, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask/app.py", line 1461, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask_admin/base.py", line 68, in inner
    return self._run_view(f, *args, **kwargs)
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask_admin/base.py", line 354, in _run_view
    return fn(self, *args, **kwargs)
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask_admin/model/base.py", line 1466, in index_view
    return_url=self._get_list_url(view_args),
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask_admin/base.py", line 294, in render
    return render_template(template, **kwargs)
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask/templating.py", line 128, in render_template
    context, ctx.app)
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask/templating.py", line 110, in _render
    rv = template.render(context)
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/jinja2/environment.py", line 969, in render
    return self.environment.handle_exception(exc_info, True)
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/jinja2/environment.py", line 742, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask_admin/templates/bootstrap3/admin/model/list.html", line 5, in top-level template code
    {% import 'admin/actions.html' as actionlib with context %}
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask_admin/templates/bootstrap3/admin/master.html", line 1, in top-level template code
    {% extends admin_base_template %}
  File "/home/manuel/dev/www/python/watest/webfu-app/webfu/modules/backend/templates/admin/custom-layout.html", line 3, in top-level template code
    {% import 'admin/static.html' as admin_static with context %}
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask_admin/templates/bootstrap3/admin/base.html", line 80, in top-level template code
    {% block tail %}
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask_admin/templates/bootstrap3/admin/model/list.html", line 171, in block "tail"
    {{ filter_groups|tojson|safe }},
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask/json.py", line 243, in tojson_filter
    return Markup(htmlsafe_dumps(obj, **kwargs))
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask/json.py", line 186, in htmlsafe_dumps
    rv = dumps(obj, **kwargs) \
  File "/home/manuel/.virtualenvs/webapp/lib/python2.7/site-packages/flask/json.py", line 126, in dumps
    rv = _json.dumps(obj, **kwargs)
  File "/usr/lib/python2.7/json/__init__.py", line 250, in dumps
    sort_keys=sort_keys, **kw).encode(obj)
  File "/usr/lib/python2.7/json/encoder.py", line 209, in encode
    chunks = list(chunks)
  File "/usr/lib/python2.7/json/encoder.py", line 434, in _iterencode
    for chunk in _iterencode_dict(o, _current_indent_level):
  File "/usr/lib/python2.7/json/encoder.py", line 382, in _iterencode_dict
    raise TypeError("key " + repr(key) + " is not a string")
TypeError: key lu'Nome categoria' is not a string
```

I can't really use the `gettext` since i need the `lazy_gettext` version, and was asking for advice and ideas on how to tackle this problem: i tried subclassing the `flask.json.JSONEncoder` class [as per this example](https://gist.github.com/pvanliefland/6009424) and i'm handling lazy strings in the `default` method there, but it looks like it doesn't get called at all.

There is the `iterencode` method i could try to subclass, but it probably won't be a clean way to do it?
Thanks for any input you can give.

Hey guys, I was thinking that could be a good ideia create a decorator to put in the head of method, to show what kind of content-type that rest service will return. 

Something like that:

``` python

@return_json
@app.route('/user/email')
def get_user_email():
   return {'email': 'example@email.com'}
```

So, in the return_json decorator we could change the content-type of response. If someone think that is a good ideia, I can implement and send a pull request.

Cont. https://github.com/mitsuhiko/flask/pull/1291#discussion_r27856289


See #1291

@flying-sheep: Please set your editor to use 4 spaces instead of tabs, and
don't have whitespace in blank lines (use the pep8-tool to check).

Some attributes and methods have custom documentation in api.rst, while there doesn't seem to be a reason why that couldn't be generated through autodoc.

Documenting the changes in #1291

This allows two things with the error handlers:
- The best handler gets picked when multiple handlers are possible. Example: you can register a default handler for all exceptions and a then override it for specific errors.
- In a handler, you can raise the error again to pass it to the next best handler.

Hey there,

I don't know if anyone ran into this problem before because it works "by chance" in py2, but in py3 you can't send temporary file with `send_file` by passing a fp.

The main problems are here https://github.com/mitsuhiko/flask/blob/master/flask/helpers.py#L477 and there https://github.com/mitsuhiko/flask/blob/master/flask/helpers.py#L496.

Under py2 a `tempfile.TemporaryFile` is given the name `'<fdopen>'` whereas under py3 it's an integer.

```
Python 2.7.9 (default, Dec 15 2014, 10:01:34)
[GCC 4.2.1 Compatible Apple LLVM 6.0 (clang-600.0.56)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> from tempfile import TemporaryFile
>>> fp = TemporaryFile()
>>> fp.name
'<fdopen>'
```

```
Python 3.4.3 (default, Mar 23 2015, 04:19:36)
[GCC 4.2.1 Compatible Apple LLVM 6.0 (clang-600.0.57)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> from tempfile import TemporaryFile
>>> fp = TemporaryFile()
>>> fp.name
4
```

Then when Flask tries to build `filename` it crashes (trying to concatenate a string and an integer in `os.path.join(current_app.root_path, filename)`).

Would you consider merging a workaround for this problem? (like setting `filename` to `None` if we don't have a `string_types` for instance)

Hi,

I was trying to create a small sample for another issue and run into a problem. I have a very simple demo app. This is the main file:

``` python
from flask import Flask

app = Flask(__name__)

if __name__ == '__main__':
    from sign import sign as sign_blueprint
    app.register_blueprint(sign_blueprint, url_prefix='/sign')
    app.run()
```

Blueprint `sign` lives inside the `sign` directory and the `__init__.py` file there declares it.

``` python
from flask import Blueprint
sign = Blueprint('sign', __name__)
from . import views
```

`views` just contains a simple handler that returns the string ok when requested. The problem is that my request was completely ignored. I started debugging and the routes collection has only the `static` route. The details for my blueprint disappeared.

![Structure](https://cloud.githubusercontent.com/assets/627517/7091648/a4491eb6-df81-11e4-9f54-03cf586848c4.png)

Writing 
- http://127.0.0.1:5000/sign/order/2345
- http://127.0.0.1:5000/sign/order/
- http://127.0.0.1:5000/sign/
- http://127.0.0.1:5000/sign

gets the same 404 error. It seems that somehow my blueprint is ignored and no route is created.

Any ideas?

Thank you,

Federico

I use the flask extension flask-theme,  it has a import ：
from flask import (Module, send_from_directory, render_template, json,
                     _request_ctx_stack, abort, url_for) 
the master version has no Module
so I reinstall flask to 0.10.1, but it hasn't cli.py 

so , I want to know, the module.py is not necessary in the fulture?

I am sure I am not the only one who would like to see who was the current_user when an exception happens especially in production environments.

Currently, the "standard" way to accomplish this is to use logging.LoggingAdapter. But since every flask exception is hardwired to go to the app.logger, how can I use the adapter method?

5 years, still not 1.0! what are you thinking about, pocoo?

This is useful e.g. when using the new Jinja Environment
attributes added in mitsuhiko/jinja2#404

cont https://github.com/mitsuhiko/flask/pull/1416#issuecomment-90027039

Sorry for long report, this took a while to debug. I'm not an expert on how reloading works, so hopefully someone can explain what is happening. This only happens when I use Flask's reload while launching flask using supervisord, so if it ends up being a supervisord bug I will refile it on their bug tracker, but the problem only appears when using flask's reloading feature. 

Here's my simple flask app: 

```
from flask import Flask

app = Flask(__name__, static_url_path='')

@app.route('/start')
def start_build():
  print "Running command"
  return "Starting"

if __name__ == "__main__":
  app.run(debug=True)
```

As you'd expect, this generates the following output

```
hamiltont$ python example.py
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
Running command
127.0.0.1 - - [04/Apr/2015 18:58:13] "GET /start HTTP/1.1" 200 -
Running command
127.0.0.1 - - [04/Apr/2015 18:58:42] "GET /start HTTP/1.1" 200 -
Running command
127.0.0.1 - - [04/Apr/2015 18:58:44] "GET /start HTTP/1.1" 200 -
```

This output is generated correctly for all combinations of `python` vs `python -u` and `use_reloader=True` vs `use_reloader=False`. 

Now I try to run the application (with reloading enabled) using supervisord and this `supervisord.conf` file

```
[supervisord]
nodaemon=true

[program:flask]
command=python -u example.py

; Send stdout to console
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0

; Send stderr to console
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

; Flask does not propagate signals to child processes when using debug
; mode, so this tells supervisor to send the signal to the entire 
; process group instead of just the parent
stopasgroup=true
; Send interrupt so the server is shutdown gracefully
stopsignal=INT
```

Note that I'm intentionally specifying `python -u` in my command, just to avoid issues. Here's the output: 

```
hamiltont$ supervisord -c super.conf
2015-04-04 19:02:59,762 INFO supervisord started with pid 22439
2015-04-04 19:03:00,769 INFO spawned: 'flask' with pid 22442
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
2015-04-04 19:03:01,939 INFO success: flask entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
127.0.0.1 - - [04/Apr/2015 19:04:07] "GET /start HTTP/1.1" 200 -
127.0.0.1 - - [04/Apr/2015 19:04:11] "GET /start HTTP/1.1" 200 -
127.0.0.1 - - [04/Apr/2015 19:04:11] "GET /start HTTP/1.1" 200 -
^C
2015-04-04 19:04:14,198 WARN received SIGINT indicating exit request
2015-04-04 19:04:14,198 INFO waiting for flask to die
Running command
Running command
Running command
2015-04-04 19:04:14,209 INFO stopped: flask (exit status 0)
```

So until I hit `Ctrl-C` to terminate, the stdout was being buffered. If I disable reloading, then everything works as expected: 

```
hamiltont$ supervisord -c super.conf
2015-04-04 19:06:49,711 INFO supervisord started with pid 22462
2015-04-04 19:06:50,715 INFO spawned: 'flask' with pid 22465
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
2015-04-04 19:06:52,268 INFO success: flask entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
Running command
127.0.0.1 - - [04/Apr/2015 19:06:54] "GET /start HTTP/1.1" 200 -
Running command
127.0.0.1 - - [04/Apr/2015 19:06:57] "GET /start HTTP/1.1" 200 -
Running command
127.0.0.1 - - [04/Apr/2015 19:06:58] "GET /start HTTP/1.1" 200 -
^C
2015-04-04 19:07:03,959 WARN received SIGINT indicating exit request
2015-04-04 19:07:03,960 INFO waiting for flask to die
2015-04-04 19:07:03,968 INFO stopped: flask (exit status 0)
```

I can also generate the expected output by manually wrapping stdout at the top of my `example.py` file

```
import sys
import os
sys.stdout = os.fdopen(sys.stdout.fileno(), 'w', 0)
```

Reverts mitsuhiko/flask#1418, not sure why that broke the build


I am learning flask framework and want to set up flaskr by following the flask tutorial. In the end I am getting the error:OperationalError: no such table: entries.

the code of flaskr.py is here below

```
import os
from sqlite3 import dbapi2 as sqlite3
from flask import Flask, request, session, g, redirect, url_for, abort, render_template, flash

app = Flask(__name__);

app.config.update(dict(
    DATABASE=os.path.join(app.root_path,'flaskr.db'),
    DEBUG=True,
    SECRET_KEY='development key',
    USERNAME='admin',
    PASSWORD='default'
    ))

app.config.from_envvar('FLASK_SETTINGS',silent=True);

def connect_db():
    """Connects to the specific database."""
    rv = sqlite3.connect(app.config['DATABASE']);
    rv.row_factory = sqlite3.Row;
    return rv;

def init_db():
    db = get_db();
    with app.open_resource('schema.sql',mode='r') as f:
        db.cursor().executescript(f.read());
    db.commit();

@app.cli.command('initdb')
def initdb_command():
    init_db();
    print('Initialized the database.');

def get_db():
    if not hasattr(g,'sqlite_db'):
        g.sqlite_db = connect_db();
    return g.sqlite_db;

@app.teardown_appcontext
def close_db(error):
    if hasattr(g,'sqlite_db'):
        g.sqlite_db.close();

@app.route('/')
def show_entries():
    db = get_db();
    cur = db.execute('select title, text from entries order by id desc');
    entries = cur.fetchall();
    return render_template('show_entries.html', entries=entries);

@app.route('/add',methods=['POST'])
def add_entry():
    if not session.get('logged_in'):
        abort(401);
    db = get_db();
    db.execute('insert into entries (title, text) value (?, ?)',[request.form['title'],request.form['text']]);
    db.commit();
    flash('New entry was succeedfully posted');
    return redirect(url_for('show_entries'));

@app.route('/login',methods=['GET','POST'])
def login():
    error = None;
    if request.methods == 'POST':
        if request.form['username'] != app.config['USERNAME']:
            error = 'Invalid username';
        elif request.form['password'] != app.config['PASSWORD']:
            error = 'Invalid password';
        else:
            session['logged_in'] = True;
            flash('You were logged in');
            return redirect(url_for('show_entries'));
    return render_template('login.html',error=error);

@app.route('/logout')
def logout():
    session.pop('logged_in',None);
    flash('You were logged out');
    return redirect(url_for('show_entries'));

if __name__ == '__main__':
    app.run(host='0.0.0.0',debug=True);
```

Common code has been refactored into a mixin shared between request and response classes. This is a continuation of #1408.

I deployed a simple Flask web server to serve http://www.holmusk.com/ and it mysteriously stops serving pages after a few hours. There are no errors on the console. Can you help guide me towards what the possible issue might be?


Hi,

I was scratching my head on this one and thought it would be good to mention this in the documentation.

Thanks for an excellent lightweight web framework,

-Torstein

Assuming I have more than one Flask application (I'm using blueprints too, so there is not need to advice me them) and I want to build url from one to another. With no request context I was just using forced context of target application and it worked. But what should I do with existing request context? If i receive request to one application and want to do redirect to another one?

Or, in another words, why url_for first of all searches for request context? Maybe it should be optional, through _external parameter for example?

Please, do not send me to stackoverflow, my question about similar problem is hanging for more than a week with no responses at all.

The suggested way to start the app from http://flask.pocoo.org/docs/0.10/quickstart/#a-minimal-application is app.run(...).  Examining the source code of run, which chains run_simple it appears there is now way to detect success or failure.

Perhaps the run method should return a status (True/False) or (self/None)

When attempting to run complete flaskr tutorial code (stable site version).

It would be nice to have a "collective" like Plones https://github.com/collective for Flask it would make contributing so much easier.

This change adds support for JSON requests to the Flask test client, which makes testing JSON APIs much more convenient, and makes the arguments consistent with `request.data` and `request.json`.

Before:
`response = client.post('/url', data=json.dumps(json_data), content_type='application/json')`

After:
`response = client.post('/url', json=json_data})`

If this gets merged then I have another change to support `response.json`, which would make it easier to make assertions on JSON responses.

This reverts commit 1577e1386e737eca69dbb6cfe6b8bf979f7b2944.

Is there a way to add a global catch-all error handler in which I can change the response to a generic JSON response?

I can't use the `got_request_exception` signal, as it is not allowed to modify the response (http://flask.pocoo.org/docs/0.10/signals/).

> In contrast all signal handlers are executed in undefined order and do not modify any data.

I would prefer to not wrap the `app.handle_exception` function as that feels like internal API. I guess I'm after something like:

``` python
@app.errorhandler()
def handle_global_error(e):
  return "Global error"
```

Note the `errorhandler` does not take any parameters, meaning it would catch all exceptions/status codes which does not have a specific error handler attached to them. I know I can use `errorhandler(500)` to catch exceptions, but if I do `abort(409)` for example, it will still return a HTML response.

From Issue #1135 "Test_import_migration.py" file updated.

Fixes #1135 

It's very annoying when you read the API documentation, all decorated functions haven't the correct signature.

Example : 

`errorhandler(*args, **kwargs)`

should be 

`errorhandler(code_or_exception)`

this PR fixes this issue with an elegant solution found here : https://github.com/praw-dev/praw/blob/master/praw/decorators.py

Multiple issues including #248 call for `jsonify` to handle lists. As discussed there, allowing toplevel arrays should pose no security problem nowadays. A config parameter is added to enable this functionality, and an array is returned only when a conversion to an object is not possible to maintain backwards compatibility.

In short, when `JSONIFY_ALLOW_TOPLEVEL_ARRAY` is set, `jsonify(1, 2, 3)`, `jsonify(question='Ultimate', answer=42)`, and `jsonify({'question': 'Ultimate', 'answer': 42})` all work as expected.  Note that unlike dicts, `jsonify([1, 2, 3])` will result in nested lists, so always use `jsonify(*l)` for a list variable `l`.

Looks like that was meant to be `config_key`. It works by accident because the function is defined in the same scope as the loop that passes `config_key` to `apprunner`.

Multiple issues including #248 call for jsonify to handle lists.  As discussed there, allowing toplevel arrays should pose no security problem nowadays.  A config parameter is added to enable this functionality, and a list is jsonified only when no `kwargs` is given to maintain backwards compatibility.  In short, when `JSONIFY_ALLOW_TOPLEVEL_ARRAY` is set, `jsonify(1, 2, 3)`, `jsonify([1, 2, 3])`, `jsonify(question='Ultimate', answer=42)`, and `jsonify({'question': 'Ultimate', 'answer': 42})` all work as expected.  Note that `jsonify(1)` produces `"[1]"`, which may or may not be wanted.

Test

I know man

It would be nice to be able to easily tell static content served from flask is static in a before_request for example.

Over the past 2 months I've sent 3 questions to the mailing     flask@librelist.com mailing list. It had worked for me before, The questions have been completely ignored, and they don't even appear in the archive.

I've sent another question earlier, in mid December 2014, and it was archived and responded to. The 3 questions since then have not.

It looks like @menudoproblema already has PR open for this: #1276 

I'm filing this issue to register my interest in having support for implementing HTTP methods via mixins on `MethodView` classes as well.

Hi everyone, question here.
I have complex flask application with several Flask instances dispatched by werkzeug middleware. And in such situation I have two questions related not actually with url_for, but with flask context management actually.
1) How do I create url from one application to another?
2) Main one - how do I create url for specific application with no app_context at all. For example i need to create some url on import time or from celery task. I tried to do wrapper over all application instances and redefine url_for like

```
def url_for(self, *args, **kwargs):
    with self.app.app_context():
        return url_for(*args, **kwargs) 
```

but just received following error
"Application was not able to create a URL adapter for request independent URL generation. You might be able to fix this by setting the SERVER_NAME config variable."
Any suggestions?

This is a fix for #1392; the app and request contexts should not report an exception when tearing down after an exception has already been handled in a `with` statement.

Consider the following:

``` python
from flask import Flask
app = Flask(__name__)

@app.teardown_appcontext
def teardown(exception):
    print exception

with app.app_context():
    try:
        raise ValueError()
    except ValueError:
        pass
```

Within the `app.app_context()` context (managed by `with`) an exception is raised and handled. However, the `teardown_appcontext()` handler is still passed the exception value.

That's because the exception was raised and handled within the same frame, and thus `sys.exc_info()` is still available. The `AppContext.__exit__()` method did pass in `None` for the exception value:

``` python
def __exit__(self, exc_type, exc_value, tb):
    self.pop(exc_value)
```

but the `AppContext.pop()` method cannot distinguish this from not passing in a value at all:

``` python
def pop(self, exc=None):
    """Pops the app context."""
    self._refcnt -= 1
    if self._refcnt <= 0:
        if exc is None:
            exc = sys.exc_info()[1]
        self.app.do_teardown_appcontext(exc)
```

This can easily be remedied by using a different sentinel default value:

``` python

_sentinel = object()

def pop(self, exc=_sentinel):
    """Pops the app context."""
    self._refcnt -= 1
    if self._refcnt <= 0:
        if exc is _sentinel:
            exc = sys.exc_info()[1]
        self.app.do_teardown_appcontext(exc)
```

Hi I am developing one page that has header, footer, menu and main body page.

The header and footer are never get change. Whennever the user clicks the menu, then it should redirect to corresponding main body page.

Is there any framework there in flask? Dynamically include pages. 

I don't want to refresh header, footer, menu.

fix #1370


app = Flask(**name**, static_folder='static', static_url_path='')

I've tested this, currently Flask seems doesn't support resuming download when serving static files in "static" directory. 
This feature is very useful if the client (browser/download manager) requested very large files.

No matter what I try (setup.py Pip), I always get a maximum recursion depth exceeded. I know nothing about Python, and I need it as a requirement for another program. How could I go about fixing this?

'python setup.py' dump: (Beware, really long!)

```
Traceback (most recent call last):
  File "setup.py", line 110, in <module>
    test_suite='flask.testsuite.suite'
  File "/usr/lib/python2.7/distutils/core.py", line 111, in setup
    _setup_distribution = dist = klass(attrs)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 580, in resolve
    dist = best[req.key] = env.best_match(req, self, installer)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 825, in best_match
    return self.obtain(req, installer) # try and download/install
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 837, in obtain
    return installer(requirement)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 272, in fetch_build_egg
    dist = self.__class__({'script_args':['easy_install']})
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 225, in __init__
    _Distribution.__init__(self,attrs)
  File "/usr/lib/python2.7/distutils/dist.py", line 287, in __init__
    self.finalize_options()
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/setuptools/dist.py", line 257, in finalize_options
    ep.require(installer=self.fetch_build_egg)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2029, in require
    working_set.resolve(self.dist.requires(self.extras),env,installer))
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 579, in resolve
    env = Environment(self.entries)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 748, in __init__
    self.scan(search_path)
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 777, in scan
    for dist in find_distributions(item):
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 1757, in find_on_path
    path_item,entry,metadata,precedence=DEVELOP_DIST
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2151, in from_location
    py_version=py_version, platform=platform, **kw
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 2128, in __init__
    self.project_name = safe_name(project_name or 'Unknown')
  File "/usr/local/lib/python2.7/dist-packages/distribute-0.6.28-py2.7.egg/pkg_resources.py", line 1139, in safe_name
    return re.sub('[^A-Za-z0-9.]+', '-', name)
  File "/usr/lib/python2.7/re.py", line 151, in sub
    return _compile(pattern, flags).sub(repl, string, count)
RuntimeError: maximum recursion depth exceeded
```

Using form.hidden_tag() results in an element like the following:

<div style="display:none;"><input id="csrf_token" name="csrf_token" type="hidden" value="..."></div>


which is not compliant with the XHTML 1.1 standard as the "input" element is not closed.


Hey guys, I don't know if this is the right place to make this bug report, but I could sure use some help, I have been banging my head against a wall for a bit. See this repo where I'm reproducing my error: https://github.com/bepetersn/special-repo. 

I'm seeing weird behavior around the Flask `request` object. After uploading a file with the requests library, e.g. `requests.post(uri, files=<my_files>)`, by the time the `request` propagated to my view function, `request.files` was empty. Oddly, I observed that the contents of the file itself was available under `request.form[None]`. 

My only lead was that when I debugged this at length, I saw that the request data was being treated as a mimetype of "application/x-www-form-urlencoded" rather than the correct "multipart/form" for uploading binary files... But, I just threw this example together really quickly, and I'm not seeing that right now, so I'm no longer sure.

I've also seen some other errors on this repo involving calling `request.data` vs `request.form`. I don't really know anything about that. I'd greatly appreciate a pointer in the right direction.

This is barely noticeable in the development code since #839, but in the latest released version. The current code to normalize the error condition misses its apparent purpose: code_or_exception will never be an instance of HTTPException, as one might only supply an exception class and not an object.
The bug still appears when you declare an errorhandler for a numeric code after setting one for the respective exception: Then, the exception's handler will always take precedence.

The HTTPException base class has no code and therefore must be dealt with like any other exception.

Please comment if the attached workflow is a correct description of how Flak handles an request and when and how signals are triggered

I'm particularly interested in the request_tearing_down signal. I want to log requests (user page views) to a database, but I don't want to compromise the client experience regarding speed. So I would like to only log the request data to a DB after the data was successfully sent to the client

![flask signals](https://cloud.githubusercontent.com/assets/2236950/6657010/363efcde-cb1c-11e4-8d12-2b70d72fa59b.png)

In reference to issue #836, a general note about hashing passwords for security is added. This clarifies the tutorial's choice to not use secure passwords to demonstrate the basic usage of Flask.

As it stated, documentation states full example that demonstrates this approach, with the way it is implemented. It requires this line of code to perform the test functions on the three examples under Other Testing Tricks.

Hi i am currently working through the Flask Mega-Tutorial and when i try to create a new user in part 4 (Databases) at the Play Time section i am getting the following errors and would appreciate any help in solving this issue --- I am extremely new to Linux, Python and Flask so apologise if ive overlooked something very simple here.

> > > u = models.User(nickname='john', email='john@email.com')
> > > Traceback (most recent call last):
> > >   File "<stdin>", line 1, in <module>
> > >   File "<string>", line 2, in **init**
> > >   File "/home/gilly/microblog/flask/local/lib/python2.7/site-packages/sqlalchemy/orm/instrumentation.py", line 324, in _new_state_if_none
> > >     state = self._state_constructor(instance, self)
> > >   File "/home/gilly/microblog/flask/local/lib/python2.7/site-packages/sqlalchemy/util/langhelpers.py", line 725, in __get__
> > >     obj.**dict**[self.**name**] = result = self.fget(obj)
> > >   File "/home/gilly/microblog/flask/local/lib/python2.7/site-packages/sqlalchemy/orm/instrumentation.py", line 158, in _state_constructor
> > >     self.dispatch.first_init(self, self.class_)
> > >   File "/home/gilly/microblog/flask/local/lib/python2.7/site-packages/sqlalchemy/event/attr.py", line 260, in **call**
> > >     fn(_args, *_kw)
> > >   File "/home/gilly/microblog/flask/local/lib/python2.7/site-packages/sqlalchemy/orm/mapper.py", line 2693, in _event_on_first_init
> > >     configure_mappers()
> > >   File "/home/gilly/microblog/flask/local/lib/python2.7/site-packages/sqlalchemy/orm/mapper.py", line 2589, in configure_mappers
> > >     mapper._post_configure_properties()
> > >   File "/home/gilly/microblog/flask/local/lib/python2.7/site-packages/sqlalchemy/orm/mapper.py", line 1694, in _post_configure_properties
> > >     prop.init()
> > >   File "/home/gilly/microblog/flask/local/lib/python2.7/site-packages/sqlalchemy/orm/interfaces.py", line 144, in init
> > >     self.do_init()
> > >   File "/home/gilly/microblog/flask/local/lib/python2.7/site-packages/sqlalchemy/orm/relationships.py", line 1549, in do_init
> > >     self._process_dependent_arguments()
> > >   File "/home/gilly/microblog/flask/local/lib/python2.7/site-packages/sqlalchemy/orm/relationships.py", line 1605, in _process_dependent_arguments
> > >     self.target = self.mapper.mapped_table
> > >   File "/home/gilly/microblog/flask/local/lib/python2.7/site-packages/sqlalchemy/util/langhelpers.py", line 725, in __get__
> > >     obj.**dict**[self.**name**] = result = self.fget(obj)
> > >   File "/home/gilly/microblog/flask/local/lib/python2.7/site-packages/sqlalchemy/orm/relationships.py", line 1535, in mapper
> > >     % (self.key, type(argument)))
> > > sqlalchemy.exc.ArgumentError: relationship 'posts' expects a class or a mapper argument (received: <class 'sqlalchemy.sql.schema.Table'>)
> > > 
> > > Thanks in advance for any help given.
> > > Wayne.

Docs contain dead link

When I running a flask app with debug=True in virtualenv, the cpu usage increase to 20%. But if I set debug=False, the cpu usage is only 1%.
If I running without virtualenv, all is ok.

Addresses concerns in issue #532 regarding not knowing about flask extensions as it is not mentioned the quick start guide. Maybe this can help increase the awareness of flask extensions to new users?

got 404 for "download document as PDF"

This is making it difficult as I am getting an error, I check the repo and the code is completely different. This makes it difficult for a beginner. 

When I do control-c in the Python Console, it either takes a minute, or doesn't do anything.
Also, when I make a change to the file and save it, it takes a while to reload the file as well.
Running Python 3.4, Windows 8.1. Running in the [Spyder IDE](https://github.com/spyder-ide/spyder) Python Console.

Edit: This also happens in the regular python console.
Edit 2: It seems that Control-C takes effect when the file reloads...

Hi guys, I'm using for the first time your framework and I happy find out all capabilities with  this "micro-framework'. Btw, I just came up with this decorator, something more friendly for logging task
I created my project in you want to look for a moment: http://github.com/d555/visionapp

In something like `manage.py` ,inside the Flask app in app root directory:

```
...
import logging
from logging.handlers import RotatingFileHandler
...
handler = RotatingFileHandler('app-log.txt', maxBytes=10000, backupCount=1)
handler.setLevel(logging.INFO) # puede ser loggin.ERROR
app.logger.addHandler(handler)
```

So, in a somewhere possibly `main/decorators.py`:

```
from flask import current_app
...
def logging(hora=None):
    logger = None
    def decorador(f):
        @wraps(f)
        def vista(*args, **kwargs):
            logger = current_app.logger
            kwargs['log'] = logger
            return f(*args, **kwargs)
        return vista
    return decorador
```

After that, I could nicely use the above decorator in the following way in whatever view:

```
@logging()
def view_function(log):
    log.info('friendly logging call')
   return ...
```

May be, you could just say that in each view wrote something like:

```
from flask import current_app
def view_function():
     log = current_app.logger
     log.info('another message')
```

For now, above approach works fine for me, but maybe you know a better approach to do that:
``using the logger defined in configuration of app, to access from every view functions in any folder to logger`
`
How is better do a logging tracking? (something like 'using`getLogger`? and the normal use?)
Is there something relate with`from flask import logging`. I couldn't find in documentation something relate (maybe https://github.com/mitsuhiko/flask-extended-logging, http://flask.pocoo.org/docs/0.10/errorhandling/) if It's abroad here  excuse me.

Thanks in advance.

Hopefully makes it more clear that filenames must use `latin-1` encoding. Resolves issue #1286.

1. `flash` is not imported
2. `user.nickname` is defined as `db.String(80)` instead of `db.Column(db.String(80))`

is an -> if a

is -> if

As well as the usual 

```
@app.route('/login', methods=['POST'])
```

Could we have the sugary treats of shortcut decorators:

```
@app.post('/login')            // equivalent to the above

@app.put('/article/new')    // the brave new world of REST

@app.get('/login')              // synonymous with @app.route('/login')

@app.getPost('/login')       // synonymous with @app.route('login', methods=['GET','POST']
```

Okay, the last one might be going a bit far (although practically it would be very useful). But in general, they're very pleasant ways to add RESTful route descriptions.

The Flask development is vulnerable to RSnake's SlowLoris single-machine denial of service attack. I tested Flask on Ubuntu 14.04 with a Raspberry Pi Model B running Raspbian as the attacker. The DoS succeeded in under a second. This is generally caused by restrictive threading limits, see http://ha.ckers.org/slowloris/

Unfortunately, unlike many webservers, Flask does not seem to recover gracefully when the attack ends, instead throwing broken pipe errors and no longer serving pages until restarted. This affects both debug and normal modes.

Edit: Looks like this was discovered previously and is mentioned here: http://librelist.com/browser//flask/2014/9/2/fwd-dos-via-socketserver/

Hi !

I'm in trouble since a moment using Flask with that point.
I'm registring 2 url rules in a blueprint :

``` python
class MyClass(Blueprint):
    def setup(self):
        self.add_url_rule('<service>.<ext>', view_func=service_call)
        self.add_url_rule('networks.<ext>', view_func=networks)
```

I've read somewhere that the rule with the less number of parameters is taken in routing.
But, when I'm typing /networks.json, I'm in the `service_call()` function, not in `networks()`
When I print the `url_map` :

``` python
Map([ <Rule '/v1/<service>.<ext>' (HEAD, OPTIONS, GET) -> v1.service_call>,
 <Rule '/v1/networks.<ext>' (HEAD, OPTIONS, GET) -> v1.networks>,
 <Rule '/static/<filename>' (HEAD, OPTIONS, GET) -> static>])
```

After some tests, it seems that following code is working as expected :

``` python
class MyClass(Blueprint):
    def setup(self):
        self.add_url_rule('<service>/<ext>', view_func=service_call)
        self.add_url_rule('networks/<ext>', view_func=networks)
```

So, the dot isn't considered as a "separator" ?
Is there a way to fix that ?

Thanks in advance for your help !

Python 3 and Flask is a good combination nowadays that works rather well. In fact, [most PyPI libs](https://regebro.wordpress.com/2014/10/23/59-of-maintained-packages-support-python-3/) are now ported and it's generally ok to encourage people to use Python 3 for new projects.


When `JSONIFY_END_WITH_NEWLINE` is set to `True`, `jsonify` responses will be terminated with a newline character.

Defaults to `False` for backward compatibility.

This came up in the context of https://github.com/kennethreitz/httpbin/issues/168

Running a flask application with debug=True (and thus, use_reloader=True) in Pycharm, breakpoints inside view functions don't work. Setting use_reloader=False works, but I miss the reloader. This works as expected when running on Python 2.7. I'm not sure if this is an issue on Flask, Werkzeug or Pycharm. Is there somebody with better insights on Werkzeug internals and  how the Pycharm debugger works that could help me with this?.

Without 'from **future** import absolute_import', Celery causes import issues with many apps.

As you mentioned in [Unicode in Flas](http://flask.pocoo.org/docs/0.10/unicode/) Flask is totally Unicode based. And more "Flask just assumes that if you are sending Unicode out you want it to be UTF-8 encoded. Flask will do the encoding and setting of the appropriate headers for you." 

This assumption is on my opinion be broken in uploading files, because the read method of the FileStorage io.BytesIO stream in the following code is returning an ascii string (type 'str') and not an unicode string (type 'unicode') - so you have to decode this string to the Flask Unicode Behaviour:

``` python
@app.route('/upload', methods=['GET', 'POST'])
def upload_file():
    if request.method == 'POST':
        f = request.files['the_file']
        content = f.stream.read()
        if isinstance(content, str): print('content is str')
        content = content.decode('utf-8')
        if isinstance(content, unicode): print('content is unicode')
        ...
```

I know, that Flask don't knows if an uploaded file will be `utf-8` or any other, but analogue as in the assumption above, Flask should assume `utf-8` and not `ascii` as default encoding.

I am not quite sure why `assert` is used, raising an exception that means what it means (an error happening at runtime) is IMHO much clearer than just a plain `AssertionError`.

Calling `flask.redirect()` or returning data from a callback passed to `Blueprint#before_app_request()` are ignored, despite the callback executing.

`Flask#before_request()` and `Blueprint#before_request()` both appear to work as intended, redirecting and/or handling the request as appropriate.

It's not immediately clear from reading the inline documentation that this particular behavior is intended.  The only documentation I can find on the matter is on `Flask#preprocess_request()`, which doesn't really touch on Blueprint behavior:

```
    """Called before the actual request dispatching and will
    call every as :meth:`before_request` decorated function.
    If any of these function returns a value it's handled as
    if it was the return value from the view and further
    request handling is stopped.

    This also triggers the :meth:`url_value_processor` functions before
    the actual :meth:`before_request` functions are called.
    """
```

Is this a bug or just an undocumented / intended behavior?

flask/blob/master/docs/patterns/fileuploads.rst, after the first bit of sample code, says:

"Then we add a URL rule by hand to the application."

But I see no place in that code where a URL rule is added.

Expected: Either a URL rule is added in that piece of code, or the text doesn't state that that happens.

This page http://flask.pocoo.org/docs/0.10/patterns/sqlite3/ references a function `connect_to_database` that isn't mentioned anywhere.

Looking at 0.9 http://flask.readthedocs.org/en/0.9/patterns/sqlite3/, it looks like this snippet should be somewhere:

```
def connect_to_database():
    return sqlite3.connect(DATABASE)
```

So basically I would like to test redirects in my codebase which I currently do the following way:

``` python
import ... import app
from flask import url_for
...

def test_stuff(client):  # client is a flask.testing.FlaskClient instance
  response = client.get(....)
  assert response.status_code == 302
  with app.test_request_context('/'):
    expected_url = url_for(..., _external=True)
  assert response.headers['Location'] == expected_url
```

While if we had the `_external` keyword on the client's url_for function I could replace the last 3 lines with this(plus I wouldn't have to do the 2 imports):

``` python
assert response.headers['Location'] == client.url_for(..., _external=True)
```

It's not the best solution. It's just a concept of running out from situation when I need to get context dependant data for almost every view.

```
class MyView(BaseView):
    methods = ['GET']
    def dispatch_request(self):
        super(MyView, self).dispatch_request()
```

to get some attributes, like items in navigation menu

```
class BaseView(View):
    """
    BaseView provides parent class for most of the other views
    giving the content for navigation bar etc.
    """

    content = {}
    content['current_user'] = current_user

    def dispatch_request(self):
        """
        function dispatch_request is needed here, because db require
        app context is provided only in the dispatch_request scope
        """
        self.content['navigation_projects'] = sorted(get_project_mapping(db).keys())
```

`get_project_mapping is` is a reusable function

```
def get_project_mapping(db):
    projects_dict = {}
    projects = db.session.query(Project).filter(Project.name != None)
    for p in projects:
        projects_dict[p.name] = {
            'some_value: p.some_value,
        }
    return projects_dict
```

- [tests/test_helpers.py
  [135]](https://www.github.com/mitsuhiko/flask/blob/b24438b2c9df81db294d3c15681f7faf9a135970/tests/test_helpers.py#L135)
- [tests/test_helpers.py
  [127]](https://www.github.com/mitsuhiko/flask/blob/b24438b2c9df81db294d3c15681f7faf9a135970/tests/test_helpers.py#L127)

The Flask Doc Download link mentioned below are broken

http://flask.pocoo.org/docs/flask-docs.pdf

http://flask.pocoo.org/docs/flask-docs.zip

In function: implement_to_string, it build a **unicode** attribute and pass it to lambda expression.

``` python
def implements_to_string(cls):
        cls.__unicode__ = cls.__str__
        cls.__str__ = lambda x: x.__unicode__().encode('utf-8')
        return cls
```

I think it should be

``` python
def implements_to_string(cls):
        cls.__str__ = lambda x: x.__str__().encode('utf-8')
        cls.__unicode__ = cls.__str__
        return cls
```

There is one short section on instance paths in the configuration handling doc, but nothing else. I have questions like the following:

> Suppose I want to separate the application package, the instance directory and the configuration file. In other words, I want all three to be in different locations within the filesystem and I don't want those locations to be hard-coded in the package. The WSGI script should load the application factory from the package and pass the instance path and the configuration file to the factory, after which the factory returns an application object. The application and some of the blueprints registered on it should use the instance directory for uploads but not for configuration. How should I write my code in order to realize that?

Please help me find the answer to the question above, and please consider providing more documentation on the instance path!

[404](https://archive.today/VkEJb) on the PDF documentation.


I'm using Flask v0.10.1 and I have the following project structure:

```
test
├── api
│   ├── hello.py
│   └── __init__.py
├── config
│   ├── config.py
│   └── __init__.py
└── __init__.py
```

The hello.py file is:

``` python
import sys
import flask
from test.config import config

app = flask.Flask(__name__)

@app.route('/hello')
def hello():
    return config.MESSAGE

def main(argv):
    reloader = '--reloader' in argv
    print('Starting with reloader={}'.format(reloader))
    app.run(host='0.0.0.0', port=8080, debug=True, use_reloader=reloader)

if __name__ == '__main__':
    main(sys.argv)
```

and the config.py is simply

``` python
MESSAGE = 'Hello!'
```

When I run `api.py` with `use_reloader=False` (`python -m test.api.hello`) the server starts correctly. If I run it with `use_reloader=True` (`python -m test.api.hello --reloader`) it fails with:

```
Starting with reloader=True
 * Running on http://0.0.0.0:8080/
 * Restarting with reloader
Traceback (most recent call last):
  File "/home/kostas/Tmp/testproj/test/api/hello.py", line 3, in <module>
    from test.config import config
ImportError: No module named config
```


According to the Cambridge English Dictionary: "web server" == correct, "webserver" == incorrect.



I've been experimenting with Flask lately and when I came to this part of the tutorial [Redirects](http://flask.pocoo.org/docs/0.10/quickstart/#id4), I encountered a type error saying:

```
TypeError: redirect() takes 0 positional arguments but 1 was given
```

But when I checked the API documentation for `Flask.redirect` it states that it accepts 2 arguments `location` and `code`. Could this be a bug? I am using Flask 0.10.1, Python 3.4 on Windows 7.

Using single backticks and inline markup:

```
    :file:`app.py`, :file:`yourapp/templates`, :file:`/var/www/foo`
    :mimetype:`application/json`
    :command:`pip`, :option:`--debug`
    :exc:`TypeError`
```

Using double backticks and inline markup:

```
    ``True``, ``False`` and ``None``
    ``GET`` and ``POST``
    ``DEBUG``, ``SERVER_NAME``, ``PATH_INFO``
    ``/static``, ``/``
    ``Flask-Uploads``, ``X-Forwarded-Host``
    ``<body>``, ``|safe``
    ``with``, ``for``, ``self``
    ``.html``, ``.py``
```

Without backticks:

```
    `HTTP` -> HTTP
```

Fixed typo:

```
    requirements.rst -> requirements.txt
```

Hey,

this may be a bit specific, but I hope there is a way to solve this, and I'm just unable to work it out.

So, my setup is like this:
- My Flask-App is running on `127.0.0.1:5000`, `SERVER_NAME` is set to `blickpunkt.dev:5000`, `blickpunkt.dev` is an entry in my hosts-File, it just translates to `127.0.0.1`
- I'm running [BrowserSync](http://www.browsersync.io) with the proxy setting set to `blickpunkt.dev:5000`, and I can open the browser to `localhost:3000 to` see everything.

This mostly works. I can see the site, I can click on most links.

Except: When I'm using `redirect(url_for('some_view'))`, it redirects me to `localhost:3000:5000/some_view`. This is absurd. I looked into the response I was getting from the redirect, but the port isn't even in there. It seems to me that it should just redirect to `/some_view`, but it somehow puts the port the app is running on in there. If I remove the second port from the url, it works again, of course.

Can I fix this behaviour? How can I fix it?

Hi,

it would be extremely nice to have an extended or second url_for which only provides an url to the view function without the need of parameters. At the moment I have to workaround the standard url_for by making all parameters optional, which i think is not the right way around this, in order to make it usable in dynamical delivered javascript rest clients.

best regards

blackknight

A verb apparently missing.

Closes that `<p>` tag respecting the 80-chars-per-line standard.

I thought this sentence was a little confusing when I was reading the docs, so I tweaked it a bit.

I also considered wording it as: "Now, to use the database, all an application must do is either have an active application context (which is always true if there is a request in flight) or create an application context itself." -> if emphasizing the "all an application must do" part seems quite important.

Totally understand if this PR seems trivial/unnecessary/etc; just wanted to try throwing it out there since it was helpful to me.

Thank you!

According to http://dictionary.cambridge.org/ "webserver" is incorrect, "web server" = correct

Sorry in advance if it is not the right place to open this kind of issue.
I think it would be nice to have issues labelled 'good first bug' for people wanting to contribute but not knowing how to start.

http://flask.pocoo.org/docs/flask-docs.pdf  and http://flask.pocoo.org/docs/flask-docs.zip return 404 errors.

http://flask.pocoo.org/docs/flask-docs.pdf
Chapter 404: The Lost Page

I chose the option that is used more often in documentation:

```
     `True`, `False`, `None` for constants
     `GET`, `POST`, `HEAD` for HTTP methods
     `app.py`, `requirements.txt` for file names
     `pip`, `easy_install` for executables
     `static`, `templates` for folder names
```

But:

```
    ``DEBUG``, ``TESTING`` for config options
    ``/``, ``/backend`` for URL paths
    ``/var/www/yourapplication`` for filesystem paths
    ``X-Forwarded-Host``, ``X-Forwarded-For`` for HTTP headers
    ``Flask-Uploads``, ``Flask-SqlAlchemy`` for extension names (at least at the first mention)
    ``template.html``, ``layout.html`` for Jinja templates
    ``<body>``, ``<script>`` for HTML tags
    ``|safe``, ``{% extends %}`` for Jinja filters and codeblocks
```

And:

```
    HTTP, not `HTTP`
```

And yet it seems that `requirements.rst` should be a `requirements.txt`.

During edits sense was not injured.


http://flask.pocoo.org/docs/0.10/advanced_foreword/#the-status-of-python-3

> If you do want to dive into Python 3 already have a look at the python3_support page.

"python3_support" should link to http://flask.pocoo.org/docs/0.10/python3/

``` python
from flask import Flask

app = Flask(__name__)
app.config['DEBUG'] = True

@app.teardown_appcontext
def td_ac(exc):
    # This will not get called on the first request if the first request fails,
    # that is if /err is requested. It will be called on subsequent requests,
    # no matter if they're throwing exceptions or not.
    print('td_ac exception: %r' % exc)

@app.teardown_request
def td_req(exc):
    # This will not get called on the first request if the first request fails,
    # that is if /err is requested. It will be called on subsequent requests,
    # no matter if they're throwing exceptions or not.
    print('td_req exception: %r' % exc)

@app.route('/ok')
def ok():
    return 'ok'

@app.route('/err')
def err():
    raise Exception('error')

if __name__ == '__main__':
    app.run()
```

After last changes _iter_loaders makes no use of the 'template' argument.

Various typo fixes, wording unifications, and cosmetic changes.

I ran into this problem today with one of my applications trying to make it public to my local network.  

C:\Users\Savion\Documents\GitHub\Example-Flask-Website>flask\Scripts\python run.
py
- Running on http://127.0.0.1:5000/
- Restarting with reloader
  10.101.37.124 - - [26/Oct/2014 15:51:23] "GET / HTTP/1.1" 404 -
- Running on http://0.0.0.0:5000/
  10.101.37.124 - - [26/Oct/2014 15:51:38] "GET / HTTP/1.1" 404 -

The problem that i run into is the fact that this app continuously attempts to default to localhost. It is not until 2 Ctrl + C, that it goes to 0.0.0.0, then I still receive a 404 error in my browser.  I do have routes that are valid when running locally. I have tried to create a new virtualenv and i still recieve the same error, I reset the firewall rule on this application.  All effort that did not return rewarded.

Any Ideas onto why my app makes an attempt to startup on the localhost first then moves over, but then returns a 404?

Improved secret key generation by randomising seed and adding SHA-2 (SHA256) hash digest of it.  Added b64 and hexdigest variants.

Should probably use random.SystemRandom(Random) instead of os.random(), but this is supposed to be a quickstart and code should have a fallback to os.random f random.SystemRandom is not available.

Uses random, hashlib, os and (optionally) base64 standard modules instead of just os.

In accordance with the proposal #1214 the default value of `TEMPLATES_AUTO_RELOAD` is set to `None` and by default templates will be reloaded only if the application is running in debug mode. A complete table of the various options:

| `TEMPLATES_AUTO_RELOAD` | `DEBUG` | Templates auto reloaded? |
| --- | --- | --- |
| `None` | `False` | no |
| `None` | `True` | yes |
| `False` | `False` | no |
| `False` | `True` | no |
| `True` | `False` | yes |
| `True` | `True` | yes |


Continuing #1035 and #1218, #1135 related.

According to https://github.com/mitsuhiko/flask/issues/1092#issuecomment-47118613 and https://github.com/mitsuhiko/flask/pull/1085#issuecomment-45466907 , the correct order to attempt to import extensions should be:
1) flask_foo
2) flask.ext.foo
3) flaskext_foo.

According to https://github.com/mitsuhiko/flask/issues/1092#issuecomment-47118613 and https://github.com/mitsuhiko/flask/pull/1085#issuecomment-45466907 , the correct order to attempt to import extensions should be:
1) flask_foo
2) flask.ext.foo
3) flaskext_foo.


Where cat I get info of the Server IP that flask is running on?

app.config['SERVER_NAME'] returns None, any other options?

I made an attempt to run a flask based site using the git repo, but recieved the error that LoginManager is not defined.  I ran it again with the flask downloaded via "pip install flask" and it works fine.

I see that version 1.0 includes a lot of significant changes. It may be reasonable to change the default value of option `TEMPLATES_AUTO_RELOAD` to `False`. It will reduce mostly useless interaction with the hard drive and positive impact on performance.

I think most apps that use Flask will never change the template files on the fly in production, so this change is not reflected in their stability. For other cases, it remains possible to explicitly set the value to `True`. And of course, it will not affect the debugging capabilities.

More explanation in related PR: #876. It's merged, but default value is set to `True` for backward compatibility.

@untitaker, @kennethreitz what do you think about this?

This pull request is identical with #1184. I only added tests for it. 

@untitaker, you also are asked to add entry to changelog, but the method `get_namespace` was first introduced in version 1.0:

```
- Added :meth:`flask.config.Config.get_namespace`.
```

I think that adding another entry in the same list does not make sense.

I am trying to follow the [basic Flask tutorial online](http://flask.pocoo.org/docs/0.10/quickstart/#a-minimal-application) and getting a weird error; I've searched for a fix online but haven't seen anyone with this issue with Flask:

```
C:\Users\Gregory Gundersen\Documents\Research\flask-test>python run.py
Traceback (most recent call last):
  File "run.py", line 2, in <module>
    from app import app
  File "C:\Users\Gregory Gundersen\Documents\Research\flask-test\app\__init__.py", line 1, in <module>
    from flask import Flask
  File "C:\Python27\lib\site-packages\flask\__init__.py", line 21, in <module>
    from .app import Flask, Request, Response
  File "C:\Python27\lib\site-packages\flask\app.py", line 26, in <module>
    from . import json
  File "C:\Python27\lib\site-packages\flask\json.py", line 25, in <module>
    from itsdangerous import json as _json
  File "C:\Python27\lib\site-packages\itsdangerous.py", line 14, in <module>
    import hmac
  File "C:\Python27\lib\hmac.py", line 8, in <module>
    from operator import _compare_digest as compare_digest
  ImportError: cannot import name _compare_digest
```

Thoughts?

Hi,
First, read this: "[why use www](http://www.yes-www.org/why-use-www/)" if you didn't already...
### The problem

having many blueprints, with only _some_ blueprints having `subdomain` value set to a given subdomain, the rest of the blueprints should serve the root domain name (with the consideration of `www`)

**examples:**
- static blueprint set to serve `static.example.com`
- dashboard blueprint set to serve `dashboard.example.com`
- other blueprints, like users, frontend, messages, ..etc do not have `subdomain` set, and should serve `www.example.com` (assuming `example.com` auto redirect to `www.example.com`)

Setting `SERVER_NAME` to `example.com` wouldn't automatically handle the `www` part, and requires setting `www` as the subdomain of the rest of the blueprints, which I find it redundant and error prone.
Setting `SERVER_NAME` to `www.example.com` will cause other subdomain blueprints to generate `static.www.example.com` and `dashboard.www.example.com` which is not what you would expect.

I tried using `app.url_map.default_subdomain = 'www'` but it had no effect at all (did I miss anything else?)

As a workaround, I was forced to use this:

``` python
def configure_blueprints(app, blueprints):
    for blueprint in blueprints:
        if not blueprint.subdomain:
            blueprint.subdomain = 'www'
        app.register_blueprint(blueprint)
```
### Suggested solution

`www` is a special subdomain and should be treated a bit differently and in a more _explicit_ manner.
- add `DEFAULT_SUBDOMAIN` or `WWW` or something similar to Flask's set of config variables/flags beside `SERVER_NAME` (which should be noted in documentation that `SERVER_NAME` should in most of the cases hold the _naked_ domain name.)
- when `DEFAULT_SUBDOMAIN = 'www' # for instance` or `WWW = True`, blueprints subdomain defaults to the given value.
#### extras

We would also add `FORCE_WWW = Boolean`, and when set to `True` would redirect the naked domain to its `www` one. Or make the subdomain param accept an array of value in case one would serve the same content via the naked and the non naked version of their domain name (e.g. `example.com` and `www.example.com` would serve the same set of their related blueprints.)

These are just some suggestions, I might be wrong or missing something, and if it's the case, please inform me.

**Related issues** to take into consideration: https://github.com/mitsuhiko/flask/issues/998, https://github.com/mitsuhiko/flask/issues/905, https://github.com/mitsuhiko/flask/issues/821 .

In Flask 10.1 there is one namespace for route handlers, so there could be one function with the same name in each module. See example

``` python
# core.py
from flask import Flask

app = Flask('test')

@app.route('/hello_world')
def hello_world():
    return 'Hello World core!'
```

``` python
#tcore.py
import core

@core.app.route('/ahoj_svete')
def hello_world_():
    return "Ahoj svete"
```

This example crash with "AssertionError: View function mapping is overwriting an existing endpoint function: hello_world". Second problem is when i use some function name which is used by flask, for example **static**.

I ran into this issue today, googled it, and found [someone else having the same issue](http://stackoverflow.com/questions/20668883/flask-jsonify-object-is-not-iterable).

If you're using the JSON Encoder in Overholt, you may notice that passing one of your models to jsonify does not work.  It says "object is not iterable", even though your custom json encoder will turn it into an iterable in a moment.  This is because Flask is trying to make it into a dict before that can happen.

This patch fixes this case.  Also it allows you to return other legitimate singular json values such as integers and strings.  Hopefully this doesn't raise any security issues.  If it does, someone else may wish to handle this more carefully.

http://flask.pocoo.org/docs/0.10/api/#flask.Request.get_json

_My colleague said 'get Flask'._

_I said 'Okay! ... wow, looks cool, and it installs so easily! ... and this site is even built on it—how delightful! ... and I can download the docs as a zipped HTML—how convenient! ... and... the link's broken—how sloppy!' ;-)_

Since the site's supposed to be built on Flask, I thought this would be the place to report this. Please excuse me if this assumption is incorrect.

At **http://flask.pocoo.org/**, which Google took me to, **clicking either of the latter links in 'Read the documentation or download as [PDF](http://flask.pocoo.org/docs/flask-docs.pdf) and [zipped HTML](http://flask.pocoo.org/docs/flask-docs.zip)'** took me to http://flask.pocoo.org/docs/flask-docs.pdf and http://flask.pocoo.org/docs/flask-docs.zip, respectively. **Both 404ed.**


Read documentation in pdf button on the home page does not work. The same is the case with "zipped html"

homepage: http://flask.pocoo.org/
PDF: http://flask.pocoo.org/docs/flask-docs.pdf (doesn't work)
Zipped HTML: http://flask.pocoo.org/docs/flask-docs.zip (doesn't work)

`request.json` has not deprecated explicitly with warning.
So instead of removing it, start explicit deprecating.

Add "pretty" and "compressed" `separators` definitions in jsonify() method. Controlled by `JSONIFY_PRETTYPRINT_REGULAR` just as `indent` level is. Reduces response size by removing unnecessary white space included by default after separators.

Example: https://gist.github.com/pawl/8067c988b1cbfd48b855

I'm using Flask==0.10.1 and python 2.7.4.

Is there a way to release the large dictionary from memory after the return?

I have a Flask app that runs on https behind nginx. The app also uses flask-login to log users in.

I have set my app.secret_key and have 3 views:

```
@app.route('/')
def index():
    return render_template('index.html')

@app.route('/login', methods=['GET', 'POST'])
def login():
    form = Login()
    if form.validate_on_submit():
        # log the user in...
        ......
        return redirect(request.args.get('next') or '/')
    return render_template('login.html', form=form)

@login_required
@app.route('/logged_in')
def logged_in():
    return render_template('logged_in.html')
```

The vast, vast majority of my users do not log in (and don't have a user account) and some are complaining that we are setting cookies on them. I can confirm this behavior in my browser (Firefox) when I delete the cookie, visit "https://www.example.com" and see that the cookie gets reset.

How do I change the behavior so that the cookie only gets set if the user logs in?

Setting the MAX_CONTENT_LENGHT variable does nothing to limit a json payload larger than the set limit. We are using Flask Classy to write the post method and Flask to handle the requests.

```
<Config {'JSON_AS_ASCII': True, 'BASIC_AUTH_REALM': '', 'MONGO_UNIX_SOCKET': '/tmp/mongodb-27017.sock', 'REC_SYS_API_PORT': 5000, 'SQLALCHEMY_POOL_RECYCLE': None, 'MONGO_PORT': 27017, 'PROJECT_ROOT': '/home/project', 'SQLALCHEMY_POOL_TIMEOUT': None, 'SQLALCHEMY_RECORD_QUERIES': None, 'SESSION_COOKIE_DOMAIN': None, 'SESSION_COOKIE_NAME': 'session', 'DB_NAME': 'test_tracks', 'TRACK_ACTIONS': ['apply'], 'SQLALCHEMY_NATIVE_UNICODE': None, 'MAX_CONTENT_LENGTH': 65536, 'PERMANENT_SESSION_LIFETIME': datetime.timedelta(31), 'SQLALCHEMY_POOL_SIZE': None, 'SQLALCHEMY_MAX_OVERFLOW': None, 'TRAP_HTTP_EXCEPTIONS': False, 'BASIC_AUTH_FORCE': False, 'PRESERVE_CONTEXT_ON_EXCEPTION': None, 'SQLALCHEMY_ECHO': False, 'SESSION_COOKIE_PATH': None, 'LOGGER_NAME': 'rtr', 'MONGO_USE_SOCKET': True, 'SECRET_KEY': None, 'APP_NAME': 'trkc', 'SERVER_NAME': None, 'PREFERRED_URL_SCHEME': 'http', 'TESTING': False, 'MONGODB_SETTINGS': {'DB': 'test_tracks'}, 'USE_X_SENDFILE': False, 'SQLALCHEMY_DATABASE_URI': 'sqlite:////tmp/test.db', 'SESSION_COOKIE_SECURE': False, 'SEND_FILE_MAX_AGE_DEFAULT': 43200, 'SQLALCHEMY_BINDS': {'logsite': 'sqlite:////tmp/test_logsite.db'}, 'DEBUG': False, 'SQLALCHEMY_COMMIT_ON_TEARDOWN': False, 'APPLICATION_ROOT': None, 'JSONIFY_PRETTYPRINT_REGULAR': True, 'PROPAGATE_EXCEPTIONS': None, 'TRAP_BAD_REQUEST_ERRORS': False, 'JSON_SORT_KEYS': True, 'SESSION_COOKIE_HTTPONLY': True, 'MONGO_HOST': 'localhost'}>
```

Cheers

Tests unrelated to flask run when I follow the "living on the edge" setup instructions (http://flask.pocoo.org/docs/0.10/installation/#living-on-the-edge) and run make. This was especially confusing for someone like me who is new to the project because some of these tests fail.

They're located in path/to/flask/venv/lib/python2.7/site-packages/setuptools/tests/
### My setup

os: osx 10.9.5
python: 2.7.5
virtualenv: 1.11.6
pytest: 2.6.3
### Potential fix

```
diff --git a/Makefile b/Makefile
index e1835e8..3e1473d 100644
--- a/Makefile
+++ b/Makefile
@@ -3,7 +3,8 @@
 all: clean-pyc test

 test:
-       py.test
+       py.test examples
+       py.test tests

 tox-test:
        tox
```

i am using wtforms with flask framework. when i use DateTimeField i add format parameter. 
But datetime format is coming from user which is logged in

forms.py

``` python
    from flask import g
    from wtforms import *
    import wtforms.validators as v
    from flask.ext.babel import lazy_gettext as _
    from flask.ext.babel import npgettext as _n

    from app.app import app
    from app.base_forms import *
    from app.modules.post.models import *

    class PostForm(BaseForm):
        post_date = DateTimeField("Post Date", format = app.config.get("DATETIME_FORMAT"), validators =[v.Required(message=_("Post date is required"))]  )
```

i set value of app.config.get("DATETIME_FORMAT") on before request

``` python
    @app.before_request
    def before_request():
        if g.user.language == "tr"
            app.config["DATETIME_FORMAT"] = "%d.%m.%Y %H:%M"
        else:
            app.config["DATETIME_FORMAT"] = "%m-%d-%Y %H:%M"
```

my application structure

```
    /app
        /modules
            /post
                /controllers.py
                /forms.py
                /models.py
        /app.py
    /run.py
```

content of /app/app.py

``` python
    from flask import Flask, url_for, g, request, redirect, render_template
    app = Flask(__name__)
    app.config.from_object('app.config.config.ConfigDevelopment')

    # Import Modules
    from modules.post.controllers.admin import module as modulePostAdmin
    app.register_blueprint(modulePostAdmin)

    # other codes here

    @app.before_request
    def before_request():
        if g.user.language == "tr"
            app.config["DATETIME_FORMAT"] = "%d.%m.%Y %H:%M"
        else:
            app.config["DATETIME_FORMAT"] = "%m-%d-%Y %H:%M"
```

content of /run.py

``` python
    from app.app import app
    app.run(host='localhost', port=8080, debug=True)
```

when i start app it throws that error "KeyError: 'DATETIME_FORMAT'". i think forms.py load before request so it throws keyError.
This problem is not only about wtforms, i will get this problem in every codes which out of context. What is the correct way for solving this problem. 

I get "Chapter 404: The Lost Page" message while I click to download the pdf documentation

There was no unittest for the appcontext_tearing_down signal, therefore I added one.

As a new user, I found that errors / stack traces were being swallowed. I searched for 'debug' in the documentation and found the Debug Mode section.

What I really wanted to know was how logging worked; it took me ages to find out because other frameworks (e.g. Rails) just calls this debugging.

This pull request adds a reference to the documentation that I think will help other people in this situation.

 i am trying to get all errors as list.
i have BaseForm

``` python
from flask.ext.wtf import Form

class BaseForm(Form):
    @property
    def error_list(self):
        _errors = []
        for fieldName, errorMessages in self.errors.iteritems():
            _errors.extend(errorMessages)
        return _errors
```

my form class

``` python
from app.base_forms import *
from wtforms import StringField, TextField, PasswordField
import wtforms.validators as validators

class LoginForm(BaseForm):
    email    = StringField('Email Address', [ validators.Email(), validators.Required(message='Forgot your email address?')])
    password = PasswordField('Password', [ validators.Required(message='Must provide a password. ')])
```

``` python
def login(self):
    form = LoginForm()
    print  form.error_list
    print form.errors
    ...
```

this output form.errors

```
    "email": [
      "Forgot your email address?"
    ], 
    "password": [
      "Must provide a password. "
    ]
```

this output form.error_list

```
[
    "Must provide a password. ", 
]
```

Normally form has two errors but form.error_list return only one error that "Must provide a password."
what is the wrong.
How can i solve this problem?

The [PDF](http://flask.pocoo.org/docs/flask-docs.pdf) and  [HTML](http://flask.pocoo.org/docs/flask-docs.zip) linked on Flask's homepage cannot be found (404) .

Self-explanatory.

Self-explanatory.

I am trying to do that example http://flask.pocoo.org/docs/0.10/blueprints/#templates .

My application structure

``` code
/app
    /modules
        /module_test
            controllers.py
            /templates
                 /test
                      index.html
    /templates
```

/app/modules/module_test/controllers.py

``` python
module = Blueprint('test', "test",  url_prefix='/test', template_folder='templates' )

class TestController(PublicController, View):
    methods = ["GET", "POST"]
    viewData = {}

    def __init__(self):
        super(TestController, self).__init__()

    def dispatch_request(self):
        self.viewData["title"] = "Test"
        return render_template( "test/index.html", **self.viewData )


module.add_url_rule('/', view_func=TestController.as_view('test'))
```

the error is **"jinja2.exceptions.TemplateNotFound TemplateNotFound: test/index.html"**.
i put index.html in /app/templates/test/index.html and i tried with flask classy it worked.

i want to put template files in blueprint that "/app/modules/module_test/templates". How can i solve this problem?

```

======================================================================
ERROR: test_timelines (minitwit_tests.MiniTwitTestCase)
Make sure that timelines work
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/tmp/nix-build-pypy2.4-flask-0.10.1.drv-0/Flask-0.10.1/flask/testsuite/../../examples/minitwit/minitwit_tests.py", line 109, in test_timelines
    self.register_and_login('foo', 'default')
  File "/tmp/nix-build-pypy2.4-flask-0.10.1.drv-0/Flask-0.10.1/flask/testsuite/../../examples/minitwit/minitwit_tests.py", line 55, in register_and_login
    return self.login(username, password)
  File "/tmp/nix-build-pypy2.4-flask-0.10.1.drv-0/Flask-0.10.1/flask/testsuite/../../examples/minitwit/minitwit_tests.py", line 50, in login
    }, follow_redirects=True)
  File "/nix/store/hdq8nfhsjv4rlkzp76c6zwq9vb37his2-pypy2.4-werkzeug-0.9.4/lib/pypy2.4/site-packages/werkzeug/test.py", line 771, in post
    return self.open(*args, **kw)
  File "/tmp/nix-build-pypy2.4-flask-0.10.1.drv-0/Flask-0.10.1/flask/testing.py", line 108, in open
    follow_redirects=follow_redirects)
  File "/nix/store/hdq8nfhsjv4rlkzp76c6zwq9vb37his2-pypy2.4-werkzeug-0.9.4/lib/pypy2.4/site-packages/werkzeug/test.py", line 735, in open
    response = self.run_wsgi_app(environ, buffered=buffered)
  File "/nix/store/hdq8nfhsjv4rlkzp76c6zwq9vb37his2-pypy2.4-werkzeug-0.9.4/lib/pypy2.4/site-packages/werkzeug/test.py", line 658, in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
  File "/nix/store/hdq8nfhsjv4rlkzp76c6zwq9vb37his2-pypy2.4-werkzeug-0.9.4/lib/pypy2.4/site-packages/werkzeug/test.py", line 854, in run_wsgi_app
    app_iter = app(environ, start_response)
  File "/tmp/nix-build-pypy2.4-flask-0.10.1.drv-0/Flask-0.10.1/flask/app.py", line 1836, in __call__
    return self.wsgi_app(environ, start_response)
  File "/tmp/nix-build-pypy2.4-flask-0.10.1.drv-0/Flask-0.10.1/flask/app.py", line 1820, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/tmp/nix-build-pypy2.4-flask-0.10.1.drv-0/Flask-0.10.1/flask/app.py", line 1403, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/tmp/nix-build-pypy2.4-flask-0.10.1.drv-0/Flask-0.10.1/flask/app.py", line 1817, in wsgi_app
    response = self.full_dispatch_request()
  File "/tmp/nix-build-pypy2.4-flask-0.10.1.drv-0/Flask-0.10.1/flask/app.py", line 1477, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/tmp/nix-build-pypy2.4-flask-0.10.1.drv-0/Flask-0.10.1/flask/app.py", line 1381, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/tmp/nix-build-pypy2.4-flask-0.10.1.drv-0/Flask-0.10.1/flask/app.py", line 1475, in full_dispatch_request
    rv = self.dispatch_request()
  File "/tmp/nix-build-pypy2.4-flask-0.10.1.drv-0/Flask-0.10.1/flask/app.py", line 1461, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/tmp/nix-build-pypy2.4-flask-0.10.1.drv-0/Flask-0.10.1/flask/testsuite/../../examples/minitwit/minitwit.py", line 201, in login
    request.form['password']):
  File "/nix/store/hdq8nfhsjv4rlkzp76c6zwq9vb37his2-pypy2.4-werkzeug-0.9.4/lib/pypy2.4/site-packages/werkzeug/security.py", line 224, in check_password_hash
    return safe_str_cmp(_hash_internal(method, salt, password)[0], hashval)
  File "/nix/store/hdq8nfhsjv4rlkzp76c6zwq9vb37his2-pypy2.4-werkzeug-0.9.4/lib/pypy2.4/site-packages/werkzeug/security.py", line 117, in safe_str_cmp
    return _builtin_safe_str_cmp(a, b)
TypeError: unsupported operand types(s) or combination of types: 'str' and 'unicode'

----------------------------------------------------------------------
```

http://flask.pocoo.org/docs/flask-docs.pdf

http://flask.pocoo.org/docs/flask-docs.zip

Tornado's WSGI server is less scalable than the alternatives and only really makes sense when you have a specific need to run both WSGI apps and Tornado-native apps in the same process. This recommendation has been an ongoing source of confusion, e.g. http://stackoverflow.com/questions/26015116/making-tornado-to-serve-a-request-on-a-separate-thread.

Fixes #986.

I was reading the docs, and it seemed there were a few easy fixes to make. I tried never to change the meaning of a sentence.

I hope this is useful, I certainly don't mean to be insulting.

The changes are as follows:
- "in lack of" -> "for lack of"
- pillar's -> pillars
- ~~however~~
- a touch of cleanup to the "two ways" paragraph
- ~~on there~~
- "database connects" -> "database connections"


I want to load all of my `CELERY_` options from the config and leave `CELERY_` on there.

url converters: match the [API docs for url-route-registrations](http://flask.pocoo.org/docs/0.10/api/#url-route-registrations)

When making Flask 1.0, could you remove some old APIs?

- [x] deprecate `flask.ext`, see #1484 and #1135 
- [x] remove modules, see #1204 and #861
- [x] deprecate `*_session()`
- [x] Allow all objects in JSON, see #673, #1177, #248, #170, #510
- [x] deprecate `request.json,` see #1206 and #1204 
- [x] remove support for name guessing from `send_file` #1427

small change here, but I suppose there was typo errors in the README of flaskr & minitwit?

I tried viewing some of the bundled docs with https://www.tele3.cz/jbar/rest/render.py and restview. Both returned errors.

Are there docs somewhere that would apply to latest version of test_flaskr which uses pytest?

[This one](http://flask.pocoo.org/docs/0.10/) uses unittest.

I know this might sound silly, but it's actually quite a problem for me.

I have integration tests that test our infrastructure, which contains multiple web services and daemons. I wrote a small wrapper that, inside a test, when you try to access a web service, would launch it. How it works for our non-python web apps is that it launches server process and waits for a regexp that it would produce, containing "listening on ..." phrase. That would mean it's ready to serve requests.

Currently, our flask app prints this output when you launch app.py:

```
(tldr-env)➜  tldr-mediabuyer git:(staging) ✗ python app.py
 * Running on http://127.0.0.1:5000/
 * Restarting with reloader
```

Unfortunately, neither of these means app actually listens on those ports (it takes more than a second to actually serve requests).

So, my proposal is to only print "Running on ..." when you actually accept requests. Same for "Restarting with reloader".

I hope idea is clear and not too weird :) Thanks!

p.s.: when I said "quite a problem" I didn't mean it's hard to solve. It can be "solved" in multiple ways, but I would prefer this one as one that doesn't require you to either "sleep" or "curl some url in a loop" solutions.

I wanted to serialize objects using `for_json` methods, but I found it cumbersome to pass the `for_json=True` argument to simplejson when using Flask's `jsonify` method. Since there are other useful overrides during (de)serialization, I propose that Flask's config-object should be able to override all json options. The already supported ascii, sort_keys, prettyprint and indent-options are still supported, and take precedence over any new values.

Consider `jsonify()`cation of a dictionary contained in a list:

``` python
print flask.__version__
print repr(flask.jsonify([{"a": 1, "b": 2}]).data)
```

With the following output:

``` python
0.10.1
'{\n  "a": "b"\n}'
```

`jsonify()` has -- without complaining -- mangled the data into something really not useful: The original dictionary values are gone, and the `"b"` key suddenly is a value.

I appreciate that top-level array elements are not allowed to be created in Flask's `jsonify()` implementation (http://flask.pocoo.org/docs/0.10/security/#json-security). Also, there are for sure straight-forward strategies for solving this in application code, for example by wrapping the list in a dictionary: `jsonify({"items": collection})`.

However, in the Python world we do not find it very often that an entity accepts invalid input and produces garbled output without complaining. Also, it looks like `jsonify()` once raised an exception when provided a list (at least in 2011 it did raise a `TypeError`: https://github.com/mitsuhiko/flask/issues/170).

Should we raise an exception again or is the current behavior carefully designed with a focus on performance? I mean, it is unlikely that this data mangling ends up in a production environment (a developer really should realize that `jsonify()` produces garbage in this case , like I did).

This seems like a sane default, since Flask turns on autoescape by default for html files when using the more common `render_template` so users will be expecting `render_template_string` to autoescape their template variables.

Removing the old `run-tests.py` documentation. Maybe there's something more you want to add.

I was experimenting with making a clean build of a project of mine that includes `flask 0.10.1`. I was going to run `git clean -fdx` to get a pristine clean environment to build from, but it crashes:

```
thiderman@dragonisle ~/git/piper venv:piper(master:+6) 
> git clean -fdx -n 
Would remove .coverage
Would remove .tox/
Would remove argparse-1.2.1-py2.6.egg
Would remove bin/
fatal: Not a git repository: /Users/mitsuhiko/Development/flask/.git/modules/docs/_themes
```

If I remove `docs/_themes/.git` it works. git autodetects it and thinks that it's a submodule, and since my computer is not @mitsuhiko's Mac machine it kinda fails. :P

Could this file be excluded from the tarball? I can't really see that it serves a purpose, and it breaks my project in an unexpected way.

On ubuntu 14.04, python3 -mpdb ... raises exception after hitting 
'c' to run on the 'import flask' statement:

Traceback (most recent call last):
  File "/usr/lib/python3.4/importlib/util.py", line 95, in find_spec
    spec = module.**spec**
AttributeError: 'module' object has no attribute '**spec**'

Works fine for python 2.7 though.

Here is the myflaskapp.py:

import flask
app = flask.Flask(**name**)
@app.route('/')
def root():
    return ('root')
if **name** == '**main**':
    app.run(debug=True)


This link from main page gives 404 error: http://flask.pocoo.org/docs/flask-docs.pdf

This signal would receive the name of the template and the context and would be able to modify the context before the template is actually rendered. It could even go one step further and use the return value from the signal instead of rendering the template if it's not None.

Still WIP, but that way it can already be reviewed and commented on.

Tests are still missing and so is a `Blueprint.app_cli` which registers app-level commands from a blueprint (which I think makes sense depending on how one uses blueprints).

When finished, this will close #1357 

Skip directories which don't contain unittests and especially virtualenvs (in folders named `env*`).
Otherwise you get ugly failures when running tests because pytest descends into the virtualenv.

Make /scripts into package and change setup.py to allow for command line execution of the import migration tool (#1342).

While updating the docs for #1366 I realized I needed to make the import migration tool easily executed through the command line. I will wait on submitting changes to #1366 until we can decide on how to implement use of the tool.

Update docs so extension developers are urged to use the new import format in preparation for removing the magic `.ext` redirection tool. See #1135.

The underlying implementation of flash'ed messages currently uses a list of category, message tuples. This commit changes that to the more natural dictionary from category -> list of messages implementation. This still allows duplicate messages per category, but makes adding flash messages use fewer object allocations, and filtering flash messages by category faster by completely ignoring messages not in the desired set of categories.

Addresses some concerns presented in issue #1157, although I don't think it is necessary to add click to the README.

There was no trailing paragraph tags on lines 77 & 78 for some reason.

What about Flask 1.0 roadmap?

1. File structure:

```
project -
      - templates \
                - a \
                      search.html
                - b \
                      search.html
      - start.py
      - myapplication \
                - test.py 
```
1. Start file:

```
# start.py
from flask import Flask
from myapplication.test import test_blueprint

app = Flask(__name__)
app.register_blueprint(test_blueprint)
```
1. my application

```
# test.py
from flask import Blueprint, render_template, abort
from jinja2 import TemplateNotFound

test_blueprint = Blueprint('test_blueprint', __name__,
                        template_folder='absolute_path_to_project/templates/a')  
                        # YES, I specified the absolute path to the template a

@test_blueprint.route('/test')
def show():
    try:
        return render_template(''search.html") # HERE is the problem
    except TemplateNotFound:
        abort(404)
```

Is this a problem? 
        # Actually, I want to render **a/search.html**
        # But, `render_template()` does not use **test_blueprint's template_folder**
        # `render_template()` search the **template list**, find the first **search.html**, then render
        # So, maybe render **a/search.html** or **b/search.html**
        # This depend on the sequence of the **template list**

This pull request is in regards to issue #1317. I reproduced the 400 error that kenjones-cisco was talking about using this code: gist.github.com/keyanp/bc4d1a3a1e6c5cb5170a

So I took a look at making a subclass of BadRequest, but indeed this is part of Werkzeug. So instead I was thinking of adding the ValueError content to the shell console or to the response body. By just adding the exception to the response body it at least improves the 400 message and probably will make it easier to debug. The response body (which is also in the gist above) would now look like:

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<title>400 Bad Request</title>
<h1>Bad Request</h1>
<p>No JSON object could be decoded</p>
```

If this isn't really that helpful perhaps I can just output the exception details to the console? Could someone point me in the direction of where in the codebase Flask handles console logging?

Hi, I need to be able to disable flasks internal logger as I have implemented my own within my application that utilises Flask.

I would like this ability whether I am in debug mode or not.

TAI

See pull request #1342. Fixes logic so that imports that should not be changed are skipped, which was not happening correctly before. This was huge oversight on my part. I added a test for normal imports that shouldn't be touched.

It would be great to have access to the functionality of `app.cli.command` via blueprints - i.e. something like:

``` python
blueprint = Blueprint('myblueprint', __name__,)

@blueprint.cli.command()
def doblueprintstuff():
    """Initialize the database."""
    #....
```

It would help a lot when building modular applications.

This link:

http://flask.pocoo.org/docs/flask-docs.pdf

on this page:

http://flask.pocoo.org/

Generates a 404.

Hello all,

I just upgraded to Werkzeug 0.10, after which I install watchdog to get the new inotify reloader working to help reduce CPU usage on my laptop. However, the reloader no longer works (or at am minimum is random in what it detects). 

To start debugging, I tried to run the sample watchdog code on their homepage (https://pypi.python.org/pypi/watchdog) in an iPython shell and initially got an error. It related to not being able to allocate inotify watches due to a system constraint. After upping the limit (echo "131072" >> /proc/sys/fs/inotify/max_user_watches), I was able to run the code in the shell.

However, after that, the reloader still does not work. I am not sure what else I can do to help debug this, as watchdog seems to import correctly and my app does not throw any errors. Some diagnostic details:

 % lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 14.04.1 LTS
Release:    14.04
Codename:   trusty

Versions:
Werkzeug==0.10.1
watchdog==0.8.3
Flask==0.10.1

Please let me know if you need further information, I would be glad to debug.

Simple changes to documentation of patterns/flashing.html

Hi everyone!

Since I updated werkzeug to 0.10.1 this morning reloader stopped working. Is any specific configuration required besides installing watchdog?

I run with:

``` python
run_simple(
        hostname='0.0.0.0',
        port=5000,
        application=app,
        use_reloader=True,
        use_debugger=True,
        reloader_type='watchdog'
    )

# * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)
# * Restarting with inotify reloader
```

I'm under vagrant and tried both with and without NFS to no success.

With the last Werkzeug (0.10.1) I get the following error message:

```
Exception in thread Thread-1:
Traceback (most recent call last):
  File "C:\PGM\Python27\lib\threading.py", line 810, in __bootstrap_inner
    self.run()
  File "C:\PGM\Python27\lib\threading.py", line 763, in run
    self.__target(*self.__args, **self.__kwargs)
  File "C:\PGM\Python27\lib\site-packages\werkzeug\serving.py", line 602, in inner
    passthrough_errors, ssl_context).serve_forever()
  File "C:\PGM\Python27\lib\site-packages\werkzeug\serving.py", line 506, in make_server
    passthrough_errors, ssl_context)
  File "C:\PGM\Python27\lib\site-packages\werkzeug\serving.py", line 450, in __init__
    self.socket = ssl_context.wrap_socket(self.socket,
AttributeError: 'Context' object has no attribute 'wrap_socket'
```

Reverting to Werkzeug 0.9.6 make it work again like a charm.

When trying to change the flask.json_decoder to my own decoder, the unserialisation of cookies doesn't work anymore.

```
# -- coding: utf-8

from flask import Flask, flash, url_for, redirect, render_template_string
from flask.json import JSONEncoder, JSONDecoder


template = """
<!DOCTYPE html>
<html><head><title>Test JSON encoder/decoder</title></head><body>
{% with messages = get_flashed_messages(with_categories=true) %}{% if messages %}{% for message in messages %}
<p>Flash: {{ message }}</p>
{% endfor %}{% endif %}{% endwith %}
<p>Flash should be: ['Flash message', 'success']</p>
<p><a href="{{ url_for('index') }}">Try again</a></p>
</body></html>
"""


class CustomJSONEncoder(JSONEncoder):
    """ Do nothing custom json encoder """
    def default(self, obj):
        return super(CustomJSONEncoder, self).defaults(obj)


class CustomJSONDecoder(JSONDecoder):
    """ Do nothing custom json decoder """
    def __init__(self, *args, **kargs):
        super(CustomJSONDecoder, self).__init__(object_hook=self.decode)

    def decode(self, d):
        return d


app = Flask(__name__, static_url_path='')
app.config['SECRET_KEY'] = 'secret-key'
app.json_encoder = CustomJSONEncoder
app.json_decoder = CustomJSONDecoder        # WorkingCustomJSONDecoder


@app.route('/')
def index():
    flash('Flash message', 'success')
    return redirect(url_for('display'))


@app.route('/b')
def display():
    return render_template_string(template)


if __name__ == '__main__':
    app.run()
```

For the cookies to work again I should copy part of TaggedJSONSerializer in my decoder...

```
import uuid
from base64 import b64decode
from werkzeug.http import parse_date
from markupsafe import Markup
from flask._compat import iteritems


class CustomJSONDecoder(JSONDecoder):
    """ Do nothing custom json decoder """
    def __init__(self, *args, **kargs):
        super(CustomJSONDecoder, self).__init__(object_hook=self.decode)

    def decode(self, d):
        # Copy of the code from Flask.sessions.TaggedJSONSerializer(object).loads(self, value).object_hook(obj)
        if len(d) == 1:
            the_key, the_value = next(iteritems(d))
            if the_key == ' t':
                return tuple(the_value)
            elif the_key == ' u':
                return uuid.UUID(the_value)
            elif the_key == ' b':
                return b64decode(the_value)
            elif the_key == ' m':
                return Markup(the_value)
            elif the_key == ' d':
                return parse_date(the_value)
        return d
```

Could it be a but or most probably an error from my part?

It would be a nice speed increase for `pip install flask` if the PyPI release had wheel distributions.


When streaming, changes to the session object at the start of the request 
processing are never saved at all, the moment template rendering starts, a new 
session object is created which is then saved.

The statement on IRC was first that this is due to the fact that sessions (by default) are stored client side, and can not change anymore after the headers are send.
This is only true for sessions that are stored client side, if the sessions are server side it should be possible to change (and save) them during the whole request/response.
The real problem here seems to be that a new session is created when the stream starts.

We used the following example to stream contents: http://flask.pocoo.org/docs/0.10/patterns/streaming/

For now a workaround is to explicitly save the session after modifying, before rendering the template / starting the stream.

Expected output is always the same, one time session open and one time session save.
In the stream example the output is different; 2 sessions are opend, the first one is the one that changes, but the second one (this is opened when the stream starts) is the only one that is saved.

See https://github.com/graup/flask-restless/blob/post-excluding-id/tests/test_manager.py#L568. Here we are trying to catch an exception using the `nose.tools.raises` decorator. On Python 3, we seem to be running into an issue with Flask's extension import redirect.

The issue is that when the exception gets raised (in https://github.com/graup/flask-restless/blob/post-excluding-id/flask_restless/manager.py#L484), it gets raised as an instance of `flask_restless.manager.IllegalArgumentError`, not as an instance of `flask.ext.restless.manager.IllegalArgumentError`. This can be verified by the code below (if you have the source code for Flask-Restless available in your current working directory):

```
>>> from flask.ext.restless.manager import IllegalArgumentError as E1
>>> from flask_restless.manager import IllegalArgumentError as E2
>>> E1
<class 'flask.ext.restless.manager.IllegalArgumentError'>
>>> E2
<class 'flask_restless.manager.IllegalArgumentError'>
>>> E1 is E2
False
```

Now when nose tries to check for a raised instance of `flask.ext.restless.manager.IllegalArgumentError`, it doesn't find one, because the raised exception is really an instance of `flask_restless.manager.IllegalArgumentError`. What I would expect to happen is that `E1 is E2`.

Signed-off-by: Edward Z. Yang ezyang@cs.stanford.edu

On http://flask.pocoo.org/docs/latest/api/#flask.send_file the following is suggested:

> Please never pass filenames to this function from user sources without checking them first. Something like this is usually sufficient to avoid security problems:
> 
> ```
> if '..' in filename or filename.startswith('/'):
>        abort(404)
> ```

This is _terrible_ advice. It would be much better to tell people that if they want to pass in filenames, they should use http://flask.pocoo.org/docs/latest/api/#flask.send_from_directory instead.



This is an early commit to get some feedback. This script supports single imports in two formats. I am concerned that the naive approach is not what you guys are looking for. I would obvious add support for multiple imports and the third case `import flask.ext.foo` => `import flask_foo`. But the solution is definitely super hacky.

This fixes the problem of python packaging considering an installed dev version older than 0.0.

In snippets -> decorators -> Verify a Google authentication token
I would change:

```
                       headers={'Host': 'www.googleapis.com',
                                'Authorization': access_token})
```

to:

```
                       headers={'Host': 'www.googleapis.com',
                               'Authorization': 'Bearer '+access_token
                       })
```

You can try in https://developers.google.com/oauthplayground/

Issue #348 

I want to separate an app with various blueprints, frontend, backend, etc.. But when I try to register my frontend blueprint with follow code, my static css, images, js don't load.

``` python
front = Blueprint('front', __name__, static_folder='static', template_folder='./templates', url_prefix='/')
```

After debugging I found the problem. It's when try to register route, it tries to register route like //static (https://github.com/mitsuhiko/flask/blob/master/flask/blueprints.py#L68)

And then when use url_for the werkzeug routing.py (https://github.com/mitsuhiko/werkzeug/blob/master/werkzeug/routing.py#L1655) resolve url_for //static/filename it found a problem beacause there are two rules like this: 

``` python
[<Rule '/static/<filename>' (HEAD, OPTIONS, GET) -> static>, <Rule '//static/<filename>' (HEAD, OPTIONS, GET) -> front.static>]
```

So, a simple solution like concatenate a `blueprint.name` before url_prefix when is "/" resolve this conflict and now we can  use `url_for('front.static', filename='2.jpg')` routing resolves without problem.

I got bitten by the not-optimally-documented fact that the return values of `before_request` callbacks aren't ignored.

The `stream_with_context` decorator currently just throws away `*args` and `**kwargs`; it would be helpful to pass them along to the generator.

If I have an URL 'http://localhost/test?p=%23iphone&q=http%3A%2F%2Fwww.google.com', when I use request.url it returns a decoded version:

```
In [9]: 'http://localhost/test?p=#iphone&q=http://www.google.com'
```

The problem is I cannot use urllib.parse on the decoded version, as it will return wrong result:

```
In [9]: urlparse('http://localhost/test?p=#iphone&q=http://www.google.com')
Out[9]: ParseResult(scheme='http', netloc='localhost', path='/test', params='', query='p=', fragment='iphone&q=http://www.google.com')
```

I cannot encode it back to correct version too:

```
In [11]: quote_plus('http://localhost/test?p=#iphone&q=http://www.google.com')
Out[11]: 'http%3A%2F%2Flocalhost%2Ftest%3Fp%3D%23iphone%26q%3Dhttp%3A%2F%2Fwww.google.com'
In [13]: quote('http://localhost/test?p=#iphone&q=http://www.google.com')
Out[13]: 'http%3A//localhost/test%3Fp%3D%23iphone%26q%3Dhttp%3A//www.google.com'
```

How can I get the correct encoded URL? I think I can use request.args, but it there a better way? I also want to include possible params and fragment, are there any information from request?


Where: http://flask.pocoo.org/docs/0.10/api/#flask.g

"On top of that it will delegate access to the current application’s JSOn encoders and decoders for easier customization."

Should be JSON not JSOn, right?

At
http://flask.pocoo.org/
there is a link "zipped HTML" to
http://flask.pocoo.org/docs/flask-docs.zip
giving 404.

Please fix :)



Method is_json (flask/wrappers.py:112) tests whether mimetype is in format 'application/...+json'. According to http://tools.ietf.org/html/rfc2045, mime types are case insensitive.

'The type, subtype, and parameter names are not case sensitive.  For example, TEXT, Text, and TeXt are all equivalent top-level media types.'

So mimetype 'ApLiCaTiOn/jSoN' is technically fine (and yes, extremely rare) and as the method tests the mimetype just for lowercase mimetype 'application/json' the previous example will fail, yet it should be ok.

Officially the pocoo projects follow its own styleguide, however, there are no tools built around this style, so I'd recommend sticking to PEP8. Flake8 has very sensible defaults, and apart from the ever-controversial line length limit, it should be possible to integrate it into Flask quickly.

``` python
app = Flask(__name__)

@app.route('/')
def form():
    return render_template('form_submit.html')
@app.route('/hello/', methods=('POST'))
def hello():
    name=request.form['yourname']
    email=request.form['youremail']
    return render_template('form_action.html', name=name, email=email)

# Run the app :)
if __name__ == '__main__':
  app.run( 
        host="0.0.0.0",
        port=int("7777")
  )
```

While tupple is iterable for flask accept this without any error warning or problem: even more: ("GET", "POST") works as well as ["GET", "POST"].
However with single element string there is problem:

``` python
import requests
r = requests.post("http://127.0.0.1:7777/hello")
print("Status code: {}".format(str(r.status_code)))
print("Headers: {}".format(r.headers))
```

Output:

``` python
Status code: 405
Headers:  {'Allow': 'O, OPTIONS, T, P, S', 'Date': 'Wed, 28 Jan 2015 07:38:05 GMT', 'Content-Type': 'text/html', 'Server': 'Werkzeug/0.9.6 Python/3.4.2', 'Content-Length': '178'}
```

Seems that flask happily parses (("POST")) letter by letter. Posting with curl using method "P"  is valid thing in flask.
While it is stupid use case, I doubt that Flask should happily churn  String letter by letter. Also I think that after possible fix it would be easy to unit test :smirk: I think even for custom method definition this is not a valid or good behaviour.

when i register a blueprint in my flask app,an error occurred,the error msg is :
`

```
             /usr/bin/python3.4.2 /data/AppCode/05CodeNet/MicroStone_flask/runServer.py
             Traceback (most recent call last):
             File "/data/AppCode/05CodeNet/MicroStone_flask/runServer.py", line 11, in <module>
             app.register_blueprint(login)
             File "/home/zhgk/.local/lib/python3.4/site-packages/flask/app.py", line 62, in wrapper_func
             return f(self, *args, **kwargs)
             File "/home/zhgk/.local/lib/python3.4/site-packages/flask/app.py", line 880,
             in register_blueprint
            if blueprint.name in self.blueprints:
            AttributeError: 'function' object has no attribute 'name'
```

`

and  my py code is :

runserver.py:
`

```
       # -*- coding: utf-8 -*-
        """
             Flask应用启动入口
       """

        from flask import Flask

        from apps.login.ctrl.login import login

        app = Flask(__name__)
        app.register_blueprint(login)
        if __name__ == "__main__":
               app.run()
        __author__ = 'zhgk'
```

`

login.py : 

`

```
          # -*- coding: utf-8 -*-
               """

            """

            from flask.blueprints import Blueprint

             login = Blueprint('login', __name__)


             @login.route("/")
            def login():
                 return "Login"


              __author__ = 'zhgk'
```

`

anyone can tell me why?

Add support for the datetime.date type to jsonify, which currently only supports the datetime.datetime type.
##### Changelog
1. datetime.date type support in flask.json.jsonify

Change URL to IRI and update examples to include extended characters. See also this question on stackoverflow.com: http://stackoverflow.com/questions/28056959/in-python-flask-how-to-access-complete-raw-url-prior-to-un-escaping/28058628#28058628

I've been trying to use test_client with some simple services I've made but noticed that when calling a service sending something through the query string, nothing is received on the endpoint. So:

test_client.get("http://localhost/api1_0/some-service?param1=value1")

(Actually I use url_to())

gets to some-service as expected, but the request.args collection is empty. This call works perfectly if I use an external tool like curl.

Debugging, I've got to the method make_test_environ_builder (testing.py) where url.path is used but url.querystring is just disregarded. 

In the end, I've found a workaround (while writing this issue):

test_client.get("http://localhost/api1_0/some-service", query_string = "param1=value1")

The added parameter travels to the EnvironBuilder.

It seems to me that this is a bug since there is no reason why the query string should be disregarded in the first place. But I am new to Flask so I may be missing something

Thank you.

Extra slashes in the URL change the routing. For example, `/x` and `//x` do not route the same way. 
Here's a unit test which demonstrates this:

https://gist.github.com/robnagler/1a5d0361cc71a6806fc6

If you put a proxy in front of flask, it will normalize the URLs so this isn't an issue. It would seem, however, that Flask should normalize the URLs as well.

In http://flask.pocoo.org/docs/0.10/installation/#windows-easy-install the distribute_setup.py link looks like the domain owner didn't renew or lost the site so the script is not there. 

I looked elsewhere for a good script, not sure which one would be the best to think to. A lot of the sites that also host the script just look fishy but could be options. 

Currently, i have to do this if i want to simply reply 304.

given an object `f` with the fields `mime`, `modified` and `data`:

``` python
rv = send_file(BytesIO(f.data), mimetype=f.mime)
rv.last_modified = f.modified.timestamp()
return rv.make_conditional(request)
```

using python 2, this would be worse, as it is most times:

``` python
rv.last_modified = (f.modified - datetime(1970, 1, 1)).total_seconds()
```

i’d like to have a way to make use of a `datetime` object or POSIX timestamp in combination with the existing `conditional` argument to `send_file`. a way that one can use without having to discover `last_modified` and `make_conditional` both, e.g. (`last_modified` can be a `datetime` or timestamp):

``` python
return send_file(BytesIO(f.data), mimetype=f.mime,
                 conditional=True, last_modified=f.modified)
```
## Docs

the documentation to the `conditional` parameter would be extended to mention that `last_timestamp` has to be supplied if the first argument is a file handle instead of a name.
## Implementation

we could create a helper function:

``` python
def to_timestamp(da_ti):
    if PY2:
        epoch = datetime(1970, 1, 1, tzinfo=da_ti.tzinfo)  # use tzinfo to ensure subtractability
        return (da_ti - epoch).total_seconds()
    else:  # we do require python 3 >= 3.3, right?
        return da_ti.timestamp()
```

Added www.minurl.in example to flask/examples

## From the Quickstart Tutorial, Running, print url_for('profile', username='John Doe') generates the following error.

Traceback (most recent call last):
  File "<stdin>", line 2, in <module>
  File "/Users/diek/.virtualenvs/flask_quickstart/lib/python2.7/site-packages/flask/helpers.py", line 312, in url_for
    return appctx.app.handle_url_build_error(error, endpoint, values)
  File "/Users/diek/.virtualenvs/flask_quickstart/lib/python2.7/site-packages/flask/app.py", line 1641, in handle_url_build_error
    reraise(exc_type, exc_value, tb)
  File "/Users/diek/.virtualenvs/flask_quickstart/lib/python2.7/site-packages/flask/helpers.py", line 305, in url_for
    force_external=external)
  File "/Users/diek/.virtualenvs/flask_quickstart/lib/python2.7/site-packages/werkzeug/routing.py", line 1616, in build
    raise BuildError(endpoint, values, method)
werkzeug.routing.BuildError: ('profile', {'username': 'John Doe'}, None)

salutations should be followed by a comma: http://www.grammar-monster.com/lessons/comma_with_dear_hello_and_hi.htm

Example of other frameworks doing it correctly: http://guides.rubyonrails.org/getting_started.html#hello-rails-bang

https://docs.djangoproject.com/en/1.7/intro/tutorial03/

If it is possible to provide optional data input as part of request, and content type is set to application/json, but no data was provided as it was optional, a call flask.request.json or flask.request.get_json will result in a BadRequest exception.

Instead of attempting to perform a json.loads on None or empty string, add at line 153:
`if not data:
    return None
`

I do realize there is a silent option, but that would seem to apply to situations when data was supplied but incorrectly formatted such that json was unable to load the data. Versus the situation where there is no data at all to even load.

I have also opened an issue with flask-restful (https://github.com/flask-restful/flask-restful/issues/387) as well to change how or when the call to get_json happens, always pass silent=True, or provide consumers an option to pass through the option silent=True. 

But it seems cleaner to check for the existence of data prior to trying to process the data.

I have two models , A and B
## file A:                                           

import  ...  
app = Flask(**name**)  
@app.route('/'); 
def  something():pass

if main:
     app.run();
\\\\\\\\\\\\\\\\\\\\\\\
## file B:

import  ...  
app = Flask(**name**)  
@app.route('/abc/'); 
def  anything():pass

\\\\\\\\\\\\\\\\\\\\\\
The question is , how can i import B in to A , so  when I run A , and type localhost/abc/som in my browser , can call the function anything() in B  ?

I see the document , but I have a little confused , please help , Thanks .

Replaces TextField with StringField for the username and email. Per http://wtforms.readthedocs.org/en/latest/whats_new.html#deprecated-api-s TextField has been deprecated in WTForms.

http://flask.pocoo.org/docs/0.10/tutorial/dbinit/
shows only the header and a portion of the first paragraph.

As this specific code block lists imports in general and an import from the `flask` package specifically, it should also include `g` for the sake of completeness.

Like to see flask examples follow good Python standards and pass pylint validation, especially with their examples people use for setup and reference.

Is there a reason why these don't follow the standard python package and and setups found in Pypi?
Here is an example:
https://pypi.python.org/pypi/python_boilerplate_template

Having looked at several other micro frameworks (ie. Pyramid, CherryPy, Pecan, etc)... they all seem to adopt these template patterns and work with pylint.

Here is a sample ...

---

(sandbox)Davids-MacBook-Pro-2:sandbox dhwu$ pylint --version
No config file found, using default configuration
pylint 1.4.0, 
astroid 1.3.2, common 0.63.2
Python 3.4.2 (default, Dec 18 2014, 08:45:34) 
[GCC 4.2.1 Compatible Apple LLVM 6.0 (clang-600.0.56)](sandbox)Davids-MacBook-Pro-2:sandbox dhwu$ 

(sandbox)Davids-MacBook-Pro-2:sandbox dhwu$ pylint /Users/dhwu/eng/Flask-0.10.1/examples/blueprintexample 
No config file found, using default configuration

---

F:  1, 0: error while code parsing: Unable to load file '/Users/dhwu/eng/Flask-0.10.1/examples/blueprintexample/**init**.py' ([Errno 2] No such file or directory: '/Users/dhwu/eng/Flask-0.10.1/examples/blueprintexample/**init**.py') (parse-error)
(sandbox)Davids-MacBook-Pro-2:sandbox dhwu$ 

F:  1, 0: error while code parsing: Unable to load file '/Users/dhwu/eng/Flask-0.10.1/examples/flaskr/**init**.py' ([Errno 2] No such file or directory: '/Users/dhwu/eng/Flask-0.10.1/examples/flaskr/**init**.py') (parse-error)

This is an attempt to address https://github.com/mitsuhiko/flask/issues/641, in particular the problem that `del logger.handlers[:]` is always invoked in app logger creation, destroying any previously created handlers.

Since the `LOGGER_HANDLER_POLICY` was introduced, I am using it to only conditionally install each of the two default handlers (`'debug'` and `'production'`). If the policy is `'never'`, the handlers do not need to be added and such cleanup `del logger.handlers[:]` is not necessary.

The test I added describes my use case (and I believe everyone's in https://github.com/mitsuhiko/flask/issues/641) quite accurately, and I think it is a reasonable one. 

My solution to not install handlers is different than the previous situation, which would always install them and then would do a check on each invocation of `handler.emit`. That means that if someone relied on this check and was for some reason dynamically modifying the app's configuration to change the logging policy while the app was running, it won't work any more. But, to me this seems more like an implementation artifact than a valid use-case.

Out of the box, running the persona example, you get:

ImportError: No module named requests

Removing the import and replacing "requests" with "request" appears to resolve the issue.

Fix spaces as mentioned by @ThiefMaster 

Use `os.path.dirname` and `os.path.abspath` to dynamically build upload path



Just encountered this issue. Don't know if it had already been reported.
Using `request.form['field']` to access checkbox doesnot work; whereas `request.form.get('field')` works. It is possible to use both `request.form.get('field')` or `request.form['field']` to access text fields.

Running OS X Yosemite.
I had the dev server running and was toggling the debug option. i.e. app.debug={True, False} in my entry-point file. I started running without debug and was surprised that the server was loading changes I made to my templates without having to restart the server. This is the reason I was toggling the option. Though, this is not the issue, since I later learned that that was the correct behavior.

In any case, I proceeded to then set debug to True and save the entry-point file. I may have restarted the server at this point, but either way things were still running regularly. However, trouble ensued when I then commented the line setting debug to True (thus leaving it set to the default False value) and saved. After this, I restarted the server, but was met with a traceback ending in:

```
...
File "/usr/local/Cellar/python/2.7.9/Frameworks/Python.framework/Versions/2.7/lib/python2.7/socket.py", line 224, in meth
    return getattr(self._sock,name)(*args)
socket.error: [Errno 48] Address already in use
```

I restarted the server multiple times, before and after relaunching the Terminal app, and was met with this traceback each time. From this I suspected the server process was still running and had been orphaned. Using Activity Monitor, I found a python process running and terminated it. After that, when I tried running the dev server, I received a smaller (though similarly-ending) traceback. (not sure what to conclude from receiving a different traceback)

I didn't get to do much more testing after that. I came to GitHub to begin documenting the bug when my MacBook suddenly restarted. I can't say the restart is related to this issue. However, the restart was due to an OS X panic relating to OSXFuse. I've never had an OS X panic since updating to Yosemite, so I find a correlation to the dev server issue possible.


http://flask.pocoo.org/docs/dev/testing/

In the first code box there's flaskr.app.config['TESTING'] = True

But then it goes missing here:

http://flask.pocoo.org/docs/dev/testing/#the-first-test

This pull-request permit to know if a blueprint has already been registered or not (very usefull for extensions).

It also remove the never used (and misleading) `Blueprint._got_registered_once` attribute.

Now, you can write:

``` python
blueprint = Blueprint('blueprint', __name__)

assert not blueprint.is_registered

app = Flask(__name__)
app.register_blueprint(blueprint)
assert blueprint.is_registered
```

It also allows to specify than a blueprint can't be registered twice with the `register_once` constructor kwarg:

``` python
blueprint = Blueprint('blueprint', __name__, register_once=True)
app = Flask(__name__)
app.register_blueprint(blueprint)
app.register_blueprint(blueprint) # Raise a warning
```

Trying to download the PDF version of the flask docs from URL http://flask.pocoo.org returns error code 404. Same thing with the HTML Zipped link.

Looking forward to getting into Flask!

Minor grammar correction.

Hi everyone. 
I'm new to Flask, and following the tutorial.
Untill <a href='http://flask.pocoo.org/docs/0.10/testing/#the-first-test'>The First Test</a> of <a href='http://flask.pocoo.org/docs/0.10/testing/#testing'>Testing Flask Applications</a>
the code bellow

<pre>
def test_empty_db(self):
    rv = self.app.get('/')
    assert 'No entries here so far' in rv.data
</pre>

went wrong.

<pre>Traceback (most recent call last):
  File "D:\Programming\Python3_mine\Flask\flaskr\flaskr_tests.py", line 21, in test_empty_db
    assert 'No entries here so far' in rv.data
TypeError: Type str doesn't support the buffer API</pre>

Then I checked the rv.data's type.(rv is a response_class object)
And it's <strong>bytes</strong> type. So I use <em>b'No entries here so far' and it worked</em>.

Did this happen to everyone else?
I think someone should correct the document to save beginners' time.

And I'm still working on my English so forgive me if there're any grammar or spelling mistake.
Thank you for reading!! :)

Fix slight grammar mistake in the testing docs.

我在models里面加了表结构， 我去执行migrate 和upgrade， 不能升级， 
数据库怎么升级啊？

solved the problem proposed by  #1291 in a lighter way,
thus determining the `exception  hierarchy` at app setup time instead of running time.

Is there a documentation download for Flask (and/or Jinja and Werkzeug)?

The project feedback site referenced on the Flask website appears to be unavailable.


abandoning pull request #1281 for this.

the rationale for this is to
1. fix some logic flaws
2. make errorhandlers more intuitive by making them rely on exception hierarchy instead of registration order
3. Enable 500 handlers on blueprint level

and all this while without breaking compatibility in not-already-broken usecases (which rely on the logic flaws i fixed)

TODO:
1. bake this into some tests as well
2. one error says
   
   > It is currently not possible to register a 500 internal server error on a per-blueprint level.
   
   why is this?


In werkzeug's WSGIRequestHandler, CONTENT-LENGTH defaults to an empty string ('') if the client did not provide a Content-Length header.

This is causing me problems in my flask web service, which is trying to proxy requests.  The user creates a request without Content-Length, flask gives it to me and then I pass it along to another server, which then returns HTTP 400 due to the bad Content-Length that werkzeug has inserted.  According to RFC 2616, Content-Length must be a number.

Initially I thought this should be considered a werkzeug bug but maybe the empty string was intended to be werkzeug's signifier for a non-existent Content-Length, rather than an actual Content-Length value that could be used directly.  If that's the case, then I would modify flask so that Content-Length isn't included in the incoming request's headers if it is the empty string.

Bottom line, I believe that a client request that is missing a Content-Length header should not result in an incoming flask request with the Content-Length equal to the empty string.  

add_url_rule() has logic that says that if the user has not included OPTIONS in their methods, flask will automatically provide an implementation.

Unfortunately, this logic is only triggered if the method string is OPTIONS in all upper case.  So if you've included lower case "options" in your methods you will still end up with the flask-provided options functionality.

I think it should be a case-insensitive comparison since all the rest of the routing is all case-insensitive.


Hi.

I've detected an issue with supporting unicode filenames in send_file.
If send_file attempts to respond with utf-8 in http headers, the answer is empty, the log contains something like "http-headers should containbe latin-1".
I know that [browser support IS A MESS](http://stackoverflow.com/questions/93551/how-to-encode-the-filename-parameter-of-content-disposition-header-in-http), but it seems, that sending two filenames (`filename=` and `filename*=`) separated by semicolon should work.

I'd like this to be handled by flask or werkzeug. Will you accept such pull request?

See http://blog.travis-ci.com/2014-12-17-faster-builds-with-container-based-infrastructure/

It appears (at least in version 10.1) that there is a dependency on the `its dangerous` module. This is not in the standard library (at least on MacOS), so at least should be added to the dependencies listed in the first paragraph of http://flask.pocoo.org/docs/0.10/installation/

[sorry for my english]

sometime, my flask app return page with very slow latency time.(10s~20s)
![10497831_10204443688384494_2231919219499158793_o](https://cloud.githubusercontent.com/assets/6133895/5472442/f4cf4348-8643-11e4-94e6-f58d6c64790e.jpg)
my code is very simple and it takes times under 0.01s
so i try to strace command and i found this

command: strace -tt python main.py
![default](https://cloud.githubusercontent.com/assets/6133895/5472447/1185da42-8644-11e4-9865-1e8a53abb14f.JPG)

23:01:29.815894 recvfrom(4, "", 8192, 0, NULL, NULL) = 0 <- take 20s
23:01:49.059271 close(4)                = 0

I found a exception when i use NestableBlueprint. It raise FormDataRoutingRedirect Exception.
And I found this exception again where I run a simple test demo.

test demo:
@user.route('/v1/', methods=['GET', 'POST'])
def user_test():
    print 'test'
    return 'test'

get http://192.168.2.103:7700/v1  -> successed
get http://192.168.2.103:7700/v1/  -> successed
post http://192.168.2.103:7700/v1/ -> successed
post http://192.168.2.103:7700/v1  -> raise FormDataRoutingRedirect:
  File "/home/ghostbod/python/hmt_api/venv/lib/python2.7/site-packages/flask/app.py", line 1439, in raise_routing_exception
    raise FormDataRoutingRedirect(request)
FormDataRoutingRedirect: A request was sent to this URL (http://192.168.2.103:7700/v1) but a redirect was issued automatically by the routing system to "http://192.168.2.103:7700/v1/".  The URL was defined with a trailing slash so Flask will automatically redirect to the URL with the trailing slash if it was accessed without one.  Make sure to directly send your POST-request to this URL since we can't make browsers or HTTP clients redirect with form data reliably or without user interaction.

NestableBlueprint test demo
**init**.py:
from modules.warehouse.bp import warehouse
app.register_blueprint(warehouse, url_prefix='/v1/warehouse')

bp.py:
from wh.views import bp_wh
warehouse = NestableBlueprint('warehouse', **name**)
warehouse.register_blueprint(bp_wh, url_prefix='/wh')

view.ppy:
@bp_wh.route('/', methods=['POST'])
@oauth.common_require_oauth()
def test(cid, uid):
    return "test"

http://192.168.2.103:7700/v1/warehouse/wh/?access_token=NX5fUsTrKR8Gi6AsrWgT0tFQAR5C7w -> successed
http://192.168.2.103:7700/v1/warehouse/wh?access_token=NX5fUsTrKR8Gi6AsrWgT0tFQAR5C7w -> raise FormDataRoutingRedirect(request)

the [current master](https://github.com/mitsuhiko/flask/blob/6fcc2ae3f4536e4d2651c1a00abe2306212a5bfd/flask/app.py#L1136) says:

``` python
def _register_error_handler(self, key, code_or_exception, f):
    if isinstance(code_or_exception, HTTPException):
        ...
```

this will only work if you register a exception _instance_, not an exception class, which is definitely not what users expect. instead of:

---

``` python
from werkzeug.exceptions import Forbidden
@errorhandler(Forbidden)
def forbidden(e):
    ...
```

---

``` python
from werkzeug.exceptions import Forbidden
raise Forbidden()
```

---

you’d have to do

---

``` python
from werkzeug.exceptions import Forbidden
forbidden_instance = Forbidden()
@errorhandler(forbidden_instance)
def forbidden(e):
    ...
```

---

``` python
from ..exceptions import forbidden_instance
raise forbidden_instance
```

---

i think you meant `issubclass(code_or_exception, HTTPException)`, but to preserve backwards compatibility, we should change it to accept both

There were some code issues with the current version of the mongokit docs. Specifically, with format strings when you want to format a part of the string and then have the value placed in, you need to use format immediately to avoid a TypeError when mongokit evaluates the string. Also, uses the mongokit ValidationError instead of a plain old Exception

On http://flask.pocoo.org/docs/0.10/patterns/jquery/ there's a line saying that:

```
$('selector') selects an element and lets you operate on it.
```

But there's no `selector` anywhere except that line.

It's the same on http://flask.pocoo.org/docs/dev/patterns/jquery/.

When attempting to follow the docs, I can't run any example applications because the 'flask' command-line tool doesn't get installed.

Here's the full sequence of events using a virtualenv:

```
discovery:~/dev/flasktest% virtualenv .venv
New python executable in .venv/bin/python
Installing setuptools, pip...done.

discovery:~/dev/flasktest% . .venv/bin/activate

discovery:~/dev/flasktest% pip install Flask

discovery:~/dev/flasktest% flask
zsh: command not found: flask

discovery:~/dev/flasktest% ls .venv/bin
activate         activate.fish    easy_install     pip              pip2.7           python2
activate.csh     activate_this.py easy_install-2.7 pip2             python           python2.7
```

Additionally, when I try using the alternative method in the documentation via `python -m flask`, I get the following:

```
discovery:~/dev/flasktest% python -m flask -a hello run --debug
/Users/bc/dev/flasktest/.venv/bin/python: No module named flask.__main__; 'flask' is a package and cannot be directly executed
```

According to the docs, though, this was only a problem with Python <2.7, and I'm running with 2.7.8:

```
discovery:~/dev/flasktest% python --version
Python 2.7.8

discovery:~/dev/flasktest% pip --version
pip 1.5.6 from /Users/bc/dev/flasktest/.venv/lib/python2.7/site-packages (python 2.7)

discovery:~/dev/flasktest% pip freeze
Flask==0.10.1
Jinja2==2.7.3
MarkupSafe==0.23
Werkzeug==0.9.6
itsdangerous==0.24
wsgiref==0.1.2
```

How should I run my Flask app?

I'm hoping to work my way through the rest of the documentation eventually, but I decided to start with the Tutorial since it's a section that I imagine quite a few people read through.

Example of use:

class ListResourceMixin(object):
    def get(self):
        ...

class MyResource(Resource, ListResourceMixin):
    ...

Not including the backend argument can lead to AttributeError: DisabledBackend object has no attribute for '_get_task_meta_for'. See e.g., http://stackoverflow.com/questions/23215311/celery-with-rabbitmq-attributeerror-disabledbackend-object-has-no-attribute.

At the same time, including the backend argument doesn't seem to harm anything else.

Hi, I seem to be running into a Flask specific issue, here are the details:

operating system:

```
$ lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 14.04.1 LTS
Release:    14.04
Codename:   trusty
```

structure of package:

```
$ tree pantry
pantry
├── db.py
├── __init__.py
├── models
│   ├── food.py
│   └── __init__.py
└── run.py
```

The `__init__.py` files are empty.

error received:

```
$ pwd
/home/sam

$ python3.4 -m pantry.run
 * Running on http://127.0.0.1:5000/
 * Restarting with reloader
Traceback (most recent call last):
  File "/home/sam/pantry/run.py", line 2, in <module>
    from pantry.models.food import Food
ImportError: No module named 'pantry'
```

db.py:

``` python
from flask.ext.sqlalchemy import SQLAlchemy

db = SQLAlchemy()
```

food.py

``` python
from pantry.db import db

class Food(db.Model):

    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(80), unique=True)
    amount = db.Column(db.Integer, unique=False)

    def __repr__(self):
        return '<Food %r>' % self.name
```

run.py

``` python
from flask import Flask, jsonify
from pantry.models.food import Food
from pantry.db import db
import json

app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:////tmp/test.db'
db.init_app(app)

@app.route('/food', methods=['GET'])
def list_food():
    items = []
    for food in Food.query.all():
        item = {
            "name": food.name,
            "amount": food.amount,
        }
        items.append(item)
    return jsonify(items)

if __name__ == '__main__':
    app.run(debug=True)
```


The latest Flask release is 0.10.1, which is close to 18 months old now (https://pypi.python.org/pypi/Flask/0.10.1). 

A lot of work has been done since, including a new CLI this summer, which I find personally very useful, and many many small fixes.

I believe that the plan was to make a 1.0 release from the current code base. I don't know if there are still blocking issues in this respect.

If there are blocking issues, maybe it's time to mark them as such on the GitHub issue tracker. It would also help some people, I think, if another 0.x release was made in the interim.

I see on https://github.com/mitsuhiko/flask/blob/master/CHANGES that a 0.10.2 release was also planned with only fixes. In that case, maybe it would be time to to it (if this is still convenient) and do a 0.11 if it's not possible to do a 1.0 in the short term.

`@auth.route('/users/<int:user_id>')`
If user_id > sys.maxint then user_id is long.

Is this actually wanted behavior? Because now you cant actually pass those forward without double checking them. Found this when I was expecting integer to be integer and passed it to straigh to peewee and got "OverflowError: long too big to convert".

`<dt>` is not closed in `render_field()` example so this PR adds the missing `</dt>`.

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Hello,

I have discovered a security vulnerability in Flask (latest version). How would you like me to report it? Please provide the appropriate contact information or instructions for where to report it.

Thanks
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Fixes #3776

This moves a call to `match_request` prior to invocation of `session_interface.open_session`. 
There is a new test which confirms that test application can access `request.endpont` in its `open_session` implementation - this test fails prior to the change since an assertion error triggers a 500 status.
Adds signed int and float converter types to the docs.

Signed ints and floats were added in this PR to werkzeug, but were never added to the flask docs:
https://github.com/pallets/werkzeug/pull/1355

I checked to make sure that these URL paramater types were available in flask, and after testing the following code, I can confirm that they are actually supported.

```
from flask import Flask, request, Response
app = Flask(__name__)
    
@app.route("/int/<int:intParam>", methods=["GET"])
def normalInt(intParam):
    return Response("normalInt: " + str(intParam))

@app.route("/int/<int(signed=True):intParam>", methods=["GET"])
def signedInt(intParam):
    return Response("signedInt: " + str(intParam))
    
@app.route("/float/<float:floatParam>", methods=["GET"])
def normalFloat(floatParam):
    return Response("normalFloat: " + str(floatParam))

@app.route("/float/<float(signed=True):floatParam>", methods=["GET"])
def signedFloat(floatParam):
    return Response("signedFloat: " + str(floatParam))
```
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

This allows dependabot to check any GitHub actions which this project uses and submit PRs with version bumps.

https://docs.github.com/en/free-pro-team@latest/github/administering-a-repository/keeping-your-actions-up-to-date-with-github-dependabot

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Bumps [pytest](https://github.com/pytest-dev/pytest) from 6.0.2 to 6.1.1.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/releases">pytest's releases</a>.</em></p>
<blockquote>
<h2>6.1.1</h2>
<h1>pytest 6.1.1 (2020-10-03)</h1>
<h2>Bug Fixes</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7807">#7807</a>: Fixed regression in pytest 6.1.0 causing incorrect rootdir to be determined in some non-trivial cases where parent directories have config files as well.</li>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7814">#7814</a>: Fixed crash in header reporting when testpaths is used and contains absolute paths (regression in 6.1.0).</li>
</ul>
<h2>6.1.0</h2>
<h1>pytest 6.1.0 (2020-09-26)</h1>
<h2>Breaking Changes</h2>
<ul>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/5585">#5585</a>: As per our policy, the following features which have been deprecated in the 5.X series are now
removed:</p>
<ul>
<li>The <code>funcargnames</code> read-only property of <code>FixtureRequest</code>, <code>Metafunc</code>, and <code>Function</code> classes. Use <code>fixturenames</code> attribute.</li>
<li><code>@pytest.fixture</code> no longer supports positional arguments, pass all arguments by keyword instead.</li>
<li>Direct construction of <code>Node</code> subclasses now raise an error, use <code>from_parent</code> instead.</li>
<li>The default value for <code>junit_family</code> has changed to <code>xunit2</code>. If you require the old format, add <code>junit_family=xunit1</code> to your configuration file.</li>
<li>The <code>TerminalReporter</code> no longer has a <code>writer</code> attribute. Plugin authors may use the public functions of the <code>TerminalReporter</code> instead of accessing the <code>TerminalWriter</code> object directly.</li>
<li>The <code>--result-log</code> option has been removed. Users are recommended to use the <a href="https://github.com/pytest-dev/pytest-reportlog">pytest-reportlog</a> plugin instead.</li>
</ul>
<p>For more information consult
<a href="https://docs.pytest.org/en/stable/deprecations.html">Deprecations and Removals</a> in the docs.</p>
</li>
</ul>
<h2>Deprecations</h2>
<ul>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/6981">#6981</a>: The <code>pytest.collect</code> module is deprecated: all its names can be imported from <code>pytest</code> directly.</p>
</li>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7097">#7097</a>: The <code>pytest._fillfuncargs</code> function is deprecated. This function was kept
for backward compatibility with an older plugin.</p>
<p>It's functionality is not meant to be used directly, but if you must replace
it, use function._request._fillfixtures() instead, though note this is not
a public API and may break in the future.</p>
</li>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7210">#7210</a>: The special <code>-k '-expr'</code> syntax to <code>-k</code> is deprecated. Use <code>-k 'not expr'</code>
instead.</p>
<p>The special <code>-k 'expr:'</code> syntax to <code>-k</code> is deprecated. Please open an issue
if you use this and want a replacement.</p>
</li>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7255">#7255</a>: The pytest_warning_captured &lt;_pytest.hookspec.pytest_warning_captured&gt; hook is deprecated in favor
of pytest_warning_recorded &lt;_pytest.hookspec.pytest_warning_recorded&gt;, and will be removed in a future version.</p>
</li>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7648">#7648</a>: The <code>gethookproxy()</code> and <code>isinitpath()</code> methods of <code>FSCollector</code> and <code>Package</code> are deprecated;</p>
</li>
</ul>
<!-- raw HTML omitted -->
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/blob/master/CHANGELOG.rst">pytest's changelog</a>.</em></p>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pytest-dev/pytest/commit/0ad20b533ffc52ced7bb1a03fba664615e90c093"><code>0ad20b5</code></a> Prepare release version 6.1.1</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/9df5267648c2e1dc89e114487f2d0a1ce40bb0cb"><code>9df5267</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7842">#7842</a> from bluetech/backport-7817</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/1521849c87bfcad186b37c974417365b4d9163fe"><code>1521849</code></a> terminal: fix crash in header reporting when absolute testpaths is used</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/bcb94c4c8b1c8d3ffa9d7f4cb14b43ce7b2c8897"><code>bcb94c4</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7822">#7822</a> from bluetech/backport-7813</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/0f83df4f5547a6f72ef5ef070dab30f2ee372eb4"><code>0f83df4</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7813">#7813</a> from bluetech/findpaths-confusion</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/330caac2ca94902d8fa7b40fec9a181feec6ed2f"><code>330caac</code></a> [6.1.x] Improve docs about plugin discovery/loading at startup (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7803">#7803</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/08a1ab3a8acdfdeffd8f07058b44743df1d90150"><code>08a1ab3</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7797">#7797</a> from pytest-dev/release-6.1.0</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/868bc003ecb0af65548c14de997205cc0e37c3c6"><code>868bc00</code></a> Prepare release version 6.1.0</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/0b327cc75b5f7452eb80c604ce51c032da316a4b"><code>0b327cc</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7796">#7796</a> from bluetech/changelog-cleanups</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/d3c746eb8eb96e68e1c2624a46d99b9e60d455ec"><code>d3c746e</code></a> changelog: some consistency cleanups</li>
<li>Additional commits viewable in <a href="https://github.com/pytest-dev/pytest/compare/6.0.2...6.1.1">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pytest&package-manager=pip&previous-version=6.0.2&new-version=6.1.1)](https://dependabot.com/compatibility-score/?dependency-name=pytest&package-manager=pip&previous-version=6.0.2&new-version=6.1.1)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
In my case I want to display image from stored binary data in mongodb collection. I retrieved some other data successfully like this

```html
<a href="{{ page._id.url }}">{{ page._id.title }}</a>
<p class="text-success mb-0">{{ page._id.url }} (s{{ page.total_score }})</p>
<p class="mb-4">{{ get_excerpt(page._id.content, q) }}</p>
```

I stored binary data in my mongodb collection named 'page' and structure like this

```json
"photo": {
    "$binary": {
        "base64": "iVBORw0KGgoAAAANS.....vGYcQAAAABJRU5ErkJggg=="
```

I tried something like this

```html
<img src="data:image/png;base64,{{ page._id.photo }}">
```

But it's not working. So how to do this?
Fixed the link in documentation section [error-logging-tools](https://flask.palletsprojects.com/en/1.1.x/errorhandling/#error-logging-tools) for flask-specific-documentation to the proper url: https://docs.sentry.io/platforms/python/guides/flask/
Fixes #3787 

Just a small contribution, in documentation section [error-logging-tools](https://flask.palletsprojects.com/en/1.1.x/errorhandling/#error-logging-tools) is a link to [Flask-specific-documentation](https://docs.sentry.io/platforms/python/flask/), but this page seems to be updated, checking Sentry documentation the new link is https://docs.sentry.io/platforms/python/guides/flask/

 
Removing variable loop from within test cases and moving them to pytest parameters.
Python 3.9 was released on October 5, 2020. Add 3.9 to CI and tox.

Actions support for Python 3.9 : https://github.com/actions/setup-python/issues/148

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

This is a feature request for implementing different response_class instances for individual Blueprint.
As of the latest release (1.1.x), we can only implement a global response_class for `app`.

This would be helpful in APIs where if we need a different response_class for APIs returning JSON instead of HTML.
create a basic blogging website with this module.
note: you have to use html templates for main interface , 
do little modification has per your needs

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

This PR solves https://github.com/pallets/flask/issues/3780. After this PR is merged creating routes like this will throw an error:

`@bp.route("/bar ")`
`@bp.route(" /bar")`



<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

### Expected Behavior
If user writes code like this, @app.route should either throw an exception or trim the given path.
```python
from flask import Flask

app = Flask(__name__)

@app.route("/foobar ")
def hello():
    return "Hello, World!"
```

### Actual Behavior
@app.route silently accepts the url that ends with space and navigating to `/foobar` doesnt work. 

### Environment

* Python version: Python 3.8.0
* Flask version: 1.1.2
* Werkzeug version:

The docs about blueprints referred to the decoder when they meant to refer to the encoder.
Usually, we will use `Flask (__name__, static_url_path="static")` to set the path to static files on the website, but if we omit the slash at the beginning of the URL, the following traceback will appear:

``` bash
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/usr/local/lib/python3.6/dist-packages/flask/app.py", line 605, in __init__
    view_func=self.send_static_file,
  File "/usr/local/lib/python3.6/dist-packages/flask/app.py", line 98, in wrapper_func
    return f(self, *args, **kwargs)
  File "/usr/local/lib/python3.6/dist-packages/flask/app.py", line 1275, in add_url_rule
    rule = self.url_rule_class(rule, methods=methods, **options)
  File "/usr/local/lib/python3.6/dist-packages/werkzeug/routing.py", line 666, in __init__
    raise ValueError("urls must start with a leading slash")
ValueError: urls must start with a leading slash
```


It is difficult for us to know from Traceback that the slash of the static file URL is missing, so I checked the slash of the static file URL in the `__init__()` of `Flask()` in advance, and returned to Traceback in more detail

🪔 like this:


``` bash
>>> from flask import Flask
>>> Flask(__name__,static_url_path="static")
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/usr/local/lib/python3.6/dist-packages/Flask-2.0.0.dev0-py3.6.egg/flask/app.py", line 392, in __init__
    raise ValueError("Static file url must start with a leading slash")
ValueError: Static file url must start with a leading slash
>>> 
```

Usually, we will use `Flask (__name__, static_url_path="static")` to set the path to static files on the website, but if we omit the slash at the beginning of the URL, the following traceback will appear:

``` bash
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/usr/local/lib/python3.6/dist-packages/flask/app.py", line 605, in __init__
    view_func=self.send_static_file,
  File "/usr/local/lib/python3.6/dist-packages/flask/app.py", line 98, in wrapper_func
    return f(self, *args, **kwargs)
  File "/usr/local/lib/python3.6/dist-packages/flask/app.py", line 1275, in add_url_rule
    rule = self.url_rule_class(rule, methods=methods, **options)
  File "/usr/local/lib/python3.6/dist-packages/werkzeug/routing.py", line 666, in __init__
    raise ValueError("urls must start with a leading slash")
ValueError: urls must start with a leading slash
```


It is difficult for us to know from Traceback that the slash of the static file URL is missing, so I checked the slash of the static file URL in the `__init__()` of `Flask()` in advance, and returned to Traceback in more detail

🪔 like this:


``` bash
>>> from flask import Flask
>>> Flask(__name__,static_url_path="static")
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/usr/local/lib/python3.6/dist-packages/Flask-2.0.0.dev0-py3.6.egg/flask/app.py", line 392, in __init__
    raise ValueError("Static file url must start with a leading slash")
ValueError: Static file url must start with a leading slash
>>> 
```

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior

Session Interface should have access to `request.endpoint` from `open_session`. In Versions before 1.1.0, this worked fine.

### Actual Behavior
Our SessionInterface subclass looks at `request.endpoint` to determine if it should open a new session - opening a new is only appropriate on some endpoints. Now this is always `None`, so it cannot make this distinction anymore.

I believe #3104 (issue #3088) broke this.

### Environment

* Python version: 3.8.5
* Flask version: 1.1.2
* Werkzeug version: 0.16.1

Write simple code and it hello.py:

```python
      from flask import Flask

      app = Flask(__name__)

      @app.route('/')
      def hello_world():
      return 'Hello, World!'
```

after commands: 

```
set FLASK_APP=hello.py
(env) C:\Users\Admin\Desktop\flask>flask run
 * Serving Flask app "hello.py"
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
```

see this:

```pytb
Traceback (most recent call last):
  File "C:\Users\Admin\AppData\Local\Programs\Python\Python38-32\lib\runpy.py", line 194, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\Admin\AppData\Local\Programs\Python\Python38-32\lib\runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "C:\Users\Admin\Desktop\flask\env\Scripts\flask.exe\__main__.py", line 7, in <module>
  File "c:\users\admin\desktop\flask\env\lib\site-packages\flask\cli.py", line 967, in main
    cli.main(args=sys.argv[1:], prog_name="python -m flask" if as_module else None)
  File "c:\users\admin\desktop\flask\env\lib\site-packages\flask\cli.py", line 586, in main
    return super(FlaskGroup, self).main(*args, **kwargs)
  File "c:\users\admin\desktop\flask\env\lib\site-packages\click\core.py", line 782, in main
    rv = self.invoke(ctx)
  File "c:\users\admin\desktop\flask\env\lib\site-packages\click\core.py", line 1259, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "c:\users\admin\desktop\flask\env\lib\site-packages\click\core.py", line 1066, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "c:\users\admin\desktop\flask\env\lib\site-packages\click\core.py", line 610, in invoke
    return callback(*args, **kwargs)
  File "c:\users\admin\desktop\flask\env\lib\site-packages\click\decorators.py", line 73, in new_func
    return ctx.invoke(f, obj, *args, **kwargs)
  File "c:\users\admin\desktop\flask\env\lib\site-packages\click\core.py", line 610, in invoke
    return callback(*args, **kwargs)
  File "c:\users\admin\desktop\flask\env\lib\site-packages\flask\cli.py", line 852, in run_command
    run_simple(
  File "c:\users\admin\desktop\flask\env\lib\site-packages\werkzeug\serving.py", line 1052, in run_simple
    inner()
  File "c:\users\admin\desktop\flask\env\lib\site-packages\werkzeug\serving.py", line 996, in inner
    srv = make_server(
  File "c:\users\admin\desktop\flask\env\lib\site-packages\werkzeug\serving.py", line 847, in make_server
    return ThreadedWSGIServer(
  File "c:\users\admin\desktop\flask\env\lib\site-packages\werkzeug\serving.py", line 740, in __init__
    HTTPServer.__init__(self, server_address, handler)
  File "C:\Users\Admin\AppData\Local\Programs\Python\Python38-32\lib\socketserver.py", line 452, in __init__
    self.server_bind()
  File "C:\Users\Admin\AppData\Local\Programs\Python\Python38-32\lib\http\server.py", line 140, in server_bind
    self.server_name = socket.getfqdn(host)
  File "C:\Users\Admin\AppData\Local\Programs\Python\Python38-32\lib\socket.py", line 756, in getfqdn
    hostname, aliases, ipaddrs = gethostbyaddr(name)
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xcf in position 6: invalid continuation byte
```
Bumps [pytest](https://github.com/pytest-dev/pytest) from 6.0.2 to 6.1.0.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/releases">pytest's releases</a>.</em></p>
<blockquote>
<h2>6.1.0</h2>
<h1>pytest 6.1.0 (2020-09-26)</h1>
<h2>Breaking Changes</h2>
<ul>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/5585">#5585</a>: As per our policy, the following features which have been deprecated in the 5.X series are now
removed:</p>
<ul>
<li>The <code>funcargnames</code> read-only property of <code>FixtureRequest</code>, <code>Metafunc</code>, and <code>Function</code> classes. Use <code>fixturenames</code> attribute.</li>
<li><code>@pytest.fixture</code> no longer supports positional arguments, pass all arguments by keyword instead.</li>
<li>Direct construction of <code>Node</code> subclasses now raise an error, use <code>from_parent</code> instead.</li>
<li>The default value for <code>junit_family</code> has changed to <code>xunit2</code>. If you require the old format, add <code>junit_family=xunit1</code> to your configuration file.</li>
<li>The <code>TerminalReporter</code> no longer has a <code>writer</code> attribute. Plugin authors may use the public functions of the <code>TerminalReporter</code> instead of accessing the <code>TerminalWriter</code> object directly.</li>
<li>The <code>--result-log</code> option has been removed. Users are recommended to use the <a href="https://github.com/pytest-dev/pytest-reportlog">pytest-reportlog</a> plugin instead.</li>
</ul>
<p>For more information consult
<a href="https://docs.pytest.org/en/stable/deprecations.html">Deprecations and Removals</a> in the docs.</p>
</li>
</ul>
<h2>Deprecations</h2>
<ul>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/6981">#6981</a>: The <code>pytest.collect</code> module is deprecated: all its names can be imported from <code>pytest</code> directly.</p>
</li>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7097">#7097</a>: The <code>pytest._fillfuncargs</code> function is deprecated. This function was kept
for backward compatibility with an older plugin.</p>
<p>It's functionality is not meant to be used directly, but if you must replace
it, use function._request._fillfixtures() instead, though note this is not
a public API and may break in the future.</p>
</li>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7210">#7210</a>: The special <code>-k '-expr'</code> syntax to <code>-k</code> is deprecated. Use <code>-k 'not expr'</code>
instead.</p>
<p>The special <code>-k 'expr:'</code> syntax to <code>-k</code> is deprecated. Please open an issue
if you use this and want a replacement.</p>
</li>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7255">#7255</a>: The pytest_warning_captured &lt;_pytest.hookspec.pytest_warning_captured&gt; hook is deprecated in favor
of pytest_warning_recorded &lt;_pytest.hookspec.pytest_warning_recorded&gt;, and will be removed in a future version.</p>
</li>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7648">#7648</a>: The <code>gethookproxy()</code> and <code>isinitpath()</code> methods of <code>FSCollector</code> and <code>Package</code> are deprecated;
use <code>self.session.gethookproxy()</code> and <code>self.session.isinitpath()</code> instead.
This should work on all pytest versions.</p>
</li>
</ul>
<h2>Features</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7667">#7667</a>: New <code>--durations-min</code> command-line flag controls the minimal duration for inclusion in the slowest list of tests shown by <code>--durations</code>. Previously this was hard-coded to <code>0.005s</code>.</li>
</ul>
<h2>Improvements</h2>
<!-- raw HTML omitted -->
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/blob/master/CHANGELOG.rst">pytest's changelog</a>.</em></p>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pytest-dev/pytest/commit/868bc003ecb0af65548c14de997205cc0e37c3c6"><code>868bc00</code></a> Prepare release version 6.1.0</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/0b327cc75b5f7452eb80c604ce51c032da316a4b"><code>0b327cc</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7796">#7796</a> from bluetech/changelog-cleanups</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/d3c746eb8eb96e68e1c2624a46d99b9e60d455ec"><code>d3c746e</code></a> changelog: some consistency cleanups</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/d3f47bf3468c964d4e41258c55db6577d99c7992"><code>d3f47bf</code></a> Improved 'Declaring new hooks' section in docs. (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7782">#7782</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/3db24893b4d6ba44d6d94a836cedb9d21724916b"><code>3db2489</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7784">#7784</a> from nicoddemus/use-new-pip-solver-7783</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/821562513526dcd439b253f25677cc2c998d8fef"><code>8215625</code></a> Use new pip resolver in plugins tox env</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/5cfd7c0ddd5b1ffc111399e2d118b243896827b0"><code>5cfd7c0</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7780">#7780</a> from bluetech/final</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/a99ca879e7c9db0ac91324e701275e9439cf7b73"><code>a99ca87</code></a> Mark some public and to-be-public classes as <code>@final</code></li>
<li><a href="https://github.com/pytest-dev/pytest/commit/050c2df737f7c6c3b1de7a6f375de107edcb6873"><code>050c2df</code></a> Use multiple issue template types and mention Discussions (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7739">#7739</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/cdfdb3a25d1033f732072d9a4d2fb700feb73a09"><code>cdfdb3a</code></a> Add docs about reusing fixtures from other projects (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7772">#7772</a>)</li>
<li>Additional commits viewable in <a href="https://github.com/pytest-dev/pytest/compare/6.0.2...6.1.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pytest&package-manager=pip&previous-version=6.0.2&new-version=6.1.0)](https://dependabot.com/compatibility-score/?dependency-name=pytest&package-manager=pip&previous-version=6.0.2&new-version=6.1.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [greenlet](https://github.com/python-greenlet/greenlet) from 0.4.16 to 0.4.17.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/python-greenlet/greenlet/blob/master/NEWS">greenlet's changelog</a>.</em></p>
<blockquote>
<h1>0.4.17</h1>
<ul>
<li>Support for PEP 567 ContextVars</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/python-greenlet/greenlet/commit/71ecaa8188894dccdf35351614e65f07752c2414"><code>71ecaa8</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/177">#177</a> from python-greenlet/release-0.4.17</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/084f0a412cee00dacbbd20a18758a04da07dc29e"><code>084f0a4</code></a> Prepare to release greenlet 0.4.17</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/f49eb7be1cb43d53a80c2447a419d69db377c825"><code>f49eb7b</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/174">#174</a> from daxtens/travis-ppc64le</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/aa940c45ae8721895518a4753ae54d7cb7edd9e9"><code>aa940c4</code></a> Test on ppc64le in Travis</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/0c4d5104ec2b022cb49eca9f09fa7d3a859063ee"><code>0c4d510</code></a> Add Josh Snyder to AUTHORS</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/894e82af579741b669bb78457ba5ae89b82cc22d"><code>894e82a</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/172">#172</a> from hashbrowncipher/contextvars</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/b40eb60e03e7a277e5529c4b08d76f461e81626a"><code>b40eb60</code></a> Move context pointer to end of struct</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/75e3c8781c30ae0aa9a2b0fbe3fff867396fb4c6"><code>75e3c87</code></a> Add another test</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/7c1c96f00dbc89fc432b82a4250feedca4c9467f"><code>7c1c96f</code></a> Provide a feature flag indicating whether we handle context vars</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/7fc4e8a6eb1e3bb8671f62b2bfef00885dce9033"><code>7fc4e8a</code></a> Support Python 2.6</li>
<li>Additional commits viewable in <a href="https://github.com/python-greenlet/greenlet/compare/0.4.16...0.4.17">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=greenlet&package-manager=pip&previous-version=0.4.16&new-version=0.4.17)](https://dependabot.com/compatibility-score/?dependency-name=greenlet&package-manager=pip&previous-version=0.4.16&new-version=0.4.17)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

This PR simply add a space in a code example.
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->
In my flask app, I start a dameon thread by:
```python
if __name__ == "__main__":
    # daemon thread
     t = threading.Thread(target=cls.daemon_thread)
     t.start()
     app.run("0.0.0.0", port=8081, debug=False)
```
where cls.daemon_thread is a method of the instance cls. 

### Expected Behavior
<!-- Tell us what should happen. -->
I start a new thread as a daemon thread to do some timing work and print some log at the same time. And the flask request 
will print some log too.
when I print the log, I also print PID(Process ID) and TID(Thread ID) to tell me  where the log from.


### Actual Behavior
<!-- Tell us what happens instead. -->
``` Bash

L1:[2020-09-25 22:24:48,449 PID: 27642 TID: 140167677339392] INFO :  daemon thread output 
L2:[2020-09-25 22:24:48,549 PID: 27642 TID: 140167677339392] INFO :  daemon thread output 
L3:[2020-09-25 22:25:00,863 PID: 27642 TID: 140167677339392] INFO :  flask request output
L4:[2020-09-25 22:25:01,174 PID: 27642 TID: 140167677339392] INFO :    flask request output
```
When the I start the app, it works well, but after hours later, It  goes wrong. As u can see, L1 L2 are logs from daemon, and the TID of the daemon is **140167677339392**, but in the next request in L3, L4, flask starts a new thread with the same TID to deal with  the request. And the log from daemon thread never appears again.

### Environment

* Python version: 3.7.7
* Flask version:1.1.2
* Werkzeug version:1.0.1


Grammar mistake in comment from the fileuploads patterns example in the docs.

### Expected Behavior
"if user does not select file, browsers also submit an empty part without filename" [missing plural s in 'browser']
or
"if user does not select file, browser also submits an empty part without filename" [missing present simple s in 'submit']

### Actual Behavior
"if user does not select file, browser also submit an empty part without filename"

Sorry if it should have been a pull request.
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

我怎么同时使用send_static_file函数和jinjia2语法来获得后端传递的数据呢？
how can I use send_static_file and jinjia2 at the same time
### Expected Behavior
Here:
https://github.com/pallets/flask/blob/master/src/flask/app.py#L1833-L1836
It would be nice if `after_request_funcs` could be run after the `save_session` function has been run. This would allow me to remove the session cookie from the response of a route, so that I can then have a templated route aggressively cached by my nginx reverse-proxy.  

```python
@app.route('/captive')
def captive():
    '''this url endpoint is static, and should be aggressively cached by nginx
    it doesn't provide any useful content, but has a JS embed for a web browser
    to trigger the auth if a user reaches it'''
    return flask.Response(
        response=render_template('captive.html'),
        status=200,
        headers={'Cache-Control': 'public,max-age=86400'},
    )
```

so from here:
https://github.com/pallets/flask/blob/master/src/flask/app.py#L1833-L1836

if the lines:
```python
        for handler in funcs:
            response = handler(response)
        if not self.session_interface.is_null_session(ctx.session):
            self.session_interface.save_session(self, ctx.session, response)
```
could be changed to
```python
        if not self.session_interface.is_null_session(ctx.session):
            self.session_interface.save_session(self, ctx.session, response)
        for handler in funcs:
            response = handler(response)
```
I think that would mean I could make a function that just deletes the session cookie header from the response?

### Actual Behavior
the `Set-Cookie: session=.....` header is still added to the response, and then possibly cached by nginx.


### Environment
* Python version: Python 3.8.5
* Flask version: 1.1.2  (but it still looks the same on the master branch)
* Werkzeug version: 1.0.1

I'm not sure if there's some obvious reason this can't be done.

I also tried getting the `url_map` and directly adding a werkzeug response creating function to it but the session info still got added.
i would like to implement basic auth for flask. the current module is just for a single user and does not propagate the username to the app.

i used before_request to auth the user and want to store the username in request.remote_user to the app. this leads to an Exception telling that this property is read-only.

how can remote_user be *set* by such an plugin?

Fixes #3761

Breaks the ref cycle `Flask` -> `view_functions` -> `self.send_static_file` -> `Flask` that is created in the constructor.

```python
from flask import Flask
import objgraph

def make_app():
    app = Flask(__name__)

    @app.route('/')
    def hello_world():
        return 'Hello, World!'

    return app

def test():
    myapp = make_app()
    objgraph.show_backrefs([myapp], filename='backrefs.png', max_depth=6)

test()
```

Here's what the produced reference graph looks like:
![backrefs](https://user-images.githubusercontent.com/30720/93849469-130f0480-fc61-11ea-9985-e74419357ace.png)

Is it the intended behavior? In our library a Flask app is created dynamically in a closure, and as a result it retains anything else that was created in that closure. We work around this by having a trampoline function and passing heavy objects as weakrefs, but it was still unexpected.

### Environment

* Python version: 3.7.5
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

I created this issue because I'm not sure  the memory leak is caused by mxnet itself or just FLASK.

The original issue in mxnet is <https://github.com/apache/incubator-mxnet/issues/19159>.

I'm using flask with mxnet to write a server. Since it is a web app, we want the GPU memory is fully static allocated.
However, as the title said, I found the GPU memory usage keeps increasing and then raise a OOM when the version of mxnet is 1.6.0post0 and 1.7.0. 

### Expected Behavior
The GPU memory usage should remain unchanged.

```python
import mxnet as mx
import os
os.environ["MXNET_CUDNN_AUTOTUNE_DEFAULT"] = "0"
os.environ["MXNET_GPU_MEM_POOL_TYPE"] = "Round"


class Predictor(object):
    def __init__(self):
        ctx = mx.gpu(0)
        net = mx.gluon.model_zoo.vision.resnet50_v1()
        net.initialize()
        net.collect_params().reset_ctx(ctx)
        net.hybridize(active=True)
        max_h = 768
        max_w = 768
        _ = net(mx.nd.zeros(shape=(1, 3, max_h, max_w), ctx=ctx))
        self.ctx = ctx
        self.net = net

    def __call__(self, *args, **kwargs):
        max_h = 768
        max_w = 768
        x_h = np.random.randint(100, max_h)
        x_w = np.random.randint(100, max_w)
        xx = np.random.randn(1, 3, x_h, x_w)
        y = self.net(mx.nd.array(xx, ctx=self.ctx))
        return y.asnumpy().sum()


if __name__ == '__main__':
    import flask
    import tornado.wsgi
    import tornado.httpserver
    import os
    import cv2
    import numpy as np
    from flask_cors import CORS
    import os
    import cv2
    import json
    import logging
    import base64

    os.environ["MXNET_CUDNN_AUTOTUNE_DEFAULT"]="0"
    DEBUG = True
    PORT = 21500
    app = flask.Flask(__name__)
    CORS(app, supports_credentials=True)
    predictor = Predictor()

    @app.route('/test', methods=['POST'])
    def net_forward():
        try:
            r = predictor()
            return None
        except Exception as e:
            logging.exception(e)
            print("failed")
            return flask.jsonify(str(e)), 400

    print("starting webserver...")
    if DEBUG:
        app.run(debug=True, host='0.0.0.0', port=PORT)
    else:
        http_server = tornado.httpserver.HTTPServer(
            tornado.wsgi.WSGIContainer(app))
        http_server.listen(PORT, address="0.0.0.0")
        tornado.ioloop.IOLoop.instance().start()
```
And just run the following code to request the server:

```python
import base64
import json
import time
import os
import numpy as np
import cv2


def remote_call(url):
    register_data = {"Pic": "xx"}
    data = json.dumps(register_data)
    import requests
    return requests.post(url, data)


if __name__ == '__main__':
    import glob
    import matplotlib.pyplot as plt
    while True:
        register_url = 'http://127.0.0.1:21500/test'
        while True:
            try:
                remote_call(register_url)
            except Exception as e:
                print(e)
```

### Actual Behavior
I found the GPU memory usage keeps increasing.


### Environment

* Python version: 3.7.0
* Flask version: 1.0.2

Merge orginal repo

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Sentry is still referenced as *Open Source* in the error handling documentation. The new license (Business Source License) is not an open source license ([1](https://blog.sentry.io/2019/11/06/relicensing-sentry/), [2](https://forum.sentry.io/t/re-licensing-sentry-faq-discussion/8044)).
Simplified loading of favicon from static folder
Bumps [pytest](https://github.com/pytest-dev/pytest) from 6.0.1 to 6.0.2.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/releases">pytest's releases</a>.</em></p>
<blockquote>
<h2>6.0.2</h2>
<h1>pytest 6.0.2 (2020-09-04)</h1>
<h2>Bug Fixes</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7148">#7148</a>: Fixed <code>--log-cli</code> potentially causing unrelated <code>print</code> output to be swallowed.</li>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7672">#7672</a>: Fixed log-capturing level restored incorrectly if <code>caplog.set_level</code> is called more than once.</li>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7686">#7686</a>: Fixed NotSetType.token being used as the parameter ID when the parametrization list is empty.
Regressed in pytest 6.0.0.</li>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7707">#7707</a>: Fix internal error when handling some exceptions that contain multiple lines or the style uses multiple lines (<code>--tb=line</code> for example).</li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/blob/master/CHANGELOG.rst">pytest's changelog</a>.</em></p>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pytest-dev/pytest/commit/09b1d7cc997200dca5adb3e62e593c312d6864d3"><code>09b1d7c</code></a> Prepare release version 6.0.2</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/ea65ea877ef773a8561c352ec809ec6aeccf4c47"><code>ea65ea8</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7717">#7717</a> from bluetech/backport-7614</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/f4f30d7073ba818c14a8cae66c1cc6e33e3c4084"><code>f4f30d7</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7716">#7716</a> from bluetech/backport-7697</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/309810ac2ca027c9e37f4dc64e6c77e999503e2a"><code>309810a</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7715">#7715</a> from bluetech/backport-7651</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/e63fac3aec18612419d0ba511caea5028c6df494"><code>e63fac3</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7614">#7614</a> from The-Compiler/log-print</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/cb91c5033e78b3df1db5e4d4e8ee612ad0d441a4"><code>cb91c50</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7697">#7697</a> from nicoddemus/file-docs</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/9a879ee23e96eba2e07943eac4e98d896655e3fb"><code>9a879ee</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7651">#7651</a> from bluetech/capture-safe-disable</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/e9d18bd8ac55d9de18ba292e3bd4ee66468bc06c"><code>e9d18bd</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7711">#7711</a> from nicoddemus/backport-7708</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/912870d33e21ea847435b56ed76702f42645de4a"><code>912870d</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7708">#7708</a> from nicoddemus/repr-line-7707</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/0115b716c0949b3dccababcb876dcfd7edabb5ed"><code>0115b71</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7688">#7688</a> from nicoddemus/backport-7687</li>
<li>Additional commits viewable in <a href="https://github.com/pytest-dev/pytest/compare/6.0.1...6.0.2">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pytest&package-manager=pip&previous-version=6.0.1&new-version=6.0.2)](https://dependabot.com/compatibility-score/?dependency-name=pytest&package-manager=pip&previous-version=6.0.1&new-version=6.0.2)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
in `helpers.py/send_file` the `mimetypes` check ignores the content encoding.

Use case: Usually static content is delivered by the frontend server but it's annoying that the debug server
can't understand files such as compressed svg (viz: svgz). mimetypes *does* understand this but flask
ignores the output. This patch just checks the encoding and add extra headers.

I haven't added any tests but would be happy to if requested (and instructed where to put it!).


Bumps [tox](https://github.com/tox-dev/tox) from 3.19.0 to 3.20.0.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/tox-dev/tox/blob/master/docs/changelog.rst">tox's changelog</a>.</em></p>
<blockquote>
<h1>v3.20.0 (2020-09-01)</h1>
<h2>Bugfixes</h2>
<ul>
<li>Allow hyphens and empty factors in generative section name. - by tyagdit <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1636">#1636</a></li>
<li>Support for PEP517 in-tree build backend-path key in <code>get-build-requires</code>. - by nizox <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1654">#1654</a></li>
<li>Allow escaping curly braces in setenv. - by mkenigs <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1656">#1656</a></li>
</ul>
<h2>Features</h2>
<ul>
<li>Support for comments within <code>setenv</code> and environment files via the <code>files|</code> prefix. - by gaborbernat <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1667">#1667</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/tox-dev/tox/commit/5c94919b79105eabb0507f6d5e55b60daee11ccc"><code>5c94919</code></a> release 3.20.0</li>
<li><a href="https://github.com/tox-dev/tox/commit/8a25fa6bf3e625c0b47659e1652ab55a79d4d1e8"><code>8a25fa6</code></a> Support environment files and comments in setenv (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1668">#1668</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/a7903508fa07068b327e15cfdbf8ea330ab78765"><code>a790350</code></a> New formatters</li>
<li><a href="https://github.com/tox-dev/tox/commit/d4e6e77ea77cf8b336f38313bef40c80b6771139"><code>d4e6e77</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1656">#1656</a> from mkenigs/escape-braces-in-setenv</li>
<li><a href="https://github.com/tox-dev/tox/commit/8e39dfbb836b6e2e6b2bd637f7b853935e82de3f"><code>8e39dfb</code></a> Spelling fixes (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1665">#1665</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/00f6496b756f938db4ddcf040a5192a9e40b16a4"><code>00f6496</code></a> Document allowlist_externals versionadded (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1663">#1663</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/3c38762fc6acfd6ca93ddc8607133d3a39e6d25c"><code>3c38762</code></a> Allow escaping curly braces in setenv</li>
<li><a href="https://github.com/tox-dev/tox/commit/3453018dab9a0208f64013c2dd357d1be348ffdf"><code>3453018</code></a> Make setup.py test admonition sterner as it is deprecated (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1660">#1660</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/4b7f682db872902b542ccaf26d9619c141dfc8ab"><code>4b7f682</code></a> remove broken link to removed pytest-runner documentation (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1659">#1659</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/f292f5236a41f7c02ba60dbc14d8e5941be7ea0e"><code>f292f52</code></a> Fix support of the PEP517 backend-path key (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1655">#1655</a>)</li>
<li>Additional commits viewable in <a href="https://github.com/tox-dev/tox/compare/3.19.0...3.20.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=tox&package-manager=pip&previous-version=3.19.0&new-version=3.20.0)](https://dependabot.com/compatibility-score/?dependency-name=tox&package-manager=pip&previous-version=3.19.0&new-version=3.20.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->
```
import flask

app = flask.Flask(__name__)

@app.route("/")
def about():
    return hello #Intentional error

if __name__ == "__main__":
    app.run(debug=True)
```
The code above exposes the Werkzeug development server debugger. The debugger PIN is not printed to stdout in IDLE Shell, which prevents the developer from executing arbitrary code through the browser.
### Expected Behavior
<!-- Tell us what should happen. -->

```bash
bash output:
$ python3 test.py
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 334-139-720
127.0.0.1 - - [05/Sep/2020 17:51:30] "GET / HTTP/1.1" 500 -
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/flask/app.py", line 1997, in __call__
    return self.wsgi_app(environ, start_response)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/flask/app.py", line 1985, in wsgi_app
    response = self.handle_exception(e)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/flask/app.py", line 1540, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/flask/app.py", line 1982, in wsgi_app
    response = self.full_dispatch_request()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/flask/app.py", line 1614, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/flask/app.py", line 1517, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/flask/app.py", line 1612, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/flask/app.py", line 1598, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/Users/eExamSystem/Documents/app.py", line 7, in about
    return hello
NameError: name 'hello' is not defined
127.0.0.1 - - [05/Sep/2020 17:51:30] "GET /?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1" 200 -
127.0.0.1 - - [05/Sep/2020 17:51:30] "GET /?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1" 200 -
127.0.0.1 - - [05/Sep/2020 17:51:30] "GET /?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1" 200 -
127.0.0.1 - - [05/Sep/2020 17:51:30] "GET /?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1" 200 -
127.0.0.1 - - [05/Sep/2020 17:51:30] "GET /?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1" 200 -
 * To enable the debugger you need to enter the security pin:
 * Debugger pin code: 334-139-720
127.0.0.1 - - [05/Sep/2020 17:51:33] "GET /?__debugger__=yes&cmd=printpin&s=3wa28jD2K14deHoUckzK HTTP/1.1" 200 -
```

### Actual Behavior
<!-- Tell us what happens instead. -->

```pytb
================= RESTART: /Users/eExamSystem/Documents/app.py =================
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
```

### Environment

* Python version: 3.6.4
* Flask version: 0.12.2
* Werkzeug version: 0.15.4

I have asked this on community forums, but to no avail. When redirecting to different routes after a form is submitted, an Error Response 302 (VFS connection does not exist) is thrown. The below is a small example of what I am dealing with, there are other redirects in other routes too that throw the exact same response. There is not anything odd about the code or the redirect, am I missing something? (I am using AWS Cloud9 by the way)

```python
app = Flask(__name__)

@app.route('/data/import-data', methods=['GET', 'POST'])    
def csv_import():
    
    if request.method == "POST":
        
        #fetch file, some logical tests, parse to pandas df and session data - this works all fine and well
        
        return redirect(url_for('map_fields')) #error occurs here
           
    return render_template('data-import-data.html')

@app.route('/data/import-data/map-fields', methods=['GET', 'POST'])
def map_fields():
     
    #get data from session data
    
    if request.method == "POST":
        
        #continue to work with the session data
        
        return redirect(url_for('data_table'))
        
    return render_template('data-import-map-fields.html')

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080, debug=True)
```
HTML form 
```HTML
<form class="" action="/data/import-data" method="POST" enctype=multipart/form-data>
      <div class="position-relative form-group"><label for="exampleFile" class="">File</label>
      <input name="csvfile" type="file" class="form-control-file">
      <small class="form-text text-muted">Max. file size 1.5MB(Mega-Bytes). Accepted file type .csv only. </small>
      </div>
      <div class="position-relative row form-check">
        <button hrefname="csvuploadbutton" class="mb-2 mr-2 btn btn-primary btn-lg btn-block" type="submit">Proceed
        </button>
      </div>
</form>
```

### Actual Behavior
`POST /data/import-data HTTP/1.1 302`
Page displays `VFS connection does not exist`
The URL after redirect does read correctly `/data/import-data/map-fields`

### Environment
Python 3.6.12
Flask 1.1.2
Werkzeug 1.0.1

This PR is related to issue #3696, I've changed the instructions to install mod_wsgi from python2.x to python3.x for apt and pkg (FreeBSD).

I verified package names from here
- [FreeBSD](https://pkgs.org/search/?q=mod_wsgi)
- [Debian](https://pkgs.org/download/libapache2-mod-wsgi-py3)

Let me know if I this needs some correction, Thanks 😄 

closes #3696
I have a few dozen endpoints which all have different routes (e.g. `/api/login/`, `/api/register` etc). From time to time, after I make a few changes to my `app.py`, I get an `Assertion Error`:
`AssertionError: View function mapping is overwriting an existing endpoint function: login`

I checked several times and concluded that there are 0 functions mapping over one another (no functions with same names or routes listening for the same route). 

### Environment

* Python version: 3.8
* Flask version: 1.1.2

Update cache used in GitHub Actions workflow to v2

Update Info
refs : [actions/cache](https://github.com/actions/cache#whats-new)
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->
i created 2 blueprint **main** and **mobile**. i expect mobile blueprint to render its own template.

```python
blueprint = Blueprint(
        name='mobile',
        import_name=__name__,
        static_folder='assets',
        static_url_path='/mobile_assets',
        # app_cfg.APPPATH is a constant of absolute path to app root directory
        template_folder=path.join(app_cfg.APPPATH,'blueprint/mobile/template'),
    )

@blueprint.route('/', methods=['GET'])
def index_mobile():
    data = {
        'title': 'wow mobile',
        'message': 'message from mobile blueprint'
    }
    # to test if i set the corrent absolute path to the blueprint template
    print(path.join(app_cfg.APPPATH,'blueprint/mobile/template'))
    return render_template('index.html',**data)
```

### Actual Behavior
<!-- Tell us what happens instead. -->
mobile blueprint render the template from **main**
<!-- ```pytb
Paste the full traceback if there was an exception.
``` -->

there is already an issue about this since 2015. but for some unknown reason its closed without mentioning any solution for this problem.

flask documention :
`template_folder – A folder with templates that should be added to the app’s template search path. The path is relative to the blueprint’s root path. Blueprint templates are disabled by default. Blueprint templates have a lower precedence than those in the app’s templates folder.`

### Environment

* Python version: Python 3.8.5
* Flask version: Flask 1.1.2
* Werkzeug version: Werkzeug 1.0.1


<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->

```python
make_response(json.dumps(data), {'mimetype': 'application/json'})
```
should return content type json.

### Actual Behavior
<!-- Tell us what happens instead. -->

The mimetype is ignored and the content-type is defaulted to `text/html`. See below the MVP for `curl http://localhost:5000/make_response_mimetype`

Passing the content-type instead correctly sets the content type of the response as seen in `curl http://localhost:5000/make_response_content_type`

The `curl http://localhost:5000/jsonify` is provided for reference.

### Environment

* Python version: 3.8.3
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

### MVP
app.py
```
import json

from flask import Flask
from flask import json
from flask import jsonify
from flask import make_response


app = Flask(__name__)

data = {'a': 1, 'b': [1,2]}

@app.route('/make_response_mimetype')
def make_response_mimetype():
    return make_response(json.dumps(data), {'mimetype': 'application/json'})


@app.route('/make_response_content_type')
def make_response_content_type():
    return make_response(json.dumps(data), {'content-type': 'application/json'})


@app.route('/jsonify')
def jsonified():
    return jsonify(data)

if __name__ == '__main__':
    app.run(debug=True)
```

then test with:
```
python app.py
curl http://localhost:5000/make_response_mimetype
curl http://localhost:5000/make_response_content_type
curl http://localhost:5000/jsonify
```

results:
```
❯ curl http://localhost:5000/make_response_mimetype

StatusCode        : 200
Content           : {"a": 1, "b": [1, 2]}
RawContent        : HTTP/1.0 200 OK
                    mimetype: application/json
                    Content-Length: 21
                    Content-Type: text/html; charset=utf-8
                    Date: Thu, 27 Aug 2020 12:54:34 GMT
                    Server: Werkzeug/1.0.1 Python/3.8.3

                    {"a": 1, "b": [1, 2...
Forms             : {}
Headers           : {[mimetype, application/json], [Content-Length, 21],
                    [Content-Type, text/html; charset=utf-8], [Date, Thu, 27 Aug 2020  
                    12:54:34 GMT]...}
Images            : {}
InputFields       : {}
Links             : {}
ParsedHtml        : mshtml.HTMLDocumentClass
RawContentLength  : 21

❯ curl http://localhost:5000/make_response_content_type

StatusDescription : OK
Content           : {"a": 1, "b": [1, 2]}
RawContent        : HTTP/1.0 200 OK
                    Content-Length: 21
                    Content-Type: application/json
                    Date: Thu, 27 Aug 2020 12:54:58 GMT
                    Server: Werkzeug/1.0.1 Python/3.8.3

                    {"a": 1, "b": [1, 2]}
Forms             : {}
Headers           : {[Content-Length, 21], [Content-Type, application/json], [Date,    
                    Thu, 27 Aug 2020 12:54:58 GMT], [Server, Werkzeug/1.0.1
                    Python/3.8.3]}
Images            : {}
InputFields       : {}
Links             : {}
ParsedHtml        : mshtml.HTMLDocumentClass
RawContentLength  : 21

❯ curl http://localhost:5000/jsonify

StatusCode        : 200
StatusDescription : OK
Content           : {
                      "a": 1, 
                      "b": [
                        1,
                        2
                      ]
                    }

RawContent        : HTTP/1.0 200 OK
                    Content-Length: 42
                    Content-Type: application/json
                    Date: Thu, 27 Aug 2020 12:55:07 GMT
                    Server: Werkzeug/1.0.1 Python/3.8.3

                    {
                      "a": 1,
                      "b": [
                        1,
                        2
                      ]
                    }

Forms             : {}
Headers           : {[Content-Length, 42], [Content-Type, application/json], [Date,    
                    Thu, 27 Aug 2020 12:55:07 GMT], [Server, Werkzeug/1.0.1
                    Python/3.8.3]}
Images            : {}
InputFields       : {}
Links             : {}
ParsedHtml        : mshtml.HTMLDocumentClass
RawContentLength  : 42
```
When running automated tests for a project using Flask, I am receiving the following error:

> DeprecationWarning: Importing 'itsdangerous.json' is deprecated and will be removed in 2.1. Use Python's 'json' module instead.

* Python version: 3.6
* Flask version: 1.1.2
* Werkzeug version: 1.0.1
The Flask shell banner (i.e. the thing that appears on the console
when I run `$ flask shell`) contains a grammatical error. This branch
contains a fixed version.
Bumps [pre-commit](https://github.com/pre-commit/pre-commit) from 2.6.0 to 2.7.1.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/releases">pre-commit's releases</a>.</em></p>
<blockquote>
<h2>pre-commit v2.7.0</h2>
<h3>Features</h3>
<ul>
<li>Produce error message if an environment is immediately unhealthy
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1535">#1535</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Add --no-allow-missing-config option to init-templatedir
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1539">#1539</a> PR by <a href="https://github.com/singergr">@singergr</a>.</li>
</ul>
</li>
<li>Add warning for old list-style configuration
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1544">#1544</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Allow pre-commit to succeed on a readonly store.
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1570">#1570</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1536">#1536</a> issue by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
</ul>
<h3>Fixes</h3>
<ul>
<li>Fix error messaging when the store directory is readonly
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1546">#1546</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1536">#1536</a> issue by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Improve <code>diff</code> performance with many hooks
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1566">#1566</a> PR by <a href="https://github.com/jhenkens">@jhenkens</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1564">#1564</a> issue by <a href="https://github.com/jhenkens">@jhenkens</a>.</li>
</ul>
</li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/blob/master/CHANGELOG.md">pre-commit's changelog</a>.</em></p>
<blockquote>
<h1>2.7.1 - 2020-08-23</h1>
<h3>Fixes</h3>
<ul>
<li>Improve performance of docker hooks by removing slow <code>ps</code> call
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1572">#1572</a> PR by <a href="https://github.com/rkm">@rkm</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1569">#1569</a> issue by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Fix un-<code>healthy()</code> invalidation followed by install being reported as
un-<code>healthy()</code>.
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1576">#1576</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1575">#1575</a> issue by <a href="https://github.com/jab">@jab</a>.</li>
</ul>
</li>
<li>Fix rare file race condition on windows with <code>os.replace()</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1577">#1577</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
</ul>
<h1>2.7.0 - 2020-08-22</h1>
<h3>Features</h3>
<ul>
<li>Produce error message if an environment is immediately unhealthy
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1535">#1535</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Add --no-allow-missing-config option to init-templatedir
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1539">#1539</a> PR by <a href="https://github.com/singergr">@singergr</a>.</li>
</ul>
</li>
<li>Add warning for old list-style configuration
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1544">#1544</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Allow pre-commit to succeed on a readonly store.
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1570">#1570</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1536">#1536</a> issue by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
</ul>
<h3>Fixes</h3>
<ul>
<li>Fix error messaging when the store directory is readonly
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1546">#1546</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1536">#1536</a> issue by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Improve <code>diff</code> performance with many hooks
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1566">#1566</a> PR by <a href="https://github.com/jhenkens">@jhenkens</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1564">#1564</a> issue by <a href="https://github.com/jhenkens">@jhenkens</a>.</li>
</ul>
</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pre-commit/pre-commit/commit/f511afe40e3f0ea7474d37f19c69741d3e167876"><code>f511afe</code></a> v2.7.1</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/7c804cabe6a7169c03939453a950dce9b3bd8197"><code>7c804ca</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1577">#1577</a> from pre-commit/os_replace</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/fe70c72691bd725c5f870cae1b579d9bf9f9dca9"><code>fe70c72</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1576">#1576</a> from pre-commit/immediately_unhealthy_cache</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/79b098c409460166d810c51a3048ba427a0e9e80"><code>79b098c</code></a> fix atomic file replace on windows</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/b63b37ac36caf89de55a7ae45bb57d981b1b1e36"><code>b63b37a</code></a> fix cache of invalidated unhealthy environment version info</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/2e0ee5f5b216cba29e41f2b2fe1106e1d1e2e52c"><code>2e0ee5f</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1572">#1572</a> from rkm/issues/1569-docker-perf</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/eb8b48aeb439ee69610a7c08a3a1de75fbbfe572"><code>eb8b48a</code></a> remove docker_is_running check from source</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/f1de792877f904b7349d3ae163a3694f2854ade1"><code>f1de792</code></a> v2.7.0</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/a438dbfcf662c37f545db22f11a7209bb1fd1470"><code>a438dbf</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1570">#1570</a> from pre-commit/readonly</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/bf33f4c91c2e73bac36ec37a3dcf92bef8f0492c"><code>bf33f4c</code></a> allow pre-commit to succeed on a readonly store directory</li>
<li>Additional commits viewable in <a href="https://github.com/pre-commit/pre-commit/compare/v2.6.0...v2.7.1">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pre-commit&package-manager=pip&previous-version=2.6.0&new-version=2.7.1)](https://dependabot.com/compatibility-score/?dependency-name=pre-commit&package-manager=pip&previous-version=2.6.0&new-version=2.7.1)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Fix pre-commit cache key to include full Python version as per https://github.com/pre-commit/pre-commit/issues/1575#issuecomment-678792700 and https://pre-commit.com/#github-actions-example.
Fixes typo in src/flask/blueprints.py

https://github.com/pallets/flask/blob/e071734b4e9f5c21fe65400b167ff327c6c1f7bc/src/flask/blueprints.py#L124

I think this was supposed to be:

> By default, the blueprint will automatically **set** this...

This commit provides possibility to set DIGEST_METHOD_HASH_ALGORITHM environment variable to use different hashing algorithm for digest_method in SecureCookieSessionInterface.

This is my first contribution so I was not sure if I should document somewhere usage of this possible environment variable and if I should create some tests for this since all default tests pass.

This possibility was requested in issue #3720
If [rich](https://github.com/willmcgugan/rich) available, flask cli format routes by rich table

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

As #2468 has mentioned, send_file opens a file that mean to be closed by some further processing of the WSGI server. However, test_client does not really run the WSGI server, causing the opened file not closed until all test ends, and thus triggers a ResourceWarning and causes cleaning code after a test request to fail.

# Expected Behavior
A file opened by send_file() should be closed after response is sent.

```python
from flask import Flask
from flask import send_file
import unittest
import os

app = Flask(__name__, root_path='.')

@app.route('/<path:filepath>')
def handle_request(filepath):
    return send_file(filepath)

class Test(unittest.TestCase):
    def test(self):
        temp_file = os.path.join(os.path.dirname(__file__), 'test.txt')
        for i in ('123abc', '&@!#^*', '你好嗎'):
            with self.subTest(i=i):
                test_text = 'test' + str(i)
                with open(temp_file, 'w', encoding='UTF-8') as f:
                    f.write(test_text)
                try:
                    with app.test_client() as c:
                        r = c.get(temp_file)
                        self.assertEqual(r.data.decode('UTF-8'), test_text)
                finally:
                    os.remove(temp_file)

if __name__ == '__main__':
    unittest.main()
```

### Actual Behavior
The opened file is not closed properly after the response is sent, causing following code in the test fail to delete the file (which is temporarily generated for testing purpose).

```pytb
......\test.py:22: ResourceWarning: unclosed file <_io.BufferedReader name='......\\test.txt'>
  r = c.get(temp_file)
ResourceWarning: Enable tracemalloc to get the object allocation traceback
......\case.py:704: ResourceWarning: unclosed file <_io.BufferedReader name='......\\test.txt'>
  outcome.errors.clear()
ResourceWarning: Enable tracemalloc to get the object allocation traceback

======================================================================
ERROR: test (__main__.Test) (i=1)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "......\test.py", line 25, in test
    os.remove(temp_file)
PermissionError: [WinError 32] 程序無法存取檔案，因為檔案正由另一個程序使用。: '......\\test.txt'

======================================================================
ERROR: test (__main__.Test) (i=2)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "......\test.py", line 25, in test
    os.remove(temp_file)
PermissionError: [WinError 32] 程序無法存取檔案，因為檔案正由另一個程序使用。: '......\\test.txt'

======================================================================
ERROR: test (__main__.Test) (i=3)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "......\test.py", line 25, in test
    os.remove(temp_file)
PermissionError: [WinError 32] 程序無法存取檔案，因為檔案正由另一個程序使用。: '......\\test.txt'

----------------------------------------------------------------------
Ran 1 test in 0.010s

FAILED (errors=3)
```

### Environment

* Python version: 3.8.1
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

Bumps [sphinx](https://github.com/sphinx-doc/sphinx) from 3.2.0 to 3.2.1.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/sphinx-doc/sphinx/blob/3.x/CHANGES">sphinx's changelog</a>.</em></p>
<blockquote>
<h1>Release 3.2.1 (released Aug 14, 2020)</h1>
<h2>Features added</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8095">#8095</a>: napoleon: Add :confval:<code>napoleon_preprocess_types</code> to enable the type
preprocessor for numpy style docstrings</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8114">#8114</a>: C and C++, parse function attributes after parameters and qualifiers.</li>
</ul>
<h2>Bugs fixed</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8074">#8074</a>: napoleon: Crashes during processing C-ext module</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8088">#8088</a>: napoleon: &quot;Inline literal start-string without end-string&quot; warning in
Numpy style Parameters section</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8084">#8084</a>: autodoc: KeyError is raised on documenting an attribute of the broken
class</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8091">#8091</a>: autodoc: AttributeError is raised on documenting an attribute on Python
3.5.2</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8099">#8099</a>: autodoc: NameError is raised when target code uses <code>TYPE_CHECKING</code></li>
<li>C++, fix parsing of template template paramters, broken by the fix of <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7944">#7944</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/359794281065646a81f2fb3d3a7086681c61e12d"><code>3597942</code></a> Bump to 3.2.1 final</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/5d70682dda8118d04522c699d646eda2f3dc5d85"><code>5d70682</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8108">#8108</a> from tk0miya/8099_NameError_for_TYPE_CHECKING</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/d3912121018f5c33390e1243af730b9ad48ab292"><code>d391212</code></a> Merge branch '3.2.x' into 8099_NameError_for_TYPE_CHECKING</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/90e9b31a16a2679889ef75db6040b55ab51bb536"><code>90e9b31</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8117">#8117</a> from jakobandersen/c_cpp_function_attributes</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/52140be6b8d32795aaf99d4535121eaea6d8b3b3"><code>52140be</code></a> C and C++, parsing function attributes</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/667a188e25cb70a1c673081b066a8a90c6e8eea7"><code>667a188</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8113">#8113</a> from jakobandersen/cpp_template_template</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/d72fedb69d7a90eebf8ca92cbaa4c678c381e11a"><code>d72fedb</code></a> C++, fix template template parameter parsing</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/611fff975e9c1b3972fd9e2dfd7a96d3d8d8cdb7"><code>611fff9</code></a> Fix <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8099">#8099</a>: autodoc: NameError is raised when script uses TYPE_CHECKING</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/99e36398fcb5fd4e07dd0dcad1c36afaa7e75800"><code>99e3639</code></a> Update CHANGES for PR <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8095">#8095</a></li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/6e62d33566b5c98d9d36f3b98fac983f55356aae"><code>6e62d33</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8095">#8095</a> from keewis/toggle-preprocessor</li>
<li>Additional commits viewable in <a href="https://github.com/sphinx-doc/sphinx/compare/v3.2.0...v3.2.1">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=sphinx&package-manager=pip&previous-version=3.2.0&new-version=3.2.1)](https://dependabot.com/compatibility-score/?dependency-name=sphinx&package-manager=pip&previous-version=3.2.0&new-version=3.2.1)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Error messages were being overriden with a popup, "Please fill out this field", because of the required attribute from the respective templates. Preserved custom error messages by disabling the required attribute.
I added "C:\path\to\app>flask run" to both Command Prompt and PowerShell. 

I am unsure if the PowerShell command is correct, it threw an error "Could not import "hello"." My reasoning is that it might not be immediately obvious to use "flask run" after the "set" command, which could lead to frustration as the user doesn't know what to do and searching online for the issue does not yield the required result (execute flask run). I think it's a basic Quality of Life change for new people to Flask.
When loading static assets and a javascript module is declared like so:

```html
   <script
      type="module"
      src="{{ url_for('static', filename='js/app.js') }}"
    ></script>
```

and files are imported within the module like this:

```javascript
import SomeClass from './utils'
```

then it will have the content-type in the header set to 'html/text' and it will spit this error in the browser console

```
Failed to load module script: The server responded with a non-JavaScript MIME type of "text/html". Strict MIME type checking is enforced for module scripts per HTML spec.
```

The workaround for this is to import files in javascript like this:

```javascript
import SomeClass from './utils.js'
```

And then the server sends the correct content-type with the header.  My recommendation would be that if a file is getting imported as part of a javascript module, the server should infer that it is javascript even without the .js extension

Lastly, since it is the server that sets these headers, I assumed Flask was the culprit.  If I am mistaken, let me know where I should repost this issue.

### Environment

* Python version: 3.8.2
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

Updated the out of sync documentation for Flask 1.1x. Updated the teardown app context function to take the instance of an exception as a parameter.

#3717 
Flask always generates color escapes in the log for each HTTP request once color package is installed, but color escapes are undesired for systems that don't support it (such as Windows) and when the log is to be written to a file.

I think we can add an option to disable generating the color escapes.

Commit 2ae740dd4903bbe5f3864384bcdf2ab2d4638bce probably inadvertently
changed to iterate over a set of "create_app", "make_app" to discover
application factory functions. As sets don't guarantee order,
differences in the implementation of the type can make it
non-deterministic which factory function is used if a project implements
both. Revert to using a tuple.
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

_This is no critical bug and more like an enhancement / proposal._

Some flask extensions populate the entrypoint `flask.commands`, e. g. Flask-Migrate with `db`. Those commands can't later be overwritten with user-defined commands using `app.cli.add_command(my_db_cmnd, name="db")`. The only possibility is using `setup.py` and specifying it there. The setup script seems to have priority (for overwriting) but is not really flexible.
It is also not possible to hide those commands that are defined in other packages.

### Expected Behavior

I should be able to overwrite other entrypoint commands using my commands. (My commands are specified later(?) and should have priority.) (Or if I just want to disable some pre-defined commands from other packages.)

### Actual Behavior

```python
# file: app.py
import click
from flask import Flask
from flask.cli import with_appcontext

@click.command()
@with_appcontext
def my_db_cmd():
    """Dummy."""
    click.echo("test")

def create_app(**kwargs):
    app = Flask(__name__.split(".")[0])
    app.cli.add_command(my_db_cmd, name="db")
    return app
```

```bash
pip install Flask-Migrate

FLASK_APP="app:create_app()" flask
```

Output:

```bash
Usage: flask [OPTIONS] COMMAND [ARGS]...

  A general utility script for Flask applications.

  Provides commands from Flask, extensions, and the application. Loads the
  application defined in the FLASK_APP environment variable, or from a
  wsgi.py file. Setting the FLASK_ENV environment variable to 'development'
  will enable debug mode.

    $ export FLASK_APP=hello.py
    $ export FLASK_ENV=development
    $ flask run

Options:
  --version  Show the flask version
  --help     Show this message and exit.

Commands:
  db      Perform database migrations.    # <-------------
  routes  Show the routes for the app.
  run     Run a development server.
  shell   Run a shell in the app context.
```

I want to have this:

```bash
  db2    Dummy.
```

`db` is the command from `Flask-Migrate` that is always enabled if I just install the package.
See: https://github.com/miguelgrinberg/Flask-Migrate/blob/b34d9e3ff79ffb2f6c0204289f697a08852d0859/setup.py#L35

### Possible solution

I would propose to introduce an environment variable, e. g. `FLASK_DISABLE_ENTRYPOINT_COMMANDS=1`, that just sets `_loaded_plugin_commands` to `True` to skip loading plugin commands.

- should hook somewhere here: https://github.com/pallets/flask/blob/1a9059dd3a0c1a8574f6555e92f3ec3c596284f5/src/flask/cli.py#L524

### Environment

* Python version: 3.7.5
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

The `samesite` key is required on empty cookies. When a flask `session` is cleared, the delete cookie logic needs to set the configured `samesite` and `secure` keys.

![samesite missing on cookie](https://user-images.githubusercontent.com/5615725/89786111-6aaa4400-dae9-11ea-9071-0d3bf138bc1a.png)

Requires that https://github.com/pallets/werkzeug/pull/1889 is merged first.
Bumps [sphinx](https://github.com/sphinx-doc/sphinx) from 3.1.2 to 3.2.0.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/sphinx-doc/sphinx/blob/3.x/CHANGES">sphinx's changelog</a>.</em></p>
<blockquote>
<h1>Release 3.2.0 (released Aug 08, 2020)</h1>
<h2>Deprecated</h2>
<ul>
<li><code>sphinx.ext.autodoc.members_set_option()</code></li>
<li><code>sphinx.ext.autodoc.merge_special_members_option()</code></li>
<li><code>sphinx.writers.texinfo.TexinfoWriter.desc</code></li>
<li>C, parsing of pre-v3 style type directives and roles, along with the options
:confval:<code>c_allow_pre_v3</code> and :confval:<code>c_warn_on_allowed_pre_v3</code>.</li>
</ul>
<h2>Features added</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/2076">#2076</a>: autodoc: Allow overriding of exclude-members in skip-member function</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8034">#8034</a>: autodoc: <code>:private-member:</code> can take an explicit list of member names
to be documented</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/2024">#2024</a>: autosummary: Add :confval:<code>autosummary_filename_map</code> to avoid conflict
of filenames between two object with different case</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8011">#8011</a>: autosummary: Support instance attributes as a target of autosummary
directive</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7849">#7849</a>: html: Add :confval:<code>html_codeblock_linenos_style</code> to change the style
of line numbers for code-blocks</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7853">#7853</a>: C and C++, support parameterized GNU style attributes.</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7888">#7888</a>: napoleon: Add aliases Warn and Raise.</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7690">#7690</a>: napoleon: parse type strings and make them hyperlinks as possible.  The
conversion rule can be updated via :confval:<code>napoleon_type_aliases</code></li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8049">#8049</a>: napoleon: Create a hyperlink for each the type of parameter when
:confval:<code>napoleon_use_params</code> is False</li>
<li>C, added :rst:dir:<code>c:alias</code> directive for inserting copies
of existing declarations.</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7745">#7745</a>: html: inventory is broken if the docname contains a space</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7991">#7991</a>: html search: Allow searching for numbers</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7902">#7902</a>: html theme: Add a new option :confval:<code>globaltoc_maxdepth</code> to control
the behavior of globaltoc in sidebar</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7840">#7840</a>: i18n: Optimize the dependencies check on bootstrap</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7768">#7768</a>: i18n: :confval:<code>figure_language_filename</code> supports <code>docpath</code> token</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/5208">#5208</a>: linkcheck: Support checks for local links</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/5090">#5090</a>: setuptools: Link verbosity to distutils' -v and -q option</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/6698">#6698</a>: doctest: Add <code>:trim-doctest-flags:</code> and <code>:no-trim-doctest-flags:</code>
options to doctest, testcode and testoutput directives</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7052">#7052</a>: add <code>:noindexentry:</code> to the Python, C, C++, and Javascript domains.
Update the documentation to better reflect the relationship between this option
and the <code>:noindex:</code> option.</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7899">#7899</a>: C, add possibility of parsing of some pre-v3 style type directives and
roles and try to convert them to equivalent v3 directives/roles.
Set the new option :confval:<code>c_allow_pre_v3</code> to <code>True</code> to enable this.
The warnings printed from this functionality can be suppressed by setting
:confval:`c_warn_on_allowed_pre_v3<code>to</code>True``.</li>
</ul>
<!-- raw HTML omitted -->
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/e91f8a7d05d43c9e3dc68f48ef4065aaa495df2c"><code>e91f8a7</code></a> Bump to 3.2.0 final</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/b4efb8cd0e8943b232fe9cfbefe161efbffeb560"><code>b4efb8c</code></a> Merge CHANGES of 3.1.3 (unreleased) to 3.2.0</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/5fd89964c5b46f5dbaaa9b41427fdc89357fca6a"><code>5fd8996</code></a> Update CHANGES for PR <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8071">#8071</a></li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/b2d3f066218ff5da3cb9bc6d8039bd3cda69c052"><code>b2d3f06</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8071">#8071</a> from asmeurer/self-reference-warning-type</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/2a59fbcdbeb9a623173c465b0f46335df86a05fb"><code>2a59fbc</code></a> Make the toc.circular suppress_warnings flag apply to self referenced toctrees</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/f92fa6443fe6f457ab0c26d41eb229e825fda5e1"><code>f92fa64</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8038">#8038</a> from keewis/custom-get_documenter</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/697dff31ab09625ead62e1a7ec0780126aeb07c6"><code>697dff3</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8042">#8042</a> from tk0miya/8041_ivar_on_superclass_not_shown</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/88b2ec6c34fb405cf468475e6f2a7754e2c705eb"><code>88b2ec6</code></a> Fix <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8041">#8041</a>: autodoc: An ivar on super class is not shown unexpectedly</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/5aa774b97aaae5cb61ded869038fce75724d0fe6"><code>5aa774b</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8056">#8056</a> from tk0miya/7780_multi_params_in_numpydoc</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/16e62c57e900bd2983ada25c8512366087ce7a19"><code>16e62c5</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8065">#8065</a> from tk0miya/8049_update_testcase</li>
<li>Additional commits viewable in <a href="https://github.com/sphinx-doc/sphinx/compare/v3.1.2...v3.2.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=sphinx&package-manager=pip&previous-version=3.1.2&new-version=3.2.0)](https://dependabot.com/compatibility-score/?dependency-name=sphinx&package-manager=pip&previous-version=3.1.2&new-version=3.2.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->
I cannot make any changes to my cloned Flask app: .https://github.com/cyrilrbt/canadian-nutrient-file
I used command bin/buildout to rebuild the app after making these changes just in case but it still goes to the original templates.

So I also tried editing the original templates as shown here on line 7 to 9 I inserted:

<p>hello</p>

but it's still not reflected.

Also the <h1> element in index.html here: https://github.com/nyck33/canadian-nutrient-file/blob/master/cnf/templates/index.html
does not appear and I have no idea where the "Food Standards" heading shown in screenshot below comes from.  

![image](https://user-images.githubusercontent.com/25189545/89724399-7990d980-d9b7-11ea-8bfc-e4481f8ecf93.png)


```python
# Paste a minimal example that causes the problem.
The repo here: https://github.com/nyck33/canadian-nutrient-file has already been built out and CSV files imported to mongodb so if you clone it, make a virtual environment with provided `requirements.txt` (I used conda), and run `bin/cnf runserver` , it should run.  
```

### Actual Behavior
<!-- Tell us what happens instead. -->
Actually as the screenshot above shows, I get "Food Standards" rather than what is in the <h1> heading.
Changes to any template are not reflected.  

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version: 3.7.7
* Flask version:  1.1.2
* Werkzeug version:  1.0.1

WTForms has removed the documentation of the stable version, it causes the 404 error when building documentation. This PR changes the stable URL to the default URL (`https://wtforms.readthedocs.io/`).
Bumps [tox](https://github.com/tox-dev/tox) from 3.18.1 to 3.19.0.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/tox-dev/tox/blob/master/docs/changelog.rst">tox's changelog</a>.</em></p>
<blockquote>
<h1>v3.19.0 (2020-08-06)</h1>
<h2>Bugfixes</h2>
<ul>
<li>skip <code>setup.cfg</code> if it has no <code>tox:tox</code> namespace - by hroncok <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1045">#1045</a></li>
</ul>
<h2>Features</h2>
<ul>
<li>Implement support for building projects having 517#in-tree-build-backends <code>backend-path</code> setting -by webknjaz <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1575">#1575</a></li>
<li>Don't require a tox config file for <code>tox --devenv</code> - by hroncok <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1643">#1643</a></li>
</ul>
<h2>Documentation</h2>
<ul>
<li>Fixed grammar in top-level documentation - by tfurf <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1631">#1631</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/tox-dev/tox/commit/0c8c729cf0ac25ed0da1fbcb40ab2e1eddbdaa11"><code>0c8c729</code></a> release 3.19.0</li>
<li><a href="https://github.com/tox-dev/tox/commit/8317240adeef07f99b638ff70a303e01c9b7e015"><code>8317240</code></a> Allow to use --devenv without tox config (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1644">#1644</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/6f5bee8473c44b8f8d8ede8df7c4550cecb2cdbb"><code>6f5bee8</code></a> Do not use setup.cfg file that does not have tox:tox namespace (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1642">#1642</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/9d011829cf3d7d73d82e1700fe864fdaa7ca71f8"><code>9d01182</code></a> Fix <code>:user:</code> role syntax in the <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1631">#1631</a> change note (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1637">#1637</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/59766bb62d896b44c90f4069392544f7c29e907a"><code>59766bb</code></a> Docs grammar (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1631">#1631</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/6c1c2fa961b958858980b32731fc52ca0494d367"><code>6c1c2fa</code></a> Bump pre-commit</li>
<li><a href="https://github.com/tox-dev/tox/commit/ddfae2dcb5443509e50783fe9e13395f60845e4a"><code>ddfae2d</code></a> Implement support for PEP517 backend-path setting (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1614">#1614</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/268ca020ef8bf1600123add72eb4984cba970a4d"><code>268ca02</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1632">#1632</a> from tox-dev/release-3.18.1</li>
<li>See full diff in <a href="https://github.com/tox-dev/tox/compare/3.18.1...3.19.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=tox&package-manager=pip&previous-version=3.18.1&new-version=3.19.0)](https://dependabot.com/compatibility-score/?dependency-name=tox&package-manager=pip&previous-version=3.18.1&new-version=3.19.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
It would be nice if `test_client` API be the same as `requests` so that they would be interchangeable.
That would allow reusing tests code to actually use the API (or vice versa).

Example for API difference:
requests: `response.json()`.
flask test_client: `response.get_json()`.
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
`SecureCookieSessionInterface` should provide a configurable way of easily setting the signer to a stronger algorithm (e.g. sha-512) from a dependency upstream (e.g. via environment variable). 
Although sha-1, used in hmac, is still secure, at least making this configurable would allow Flask users not to wait till sha-1 is broken.

### Actual Behavior
<!-- Tell us what happens instead. -->

Default hash method in `SecureCookieSessionInterface` is [sha1](https://github.com/pallets/flask/blob/master/src/flask/sessions.py#L313)

`digest_method` is a class variable of `SecureCookieSessionInterface`, and as such, it could be changed before hand. However, for upstream libraries that have Flask as 3rd party dependency (via another library), overwriting this class variable would require importing this class at the highest level. Exposing the value for the hashing algorithm as environment variable would allow overwriting `digest_method` more easily.

```python
class SecureCookieSessionInterface(SessionInterface):
    """The default session interface that stores sessions in signed cookies
    through the :mod:`itsdangerous` module.
    """

    #: the salt that should be applied on top of the secret key for the
    #: signing of cookie based sessions.
    salt = "cookie-session"
    #: the hash function to use for the signature.  The default is sha1
    digest_method = staticmethod(hashlib.sha1)
    #: the name of the itsdangerous supported key derivation.  The default
    #: is hmac.
```
### Environment

* Python version: 3.*
* Flask version: 1.1.2
* Werkzeug version: NA

Hello everyone, 

Im getting `Error: read ECONNRESET` on postman while I'm hitting the API and in console `127.0.0.1 - - [04/Aug/2020 23:42:05] "←[37mPOST /get-me-the-data HTTP/1.1←[0m" 500 -`

Though I have previously worked with Flask but at that it didn't give me any error of Error: read ECONNRESET

flask version : 1.1.2 
windows 10 home
python 3.7

`from flask import Flask, jsonify, request, abort, json
from werkzeug.utils import secure_filename
from werkzeug.exceptions import HTTPException
from flask_cors import CORS, cross_origin
import traceback
app = Flask(__name__)
cors = CORS(app)

app.config['CORS_HEADERS'] = 'Content-Type'
@app.route("/get-me-the-data", methods=['POST'])
def get_me_the_data():

    try:
        print("HI")
        1/0
        jsonify({"message" : "Entry done"}), 200

    except Exception as e:
        # abort(500)
        jsonify({"message" : "Internal Server Error "}), 500
        

@app.errorhandler(500)
def internal_error(error):
    return "Internal server error", 500


app.run(debug=True, host="0.0.0.0", port=3000) `
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
According to https://flask.palletsprojects.com/en/master/testing/#the-first-test, test should pass

```python
import os
import tempfile

import pytest

from flaskr import create_app


@pytest.fixture
def client():
    db_fd, flaskr.app.config['DATABASE'] = tempfile.mkstemp()
    flaskr.app.config['TESTING'] = True

    with flaskr.app.test_client() as client:
        with flaskr.app.app_context():
            flaskr.init_db()
        yield client

    os.close(db_fd)
    os.unlink(flaskr.app.config['DATABASE'])

def test_empty_db(client):
    """Start with a blank database."""

    rv = client.get('/')
    assert b'No entries here so far' in rv.data
```

### Actual Behavior
The test fail

```pytb
(test2) florian@POC-Docker-1:~/test_testing_flask/flask/examples/tutorial$ pytest -v
========================================================================================================== test session starts ==========================================================================================================
platform linux -- Python 3.6.9, pytest-6.0.1, py-1.9.0, pluggy-0.13.1 -- /home/florian/.pyenv/versions/3.6.9/envs/test2/bin/python3.6
cachedir: .pytest_cache
rootdir: /home/florian/test_testing_flask/flask/examples/tutorial, configfile: setup.cfg, testpaths: tests
collected 25 items                                                                                                                                                                                                                      

tests/test_auth.py::test_register PASSED                                                                                                                                                                                          [  4%]
tests/test_auth.py::test_register_validate_input[--Username is required.] PASSED                                                                                                                                                  [  8%]
tests/test_auth.py::test_register_validate_input[a--Password is required.] PASSED                                                                                                                                                 [ 12%]
tests/test_auth.py::test_register_validate_input[test-test-already registered] PASSED                                                                                                                                             [ 16%]
tests/test_auth.py::test_login PASSED                                                                                                                                                                                             [ 20%]
tests/test_auth.py::test_login_validate_input[a-test-Incorrect username.] PASSED                                                                                                                                                  [ 24%]
tests/test_auth.py::test_login_validate_input[test-a-Incorrect password.] PASSED                                                                                                                                                  [ 28%]
tests/test_auth.py::test_logout PASSED                                                                                                                                                                                            [ 32%]
tests/test_blog.py::test_index PASSED                                                                                                                                                                                             [ 36%]
tests/test_blog.py::test_login_required[/create] PASSED                                                                                                                                                                           [ 40%]
tests/test_blog.py::test_login_required[/1/update] PASSED                                                                                                                                                                         [ 44%]
tests/test_blog.py::test_login_required[/1/delete] PASSED                                                                                                                                                                         [ 48%]
tests/test_blog.py::test_author_required PASSED                                                                                                                                                                                   [ 52%]
tests/test_blog.py::test_exists_required[/2/update] PASSED                                                                                                                                                                        [ 56%]
tests/test_blog.py::test_exists_required[/2/delete] PASSED                                                                                                                                                                        [ 60%]
tests/test_blog.py::test_create PASSED                                                                                                                                                                                            [ 64%]
tests/test_blog.py::test_update PASSED                                                                                                                                                                                            [ 68%]
tests/test_blog.py::test_create_update_validate[/create] PASSED                                                                                                                                                                   [ 72%]
tests/test_blog.py::test_create_update_validate[/1/update] PASSED                                                                                                                                                                 [ 76%]
tests/test_blog.py::test_delete PASSED                                                                                                                                                                                            [ 80%]
tests/test_db.py::test_get_close_db PASSED                                                                                                                                                                                        [ 84%]
tests/test_db.py::test_init_db_command PASSED                                                                                                                                                                                     [ 88%]
tests/test_factory.py::test_config PASSED                                                                                                                                                                                         [ 92%]
tests/test_factory.py::test_hello PASSED                                                                                                                                                                                          [ 96%]
tests/test_flaskr.py::test_empty_db ERROR                                                                                                                                                                                         [100%]

================================================================================================================ ERRORS =================================================================================================================
____________________________________________________________________________________________________ ERROR at setup of test_empty_db ____________________________________________________________________________________________________

    @pytest.fixture
    def client():
>       db_fd, flaskr.app.config['DATABASE'] = tempfile.mkstemp()
E       NameError: name 'flaskr' is not defined

tests/test_flaskr.py:11: NameError
======================================================================================================== short test summary info ========================================================================================================
ERROR tests/test_flaskr.py::test_empty_db - NameError: name 'flaskr' is not defined
====================================================================================================== 24 passed, 1 error in 1.30s ======================================================================================================
```

### Environment

* Python version: Python 3.6.9
* Flask version: 1.1.2   
* Werkzeug version: 1.0.1

The documentation shows and example of a teardown function executed at the end of the app context https://flask.palletsprojects.com/en/1.1.x/appcontext/#storing-data.

The signature of the function decorated teardown function is `teardown_X()` but inspecting the codebase for Flask 1.1.x the function's signature must be `teardown_X(exception: Exception)` https://github.com/pallets/flask/blob/1.1.1/tests/test_appctx.py#L56.

I reckon that the documentation is out of sync.

### Environment

* Python version: 3.7
* Flask version: 1.1.1
* Werkzeug version: 0.16.0

Bumps [pip-tools](https://github.com/jazzband/pip-tools) from 5.3.0 to 5.3.1.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/jazzband/pip-tools/releases">pip-tools's releases</a>.</em></p>
<blockquote>
<h2>5.3.1</h2>
<p>Bug Fixes:</p>
<ul>
<li>Fix <code>pip-20.2</code> compatibility issue that caused <code>pip-tools</code> to sometime fail to stabilize in a constant number of rounds (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1194">1194</a>). Thanks <a href="https://github.com/vphilippon">@vphilippon</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/jazzband/pip-tools/blob/master/CHANGELOG.md">pip-tools's changelog</a>.</em></p>
<blockquote>
<h1>5.3.1 (2020-07-31)</h1>
<p>Bug Fixes:</p>
<ul>
<li>Fix <code>pip-20.2</code> compatibility issue that caused <code>pip-tools</code> to sometime fail to
stabilize in a constant number of rounds
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1194">1194</a>). Thanks <a href="https://github.com/vphilippon">@vphilippon</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/jazzband/pip-tools/commit/89a00b08416fa0115f1b4400218504261099d2d1"><code>89a00b0</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1195">#1195</a> from atugushev/release-5.3.1</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/e85720b313c1e1477523027f7dcaa062d8cd6495"><code>e85720b</code></a> 5.3.1 changelog</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/ed59c3675479ac687864fb0ce130a9bb2bdbe429"><code>ed59c36</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1194">#1194</a> from vphilippon/improve-RequirementSummary-eq-and-hash</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/0dad94e7251779bf31bbd922bf7b51cf824bd875"><code>0dad94e</code></a> Make RequirementSummary equality and hash unsentive to version format variation</li>
<li>See full diff in <a href="https://github.com/jazzband/pip-tools/compare/5.3.0...5.3.1">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pip-tools&package-manager=pip&previous-version=5.3.0&new-version=5.3.1)](https://dependabot.com/compatibility-score/?dependency-name=pip-tools&package-manager=pip&previous-version=5.3.0&new-version=5.3.1)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>

This PR enables Sphinx extension sphinx-tabs to add support for command switch between Bash, CMD and Powershell. It also adds command tabs for all export commands and all venv commands. The command tabs will look like this:

![image-20200802130954306](https://user-images.githubusercontent.com/12967000/89135984-e6ddde00-d563-11ea-9422-13e4a926496e.png)

There is also a style update in Pallets Sphinx theme (https://github.com/pallets/pallets-sphinx-themes/pull/31) for this change, the final style will be like this (if merged):
![image-20200802131211668](https://user-images.githubusercontent.com/12967000/89125841-d271f500-d513-11ea-8c88-545550d62ff0.png)


Fix #3697
Bumps [pytest](https://github.com/pytest-dev/pytest) from 6.0.0 to 6.0.1.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/releases">pytest's releases</a>.</em></p>
<blockquote>
<h2>6.0.1</h2>
<h1>pytest 6.0.1 (2020-07-30)</h1>
<h2>Bug Fixes</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7394">#7394</a>: Passing an empty <code>help</code> value to <code>Parser.add_option</code> is now accepted instead of crashing when running <code>pytest --help</code>.
Passing <code>None</code> raises a more informative <code>TypeError</code>.</li>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7558">#7558</a>: Fix pylint <code>not-callable</code> lint on <code>pytest.mark.parametrize()</code> and the other builtin marks:
<code>skip</code>, <code>skipif</code>, <code>xfail</code>, <code>usefixtures</code>, <code>filterwarnings</code>.</li>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7559">#7559</a>: Fix regression in plugins using <code>TestReport.longreprtext</code> (such as <code>pytest-html</code>) when <code>TestReport.longrepr</code> is not a string.</li>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7569">#7569</a>: Fix logging capture handler's level not reset on teardown after a call to <code>caplog.set_level()</code>.</li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/blob/master/CHANGELOG.rst">pytest's changelog</a>.</em></p>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pytest-dev/pytest/commit/92af2e22d276d6f9b6aca4435ec19af81ffaea49"><code>92af2e2</code></a> Prepare release version 6.0.1</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/0307213254ca29b55fb6ddb6ba20c4687713e785"><code>0307213</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7582">#7582</a> from bluetech/backport-7581</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/df7b26704db18a75188d7bb6630b549817f529da"><code>df7b267</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7581">#7581</a> from bluetech/logging-setlevel-handler-restore</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/15167808293254d415eefaf57be330c30e6db322"><code>1516780</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7578">#7578</a> from nicoddemus/backport-7555</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/b945b39b0bca9bc165e01e7d8cc6ae5963b386fc"><code>b945b39</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7577">#7577</a> from nicoddemus/backport-7427</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/2d5b8a85c2a5e755b304dfff7552ab9b494eb5fd"><code>2d5b8a8</code></a> Warn about --basetemp removing the entire directory (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7555">#7555</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/8963644da3c960591393c64937a4383d5c6d0caf"><code>8963644</code></a> Fix --help crash on add_ini(.., help='') and improve message on help=None (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7">#7</a>...</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/e8761576cde52e7ccc73bca938ec734e8222f907"><code>e876157</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7574">#7574</a> from nicoddemus/backport-7561</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/3d2c114883b57a678a4e89dfc5780dc05406a359"><code>3d2c114</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7573">#7573</a> from nicoddemus/backport-7571</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/fe252848c56e081fc7eb1b98cd60e33ee33b7dd7"><code>fe25284</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7561">#7561</a> from nicoddemus/longreprtext-7559</li>
<li>Additional commits viewable in <a href="https://github.com/pytest-dev/pytest/compare/6.0.0...6.0.1">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pytest&package-manager=pip&previous-version=6.0.0&new-version=6.0.1)](https://dependabot.com/compatibility-score/?dependency-name=pytest&package-manager=pip&previous-version=6.0.0&new-version=6.0.1)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
When loading the app fails for the `--help` command, only the error message is shown, then the help text. The full traceback is still shown for other exceptions. Also show the message when loading fails while getting a command, instead of only "command not found". The error message goes to `stderr` to match other error behavior, and is in red with an extra newline to make it more obvious next to the help text.

Also fixes an issue with the `test_apps` fixture that caused an imported app to still be importable after the test was over and the path was reset. Now the module cache is reset as well. This was causing an issue with the new tests, because previous tests had imported `test_apps/helloworld/wsgi`, one of the default imports that is tried if `FLASK_APP` isn't set, which caused the test to import an app successfully even though it should have failed and shown an error. This also revealed an issue with an existing test relying on the cached behavior.

fixes #2741 
### Expected Behavior
The page [API - Flask Documentation](https://flask.palletsprojects.com/en/1.1.x/api/) should have a CSS style applied which visually separates different sections, so when a reader navigates in through an anchor link, then scrolls through the document, it is easier to identify the end of a section.

I found this works nicely (the styling of course could be edited):

```
dl.function, dl.data, dl.class{
  border: 1px blue dashed;
  background-color:#fafafa;
  margin-bottom:30px;
}
```
This can be applied through the "style-editor" in Firefox dev tools to preview:

![Screenshot 2020-07-31 at 00 14 28](https://user-images.githubusercontent.com/6283434/88983812-ede6c100-d2c3-11ea-97ed-f882cc538fbe.png)

### Actual Behavior
One wall of text.

### Environment
https://flask.palletsprojects.com/en/1.1.x/api/



Resolves #3215
Resolves #3215 

**Similar functions between Flask and Blueprint:**
**Chris:**
- [x] route
- [ ] add_url_rule
- [x] endpoint
- [x] before_request
- [x] after_request
- [ ] teardown_request

**Yanlam:**
- [x] init
- [x] context_processor
- [x] url_value_preprocessor
- [x] url_defaults
- [x] errorhandler
- [x] register_error_handler

jinja2.exceptions.TemplateNotFound: index.html 
Should i add path tfor the index.html as it is in the folder template\

Bumps [tox](https://github.com/tox-dev/tox) from 3.18.0 to 3.18.1.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/tox-dev/tox/blob/master/docs/changelog.rst">tox's changelog</a>.</em></p>
<blockquote>
<h1>v3.18.1 (2020-07-28)</h1>
<h2>Bugfixes</h2>
<ul>
<li>Fix <code>TypeError</code> when using isolated_build with backends that are not submodules (e.g. <code>maturin</code>) <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1629">#1629</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/tox-dev/tox/commit/594244ab1d6d969d47e142777c87bf56c9dab3fd"><code>594244a</code></a> release 3.18.1</li>
<li><a href="https://github.com/tox-dev/tox/commit/f6e60fd51103cae1e5d71f1ed102d2238beaf0fa"><code>f6e60fd</code></a> Fix isolated build helper scripts (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1629">#1629</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/57044567d60490285f7ad319d7baaff59d2752c4"><code>5704456</code></a> Fix the args_are_paths default in the docs. (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1628">#1628</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/64ddd54412135dcfed26e21fd1c1fd7e3e8f3d70"><code>64ddd54</code></a> [PY2] Do not advocate for py27 testing, prefer example with PY3 only (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1624">#1624</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/10d9558273e281f2c88551f7adccf3517b681f24"><code>10d9558</code></a> [cleanup] Remove artefacts from old py34 support (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1625">#1625</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/bd4004a45ab943b2cea0fae44abef01fb9edb9be"><code>bd4004a</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1626">#1626</a> from tox-dev/release-3.18.0</li>
<li>See full diff in <a href="https://github.com/tox-dev/tox/compare/3.18.0...3.18.1">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=tox&package-manager=pip&previous-version=3.18.0&new-version=3.18.1)](https://dependabot.com/compatibility-score/?dependency-name=tox&package-manager=pip&previous-version=3.18.0&new-version=3.18.1)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [pytest](https://github.com/pytest-dev/pytest) from 5.4.3 to 6.0.0.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/releases">pytest's releases</a>.</em></p>
<blockquote>
<h2>6.0.0</h2>
<h1>pytest 6.0.0 (2020-07-28)</h1>
<p>(<strong>Please see the full set of changes for this release also in the 6.0.0rc1 notes below</strong>)</p>
<h2>Breaking Changes</h2>
<ul>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/5584">#5584</a>: <strong>PytestDeprecationWarning are now errors by default.</strong></p>
<p>Following our plan to remove deprecated features with as little disruption as
possible, all warnings of type <code>PytestDeprecationWarning</code> now generate errors
instead of warning messages.</p>
<p><strong>The affected features will be effectively removed in pytest 6.1</strong>, so please consult the
<a href="https://docs.pytest.org/en/latest/deprecations.html">Deprecations and Removals</a>
section in the docs for directions on how to update existing code.</p>
<p>In the pytest <code>6.0.X</code> series, it is possible to change the errors back into warnings as a
stopgap measure by adding this to your <code>pytest.ini</code> file:</p>
<pre lang="{.sourceCode" data-meta=".ini}"><code>[pytest]
filterwarnings =
    ignore::pytest.PytestDeprecationWarning
</code></pre>
<p>But this will stop working when pytest <code>6.1</code> is released.</p>
<p><strong>If you have concerns</strong> about the removal of a specific feature, please add a
comment to <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/5584">#5584</a>.</p>
</li>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7472">#7472</a>: The <code>exec_()</code> and <code>is_true()</code> methods of <code>_pytest._code.Frame</code> have been removed.</p>
</li>
</ul>
<h2>Features</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7464">#7464</a>: Added support for NO_COLOR and FORCE_COLOR environment variables to control colored output.</li>
</ul>
<h2>Improvements</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7467">#7467</a>: <code>--log-file</code> CLI option and <code>log_file</code> ini marker now create subdirectories if needed.</li>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7489">#7489</a>: The pytest.raises function has a clearer error message when <code>match</code> equals the obtained string but is not a regex match. In this case it is suggested to escape the regex.</li>
</ul>
<h2>Bug Fixes</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7392">#7392</a>: Fix the reported location of tests skipped with <code>@pytest.mark.skip</code> when <code>--runxfail</code> is used.</li>
</ul>
<!-- raw HTML omitted -->
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/blob/master/CHANGELOG.rst">pytest's changelog</a>.</em></p>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pytest-dev/pytest/commit/41a453959441d9b03cba3e47730efca27fa2f252"><code>41a4539</code></a> Add link to 6.0.0rc1 changelog</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/45ced1dc056d586fe3714823fa033cab27055c9f"><code>45ced1d</code></a> Update doc/en/announce/release-6.0.0.rst</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/1e4b8d447cfaaf4ee7c4636d2a03cf484d06f1cd"><code>1e4b8d4</code></a> Prepare release version 6.0.0</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/38029828d1d6bdc15b63a873142b1e91265e1a1c"><code>3802982</code></a> Support generating major releases using issue comments (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7548">#7548</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/c2c0b7a5426ed74ba0df1bbc4997ffe45e302ccf"><code>c2c0b7a</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7545">#7545</a> from asottile/pylib_in_docs</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/9818899df4eacb65a4ec1397a93b5ebcf43e825c"><code>9818899</code></a> remove usage of pylib in docs</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/3a060b77e81ebf990159e59cc8f8de26ad998e12"><code>3a060b7</code></a> Revert change to traceback repr (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7535">#7535</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/7ec6401ffabf79d52938ece5b8ff566a8b9c260e"><code>7ec6401</code></a> Change pytest deprecation warnings into errors for 6.0 release (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7362">#7362</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/a9799f0b35fe8fcc88ebd19b007cd2c6ac6b2a4f"><code>a9799f0</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7531">#7531</a> from bluetech/changelog-mypy-version</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/102360b49051e7d2407003445157b0115ae18234"><code>102360b</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7519">#7519</a> from hroncok/pytest_warning_captured_deprecated</li>
<li>Additional commits viewable in <a href="https://github.com/pytest-dev/pytest/compare/5.4.3...6.0.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pytest&package-manager=pip&previous-version=5.4.3&new-version=6.0.0)](https://dependabot.com/compatibility-score/?dependency-name=pytest&package-manager=pip&previous-version=5.4.3&new-version=6.0.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
`self.assert_equal(data['username'], my_user.username)` is not in a class and is ambiguous. 

I think this line is technically incorrect in the context of the example snippet: `self.assert_equal` means nothing without a greater context (which isn't shared) whereas `assert` is explicit and clear.

I know that in the grand scheme of things this detail is inconsequential and that the docs aren't supposed to production code, but rather a design aid. However, as someone who has leant flask from the docs, I know that detail matters and it's better to be explicit and clear rather than ambiguous and confusing. 



Uses "Python -m pytest" to fix the issue with flaskr being unavailable in the tutorial.
Bumps [pip-tools](https://github.com/jazzband/pip-tools) from 5.2.1 to 5.3.0.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/jazzband/pip-tools/releases">pip-tools's releases</a>.</em></p>
<blockquote>
<h2>5.3.0</h2>
<p>Features:</p>
<ul>
<li>Add <code>-h</code> alias for <code>--help</code> option to <code>pip-sync</code> and <code>pip-compile</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1163">1163</a>). Thanks <a href="https://github.com/jan25">@jan25</a></li>
<li>Add <code>pip&gt;=20.2</code> support (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1168">1168</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a></li>
<li><code>pip-sync</code> now exists with code <code>1</code> on <code>--dry-run</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1172">1172</a>). Thanks <a href="https://github.com/francisbrito">@francisbrito</a></li>
<li><code>pip-compile</code> now doesn't resolve constraints from <code>-c constraints.txt</code>that are not (yet) requirements (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1175">1175</a>). Thanks <a href="https://github.com/clslgrnc">@clslgrnc</a></li>
<li>Add <code>--reuse-hashes/--no-reuse-hashes</code> options to <code>pip-compile</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1177">1177</a>). Thanks <a href="https://github.com/graingert">@graingert</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/jazzband/pip-tools/blob/master/CHANGELOG.md">pip-tools's changelog</a>.</em></p>
<blockquote>
<h1>5.3.0 (2020-07-26)</h1>
<p>Features:</p>
<ul>
<li>Add <code>-h</code> alias for <code>--help</code> option to <code>pip-sync</code> and <code>pip-compile</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1163">1163</a>). Thanks <a href="https://github.com/jan25">@jan25</a></li>
<li>Add <code>pip&gt;=20.2</code> support
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1168">1168</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a></li>
<li><code>pip-sync</code> now exists with code <code>1</code> on <code>--dry-run</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1172">1172</a>). Thanks <a href="https://github.com/francisbrito">@francisbrito</a></li>
<li><code>pip-compile</code> now doesn't resolve constraints from <code>-c constraints.txt</code>that are not
(yet) requirements
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1175">1175</a>). Thanks <a href="https://github.com/clslgrnc">@clslgrnc</a></li>
<li>Add <code>--reuse-hashes/--no-reuse-hashes</code> options to <code>pip-compile</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1177">1177</a>). Thanks <a href="https://github.com/graingert">@graingert</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/jazzband/pip-tools/commit/d4c26ce05257dd1c7b50ad5bcea2c5cf1574f7e3"><code>d4c26ce</code></a> 5.3.0 changelog</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/b8130a0c1ca5379334c8be21074f9c15cc54d035"><code>b8130a0</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1168">#1168</a> from atugushev/pip-20.2</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/41e743eda6533194022d90bad12921e6d1550b62"><code>41e743e</code></a> Add 20.2 to the CI matrix</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/153255e34aba03b108501e2246d9d5617e8516d4"><code>153255e</code></a> Support ireq.is_derect renamed to ireq.user_supplied</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/bd3e73582034594eb0fab2f9a6d9a5e38e0a98b4"><code>bd3e735</code></a> Update sync to return non-zero exit code on dry run (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1172">#1172</a>)</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/9eb10d7e20bcc4728f63c4a6bce497f8721f077e"><code>9eb10d7</code></a> Ignore local hashes with --no-reuse-hashes (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1177">#1177</a>)</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/d7db32afb180ecbfa8390dba39f7063c1c556af2"><code>d7db32a</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1175">#1175</a> from clslgrnc/patch-1</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/90b25999e47f1a8ff6b4bac28977876e96bfef99"><code>90b2599</code></a> test: invalid irrelevant pip constraints</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/c217a0bdd771269aa910bc2a556b5bf333625882"><code>c217a0b</code></a> Do not find_best_match for constraints</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/7503ad75d849b96c6e29afeefbc2d735681854ae"><code>7503ad7</code></a> Add py3.9 to CI workflow (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1169">#1169</a>)</li>
<li>Additional commits viewable in <a href="https://github.com/jazzband/pip-tools/compare/5.2.1...5.3.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pip-tools&package-manager=pip&previous-version=5.2.1&new-version=5.3.0)](https://dependabot.com/compatibility-score/?dependency-name=pip-tools&package-manager=pip&previous-version=5.2.1&new-version=5.3.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

Consider the following project

```bash
├── config.py
├── manage.py
├── project/
        ├── __init__.py
```

in `manage.py`

```python
from flask import current_app
from flask.cli import FlaskGroup
from project import create_app

cli = FlaskGroup(create_app=create_app)

@cli.command("app_config")
def app_config():
    print("current_app.debug from cli.command")
    print(current_app.debug)
    print("current_app.config from cli.command")
    print(current_app.config)

if __name__ == "__main__":
    cli()

```

in `config.py`

```python
import os

class BaseConfig:
    """Base configuration"""

    DEBUG = False
    TESTING = False
    ENV = "production"
    SECRET_KEY = os.environ.get("SECRET_KEY")
    WHAT = "BaseConfig"

class DevelopmentConfig(BaseConfig):
    """Development configuration"""
    DEBUG = True
    ENV = "development"
    WHAT = "DevelopmentConfig"
```

in `project/__init__.py`

```python
import os
from flask import Flask

# resolve what configuration will be used
config_dispatcher = {
    "development": "config.DevelopmentConfig",
    "default": "config.DevelopmentConfig"
    # add more dispatchers here
}


def create_app():
    # instantiate the app
    app = Flask(__name__)

    # set config
    configure_app(app, os.environ.get("FLASK_ENV", "default"))
    print("app.debug inside create_app")
    print(app.debug)

    # shell context for flask cli
    @app.shell_context_processor
    def ctx():
        return {"app": app}

    return app


def configure_app(app, config_name):
    # http://flask.pocoo.org/docs/2.0/config/
    # http://exploreflask.com/en/latest/configuration.html#configuring-based-on-environment-variables
    app.config.from_object(config_dispatcher[config_name])
    print("app.debug inside configure_app")
    print(app.debug)
```

if I run `python manage.py app_config I get

```bash
$python manage.py app_config
app.debug inside configure_app
True
app.debug inside create_app
True
current_app.debug from cli.command
False
current_app.config from cli.command
<Config {'ENV': 'development', 'DEBUG': False, 'TESTING': False, 'PROPAGATE_EXCEPTIONS': None, 'PRESERVE_CONTEXT_ON_EXCEPTION': None, 'SECRET_KEY': None, 'PERMANENT_SESSION_LIFETIME': datetime.timedelta(days=31), 'USE_X_SENDFILE': False, 'SERVER_NAME': None, 'APPLICATION_ROOT': '/', 'SESSION_COOKIE_NAME': 'session', 'SESSION_COOKIE_DOMAIN': None, 'SESSION_COOKIE_PATH': None, 'SESSION_COOKIE_HTTPONLY': True, 'SESSION_COOKIE_SECURE': False, 'SESSION_COOKIE_SAMESITE': None, 'SESSION_REFRESH_EACH_REQUEST': True, 'MAX_CONTENT_LENGTH': None, 'SEND_FILE_MAX_AGE_DEFAULT': datetime.timedelta(seconds=43200), 'TRAP_BAD_REQUEST_ERRORS': None, 'TRAP_HTTP_EXCEPTIONS': False, 'EXPLAIN_TEMPLATE_LOADING': False, 'PREFERRED_URL_SCHEME': 'http', 'JSON_AS_ASCII': True, 'JSON_SORT_KEYS': True, 'JSONIFY_PRETTYPRINT_REGULAR': False, 'JSONIFY_MIMETYPE': 'application/json', 'TEMPLATES_AUTO_RELOAD': None, 'MAX_COOKIE_SIZE': 4093, 'WHAT': 'DevelopmentConfig'}>
```

You see, the app is in development mode, i.e. FLASK_ENV is set with `config.DevelopmentConfig.ENV = "development"`, but FLASK_DEBUG is not set with `config.DevelopmentConfig.DEBUG = True`. If I run

```bash
$FLASK_DEBUG=true python manage.py app_config 
app.debug inside configure_app
True
app.debug inside create_app
True
current_app.debug from cli.command
True
current_app.config from cli.command
<Config {'ENV': 'development', 'DEBUG': True, 'TESTING': False, 'PROPAGATE_EXCEPTIONS': None, 'PRESERVE_CONTEXT_ON_EXCEPTION': None, 'SECRET_KEY': None, 'PERMANENT_SESSION_LIFETIME': datetime.timedelta(days=31), 'USE_X_SENDFILE': False, 'SERVER_NAME': None, 'APPLICATION_ROOT': '/', 'SESSION_COOKIE_NAME': 'session', 'SESSION_COOKIE_DOMAIN': None, 'SESSION_COOKIE_PATH': None, 'SESSION_COOKIE_HTTPONLY': True, 'SESSION_COOKIE_SECURE': False, 'SESSION_COOKIE_SAMESITE': None, 'SESSION_REFRESH_EACH_REQUEST': True, 'MAX_CONTENT_LENGTH': None, 'SEND_FILE_MAX_AGE_DEFAULT': datetime.timedelta(seconds=43200), 'TRAP_BAD_REQUEST_ERRORS': None, 'TRAP_HTTP_EXCEPTIONS': False, 'EXPLAIN_TEMPLATE_LOADING': False, 'PREFERRED_URL_SCHEME': 'http', 'JSON_AS_ASCII': True, 'JSON_SORT_KEYS': True, 'JSONIFY_PRETTYPRINT_REGULAR': False, 'JSONIFY_MIMETYPE': 'application/json', 'TEMPLATES_AUTO_RELOAD': None, 'MAX_COOKIE_SIZE': 4093, 'WHAT': 'DevelopmentConfig'}>
```
then the DEBUG envvar is set correctly

### Expected Behavior
<!-- Tell us what should happen. -->

I expected that the `DEBUG = True` attribute in the `DevelopmentConfig` class sets `FLASK_DEBUG` to `True`. This is considering that cli commands have an application context pushed (see https://flask.palletsprojects.com/en/1.1.x/cli/#application-context) and as per the DEBUG envvar documentation (https://flask.palletsprojects.com/en/1.1.x/config/#DEBUG)


### Actual Behavior

The DEBUG variable is not set.

### Environment

Python 3.8.0
Flask 1.1.2
Werkzeug 1.0.1


Adding examples for the usage of Blueprints as templates & subdomains. #3675
Link to any relevant issues or pull requests.

Remove docstrings with tests which contain no information except for what is already in the name of the test.
This change adds repl.it to the list of deployment hosting options. @replit ([https://repl.it/](https://repl.it/)) supports hosting Flask servers and allows you to make changes in a web browser.

Commit checklist:
**(none of these seem to be relevant to my commit, but if I missed anything please let me know! 😄)**
- [x] ~add tests that fail without the patch~
- [x] ~ensure all tests pass with ``pytest``~
- [x] ~add documentation to the relevant docstrings or pages~
- [x] ~add ``versionadded`` or ``versionchanged`` directives to relevant docstrings~
- [x] ~add a changelog entry if this patch changes code~
Hi,

Minor tweak to the Debug Mode section of the documentation to include the command for Windows Powershell when changing environment to development:

$env:FLASK_ENV = "development"

Thanks
Steve
![Debugmode_screenshot](https://user-images.githubusercontent.com/64620034/88460738-4833ec00-ce96-11ea-9ca6-f7398decb857.PNG)

I use @login_required to check whether the user is authorized.But i save the cookie before i logout and then reassigned it in my browser.I can still be authorized.

I found that the content of the cookie is a password,which will contain "_id" and function "_session_protection_failed" in login_manager.py use "_id"  to check whether the user is authroized.I also found function verify_signature in singer.py use cookie and key to verify signature.

So in order to solve this problem.I change the key by use app.config["SECRET_KEY"] when logout.This method has no problem for my business at present.But i don't think it's a good idea.

Is that a question？and do i have any other good ways?


`g` has been stored on `AppContext` since AppContext's introduction in 0.9. We still have a property `g` attached on `RequestContext`. Is there any reason to keep it? Why not switch to `current_app.g`, or just the global `g`?

https://github.com/laggardkernel/flask/commit/a10005bb0d7668d81c64c02051366035ee421367

### Environment

* Python version: 3.8.7
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

I added multi-line imports because it is more pythonic and clean when you want to find some dependency.

Hi the Flask maintainers,

I added docs on deploying Flask on Qovery. We already have more than 100 developers deploying their Flask app on Qovery. - feedback is welcome.

Romaric.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Set `app.jinja_env.policies["json.dumps_function"]` to have Jinja's `|tojson` filter use Flask's `dumps` function, instead of overriding the filter.

Also have `htmlsafe_dumps` use `jinja2.utils.htmlsafe_json_dumps`. I debated deprecating Flask's implementation, especially since it's not documented as part of the public API. Figured it was still good enough to keep in for now, given that it's not entirely obvious that you would have to pass `dumps=flask.json.dumps` in order to get Flask's behavior.

closes #3881
* Werkzeug's `BaseRequest`, `BaseResponse`, and `JSONMixin` are no longer used. Everything was rolled into `Request` and `Response`.
* Werkzeug's `send_file` renamed `add_etags` to `etag`.
* No longer need the workarounds for Werkzeug versions that didn't support `BadRequestKeyError.show_exception` and `InternalServerError.original_exception`.
* Click detects that the program was called with `python -m flask`, Flask doesn't need its own detection.

Bumps [pre-commit](https://github.com/pre-commit/pre-commit) from 2.9.3 to 2.10.0.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/releases">pre-commit's releases</a>.</em></p>
<blockquote>
<h2>pre-commit v2.10.0</h2>
<h3>Features</h3>
<ul>
<li>Allow <code>ci</code> as a top-level map for configuration for <a href="https://pre-commit.ci">https://pre-commit.ci</a>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1735">#1735</a> PR by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
</ul>
</li>
<li>Add warning for mutable <code>rev</code> in configuration
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1715">#1715</a> PR by <a href="https://github.com/paulhfischer"><code>@paulhfischer</code></a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/974">#974</a> issue by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
</ul>
</li>
<li>Add warning for <code>/*</code> in top-level <code>files</code> / <code>exclude</code> regexes
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1750">#1750</a> PR by <a href="https://github.com/paulhfischer"><code>@paulhfischer</code></a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1702">#1702</a> issue by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
</ul>
</li>
<li>Expose <code>PRE_COMMIT_REMOTE_BRANCH</code> environment variable during <code>pre-push</code> hooks
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1770">#1770</a> PR by <a href="https://github.com/surafelabebe"><code>@surafelabebe</code></a>.</li>
</ul>
</li>
<li>Produce error message for <code>language</code> / <code>language_version</code> for non-installable languages
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1771">#1771</a> PR by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
</ul>
</li>
</ul>
<h3>Fixes</h3>
<ul>
<li>Fix execution in worktrees in subdirectories of bare repositories
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1778">#1778</a> PR by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1777">#1777</a> issue by <a href="https://github.com/s0undt3ch"><code>@s0undt3ch</code></a>.</li>
</ul>
</li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/blob/master/CHANGELOG.md">pre-commit's changelog</a>.</em></p>
<blockquote>
<h1>2.10.0 - 2021-01-27</h1>
<h3>Features</h3>
<ul>
<li>Allow <code>ci</code> as a top-level map for configuration for <a href="https://pre-commit.ci">https://pre-commit.ci</a>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1735">#1735</a> PR by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
</ul>
</li>
<li>Add warning for mutable <code>rev</code> in configuration
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1715">#1715</a> PR by <a href="https://github.com/paulhfischer"><code>@paulhfischer</code></a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/974">#974</a> issue by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
</ul>
</li>
<li>Add warning for <code>/*</code> in top-level <code>files</code> / <code>exclude</code> regexes
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1750">#1750</a> PR by <a href="https://github.com/paulhfischer"><code>@paulhfischer</code></a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1702">#1702</a> issue by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
</ul>
</li>
<li>Expose <code>PRE_COMMIT_REMOTE_BRANCH</code> environment variable during <code>pre-push</code>
hooks
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1770">#1770</a> PR by <a href="https://github.com/surafelabebe"><code>@surafelabebe</code></a>.</li>
</ul>
</li>
<li>Produce error message for <code>language</code> / <code>language_version</code> for non-installable
languages
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1771">#1771</a> PR by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
</ul>
</li>
</ul>
<h3>Fixes</h3>
<ul>
<li>Fix execution in worktrees in subdirectories of bare repositories
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1778">#1778</a> PR by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1777">#1777</a> issue by <a href="https://github.com/s0undt3ch"><code>@s0undt3ch</code></a>.</li>
</ul>
</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pre-commit/pre-commit/commit/c67ba85311be53f4f0f830be22bc153524e07d03"><code>c67ba85</code></a> v2.10.0</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/588b6ed3fcb7e27dcc6c5cb40cdbe3c2e1315a7b"><code>588b6ed</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1778">#1778</a> from pre-commit/bare_worktree</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/f75fc6b2a85a61e50a0270d24a3589a083f1c06c"><code>f75fc6b</code></a> fix execution in worktrees in subdirectories of bare repositories</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/7727f8777aeedafb567da063fc911414b46a6a3b"><code>7727f87</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1773">#1773</a> from pre-commit/pre-commit-ci-update-config</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/d258650ad4a6b0c9845c82e8c74170df337ade41"><code>d258650</code></a> use comparison with sys.platform so mypy understands it</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/74183d91cbd24cac5dfd27dc0f737d40d665e0a8"><code>74183d9</code></a> [pre-commit.ci] pre-commit autoupdate</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/dbd69af90daba11e719e501c4d17ed710c13110d"><code>dbd69af</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1772">#1772</a> from pre-commit/caplog_moar</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/da369be096eba5d48ef5b1d2102872372cae0331"><code>da369be</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1771">#1771</a> from pre-commit/no_install_language_options</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/c7cbb1e6ad9fbb43d3124b20806322df9f3f59ff"><code>c7cbb1e</code></a> replace fake_log_handler with caplog</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/4f39946ea39007d357aa050126e8f877869ff719"><code>4f39946</code></a> produce a more useful error message when non-installable things use language_...</li>
<li>Additional commits viewable in <a href="https://github.com/pre-commit/pre-commit/compare/v2.9.3...v2.10.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pre-commit&package-manager=pip&previous-version=2.9.3&new-version=2.10.0)](https://dependabot.com/compatibility-score/?dependency-name=pre-commit&package-manager=pip&previous-version=2.9.3&new-version=2.10.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [greenlet](https://github.com/python-greenlet/greenlet) from 0.4.17 to 1.0.0.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/python-greenlet/greenlet/blob/master/CHANGES.rst">greenlet's changelog</a>.</em></p>
<blockquote>
<h1>1.0.0 (2021-01-13)</h1>
<ul>
<li>Fix %s and %r formatting of a greenlet on Python 2. Previously it would result in a Unicode string instead of a native string. See <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/218">issue 218</a>.</li>
<li>Move continuous integration from Travis CI to Github Actions.</li>
</ul>
<h1>1.0a1 (2020-11-20)</h1>
<ul>
<li>Add the ability to set a greenlet's PEP 567 contextvars context directly, by assigning to the greenlet's <code>gr_context</code> attribute. This restores support for some patterns of using greenlets atop an async environment that became more challenging in 0.4.17. Thanks to Joshua Oreman, Mike bayer, and Fantix King, among others. See <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/pull/198/">PR 198</a>.</li>
<li>The repr of greenlet objects now includes extra information about its state. This is purely informative and the details are subject to change. See <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/215">issue 215</a>.</li>
<li>The <code>greenlet</code> module is now a package. There are no API changes, so all existing imports, including from C code, should continue to work.</li>
<li>(C API) The undocumented <code>GREENLET_VERSION</code> macro that defined a string giving the greenlet version is now deprecated and will not be updated.</li>
<li>(Documentation) Publish the change log to <a href="https://greenlet.readthedocs.io">https://greenlet.readthedocs.io</a></li>
</ul>
<h2>Supported Platforms</h2>
<ul>
<li>Drop support for Python 2.4, 2.5, 2.6, 3.0, 3.1, 3.2 and 3.4. The project metadata now includes the <code>python_requires</code> data to help installation tools understand supported versions.</li>
<li>Add partial support for AIX ppc64 and IBM i. Thanks to Jesse Gorzinski and Kevin Adler. See <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/pull/197">PR 197</a>.</li>
</ul>
<h2>Packaging Changes</h2>
<ul>
<li>Require setuptools to build from source.</li>
<li>Stop asking setuptools to build both .tar.gz and .zip sdists. PyPI has standardized on .tar.gz for all platforms.</li>
<li>Stop using a custom distutils command to build extensions. distutils is deprecated.</li>
<li>Remove the ability to use the deprecated command <code>python setup.py test</code>. Run greenlet tests with your favorite unittest-compatible test runner, e.g., <code>python -m unittest discover greenlet.tests</code>. See <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/185">issue 185</a>.</li>
<li>The directory layout and resulting sdists have changed. See <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/184">issue 184</a>.</li>
<li>greenlet is now always built with support for tracing and garbage collection, and, on Python 3.7 and above, support for context variables. The internal and undocumented C preprocessor macros that could be used to alter that at compile time have been removed (no combination other than the defaults was ever tested). This helps define a stable ABI.</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/python-greenlet/greenlet/commit/c0e16261293cb401b643290adbb2d824c7200388"><code>c0e1626</code></a> Preparing release 1.0.0</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/951b2076acc757e93c16dbfd465292485b8f116d"><code>951b207</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/228">#228</a> from python-greenlet/github-actions</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/fa764abe680a0a0aee138a75dabfa4e147cc9ce2"><code>fa764ab</code></a> Move to GitHub actions and away from Travis.</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/28802e8e40e5b9aa3b29d5a4c2611d7bb5e0a6e3"><code>28802e8</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/226">#226</a> from guillaumep/patch-1</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/00dc6ebdaa8833d447590ea3b8717fbb4853ce15"><code>00dc6eb</code></a> Fix typo</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/cdd06239a69cd785c4f62c399689056ff806efaf"><code>cdd0623</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/221">#221</a> from skoslowski/patch-1</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/58a990acc27edbc972daa00c1a01d000b1acd7e1"><code>58a990a</code></a> Correct Context Vars PEP citation</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/f005b37e7ac32c617d279e4a692bba768d4ab358"><code>f005b37</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/219">#219</a> from python-greenlet/issue218</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/9ed87d556f2a67c66027dfcf2acde2c690c20e62"><code>9ed87d5</code></a> Use PyString_FromString in tp_repr on Py2.</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/d4bd91852f7062aa0bb92b58b37d4173712f4226"><code>d4bd918</code></a> Tweak CHANGES.rst [skip ci]</li>
<li>Additional commits viewable in <a href="https://github.com/python-greenlet/greenlet/compare/0.4.17...1.0.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=greenlet&package-manager=pip&previous-version=0.4.17&new-version=1.0.0)](https://dependabot.com/compatibility-score/?dependency-name=greenlet&package-manager=pip&previous-version=0.4.17&new-version=1.0.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [sphinx-tabs](https://github.com/executablebooks/sphinx-tabs) from 1.3.0 to 2.0.0.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/executablebooks/sphinx-tabs/releases">sphinx-tabs's releases</a>.</em></p>
<blockquote>
<h2>Version 2.0.0</h2>
<p>See <a href="https://github.com/executablebooks/sphinx-tabs/blob/master/CHANGELOG.md">CHANGELOG.md</a>.</p>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/executablebooks/sphinx-tabs/blob/master/CHANGELOG.md">sphinx-tabs's changelog</a>.</em></p>
<blockquote>
<h2>2.0.0 - 2021-01-24</h2>
<p>♻️ Refactor to reduce JS/CSS payload size and improve accesibility:</p>
<ul>
<li>Removed semantic-ui assets</li>
<li>Removed unused 'sphinx_tabs_nowarn' sphinx option</li>
<li>JS/CSS assets are now copied across by sphinx when builing, rather than being copied by the extension</li>
<li>Changed tab HTML to use tab roles</li>
<li>Changed tab label colour, to increase contrast with background</li>
<li>Added ARIA labels for tabs and panels</li>
<li>Added tabindex atributes to allow users to focus and switch tabs using a keyboard</li>
<li>Added a margin below images inside tab content</li>
</ul>
<p>✨ New features:</p>
<ul>
<li>Selecting an open tab now closes the tabs panel</li>
<li>The last selected group tab persists between pages (if the browser supports session storage)</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/0ce888aec473316fd8068f4940094a6ead63ab4b"><code>0ce888a</code></a> 🚀 RELEASE: v2.0.0 (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/98">#98</a>)</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/a0af17d2e9061008ce12f9c8857a5fbe71662adf"><code>a0af17d</code></a> ♻️ REFACTOR: Reduce JS/CSS size and improve accessibility (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/94">#94</a>)</li>
<li>See full diff in <a href="https://github.com/executablebooks/sphinx-tabs/compare/v1.3.0...v2.0.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=sphinx-tabs&package-manager=pip&previous-version=1.3.0&new-version=2.0.0)](https://dependabot.com/compatibility-score/?dependency-name=sphinx-tabs&package-manager=pip&previous-version=1.3.0&new-version=2.0.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [pytest](https://github.com/pytest-dev/pytest) from 6.2.1 to 6.2.2.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/releases">pytest's releases</a>.</em></p>
<blockquote>
<h2>6.2.2</h2>
<h1>pytest 6.2.2 (2021-01-25)</h1>
<h2>Bug Fixes</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8152">#8152</a>: Fixed &quot;(&lt;Skipped instance&gt;)&quot; being shown as a skip reason in the verbose test summary line when the reason is empty.</li>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8249">#8249</a>: Fix the <code>faulthandler</code> plugin for occasions when running with <code>twisted.logger</code> and using <code>pytest --capture=no</code>.</li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/blob/master/CHANGELOG.rst">pytest's changelog</a>.</em></p>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pytest-dev/pytest/commit/b9c98762f597f624be58d791ea7bdee6cd517967"><code>b9c9876</code></a> Prepare release version 6.2.2</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/8003fd23b910271866d140aa346d144df8c766d4"><code>8003fd2</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8259">#8259</a> from nicoddemus/backport-8250</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/8d605b9b266e412634a654f58a00855402328a89"><code>8d605b9</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8250">#8250</a> from daq-tools/fix-twisted-capture</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/14e0c3e1052b5f5d081d0c8545edfa0222b251a5"><code>14e0c3e</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8225">#8225</a> from The-Compiler/training-update (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8226">#8226</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/45facc16c8d2b11eaa068c8e3e826ff99dc1cfac"><code>45facc1</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8224">#8224</a> from nicoddemus/backport-8220</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/99fe887d7c3c697fdc2a0cef8262b33ba3b35499"><code>99fe887</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8220">#8220</a> from xuhdev/module-doc</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/8dbf9dc1aaa43e1e103a4d005c7fd9cf41212e6e"><code>8dbf9dc</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8167">#8167</a> from nicoddemus/backport-8166</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/baaee2148dcecf8dc5f80c82e28c200b5c19298c"><code>baaee21</code></a> Add Changelog to setup.cfg (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8166">#8166</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/f7d1ab870ffaeffbae457ba85034d9b101e8762f"><code>f7d1ab8</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8163">#8163</a> from bluetech/backport-8152</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/b8201c280e953eda793c5464e41c3622fbbe0379"><code>b8201c2</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8152">#8152</a> from bluetech/empty-skip</li>
<li>Additional commits viewable in <a href="https://github.com/pytest-dev/pytest/compare/6.2.1...6.2.2">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pytest&package-manager=pip&previous-version=6.2.1&new-version=6.2.2)](https://dependabot.com/compatibility-score/?dependency-name=pytest&package-manager=pip&previous-version=6.2.1&new-version=6.2.2)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [sphinx](https://github.com/sphinx-doc/sphinx) from 3.4.1 to 3.4.3.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/sphinx-doc/sphinx/blob/3.x/CHANGES">sphinx's changelog</a>.</em></p>
<blockquote>
<h1>Release 3.4.3 (released Jan 08, 2021)</h1>
<h2>Bugs fixed</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8655">#8655</a>: autodoc: Failed to generate document if target module contains an
object that raises an exception on <code>hasattr()</code></li>
</ul>
<h1>Release 3.4.2 (released Jan 04, 2021)</h1>
<h2>Bugs fixed</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8164">#8164</a>: autodoc: Classes that inherit mocked class are not documented</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8602">#8602</a>: autodoc: The <code>autodoc-process-docstring</code> event is emitted to the
non-datadescriptors unexpectedly</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8616">#8616</a>: autodoc: AttributeError is raised on non-class object is passed to
autoclass directive</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/55cdadf973b89b3181407c478075ac0fc6984b3d"><code>55cdadf</code></a> Bump to 3.4.3 final</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/ac12d8dabe925cf96c1b9e696f9fa0e42999edac"><code>ac12d8d</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8656">#8656</a> from tk0miya/8655_exception_on_hasattr</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/a51c8a565280529e25d1cad879349d7addc1414d"><code>a51c8a5</code></a> Fix <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8655">#8655</a>: autodoc: Crashes when object raises an exception on hasattr()</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/4755557a7df0a335b62c3f6bc062ce1c01c2d45a"><code>4755557</code></a> Bump version</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/83d5a323ef113294bb1c6e93f7752451668ed886"><code>83d5a32</code></a> Bump to 3.4.2 final</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/b59a48d4139801f46272530ca30fe321b1073564"><code>b59a48d</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8650">#8650</a> from tk0miya/update_release_checklist</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/b3f8bd1e3cff91753fa524ee8058b32608e33335"><code>b3f8bd1</code></a> doc: Quote URLs in release checklist</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/1346ddf3175c1a8e84db1be0d262a490f3b16df1"><code>1346ddf</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8635">#8635</a> from tk0miya/update_copyright</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/f9968594206e538f13fa1c27c065027f10d4ea27"><code>f996859</code></a> A happy new year!</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/5383846ced558d592795a162182cb37310ae9577"><code>5383846</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8622">#8622</a> from tk0miya/8616_AttributeError_for_non_class</li>
<li>Additional commits viewable in <a href="https://github.com/sphinx-doc/sphinx/compare/v3.4.1...v3.4.3">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=sphinx&package-manager=pip&previous-version=3.4.1&new-version=3.4.3)](https://dependabot.com/compatibility-score/?dependency-name=sphinx&package-manager=pip&previous-version=3.4.1&new-version=3.4.3)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [packaging](https://github.com/pypa/packaging) from 20.8 to 20.9.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pypa/packaging/releases">packaging's releases</a>.</em></p>
<blockquote>
<h2>Release 20.9</h2>
<ul>
<li>Run <a href="https://pypi.org/project/isort/">isort</a> over the code base (:issue:<code>377</code>)</li>
<li>Add support for the macosx_10_*_universal2 platform tags (:issue:<code>379</code>)</li>
<li>Introduce packaging.utils.parse_wheel_filename() and parse_sdist_filename() (:issue:<code>387</code> and :issue:<code>389</code>)</li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pypa/packaging/blob/main/CHANGELOG.rst">packaging's changelog</a>.</em></p>
<blockquote>
<h1>20.9 - 2021-01-29</h1>
<ul>
<li>Run <a href="https://pypi.org/project/isort/">isort</a> over the code base (377)</li>
<li>Add support for the <code>macosx_10_*_universal2</code> platform tags (379)</li>
<li>Introduce <code>packaging.utils.parse_wheel_filename()</code> and <code>parse_sdist_filename()</code> (387 and 389)</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pypa/packaging/commit/53fd698b1620aca027324001bf53c8ffda0c17d1"><code>53fd698</code></a> Bump for release</li>
<li><a href="https://github.com/pypa/packaging/commit/faf1be88a75b15c299bafb91abdc0aaab762c6f6"><code>faf1be8</code></a> Release from 'main', not 'master' (<a href="https://github-redirect.dependabot.com/pypa/packaging/issues/391">#391</a>)</li>
<li><a href="https://github.com/pypa/packaging/commit/9120541acf0c03d448308daa9f8d0e55e996f92d"><code>9120541</code></a> Change the return type for the build number portion of utils.parse_wheel_file...</li>
<li><a href="https://github.com/pypa/packaging/commit/da68002685b0a7d0027e189129d6bde35303a58b"><code>da68002</code></a> Add functions for parsing wheel and sdist filenames (<a href="https://github-redirect.dependabot.com/pypa/packaging/issues/387">#387</a>)</li>
<li><a href="https://github.com/pypa/packaging/commit/1b26f8455d8c886cbfd37839eafab3373d1809f2"><code>1b26f84</code></a> Support &quot;macosx_10_9_universal2&quot; wheels (<a href="https://github-redirect.dependabot.com/pypa/packaging/issues/380">#380</a>)</li>
<li><a href="https://github.com/pypa/packaging/commit/28d2fa0742747cda4bc4530b2a5bc919b7382039"><code>28d2fa0</code></a> Use isort (<a href="https://github-redirect.dependabot.com/pypa/packaging/issues/377">#377</a>)</li>
<li><a href="https://github.com/pypa/packaging/commit/353f270a4e49283c8e98ed8c801b457665774525"><code>353f270</code></a> Bump for development</li>
<li>See full diff in <a href="https://github.com/pypa/packaging/compare/20.8...20.9">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=packaging&package-manager=pip&previous-version=20.8&new-version=20.9)](https://dependabot.com/compatibility-score/?dependency-name=packaging&package-manager=pip&previous-version=20.8&new-version=20.9)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [jinja2](https://github.com/pallets/jinja) from 2.11.2 to 2.11.3.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pallets/jinja/releases">jinja2's releases</a>.</em></p>
<blockquote>
<h2>2.11.3</h2>
<p>This contains a fix for a speed issue with the <code>urlize</code> filter. <code>urlize</code> is likely to be called on untrusted user input. For certain inputs some of the regular expressions used to parse the text could take a very long time due to backtracking. As part of the fix, the email matching became slightly stricter. The various speedups apply to <code>urlize</code> in general, not just the specific input cases.</p>
<ul>
<li>PyPI: <a href="https://pypi.org/project/Jinja2/2.11.3/">https://pypi.org/project/Jinja2/2.11.3/</a></li>
<li>Changes: <a href="https://jinja.palletsprojects.com/en/2.11.x/changelog/#version-2-11-3">https://jinja.palletsprojects.com/en/2.11.x/changelog/#version-2-11-3</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pallets/jinja/blob/master/CHANGES.rst">jinja2's changelog</a>.</em></p>
<blockquote>
<h1>Version 2.11.3</h1>
<p>Released 2021-01-31</p>
<ul>
<li>Improve the speed of the <code>urlize</code> filter by reducing regex backtracking. Email matching requires a word character at the start of the domain part, and only word characters in the TLD. 1343</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pallets/jinja/commit/cf215390d4a4d6f0a4de27e2687eed176878f13d"><code>cf21539</code></a> release version 2.11.3</li>
<li><a href="https://github.com/pallets/jinja/commit/15ef8f09b659f9100610583938005a7a10472d4d"><code>15ef8f0</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pallets/jinja/issues/1343">#1343</a> from pallets/urlize-speedup</li>
<li><a href="https://github.com/pallets/jinja/commit/ef658dc3b6389b091d608e710a810ce8b87995b3"><code>ef658dc</code></a> speed up urlize matching</li>
<li><a href="https://github.com/pallets/jinja/commit/eeca0fecc3318d43f61bc340ad61db641b861ade"><code>eeca0fe</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pallets/jinja/issues/1207">#1207</a> from mhansen/patch-1</li>
<li><a href="https://github.com/pallets/jinja/commit/2dd769111cbb1a2637f805b3b4c652ec8096d371"><code>2dd7691</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pallets/jinja/issues/1209">#1209</a> from mhansen/patch-3</li>
<li><a href="https://github.com/pallets/jinja/commit/48929401db7228db04dfd8e88115dd5c30dc2d86"><code>4892940</code></a> do_dictsort: update example ready to copy/paste</li>
<li><a href="https://github.com/pallets/jinja/commit/7db7d336ba12574e6205fdd929386fd529e3fad4"><code>7db7d33</code></a> api.rst: bugfix in docs, import PackageLoader</li>
<li><a href="https://github.com/pallets/jinja/commit/9ec465baefe32e305bd4e61da49e6c39360c194e"><code>9ec465b</code></a> fix changelog header</li>
<li>See full diff in <a href="https://github.com/pallets/jinja/compare/2.11.2...2.11.3">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=jinja2&package-manager=pip&previous-version=2.11.2&new-version=2.11.3)](https://dependabot.com/compatibility-score/?dependency-name=jinja2&package-manager=pip&previous-version=2.11.2&new-version=2.11.3)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [tox](https://github.com/tox-dev/tox) from 3.20.1 to 3.21.3.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/tox-dev/tox/blob/master/docs/changelog.rst">tox's changelog</a>.</em></p>
<blockquote>
<h1>v3.21.3 (2021-01-28)</h1>
<h2>Bugfixes</h2>
<ul>
<li>Fix a killed tox (via SIGTERM) leaving the commands subprocesses running by handling it as if it were a KeyboardInterrupt - by dajose <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1772">#1772</a></li>
</ul>
<h1>v3.21.2 (2021-01-19)</h1>
<h2>Bugfixes</h2>
<ul>
<li>Newer coverage tools update the <code>COV_CORE_CONTEXT</code> environment variable, add it to the list of environment variables that can change in our pytest plugin - by gaborbernat. <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1854">#1854</a></li>
</ul>
<h1>v3.21.1 (2021-01-13)</h1>
<h2>Bugfixes</h2>
<ul>
<li>Fix regression that broke using install_command in config replacements - by jayvdb <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1777">#1777</a></li>
<li>Fix regression parsing posargs default containing colon. - by jayvdb <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1785">#1785</a></li>
</ul>
<h2>Features</h2>
<ul>
<li>Prevent .tox in envlist - by jayvdb <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1684">#1684</a></li>
</ul>
<h2>Miscellaneous</h2>
<ul>
<li>Enable building tox with <code>setuptools_scm</code> 4 and 5 by hroncok <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1799">#1799</a></li>
</ul>
<h1>v3.21.0 (2021-01-08)</h1>
<h2>Bugfixes</h2>
<ul>
<li>Fix the false <code>congratulations</code> message that appears when a <code>KeyboardInterrupt</code> occurs during package installation. - by gnikonorov <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1453">#1453</a></li>
<li>Fix <code>platform</code> support for <code>install_command</code>. - by jayvdb <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1464">#1464</a></li>
<li>Fixed regression in v3.20.0 that caused escaped curly braces in setenv to break usage of the variable elsewhere in tox.ini. - by jayvdb <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1690">#1690</a></li>
<li>Prevent <code>{}</code> and require <code>{:</code> is only followed by <code>}</code>. - by jayvdb <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1711">#1711</a></li>
<li>Raise <code>MissingSubstitution</code> on access of broken ini setting. - by jayvdb <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1716">#1716</a></li>
</ul>
<h2>Features</h2>
<!-- raw HTML omitted -->
</blockquote>
<p>... (truncated)</p>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/tox-dev/tox/commit/7dbed25b63a0892bbc9e743f96d118ab237d6d82"><code>7dbed25</code></a> release 3.21.3</li>
<li><a href="https://github.com/tox-dev/tox/commit/15533dd6b1b521174e7d210d1f03b2ec68508502"><code>15533dd</code></a> [pre-commit.ci] pre-commit autoupdate (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1872">#1872</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/8a2bb5642b2442ba4fbe97b7cf36550e38f47ada"><code>8a2bb56</code></a> Format markdown</li>
<li><a href="https://github.com/tox-dev/tox/commit/67258074ee5414a276a3b6c17613cb4ffba2b216"><code>6725807</code></a> tox use discord</li>
<li><a href="https://github.com/tox-dev/tox/commit/833b33f84c02ee7e142d4fad5fc00f1120a3c1e2"><code>833b33f</code></a> Handle sigterm by killing the commands subprocess (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1860">#1860</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/3d80588df8ba2e3a382b4345d2bf6cea44d3f901"><code>3d80588</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1858">#1858</a> from tox-dev/release-3.21.2</li>
<li><a href="https://github.com/tox-dev/tox/commit/4116e90d41e6f4ad024eff7d7a47c3e0442ddabe"><code>4116e90</code></a> release 3.21.2</li>
<li><a href="https://github.com/tox-dev/tox/commit/1d23293485930e28ef1f5e73c4512ebf8de5dc0d"><code>1d23293</code></a> Newer coverage plugin updates env-vars, ignore in pytest plugin (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1854">#1854</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/6624a8ce0b3aa8ebe96e4646314f2e8214bce522"><code>6624a8c</code></a> Add missing backticks to my username (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1851">#1851</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/51cd5fd618cfdc472171a5bfbe68222dbba9e697"><code>51cd5fd</code></a> Update README.md</li>
<li>Additional commits viewable in <a href="https://github.com/tox-dev/tox/compare/3.20.1...3.21.3">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=tox&package-manager=pip&previous-version=3.20.1&new-version=3.21.3)](https://dependabot.com/compatibility-score/?dependency-name=tox&package-manager=pip&previous-version=3.20.1&new-version=3.21.3)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>


run.py:
```
from flask import Flask
app = Flask(__name__, static_url_path='')
app.config['DEBUG'] = True
# Change this line as save, to reload
app.run()
```

**Run in app.py in Visual Studio Code debugger**

### Actual Behavior

<img width="638" alt="Screenshot 2021-01-31 at 14 10 40" src="https://user-images.githubusercontent.com/5372632/106384997-3cd5f600-63ce-11eb-9343-c98202073d55.png">


### Environment

* Python version: 3.8
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

`got_request_exception` documentation did not explain that the signal is only sent for unhandled exceptions, not `HTTPException` or other handled exceptions.

closes #3851

### Description

Hello fellow Flask(ers)! I'm not sure if this kind of issue belongs here, but please point me to the right place to post this if this is not the place to do so. I noticed a discrepancy between Blueprint routing source code and the [Flask pallets documentation](https://flask.palletsprojects.com/en/1.1.x/tutorial/views/) on it. If you follow this link, you'll see that the recommended way of setting up Blueprint and routing is as such:

```python
@bp.route('/register', methods=('GET', 'POST'))
def register():
    if request.method == 'POST':
    .....
```

However, if you actually do write your RESTful methods in a tuple as shown in the example, you'll encounter this error:

```python
TypeError: Allowed methods have to be iterables of strings, for example: @app.route(..., methods=["POST"])
```

I've gone through the [views.py source code](https://github.com/pallets/flask/blob/4e8b0204942d89c7956f4e1a20e97b1a16ba6800/src/flask/views.py) and see that there is an iteration through user inputted `methods`, which makes me wonder why this error occurs?

Much thanks for taking a look at this!

### Environment

* Python version: 3.9.0
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

### Expected Behavior
The `tojson` filter from Jinja2 will be used.

```jinja2
{{ some_object | tojson }}
```

### Actual Behavior
The Flask `tojson` filter overwrites the Jinja2 `tojson` filter. The Flask's filter is not as configurable as the Jinja2 one and when one configures the Jinja2 one and tries to use it in a template this behavior and silent override is hard to debug.

### Environment

* Python version: 3.9.1
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

### Suggested changes
Add a configuration option to choose between overriding the Jinja2 `tojson` filter or not. Make the default to override to keep current behavior. Will make a PR for this if it seems reasonable.

This is a documentation fix. 

There is no `jsonify_error` method in the codebase. The usage here is unclear. Not sure if it is legacy, the user should implement it themselves, it should be imported from another lib, or just a mistype. 

I figured the best fix was to use `jsonify`. This will return a `200` unless otherwise specified, so I also included the error code.

Hope this is helpful.

Hi,
                     i am creating the new routes by having  new entry in the backend table.  here new routes are assigned to blueprint .
the new routes are not reflecting instantly it requires restart the app to get the new blueprint route .

ping me the possibilities based on the requirements.


Thanks 


### Expected Behavior
In the Flask Testing docs: https://flask.palletsprojects.com/en/1.1.x/testing/#faking-resources-and-context

There is an example illustrating how to utilise the @contextmanager to set g early that appears to be misleading. The appcontext_pushed hook isn't correctly invoked following the example given.

In the usage section that uses the test_client, it appears app.app_context() gets the desired results.

Here is how I got it to work:

```python
@contextmanager
def user_set(state, _user):
    def handler(sender, **kwargs):
        g.user = _user

    with appcontext_pushed.connected_to(handler, state):
        yield

# yours is def user_set
with user_set(self.application, user):
    # use app_context() instead of test_client() context manager
    with app.app_context():
        client = app.test_client()
        # then make your request
        ...
```

### Environment

* Python version: 36
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

I have some obsessive-compulsive disorder😁,  I tried to add some comment ending characters.


I have some obsessive-compulsive disorder, I tried to add some comment ending characters.

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

## situation overview
I set up a file upload application and in case the user gives a too large file, I want to send a message that the file is too large. On my own PC, everything works fine, but in my corporate environment, flask doesn't return the message I want. 

## Example code
```python
 """app.py"""

from flask import Flask, request
from werkzeug.exceptions import RequestEntityTooLarge

app = Flask(__name__)
app.config['MAX_CONTENT_LENGTH'] = 1 * 1024 * 1024  # 1 MB


@app.route('/upload')
def upload():
    """Gives a form to upload the file."""

    return '''<!doctype html>
<body>Upload files
    <form method="POST" action="/submit_script" enctype="multipart/form-data">
        <input type="file" name="file" id="content" class="form-control-file">
        <input type="submit" value="Submit" class="form-control-file">
    </form>
</body>

</html>'''


@app.route('/submit_script', methods=['POST'])
def submit():
    """Saves the uploaded file and sends confirmation."""
    message = ""
    try:
        uploaded_file = request.files['file']
        uploaded_file.save(uploaded_file.filename)
    except RequestEntityTooLarge as my_exception:
        message = str(my_exception)
        print(message)    # this goes to the cmd line

    return "I could send a template with the result." + message 


@app.errorhandler(413)
def request_entity_too_large(error):
    """What happens if a file is too large."""

    return str(error) + " I could have sent a HTML template too.", 413

```
## Expected Behavior
I expect flask to return "I could send a template with the result." or without werkzeug, to `return str(error) + " I could have sent an HTML template too.", 413` But none of them happens.

## Actual Behavior

My browser gets an ERR_CONNECTION_ABORTED message.

This is what I get on the terminal:

```
(flask) C:\Users\uname\source\repos\flask_non_we>flask run
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
127.0.0.1 - - [21/Jan/2021 23:21:14] "GET / HTTP/1.1" 200 -
127.0.0.1 - - [21/Jan/2021 23:21:16] "GET /upload HTTP/1.1" 200 -
413 Request Entity Too Large: The data value transmitted exceeds the capacity limit.
127.0.0.1 - - [21/Jan/2021 23:21:23] "POST /submit_script HTTP/1.1" 200 -

(flask) C:\Users\uname\source\repos\flask_non_we>
```

### Environment
* Windows 10
* flask is running in cmd
* Python version: 3.8.5
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

Is there a way to redirect url in flask app and mask the url?


```
@app.route("/test")
def handle_ext_url():
    url = "https://www.google.com"
    return redirect(url)
```

I just want my addressbar to show localhost:8080/test but the page should show google.com.
If you have a `.env` file and are using Docker you don't need to install `python-dotenv`.

But every time you run any `flask` CLI command, Flask will output `* Tip: There are .env or .flaskenv files present. Do "pip install python-dotenv" to use them.` to stdout before any other output.

Perhaps this tip could be removed all together? IMO if you're using env files you likely already know to use `python-dotenv` and if you're using Docker you have access to your environment variables through other means.

### Expected Behavior

No tip output to be present.

### Actual Behavior

It produces this:

![image](https://user-images.githubusercontent.com/813219/104642743-51e62180-5679-11eb-8a2c-c82622461c0c.png)

### Environment

* Python version: 3.9.1
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

The current docs are at: https://flask.palletsprojects.com/en/1.1.x/patterns/celery/

They reference Celery's old configuration options which are the `CELERY_*` options. Since 5.x they've been renamed to be lowercase and there's an official migration guide available on Celery's site at https://docs.celeryproject.org/en/stable/userguide/configuration.html#conf-old-settings-map.

As of Celery 5.x, the old uppercase variants throw a deprecation warning and 6.x will remove them.

The current Flask docs for Celery reference things like:

```py
    celery = Celery(
        app.import_name,
        backend=app.config['CELERY_RESULT_BACKEND'],
        broker=app.config['CELERY_BROKER_URL']
    )
```

```py
flask_app.config.update(
    CELERY_BROKER_URL='redis://localhost:6379',
    CELERY_RESULT_BACKEND='redis://localhost:6379'
)
```

These imply you're using Flask's configuration mechanism which require uppercase variable names to be available, but that conflicts with Celery's new lowercase variables.

I talked with @ThiefMaster a few weeks ago about this on IRC and he came up with a great idea of doing:

```py
# settings.py

CELERY_CONFIG = {
  "broker_url": "redis://localhost:6379/0",
  "result_backend": "redis://localhost:6379/0"
}
```

And then in your Celery factory you can do `celery.conf.update(app.config.get("CELERY_CONFIG", {}))`.

This solves the problem and is working out nicely in practice. I'm doing that in a real project, along with extracting out the duplicate Redis connection string into an environment variable, etc.. A working example of that pattern is at https://github.com/nickjj/docker-flask-example/blob/ca1d48499a4007378bbe363bd5dc117c1a33cc3a/config/settings.py#L21-L28.

I didn't want to open a PR without asking first because I'm not sure which direction you want to go with the docs. To be honest the current docs are a little confusing because you jump straight into using Flask's app configuration values but there's no reference to setting up those config values.

Also with the current docs if you attempt to break things into separate files you'll end up with circular import issues when importing your tasks unless you start importing your tasks directly inside of the function you're using instead of the top of the file, but that's another issue. Although potentially semi-related if you plan to revamp the Celery docs.
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
Leading forward slashes (`/`) in path variable should be preserved when URI encoded

The value returned should be `Hello, World! - /path/to/file`.

```python
from flask import Flask
app = Flask(__name__)

@app.route('/<path:an_absolute_path>')
def hello_world(an_absolute_path):
    return "Hello, World! - %s" % an_absolute_path
```

### Actual Behavior
The value returned is `Hello, World! - path/to/file`.

```bash
> curl http://localhost:5000/%2Fpath%2Fto%2Ffile
Hello, World! - path/to/file
```

### Environment

* Python 3.6.12
* Flask 1.1.2
* Werkzeug 1.0.1
It seems  "Request" object has no attribute "is_xhr" ，Getting warnings here...  How do we fix this?
![6f2ab2c357e4a36213b6ad42b7d9669](https://user-images.githubusercontent.com/70581416/104300976-16751700-5502-11eb-9b61-51f3baa8d083.png)

Update the sample code at `views.rst`, update the methods sample.
I don't know if this change is necessary, I just thought that it will be better to keep the example as simple as possible, and make it OS-compatible (the `env` command not available on Windows CMD or Powershell). The new user will learn the details of how to run the application or how the application discovery works in the documentation.
### Expected Behavior
copy past commands and run it.
tried with:
- [quickstart](https://flask.palletsprojects.com/en/1.1.x/quickstart/) 
- [flask-sqlalchemy-quickstart](https://flask-sqlalchemy.palletsprojects.com/en/2.x/quickstart/)

### Environment
* OS version:
lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 20.04.1 LTS
Release:        20.04
Codename:       focal

* Python version:
$ python --version
Python 2.7.18

* Flask version:
$ flask --version
Python 3.8.5
Flask 1.1.2
Werkzeug 1.0.1

* Werkzeug version:
flask --version
$ flask --version
Python 3.8.5
Flask 1.1.2
Werkzeug 1.0.1
* Werkzeug version:
flask --version
...
Werkzeug 1.0.1

### Hint:
add to documentary: 
- reflect pip3 vs pip usage
- add `pip install -U Flask-SQLAlchemy` 

### explicit example problems:
https://stackoverflow.com/questions/65566823/flask-sqlalchemy-quickstart/65567007?noredirect=1#comment115927729_65567007
I've stumbled upon this bug while trying to bear Cython down with Flask.

Flask namely requires it's endpoint functions to have a `__dict__`, while Cython's def's are created as builtin_methods_or_functions which don't have a `__dict__`.

I've solved the problem in way mentioned [here](https://github.com/flasgger/flasgger/pull/451), but I still think it's a wrong design pattern to demand your endpoints to have a `__dict__`.
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->

```python
# Paste a minimal example that causes the problem.
```

### Actual Behavior
<!-- Tell us what happens instead. -->
[nginx+gunicorn+flask]
shut down accidentally without  an exception.when i check the recv-Q，i found the number is 129.Have you ever encountered this problem?



```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version: 3.7.3
* Flask version:1.1.2
* Werkzeug version:1.0.1

The loads function has the wrong 'kwargs' parameter description.
Fix pytest for #3858.
Bumps [packaging](https://github.com/pypa/packaging) from 20.4 to 20.8.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pypa/packaging/releases">packaging's releases</a>.</em></p>
<blockquote>
<h2>Release 20.8</h2>
<ul>
<li>Revert back to setuptools for compatibility purposes for some Linux distros (:issue:<code>363</code>)</li>
<li>Do not insert an underscore in wheel tags when the interpreter version number
is more than 2 digits (:issue:<code>372</code>)</li>
</ul>
<h2>20.7</h2>
<p>No release notes provided.</p>
<h2>20.6</h2>
<p>No release notes provided.</p>
<h2>20.5</h2>
<p>No release notes provided.</p>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pypa/packaging/blob/master/CHANGELOG.rst">packaging's changelog</a>.</em></p>
<blockquote>
<h1>20.8 - 2020-12-11</h1>
<ul>
<li>Revert back to setuptools for compatibility purposes for some Linux distros (363)</li>
<li>Do not insert an underscore in wheel tags when the interpreter version number is more than 2 digits (372)</li>
</ul>
<h1>20.7 - 2020-11-28</h1>
<p>No unreleased changes.</p>
<h1>20.6 - 2020-11-28</h1>
<!-- raw HTML omitted -->
<p>This release was subsequently yanked, and these changes were included in 20.7.</p>
<!-- raw HTML omitted -->
<ul>
<li>Fix flit configuration, to include LICENSE files (357)</li>
<li>Make intel a recognized CPU architecture for the universal macOS platform tag (361)</li>
<li>Add some missing type hints to packaging.requirements (issue:350)</li>
</ul>
<h1>20.5 - 2020-11-27</h1>
<ul>
<li>Officially support Python 3.9 (343)</li>
<li>Deprecate the <code>LegacyVersion</code> and <code>LegacySpecifier</code> classes (321)</li>
<li>Handle <code>OSError</code> on non-dynamic executables when attempting to resolve the glibc version string.</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pypa/packaging/commit/d93c6eea7d2caa637176426d255895bdf7db4f64"><code>d93c6ee</code></a> Bump for release</li>
<li><a href="https://github.com/pypa/packaging/commit/1534da56169d16a5f6b0ba90f748161c717dca9b"><code>1534da5</code></a> Update noxfile.py for going back to setuptools</li>
<li><a href="https://github.com/pypa/packaging/commit/b299c3ddb38c76e83e09ade2b719a4283a49b1c6"><code>b299c3d</code></a> Add a changelog entry for reverting underscores in wheel tags</li>
<li><a href="https://github.com/pypa/packaging/commit/611982be44d7d91453a97082f58d8ea349f89d00"><code>611982b</code></a> Don't put an underscore in the version portion of Python 3.10 compatibility t...</li>
<li><a href="https://github.com/pypa/packaging/commit/4b9b3f8edaf1feba2bc84ac12172f7d4af47e277"><code>4b9b3f8</code></a> Remove unused test fixture (<a href="https://github-redirect.dependabot.com/pypa/packaging/issues/373">#373</a>)</li>
<li><a href="https://github.com/pypa/packaging/commit/7e47a46880a594f17d1b110d388d22e5ead19fc4"><code>7e47a46</code></a> Fill in some missing changelog entries (<a href="https://github-redirect.dependabot.com/pypa/packaging/issues/370">#370</a>)</li>
<li><a href="https://github.com/pypa/packaging/commit/d1ade532a2bbea33fc0de981ab4d542006cf1066"><code>d1ade53</code></a> Changelog entry for going back to setuptools</li>
<li><a href="https://github.com/pypa/packaging/commit/14ad3520dc866295963c677c6813646b8a59a6a6"><code>14ad352</code></a> move back to setuptools (<a href="https://github-redirect.dependabot.com/pypa/packaging/issues/367">#367</a>)</li>
<li><a href="https://github.com/pypa/packaging/commit/a6407e3a7e19bd979e93f58cfc7f6641a7378c46"><code>a6407e3</code></a> Annotate the public interface (<a href="https://github-redirect.dependabot.com/pypa/packaging/issues/350">#350</a>)</li>
<li><a href="https://github.com/pypa/packaging/commit/fc86d7eeeeb68a224974c30e98d420560c75b0a4"><code>fc86d7e</code></a> Upload to git before uploading to PyPI (<a href="https://github-redirect.dependabot.com/pypa/packaging/issues/359">#359</a>)</li>
<li>Additional commits viewable in <a href="https://github.com/pypa/packaging/compare/20.4...20.8">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=packaging&package-manager=pip&previous-version=20.4&new-version=20.8)](https://dependabot.com/compatibility-score/?dependency-name=packaging&package-manager=pip&previous-version=20.4&new-version=20.8)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [pytest](https://github.com/pytest-dev/pytest) from 6.1.2 to 6.2.1.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/releases">pytest's releases</a>.</em></p>
<blockquote>
<h2>6.2.1</h2>
<h1>pytest 6.2.1 (2020-12-15)</h1>
<h2>Bug Fixes</h2>
<ul>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7678">#7678</a>: Fixed bug where <code>ImportPathMismatchError</code> would be raised for files compiled in
the host and loaded later from an UNC mounted path (Windows).</p>
</li>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8132">#8132</a>: Fixed regression in <code>approx</code>: in 6.2.0 <code>approx</code> no longer raises
<code>TypeError</code> when dealing with non-numeric types, falling back to normal comparison.
Before 6.2.0, array types like tf.DeviceArray fell through to the scalar case,
and happened to compare correctly to a scalar if they had only one element.
After 6.2.0, these types began failing, because they inherited neither from
standard Python number hierarchy nor from <code>numpy.ndarray</code>.</p>
<p><code>approx</code> now converts arguments to <code>numpy.ndarray</code> if they expose the array
protocol and are not scalars. This treats array-like objects like numpy arrays,
regardless of size.</p>
</li>
</ul>
<h2>6.2.0</h2>
<h1>pytest 6.2.0 (2020-12-12)</h1>
<h2>Breaking Changes</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7808">#7808</a>: pytest now supports python3.6+ only.</li>
</ul>
<h2>Deprecations</h2>
<ul>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7469">#7469</a>: Directly constructing/calling the following classes/functions is now deprecated:</p>
<ul>
<li><code>_pytest.cacheprovider.Cache</code></li>
<li><code>_pytest.cacheprovider.Cache.for_config()</code></li>
<li><code>_pytest.cacheprovider.Cache.clear_cache()</code></li>
<li><code>_pytest.cacheprovider.Cache.cache_dir_from_config()</code></li>
<li><code>_pytest.capture.CaptureFixture</code></li>
<li><code>_pytest.fixtures.FixtureRequest</code></li>
<li><code>_pytest.fixtures.SubRequest</code></li>
<li><code>_pytest.logging.LogCaptureFixture</code></li>
<li><code>_pytest.pytester.Pytester</code></li>
<li><code>_pytest.pytester.Testdir</code></li>
<li><code>_pytest.recwarn.WarningsRecorder</code></li>
<li><code>_pytest.recwarn.WarningsChecker</code></li>
<li><code>_pytest.tmpdir.TempPathFactory</code></li>
<li><code>_pytest.tmpdir.TempdirFactory</code></li>
</ul>
<p>These have always been considered private, but now issue a deprecation warning, which may become a hard error in pytest 7.0.0.</p>
</li>
</ul>
<!-- raw HTML omitted -->
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/blob/master/CHANGELOG.rst">pytest's changelog</a>.</em></p>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pytest-dev/pytest/commit/d3971c30f4d0f1890a372af3b98de41ee555dcb3"><code>d3971c3</code></a> Prepare release version 6.2.1</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/780044b64a79eb99eb08d86a08d5cf7fa8b047ba"><code>780044b</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8147">#8147</a> from nicoddemus/backport-8137</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/8354995abc4c4f913a8266fb53b7d2a4e93e4050"><code>8354995</code></a> python_api: handle array-like args in approx() (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8137">#8137</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/8b8b1214f4834419a5f45758d6cdc4eddba01359"><code>8b8b121</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8135">#8135</a> from nicoddemus/backport-8123</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/f854cf66f4ad866d27f85e6fcc3b476a835ca3e7"><code>f854cf6</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8123">#8123</a> from nicoddemus/import-mismatch-unc</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/c475106f12ed87fe908544ff383c5205638c086d"><code>c475106</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8130">#8130</a> from pytest-dev/release-6.2.0</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/e7073afe6e2373175130511135020af8b4e3a670"><code>e7073af</code></a> Prepare release version 6.2.0</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/683f29f84df61e9dab92970a57190d20ca58385e"><code>683f29f</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8129">#8129</a> from bluetech/docs-pygments-workaround</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/0feeddf8edb87052402fafe690d019e3eb75dfa4"><code>0feeddf</code></a> doc: temporary workaround for pytest-pygments lexing error</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/b4782757772373a2ea00802606407e9399b98031"><code>b478275</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8128">#8128</a> from bluetech/skip-reason-empty</li>
<li>Additional commits viewable in <a href="https://github.com/pytest-dev/pytest/compare/6.1.2...6.2.1">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pytest&package-manager=pip&previous-version=6.1.2&new-version=6.2.1)](https://dependabot.com/compatibility-score/?dependency-name=pytest&package-manager=pip&previous-version=6.1.2&new-version=6.2.1)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [pip-tools](https://github.com/jazzband/pip-tools) from 5.3.1 to 5.5.0.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/jazzband/pip-tools/releases">pip-tools's releases</a>.</em></p>
<blockquote>
<h2>5.5.0</h2>
<p>Features:</p>
<ul>
<li>Add Python 3.9 support (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1222">1222</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
<li>Improve formatting of long &quot;via&quot; annotations (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1237">1237</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
<li>Add <code>--verbose</code> and <code>--quiet</code> options to <code>pip-sync</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1241">1241</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
<li>Add <code>--no-allow-unsafe</code> option to <code>pip-compile</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1265">1265</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
</ul>
<p>Bug Fixes:</p>
<ul>
<li>Restore <code>PIP_EXISTS_ACTION</code> environment variable to its previous state when resolve dependencies in <code>pip-compile</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1255">1255</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
</ul>
<p>Dependencies:</p>
<ul>
<li>Remove <code>six</code> dependency in favor <code>pip</code>'s vendored <code>six</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1240">1240</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
</ul>
<p>Improved Documentation:</p>
<ul>
<li>Add <code>pip-requirements.el</code> (for Emacs) to useful tools to <code>README</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1244">#1244</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
<li>Add supported Python versions to <code>README</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1246">#1246</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
</ul>
<h2>5.4.0</h2>
<p>Features:</p>
<ul>
<li>Add <code>pip&gt;=20.3</code> support (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1216">1216</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a> and <a href="https://github.com/AndydeCleyre">@AndydeCleyre</a></li>
<li>Exclude <code>--no-reuse-hashes</code> option from «command to run» header (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1197">1197</a>). Thanks <a href="https://github.com/graingert">@graingert</a></li>
</ul>
<p>Dependencies:</p>
<ul>
<li>Bump <code>pip</code> minimum version to <code>&gt;= 20.1</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1191">1191</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a> and <a href="https://github.com/AndydeCleyre">@AndydeCleyre</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/jazzband/pip-tools/blob/master/CHANGELOG.md">pip-tools's changelog</a>.</em></p>
<blockquote>
<h1>5.5.0 (2020-12-31)</h1>
<p>Features:</p>
<ul>
<li>Add Python 3.9 support
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1222">1222</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
<li>Improve formatting of long &quot;via&quot; annotations
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1237">1237</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
<li>Add <code>--verbose</code> and <code>--quiet</code> options to <code>pip-sync</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1241">1241</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
<li>Add <code>--no-allow-unsafe</code> option to <code>pip-compile</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1265">1265</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
</ul>
<p>Bug Fixes:</p>
<ul>
<li>Restore <code>PIP_EXISTS_ACTION</code> environment variable to its previous state
when resolve dependencies in <code>pip-compile</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1255">1255</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
</ul>
<p>Dependencies:</p>
<ul>
<li>Remove <code>six</code> dependency in favor <code>pip</code>'s vendored <code>six</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1240">1240</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
</ul>
<p>Improved Documentation:</p>
<ul>
<li>Add <code>pip-requirements.el</code> (for Emacs) to useful tools to <code>README</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1244">#1244</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
<li>Add supported Python versions to <code>README</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1246">#1246</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
</ul>
<h1>5.4.0 (2020-11-21)</h1>
<p>Features:</p>
<ul>
<li>Add <code>pip&gt;=20.3</code> support
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1216">1216</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a> and <a href="https://github.com/AndydeCleyre">@AndydeCleyre</a></li>
<li>Exclude <code>--no-reuse-hashes</code> option from «command to run» header
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1197">1197</a>). Thanks <a href="https://github.com/graingert">@graingert</a></li>
</ul>
<p>Dependencies:</p>
<ul>
<li>Bump <code>pip</code> minimum version to <code>&gt;= 20.1</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1191">1191</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a> and <a href="https://github.com/AndydeCleyre">@AndydeCleyre</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/jazzband/pip-tools/commit/25492a23343e1499c73f9c275a6dab4d14b86486"><code>25492a2</code></a> 5.5.0 changelog</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/4ac1490234e753d23cec231bc3f79148b8cac641"><code>4ac1490</code></a> Add --no-allow-unsafe option to compile (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1265">#1265</a>)</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/bc9695c604314e62f6379b50f003dbe0f9878c9d"><code>bc9695c</code></a> Update pre-commit hooks</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/7ab3a565fa9261258f6a37b05ba6b31670bd9d0d"><code>7ab3a56</code></a> Update isort URL in .pre-commit-config.yaml</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/677046626609e888f28b3ec363931edaed4ceea0"><code>6770466</code></a> Add coverage for &quot;if not is_pinned_requirement(…)&quot; in get_hashes()</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/e76ab99d17944963273f31e18b93c5771c12acd8"><code>e76ab99</code></a> Remove unnecessary system calls via os.path.exists()/os.path.isdir()</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/a313398ce21eeabca47ddc67cd19353a3e2116f9"><code>a313398</code></a> Fix typo: unnecessarely → unnecessarily</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/e0b555286e875280f11639d265f6e09893114712"><code>e0b5552</code></a> Remove unnecessary coerce to str</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/30a33cd600d0e96542429683704f3effec945240"><code>30a33cd</code></a> Simplify uses of InstallRequirement</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/d2007dab6b0cd0c33860fcbf14da793fe34705da"><code>d2007da</code></a> Use more descriptive exceptions than AssertionError</li>
<li>Additional commits viewable in <a href="https://github.com/jazzband/pip-tools/compare/5.3.1...5.5.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pip-tools&package-manager=pip&previous-version=5.3.1&new-version=5.5.0)](https://dependabot.com/compatibility-score/?dependency-name=pip-tools&package-manager=pip&previous-version=5.3.1&new-version=5.5.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [pre-commit](https://github.com/pre-commit/pre-commit) from 2.8.2 to 2.9.3.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/releases">pre-commit's releases</a>.</em></p>
<blockquote>
<h2>pre-commit v2.9.3</h2>
<h3>Fixes</h3>
<ul>
<li>Fix crash on cygwin mismatch check outside of a git directory
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1721">#1721</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1720">#1720</a> issue by <a href="https://github.com/chronoB">@chronoB</a>.</li>
</ul>
</li>
<li>Fix cleanup code on docker volumes for go
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1725">#1725</a> PR by <a href="https://github.com/fsouza">@fsouza</a>.</li>
</ul>
</li>
<li>Fix working directory detection on SUBST drives on windows
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1727">#1727</a> PR by <a href="https://github.com/mrogaski">@mrogaski</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1610">#1610</a> issue by <a href="https://github.com/jcameron73">@jcameron73</a>.</li>
</ul>
</li>
</ul>
<h2>pre-commit v2.9.2</h2>
<h3>Fixes</h3>
<ul>
<li>Fix default value for <code>types_or</code> so <code>symlink</code> and <code>directory</code> can be matched
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1716">#1716</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1718">#1718</a> issue by <a href="https://github.com/CodeBleu">@CodeBleu</a>.</li>
</ul>
</li>
</ul>
<h2>pre-commit v2.9.1</h2>
<h3>Fixes</h3>
<ul>
<li>Improve error message for &quot;hook goes missing&quot;
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1709">#1709</a> PR by <a href="https://github.com/paulhfischer">@paulhfischer</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1708">#1708</a> issue by <a href="https://github.com/theod07">@theod07</a>.</li>
</ul>
</li>
<li>Add warning for <code>/*</code> in <code>files</code> / <code>exclude</code> regexes
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1707">#1707</a> PR by <a href="https://github.com/paulhfischer">@paulhfischer</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1702">#1702</a> issue by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Fix <code>healthy()</code> check for <code>language: python</code> on windows when the base executable has non-ascii characters.
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1713">#1713</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1711">#1711</a> issue by <a href="https://github.com/Najiva">@Najiva</a>.</li>
</ul>
</li>
</ul>
<h2>pre-commit v2.9.0</h2>
<h3>Features</h3>
<ul>
<li>Add <code>types_or</code> which allows matching multiple disparate <code>types</code> in a hook
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1677">#1677</a> by <a href="https://github.com/MarcoGorelli">@MarcoGorelli</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/607">#607</a> by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Add Github Sponsors / Open Collective links
<ul>
<li><a href="https://github.com/sponsors/asottile">https://github.com/sponsors/asottile</a></li>
<li><a href="https://opencollective.com/pre-commit">https://opencollective.com/pre-commit</a></li>
</ul>
</li>
</ul>
<h3>Fixes</h3>
<ul>
<li>Improve cleanup for <code>language: dotnet</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1678">#1678</a> by <a href="https://github.com/rkm">@rkm</a>.</li>
</ul>
</li>
<li>Fix &quot;xargs&quot; when running windows batch files
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1686">#1686</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1604">#1604</a> issue by <a href="https://github.com/apietrzak">@apietrzak</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1604">#1604</a> issue by <a href="https://github.com/ufwtlsb">@ufwtlsb</a>.</li>
</ul>
</li>
<li>Fix conflict with external <code>rbenv</code> and <code>language_version: default</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1700">#1700</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1699">#1699</a> issue by <a href="https://github.com/abuxton">@abuxton</a>.</li>
</ul>
</li>
<li>Improve performance of <code>git status</code> / <code>git diff</code> commands by ignoring submodules
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1704">#1704</a> PR by <a href="https://github.com/Vynce">@Vynce</a>.</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/blob/master/CHANGELOG.md">pre-commit's changelog</a>.</em></p>
<blockquote>
<h1>2.9.3 - 2020-12-07</h1>
<h3>Fixes</h3>
<ul>
<li>Fix crash on cygwin mismatch check outside of a git directory
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1721">#1721</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1720">#1720</a> issue by <a href="https://github.com/chronoB">@chronoB</a>.</li>
</ul>
</li>
<li>Fix cleanup code on docker volumes for go
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1725">#1725</a> PR by <a href="https://github.com/fsouza">@fsouza</a>.</li>
</ul>
</li>
<li>Fix working directory detection on SUBST drives on windows
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1727">#1727</a> PR by <a href="https://github.com/mrogaski">@mrogaski</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1610">#1610</a> issue by <a href="https://github.com/jcameron73">@jcameron73</a>.</li>
</ul>
</li>
</ul>
<h1>2.9.2 - 2020-11-25</h1>
<h3>Fixes</h3>
<ul>
<li>Fix default value for <code>types_or</code> so <code>symlink</code> and <code>directory</code> can be matched
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1716">#1716</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1718">#1718</a> issue by <a href="https://github.com/CodeBleu">@CodeBleu</a>.</li>
</ul>
</li>
</ul>
<h1>2.9.1 - 2020-11-25</h1>
<h3>Fixes</h3>
<ul>
<li>Improve error message for &quot;hook goes missing&quot;
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1709">#1709</a> PR by <a href="https://github.com/paulhfischer">@paulhfischer</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1708">#1708</a> issue by <a href="https://github.com/theod07">@theod07</a>.</li>
</ul>
</li>
<li>Add warning for <code>/*</code> in <code>files</code> / <code>exclude</code> regexes
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1707">#1707</a> PR by <a href="https://github.com/paulhfischer">@paulhfischer</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1702">#1702</a> issue by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Fix <code>healthy()</code> check for <code>language: python</code> on windows when the base
executable has non-ascii characters.
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1713">#1713</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1711">#1711</a> issue by <a href="https://github.com/Najiva">@Najiva</a>.</li>
</ul>
</li>
</ul>
<h1>2.9.0 - 2020-11-21</h1>
<h3>Features</h3>
<ul>
<li>Add <code>types_or</code> which allows matching multiple disparate <code>types</code> in a hook
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1677">#1677</a> by <a href="https://github.com/MarcoGorelli">@MarcoGorelli</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/607">#607</a> by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Add Github Sponsors / Open Collective links
<ul>
<li><a href="https://github.com/sponsors/asottile">https://github.com/sponsors/asottile</a></li>
<li><a href="https://opencollective.com/pre-commit">https://opencollective.com/pre-commit</a></li>
</ul>
</li>
</ul>
<h3>Fixes</h3>
<ul>
<li>Improve cleanup for <code>language: dotnet</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1678">#1678</a> by <a href="https://github.com/rkm">@rkm</a>.</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pre-commit/pre-commit/commit/a062cbd439861a8f05b58b9454ba04695de8cda3"><code>a062cbd</code></a> v2.9.3</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/eacf4c886e8afc51d43ef8fc62ee525bc06a38c8"><code>eacf4c8</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1727">#1727</a> from mrogaski/1610_git_toplevel_relpath</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/29d15de38ee0f78f598e8888fd3d6e8789a63bef"><code>29d15de</code></a> git: changed rev-parse option for Git 2.25 changes to --show-toplevel</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/cf604f6b93b8fb7a61ab9ca45e5dedbdb4fd5796"><code>cf604f6</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1725">#1725</a> from fsouza/fix-rmtree</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/c598785b6f7be0fb9371eb54e48fd09668210a96"><code>c598785</code></a> util: use set instead of tuple in errno check</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/bb0d9573a9a87616b65ee4c1cedccb18406d5982"><code>bb0d957</code></a> util: also run chmod on EPERM</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/92ce2dcbc375831bab244507e8072a834b761946"><code>92ce2dc</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1721">#1721</a> from pre-commit/dont_crash_on_cygwin_check</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/8cfe8e590d9568ff8fb9d5deb0c46776ee966162"><code>8cfe8e5</code></a> don't crash on cygwin mismatch check</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/6c6294571afef28e7229520c2beecc41400af60a"><code>6c62945</code></a> Add link to issue by CodeBleu</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/a82a79bf3f2c147fb819f5e14b4883c143568ab6"><code>a82a79b</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1717">#1717</a> from pre-commit/fix_test</li>
<li>Additional commits viewable in <a href="https://github.com/pre-commit/pre-commit/compare/v2.8.2...v2.9.3">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pre-commit&package-manager=pip&previous-version=2.8.2&new-version=2.9.3)](https://dependabot.com/compatibility-score/?dependency-name=pre-commit&package-manager=pip&previous-version=2.8.2&new-version=2.9.3)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [sphinx](https://github.com/sphinx-doc/sphinx) from 3.2.1 to 3.4.1.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/sphinx-doc/sphinx/blob/3.x/CHANGES">sphinx's changelog</a>.</em></p>
<blockquote>
<h1>Release 3.4.1 (released Dec 25, 2020)</h1>
<h2>Bugs fixed</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8559">#8559</a>: autodoc: AttributeError is raised when using forward-reference type
annotations</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8568">#8568</a>: autodoc: TypeError is raised on checking slots attribute</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8567">#8567</a>: autodoc: Instance attributes are incorrectly added to Parent class</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8566">#8566</a>: autodoc: The <code>autodoc-process-docstring</code> event is emitted to the
alias classes unexpectedly</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8583">#8583</a>: autodoc: Unnecessary object comparision via <code>__eq__</code> method</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8565">#8565</a>: linkcheck: Fix PriorityQueue crash when link tuples are not
comparable</li>
</ul>
<h1>Release 3.4.0 (released Dec 20, 2020)</h1>
<h2>Incompatible changes</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8105">#8105</a>: autodoc: the signature of class constructor will be shown for decorated
classes, not a signature of decorator</li>
</ul>
<h2>Deprecated</h2>
<ul>
<li>The <code>follow_wrapped</code> argument of <code>sphinx.util.inspect.signature()</code></li>
<li>The <code>no_docstring</code> argument of
<code>sphinx.ext.autodoc.Documenter.add_content()</code></li>
<li><code>sphinx.ext.autodoc.Documenter.get_object_members()</code></li>
<li><code>sphinx.ext.autodoc.DataDeclarationDocumenter</code></li>
<li><code>sphinx.ext.autodoc.GenericAliasDocumenter</code></li>
<li><code>sphinx.ext.autodoc.InstanceAttributeDocumenter</code></li>
<li><code>sphinx.ext.autodoc.SlotsAttributeDocumenter</code></li>
<li><code>sphinx.ext.autodoc.TypeVarDocumenter</code></li>
<li><code>sphinx.ext.autodoc.importer._getannotations()</code></li>
<li><code>sphinx.ext.autodoc.importer._getmro()</code></li>
<li><code>sphinx.pycode.ModuleAnalyzer.parse()</code></li>
<li><code>sphinx.util.osutil.movefile()</code></li>
<li><code>sphinx.util.requests.is_ssl_error()</code></li>
</ul>
<h2>Features added</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8119">#8119</a>: autodoc: Allow to determine whether a member not included in
<code>__all__</code> attribute of the module should be documented or not via
:event:<code>autodoc-skip-member</code> event</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8219">#8219</a>: autodoc: Parameters for generic class are not shown when super class is</li>
</ul>
<!-- raw HTML omitted -->
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/f5406b918791d9504ca6638330d89dbd86ebcb93"><code>f5406b9</code></a> Bump to 3.4.1 final</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/b94752a293c37d61ee89bc4a9f3e5b937fde525d"><code>b94752a</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8585">#8585</a> from tk0miya/8583_unnecessary_eq</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/5c39d0c0688d011a26b806f9bcc90d194ad292f0"><code>5c39d0c</code></a> Fix <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8583">#8583</a>: autodoc: Unnecessary object comparision via <code>__eq__</code> method</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/043260481b59c922fea042a1e9bbc4ff32fa1069"><code>0432604</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8581">#8581</a> from tk0miya/8566_autodoc_process_docstring_for_alia...</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/df8ab215c0c30da1de6ddadfef957b447510778a"><code>df8ab21</code></a> Fix <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8566">#8566</a>: autodoc-process-docstring is emitted to the alias classes</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/46eaa5db8005492ae2ff28208f95b9ea8dab62b5"><code>46eaa5d</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8579">#8579</a> from francoisfreitag/fix-queue</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/a1b8b1febb6ce0b7423bb78df30b0fc424c12325"><code>a1b8b1f</code></a> Ensure linkcheck items are comparable</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/955d6558ec155dffaef999d890c2cdb224cbfbb9"><code>955d655</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8571">#8571</a> from tk0miya/8567_wrong_ivars_in_parent_class</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/70bb2262d6677e5bcf2c85786b5f410a3a0f68aa"><code>70bb226</code></a> Fix <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8567">#8567</a>: autodoc: Instance attributes are incorrectly added to Parent class</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/31cad2ebe7a205154e1374bfa52338111e515719"><code>31cad2e</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8570">#8570</a> from tk0miya/8569_getslots_TypeError</li>
<li>Additional commits viewable in <a href="https://github.com/sphinx-doc/sphinx/compare/v3.2.1...v3.4.1">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=sphinx&package-manager=pip&previous-version=3.2.1&new-version=3.4.1)](https://dependabot.com/compatibility-score/?dependency-name=sphinx&package-manager=pip&previous-version=3.2.1&new-version=3.4.1)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>

### Expected Behavior

a simple post api

```
@app.route('/video', methods=['GET', 'POST'])
def upload_image():
    if request.method == 'POST':   
        print(request.form)
        print(request.files)
        ....
    else:
        return 'failed, not post', 400
```

use requests
```
import requests

url = 'http://127.0.0.1:5000/video'
name_v = 'CVN.mp4'
files = {'file': open(name_v, 'rb')}
r = requests.post(url, files=files)
```
  is ok

_ImmutableMultiDict([])
ImmutableMultiDict([('file', <FileStorage: 'CVN.mp4' (None)>)])_

but use postman [postman app](https://www.postman.com/downloads/)
with  Body binarty  (a mp4 file)

 to test post api 

post a jpg is ok,  but when post .mp4 file, 
postman auto set header
Content-Type          video/mp4

both request.form, request.files is empty

_ImmutableMultiDict([])
ImmutableMultiDict([])_


### Environment

* Python version:  3.8.5  x64 anaconda3 
* Flask version:    1.1.2
* Werkzeug version: 1.0.1

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
Flask session cookie secure flag is not getting set. 
One chrome developer tools, i see in the cookie sesction. the cookie name "session" is not have secure colum checked.

```python
app.config.update(
    SESSION_COOKIE_SECURE=True, - -> This one
    DEBUG=True,
    REMEMBER_COOKIE_SECURE=True,
)

```

### Actual Behavior
<!-- Tell us what happens instead. -->

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version: 3.6
* Flask version: 1.x
* Werkzeug version:

Raising a `HTTPException` (for example by calling `abort()`) does not cause registered signal handlers for `got_request_exception` to be called.
https://flask.palletsprojects.com/en/1.1.x/api/#flask.got_request_exception does not state that some Exceptions
are forwarded to the handler and some are not.
Changing this behaviour could potentially break quite a few application, but at least the signal documentation should include this behaviour.

### Expected Behavior
raising a HTTPException in a view function should cause the signal handler to be called.

```python
from flask import Flask, got_request_exception, abort
app = Flask(__name__)

def signal_handler(sender, exception, **extra):
    print("handled %s" % str(type(exception)))

got_request_exception.connect(signal_handler)

@app.route('/1')
def view_1():
    # calling this view prints "handled <class 'RuntimeError'>" to the console
    raise RuntimeError()

@app.route('/2')
def view_2():
    # calling this view prints nothing
    abort(400)
    # raise werkzeug.exception.TooManyRequests
    # e.g. also does nothing
```

### Actual Behavior
the signal handler is not called

### Environment

* Python version: 3.8.6 (also tested with 3.7)
* Flask version: 1.1.2
* Werkzeug version: 1.0.1
Hi there!

My name is Leo, a CS student at Brown building an automated platform for editable codebase documentation.

I generated documentation for this repository and placed a link in the README. Please feel free to try it out and let me know what you think!

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->


After cloning and installing the master branch I was trying to use flask.send_from_directory which is a wrapper to a call to
werkzeug.utils.send_from_directory which incidentally does not exist on a release version of werkzeug.

After following CONTRIBUTING.rst to install flask master in a clean virtualenv and running pytest. Many tests fail, I quickly realized that the version of werkzeug installed is not compatible with flask HEAD. 
```pytb
# Paste a minimal example that causes the problem.
(flask-test) $ pip install -e . -r requirements/dev.txt
(flask-test) $ pytest
...
FAILED tests/test_views.py::test_remove_method_from_parent - TypeError: argument of type 'BaseRequest' is not iterable
====================================== 215 failed, 233 passed, 3 xpassed in 8.90s ======================================
```

After making the following change (sourcing the master branch of werkzeug from github in setup.py),

```
diff --git a/setup.py b/setup.py
index 6218be60..61bb4d4e 100644
--- a/setup.py
+++ b/setup.py
@@ -10,7 +10,7 @@ setup(
     name="Flask",
     version=version,
     install_requires=[
-        "Werkzeug>=0.15",
+        "werkzeug @git+git://github.com/pallets/werkzeug@master#egg=werkzeug",
         "Jinja2>=2.10.1",
         "itsdangerous>=0.24",
         "click>=5.1",
```
```
(flask-test) $ pip uninstall werkzeug
(flask-test) $ pip install -e . -r requirements/dev.txt
(flask-test) $ pytest
================================================= test session starts ==================================================
platform linux -- Python 3.8.5, pytest-6.1.2, py-1.9.0, pluggy-0.13.1
...
============================================ 448 passed, 3 xpassed in 1.92s ============================================
```

I didn't submit a PR because I'm not sure if this is the right way to fix this for building master, I think the real fix is publishing a new release of werkzeug so we can use a version number. 
A small self-explanatory documentation change.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->
- This bug occurs in Flask API server to  image download. I search this error at Google. I find same issue at this repo. it is here.

> https://github.com/boto/botocore/issues/1413

- This issue is specific time. this error occur in Flask API server run after about 1hours. I don't know this issue. Help me please.

- My code is it.
```python

@app.route('/inspection', methods=['GET', 'POST'])
def image_inspection():
    if request.method == "GET":
        check_srl = request.args.get('assetCheckSrl')
        origin_url = request.args.get('origin').replace('"','')
        inspection_url = request.args.get('inspection').replace('"','')
        origin_path = origin_url.split('com/')[1]
        inspection_path = inspection_url.split('com/')[1]

        print("check_srl :" , check_srl)
        print("origin_url :" , origin_url) # https://XXXX.s3.ap-northeast-2.amazonaws.com/XXXX/asset/init/1110_asset_201125173650.jpg
        print("inspection_url :" , inspection_url) # https://XXXX-s3.s3.ap-northeast-2.amazonaws.com/XXXX/asset/init/1110_asset_201125173855.jpg
        print("origin_path :" , origin_path) # XXXX/asset/init/1110_asset_201125173650.jpg
        print("inspection_path :" , inspection_path) # XXXX/asset/init/1110_asset_201125173855.jpg

        origin_image = image_origin_object(origin_path)
        time.sleep(1)
        inspection_image = image_inspection_object(inspection_path)
        ~~~~~~~~~~~~~~~~~~~~~~
        ~~~~~~~~~~~~~~~~~~~~~~
        ~~~~~~~~~~~~~~~~~~~~~~
        compare_url = result_save(result_feature['result']['result_path'], inspection_url, inspection_path)

        return jsonify(result_feature)

def image_origin_object(origin_path):
    
    origin_image = './images/' + origin_path.split('init/')[1]
    s3.Bucket(BUCKET_NAME).download_file(origin_path, origin_image)
    
    return origin_image

def image_inspection_object(inspection_path):

    inspection_image = './images/' + inspection_path.split('init/')[1]
    print('inspection_path >>> : ', inspection_path)
    print('inspection_image >>> : ', inspection_image)
    s3.Bucket(BUCKET_NAME).download_file(inspection_path, inspection_image)

    return inspection_image

def result_save(file_name, inspection_url, inspection_path):

    s3_client = boto3.client('s3')
    inspection_url = inspection_url.replace('init','compare')
    KEY = inspection_path.replace('init','compare')
    response = s3_client.upload_file(file_name, BUCKET_NAME, KEY)

    return inspection_url
```

### Actual Behavior
<!-- Tell us what happens instead. -->

- I make Flask API server for image processing in AWS EC2. AWS S3 Bucket is public setting. AWS EC2 configure already set my KEY, region.
### Environment

* Python version: 
```bash
(venv) ubuntu:~/environment $ python --version
Python 3.6.9
```
* Flask version:
Flask==1.1.2
Jinja2==2.11.2
flask-cors==3.0.8
* Werkzeug version:
Werkzeug==1.0.1

Having a route like `@app.route("/my-put-url/<obj_id>", methods=["PUT"])`. The route only needs access to `obj_id` which is provided in the URI. There's no need for a `body` in this case. To work around it, I need to provide `{}` in the body for it to work.

### Expected Behavior
When making a PUT request __without__ a body, which I _think_ is a valid request under RFC, such request should be handled by Flask.

### Actual Behavior
Flask however returns a 400 BadRequest response. In postman, it renders like this

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<title>400 Bad Request</title>
<h1>Bad Request</h1>
<p>The browser (or proxy) sent a request that this server could not understand.</p>
```

### Environment

* Python version: 3.7
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

I wanted to embed web page to iframe, but got cross-site issue.  The solution was set `SESSION_COOKIE_SAMESITE = None`.  The feature have existed after flask 1.0 [#2607](https://github.com/pallets/flask/pull/2607) [changed log](https://flask.palletsprojects.com/en/1.1.x/changelog/)

But no matter what I set, the `samesite` attribute has never shown up.

I can assure that flask and werkzung both are right version.  [#1549](https://github.com/pallets/werkzeug/issues/1549) and use the right config file.
### Expected Behavior
<!-- Tell us what should happen. -->

```http
Set-Cookie: session=<session>; Expires=Mon, 23-Nov-2020 11:58:00 GMT; Path=/; secure; samesite=<whatever I set>
```

### Actual Behavior
<!-- Tell us what happens instead. -->

```http
Set-Cookie: session=<session>; Expires=Mon, 23-Nov-2020 11:58:00 GMT; Path=/; secure
```

### Example
1. Try to set `samesite=strict` and without secure.

config.py
```python
SESSION_COOKIE_SAMESITE = 'Strict'
SESSION_COOKIE_HTTPONLY = False
SESSION_COOKIE_SECURE = False
```
result
![image](https://user-images.githubusercontent.com/9116623/100204291-ac4ae780-2f3e-11eb-8b1d-03a21006fd45.png)


2. Try to set `samesite=lax` and with secure.

config.py
```python
SESSION_COOKIE_SAMESITE = 'Lax'
SESSION_COOKIE_HTTPONLY = False
SESSION_COOKIE_SECURE = True
```

result
![image](https://user-images.githubusercontent.com/9116623/100205281-dea91480-2f3f-11eb-9561-90bb3a5f76ca.png)

### Environment

* Python version: 3.6
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Could we have a `before_request` handler in `MethodView`? It could be called as part of the `MethodView.dispatch_request` method.

It would be called if any subclass of `MethodView` implements a `before_request` method, for instance:

```py3
from flask.views import MethodView


class BaseView(MethodView):
    """ Base view  """

    def before_request(self):
        print("before_request called")
```

flask/views.py:

```py3
class MethodView(with_metaclass(MethodViewType, View)):
    """A class-based view that ... """

    def before_request(self, *args, **kwargs):
        """ Called before the request is dispatched to the request method handler """
        pass

    def dispatch_request(self, *args, **kwargs):

        meth = getattr(self, request.method.lower(), None)

        self.before_request(*args, **kwargs)

        # or ...

        before_func = getattr(self, "before_request", None)
        if before_func:
            before_func(*args, **kwargs)

        # If the request method is HEAD and we don't have a handler for it
        # retry with GET.
        if meth is None and request.method == "HEAD":
            meth = getattr(self, "get", None)

        assert meth is not None, "Unimplemented method %r" % request.method
        return meth(*args, **kwargs)
```


Hi,When i try to register and click submit button data doesn't save to database and page doesn't redirect to index page,thanks for attention!Sorry for my terrible english.

Python 3.9
Flask 1.1.2
Werkzeug 1.0.1

from flask import Flask,render_template,flash,redirect,url_for,session,logging,request
from flask_mysqldb import MySQL
from wtforms import Form,StringField,TextAreaField,PasswordField,validators
from passlib.hash import sha256_crypt

class RegisterForm(Form):
    name=StringField("Name and Surname",validators=[validators.length(min=5,max=15)])
    username=StringField("Username",validators=[validators.length(min=5,max=15)])
    email=StringField("Email",validators=[validators.Email(message="That is not valid email")])
    password=PasswordField("Password",validators=[
        validators.DataRequired(message="Please enter the password"),
        validators.EqualTo(fieldname="confirm",message="Passwords doesn't match")
    ])
    confirm=PasswordField("Password Confirmation")

app=Flask(__name__)
app.config["MYSQL_HOST"]="localhost"
app.config["MYSQL_USER"]="root"
app.config["MYSQL_PASSWORD"]=""
app.config["MYSQL_DB"]="mysite"
app.config["MYSQL_CURSORCLASS"]="DictCursor"
mysql=MySQL(app)

@app.route("/")
def index():
    return render_template("index.html")

@app.route("/about")
def about():
    return render_template("about.html")

@app.route("/article/<string:id>")
def article(id):
    return "Article  id:"+ id
#register
@app.route("/register",methods=["GET","POST"])
def register():
    form=RegisterForm(request.form)
    if request.form=="POST" and form.validate():
        name=form.name.data
        username=form.username
        email=form.email.data
        password=sha256_crypt.encrypt(form.password.data)
        cursor=mysql.connection.cursor()
        requestt="Insert into users(name,email,username,password) VALUES(%s,%s,%s,%s)"
        cursor.execute(requestt,(name,username,email,password))
        mysql.connection.commit()
        cursor.close()
        return redirect(url_for("index"))
    else:
        return render_template("register.html",form=form)

if __name__=="__main__":
    app.run(debug=True)
I have been trying to verify my flask web app in the google search console using the HTML file upload method but when uploading the file to the root directory, it does not appear and raises a 404 error. I also tried putting it in the templates folder but still, 404 was raised. Is there any way I can prevent this behavior and make it work

```
def allowed_file(filename):
    return '.' in filename and \
           filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS
```
Please explain the above code of lines. For full reference please visit: [https://flask.palletsprojects.com/en/1.1.x/patterns/fileuploads/](url)
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->
I design a simple RESTful server and I would like to use session (just session import from flask) for user login/logout. 
I put username in login interface and want to pop it in logout. 
So next time even same session id come after logout, it would not has any authority to use other apis.

```python
# Paste a minimal example that causes the problem.

@sitemap.route('/login', methods=('POST',))
def login():
    session['userid'] = "user_obj.id"
    session['username'] = "user_obj.nickname"
    session.permanent = True
    return "pass"

@sitemap.route('/logout', methods=('GET', 'POST'))
def logout():
    session.pop('username', None)
    session.pop('userid', None)
    return "pass"

@app.before_request
def before_action():
    uri = request.path
    if uri in {"/login"}:
        return

    if u'username' not in session:
        return "auth fail"
```

### Actual Behavior
<!-- Tell us what happens instead. -->
By using POSTMAN, I put server returned cookie in header, to simulate headless visit RESTful api.
<img width="856" alt="logout" src="https://user-images.githubusercontent.com/3025435/99762979-ac10ad80-2b34-11eb-895c-c2d81862be94.png">
After logout, I could visit other api... Just like session.pop unhappened.
That means, after logout, the code still pass before_action check if I try to use /helloworld, /list etc...


```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version: 3.8.5
* Flask version: 1.1.2
* Werkzeug version: just run in debug mode, like `create_app().run(debug=True)`

As reported in [an older ticket](https://github.com/pallets/werkzeug/issues/1683), [the documentation for abort(status, *args, **kwargs)](https://flask.palletsprojects.com/en/1.1.x/api/#flask.abort) has something wrong. It contains:

> Raises an HTTPException for the given status code or WSGI application.
> 
> If a status code is given, it will be looked up in the list of exceptions and will raise that exception. If passed a WSGI application, it will wrap it in a proxy WSGI exception and raise that:
> 
> abort(404)  # 404 Not Found
> abort(Response('Hello World'))

This is now better thanks to previous work by @cjnickel, but as he pointed out, it looks like the flask.abort() documentation is the same as werkzeug's werkzeug.exceptions.abort and it remains unclear what the author meant to write. We could start by keeping only examples about flask.abort(status, *args, **kwargs) and labelling those as such.
This change fixes the incorrect syntax introduced by #3835. Sorry about the mixup!
It has just come to my attention that I mistakenly committed the incorrect new syntax:
```
run: echo "name=PY::$(python -VV | sha256sum | cut -d' ' -f1)" >> $GITHUB_ENV
```
should become
```
run: echo "PY=$(python -VV | sha256sum | cut -d' ' -f1)" >> $GITHUB_ENV
```
I noticed that recent CI test runs were [failing](https://github.com/pallets/flask/actions/runs/366551315) due to the deprecated `set-env` command. 

These changes update the deprecated command according to [this changelog](https://github.blog/changelog/2020-10-01-github-actions-deprecating-set-env-and-add-path-commands/).

I went to the web site to find out what Flask **is**.  That question is never directly answered, that I can find.
It might be helpful if the front page of the web site and/or the _Introduction_ page in the documentation had 1-3 sentence statement of what the heck Flask is / does.  What's it for?

At present, the documentation on the site gives no indication of why one should read more, of what Flask can do.
Reading through the first bits of the docs, I get the feeling that maybe Flask has something to with writing web services in Python.
Code:
```py
app.run(host=gethost(), port=6969)
```

gethost function:
```py
import socket

def gethost():
	s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
	try:
		s.connect(("1.2.3.4", 1))
		ip = s.getsockname()[0]
	except:
		ip = "127.0.0.1"
	finally:
		s.close()
	return ip
```
Error (at app.run line)
```AttributeError: 'str' object has no attribute 'write'```
At `app.run` line im getting this error
```AttributeError: 'str' object has no attribute 'write'```
Can somebody help?
Added a new feature.


![QQ图片20201106091801](https://user-images.githubusercontent.com/74029736/98314459-ffe9a580-2010-11eb-8361-fae73d0b2735.png)

The implementations were moved to Werkzeug (pallets/werkzeug#1850, pallets/werkzeug#1962). Flask's functions become wrappers around Werkzeug to pass some Flask-specific values.

`cache_timeout` is renamed to `max_age`. `SEND_FILE_MAX_AGE_DEFAULT`, `app.send_file_max_age_default`, and `app.get_send_file_max_age` defaults to `None`. This tells the browser to use conditional requests rather than a 12 hour cache. (pallets/werkzeug#1886)

`attachment_filename` is renamed to `download_name`, and is always sent if a name is known. (pallets/werkzeug#1884)

Deprecate `helpers.safe_join` in favor of `werkzeug.utils.safe_join`.

Removed most of the tests, they're tested in Werkzeug.

In the file upload example, renamed the `uploaded_file` view to `download_file` to avoid a common source of confusion.
Flask's `client.open` mirrors Werkzeug's for processing an existing environ. Fix a test that was passing bytes around incorrectly.

Tox always tests with the latest code of the other Pallets projects. This will be changed back once the new versions are released.
### Expected Behavior
For updates of the code including favicon and index.html to be shown when I hit run in my IDE again (Wingware, but same problem at command line).

```python
# Minimal example is any Flask app
```

### Actual Behavior
Running the app renders the same app I first ran today, namely:
https://github.com/helloflask/calculator

Changing the page title in index.html or the favicon does not get reflected when the app is run.

### Environment

* Python version:  Python 3.8.3
* Flask version:  Version: 1.1.2
* Werkzeug version:  Version: 1.0.1

---

I've made the following script in order to try to both kill the server and delete any .pyc caching that might be causing the problem.  For Windows only:

kill_server.py:
```python
import os
import subprocess
import re

port = 5000
host = '127.0.0.1'
cmd_newlines = r'\r\n'

host_port = host + ':' + str(port)
pid_regex = re.compile(r'[0-9]+$')

netstat = subprocess.run(['netstat', '-n', '-a', '-o'], stdout=subprocess.PIPE)  
# Doesn't return correct PID info without precisely these flags
netstat = str(netstat)
lines = netstat.split(cmd_newlines)

for line in lines:
    if host_port in line:
        pid = pid_regex.findall(line)
        if pid:
            pid = pid[0]
            os.system('taskkill /F /PID ' + str(pid))
        
# And finally delete the .pyc cache
os.system('del /S *.pyc')
```

The problem remains dispite manually doing the above taskkills and deleting .pyc files by hand or running kill_server.py.  Therefore, there's something going on in Flask that is causing the old app to be run (it's cached or something...)

Please help!  I really want to make a calculator in Flask, not CherryPy.

I've tried "Clear Browsing Data > Clear Images & Files / Cookies" in Chrome, on Windows 10.   Same issue.
I am trying to debug Flask running with `gevent` and setting `app.debug = True` is not enough to make code reload work with it (https://github.com/gevent/gevent/issues/1696). It would be nice to get a central page with a table of feature what are available in debug mode for different deploy scenarious.

### Expected Behavior

`app.debug` docs in one place. Information what is available when Flask is run without `flask` utility.

### Actual Behavior

`debug` mode info is scattered over different bits of text. No info what debugging features are absent when deploying with `gevent` (or without `flask run`).

 https://flask.palletsprojects.com/en/master/api/?highlight=app%20debug
When I followed the tutorial I made a silly mistake in my code, and loaded the title for both title and body in the update function.  When saving an update, this meant the title was mirrored in the body, and the body was thrown away.  After I figured out my problem, I added this text to catch it, then fixed it with this code.  It is a small change, but may help the next developer running through the tutorial.

I actually changed `test_update` to the following, but couldn't decide if it made the tutorial easier or harder to understand:

```
def test_update(client, auth, app):
    auth.login()
    assert client.get('/1/update').status_code == 200
    new_values = {'title': 'updated', 'body': ''}
    client.post('/1/update', data=new_values)

    with app.app_context():
        db = get_db()
        post = db.execute('SELECT * FROM post WHERE id = 1').fetchone()

        for field, value in new_values.items():
            assert post[field] == value
```

Bumps [sphinx-tabs](https://github.com/executablebooks/sphinx-tabs) from 1.1.13 to 1.3.0.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/executablebooks/sphinx-tabs/releases">sphinx-tabs's releases</a>.</em></p>
<blockquote>
<h2>v1.3.0</h2>
<p>See <a href="https://github.com/executablebooks/sphinx-tabs/blob/master/CHANGELOG.md">CHANGELOG.md</a></p>
<h2>v1.2.1</h2>
<p>See CHANGELOG.md</p>
<h2>v1.2.0</h2>
<p>See <a href="https://github.com/executablebooks/sphinx-tabs/blob/master/CHANGELOG.md">CHANGELOG.md</a> for details</p>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/executablebooks/sphinx-tabs/blob/master/CHANGELOG.md">sphinx-tabs's changelog</a>.</em></p>
<blockquote>
<h2>1.3.0 - 2020-09-08</h2>
<p>♻️ Major refactor of tabs, group-tabs and code-tabs (thanks to <a href="https://github.com/foster999">@foster999</a>):</p>
<ul>
<li>Removes hard-coded reStructuredText for group and code tabs, so that this works with other parsers (inc <code>MyST Markdown</code>)</li>
<li>group-tab directive now subclasses <code>TabDirective</code> to remove duplicated run code</li>
<li>likewise, <code>code-tab</code> now subclasses <code>group-tab</code></li>
<li><code>TabDirective</code> and <code>TabsDirective</code> now subclass <code>SphinxDirective</code> for easier access to directive <code>env</code></li>
</ul>
<p>🧪 testing infrastructure has now fully moved from unittest to pytest</p>
<p>✨ New features:</p>
<ul>
<li>Can now pass <code>code-tabs</code> with a second argument (allowing whitespace) to provide an alternative tab label</li>
<li><code>code-tabs</code> can now use custom lexers, which are added to the sphinx app in <code>conf.py</code></li>
</ul>
<h2>v1.2.1 - 2020-08-20</h2>
<p>🐛 FIX: Remove <code>app.add_javascript</code> use for sphinx v2</p>
<h2>v1.2.0 - 2020-08-18</h2>
<p><code>sphinx-tabs</code> has now moved to the <a href="https://executablebooks.org">EBP organisation</a> 🎉</p>
<h3>Deprecated 🗑</h3>
<ul>
<li>Python &lt; 3.5 and Sphinx &lt; 2 support dropped</li>
</ul>
<h3>Improved 👌</h3>
<ul>
<li>Lots of code and CI restructuring (see [EBP Migration (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/76">#76</a>)](<a href="https://github.com/executablebooks/sphinx-tabs/commit/6342ed3f1f7d4cb50891001f26d4e3c4c08ee422">https://github.com/executablebooks/sphinx-tabs/commit/6342ed3f1f7d4cb50891001f26d4e3c4c08ee422</a>))</li>
</ul>
<h3>Fixed 🐛</h3>
<ul>
<li>Replace <code>add_javascript</code> by <code>add_js</code> for sphinx&gt;=3 (removes warning!),
thanks to <a href="https://github.com/Daltz333">@Daltz333</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/05ddd2cedeae2c71d1cf529383ca730911162666"><code>05ddd2c</code></a> 🚀 RELEASE: v1.3.0</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/de7e7126198aac5e9598e099f9a2f4cd8e089e55"><code>de7e712</code></a> ♻️ REFACTOR: Make content parsing format agnostic (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/79">#79</a>)</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/384fdf739013fe29285b6f27fd6d51e3845beadd"><code>384fdf7</code></a> 🧪 TESTS: Move from unittest to pytest (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/88">#88</a>)</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/546f52f1b0c76fb0ccc2340381e5ee023406a38b"><code>546f52f</code></a> 🚀 RELEASE: v1.2.1 (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/86">#86</a>)</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/2db3551bde7cac6b527d64c7c1d2296855230776"><code>2db3551</code></a> 🐛 FIX: Remove <code>app.add_javascript</code> use for sphinx v2</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/b0f41a186f21482ff336ea7840cab29b9824d4a6"><code>b0f41a1</code></a> 📚 DOCS: Remove sphinx-tabs version from README (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/83">#83</a>)</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/0dfdba8664b4be4b754b7fabddc988c881813ba5"><code>0dfdba8</code></a> 📚 DOCS: mention sphinx_tabs_valid_builders in README (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/56">#56</a>)</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/9c228e6cc9f5c9e857bd154852acf5ac5e3b3757"><code>9c228e6</code></a> 🚀 RELEASE: v1.2.0 (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/82">#82</a>)</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/464dd36501c8b8f7374850c230f313e8f29ecd96"><code>464dd36</code></a> 🔧 MAINTAIN: Update Manifest</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/dee9cb30306225de7dd5f5b3de43b6b6d02da524"><code>dee9cb3</code></a> 🐛 FIX: Replace <code>add_javascript</code> by <code>add_js</code> for sphinx&gt;=3 (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/77">#77</a>)</li>
<li>Additional commits viewable in <a href="https://github.com/executablebooks/sphinx-tabs/compare/v1.1.13...v1.3.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=sphinx-tabs&package-manager=pip&previous-version=1.1.13&new-version=1.3.0)](https://dependabot.com/compatibility-score/?dependency-name=sphinx-tabs&package-manager=pip&previous-version=1.1.13&new-version=1.3.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [pre-commit](https://github.com/pre-commit/pre-commit) from 2.7.1 to 2.8.2.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/releases">pre-commit's releases</a>.</em></p>
<blockquote>
<h2>pre-commit v2.8.1</h2>
<h3>Fixes</h3>
<ul>
<li>Allow default <code>language_version</code> of <code>system</code> when the homedir is <code>/</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1669">#1669</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
</ul>
<h2>pre-commit v2.8.0</h2>
<h3>Features</h3>
<ul>
<li>Update <code>rbenv</code> / <code>ruby-build</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1612">#1612</a> issue by <a href="https://github.com/tdeo">@tdeo</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1614">#1614</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Update <code>sample-config</code> versions
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1611">#1611</a> PR by <a href="https://github.com/mcsitter">@mcsitter</a>.</li>
</ul>
</li>
<li>Add new language: <code>dotnet</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1598">#1598</a> by <a href="https://github.com/rkm">@rkm</a>.</li>
</ul>
</li>
<li>Add <code>--negate</code> option to <code>language: pygrep</code> hooks
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1643">#1643</a> PR by <a href="https://github.com/MarcoGorelli">@MarcoGorelli</a>.</li>
</ul>
</li>
<li>Add zipapp support
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1616">#1616</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Run pre-commit through <a href="https://pre-commit.ci">https://pre-commit.ci</a>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1662">#1662</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Add new language: <code>coursier</code> (a jvm-based package manager)
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1633">#1633</a> PR by <a href="https://github.com/JosephMoniz">@JosephMoniz</a>.</li>
</ul>
</li>
<li>Exit with distinct codes: 1 (user error), 3 (unexpected error), 130 (^C)
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1601">#1601</a> PR by <a href="https://github.com/int3l">@int3l</a>.</li>
</ul>
</li>
</ul>
<h3>Fixes</h3>
<ul>
<li>Improve <code>healthy()</code> check for <code>language: node</code> + <code>language_version: system</code> hooks when the system executable goes missing.
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/action/issues/45">pre-commit/action#45</a> issue by <a href="https://github.com/KOliver94">@KOliver94</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1589">#1589</a> issue by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1590">#1590</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Fix excess whitespace in error log traceback
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1592">#1592</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Fix posixlike shebang invocations with shim executables of the git hook script on windows.
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1593">#1593</a> issue by <a href="https://github.com/Celeborn2BeAlive">@Celeborn2BeAlive</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1595">#1595</a> PR by <a href="https://github.com/Celeborn2BeAlive">@Celeborn2BeAlive</a>.</li>
</ul>
</li>
<li>Remove hard-coded <code>C:\PythonXX\python.exe</code> path on windows as it caused confusion (and <code>virtualenv</code> can sometimes do better)
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1599">#1599</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Fix <code>language: ruby</code> hooks when <code>--format-executable</code> is present in a gemrc
<ul>
<li>issue by <code>Rainbow Tux</code> (discord).</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1603">#1603</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Move <code>cygwin</code> / <code>win32</code> mismatch error earlier to catch msys2 mismatches
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1605">#1605</a> issue by <a href="https://github.com/danyeaw">@danyeaw</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1606">#1606</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Remove <code>-p</code> workaround for old <code>virtualenv</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1617">#1617</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Fix <code>language: node</code> installations to not symlink outside of the environment
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit-ci/issues/issues/2">pre-commit-ci/issues#2</a> issue by <a href="https://github.com/DanielJSottile">@DanielJSottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1667">#1667</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Don't identify shim executables as valid <code>system</code> for defaulting
<code>language_version</code> for <code>language: node</code> / <code>language: ruby</code></li>
</ul>
<!-- raw HTML omitted -->
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/blob/master/CHANGELOG.md">pre-commit's changelog</a>.</em></p>
<blockquote>
<h1>2.8.2 - 2020-10-30</h1>
<h3>Fixes</h3>
<ul>
<li>Fix installation of ruby hooks with <code>language_version: default</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1671">#1671</a> issue by <a href="https://github.com/aerickson">@aerickson</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1672">#1672</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
</ul>
<h1>2.8.1 - 2020-10-28</h1>
<h3>Fixes</h3>
<ul>
<li>Allow default <code>language_version</code> of <code>system</code> when the homedir is <code>/</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1669">#1669</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
</ul>
<h1>2.8.0 - 2020-10-28</h1>
<h3>Features</h3>
<ul>
<li>Update <code>rbenv</code> / <code>ruby-build</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1612">#1612</a> issue by <a href="https://github.com/tdeo">@tdeo</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1614">#1614</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Update <code>sample-config</code> versions
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1611">#1611</a> PR by <a href="https://github.com/mcsitter">@mcsitter</a>.</li>
</ul>
</li>
<li>Add new language: <code>dotnet</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1598">#1598</a> by <a href="https://github.com/rkm">@rkm</a>.</li>
</ul>
</li>
<li>Add <code>--negate</code> option to <code>language: pygrep</code> hooks
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1643">#1643</a> PR by <a href="https://github.com/MarcoGorelli">@MarcoGorelli</a>.</li>
</ul>
</li>
<li>Add zipapp support
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1616">#1616</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Run pre-commit through <a href="https://pre-commit.ci">https://pre-commit.ci</a>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1662">#1662</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Add new language: <code>coursier</code> (a jvm-based package manager)
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1633">#1633</a> PR by <a href="https://github.com/JosephMoniz">@JosephMoniz</a>.</li>
</ul>
</li>
<li>Exit with distinct codes: 1 (user error), 3 (unexpected error), 130 (^C)
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1601">#1601</a> PR by <a href="https://github.com/int3l">@int3l</a>.</li>
</ul>
</li>
</ul>
<h3>Fixes</h3>
<ul>
<li>Improve <code>healthy()</code> check for <code>language: node</code> + <code>language_version: system</code>
hooks when the system executable goes missing.
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/action/issues/45">pre-commit/action#45</a> issue by <a href="https://github.com/KOliver94">@KOliver94</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1589">#1589</a> issue by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1590">#1590</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Fix excess whitespace in error log traceback
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1592">#1592</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Fix posixlike shebang invocations with shim executables of the git hook
script on windows.
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1593">#1593</a> issue by <a href="https://github.com/Celeborn2BeAlive">@Celeborn2BeAlive</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1595">#1595</a> PR by <a href="https://github.com/Celeborn2BeAlive">@Celeborn2BeAlive</a>.</li>
</ul>
</li>
<li>Remove hard-coded <code>C:\PythonXX\python.exe</code> path on windows as it caused</li>
</ul>
<!-- raw HTML omitted -->
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pre-commit/pre-commit/commit/3112e080883c4973262569d81b6d3307db08b210"><code>3112e08</code></a> v2.8.2</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/4aa249c8a5359dc4164abc5350788dfa259b3a1b"><code>4aa249c</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1672">#1672</a> from pre-commit/ruby_default</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/e05ac1e91fcfa695405df1c18d4432c12e5d7142"><code>e05ac1e</code></a> don't call ruby install for language_version = default</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/b2207e5b044374d90cc349e136279f27e615d0fc"><code>b2207e5</code></a> v2.8.1</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/8fb7365a6142d5ac498ee227536137ae3f6b47dc"><code>8fb7365</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1669">#1669</a> from pre-commit/not_a_shim_when_home_is_slash</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/62b8d0ed825bde729a32ffadf0b45f2ea82315f8"><code>62b8d0e</code></a> allow default language_version of system when homedir is /</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/711248f6785e60d698d915e79841df65de40634a"><code>711248f</code></a> show features first</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/a3c9721d8f4df3de7104f61b336dea3feb5fa52c"><code>a3c9721</code></a> v2.8.0</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/763dbc0ac6b21d06178175aa14165e3beff708b2"><code>763dbc0</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1668">#1668</a> from pre-commit/avoid_shims</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/7f9f66e542395ba743e243bdcd92df4e5500d57d"><code>7f9f66e</code></a> don't use system for ruby/node if it is a shim exe</li>
<li>Additional commits viewable in <a href="https://github.com/pre-commit/pre-commit/compare/v2.7.1...v2.8.2">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pre-commit&package-manager=pip&previous-version=2.7.1&new-version=2.8.2)](https://dependabot.com/compatibility-score/?dependency-name=pre-commit&package-manager=pip&previous-version=2.7.1&new-version=2.8.2)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [python-dotenv](https://github.com/theskumar/python-dotenv) from 0.14.0 to 0.15.0.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/theskumar/python-dotenv/blob/master/CHANGELOG.md">python-dotenv's changelog</a>.</em></p>
<blockquote>
<h2>[0.15.0] - 2020-10-28</h2>
<h3>Added</h3>
<ul>
<li>Add <code>--export</code> option to <code>set</code> to make it prepend the binding with <code>export</code> (<a href="https://github-redirect.dependabot.com/theskumar/python-dotenv/issues/270">#270</a> by
[<a href="https://github.com/jadutter">@jadutter</a>]).</li>
</ul>
<h3>Changed</h3>
<ul>
<li>Make <code>set</code> command create the <code>.env</code> file in the current directory if no <code>.env</code> file was
found (<a href="https://github-redirect.dependabot.com/theskumar/python-dotenv/issues/270">#270</a> by [<a href="https://github.com/jadutter">@jadutter</a>]).</li>
</ul>
<h3>Fixed</h3>
<ul>
<li>Fix potentially empty expanded value for duplicate key (<a href="https://github-redirect.dependabot.com/theskumar/python-dotenv/issues/260">#260</a> by [<a href="https://github.com/bbc2">@bbc2</a>]).</li>
<li>Fix import error on Python 3.5.0 and 3.5.1 (<a href="https://github-redirect.dependabot.com/theskumar/python-dotenv/issues/267">#267</a> by [<a href="https://github.com/gongqingkui">@gongqingkui</a>]).</li>
<li>Fix parsing of unquoted values containing several adjacent space or tab characters
(<a href="https://github-redirect.dependabot.com/theskumar/python-dotenv/issues/277">#277</a> by [<a href="https://github.com/bbc2">@bbc2</a>], review by [<a href="https://github.com/x-yuri">@x-yuri</a>]).</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/theskumar/python-dotenv/commit/e13d957bf48224453c5d9d9a7a83a13b999e0196"><code>e13d957</code></a> Release v0.15.0</li>
<li><a href="https://github.com/theskumar/python-dotenv/commit/fa354ce5d4c4f515e340265bf7c0f7e32fb0e75d"><code>fa354ce</code></a> Migrate from travis-ci.org to .com</li>
<li><a href="https://github.com/theskumar/python-dotenv/commit/6fc345833f148762bb8783896d1b1059b146886f"><code>6fc3458</code></a> Add python 3.9 to CI</li>
<li><a href="https://github.com/theskumar/python-dotenv/commit/7b172fe24830bb8fd8cd943b73570e8cd6515ba1"><code>7b172fe</code></a> Fix parsing of unquoted values with two spaces</li>
<li><a href="https://github.com/theskumar/python-dotenv/commit/6ca2e2ab399c7e41be276bc830f21af3092f5d28"><code>6ca2e2a</code></a> Add --export to <code>set</code> and make it create env file</li>
<li><a href="https://github.com/theskumar/python-dotenv/commit/92ec3b280db6e9f946994a3bf5815d6b6447892c"><code>92ec3b2</code></a> Update README.md</li>
<li><a href="https://github.com/theskumar/python-dotenv/commit/78be0f865d34c34120456ff0b6b9d34a95ac6879"><code>78be0f8</code></a> Fix import error on Python 3.5.0 and 3.5.1</li>
<li><a href="https://github.com/theskumar/python-dotenv/commit/4b434362e1832771fd08c14b8af67a8fd562b854"><code>4b43436</code></a> Fix empty expanded value for duplicate key</li>
<li>See full diff in <a href="https://github.com/theskumar/python-dotenv/compare/v0.14.0...v0.15.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=python-dotenv&package-manager=pip&previous-version=0.14.0&new-version=0.15.0)](https://dependabot.com/compatibility-score/?dependency-name=python-dotenv&package-manager=pip&previous-version=0.14.0&new-version=0.15.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
[//]: # (dependabot-start)
⚠️  **Dependabot is rebasing this PR** ⚠️ 

If you make any changes to it yourself then they will take precedence over the rebase.

---

[//]: # (dependabot-end)

Bumps [tox](https://github.com/tox-dev/tox) from 3.20.0 to 3.20.1.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/tox-dev/tox/blob/master/docs/changelog.rst">tox's changelog</a>.</em></p>
<blockquote>
<h1>v3.20.1 (2020-10-09)</h1>
<h2>Bugfixes</h2>
<ul>
<li>Relax importlib requirement to allow version&lt;3 - by usamasadiq <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1682">#1682</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/tox-dev/tox/commit/e4285063289fd3550427ef47a5e681cb41addbee"><code>e428506</code></a> release 3.20.1</li>
<li><a href="https://github.com/tox-dev/tox/commit/e66fc6d717bfe22c4f34548e5c40f711b27b4b19"><code>e66fc6d</code></a> Fix negated factor condition example for not-a-and-not-b (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1683">#1683</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/cfe38bb853ff8573817c640a158b87eaad5b6e01"><code>cfe38bb</code></a> Update general.rst (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1685">#1685</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/471b39f0edd015b8e873695c3cfb893ede36fae6"><code>471b39f</code></a> Update constraint for importlib-metadata (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1682">#1682</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/9120bc77d94ea7efcc77c13249297e2f4b023b89"><code>9120bc7</code></a> Some headings aren't completely fixed, yet (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1676">#1676</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/c2f6c9cb9a1d70ac79524076845bc32ed25489ad"><code>c2f6c9c</code></a> Make headings consistent (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1675">#1675</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/800b4cc1261b490a8afa34b44dc804a82ecf0b81"><code>800b4cc</code></a> Improve docs grammar and clarity. (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1671">#1671</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/e9071c17f51031dd397f0b716fdb58a4a7df66be"><code>e9071c1</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1669">#1669</a> from tox-dev/release-3.20.0</li>
<li>See full diff in <a href="https://github.com/tox-dev/tox/compare/3.20.0...3.20.1">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=tox&package-manager=pip&previous-version=3.20.0&new-version=3.20.1)](https://dependabot.com/compatibility-score/?dependency-name=tox&package-manager=pip&previous-version=3.20.0&new-version=3.20.1)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [pytest](https://github.com/pytest-dev/pytest) from 6.1.1 to 6.1.2.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/releases">pytest's releases</a>.</em></p>
<blockquote>
<h2>6.1.2</h2>
<h1>pytest 6.1.2 (2020-10-28)</h1>
<h2>Bug Fixes</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7758">#7758</a>: Fixed an issue where some files in packages are getting lost from <code>--lf</code> even though they contain tests that failed. Regressed in pytest 5.4.0.</li>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7911">#7911</a>: Directories created by tmpdir are now considered stale after 3 days without modification (previous value was 3 hours) to avoid deleting directories still in use in long running test suites.</li>
</ul>
<h2>Improved Documentation</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7815">#7815</a>: Improve deprecation warning message for <code>pytest._fillfuncargs()</code>.</li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/blob/master/CHANGELOG.rst">pytest's changelog</a>.</em></p>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pytest-dev/pytest/commit/4e8b50ba01f0d8a6a2abb98440d3421a037eddb7"><code>4e8b50b</code></a> Prepare release version 6.1.2</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/cd221df8e28681e71fbb61e79e0759385c9f229b"><code>cd221df</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7955">#7955</a> from nicoddemus/backport-7914</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/8c1c1ae3107b890e53d8396cfbf79a5a20af09db"><code>8c1c1ae</code></a> Increase temp dir deletion period to 3 days (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7914">#7914</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/a88fe584adc0cc9d94b4e184c20ad23738e4ed32"><code>a88fe58</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7919">#7919</a> from nicoddemus/backport-7917</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/cd57271455e56661f2931bcb6cc05e9f7e87f4b0"><code>cd57271</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7917">#7917</a> from bluetech/ci-timeout</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/46195edc3e540611703444311e25b0fbffc3aae0"><code>46195ed</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7918">#7918</a> from bluetech/backport-7915</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/9237b5f6335af39377a231d26648b48bab3eb871"><code>9237b5f</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7915">#7915</a> from bluetech/fix-lf-package</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/95fd566133d01256fcb136ea444b4b21f8b73bc8"><code>95fd566</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7867">#7867</a> from nicoddemus/backport-7829</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/c93962c49123928650cc1e18d172e10194fecebc"><code>c93962c</code></a> Add alias clarification to deprecation warning (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7829">#7829</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/dc96e485a037f84fe2dfa708ca5724a186705f9d"><code>dc96e48</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7861">#7861</a> from nicoddemus/backport-7860</li>
<li>Additional commits viewable in <a href="https://github.com/pytest-dev/pytest/compare/6.1.1...6.1.2">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pytest&package-manager=pip&previous-version=6.1.1&new-version=6.1.2)](https://dependabot.com/compatibility-score/?dependency-name=pytest&package-manager=pip&previous-version=6.1.1&new-version=6.1.2)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->

```python
from flask import Flask
import time

app = Flask(__name__)


@app.route("/")
def hello():
    time.sleep(10)
    return "<h1 style='color:blue'>Hello There!</h1>"

if __name__ == "__main__":
    app.run()
```


### Actual Behavior
<!-- Tell us what happens instead. -->



I have code as above. When I run two simultaneous requests on 127.0.0.1:5000 I get two answers together.
When I run it under uwsgi with single process I get each result after 10 seconds.

### Environment

* Python version: 3.6.9
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

The external_url_handler in the documentation for `flask.url_for`
example [1] now uses Python 3 compatible `E(V).with_traceback(T)`
instead of the old `raise E, V, T`.

[1]: https://flask.palletsprojects.com/en/1.1.x/api/#flask.url_for

See also
https://docs.python.org/3/library/2to3.html?highlight=raise#2to3fixer-raise
### Expected Behavior
Running a flask app from terminal command line

```python
flask run
```

### Actual Behavior
App doesn't start but instantly throws an error

```pytb
Traceback (most recent call last):
  File "/home/paul/PycharmProjects/APT/venv/bin/flask", line 8, in <module>
    sys.exit(main())
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/flask/cli.py", line 967, in main
    cli.main(args=sys.argv[1:], prog_name="python -m flask" if as_module else None)
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/flask/cli.py", line 586, in main
    return super(FlaskGroup, self).main(*args, **kwargs)
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/click/core.py", line 782, in main
    rv = self.invoke(ctx)
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/click/core.py", line 1254, in invoke
    cmd_name, cmd, args = self.resolve_command(ctx, args)
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/click/core.py", line 1297, in resolve_command
    cmd = self.get_command(ctx, cmd_name)
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/flask/cli.py", line 527, in get_command
    self._load_plugin_commands()
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/flask/cli.py", line 523, in _load_plugin_commands
    self.add_command(ep.load(), ep.name)
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/pkg_resources/__init__.py", line 2446, in load
    self.require(*args, **kwargs)
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/pkg_resources/__init__.py", line 2469, in require
    items = working_set.resolve(reqs, env, installer, extras=self.extras)
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/pkg_resources/__init__.py", line 775, in resolve
    raise VersionConflict(dist, req).with_context(dependent_req)
pkg_resources.VersionConflict: (Flask-Login 0.5.0 (/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages), Requirement.parse('Flask-Login<0.5,>=0.3'))
```

In line with the error traceback; downgrading to Flask-Login 0.4.1 solves the issue

### Environment

* Python version: 3.6.9
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

Just added a test for the `default` method in JSONEncoder, specifically for objects with `__html__` method.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

The guide shows how to create or migrate a Flask application using
Docker on Divio. It discusses using docker-compose.yml to create
a Dockerised development environment, environment variables for
configuration and a gateway server.
Previously, there was just a single issue template with "bug report" format. This was good for reporting bugs, but not so convenient for feature requests.

However, GitHub allows multiple issue templates and 'config.yml' file for configuring them. So I added new issue template for feature requests and links to Stack Overflow and Discord to issue reporting menu. Template for bug reports is mostly the same as the original template, and template for feature requests is based on default GitHub feature request template but modified a bit to be consistent with the original template. This will also automatically label issues either as 'bug' or as 'enhancement' depending on which template is chosen. Links to Stack Overflow and Discord were added in similar way as in Werkzeug and Jinja repositories.

It seems to me that it was necessary to specify the step of creating the hello.py file, because some newbie may be confused, even if the creation of the file is implicit

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
Flaskform should be imported.

```python
from flask_wtf import Flaskform
```

### Actual Behavior
Program cannot import Flaskform

```pytb
ImportError: cannot import name 'Flaskform' from 'flask_wtf'
```

### Environment

* Python version: 3.9
* Flask version: 1.1.2
* Werkzeug version: 1.0.1


To be consistent with the rest of documents.

In API doc, `route` function docstring states that
`methods is a list of methods this rule should be limited to (GET, POST etc.)`

Using list also avoid confusing when using a tuple of 1 element, when new
user tries to remove a method from ('GET', 'POST')
and removed the `,` would make it no longer a tuple.

In the page, there are mentions of Jinja2 tags (block start/end tag),
clarify here to avoid confusion.
The replacement is done by the library, link to the
python sqlite3 library document instead of a generic document
as different libraries use different placeholders.
cli.load_dotenv showed wrong message, when path to cli.load_dotenv provided,
now it show right message

make small refactor of this func
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

test code
`
#!/usr/bin/env python3

from flask import Flask

app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello, World!'

if __name__ == '__main__':
    print("Test Server\n")
    app.run(host='0.0.0.0', port=8000, debug=True, threaded=True, ssl_context=('server.crt', 'server.key'))
`

### Expected Behavior
<!-- Tell us what should happen. -->
if use the curl -L -k https:// remote address (not local or private address ) , all be fine.
if use the browser like MAC OS chrome safari firefox , or windows 10 ie , visit that link, the server site will stack, no error output, no exception , no traceback , no respons.
and if you use curl to visit again , you can't get any message by that action, looks server dead ?,i test many times . all the same result.

Paste the full traceback if there was an exception.



### Environment
Ubuntu 20.04.1 LTS
Linux 5.4.0-52-generic #57-Ubuntu SMP Thu Oct 15 10:57:00 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
Python 3.8.5
APScheduler==3.6.3
Flask==1.1.2
Flask-APScheduler==1.11.0
itsdangerous==1.1.0
python-dateutil==2.8.1
pytz==2020.1
tzlocal==2.1
Werkzeug==1.0.1

I noticed something about the market share of Internet Explorer and thought "that can't be true". After fixing that I also found out that Mark Pilgrim's book has been published, so I updated that as well.

### Expected Behavior
Normally, the "app.run()" should go back and open the web server with the port number 3000.

```python
from flask import Flask
app = Flask(__name__)

@app.route('/')
def index():
    return 'Hello Flask'

app.run(port=3000)
```

### Actual Behavior
Errors are occurring in "app.run()".
The same error occurs when using the debug tool in the visual studio code or the Python3 console window.


![Visual Studio Code traceback](https://user-images.githubusercontent.com/16767890/96731602-673d0e00-13f2-11eb-8e0f-93aada6e2285.png)
When using the debug tool in Visual Studio Code
![IDLE traceback](https://user-images.githubusercontent.com/16767890/96731788-99e70680-13f2-11eb-8621-4fefce6d519b.png)
When using the debug tool in IDLE

```pytb
Traceback (most recent call last):
  File "D:\Flask\start.py", line 8, in <module>
    app.run(port=3000)
  File "C:\Users\gunyu\AppData\Local\Programs\Python\Python38-32\lib\site-packages\flask\app.py", line 990, in run
    run_simple(host, port, self, **options)
  File "C:\Users\gunyu\AppData\Local\Programs\Python\Python38-32\lib\site-packages\werkzeug\serving.py", line 1052, in run_simple
    inner()
  File "C:\Users\gunyu\AppData\Local\Programs\Python\Python38-32\lib\site-packages\werkzeug\serving.py", line 996, in inner
    srv = make_server(
  File "C:\Users\gunyu\AppData\Local\Programs\Python\Python38-32\lib\site-packages\werkzeug\serving.py", line 847, in make_server
    return ThreadedWSGIServer(
  File "C:\Users\gunyu\AppData\Local\Programs\Python\Python38-32\lib\site-packages\werkzeug\serving.py", line 740, in __init__
    HTTPServer.__init__(self, server_address, handler)
  File "C:\Users\gunyu\AppData\Local\Programs\Python\Python38-32\lib\socketserver.py", line 452, in __init__
    self.server_bind()
  File "C:\Users\gunyu\AppData\Local\Programs\Python\Python38-32\lib\http\server.py", line 140, in server_bind
    self.server_name = socket.getfqdn(host)
  File "C:\Users\gunyu\AppData\Local\Programs\Python\Python38-32\lib\socket.py", line 756, in getfqdn
    hostname, aliases, ipaddrs = gethostbyaddr(name)
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xc0 in position 0: invalid start byte
```

### Environment

* Python version: v3.8.2
* Flask version: v1.1.2
* Werkzeug version: v1.0.1

Unsure whether to submit this issue to werkzeug or flask. This is kind of a long-winded issue. I can create a sample project on GitHub if required to replicated this behavior.

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->
When passing headers to Client.post in werkzeug/test.py, I expect the request.headers object that Flask receives to have the same exact keys that I pass.

`tests.conftest.py`
```
@pytest.fixture(scope='session', autouse=True)
def app():
    """Create and configure a new app instance for each test."""
    app = create_app(config='testing')
    yield app

@pytest.fixture
def client(app):
    """A test client for the app."""
    return app.test_client()
```
`tests/test_api.py`
```
headers = {
    "Content-Type": "application/json",
    "User-Agent": "GitHub-Hookshot/d88a271",
    "X-GitHub-Delivery": "c623de96-03f1-11eb-8e54-189e1c4a92e7",
    "X-GitHub-Enterprise-Host": "github.ibm.com",
    "X-GitHub-Event": "pull_request" ,
}
data = { 'foo': 'bar' }
def test_1(client):
    with patch('flaskr.tasks.process_pull_request.delay') as mock_task:
        rv = client.post('/api/webhooks', json=data, headers=headers)
```
`flaskr/__init__.py`
```

def create_app(config=os.environ.get('FLASK_ENV', 'default')):
    # create and configure the app
    app = Flask(__name__, instance_relative_config=True)
 
    from . import routes
    app.register_blueprint(routes.bp)

    return app
```
`flaskr/routes.py`
```
from flask import Blueprint, request, jsonify

from bulldozer.events import EventFactory
import flaskr.handler as handler

bp = Blueprint('routes', __name__, url_prefix='/')

@bp.route('/api/webhooks', methods=('GET', 'POST'))
def process_webhook():
    if request.method == 'POST':
        # assertion 1 passes
        assert 'X-GitHub-Event' in request.headers

        # assertion 2 fails because the key is 'Github-Event' with a lowercase 'h'
        assert 'X-GitHub-Event' in request.headers.keys
        return jsonify({})
```

### Actual Behavior
<!-- Tell us what happens instead. -->
For some strange reason, the werkzeug/test.py or flask/testing.py code is modifying the headers that are passed from my unit test. Instead of `X-GitHub-Event`, the Flask Request object has a `X-Github-Event` key (note the lowercase 'h').

I passed
```
 headers = {
    "Content-Type": "application/json",
    "User-Agent": "GitHub-Hookshot/d88a271",
    "X-GitHub-Delivery": "c623de96-03f1-11eb-8e54-189e1c4a92e7",
    "X-GitHub-Enterprise-Host": "github.ibm.com",
    "X-GitHub-Event": "pull_request" ,
}
```
but `request.headers` shows
```
headers = {
    "Content-Type": "application/json",
    "User-Agent": "GitHub-Hookshot/d88a271",
    "X-Github-Delivery": "c623de96-03f1-11eb-8e54-189e1c4a92e7",
    "X-Github-Enterprise-Host": "github.ibm.com",
    "X-Github-Event": "pull_request" ,
}
```


Why does the header I pass get displayed differently in the [EnvironHeaders](https://tedboy.github.io/flask/generated/generated/werkzeug.EnvironHeaders.html) object? 
```
$ python3 -m pytest tests/test_api::test1
venv/lib/python3.7/site-packages/flask/app.py:1936: in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    @bp.route('/api/webhooks', methods=('GET', 'POST'))
    def process_webhook():
        if request.method == 'POST':
            # assertion 1 passes
            print(request.headers)
            assert 'X-GitHub-Event' in request.headers
    
            # assertion 2 fails because the key is 'Github-Event' with a lowercase 'h'
            for k in request.headers.keys():
                print(k)
>           assert 'X-GitHub-Event' in request.headers.keys()
E           AssertionError

flaskr/routes.py:18: AssertionError
--------------------------------------------------- Captured stdout call ---------------------------------------------------
User-Agent: GitHub-Hookshot/d88a271
Host: localhost
Content-Type: application/json
Content-Length: 23427
X-Github-Delivery: c623de96-03f1-11eb-8e54-189e1c4a92e7
X-Github-Enterprise-Host: github.ibm.com
X-Github-Event: pull_request


User-Agent
Host
Content-Type
Content-Length
X-Github-Delivery
X-Github-Enterprise-Host
X-Github-Event
```

### Environment

* Python version: 3.7.7
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

Small fixes, noting to add in changes
I have removed outdated paragraphs and just left the link to the page stating the current status of python 3 in Flask. 
#1578


changes configuration for tox and travis. Assist from @davidism 

As @ThiefMaster pointed out in PR #1862, template globals can be added without subclassing. Here is a different use-case, inspired by [recent IRC conversations](https://botbot.me/freenode/pocoo/2016-05-30/?msg=66949866&page=2).

Remove "versionadded" and "versionchanged" tags < 0.10. Discussed in #1704.
#801

The simplest way to accomplish this was to bring in a modified version of the wrapper found here:
https://github.com/miguelgrinberg/flack/blob/master/flack/utils.py#L11

This wrapper also needed to cover the case where an application context existed with `SERVER_NAME` defined. 

I added two tests (one to cover when `SERVER_NAME` doesn't exist, and one when it does). The removal of `test_url_generation_requires_server_name` is because the error case it covered no longer exists.

Reverts pallets/flask#1855

@mitsuhiko 

Fix for: #1847 

Adds the current directory to the Python path, when invoking a local development server.  `flask run` was unable to find the app's module in the PYTHONPATH, while `python -m flask run` adds the current working directory to the PYTHONPATH automatically.

Wrote up a basic example of subclassing Flask to set up an altered Jinja2 environment. This should fix issue #221

Adds a little documentation of the Runtime Error that you get when working outside an applications context.

fix #1521

Made tests in tests_basic.py

Enhancement: Add last_modified arg of type DateTime to send_file.

Fixes pallets/flask#1321

Updated for issue #721 

Debugger docs, response objects and url converters. Aims to fix #1625 and fix #190.

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/1857)

<!-- Reviewable:end -->

Removed the versionadded and versionchanged tags except for the one linked from external docs. Created issue #1852 to remove those tags from external docs.

Adds one test specifically for a simplejson bug.

…pointing users towards extensions registry

Not a huge change, but hopefully makes it clear that plain text is dangerous and puts people on the right path to implement password hashing if they choose

fix #836 

On issue #1773, we wanted use issue templates to accomplish two things:
1. guide questions into StackOverflow and IRC channel
2. not duplicate CONTRIBUTING content
To resolve these, ISSUE_TEMPLATE is added to remind users not
to ask questions, and mark prerequisites.

The following version information is coming from the Werkzeug docs: "New in version 0.6: The location can now be a unicode string that is encoded using the iri_to_uri() function." See http://flask.pocoo.org/docs/0.11/api/#flask.redirect.

There might be more of this kind of issue in the documentation. For this particular one, you can trace the code to docs/api.rst,: 

```
.. autofunction:: redirect
```

Reason: Messages of size 68,493 - 91,326 characters cause flash to fail silently.
Session cookies cannot have such large messages.

Issue: pallets/flask#1789

ref #313


re #1828 

Example project that shows issue is available here: https://github.com/sean-lynch/flask-cli-issue . I'm not sure if this is a flask cli issue or an issue with documentation. Happy to correct the docs if it's the latter.

I'm attempting to use the large app structure seen in the [Flask Larger Applications documentation](http://flask.pocoo.org/docs/0.11/patterns/packages/)

First, set up a virutal environment and install flask 0.11 into that environment (requirements.txt
has all that for you).

Can successfully launch app using old `app.run()` mechanism found in `run.py` and `old_launch.sh`

```
$ python run.py
```

But can't seem to get to work with flask-cli. You can see both of the methods in `new_launch.sh`.

This throws `ImportError - No module named server`:

```
$ FLASK_APP=server FLASK_DEBUG=1 flask run
```

This loads, but doesn't register any of the views even though the `Loading views...` print output makes it to the console.

```
$ FLASK_APP=server/__init__.py FLASK_DEBUG=1 flask run
```

How should I be loading a module with flask-cli? Or alternatively, how should I be changing the module structure to support it properly?

https://github.com/pallets/flask/issues/1602#issuecomment-154127373

Should add tox envs for testing `flask.json` with simplejson installed.  Possibly add this to the travis matrix.

Would like to be able to use iPython instead of the default Python shell when running 'flask shell'.

I'm trying to write a unittest for a custom middleware layer in my app and I'm having difficulty getting the middleware to execute inside a test request context. Here's a simple script that illustrates the problem:

``` python
from flask import Flask, url_for

class Middleware(object):
    def __init__(self, app):
        print ' - initialized middleware'
        self.app = app

    def __call__(self, environ, start_response):
        print ' - executed middleware'
        return self.app(environ, start_response)

# create app
app = Flask(__name__)

# add middleware
app.wsgi_app = Middleware(app.wsgi_app)

# add route
@app.route('/')
def index():
    return 'index'

# test GET                                                                      
print '\nTesting GET...'
resp = app.test_client().get('/')
print ' - Response: ' + resp.data

# test context                                                                  
print '\nTesting request context...'
with app.test_request_context('/'):
    app.preprocess_request()
    ret = app.dispatch_request()
    resp = app.make_response(ret)
    resp = app.process_response(resp)
    print ' - Response: ' + resp.data
```

The middleware executes inside the test client GET request but not inside the test request context. Here's the output:

``` bash
$ python test.py
 - initialized middleware

Testing GET...
 - executed middleware
 - Response: index

Testing request context...
 - Response: index
```

Am I doing something wrong or is this the intentional behavior inside a test request context? I'm using Flask 0.11 and Werkzeug 0.11.10.

Thanks for your help!

re #266

For the latest CLI feature (Thanks a lot for that BTW), to run a app, we currently do:

```
$ export FLASK_APP=/path/to/hello.py
$ export FLASK_DEBUG=1
$ flask run
```

Wouldn't it be nice, if app and debug variables could also be passed as arguments, That way, we can also do

```
$ flask --app=/path/to/hello.py --debug run
```

I as a user would prefer the first option in a production environment, but for development, the second option (CLI arguments) would be much comfortable.

What do you guys think about this ?

I believe this is behind the reason behind recent Travis-CI failures in flask-restplus pull requests; at the very least, this is obscuring the real error. For example, see https://travis-ci.org/noirbizarre/flask-restplus/jobs/134224010

some simple changes towards py3

I hope that the future import is allowed here. It is already used elsewhere in the code of flask.



The following code:

```
flask_app.errorhandler(402)(http_exception_handler)
```

raises `KeyError: 402` due to missing 402 in default exception. Code works fine with Flask=0.10.1

It should be very useful to warning which files have deprecated imports

While trying to package 0.11 on Gentoo Linux, I've run into the following test failure:

```
============================================= FAILURES =============================================
_____________________________________ test_egg_installed_paths _____________________________________

install_egg = <function inner at 0x7f5eebfa9668>
modules_tmpdir = local('/var/tmp/portage/dev-python/flask-0.11/temp/pytest-of-portage/pytest-0/test_egg_installed_paths0/modules_tmpdir')
modules_tmpdir_prefix = local('/var/tmp/portage/dev-python/flask-0.11/temp/pytest-of-portage/pytest-0/test_egg_installed_paths0/modules_tmpdir')

    def test_egg_installed_paths(install_egg, modules_tmpdir,
                                 modules_tmpdir_prefix):
        modules_tmpdir.mkdir('site_egg').join('__init__.py').write(
            'import flask\n\napp = flask.Flask(__name__)'
        )
>       install_egg('site_egg')

tests/test_instance_config.py:111: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/conftest.py:116: in inner
    egg_path, = modules_tmpdir.join('dist/').listdir()
/usr/lib64/python2.7/site-packages/py/_path/local.py:379: in listdir
    names = py.error.checked_call(os.listdir, self.strpath)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <py._error.ErrorMaker object at 0x7f5eee4382d0>, func = <built-in function listdir>
args = ('/var/tmp/portage/dev-python/flask-0.11/temp/pytest-of-portage/pytest-0/test_egg_installed_paths0/modules_tmpdir/dist',)
kwargs = {}, __tracebackhide__ = False, cls = <class 'py.error.ENOENT'>
value = OSError(2, 'No such file or directory'), tb = <traceback object at 0x7f5eebfa6c68>
errno = 2

    def checked_call(self, func, *args, **kwargs):
        """ call a function and raise an errno-exception if applicable. """
        __tracebackhide__ = True
        try:
            return func(*args, **kwargs)
        except self.Error:
            raise
        except (OSError, EnvironmentError):
            cls, value, tb = sys.exc_info()
            if not hasattr(value, 'errno'):
                raise
            __tracebackhide__ = False
            errno = value.errno
            try:
                if not isinstance(value, WindowsError):
                    raise NameError
            except NameError:
                # we are not on Windows, or we got a proper OSError
                cls = self._geterrnoclass(errno)
            else:
                try:
                    cls = self._geterrnoclass(_winerrnomap[errno])
                except KeyError:
                    raise value
>           raise cls("%s%r" % (func.__name__, args))
E           ENOENT: [No such file or directory]: listdir('/var/tmp/portage/dev-python/flask-0.11/temp/pytest-of-portage/pytest-0/test_egg_installed_paths0/modules_tmpdir/dist',)

/usr/lib64/python2.7/site-packages/py/_error.py:84: ENOENT
```

Also note that it's pretty unclear that you now require py.test for test running, might want to add that as an explicit dependency somehow.


Using the officially documented, shortcut package path of the `Config` class instead of the actual one.

The code is like this

```
from flask import Flask, Blueprint, url_for

app = Flask(__name__)
app.config['SERVER_NAME'] = 'localhost:5000'
app.url_map.default_subdomain = 'forums'

forums = Blueprint('forums', __name__)


@forums.route('/')
def forums_index():
    print(url_for('static', filename='index.css'))
    return 'forums,hello'

docs = Blueprint('docs', __name__)


@docs.route('/')
def docs_index():
    return 'docs,hello'


app.register_blueprint(forums)
app.register_blueprint(docs, subdomain='docs')


@app.route('/hello')
def index():
    return 'index,hello'


if __name__ == '__main__':
    app.run(debug=True)
    print(app.url_map) 
```

The all url

```
([<Rule 'forums|/hello' (GET, OPTIONS, HEAD) -> index>,
 <Rule 'forums|/' (GET, OPTIONS, HEAD) -> forums.forums_index>,
 <Rule 'docs|/' (GET, OPTIONS, HEAD) -> docs.docs_index>,
 <Rule '/static/<filename>' (GET, OPTIONS, HEAD) -> static>])
```

The static url

```
url_for('static', filename='index.css')
```

will return `http://localhost:5000/static/index.css` not `http://forums.localhost:5000/static/index.css`

I think I have set 
`app.url_map.default_subdomain = 'forums'`
the all default url is `forums.localhost:5000` not `localhost:5000`

Though I can add

```
    app.url_map._rules.clear()
    app.url_map._rules_by_endpoint.clear()
    app.url_map.default_subdomain = 'forums'
    app.config['SERVER_NAME'] = 'localhost:5000'
    app.add_url_rule(app.static_url_path + '/<path:filename>',
                                      endpoint='static',
                                      view_func=app.send_static_file,
                                      subdomain='forums')

```

to solve it,is it a bug with flask?
(python3 and Werkzeug (0.11.10))

When raising a DeprecationWarning, show the line in the application code
which caused the warning, rather than the line in Flask

e.g. a file `app.py` with:

``` python
from flask import Flask
from flask.ext.babel import Babel
```

will show:

```
app.py:2: ExtDeprecationWarning: Importing flask.ext.babel is
deprecated, use flask_babel instead.
```

instead of:

```
/home/mapleoin/venv/local/lib/python2.7/site-packages/flask/exthook.py:71: ExtDeprecationWarning: Importing flask.ext.babel is deprecated, use flask_babel instead.
  .format(x=modname), ExtDeprecationWarning
```

When running `flask --help`, the printed string contains this:

>   Example usage:
> 
>   set FLASK_APP=hello
>    set FLASK_DEBUG=1
>    flask run

but it actually only works with `set FLASK_APP=hello.py` so the help should be changed.

This is true on my Windows 7 Python 3.5 flask 0.11 setup.

I get the following `[Errno 2] No such file or directory` with **flask 0.11** & werkzeug 0.11.10 on Windows 7 64bit with Python 3.5 but only when `FLASK_DEBUG=1`. 

``` sh
D:\tmp
λ python --version
Python 3.5.1 :: Continuum Analytics, Inc.

D:\tmp
λ python -c "import hello_flask"

D:\tmp
λ set FLASK_APP=hello_flask.py

D:\tmp
λ flask run
 * Serving Flask app "hello_flask"
 * Forcing debug mode off
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)

D:\tmp
λ set FLASK_DEBUG=1

D:\tmp
λ flask run
 * Serving Flask app "hello_flask"
 * Forcing debug mode on
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with windowsapi reloader
d:\anaconda3\envs\flask\python.exe: can't open file 'D:\Anaconda3\envs\flask\Scripts\flask': [Errno 2] No such file or directory
```

`hello_flask.py` is the minimal app from the [docs](http://flask.pocoo.org/docs/0.11/quickstart/#a-minimal-application).

The `flask` CLI utility that ships with Flask 0.11 does not respond to the `--version` flag. I would expect the following output:

``` bash
$ flask --version
Flask 0.11
Python 3.5.1
```

Instead I get the following output:

``` bash
$ flask --version
Error: no such option: --version
```

As per their email ‘Changes to project subdomains’:

> Starting today, Read the Docs will start hosting projects from subdomains on the domain readthedocs.io, instead of on readthedocs.org. This change addresses some security concerns around site cookies while hosting user generated data on the same domain as our dashboard.

Test Plan: Manually visited all the links I’ve modified.

The `hello.py` script in quickstart is different from the one on the homepage. Therefore, it cannot be run with `python hello.py`, which conflicts with the next paragraph in quickstart.

Since updating from Flask 0.10.1 to 0.11.0, when trying to request `/response-headers` using [httpbin](https://github.com/Runscope/httpbin) I get:

```
[...] ERROR in app: Exception on /response-headers [GET]
Traceback (most recent call last):
  File ".../site-packages/flask/app.py", line 1988, in wsgi_app
    response = self.full_dispatch_request()
  File ".../site-packages/flask/app.py", line 1641, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File ".../site-packages/flask/app.py", line 1544, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File ".../site-packages/flask/_compat.py", line 33, in reraise
    raise value
  File ".../site-packages/flask/app.py", line 1639, in full_dispatch_request
    rv = self.dispatch_request()
  File ".../site-packages/flask/app.py", line 1625, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File ".../site-packages/httpbin/core.py", line 314, in response_headers
    response = jsonify(headers.lists())
  File ".../site-packages/httpbin/core.py", line 40, in jsonify
    response = flask_jsonify(*args, **kwargs)
  File ".../site-packages/flask/json.py", line 266, in jsonify
    (dumps(data, indent=indent, separators=separators), '\n'),
  File ".../site-packages/flask/json.py", line 126, in dumps
    rv = _json.dumps(obj, **kwargs)
  File ".../json/__init__.py", line 237, in dumps
    **kw).encode(obj)
  File ".../json/encoder.py", line 201, in encode
    chunks = list(chunks)
  File ".../json/encoder.py", line 436, in _iterencode
    o = _default(o)
  File ".../site-packages/flask/json.py", line 83, in default
    return _json.JSONEncoder.default(self, o)
  File ".../json/encoder.py", line 180, in default
    raise TypeError(repr(o) + " is not JSON serializable")
TypeError: <generator object MultiDict.lists at ...> is not JSON serializable
```

This is on Python 3.5 with httpbin 0.4.1

Of all Undefined variants, it comes closest to "Explicit is better than implicit" and "Errors should never pass silently".

I'm not sure it's worth changing in Jinja2 because of backward compatibility requirements, but Flask 1.0 seems like a reasonable point where behavior changes are expected anyway.


Exceptions during teardown handling will no longer leave application
contexts lingering around.  This fixes #1767

This fixes #1776

This requires some explanation because it's potentially a controversial change.  We used to have `flask --app foo` support but this pull request essentially removes it.

Why are we doing this? Turns out there is a fundamental problem with how Click currently handles certain aspects and the feature that made `--app` work will have to change in Click. As a direct result of this we have to temporarily pretend we never had an intention to make that flag work.  I understand it's not a nice thing to do but I think in the grand scheme of things this is a good way to get a release out which is really something that needs to happen.

I might want to bring this back later but this will require some major changes in Click which I rather not do at the same time as a Flask release.

In the process of this I also intentionally underdocument some APIs which I'm not super happy about. This should encourage people to not go all in with the cli for now.

The tracking issue for that is https://github.com/pallets/click/issues/590


change string to docstring

There are a few `versionadded::` markers that point to 1.0 - those should be changed to 0.11 for that release.

I think there shouldn't be reference to future (not released) versions in current docs, it's very confusing.

http://flask.pocoo.org/docs/0.10/server/

> Starting with Flask 1.0 there are multiple built-in ways to run a development server. 

Also http://flask.pocoo.org/docs/0.10/cli/#cli link is broken.

As is shown in https://github.com/pallets/flask/issues/1361, there is a desire for easy separation of templates for different blueprints. 

Currently it is not possible to assign a separate sub directory to be used for a specific blueprint. All templates are searched relatively to the root template directory. Although it seems that the `template_folder` Blueprint argument would have this meaning this is not actually the case. 
This argument will only add the `template_folder` as one of the directories to search in. 

With this change a template passed to `render_template` can be prefixed with `./` to indicate that it should not search in the root template directory, but in a subdirectory of it with the name of the blueprint.

Refs #1792

This fixes #1596

as my very modest contribution towards python3

Added to docstring for Flask.register_blueprint to clarify kwargs.  Was unsure of the conventions for using :ref: but figured this fit, please let me know if there's a better way to do that.

`X-Accel-Redirect` is very much alike Apache's `XSendfile` it instead however needs a `URI` pointing to the file than an absolute path. This is a tricky problem to solve and there  have been discussions on implementing a `nginx_sendfile` method, this however is disastrous since in development machines `nginx_sendfile` won't send the file since it is on a default flask server, thus every time the developer wishes to test an app on his own machine, it is required to change all `nginx_sendfile` calls to normal `flask.send_file` calls manually changing url's and such.

How is this patch different? As seen below in the test app simply set the config  `USE_X_ACCEL` to true and then when calling `send_file` set the `x_accel_uri` parameter to the internal `uri` configured in your nginx config. And when testing simply keep `USE_X_ACCEL` at the default value `False`, this will make `send_file` ignore the `x_accel_uri` even if it is set. :smile: 
## A test app:

```
from flask import Flask, send_file

app = Flask(__name__)
app.use_x_accel = True  
# app.config['USE_X_ACCEL'] = True

@app.route('/dl')
def download():
        return send_file('files/1GB.zip', as_attachment=True, x_accel_uri='/protected/')

app.run(debug=True, port=8080)
```
## For the following nginx config:

```
server {
        listen 80;

        location / {
                proxy_pass http://localhost:8080/;
        }

        location /protected {
                internal;
                alias /home/test/files;
        }
}
```
### Headers retrieved using `Curl`:

```
deelaka@deelaka-Lap:~$ curl -I your.server.ip/dl
HTTP/1.1 200 OK
Server: nginx/1.4.6 (Ubuntu)
Date: Sun, 15 May 2016 08:42:49 GMT
Content-Type: application/zip
Content-Length: 1073741824
Last-Modified: Sat, 14 May 2016 16:51:22 GMT
Connection: keep-alive
Content-Disposition: attachment; filename=1GB.zip
Cache-Control: public, max-age=43200
Expires: Sun, 15 May 2016 20:42:49 GMT
ETag: "5737578a-40000000"
Accept-Ranges: bytes

```

http://flask.pocoo.org/docs/0.10/api/#flask.Flask.register_blueprint

The documentation doesn't list or explain any of the arguments used by `flask.Flask.register_blueprint`.

It only says:

```
register_blueprint(*args, **kwargs)¶
Registers a blueprint on the application.

New in version 0.7.
```

For one, I know there should be at least `use_prefix` and maybe (or surely) more than that.

**Note:** All Flask version's documentation seems to be affected by this.

The signing of session-cookies works fine on development computer. But when moving the software to an embedded device, ARM71, 32 bit the derive_key() occasionally fail and returns an invalid key. Making the cookie invalid.

It is actually the hmac that returns invalid hashed string, but this only happens when running the flask application. 

```
def derive_key(self):
    """This method is called to derive the key.  If you're unhappy with
    the default key derivation choices you can override them here.
    Keep in mind that the key derivation in itsdangerous is not intended
    to be used as a security method to make a complex key out of a short
    password.  Instead you should use large random secret keys.
    """
    salt = want_bytes(self.salt)
    if self.key_derivation == 'concat':
        return self.digest_method(salt + self.secret_key).digest()
    elif self.key_derivation == 'django-concat':
        return self.digest_method(salt + b'signer' +
            self.secret_key).digest()
    elif self.key_derivation == 'hmac':
        mac = hmac.new(self.secret_key, digestmod=self.digest_method) ##### 1
        print(binascii.hexlify(mac.digest()))
        mac.update(salt)               ##### 2
        print(binascii.hexlify(mac.digest()))
        return mac.digest()
    elif self.key_derivation == 'none':
        return self.secret_key
    else:
        raise TypeError('Unknown key derivation method')
```

secret_key = b"testing"
salt = "cookie-session"

After #####1, binascii.hexlify(mac.digest()) = b'6ab6fc891eefd3b78743ea28b1803811561a7c9b'
After #####2, binascii.hexlify(mac.digest()) = b'd58bd52b4ced54374ea5baca0b6aa52b0e03af74'

But sometimes (1) above return  b'9dac0c533fcca6cb787aa332d8f152ffb7e6b960'
and (2) does not change when adding salt:  b'9dac0c533fcca6cb787aa332d8f152ffb7e6b960'

Been trying to solve this for a couple of days without success. Any ideas?

is it possible to stop flask outside request context ? as i know there's no way for it .

maybe a function( stop() ) that changes a flag( shutdown_signal=False ==> True ) for werkzeug that stops server for listening on new connections ?
i can contribute on making this feature if you allow me ...

To clarify, looking at the [signature of the click's Group class](https://github.com/pallets/click/blob/6.6/click/core.py#L1135-L1138) I found that passing the whole Flask app isn't what it expects, but just a command group name.

For this example I use ZeroMQ but I suppose any socket library could do. This is the code

```
#!/usr/bin/env python
import zmq
from flask import Flask

app = Flask(__name__)

context = zmq.Context()
socket = context.socket(zmq.REP)
socket.bind('tcp://*:5500')

app.debug = True  # Commenting this line does the trick
app.run()
```

As when using DEBUG process is fork()ed, the code tries to bind twice. Obviously, Flask knows how to open the port only once, so I'm wondering how to do the same for functions that bind()?

I am getting this error while running my web app. I am reading config values from json by doing this : 
`app.config.from_json('config.json')`

I am getting this error while running my web app. I am reading config values from json by doing this : 
`app.config.from_json('config.json')`

I learn from [Larger Applications](http://flask.pocoo.org/docs/0.10/patterns/packages/).In this document, It says: "all the view functions (the ones with a route() decorator on top) have to be imported in the **init**.py file. **Not the object itself, but the module it is in.**"  
I don't know why when I do this: `from . import views`,It succeed.Though `from views import *` can also work well.  
I organize these file like this:

```
myapplication/
  runner.py
  myflask/
    __init__.py
    views.py
    templates/
    static/
    ...
```

runner.py:

```
from testFlask import app
app.run()
```

myflask/__init__.py:

```
from flask import Flask
app = Flask(__name__)
from . import views # why this can work????
```

myflask/views.py:

```
from . import app
@app.route('/')
def index():
    return 'Hello World!'
```

and I run it:

```
$ cd myapplication
$ python runner.py
```

It's OK to run this Flask app. However I want to know why `from . import views` can solve this **circle import** problem in flask? And why the doc says: **Not the object itself, but the module it is in**????

`with` statement isn't properly formatted in reST in two sections in the `flask.testing.FlaskClient` documentation.

When using Flask as privileged user, it may under circumstances not be possible to drop permissions before the app is run, including when using ports that do not require root privileges.

```
drop_privileges() # drop privileges to nobody
app.run()
```

The above code will throw an `ImportError`, given the scenario that Flask's python files are not accessible to the nobody user due to file permissions, because Flask's `run`-method (and other internal methods) make use of additional inline imports.

As this scenario might be more common, it may be desirable to move all inline imports to the top of their respective module.

There are various other reasons that might support the request to move imports to the top of modules: See [Python import coding style](https://stackoverflow.com/questions/477096).

I've been trying to stream some data out of the database into a downloadable CSV file and having trouble at every turn.  I've been following what guides I can find.  Response() gives errors and setting headers on make_response() fails to produce a response the browser recognizes as savable (even with `response.headers["Content-Disposition"] = "attachment;filename=study.csv"` ).  I've never gone this direction with data extractions so I can't say I know what to expect with HTTP.

Anyhow, here are the messages from attempts to use Response:

```
   return Response(generate(), mimetype='text/csv')
TypeError: __init__() takes 1 positional argument but 2 were given

    return Response(generate())
TypeError: __init__() takes 1 positional argument but 2 were given

    return Response("1,2,3")
TypeError: __init__() takes 1 positional argument but 2 were given
```


A flag to deal with file-like object while keeping the `.name` and `.filename` properties.

When you have a form and do the following action

``` python
def doaction:
     on POST 
          # dostuff
          return render_template('myform.html', success=1)

     on GET 
          # dostuff
          return render_template('myform.html', success=2)
```

You render the page, fill in the form and submit it. It returns the same template with a message : 'its ok'. If you are on the past rendered after the post, you do a browser refresh, you paste again.

This does not seem normal to me, or should we just include a hidden input alreadysubmitted or something, or redirect to another page

This PR fixes some documentation issues that were missed in #1588:
- fixes to `distribute.rst`:
  - replace leftover occurences of "distribute" with "setuptools"
  - fix minor grammatical errors

While doing some tests decoding some huge json objects, I am observing a very slow decoding behavior. Actually, it takes a lot of time to execute request.json the first time.

What's the default json decoder for flask? Does it use some C optimized code?

The loading of template tried too much times(count of blueprints), after setting with EXPLAIN_TEMPLATE_LOADING config. 

Maybe **Blueprint.render_template**  is more effective.
1.  In huge application, there are too much Blueprints, the performance is important.
2.  An independent  module should always use independent template and Blueprint. Just like below in a view.py

``` python
mod = Blueprint('standalone', __name__, url_prefix='/evil', \
  template_folder='standalone/templates', \
  static_folder='standalone/static')

@mod.route('/')
def index():
    # add a function into Blueprint
    return mod.render_template('index.html')
```

This issue is related to PR #912.

```
============================= test session starts ==============================
platform linux2 -- Python 2.6.6, pytest-2.9.1, py-1.4.31, pluggy-0.3.1
rootdir: /src, inifile: setup.cfg
collected 459 items

tests/test_compat.py ..
tests/test_datastructures.py .............................................s..
tests/test_debug.py .................ss
tests/test_exceptions.py ......................
tests/test_formparser.py ...................
tests/test_http.py .................................
tests/test_internal.py ...
tests/test_local.py .........
tests/test_routing.py ..................................................
tests/test_security.py ....
tests/test_serving.py sssssssssFs
tests/test_test.py ...................................
tests/test_urls.py .........................................
tests/test_utils.py ...................
tests/test_wrappers.py ...................................................
tests/test_wsgi.py .......................
tests/contrib/test_atom.py .
tests/contrib/test_cache.py ...............................ssssssssssssss
tests/contrib/test_fixers.py .......
tests/contrib/test_iterio.py ....ss
tests/contrib/test_securecookie.py ..
tests/contrib/test_sessions.py .....
tests/contrib/test_wrappers.py ...
tests/res/test.txt s

=================================== FAILURES ===================================
___________________________ test_monkeypached_sleep ____________________________

tmpdir = local('/tmp/pytest-of-root/pytest-0/test_monkeypached_sleep0')

    def test_monkeypached_sleep(tmpdir):
        # removing the staticmethod wrapper in the definition of
        # ReloaderLoop._sleep works most of the time, since `sleep` is a c
        # function, and unlike python functions which are descriptors, doesn't
        # become a method when attached to a class. however, if the user has called
        # `eventlet.monkey_patch` before importing `_reloader`, `time.sleep` is a
        # python function, and subsequently calling `ReloaderLoop._sleep` fails
        # with a TypeError. This test checks that _sleep is attached correctly.
        script = tmpdir.mkdir('app').join('test.py')
        script.write(textwrap.dedent('''
        import time

        def sleep(secs):
            pass

        # simulate eventlet.monkey_patch by replacing the builtin sleep
        # with a regular function before _reloader is imported
        time.sleep = sleep

        from werkzeug._reloader import ReloaderLoop
        ReloaderLoop()._sleep(0)
        '''))
>       subprocess.check_call(['python', str(script)])

tests/test_serving.py:233: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

popenargs = (['python', '/tmp/pytest-of-root/pytest-0/test_monkeypached_sleep0/app/test.py'],)
kwargs = {}, retcode = 1
cmd = ['python', '/tmp/pytest-of-root/pytest-0/test_monkeypached_sleep0/app/test.py']

    def check_call(*popenargs, **kwargs):
        """Run command with arguments.  Wait for command to complete.  If
        the exit code was zero then return, otherwise raise
        CalledProcessError.  The CalledProcessError object will have the
        return code in the returncode attribute.

        The arguments are the same as for the Popen constructor.  Example:

        check_call(["ls", "-l"])
        """
        retcode = call(*popenargs, **kwargs)
        cmd = kwargs.get("args")
        if cmd is None:
            cmd = popenargs[0]
        if retcode:
>           raise CalledProcessError(retcode, cmd)
E           CalledProcessError: Command '['python', '/tmp/pytest-of-root/pytest-0/test_monkeypached_sleep0/app/test.py']' returned non-zero exit status 1

/usr/lib64/python2.6/subprocess.py:505: CalledProcessError
----------------------------- Captured stderr call -----------------------------
Traceback (most recent call last):
  File "/tmp/pytest-of-root/pytest-0/test_monkeypached_sleep0/app/test.py", line 11, in <module>
    from werkzeug._reloader import ReloaderLoop
ImportError: No module named werkzeug._reloader
=============== 1 failed, 428 passed, 30 skipped in 3.57 seconds ===============
```

Branch: 0.10
Example - flaskr
Description: Every time close and reopen the flaskr.py, the data submitted previously are erased.

I think problem is 

```
if __name__ == '__main__':
    init_db() 
    app.run()
```

An error is occurring when I try to flash a message with too many characters. In my case, that number is 91,326.

```
if authority == True:
    rows = validate_rows(import_data, data_context)
    erroneous_rows = rows['erroneous_rows']

    if len(erroneous_rows) > 0:
        erroneous_row_string = ''
        i = 1

        # - DEBUGGING
        flash(2)

        for erroneous_row in erroneous_rows:
            erroneous_row_string += '<span style="text-decoration: underline">Row ' + str(i) + ': ' + \
                str(erroneous_row['errors']) + '</span><br/>' + str(erroneous_row['row_data']) + '<br/><br/>'
            i += 1
        erroneous_row_string = erroneous_row_string[:-1]

        # - DEBUGGING
        # flash(erroneous_row_string) <--- If I do this, it appears to 'crash' flash(), and no messages will appear.
        flash(isinstance(erroneous_row_string, str))
        flash(len(erroneous_row_string))
        flash(3)`
```

When the above is executed, I get the screen below.
![error1](https://cloud.githubusercontent.com/assets/13045020/14771460/300ecdb0-0a51-11e6-8307-0ba35a68a7bf.png)

If I were to do `flash(erroneous_row_string)` instead of `flash(len(erroneous_row_string)`, no flashed messages will appear at all. Assuming that this is because there is an upper limit to # of characters a flash message can have.

This makes sense, but it would be nice to return a non-silent error, I think.

I was curious and tried to give flask a try. But it goes wrong from the start. 

```
$ python hello.py
python: can't open file 'hello.py': [Errno 2] No such file or directory

pi@raspberrypi ~/relaxbank $ find . -name 'hello.py'
pi@raspberrypi ~/relaxbank $
```

Hi,

I wonder where I should keep the persistent db connection throughout the application, not the request/response context. I read the doc and examples, it looks to me, the persistent connections are made for the request/response life cycle.

People recommend to use a connection pool. Then where should I keep the pool? I use cassandra database. The cluster session does a lot heavy lifting, and automatically manage pool connections. It is nice that user need not worry about the pool management, but it is also expensive, and I should keep it alive on the server throughout the life time of the thread.

For a single thread flask server, it is easy, I just initialize the connection, and put it in the global namespace. But somehow it does not work when I use gunicorn to pre-fork the workers. The session does not respond at all.

So the question comes back to whether flask can manage a "long live context" to store the object? My work around is to put the db setups in a function decorated by "before_first_request". It works pretty well, but I consider as a work around, instead of official solutions.

Regards,
Chuan 

hi, we find a strange error, sometime  request.get_json(force=True) will fail.
And,  https://github.com/pallets/flask/blob/c9b29f4072b66be4c751af060d64ea749c6991c1/flask/wrappers.py#L151
data here is http header in string instead of http body!!

Hi all,

Recently I developed an app with blueprint and the g object. However the g object gets 'reset' between blueprints. Any idea how to solve it?

Yicong

If cookie has no domain attribute, it is valid only for the exact domain to which the request that sets the cookie is addressed, this is often a desirable behavior. A domain attribute makes the cookie also valid for all sub-domains of the specified domain.

Looking at https://github.com/pallets/flask/blob/c9b29f4072b66be4c751af060d64ea749c6991c1/flask/sessions.py#L198 if `SERVER_NAME` is set, a cookie will always have a domain attribute (either explicitly set via `SESSION_COOKIE_DOMAIN` or inferred from the `SERVER_NAME`).

Would it be possible to allow setting cookies without a domain  when `SERVER_NAME` is set?

I have found an issue that is caused by the automatic redirect of routes to the version with a "/" at the end. See the code below for a minimal example:

``` python
from flask import Flask
app = Flask(__name__)


@app.route("/a/", methods=["GET"])
def hello():
    return "Hello GET!\n"


@app.route("/a", methods=["POST"])
def hello_post():
    return "Hello POST!\n"

if __name__ == "__main__":
    app.run()

```

The POST route is unreachable as the "/" redirect is done without looking at the method. See the following curl commands (the `-L` flag is to follow redirects):

``` bash
$ curl localhost:5000/a/
Hello GET!

$ curl localhost:5000/a
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<title>Redirecting...</title>
<h1>Redirecting...</h1>
<p>You should be redirected automatically to target URL: <a href="http://localhost:5000/a/">http://localhost:5000/a/</a>.  If not click the link.

$ curl localhost:5000/a -L
Hello GET!

$ curl localhost:5000/a -X POST
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<title>Redirecting...</title>
<h1>Redirecting...</h1>
<p>You should be redirected automatically to target URL: <a href="http://localhost:5000/a/">http://localhost:5000/a/</a>.  If not click the link.

$ curl localhost:5000/a/ -X POST
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<title>405 Method Not Allowed</title>
<h1>Method Not Allowed</h1>
<p>The method is not allowed for the requested URL.</p>

$ curl localhost:5000/a -X POST -L
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<title>405 Method Not Allowed</title>
<h1>Method Not Allowed</h1>
<p>The method is not allowed for the requested URL.</p>
```

Edit: My python version is Python3.4 and Werkzeug is 0.11.8 but it was also possible with the git version of Werkzeug.

I use `send_file()` function for serving file-like objects from GridFS. However, if the file-like object obtained from the GridFS has assigned a file name, the `send_file()` function tries to get the file from the file system and I get a "File not found"-like error. It should serve the data from the file-like object directly and not to try to find the file on the file system (even when there is a file name assigned to the file-like object). Or am I missing something?

I did a minor rewording of the docstring for `request.get_json()`. The current documentation is misleading, by having a mention of `on_json_loading_failed` followed by a sentence that references "this function", without clearly stating if the reference is to `get_json` or `on_json_loading_failed`.

The description reads much better in my opinion, after I moved the `on_json_loading_failed` sentence to the end.

I am hoping to create two types of logs:
- `access.log`: lists all requests made on the flask application
- `error.log`: lists all warnings, and errors made within the flask application

Currently, I have defined [`app.py`](https://github.com/jeff1evesque/machine-learning/blob/9b53741fadae3d8f6cbf72ce76f0086d55779c69/app.py#L16-L27), which contains logic recycled from a gist [comment](https://gist.github.com/ibeex/3257877#gistcomment-946336):

``` python
import logging
from logging.handlers import RotatingFileHandler
from interface import app
app.run(host='0.0.0.0')

LOG_FILENAME = '/vagrant/log/access.log'

formatter = logging.Formatter(
    "[%(asctime)s] {%(pathname)s:%(lineno)d} %(levelname)s - %(message)s")
handler = RotatingFileHandler(LOG_FILENAME, maxBytes=10000000, backupCount=5)
handler.setLevel(logging.DEBUG)
handler.setFormatter(formatter)
app.logger.addHandler(handler)

log = logging.getLogger('werkzeug')
log.setLevel(logging.DEBUG)
log.addHandler(handler)
```

When I adjust my application, by making an unnecessary typo in the logic; or conversely, if I complete a successful post request on my application, nothing gets logged into `/vagrant/log/access.log`.  However, the `/vagrant/log/access.log` file is created, and empty.  Is the above logic equivalent to the `error.log` that I had intended?  If so, how can I correct this, while also creating a functional `/vagrant/log/access.log`?


``` python
@app.route('/test/<path:yey>')

>>> requests.get('http://localhost:5000/test/ye')
<Response [200]>
>>> requests.get('http://localhost:5000/test//')
<Response [404]>
>>> requests.get('http://localhost:5000/test//test')
<Response [404]>
>>> requests.get('http://localhost:5000/test/ye/te')
<Response [200]>
>>> requests.get('http://localhost:5000/test/ye//te')
<Response [200]>
>>> requests.get('http://localhost:5000/test///te')
<Response [404]>
>>> requests.get('http://localhost:5000/test//a/te')
<Response [404]>
>>> requests.get('http://localhost:5000/test/a//te')
<Response [200]>
```

All the 404 stuff should be intercepted but aren't.

I'm not sure that I've understand the purpose of this property, but on the off chance that I'm correct, this statement makes more sense than what came before.

Continuing discussion from #1729 
1. Should Flask shell natively support iPython?
   If so, what should that API look like?
2. Should Flask have a generic hook for extensions to add support for additional third-party shells? 
   If so, how would this work? @RonnyPfannschmidt suggested using entry points for this.

My vote is to natively support for iPython since it's so popular (I use it myself all the time via Flask-Script). But draw the line there and require other custom shell integrations to happen through third-party extensions.

http://flask.pocoo.org/docs/dev/extensiondev/#approved-extensions

Does anyone keep this updated? 
Should the concept of "approved" extensions get dropped?

Similarly, with the transition to `pallets`, what's going to happen to the extensions list itself? http://flask.pocoo.org/extensions/ 

Will it get dropped like snippets are?

See also #865 about updating the docs on approved extensions.

The time has come where I need to release a new version for my api and still support the previous one.

I have an app structure that looks like this:

```
+-- app/
    +-- api_2_0/
        +-- __init__.py
        (...)
    +-- api_2_1/
        +-- __init__.py
        (...)
   +-- __init__.py
```

Both are blueprints which I initialize this way in my `__init__.py` in the `create_app` method (I'm using the [app factory](http://flask.pocoo.org/docs/0.10/patterns/appfactories/) method):

```
    from .api_2_0 import api as api_2_0_blueprint
    app.register_blueprint(api_2_0_blueprint, url_prefix='/api/v2.0')

    from .api_2_1 import api as api_2_1_blueprint
    app.register_blueprint(api_2_1_blueprint, url_prefix='/api/v2.1')
```

But this causes: `AssertionError: A blueprint's name collision occurred between <flask.blueprints.Blueprint object at 0x7f8e48e82c10> and <flask.blueprints.Blueprint object at 0x7f8e48ef7150>.  Both share the same name "api".  Blueprints that are created on the fly need unique names.`

It's true that both are called `api` inside their folders but I'm importing them with different names. Having to rename all the calls to `api` to something else for each version would make versioning painful and overall a code spaghetti.

Is there a better way to do this?

It would be nice if you could add an issue template to the repository.

d3d8a4694a9c1601e213d6b5f27fab34615609b7 hasn't shown up yet here: http://flask.pocoo.org/docs/dev/extensions/

I'm not sure how to trigger a rebuild... on RTD, anyone can trigger a rebuild from the web, but since it's hosted on Pocoo I'm not sure if there's a webhook that watches the repo for commits, or if @mitsuhiko has to manually do it. 

dotCloud is no more; their parent company went bankrupt

Fix #1769 

There's several branches on this repo that are superfluous and should probably be deleted because they contain no additional commits and haven't been worked on in years. 

For example:
- https://github.com/mitsuhiko/flask/tree/json-sessions
- https://github.com/mitsuhiko/flask/tree/flask_deployment_docs
- https://github.com/mitsuhiko/flask/tree/appdispatch-docs

No longer need to grab `tox` from master

Hello, i use requests to send large file like that:

``` python
def gen():
    with open(localpath, 'rb') as f:
        while True:
            print 'data'
            data = f.read(1024)
            if not data:
                break
            yield data
r = self.session.post(url, data=gen(), allow_redirects=False, params=params)
```

On the Flask side i get that:

``` python
with open(ftmp, 'ab') as handle:
    handle.write(request.stream.read())
```

But no content is writed and i get response 400.

This is my request headers:

> Transfer-Encoding: chunked
> Content-Length:
> User-Agent: python-requests/2.8.1
> Connection: keep-alive
> Host: 127.0.0.1:5000
> Accept: _/_
> Content-Type:
> Accept-Encoding: gzip, deflate

how to solve Flask framework not support html5 video label on safari and iOS7、8、9 devices? The video can play on chrome &android.
eg:
https://github.com/mitsuhiko/flask/issues/712
the article have not solution.

Changed  'pip install --editable .' to 'pip install --editable flask', which works. Also added an explanatory comment, since as a beginner to pip I found this confusing.

error: could not create '/usr/local/lib/python2.7/dist-packages/flask': Permission denied

---

Cleaning up...
Command /usr/bin/python -c "import setuptools, tokenize;**file**='/tmp/pip_build_habit/Flask/setup.py';exec(compile(getattr(tokenize, 'open', open)(**file**).read().replace('\r\n', '\n'), **file**, 'exec'))" install --record /tmp/pip-Dy8fke-record/install-record.txt --single-version-externally-managed --compile failed with error code 1 in /tmp/pip_build_habit/Flask
Storing debug log for failure in /home/habit/.pip/pip.log

Hi

When calling a flask webserver from angularjs, you get `method not allowed` and `content-type not allowed` errors. This is because the flask OPTIONS response does not specify `Access-Control-Allow-Headers` and `Access-Control-Allow-Methods` by default.

This is fixed by following code fragment:

```
@app.after_request
def apply_caching(response):
    response.headers['Access-Control-Allow-Headers'] = 'Content-Type'
    response.headers['Access-Control-Allow-Methods'] = 'GET,PUT'
    return response
```

Is the exclusion of these headers intentional or is this a bug? I think a lot of people call Flask from angularjs, so supporting these headers by default might be good for adoption and ease of use?

Kind regards

Consider this test case:

``` python
from flask import Flask, url_for
app = Flask(__name__)


@app.route('/some/route')
def some_route():
    return 'Some route'


@app.route('/some/websocket')
def some_websocket():
    return 'Some websocket'


@app.route('/')
def test_case():
    return '<br><br>'.join((
        'some_route url:<br> %s' % url_for('some_route', _external=True),
        'some_websocket url:<br> %s' % url_for('some_websocket', _external=True, _scheme='ws'),
        'this test case url:<br> %s' % url_for('test_case', _external=True),
    ))

if __name__ == '__main__':
    app.config['SERVER_NAME'] = 'myserver.l:5000'
    app.run(debug=True)
```

Accessing http://myserver.l:5000/ gives:

```
some_route url:
http://myserver.l:5000/some/route

some_websocket url:
ws://myserver.l:5000/some/websocket

this test case url:
ws://myserver.l:5000/
```

should give:

```
some_route url:
http://myserver.l:5000/some/route

some_websocket url:
ws://myserver.l:5000/some/websocket

this test case url:
http://myserver.l:5000/
```

It looks like deep down, Flask calls `SocketServer.py` (a source code file for Python) to make its server.  But `SocketServer.py` has a call to `os.fork()`, which isn't supported at all on Windows. It would be great to use something besides `SocketServer`, or maybe a modified version of `SocketServer`.  When you make a HTTP request, it first calls `SocketServer.process_request`, which then calls `os.fork`.

More importantly (to me at least), does anyone have a workaround?

I asked the question that whether we should explicitly point out the python versions flask supports in #1651 , and since it makes sense that we'd better clarify the versions, I send this PR.

Hi,

I'm just wondering what your code of conduct is for this project?

Thanks,
Alison

Enhance: When in windows, and the config file is hard code by utf8, flask.config.from_pyfile will not encoding correctly.
Now give a param to let the user to choose the encoding of the config file

Enhance: When in windows, and the config file is hard code by utf8, flask.Config.from_pyfile will not encoding correctly. Now add a param to let the user to choose the encoding of the config file

I have updated README now its looking a bit good :)

On December 7, 2015 Ryan Reid published a blog post  called ["Injecting Flask" ](https://nvisium.com/blog/2015/12/07/injecting-flask/).

In his post he demonstrated several attacks against a naive Flask / Jinja2 based implementation of a website.

I'm not sure if Flask has documented best practices which would mitigate the problem and I couldn't find any hint of a discussion of his blog post in the Flask community.

Are there plans to fix or document the problem?

For me it's a rather minor thing because I only have one internal service which depends on Flask, but I'm sure other developers may have many more and this is a serious security issue.

mostly typos and other minor corrections i've come across reading the documentation.

I git clone and enter the flaskr folder, then run the following command in Bash:
flask --app=flaskr initdb

then I got error: command not found: flask

How do I setup flaskr in this case? Do I miss something?

- There was wrong indentation error raising in line 587 https://github.com/mitsuhiko/flask/blob/master/flask/helpers.py#L587
- Also fixed some PEP8 warnings

flask version is latest bleeding (from repo)
python version is 3.4 and OS is OpenBSD.

Traceback below:

```
Traceback (most recent call last):
  File "/usr/local/bin/flask", line 9, in <module>
    load_entry_point('Flask==0.11.dev0', 'console_scripts', 'flask')()
  File "/usr/local/lib/python3.4/site-packages/flask/cli.py", line 494, in main
    cli.main(args=args, prog_name=name)
  File "/usr/local/lib/python3.4/site-packages/flask/cli.py", line 342, in main
    return AppGroup.main(self, *args, **kwargs)
  File "/usr/local/lib/python3.4/site-packages/click/core.py", line 675, in main
    _verify_python3_env()
  File "/usr/local/lib/python3.4/site-packages/click/_unicodefun.py", line 69, in _verify_python3_env
    if locale.lower().endswith(('.utf-8', '.utf8')):
TypeError: 'str' does not support the buffer interface
```

It seems that we don't support 2.5 any more, and the with statement is mandatory since 2.6, I think we could remove it now.

I get `OSError: [Errno 88] Socket operation on non-socket` when I try to run the following app with debug enabled.  I am using Ubuntu 14.04.2 and Python 3.4.0.

``` python
app = Flask(__name__)
app.debug = True

@app.route('/')
def index():
    return 'Hello, World!'

if __name__ == '__main__':
    app.run(host='0.0.0.0')
```

```
$ python app.py
 * Restarting with stat
 * Debugger is active!
 * Debugger pin code: 916-262-145
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/usr/lib/python3.4/threading.py", line 920, in _bootstrap_inner
    self.run()
  File "/home/nero/.virtualenvs/FBPocket/lib/python3.4/site-packages/gevent/threading.py", line 137, in run
    super(Thread, self).run()
  File "/usr/lib/python3.4/threading.py", line 868, in run
    self._target(*self._args, **self._kwargs)
  File "/home/nero/.virtualenvs/FBPocket/lib/python3.4/site-packages/werkzeug/serving.py", line 653, in inner
    fd=fd).serve_forever()
  File "/home/nero/.virtualenvs/FBPocket/lib/python3.4/site-packages/werkzeug/serving.py", line 557, in make_server
    passthrough_errors, ssl_context, fd=fd)
  File "/home/nero/.virtualenvs/FBPocket/lib/python3.4/site-packages/werkzeug/serving.py", line 478, in __init__
    self.server_address = self.socket.getsockname()
OSError: [Errno 88] Socket operation on non-socket
```

Hi,

I have these:

```
# Imports
from flask import Flask, jsonify, request, make_response, render_template, url_for, flash, redirect
from yaml import load, dump
try:
    from yaml import CLoader as Loader, CDumper as Dumper
except ImportError:
    from yaml import Loader, Dumper


# Global variables
version = "0.1"
app = Flask(__name__)
app.secret_key = 'el meu secret'


# Main procedure
@app.route("/new/", methods=['POST'])
def create_new_activity():
    flash("Funciona?")
    flash(request.form.get('body'))
    return redirect(url_for('show_new_activity_form'))

@app.route("/new/", methods=['GET'])
def show_new_activity_form():
    return render_template('activity.html')


if __name__ == "__main__":
    app.debug = True
    app.run()
```

My templates are very simple:

```
{% extends "base.html" %}
{% block title %}New activity{% endblock %}
{% block content %}
  <script>
  $(document).ready(function() {
    $('select').material_select();
  });
  </script>  

  <h1>New activity</h1>


  <div class="row">
      <form action="{{ url_for('create_new_activity') }}" method="post">
          <input placeholder="identification" id="serial" type="text" class="validate">
          <textarea id="body" class="materialize-textarea"></textarea>
      <select id="tags" required multiple>
            <option value="1" selected>Option 1</option>
            <option value="2">Option 2</option>
            <option value="3">Option 3</option>
          </select>
          <input type=submit>
      </form>
   {% with messages = get_flashed_messages() %}
    {% if messages %}
      <ul class=flashes>
      {% for message in messages %}
        <li>{{ message }}</li>
      {% endfor %}
      </ul>
    {% endif %}
  {% endwith %}
  </div>
{% endblock %}
```

```
<!DOCTYPE html>
<html>
  <head>
    <title>{% block title %}{% endblock %} &in; tam </title>
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    {% block css_js %}
    <!-- CSS and Javascript headers -->
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/css/materialize.min.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/js/materialize.min.js"></script>
    {% endblock %}
  </head>
  <body>
    <div class="navbar-fixed">
      <nav class="z-depth-1" role="navigation">
        <div class="nav-wrapper container">
          <a id="logo-container" class="brand-logo left" href="/">tam</a>
          <ul class="right">
            <li><a href="{{ url_for('show_new_activity_form') }}">New</a></li>
          </ul>
        </div>
      </nav>
    </div>
    <div class="container">
      <div class="section">
         {% block content %}{% endblock %}
      </div>
    </div>
    <footer class="page-footer">
     <div class="container">Tam application</div>
     <div class="footer-copyright">
       <div class="container">
          Tam is distributed under <a href="https://www.gnu.org/licenses/gpl-3.0.txt">GPL 3</a> or above
       </div>
     </div>
    </footer>
  </body>
</html>
```

I get always "None" in the result of `request.form.get('body')` which I really fill in. What happens there?

Thanks,

Updated the docs to include a an example of using httpd2.4 syntax for setting directory permissions.
There was a link  to Apache 2.4 but no explanation of changes needing to be made.

This was mentioned in issue #1644 

**Changes:**

update directory permissions from httpd 2.2 syntax 

```
    Order allow,deny
    Allow from all
```

to httpd 2.4 syntax

```
    Require all granted
```

/flask_website/**init**.py

``` python
# from flask_openid.ext.openid import OpenID
from flask_openid import OpenID
```

Should like this.

Anyone have a plugin or making a plugin for visual studio code?

based on #1562

due to using a filesystem-loader instead of a package-loader, egg based installs and zipped python applications as well as compressed wheels in the pythonpath can not load templates

the problem lies in `_PackageBoundObject` not using a package loader,
i don't recall if this was done for performance or due to other downsides

This is my own fault as I was looking for other more non-obvious issues with my permissions but the documentation here:

http://flask.pocoo.org/docs/0.10/deploying/mod_wsgi/

Uses httpd 2.2 syntax for directory permissions.

At the very least, a note should be added to remind folks to use httpd 2.4 syntax of "Require All Granted".

## Made changes regarding to instance path of files in flask/testsuite/test_apps

While running test case by run-test.py module it causes Error for instance path.

``` sh
FAIL: test_main_module_paths (flask.testsuite.config.InstanceTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "../flaskenv/flask/flask/testsuite/config.py", line 157, in test_main_module_paths
    self.assert_equal(app.instance_path, os.path.join(here, 'instance'))

  File "../flaskenv/flask/flask/testsuite/__init__.py", line 141, in assert_equal
    return self.assertEqual(x, y)

AssertionError: '../flaskenv/var/run-tests-instance' != '../flaskenv/flask/instance'
- ../flaskenv/var/run-tests-instance
?             ^ ^ ----------
+ ../flaskenv/flask/instance
?             ^^ ^^
```

``` sh
FAIL: test_uninstalled_module_paths (flask.testsuite.config.InstanceTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "../flaskenv/flask/flask/testsuite/config.py", line 164, in test_uninstalled_module_paths
    self.assert_equal(app.instance_path, os.path.join(here, 'test_apps', 'instance'))

  File "../flaskenv/flask/flask/testsuite/__init__.py", line 141, in assert_equal
    return self.assertEqual(x, y)

AssertionError: '/hom[23 chars]ang-py3-test/flaskenv/var/config_module_app-instance' != '/hom[23 chars]ang-py3-test/flaskenv/flask/flask/testsuite/test_apps/instance'
- ../flaskenv/var/config_module_app-instance
?             ^ ^ ---  ^^^^^^^     ^
+ ../flaskenv/flask/flask/testsuite/test_apps/instance
?             ^^ ^^  +++++++++++ ^ +++++    ^^
```

``` sh
FAIL: test_uninstalled_package_paths (flask.testsuite.config.InstanceTestCase)
\----------------------------------------------------------------------
Traceback (most recent call last):
  File "../flaskenv/flask/flask/testsuite/config.py", line 169, in test_uninstalled_package_paths
    self.assert_equal(app.instance_path, os.path.join(here, 'test_apps', 'instance'))

  File "../flaskenv/flask/flask/testsuite/__init__.py", line 141, in assert_equal
    return self.assertEqual(x, y)

AssertionError: '/hom[23 chars]ang-py3-test/flaskenv/var/config_package_app-instance' != '/hom[23 chars]ang-py3-test/flaskenv/flask/flask/testsuite/test_apps/instance'
- ../flaskenv/var/config_package_app-instance
?             ^ ^ ---  ^^^^^^^^     ^
+ ../flaskenv/flask/flask/testsuite/test_apps/instance
?             ^^ ^^  +++++++++++ ^ +++++    ^^

----------------------------------------------------------------------
Ran 226 tests in 4.574s

FAILED (failures=3)
```

Changes In the following files remove this instance path Error from the Test case:
- flask/testsuite/test_apps/config_module_app.py.

``` sh
app = flask.Flask(__name__, instance_path=os.path.join(
               os.path.abspath(os.path.dirname(__file__)),'instance')
              )
```
- flask/testsuite/test_apps/config_package_app/**init**.py.

``` sh
app = flask.Flask(__name__, instance_path=os.path.join(os.path.abspath(
                os.path.dirname(os.path.dirname(__file__))),'instance')
              )
```
- flask/testsuite/test_apps/main_app.py

``` sh
import os

app = flask.Flask('__main__', instance_path=os.path.join(
                os.path.abspath(os.path.dirname('__main__')),'instance')
              )
```

Made changes regarding to instance path of files in flask/testsuite/test_apps

While running test case by run-test.py module it causes Error for instance path.

``` sh
FAIL: test_main_module_paths (flask.testsuite.config.InstanceTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "../flaskenv/flask/flask/testsuite/config.py", line 157, in test_main_module_paths
    self.assert_equal(app.instance_path, os.path.join(here, 'instance'))

  File "../flaskenv/flask/flask/testsuite/__init__.py", line 141, in assert_equal
    return self.assertEqual(x, y)

AssertionError: '../flaskenv/var/run-tests-instance' != '../flaskenv/flask/instance'
- ../flaskenv/var/run-tests-instance
?             ^ ^ ----------
+ ../flaskenv/flask/instance
?             ^^ ^^
```

``` sh
FAIL: test_uninstalled_module_paths (flask.testsuite.config.InstanceTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "../flaskenv/flask/flask/testsuite/config.py", line 164, in test_uninstalled_module_paths
    self.assert_equal(app.instance_path, os.path.join(here, 'test_apps', 'instance'))

  File "../flaskenv/flask/flask/testsuite/__init__.py", line 141, in assert_equal
    return self.assertEqual(x, y)

AssertionError: '/hom[23 chars]ang-py3-test/flaskenv/var/config_module_app-instance' != '/hom[23 chars]ang-py3-test/flaskenv/flask/flask/testsuite/test_apps/instance'
- ../flaskenv/var/config_module_app-instance
?             ^ ^ ---  ^^^^^^^     ^
+ ../flaskenv/flask/flask/testsuite/test_apps/instance
?             ^^ ^^  +++++++++++ ^ +++++    ^^
```

``` sh
FAIL: test_uninstalled_package_paths (flask.testsuite.config.InstanceTestCase)
\----------------------------------------------------------------------
Traceback (most recent call last):
  File "../flaskenv/flask/flask/testsuite/config.py", line 169, in test_uninstalled_package_paths
    self.assert_equal(app.instance_path, os.path.join(here, 'test_apps', 'instance'))

  File "../flaskenv/flask/flask/testsuite/__init__.py", line 141, in assert_equal
    return self.assertEqual(x, y)

AssertionError: '/hom[23 chars]ang-py3-test/flaskenv/var/config_package_app-instance' != '/hom[23 chars]ang-py3-test/flaskenv/flask/flask/testsuite/test_apps/instance'
- ../flaskenv/var/config_package_app-instance
?             ^ ^ ---  ^^^^^^^^     ^
+ ../flaskenv/flask/flask/testsuite/test_apps/instance
?             ^^ ^^  +++++++++++ ^ +++++    ^^

----------------------------------------------------------------------
Ran 226 tests in 4.574s

FAILED (failures=3)
```

Changes In the following files remove this instance path Error from the Test case:
- flask/testsuite/test_apps/config_module_app.py.
- flask/testsuite/test_apps/config_package_app/**init**.py.
- flask/testsuite/test_apps/main_app.py

I submitted a patch for this but learned that it was incomplete with further testing. https://github.com/mitsuhiko/flask/pull/1640

Basically, it would be nice to allow `DEBUG` on the application to control the activation of the debugger and reloader when running the CLI like `app.run` does.

I was surprised when running my application from the CLI that it didn't respect the applications debug flag.  This patch expands `DispatchApp`'s api to return the applications debug flag which is used by `run_simple` to activate the debugger and supply an informative message.

I explored enabling the reloader along with enabling the debugger but that caused a double execution. If I understand it correctly, the double load is the result of `eager_loading` not being switched properly because the reload status (if activated by the applications debug flag) wouldn't be known until after loading has occurred.

Since I am not positive what side-effects (none to my limited understanding) double execution would have I left that code out; it is a trivial addition if a double execution is acceptable in this case.

``` python
from flask import Flask
from flask import request

app = Flask(__name__)

@app.route('/')
def index():
    return  'hello'

app.run(debug=True, port=8000, host='0.0.0.0')
```

If I try to navigate to http://127.0.0.1:8000//google.com (2 slashes), I get redirected to google.com.  I correctly get a 404 with http://127.0.0.1:8000/google.com (1 slash) and http://127.0.0.1:8000///google.com (3 slashses).  This is a vulnerability, I shouldn't be redirected to arbitrary urls.  Flask should prevent arbitrary redirects from urls.


I think 'app' is the intended word here, but I am not 100% sure.

convert flaskr example to responsive design using bootstrap 3

First, the link to the docs on the main page:

```
http://flask.pocoo.org/docs/
```

is missing the links on the left for downloading the docs. It should be:

```
http://flask.readthedocs.org/en/latest/
```

Second, the download links on the left are dead ends:

```
http://flask.pocoo.org/docs/flask-docs.[epub,pdf,mobi,zip]
```

should be:

```
http://readthedocs.org/projects/flask/downloads/[pdf,epub,htmlzip]/latest/
```

Same thing for the docs download links on the main page under the heading "Interested?"

I am writing a flask ext and need to do something before View init, 
but I can't do that via app.before_request because I need to test my View without request.

Hello.

I am trying to create a Catch-All function which serves every URL. I am following the example from http://flask.pocoo.org/snippets/57/ 

Here is the code snippet:

> ``` python
> from flask import Flask
> app = Flask(__name__)
> 
> @app.route('/', defaults={'path': ''})
> @app.route('/<path:path>')
> def catch_all(path):
>     return 'You want path: %s' % path
> 
> if __name__ == '__main__':
>     app.run() 
> ```

This code snippet does not catch all of the URLs. Am I missing something here? 

Thanks.

I have been running a simple flask webserver for the purpose of a twilio app. Usually works all groovy, however every few days, twilio will tell me it could not connect, and upon checking the running server python shell, it would show nothing abnormal until I killed it, and the stack trace would spit out an exception that my flask app had crashed related to the generic twilio request.

Googling around, it would appear this is due to an underlying SocketServer not handling the exception properly and causing the problem. This post on stackoverflow speaks about the issue but offers no solution: http://stackoverflow.com/questions/17787023/python-how-to-catch-a-flask-except-like-this

It appears from the leading comment, that it's 'expected' to happen, and flask should simply handle it fine. However, in my case, it causes the server to lock up and crash. No further requests will be acknowledged. I simply have to re-start the app, and it'll proceed merrily along for a few more days.

If this is truly a bug in flask, it makes relatively easy to DDoS any flask server by the client simply hitting the web request and then stopping quickly and not acknowledging.

Why is my flask not set up to properly handle this type of thing? Is this a bug? Have I improperly configured something? Is there a try/catch I'm forgetting?

using regular pip install of flask 0.10.1 btw... The exception is pasted below:

```
Exception happened during processing of request from ('x.x.x.x', 48590)
Traceback (most recent call last):
  File "/root/.pyenv/versions/2.7.10/lib/python2.7/SocketServer.py", line 295, in _handle_request_noblock
self.process_request(request, client_address)
  File "/root/.pyenv/versions/2.7.10/lib/python2.7/SocketServer.py", line 321, in process_request
self.finish_request(request, client_address)
  File "/root/.pyenv/versions/2.7.10/lib/python2.7/SocketServer.py", line 334, in finish_request
self.RequestHandlerClass(request, client_address, self)
  File "/root/.pyenv/versions/2.7.10/lib/python2.7/SocketServer.py", line 655, in __init__
self.handle()
  File "/root/.pyenv/versions/2.7.10/lib/python2.7/site-packages/werkzeug/serving.py", line 203, in handle
rv = BaseHTTPRequestHandler.handle(self)
  File "/root/.pyenv/versions/2.7.10/lib/python2.7/BaseHTTPServer.py", line 340, in handle
self.handle_one_request()
  File "/root/.pyenv/versions/2.7.10/lib/python2.7/site-packages/werkzeug/serving.py", line 234, in handle_one_request
self.raw_requestline = self.rfile.readline()
  File "/root/.pyenv/versions/2.7.10/lib/python2.7/socket.py", line 451, in readline
data = self._sock.recv(self._rbufsize)
KeyboardInterrupt
```

This patch intends to provide more information about uwsgi/nginx deployment when the app callable is in (`yourapp/__init__.py`) and the application is attached to the '/' URL.
I'm not English native so I expect some remarks ;)

Related to previous #1464

This will make sure these tests will be skipped if you don't have redbaron installed.

I think this could be handy and potentially minimise the risk
anyone commits it to the project.

```
flask - (master) $ tree .cache/
.cache/
└── v
    └── cache
        └── lastfailed

```

I think this could be handy and potentially minimise the risk
anyone commits it to the project.

```
flask - (master) $ tree .cache/
.cache/
└── v
    └── cache
        └── lastfailed

```

With a fresh clone of the project.
By just installing pytest this is what i get when i run `py.test`:

```
____ERROR collecting scripts/test_import_migration.py ___
scripts/test_import_migration.py:5: in <module>
    from redbaron import RedBaron
E   ImportError: No module named 'redbaron'
```

I am trying to deploy a flask application into an url subroot like

localhost/flaskapp

I configured my project with this settings:

wsgi.ini

```
[uwsgi]
socket = /tmp/wsgi.sock
chmod-socket    = 666
uid = www-data
gid = www-data
chdir= /var/www/flaskproject
module = wsgi 
callable = application
logto = /var/www/flaskproject/logs/t.log 
```

nginx.conf

```
location / {
     root   /var/www/website;
  }


location = /flaskapp { rewrite ^ /flaskapp/; }
location /flaskapp { try_files $uri @application; }
location @application {
  include uwsgi_params;
  uwsgi_param SCRIPT_NAME /flaskapp;
  uwsgi_modifier1 30;
  uwsgi_pass unix:/tmp/wsgi.sock;
}
```

wsgi.py

```
from myapp import application

if __name__ == "__main__":
    application.run()
```

myapp.py

```
from flask import Flask

application = Flask(__name__)

@application.route("/")
def index():
    try:
        import http.client
        fr = "OK Python 3.x"

    except ImportError:         
        fr = "OK Python 2.x"           
    return fr

@application.route("/more")
def sdf():
    return "OK deeper subroot"

if __name__ == "__main__":
    application.run(host='0.0.0.0')
```

I execute this into virtualenvs for python 2.7 and python 3.4, each one with their respective uwsgi modules compiled( I mean compiled for python 2.7 and 3.4).

When I run each one, open my browser and I got this:

**_2.7 venv:**_

localhost: webpage (it's ok)

localhost/flaskapp: "OK Python 2.x"

localhost/flaskapp/more: "OK deeper subroot"

**_3.4 venv**_

localhost: webpage (it's ok)

localhost/flaskapp: "Not found" message

localhost/flaskapp/more: "Not found" message

As you can see, this works with python 2.7 but in python 3.4. I want to know how to run this with python 3.4, 

Thank you

When following the quickstart, specifically:

https://github.com/mitsuhiko/flask/search?utf8=%E2%9C%93&q=++Screenshot+of+the+debugger+in+action

I found myself jumping to google to learn how to activate the debugger. Perhaps if the screen grab showed & highlighted the console icon on the far left of my screen, that wouldn't have happened.

I'm happy to submit a pull request with a replacement screenshot if you agree this would be useful, noting I'm not on mac, so screen grab might look out of place, if that detail is considered important

The code block in [mongokit pattern](http://flask.pocoo.org/docs/dev/patterns/mongokit/#declarative) seems not rendered properly. Fix it by adding the missing blank line.

On python 3.4.3 with `flask-0.10.1`, running the demo in the [quickstart](http://flask.pocoo.org/docs/0.10/quickstart/) doesn't print what port it's on:

```
$ python helloworld.py
 * Restarting with stat
 * Debugger is active!
 * Debugger pin code: 281-051-764
```

it is on port 5000, so you can guess it from the docs, but I think it should tell the user what port it's running on?

Running Flask, on Linux or Windows or OS X, if you run:

```
from flask import Flask
app = Flask(__name__)

@app.route('/')
def index():
    return "foo"

if __name__ == '__main__':
    app.run(debug=True)
```

...then python kills itself with an error (cant remember from top of my head...as I am not at my PC).

However, when you remove debug=True everything is fine.

Running # pip uninstall werkzeug

Added two extra parameters to app.test_request_context():

```
subdomain: allows to test requests handled by blueprint with specified subdomain 
                   without passing full URL
url_scheme: allows to set URL scheme
```

Hello, i'm using this repository to start learning python + flask.
I red that flask with the help of jinja2 should escape any sql injection or xss attack.
Anyway if i start using the flaskr app in the examples i see that it is possible to inject xss code, i did a simple test with [<script>alert"hello"</script> ohh...github doesn't show the code of the alert] and it's working...it's a permanent xxs because it is written in the db. I would like to start writing secure code from the beginning, someone could explain how to avoid xss in this simple app? many thanks

Hi,

I’ve noticed that Flask takes 10 or 20 seconds to display a page based on a view query but will display the page in less than a second for a non-view version of the same query.  For example here is a query on view CurveVersionReport:

select CurveEditID,AsOfDate,TaskDefinition,VersionName,acattribute,DataPoints
FROM CurveVersionReport
where market = 'Commodity' and submarket = 'Agriculture' and activeversion='Yes' and curvename='CO_PRICE_VAR_USD_OTC_BO'
order by curvename, curveeditid

and the corresponding non-view version:

select a.[CurveEditID],[AsOfDate],TaskDefinition  
      ,[CurveVersion] as VersionName
      , tree + '.' + attribute as acattribute 
      ,count(*) AS DataPoints
  FROM [CurveEdits] a, curvedefinition b, submarket c, TaskDefinition d, curveversion e, curvepoints f, acattribute g
  where a.curveid = b.curveid 
  and b.marketid = c.marketid
  and a.TaskDefinitionID=d.TaskDefinitionID
  and a.[CurveVersionID]=e.[CurveVersionID]
  and f.curveeditid = a.curveeditid
  and f.acattributeid = g.acattributeid
  and market = 'Commodity' and submarket = 'Agriculture' and activeversion=1 and curvename='CO_PRICE_VAR_USD_OTC_BO'
  group by market, submarket, curvename, a.[CurveEditID],[AsOfDate],TaskDefinition,[CurveVersion],[ActiveVersion], tree, attribute 
  order by acattribute

This is the Flask method that processes the query:

@app.route('/curve/<market>/<submarket>/<curve>')
def Curve(market, submarket, curve):
    global cur
    query = ...one of the above
    cur.execute(query, (market, submarket, curve))
    edits=[x for x in cur.fetchall()]
    return render_template('curve.html', market=market, submarket=submarket, curve=curve, edits=edits)

Here is the template file:

<h5><img src='/static/wf_logo_50px.png'> 
<a href="/" target="_blank_">PFE Analytics:</a>
<a href="/Markets" target="_blank_">Market:</a> 
<a href="/market/{{market}}" target="_blank_">Submarket:</a>
<a href="/submarket/{{market}}/{{submarket}}" target="_blank_">Curve:</a>
{{market}} {{submarket}} {{curve}}</h5>


<table border="1">
<tr>
<th>CurveEditID</th>
<th>AsOfDate</th>
<th>TaskDefinition</th>
<th>VersionName</th>
<th>acattribute</th>
<th>DataPoints</th></tr>

{% for (CurveEditID,AsOfDate,TaskDefinition,VersionName,acattribute,DataPoints) in edits %}
<tr>
<td>{{CurveEditID}}</td>
<td>{{AsOfDate}}</td>
<td>{{TaskDefinition}}</td>
<td>{{VersionName}}</td>
<td>{{acattribute}}</td>
<td>{{DataPoints}}</td></tr>
{% endfor %}

</table>


Do you know why view version would be extremely slow versus non-view?

Thanks, 

Lars Ericson

Quantitative Analytics Consultant
Market & Institutional Risk Management 

Wells Fargo Bank, N.A. | 301 S. College St., 4th Floor | Charlotte, NC 28202-6000
MAC D1053-04X
Tel  704-410-2219 | Cell 917-891-1639

lars.ericson@wellsfargo.com

I've created an small extension Flask-DropIn, which aims to make it easy to organize
a large flask application. It basically borrows the idea from django app, and could 
be much more flexible.

I've tried to ensure following the extension guide, and believe that I have done everything 
required by the extension guideline

Github: https://github.com/zh012/flask-dropin
Docs: http://pythonhosted.org/Flask-DropIn/
Pypi: https://pypi.python.org/pypi/Flask-DropIn

Thanks!

I got following error with flask (0.10.1) + python 3.5. But python 2.7 is OK.
If I turn off debug flag, python 3.5 is also OK. 
Werkzeug (0.11) works well with/with out debug flag for python 3.5

C:\tmp\flask>py -3 test1.py
Traceback (most recent call last):
  File "test1.py", line 13, in <module>
    app.run()
  File "C:\Python35\lib\site-packages\flask\app.py", line 772, in run
    run_simple(host, port, self, **options)
  File "C:\Python35\lib\site-packages\werkzeug\serving.py", line 666, in run_simple
    os.set_inheritable(s.fileno(), True)
OSError: [Errno 9] Bad file descriptor

Flask code
from flask import Flask
app = Flask(**name**)
app.debug = True
@app.route("/")
def index():
    return "Hello world!"
if **name** == '**main**':
    app.run()

Werkzeug code
from werkzeug.wrappers import Request, Response
from werkzeug.debug import DebuggedApplication
@Request.application
def application(request):
    return Response('Hello World!')
application =  DebuggedApplication(application, evalex=True)
if **name** == '**main**':
    from werkzeug.serving import run_simple
    run_simple('localhost', 4000, application)

Was introduced in one of the last commits.

_refers to: http://flask.pocoo.org/docs/0.10/config/#development-production_

I did not have `__init__.py` present. I did not know whether `.py` to be part of `server_config` as filename.

Friction for new user can be reduced by giving a more precise example, like:

```
app.config.from_object('module.server_config')
```

files:

```
module/__init__.py (may be empty)
module/server_config.py
```

Let server_config.py contain the following:

```
DEBUG = False
TESTING = False
DATABASE_URI = 'sqlite://:memory:'
user = 'Aladdin' 
```

However, app.config will carry only UPPERCASE keys (KEY=value) in config file.
Hence, app.config['DATABASE_URI'] will be set, app.config['user'] not.

when I call request.get_json(), I found that request.json has been set.

If I post a http request with content-type:application/json with empty body or incomplete json string, this will abort in 400,
I want to custom my json decode error handler, what should I do?

testing

Parameters: 

```
force – if set to True the mimetype is ignored.
silent – if set to False this method will **NOT** fail silently and return False.
cache – if set to True the parsed JSON data is remembered on the request.
```

http://flask.pocoo.org/docs/0.10/api/#flask.Request.get_json

Hello,

I'm currently using flask while running `Python3.5` and I just noticed this `Unicode` error for the first time. When I run my app in the debug mode, I receive this error:

```
Traceback (most recent call last):
  File "main.py", line 28, in <module>
    app.run(debug=True)
  File "/Users/pranav/WebProjects/FitScout/fit_env/lib/python3.5/site-packages/flask/app.py", line 772, in run
    run_simple(host, port, self, **options)
  File "/Users/pranav/WebProjects/FitScout/fit_env/lib/python3.5/site-packages/werkzeug/serving.py", line 633, in run_simple
    application = DebuggedApplication(application, use_evalex)
  File "/Users/pranav/WebProjects/FitScout/fit_env/lib/python3.5/site-packages/werkzeug/debug/__init__.py", line 169, in __init__
    if self.pin is None:
  File "/Users/pranav/WebProjects/FitScout/fit_env/lib/python3.5/site-packages/werkzeug/debug/__init__.py", line 179, in _get_pin
    self._pin, self._pin_cookie = get_pin_and_cookie_name(self.app)
  File "/Users/pranav/WebProjects/FitScout/fit_env/lib/python3.5/site-packages/werkzeug/debug/__init__.py", line 96, in get_pin_and_cookie_name
    h.update('cookiesalt')
TypeError: Unicode-objects must be encoded before hashing
```

Is there an existing fix or do I need to change something on my end? I don't receive this error when running my app without the debug flag.

Thanks!

Maybe a typo? 


Maybe this is a typo?


I try to subscribing a signal like this:

``` python
def log_template_renders(sender, template, context, **extra):
    sender.logger.debug('Rendering template "%s" with context %s',
                        template.name or 'string template',
                        context)

from flask import template_rendered
template_rendered.connect(log_template_renders, app)
```

but it doesn't works. It must be like this:

``` python
def log_template_renders(sender, template, context, **extra):
    sender.logger.debug('Rendering template "%s" with context %s',
                        template.name or 'string template',
                        context)

from flask import template_rendered

@forum.before_request
def before_request():
    template_rendered.connect(log_template_renders, app)
```

then it works well.

New release and updated documentation please?

I have multiple route handlers with the same path but with different methods that they handles, e.g.

```
@app.route('/users', methods=['GET'])
@app.route('/users', methods=['POST'])
```

The problem occurs when a CORS pre-flight OPTIONS request is made to `/users`. Since the route and method match both endpoints, the wrong endpoint is sometimes returned which is problematic if you are trying to use the matched `url_rule` for any logic. In my case, I was using `request.url_rule.methods` to add the `Access-Control-Allow-Methods` header to the response.

In #1600, we have been discussing adding session regeneration/destroy methods to make preventing session fixation part of Flask. This is a rough draft based on that discussion. In this PR:
- Added `app.session_regenerate` and `app.session_destroy` methods to `app.py`
- Added `session_interface.regenerate_session` and `session_interface.destroy_session` to session interfaces
- Added tests against cookie interface verifying the methods work as expected
- Updated quickstart documentation to include notes on when to use `session_regenerate` and `session_destroy`

**Missing:**
- The documentation probably needs more thought/work (e.g. add to API, maybe other documents).

It looks like `flask.json` does not allow the user to specify an alternative json library (such as [rapidjson](https://github.com/kenrobbins/python-rapidjson)). Instead it just [does this](https://github.com/mitsuhiko/flask/blob/41622c8d681a170f39df2ab8dff170d3b8d2d139/flask/json.py#L22-L25):

``` python
try:
    from itsdangerous import simplejson as _json
except ImportError:
    from itsdangerous import json as _json
```

This currently un-overridable behavior also means that, due to differences in when `default(..)` is called between `simplejson` and `json`, bugs can mysteriously appear when `simplejson` is installed that didn't appear without it.

Would you consider giving the user some control over which json library is used?

Duplicate: Sorry
I can't download the documentation ether pdf of zip file from flask website.
Djoudi

We have been using `flask-session` for our sessions and noticed that there were no easy methods on `flask` or `flask-session` to handle session destruction/regeneration. These are practical as they aid in preventing session fixation attacks (e.g. when someone knows your session id and it doesn't get changed on login so they can reuse your session):

https://www.owasp.org/index.php/Session_fixation

We saw that `flask-kvsession` has some logic for this:

https://github.com/mbr/flask-kvsession/blob/0.6.2/flask_kvsession/__init__.py#L89-L124

but we were already invested into `flask-session` (added `sha256` signing support) that we decided to implement similar logic there as well:

https://github.com/fengsp/flask-session/pull/27

However, I'm not sure that's the ideal interface. I think the final product would look something more like

``` python
flask.session.destroy()
flask.session.regenerate()
```

which in turn call `flask.session_interface.destroy_session(self, app, session)` and `flask.session_interface.regenerate_session(self, app, session)`.

What are your thoughts on this?

Install flask:
`pip install flask`

If `test.py` contains:

```
import flask

```

A `PendingDeprecationWarning` is emitted:

`python  -Werror test.py`

```
Traceback (most recent call last):
  File "test.py", line 1, in <module>
    import flask
  File "C:\Users\John Hagen\AppData\Local\Programs\Python\Python35-32\lib\site-packages\flask\__init__.py", line 21, in <module>
    from .app import Flask, Request, Response
  File "C:\Users\John Hagen\AppData\Local\Programs\Python\Python35-32\lib\site-packages\flask\app.py", line 28, in <module>
    from .config import ConfigAttribute, Config
  File "C:\Users\John Hagen\AppData\Local\Programs\Python\Python35-32\lib\site-packages\flask\config.py", line 12, in <module>
    import imp
  File "C:\Users\John Hagen\AppData\Local\Programs\Python\Python35-32\lib\imp.py", line 33, in <module>
    PendingDeprecationWarning, stacklevel=2)
PendingDeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses
```

Python 3 does not have execfile function.


I noticed unexpected behaviour with `url_for` when generating multiple urls with different schemes during a request. After calling `url_for` with a specific `_scheme`, this scheme will become the default scheme in the current context's url_adapter.

Best demonstrated with a small example:

```
import flask

app = flask.Flask(__name__)

@app.route('/')
def hello():
    return 'Hello World'


with app.test_request_context('/'):
    flask.url_for('hello', _external=True)
    # http://localhost/
    flask.url_for('hello', _external=True, _scheme='https')
    # https://localhost/
    flask.url_for('hello', _external=True)
    # https://localhost/
```

I would expect the first and third call to return the exact same result.

PR contains a test demonstrating the issue and a proposed fix.


Add python 3.5 build to travis configuration.

Support `datetime.timedelta` and seconds as `int` for SEND_FILE_MAX_AGE_DEFAULT config variable.
Refers Issue #1580 

:beers: 


Running `py.test` leads to 

```
tests/test_regression.py:72:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <test_regression.assert_no_leak object at 0x104105550>, exc_type = None, exc_value = None, tb = None

    def __exit__(self, exc_type, exc_value, tb):
        if not hasattr(sys, 'getrefcount'):
            gc.collect()
        new_objects = len(gc.get_objects())
        if new_objects > self.old_objects:
>           pytest.fail('Example code leaked')
E           Failed: Example code leaked
```

I think this is an old issue (#452). I run the test on both CPython 2.7.8 and 3.5.0, and it failed on both occasions.

in flask doc's giving examples, the view would look like this:

``` python
class UserAPI(MethodView):

    def get(self, user_id):
        if user_id is None:
            # return a list of users
            pass
        else:
            # expose a single user
            pass

    def post(self):
        # create a new user
        pass

    def delete(self, user_id):
        # delete a single user
        pass

    def put(self, user_id):
        # update a single user
        pass
```

why not make it like this?

``` python
class UserAPI(MethodView):

    def __init__(self, user_id):
        self.user_id = user_id

    def get(self):
        if self.user_id is None:
            # return a list of users
            pass
        else:
            # expose a single user
            pass

    def post(self):
        # create a new user
        pass

    def delete(self):
        # delete a single user
        pass

    def put(self):
        # update a single user
        pass
```

the first way seems not simple and direct.


Fixes #1465 

Signed-off-by: Abhijeet Kasurde akasurde@redhat.com

In Flaskr example, I'm getting the following for url_for('add_entry')

Internal Server Error

The server encountered an internal error and was unable to complete your request. Either the server is overloaded or there is an error in the application.

This is running behind uwsgi with emperor mode. Logs are absent and do not show the real problem and I'm unable to diagnose.

Please consider generating wheel for faster installs

http://pythonwheels.com/

Fixes #1561 
Signed-off-by: Abhijeet Kasurde akasurde@redhat.com

Fixes #1465 

Signed-off-by: Abhijeet Kasurde akasurde@redhat.com

My code is as follows:

``` python
from boto.mws.connection import MWSConnection
import xml.etree.ElementTree as ET
from flask import Flask

MWSConnection._parse_response = lambda s, x, y, z: z
secretKey ="a"
sellerID="a"
mwsAuthToken="a"
marketplaceID="a"
awsAccessKeyID="a"

mws = MWSConnection(awsAccessKeyID,secretKey)
app = Flask(__name__)

mws.SellerId = sellerID
mws.Merchant = sellerID
mws.MarketplaceId = marketplaceID

@app.route('/products/matching/')
def getMatchingProduct(query):
    response=mws.list_matching_products(MarketplaceId=marketplaceID,Query=query)
    response=response.decode(encoding="utf-8")
    return response

if __name__=='__name__':
    app.run()
```

And Visual Studio just tells me that there is an error and the program does not run. There is no leads for me to try to fix this but if I just do the following from the quickstart it works

``` python
from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello World!'

if __name__ == '__main__':
    app.run()
```

http://nuitka.net/pages/overview.html

Thoughts?  


`SEND_FILE_MAX_AGE_DEFAULT` should support `int` or `datetime.timedelta`, like `PERMANENT_SESSION_LIFETIME` does.

http://flask.pocoo.org/docs/0.10/config/#builtin-configuration-values

How to route url like /usr?username=xxx ?

The website gives a very outdated view on the python 3 issue:
http://flask.pocoo.org/docs/0.10/python3/

This seems to be updated to make it a lot more realistic, but is not online:
https://github.com/mitsuhiko/flask/blob/master/docs/python3.rst

This RST file also seems to give a very different view than the dedicated python3 one:
https://github.com/mitsuhiko/flask/blob/master/docs/advanced_foreword.rst

Also updates docs to emphasize that run() should not be used
in production.

Refs #1102

it appear in when i using the celery with flask_sqlalchemy 

i am using the celery with context  by  http://flask.pocoo.org/docs/0.10/patterns/celery/
but i find "copy_current_request_context" is not work , because the context is typeof the AppContext not the RequestContext . so when invoke @copy_current_request_context , it raise the 

RuntimeError('This decorator can only be used at local scopes '
            'when a request context is on the stack.  For instance within '
            'view functions.')

so i try to  replace the RequestContext with AppContext in @copy_current_request_context , it work!
the code which i changed ( from flask/ctx.py ): 

```
def copy_current_request_context(f):

    top = _app_ctx_stack.top
    if top is None:
        raise RuntimeError('This decorator can only be used at local scopes '
            'when a request context is on the stack.  For instance within '
            'view functions.')
    reqctx = top.copy()
    def wrapper(*args, **kwargs):
        with reqctx:
            return f(*args, **kwargs)
    return update_wrapper(wrapper, f)





class AppContext(object):

    def __init__(self, app):
        self.app = app
        self.url_adapter = app.create_url_adapter(None)
        self.g = app.app_ctx_globals_class()

        # Like request context, app contexts can be pushed multiple times
        # but there a basic "refcount" is enough to track them.
        self._refcnt = 0

    def copy(self):

        mapp = self.__class__(self.app,)
        return mapp

    def push(self):
        """Binds the app context to the current context."""
        self._refcnt += 1
        _app_ctx_stack.push(self)
        appcontext_pushed.send(self.app)

    def pop(self, exc=None):
        """Pops the app context."""
        self._refcnt -= 1
        if self._refcnt <= 0:
            if exc is None:
                exc = sys.exc_info()[1]
            self.app.do_teardown_appcontext(exc)
        rv = _app_ctx_stack.pop()
        assert rv is self, 'Popped wrong app context.  (%r instead of %r)' \
            % (rv, self)
        appcontext_popped.send(self.app)

    def __enter__(self):
        self.push()
        return self

    def __exit__(self, exc_type, exc_value, tb):
        self.pop(exc_value)
```

What are the plans for the 1.0 release.  This was brought up last year and there hasn't been any announcements since then.  What progress is being made and what still remains?

Is there any support for rotating secret keys in Flask?

I would like to use http://securekey.heroku.com/ as a source.

When I was working through the tutorial, this was very confusing to me; so, I've added the code and clarification that would have helped me get through it faster.

I've spent the last month digging through flask and building a large application. Figuring out and configuring logging has been one of the most difficult things to get under control. I still don't understand it well enough that I'm comfortable or have things configured the way I'd like.

When learning a new python package/framework/utility - the first thing I _typically_ do is setup debug logging, so that I can see exactly what's going on. The more verbose the debugging messages are, the easier things are to figure out. Typically - debugging logs will dump information like:
- a configuration file was loaded
- a configuration value was set
- API providers have been initialized and are ready for use
- when API calls are performed, etc.

As far as I can tell, Flask doesn't do any of that - 'logs' are reserved for the instantiated flask application object itself - out of the box, running in debug mode - the only information I get out of the logs is that a request was received and answered. The debug logs don't seem to provide any information about flask's internal activities, things like: 
- a flask object was instantiated
- a blueprint was registered
- a route was configured
- an extension was loaded
- an extension was configured
- extension specific things

These are all things I've had to "jump through hoops" to understand (while designing my application, application structure, application patterns, etc) - things that seem like they would have been _much_ easier to understand, had logs been available. As I dig further into Flask Internals while building out my application further, there's more and more stuff I'd like to be dumping to my logs so I know exactly what's going on, internally.

As an initial attempt to set this up - I started by using [logging_tree](https://pypi.python.org/pypi/logging_tree) to dump out the logger heirarchy to see what's what. Based on that - I basically hooked the Config object (similar to how [flasky](https://github.com/miguelgrinberg/flasky/blob/master/config.py#L45) is doing this). Then I read through all the logger docs I could find, I started putting logging statements all over my application code, for example:

```
    app.logger.debug('ENV:          %s' % app.config['ENV'])
    app.logger.debug('HOST_ADDRESS: %s' % app.config['HOST_ADDRESS'])
    app.logger.debug('HOST_PORT:    %s' % app.config['HOST_PORT'])
    app.logger.debug('SECRET_KEY:   %s' % app.config['SECRET_KEY'])
    app.logger.debug('PROJECT_ROOT: %s' % app.config['PROJECT_ROOT'])
    app.logger.debug('APP_ROOT:     %s' % app.config['APP_ROOT'])
    app.logger.debug('TMP_PATH:     %s' % app.config['TMP_PATH'])
```

This uses the default log format, which is very verbose (and is tailored to provide robust information about requests - not really great for what I'm trying to do here). Instead of getting 7 lines that that are tabularized and easy to read, this generates 28 lines, that not easy to scan for this use-case. I spent awhile trying to use `app.logger` as a `logging.logger` object, until I finally figured out (yes, it's in the docs, but a little counter-intuitive) that it's not actually a `logging.logger` object - it's actually a logging.StreamHandler() object.

Then I spent a bunch of time learning more about logging and structured logging and reading through Flask's source, trying to understand exactly what's going on here. I've got some basic experience with structured logging in python, but what's going on here was well above my head and not easy to adjust. I ended up finding the [Flask.debug_log_format()](http://flask.pocoo.org/docs/0.10/api/#flask.Flask.debug_log_format) API, and used that to set my debug message format to the standard log messaging format - but when dealing with requests - now I miss the old format - and there's logs of other information I'd like to start injecting into _those_ debugging messages as well, that I don't want in my standard messages.

So now - I've been attempting to figure out a pattern that will let me do something like:
- Create a logging object that handles messages just for debugging messages related to my application setup & initialization - so I can dump things like:
  - when a flask object is instantiated (im working on dispatching multiplication wsgi applications, as apart of the same flask application)
  - things specific to flask objects that have been instantiated:
    - the configuration values
    - the blueprints
    - the routes
    - the models
- Create a separate request logger that:
  - uses a log format similar to flask's default log format (very robust, specific to debugging requests)
  - injects additional information about requests into the logging formatter
- I'm still trying to figure out how to make this less explicit in my application code, so that _automatically_ display debugging information about what flask is doing, rather than having to put debugging statements all throughout my application code

I'm working through these things step by step, but they're definitely taking a long time - and unless I'm missing some documentation here or being very dense - these seem like a big challenge for user's new to to the Flask framwork. I've found some examples (by scouring google, github.com, and gist.github.com) that are helping me along, but nothing that _really_ explains or walks through this kind of stuff.

So - am I missing some documentation here? Am I doing something that I shouldn't? Any suggestions or references you can point me to?

That is, the route should be able to return anything and after_request should be able to take that and convert it into an actual response object.

Use case: all of our routes return dicts, which we serialize to JSON through a decorator. We have no non-JSON routes. I'd like to remove our decorator and make this change application-wide instead.

Flask's automatic redirects to add a trailing slash don't appear to work for the root view.  This isn't noticeable when the application is mounted at the root of a domain, but mine is mounted in a subdirectory using mod-wsgi:

WSGIScriptAlias /myapp /path/to/myapp/modwsgi/stub.py

The result is that when someone visits http://mysite/myapp, none of the application's relative urls work.  (This is expected if the trailing slash is missing, because a relative url like static/image.png means something different depending on whether the current page is http://foo/bar or http://foo/bar/)

I tryed to do the following:
    term = request.args.get('term')
    query = db.session.query(Class)
    query = query.filter(Class.name.like('%s%%' % term))  
    return jsonify ([{'label' : klass.name } for klass in query.all()])

and it returned the following excpetion:
    File "C:\Users\tzulberti\envs\uml\lib\site-packages\flask-0.6.1-py2.7.egg\flask\app.py", line 889, in **call**
        return self.wsgi_app(environ, start_response)
    File "C:\Users\tzulberti\envs\uml\lib\site-packages\flask-0.6.1-py2.7.egg\flask\app.py", line 879, in wsgi_app
        response = self.make_response(self.handle_exception(e))
    File "C:\Users\tzulberti\envs\uml\lib\site-packages\flask-0.6.1-py2.7.egg\flask\app.py", line 876, in wsgi_app
        rv = self.dispatch_request()
    File "C:\Users\tzulberti\envs\uml\lib\site-packages\flask-0.6.1-py2.7.egg\flask\app.py", line 695, in dispatch_request
        return self.view_functions[rule.endpoint](**req.view_args)
    File "E:\Proyectos\pywebuml\src\pywebuml\web.py", line 50, in autocomplete_search
        return jsonify([{'label' : klass.name } for klass in query.all()])
    File "C:\Users\tzulberti\envs\uml\lib\site-packages\flask-0.6.1-py2.7.egg\flask\helpers.py", line 106, in jsonify
        return current_app.response_class(json.dumps(dict(_args, *_kwargs),
    ValueError: dictionary update sequence element #0 has length 1; 2 is required

But when using from json import dump the result of the query is returned without any problem.
ValueError: dictionary update sequence element #0 has length 1; 2 is required


There are tons of new extensions that need to be reviewed :)

http://pypi.python.org/pypi?%3Aaction=search&term=flask&submit=search

I've updated the documentation for Lighttpd deployment with FastCGI.

quoting from flask.helpers.send_file:
    # if we know the file modification date, we can store it as the
    # current time to better support conditional requests.  Werkzeug
    # as of 0.6.1 will override this value however in the conditional
    # response with the current time.  This will be fixed in Werkzeug
    # with a new release, however many WSGI servers will still emit
    # a separate date header.
    if mtime is not None:
        rv.date = int(mtime)

These 2 lines break clientside caching because they emit a wrong Date header.

As by rfc 2616, the Date header should tell when the Response originated from
the server (== current server time), but this code sets it to the mtime of
the static file (== some time in the past).

This obviously at least breaks Firefox 3.6, because it'll always consider its
cache entry as stale then (even when the Expires date and max-age would
normally not lead to staleness).

Wrong behaviour:
1st request -> 200, all further requests (directly afterwards) -> 304

Correct behaviour (wrong code removed):
1st request -> 200, 
(NO further requests happening until Expires is reached), 
next request (after expiry) -> 304

Wrong behaviour was introduced after 0.6.2 due to unknown reasons by:

https://github.com/mitsuhiko/flask/commit/85ff63c32e7237280bff3293481a371fb3da180c

I don't see how this shall "better support conditional requests", it rather
looks like breaking caching and doing lots of unneeded requests.

[Revised after reading the code more carefully.]

I'd like to use Flask sessions with a few tweaks:
- json instead of pickle
- sha256 or sha512 instead of sha1
- expiration when the browser closes _or_ after an idle time limit, whichever comes first: save_cookie(session_expires=something, expires=None)
- automatically updated last-request time, to support the idle time limit

In the absence of direct support of these features, I think I can accomplish them with a SecureCookie/Session subclass.  It looks like I can make Flask use my subclass by overriding Flask.open_session(), but since the existing method contains slightly more logic than simply instantiating a Session, I'm concerned that overriding it might introduce strange behavior with future versions of Flask

Would you consider exposing an official means of using a custom Session/SecureCookie class?  Maybe even turning some of the above tweaks into Flask configuration options?

Hey, I don't know if this is the right flask-ish way to do this, but it would great to have a way to set the JSONEncoder to allow for non-dict object types.  This seemed like the easiest way, but I didn't see a good way to fit this into the existing config.

-matt





Many people don't like to deal with virtualenv and other things to get started. Maybe it would be interesting to play around with various concepts of reducing the installation time to executing a single script that creates a tarball with flask and all deps in there so that you can just drop it into a folder and are done.


Logging in to flask.pocoo.org with http://openid.aol.com/username fails consistently for me.  After being asked to share my nickname by AOL I just never get redirected back to Flask site.  

Safari Version 5.0.3 (6533.19.4)
MacOS X 10.6.5

changed all references to not refer to magical import system

Implementing Facebook authentication, I need a context processor that will insert a current_user variable to the template context by performing some operations on the cookies/request. Since context processors need the app object for the decorator, they are rather hard to put in another file, and this feels unclean.

Could something be done to enable putting context processors in a context_processors.py file by themselves, short of importing and decorating them one by one?

When redirecting, for example, "/home" to "/home/", the query string is discarded. For example, "/home?foo=bar" is redirected to "/home/" instead of "/home/?foo=bar", as expected.

In the tutorial _Step 6: The Templates_, some of the html closing tags for the definition lists and list items were missing in `show_entries.html` and `login.html`. Regards.

When using the flash() function I use get_flashed_messages() in the template for display.  Today when attempting to use the variable "messages" in my template I found the flashed messages are exposed there as a global in the templates.  That's probably ok but unless I missed it, this is not documented in the flash() documentation: http://flask.pocoo.org/docs/api/#message-flashing or the jinja context here: http://flask.pocoo.org/docs/templating/

My "messages" were hidden completely by the (empty) flash messages until I realized what might be happening.

Anyhow, thanks for the great tools!

Very very nice work done in Flask! Really liked it!
However, I was trying to run my Flask script under a subfolder of my Desktop folder in Ubuntu. Since my system is set up for Portuguese (I'm Brazilian), the default name for the folder is "Área de Trabalho". I was getting UnicodeEncodeError every time I tried to run the example in "11.7 Uploading Files". (At least it was really good to teach me how to use the Flask debugger!) I went around, examining where the error was coming from, and, finally, got to "File "/usr/local/lib/python2.6/dist-packages/Flask-0.6-py2.6.egg/flask/helpers.py", line 350, in send_file", when the function adler32 uses the unicode string. Then, I just tried a quick "from zlib import adler32; adler32(u'Á')" to realize that zlib doesn't allow unicode strings, returning a "UnicodeEncodeError: 'ascii' codec can't encode character u'\xc1' in position 0: ordinal not in range(128)".
Of course I can move my script to another folder, but it would be nice not having to think about that in the future, especially when it is said that "Flask like Jinja2 and Werkzeug is totally Unicode based when it comes to text".
Sorry if I don't make much sense... it's almost 3:00am around here...

Congrats for the great job on Flask!

jjunho

It would be useful to make the test client class an overridable property (as is currently the case with response_class).

It would then be possible to insert a custom TestClient class with additional methods (for example, a "login" method) in unit tests.

For example:

```
app.test_client_class = MyCustomClient
client = app.test_client() 
```

Hello,

just tried pypy 1.4 and go a strange bug when using Flask's sessions:
here is the traceback:
http://paste.pocoo.org/show/296447/

a simple app that trigger the bug:
http://paste.pocoo.org/show/296464/

I think if TESTING is set, Flask should re-raise exceptions just like it currently does if DEBUG is enabled. This would enable a behavior similar to DEBUG_PROPAGATE_EXCEPTIONS while still testing with DEBUG=False.

In Flask's add_url_rule method, after add rule to url_map, then check whether the rule is added before. 

```
rules_before_added = self.url_map._rules[:-1]
ix = rules_before_added.index(rule)
```

If the rule added before, then override the view function of previously rule.

```
if endpoint_override:
    self.view_functions[endpoint_override] = view_func
```

Mainly `unicode` -> `Unicode`.

The example last in [this](http://flask.pocoo.org/docs/signals/#subscribing-to-signals) section is pointless because the `recorded` list is never yielded and it is not reachable from anywhere. `connected_to` yields `None`.

```
def captured_templates(app):
    recorded = []
    def record(template, context):
        recorded.append((template, context))
    return template_rendered.connected_to(record, app)
```

It's still a meaningful pattern for like what Flask-Testing does, appending to `self.templates` which in deed is reachable from tests. What would be a sensible rewrite?


There's probably a reason this isn't currently supported, but in any case it _would_ be neat if we could have errorhandlers local to a `flask.Module`, that don't affect the application globally.

Mainly so that this works:

```
return jsonify(error="I pity the foo'!"), 400
```

This would result in what now requires:

```
return Response(jsonify(error="I pity the foo'!.").data,
                mimetype='application/json', status=400)
```



Fixed issue #133.

While looking through the Flask docs this evening, I came across a minor formatting issue in the list attributes on session. The single commit here fixes that.

Hi Armin, Dan,

Was running through the introduction and tutorial and picked up some minor fixes.
Please pull if they are any use for you.

Thanks for all the work you put out on Flask!

Regards, Daniel

Am I missing a reason why this isn't the case or is it simply a bug?

This ...

 Example subscriber::

```
    def log_template_renders(sender, template, context):
        sender.logger.debug('Rendering template "%s" with context %s',
                            template.name or 'string template',
                            context)

    from flask import request_started
    request_started.connect(log_template_renders, app)
```

... the two last lines must be...
        from flask import template_rendered
        template_rendered.connect( log_template:renders, app)


The new module system should support lazy loading and still provide early access to templates and static files.


Maybe use of one of these should be suggested:

```
setup.py egg_info ...
--tag-svn-revision (-r)  Add subversion revision ID to version number
--tag-date (-d)          Add date stamp (e.g. 20050528) to version number
--tag-build (-b)         Specify explicit tag to add to version number
```

A problem with this is that `setup.py --fullname` does not include the tag. Not really an issue with `-b`, a useful value might be `git log -1 --format=%h` for example.

Another thought: why go through all that trouble to extract the tarball?

```
easy_install myapp.tar.gz
```

Also: why not call `pack()` in deploy?

Better handling for `test_request_context` don't just append the port.
Also implemented a proper initial environment to use with `Flask.test_app()` based on the application's configuration.

Here's a fix for ticket 126.

I still suspect that a similar problem will rise when using app.test_client(). I'll investigate.

Recently I provided a fix for flask-script https://bitbucket.org/s0undt3ch/flask-script/changeset/6e7141f2d142 which provides a correct environment for test apps based on their configuration.

I think this fix should be implemented instead on Flask itself.

I'm attempting to work with flask under Jython, and I've encountered some failing unit tests in my initial investigations. 

On Jython sys is not implemented as a python module so unfortunately the code for dynamically creating the config module in the Config.from_pyfile method does not work as intended.

I created a patch so this module is created using the imp.new_module('config') rather than type(sys)('config').

replaced 'Drop all the templates there' with 'The templates you create later in the tutorial will go in this directory.'

The original wording was confusing to someone who I am teaching how to program using Flask.

When SERVER_NAME in conf is not None and different to "localhost",  app.test_request_context() will be failure.

Instead, we can do like this

```
  environ_overrides=dict(HTTP_HOST=app.conf['SERVER_NAME'],
                        SERVER_NAME=app.conf['SERVER_NAME'])

  app.text_request_context(environ_overrides=environ_overrides)
```

That's OK. Just look at above there is no issue in test_request_context, but what can extensions which use test_request_context do ? It is not a good idea if it handled by themselves.

For example, in Flask-Script's shell command, it will make a text_request_context and run shell in this context. If Flask-Script don't deal with SERVER_NAME environ, shell command will fail. 

I believe that Flask should do something for that because SERVER_NAME is imported by Flask and using in create_url_adapter method and others.

Hello, I just wanted to know if you were interested in this kind of syntactic sugar. That is:

@app.get(/bla/bla/)<br />
def do_something():

@app.post(/bla/bla)<br />
etc.

For the moment there are just @get and @post implementations. Of course the way it's implemented is really not rocket science, but at least it seems it does not break anything.

Just a small change to docs/patterns/packages.rst

The example code about using modules didn't mention the use of the url_prefix keyword argument to the register_module method on the app. When I created an app following the code examples this way, it wouldn't work until I debugged the problem and found that both the admin and frontend module "apps" were being mounted on '/' in the url map by default.

I made a small change to the code example and added an short explanation paragraph below to help explain this.

Fixed a trail-off sentence in docs, then passed through for obvious typos and word flow.

-Ron

Hope I did this right.  First time using github and using hg-git, as well.

I added our relaunched website.

noticed that the API docs claim that app.after_requests_funcs is updated by the **before_request()** decorator

It should be possible to assign a module to a domain. Currently you can only set subdomain.

Just wanted to clear up an ambiguity I ran into while trying to follow the user documentation. Not sure it's in the rightest right place, but basically I didn't realize that url_prefix needed to be explicity specified when calling register_module on the Flask object to register the imported modules from separate packages (as per the layout specified in http://flask.pocoo.org/docs/patterns/packages/#modules-and-resources)

First, I used this code in a private page:

```
headers = {"WWW-Authenticate": 'Basic realm="Login Required"'}
return Response(status=401, headers=headers)
```

It works well with werkzeug default container, but it has a problem with meinheld container.
When I request the page on meinheld, I got an "Internal Server Error" and error message:

```
[error] pid ..., File "meinheld/server/response.c", line 605 :TypeError: response item must be a string
```

I tried to find the cause and I found it.

Flask's `Response` class has a `response` parameter, it has the default value of `None`.
I think that a response body in the WSGI interface must be a `basestring`. So I suggest
to change `response` parameter's default value to `""`(a blank string).

Hey Armin - I may have screwed this up, still don't quite have the hang of git/github. 

If this is messed up let me know. The actual commit is http://github.com/cgrinds/flask/commit/4b1137b41a170583a734b6a9c367833c8e45cb33

If you are interested, I added a function to return padded JSON. I needed it for a project I'm working on and it seemed like the easiest thing to do was add the six lines of code into Flask.

Thanks for the awesome framework.

Tom

Version: 0.7dev

First, I supposed that the domain is "mydomain.org".

source tree:
- `mywebsite`
  - `__init__.py`
  - `mywww`
    - `__init__.py`
    - `static`
      - `test.txt`
  - `static`
    - `test.txt`

mywebsite/__init__.py:

```
from flask import Flask
import mywww
app = Flask(__name__)
app.config["SERVER_NAME"] = "mydomain.org"
app.register_module(mywww.app)
```

mywebsite/static/test.txt:

```
Failure...
```

mywebsite/mywww/__init__.py:

```
from flask import Module
app = Module(__name__) # This module hasn't a subdomain.
                       # It should route "http://mydomain.org/" not "http://sub.mydomain.org/"
@app.route("/")
def index():
    return "ok", 200
```

mywebsite/mywww/static/test.txt:

```
Success!
```

While running this application, a result of `http://mydomain.org/` is `ok`. Yes, it's expected. But a result of `http://mydomain.org/static/test.txt` is `Failure...`. It is routed `mywebsite/static/test.txt`, not `mywebsite/mywww/static/test.txt`. It is not expected.

If `mywww` has a subdomain, there is no problem.

```
app = Module(__name__, subdomain="sub")
```

`http://sub.mydomain.org/static/test.txt` puts `Success!`.

Hello,

it seems that request.data only has content if the mime type is unknown

I think it would be handy to be able to access the raw POST data even if the mime type is know:
for example i m POSTing a JSON string, but i don t want flask to unserialize it because i'll do it later.

The same with curl -d that add a mime type of application/x-www-form-urlencoded so, request.data is empty

The file uploading section of the documentation implicitly assumes in the provided example that you can safely validate an uploaded file by simply validating its filename extension. I think it's somewhat dangerous, and an example with mimetype validation should be used instead (or maybe just by adding a warning notice).

The version is 0.6.

I made a `flask.Module` with `subdomain` option.

```
from flask import Module
app = Module(__name__, subdomain="sub")
```

And when I use `url_for("static", ...)` in a template, it returns `"http://example.net/static"` instead of `"/static"`(`"http://sub.example.net/static"`). So I added some code for debugging to flask/app.py(line 512).

```
print options
```

Result is:

```
{'endpoint': 'static'}
{'subdomain': 'sub', 'endpoint': 'sub.favicon'}
{'subdomain': 'sub', 'endpoint': 'sub.index'}
...
```

The url rule for `static`, which is added automatically doesn't have a `subdomain` option.

I was trying to get deployment with fabric and distribute done like explained in the docs. However the deployment script always aborted with this error message

```
warning: manifest_maker: standard file 'setup.py' not found
```

So I tried for hours to find the problem and it seems that I have found it (although it is possible that the documented script works fine on other installations - I can only talk about my).

This is how the source code looks in the deploy function right now:

```
#...
with cd('/tmp/yourapplication'):
    run('tar xzf /tmp/yourapplication.tar.gz')
# now setup the package with our virtual environment's
# python interpreter
run('/var/www/yourapplication/env/bin/python setup.py install')
#...
```

I had to change it like this to make the script work:

```
#...
with cd('/tmp/yourapplication'):
    run('tar xzf /tmp/yourapplication.tar.gz')
# You have to be inside the folder where 'setup.py' resides
# in order to make it work
with cd('/tmp/yourapplication/%s' % dist):
    # now setup the package with our virtual environment's
    # python interpreter
    run('/var/www/yourapplication/env/bin/python setup.py install')
#...
```

Plus I changed `run('mkdir /tmp/yourapplication')` to `run('mkdir -p /tmp/yourapplication')` because after a failed deployment the dir has not been removed and the next deployment attempt prematurely ended "because the directory already existed"

Inside the deploy method 

```
# upload the source tarball to the temporary folder on the server
put('sdist/%s.tar.gz' % dist, '/tmp/yourapplication.tar.gz')
```

should be

```
# upload the source tarball to the temporary folder on the server
put('dist/%s.tar.gz' % dist, '/tmp/yourapplication.tar.gz')
```

(there is an s before dist)

Steps to reproduce:

```
(werk)mini:~ fz$ python
Python 2.6.1 (r261:67515, Dec 17 2009, 00:59:15) 
[GCC 4.2.1 (Apple Inc. build 5646)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import pydoc, flask
>>> pydoc.pager = lambda text: pydoc.pipepager(text, 'cat')
>>> help(flask)
Help on package flask:

flask = <module 'flask' from '/Volumes/Home/FZ/.local/repo/flask/flask/__init__.pyc'>
>>> 
```

No top-level documentation! Same problem with help(flask.app), help(flask.globals), help(flask.helpers), also via the pydoc -p web server. I found that it hinges on this:

```
>>> pydoc.text.docmodule(flask)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/Volumes/Home/FZ/.local/lib/python2.6/site-packages/pydoc.py", line 1100, in docmodule
    contents.append(self.docother(value, key, name, maxlen=70))
  File "/Volumes/Home/FZ/.local/lib/python2.6/site-packages/pydoc.py", line 1299, in docother
    repr = self.repr(object)
  File "/System/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/repr.py", line 24, in repr
    return self.repr1(x, self.maxlevel)
  File "/Volumes/Home/FZ/.local/lib/python2.6/site-packages/pydoc.py", line 955, in repr1
    return cram(stripid(repr(x)), self.maxother)
  File "/Volumes/Home/FZ/.local/env/werk/lib/python2.6/site-packages/werkzeug/local.py", line 321, in __repr__
    obj = self._get_current_object()
  File "/Volumes/Home/FZ/.local/env/werk/lib/python2.6/site-packages/werkzeug/local.py", line 306, in _get_current_object
    return self.__local()
  File "/Volumes/Home/FZ/.local/repo/flask/flask/globals.py", line 17, in <lambda>
    current_app = LocalProxy(lambda: _request_ctx_stack.top.app)
AttributeError: 'NoneType' object has no attribute 'app'
>>> 
```

and can be fixed by the following change (which I hope won't cause breakage elsewhere):

```
diff --git a/flask/globals.py b/flask/globals.py
index aac4655..0a17f56 100644
--- a/flask/globals.py
+++ b/flask/globals.py
@@ -14,7 +14,8 @@ from werkzeug import LocalStack, LocalProxy

 # context locals
 _request_ctx_stack = LocalStack()
-current_app = LocalProxy(lambda: _request_ctx_stack.top.app)
-request = LocalProxy(lambda: _request_ctx_stack.top.request)
-session = LocalProxy(lambda: _request_ctx_stack.top.session)
-g = LocalProxy(lambda: _request_ctx_stack.top.g)
+_top = _request_ctx_stack.top
+current_app = LocalProxy(lambda: _top.app if _top else None)
+request = LocalProxy(lambda: _top.request if _top else None)
+session = LocalProxy(lambda: _top.session if _top else None)
+g = LocalProxy(lambda: _top.g if _top else None)
```

Then one gets as expected, e.g.

```
>>> help(flask.globals)
Help on module flask.globals in flask:

NAME
    flask.globals

FILE
    /Volumes/Home/FZ/.local/repo/flask/flask/globals.py

DESCRIPTION
    flask.globals
    ~~~~~~~~~~~~~

    Defines all the global objects that are proxies to the current
    active context.

    :copyright: (c) 2010 by Armin Ronacher.
    :license: BSD, see LICENSE for more details.

DATA
    current_app = None
    g = None
    request = None
    session = None
```

See there:

http://hg.moinmo.in/moin/2.0-dev/rev/58eb8f978188

http://hg.moinmo.in/moin/2.0-dev/rev/25de9bb78a9f

Please apply upstream, having to have patched files is obviously a pain for packaging.

It should be possible to change the location/name of the static folder. A new keyword parameter to the package bound object should be added for that.

```
# just change the URL rule
module = Module(__name__, static_path='/_static')

# change the static folder's name and URL rule
module = Module(__name__, static_folder='media')
--> module = Module(__name__, static_path='/media', static_folder='media')

# a nested folder and it's URL rule:
module = Module(__name__, static_folder='assets/shared')
--> module = Module(__name__, static_path='/shared', static_folder='assets/shared')
```

Paths obviously relative to the root_path of the object.

The example at "Logging to file" has
'from logging.handlers import TheHandlerYouWant'
though it should be
'from logging import TheHandlerYouWant'

It would be interesting to implement ModuleLoader in flask. It would make a huge difference in GAE response times for flask applications.

The first time the FlaskrTestCase source code is shown the setUp method looks like this:

```
def setUp(self):
    self.db_fd, flaskr.DATABASE = tempfile.mkstemp()
    self.app = flaskr.app.test_client()
    flaskr.init_db()
```

Note `self.db_fd, flaskr.DATABASE = tempfile.mkstemp()`

The second time it looks like this:

```
def setUp(self):
    self.db_fd, flaskr.app.config['DATABASE'] = tempfile.mkstemp()
    self.app = flaskr.app.test_client()
    flaskr.init_db()
```

Note `self.db_fd, flaskr.app.config['DATABASE'] = tempfile.mkstemp()`

Now I think the first version is not that good because it relies on the settings to be declared inside flaskr.py. I tried to put the settings in another file and load them with `app.config.from_object(settings)` only to find out that my real database is used because obviously blog.DATABASE is not read at all in flaskr.py.

Note that there is the same problem with the `tearDown` method.

# Description

Need to qualify the call to escape() with Markup class. 
# Reference

http://flask.pocoo.org/docs/quickstart/#sessions

3.8 Sessions
Besides the request object there is also a second object called session that allows you to store information specific to a user from one request to the next. This is implemented on top of cookies for you and signs the cookies cryptographically. What this means is that the user could look at the contents of your cookie but not modify it, unless he knows the secret key used for signing.
In order to use sessions you have to set a secret key. Here is how sessions work:
The here mentioned escape() does escaping for you if you are not using the template engine (like in this example).
How to generate good Secret Keys
from flask import session, redirect, url_for, escape
@app.route(’/’) def index():
if ’username’ in session: return ’Logged in as %s’ % escape(session[’username’])
return ’You are not logged in’
# Bug Fix

---- replace line: if ’username’ in session: return ’Logged in as %s’ % escape(session[’username’])
---- with: if ’username’ in session: return ’Logged in as %s’ % Markup.escape(session[’username’])

In [Response object documentation page](http://flask.pocoo.org/docs/api/?highlight=response#flask.Response), the parameter 'status_code' is mentioned. It looks like its real name is 'status'.

If an URL rule has more than one handlers for different HTTP methods (typical for RESTful apps), OPTIONS will incorrectly report only the methods of the first handler.

Consider the following example:

```
@app.route('/things/<thing>')
def one_thing(thing):
    return "it's a " + thing + "!"

@app.route('/things/<thing>', methods=['PUT'])
def put_thing(thing):
    return "Thanks for the thing."
```

Performing an OPTIONS request on /things/foo incorrectly reports only the methods of the first handler:

```
$ curl -IXOPTIONS http://localhost:8080/things/foo
HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Allow: HEAD, OPTIONS, GET
...
```

Werkzeug gets it right though, if an invalid method is attempted:

```
$ curl -IXFOO http://localhost:8080/things/foo
HTTP/1.0 405 METHOD NOT ALLOWED
Content-Type: text/html
Allow: PUT, HEAD, OPTIONS, GET
...
```

I figure something along the lines of MapAdapter.match() in werkzeug/routing.py is required (loop through all matching handlers and add up the supported methods)

Thanks :-)

Not really a bug, but something worth mentioning in the documentation

the structure of the application is usually
application/**init**.py : creation of the app, registration of the modules
but then the modules don't have access to the "app" (cannot do 'from application import app')

how can we structure the app to have access to some global variables in all modules, etc?

if the app is only one module, it's okay because we already have the app, but if we're registering  modules, they don't  necessarily have access to the app  

I register a module using app.register_module(my_module)
my module has a url_prefix '/module '

when running on localhost, everything is fine, but when installing on
 a host, trying to fetch http://distant.host/module redirects me
  to http:// localhost /module

```
@app.signalhandler(template_rendered)
def handler…
```
# 

```
def handler…
template_rendered.connect(handler, app)
```

minor typo on the HTML/XHTML FAQ page (http://flask.pocoo.org/docs/htmlfaq/)

It says that <dl> closure is optional in HTML5, I believe you meant <dt>

Nice summary btw. 

The template documentation is currently spread out between quickstart and various functions in the api docs.  There should be a template chapter for:
- how autoescaping works and how it can be controlled (autoescape / safe, filenames) 
- basic jinja introduction and links to jinja docs
- what global functions and objects are available

There should be a way to automatically prefix all URLs with a language code for example and inject that value for all url_for calls that expect it.

When we want to show an error on a webserver to someone, we'd like the webserver to display the error as in debug mode, but not permit arbitrary code execution.

There should be an option to either disable completely the code execution but show the debug info on the page, or only allow code execution when it comes from localhost

Often one has to create a generic code for a website part that will be instantiated with different parameters to obtain efficient sub-applications for a website, Flask should include some metaprogramming capabilities (see http://pastebin.com/wAR7e8qh)

It would be nice that the (already fairly complete) documentation also hints at how to configure servers for production use (multiple backend servers, apache, nginx, python servers, etc) and how to setup werkzeug and wsgi middlewares in a regular flask application  

I found 2 little bugs in jqueryexample.py:
1. In import from flask missing jsonify
2. in template layout.html is 
`<script type=text/javascript src="{{ url_for('static', filename='app.js') }}"></script>`
, but app.js file is missing.

App.add_url_route allows the name of the route to be None, but Module.add_url_route requires all three arguments, but it should not really be necessary

Currently the upload docs mention subclassing request objects I think for uploads.

I'm using virtualenv to install my application, but when I do it cannot find any of the templates. I suspect the jinja_loader environment. The call looks something like this:

```
return render_template("admin/login.html",
                       form=form,
                       html=gen,
                       **request.args)
```

Here's a trace:

Traceback (most recent call last):
  File "/private/tmp/fooba/lib/python2.7/site-packages/Flask-0.5.1-py2.7.egg/flask/app.py", line 816, in **call**
    return self.wsgi_app(environ, start_response)
  File "/private/tmp/fooba/lib/python2.7/site-packages/Flask-0.5.1-py2.7.egg/flask/app.py", line 760, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/private/tmp/fooba/lib/python2.7/site-packages/Flask-0.5.1-py2.7.egg/flask/app.py", line 757, in wsgi_app
    rv = self.dispatch_request()
  File "/private/tmp/fooba/lib/python2.7/site-packages/Flask-0.5.1-py2.7.egg/flask/app.py", line 654, in dispatch_request
    return self.view_functions[req.endpoint](**req.view_args)
  File "/private/tmp/fooba/lib/python2.7/site-packages/cockerel-dev-py2.7.egg/cockerel/webapp/views/frontend.py", line 12, in index
    return render_template("frontend/index.html")
  File "/private/tmp/fooba/lib/python2.7/site-packages/Flask-0.5.1-py2.7.egg/flask/templating.py", line 74, in render_template
    return ctx.app.jinja_env.get_template(template_name).render(context)
  File "/private/tmp/fooba/lib/python2.7/site-packages/Jinja2-2.5-py2.7.egg/jinja2/environment.py", line 716, in get_template
    return self._load_template(name, self.make_globals(globals))
  File "/private/tmp/fooba/lib/python2.7/site-packages/Jinja2-2.5-py2.7.egg/jinja2/environment.py", line 690, in _load_template
    template = self.loader.load(self, name, globals)
  File "/private/tmp/fooba/lib/python2.7/site-packages/Jinja2-2.5-py2.7.egg/jinja2/loaders.py", line 115, in load
    source, filename, uptodate = self.get_source(environment, name)
  File "/private/tmp/fooba/lib/python2.7/site-packages/Flask-0.5.1-py2.7.egg/flask/templating.py", line 45, in get_source
    return loader.get_source(environment, template)
  File "/private/tmp/fooba/lib/python2.7/site-packages/Jinja2-2.5-py2.7.egg/jinja2/loaders.py", line 180, in get_source
    raise TemplateNotFound(template)
TemplateNotFound: frontend/index.html

It seems Flask doesn't support the conditional GET for static files. It always returns 200 OK, even though the file is older than the If-Modified-Since request header.

Consider the following example:

/static$ ls -l browser.css 
-rw-r--r-- 1 joh joh 600 2010-07-13 22:25 browser.css

Now perform a conditional GET with curl:

$ curl -I -z "Tue, 13 Jul 2010 20:37:52 GMT" http://localhost:8080/static/browser.css
HTTP/1.0 200 OK
Content-Type: text/css; charset=utf-8
Cache-Control: public, max-age=43200
Expires: Wed, 14 Jul 2010 08:42:44 GMT
ETag: "flask-1279052703.2-600-2392659594"
Date: Tue, 13 Jul 2010 20:42:44 GMT
Connection: close
Server: Werkzeug/0.6.2 Python/2.6.5

Just as a comparison, here's the correct response from Apache:

$ curl -I -z "Tue, 13 Jul 2010 20:37:52 GMT" http://localhost/jq.html
HTTP/1.1 304 Not Modified
Date: Tue, 13 Jul 2010 20:43:47 GMT
Server: Apache/2.2.14 (Ubuntu)
ETag: "1540072-3f-48b36b51d6983"
Vary: Accept-Encoding

This `after_request` handlers should be called in reverse order to ensure the very first registered handler should be called at last.

For example, I register `after_request` callback to close database session. As my code grows, I register few more `after_request` callbacks expecting that the very first callback registered will be called at last, but it doesn't.

When app.yaml has `static_dir` point to Flask application's `static/` directory, `os.path.exists` will always return `False` and thus causing `_PackageBoundObject.has_static_dir` to return `False` making static URL rule not being added at initialization. 

Example:
#### app.yaml

```
application: demo
version: 1
runtime: python
api_version: 1

handlers:
- url: /static
  static_dir: static

- url: /.*
  script: app.py
```
#### app.py

```
from google.appengine.ext.webapp.util import run_wsgi_app
from flask import Flask
app = Flask(__name__)

@app.route('/')
def demo():
    return str(app.has_static_folder)

def main():
    run_wsgi_app(app)

if __name__ == '__main__':
    main()
```

This will return `False` but will return `True` once I comment out the static handler. Current workaround is to add static rule myself, using `app.add_url_rule(app.static_path + '/<path:filename>', endpoint='static')` of sort. It would be nice of Flask detects GAE and add the static path anyway.

Cookies are not set correctly when SERVER_NAME is set. Investigate.

The domain information is not used to set the domain for the cookie of the session. The cookie is only set for path=/ for the current domain. If DOMAIN_NAME is set this should be used for setting session cookies for "." + DOMAIN_NAME.

I don't understand why `flask.helpers.jsonify` uses `current_app.response_class`, while `flask.helpers.send_file` uses `Response`.

Fixing this, you get rid of the circular dependency between `wrappers` and `helpers`.

It is a regression in the module branch : if json is not available, the framework is broken.

(make test fails with ImportError)

Flask should by default not apply autoescaping for templates from string as well as templates with a .txt extension and similar things.

This also means that use_reloader=True, debug=True works but debug=False, use_debugger=True does not.

The documentation should explain that Flask assumes utf-8 for templates.

The docs should link to the Flask-SQLAlchemy and Flask-WTF extensions in the sqlalchemy and wtforms patterns.

The information for nginx's send_file support is here:

http://wiki.nginx.org/NginxXSendfile

This might be the job of middleware (have the middleware hijack the X-Sendfile header and modify it for nginx), but it would be nice to support this natively.

They are missing currently but are a stable interface that one can rely on.

People often do `Flask(__name__)` when the app is not in the `__init__` which is a bad idea. Flask-SQLAlchemy also debugs based on that name so this should definitively be explained.

Furthermore the fact that `__name__` becomes `'__main__'` in modules started from within should be explained.

current send_file implement a traditional method to assign download filename,
according to RFC 5987 there is a method to have utf-8 encoding in it which is support by all modern browser nowadays,

I use this line to make it

```
rv.headers['Content-Disposition'] = "attachment; filename*=UTF-8''%s"%(urllib.quote_plus(filename.encode('utf-8')))
```

I am not using headers.add,
because you can see there have to use asterisk character which is nasty

ref:
- http://stackoverflow.com/questions/93551/how-to-encode-the-filename-parameter-of-content-disposition-header-in-http
- http://tools.ietf.org/html/rfc5987

Jsonify doesn't work with streaming in flask.
If I have a generator in a method that calls `yield jsonify({'test':'test'})`

and I call the generator with 
`return Response(stream_with_context(generator()), mimetype='application/json')`

then flask throws an error saying `application must write bytes`. 
For now I have resorted to using plain python `json.dumps(dict)`

This PR is an attempt to reconcile the fact that you can't have two routes with the same function name but you can create two routes with the same URL.

```
from flask import Flask
app = Flask("the_flask_module")

@app.route("/hello")
def hello_page():
    return "I'm a hello page"

@app.route("/different_route")
def hello_page():
    return "Different route"
```

will throw an `AssertionError`

but 

```
@app.route("/hello")
def end_point1():
    return "I'm a hello page"

@app.route("/hello")
def end_point2():
    return "Different route"
```

wont. In fact the second route is unreachable. 

This PR checks to see if three conditions are true before raising an assertion. The new rule has to have a `subdomain`, `url_path`, and one `method` that overlap with a current rule in the `self.url_map object`.

There's a couple of wonky pieces in this pull request that were required to get all of the unit tests to pass.

```
if prior_rule.rule == "/static/<path:filename>":
    continue
```

was required to get blueprints to not throw an assertion since each blueprint registers a `"/static/<path:filename>"` rule for each blueprint. I tried to find a way to not have to use a static string but alas I failed. 

Secondly 

```
 methods_minus_required = ((rule.methods & prior_rule.methods) 
     - required_methods)
```

is used to check for all explicitly registered methods for a route since there were a bunch of cases where the `OPTIONS` method was implicitly added to rules that shared a url_path.

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/1568)

<!-- Reviewable:end -->

Added links to websites and repositories. Changed the file to a markdown and now looks better. No contents changed

TEST


I have tests that make multiple requests.  After each test I'd like to pop the application context so it mimics the production environment as close as possible.  Basically I'm looking to prevent any persistence in `g` between requests.

What is the least painful way of implementing this?

Sample test:

``` python
def test(self):
    user_get = self.client.get('user')
    # pop context
    jobs_get = self.client.get('jobs')
```

`g` seems to be persisting longer than it should.  My understanding is that `g` only exists during a request's context.  It shouldn't be persisted across multiple separate requests.

**My auth handling**
When you visit the resource a token is used to determine who you are.  Once we get the user_id from that token we persist it like the below code.

``` python
if '_auth' not in g:
    g._auth = Auth(user_id=user)
return g._auth
```

**Test Setup**

``` python
def test(self):
    get = self.client.get('users', headers=make_headers())
    raise Exception(g._auth.user_id) # returns the user id outside the request context
```

Any ideas as to why `g` would be available?  Let me know if you need more information.  I wasn't sure how much to include.

I've created a MANIFEST.in file and added the include_package_data flag to setup as recommended in #84 and have confirmed that the template files do appear in the egg file installed into my virtualenv:

```
(test)david@snape:~$ unzip -l .virtualenvs/test/lib/python3.4/site-packages/hxl_proxy-0.3-py3.4.egg | grep error
      154  2015-08-26 16:48   hxl_proxy/templates/error.html
```

When I run from the source directory, all is fine.  When I try to run from the egg installed in the virtualenv, I get the following error:

```
Traceback (most recent call last):
  File "/home/david/.virtualenvs/test/lib/python3.4/site-packages/Flask-0.10.1-py3.4.egg/flask/app.py", line 1836, in __call__
    return self.wsgi_app(environ, start_response)
  File "/home/david/.virtualenvs/test/lib/python3.4/site-packages/Flask-0.10.1-py3.4.egg/flask/app.py", line 1820, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/home/david/.virtualenvs/test/lib/python3.4/site-packages/Flask-0.10.1-py3.4.egg/flask/app.py", line 1403, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/home/david/.virtualenvs/test/lib/python3.4/site-packages/Flask-0.10.1-py3.4.egg/flask/_compat.py", line 33, in reraise
    raise value
  File "/home/david/.virtualenvs/test/lib/python3.4/site-packages/Flask-0.10.1-py3.4.egg/flask/app.py", line 1817, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/david/.virtualenvs/test/lib/python3.4/site-packages/Flask-0.10.1-py3.4.egg/flask/app.py", line 1477, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/david/.virtualenvs/test/lib/python3.4/site-packages/Flask-0.10.1-py3.4.egg/flask/app.py", line 1379, in handle_user_exception
    return handler(e)
  File "/home/david/.virtualenvs/test/lib/python3.4/site-packages/hxl_proxy-0.3-py3.4.egg/hxl_proxy/controllers.py", line 44, in error
    return render_template('error.html', message=str(e)), status
  File "/home/david/.virtualenvs/test/lib/python3.4/site-packages/Flask-0.10.1-py3.4.egg/flask/templating.py", line 127, in render_template
    return _render(ctx.app.jinja_env.get_or_select_template(template_name_or_list),
  File "/home/david/.virtualenvs/test/lib/python3.4/site-packages/Jinja2-2.8-py3.4.egg/jinja2/environment.py", line 851, in get_or_select_template
    return self.get_template(template_name_or_list, parent, globals)
  File "/home/david/.virtualenvs/test/lib/python3.4/site-packages/Jinja2-2.8-py3.4.egg/jinja2/environment.py", line 812, in get_template
    return self._load_template(name, self.make_globals(globals))
  File "/home/david/.virtualenvs/test/lib/python3.4/site-packages/Jinja2-2.8-py3.4.egg/jinja2/environment.py", line 774, in _load_template
    cache_key = self.loader.get_source(self, name)[1]
  File "/home/david/.virtualenvs/test/lib/python3.4/site-packages/Flask-0.10.1-py3.4.egg/flask/templating.py", line 60, in get_source
    return loader.get_source(environment, local_name)
  File "/home/david/.virtualenvs/test/lib/python3.4/site-packages/Jinja2-2.8-py3.4.egg/jinja2/loaders.py", line 171, in get_source
    f = open_if_exists(filename)
  File "/home/david/.virtualenvs/test/lib/python3.4/site-packages/Jinja2-2.8-py3.4.egg/jinja2/utils.py", line 151, in open_if_exists
    return open(filename, mode)
NotADirectoryError: [Errno 20] Not a directory: '/home/david/.virtualenvs/test/lib/python3.4/site-packages/hxl_proxy-0.3-py3.4.egg/hxl_proxy/templates/error.html'
```

It's very useful and easy to modify travis.yml。

Change `Flask.__init__` to accept two new keyword arguments, `host_matching` and `static_host`.

This enables host_matching to be set properly by the time the constructor adds
the static route, and enables the static route to be properly associated with
the required host.

Previously, you could only enable host_matching once your app was already
instantiated (e.g. `app.url_map.host_matching = True`), but at that point
the constructor would have already added the static route without host matching
and an associated host, leaving the static route in a broken state.

Fixes #1559.

``` python
app = Flask(__name__)
app.url_map.host_matching = True
app.url_map._rules_by_endpoint['static'][0].host = 'mydomain.com'  # XXX better way to do this?
with app.test_request_context():
    print url_for('static', filename='foo', _external=True)
```

=>
`'http:///static/foo'`

Expected `'http://mydomain.com/static/foo'`.

Am I missing something, or is this a bug?

Thanks for looking and for the great work on Flask.

This fixes #1464 and adds some documentation on how to deploy with virtual environments.

See commits' details for justification.

Broken:
http://flask.pocoo.org/docs/flask-docs.pdf
http://flask.pocoo.org/docs/flask-docs.zip

Working:
http://flask.pocoo.org/docs/0.10/

Flask (0.10.1)
Flask-Cors (2.1.0)

What happens is on file upload from an iPhone 6 Safari, the flask server hangs when trying to access request.files.  The same iPhone with Chrome works fine.  I tried an even bigger file with Chrome, works fine too, so size doesn't seem to be the issue.

```
@app.route("/upload", methods=["POST"])
def upload():
  print request.files
```

For debugging purposes, here's what the environ shows with the Safari client:

```
   'environ': {'CONTENT_LENGTH': '1496190',                                                                                                                                                                     
               'CONTENT_TYPE': 'multipart/form-data; boundary=----WebKitFormBoundaryaQ6AnBdQhCxhm4b1',                                                                                                          
               'HTTP_ACCEPT': 'application/json, text/plain, */*',
               'HTTP_ACCEPT_ENCODING': 'gzip, deflate',
               'HTTP_ACCEPT_LANGUAGE': 'en-us',
               'HTTP_CONNECTION': 'keep-alive',
               'HTTP_HOST': '192.168.1.155:5000',
               'HTTP_ORIGIN': 'http://192.168.1.155:3000',
               'HTTP_REFERER': 'http://192.168.1.155:3000/',
               'HTTP_USER_AGENT': 'Mozilla/5.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Version/8.0 Mobile/12A365 Safari/600.1.4',                                     
               'PATH_INFO': '/upload',
               'QUERY_STRING': '',
               'REMOTE_ADDR': '192.168.1.137',                                                                                                                                                                  
               'REMOTE_PORT': 52871,                                                                                                                                                                            
               'REQUEST_METHOD': 'POST',
               'SCRIPT_NAME': '',
               'SERVER_NAME': '0.0.0.0',
               'SERVER_PORT': '5000',
               'SERVER_PROTOCOL': 'HTTP/1.1',
               'SERVER_SOFTWARE': 'Werkzeug/0.10.4',
               'werkzeug.request': <Request 'http://192.168.1.155:5000/upload' [POST]>,
               'werkzeug.server.shutdown': <function shutdown_server at 0x10bab2938>,                                                                                                                           
               'wsgi.errors': <open file '<stderr>', mode 'w' at 0x10ac741e0>,                                                                                                                                  
               'wsgi.input': <socket._fileobject object at 0x10baade50>,                                                                                                                                        
               'wsgi.multiprocess': False,
               'wsgi.multithread': False,
               'wsgi.run_once': False,
               'wsgi.url_scheme': 'http',
               'wsgi.version': (1, 0)},
```

And the HTML is classic:

```
<form method="POST" enctype="multipart/form-data">
  <input type="file" name="thefile" ...
```

Hello,

I'm running into the problem described in stackoverflow [here](http://stackoverflow.com/questions/24437248/unexplainable-flask-404-errors).

The code is running on the server normally and on my colleagues computers. Though on my computer for every route is returning a 404 error, though static content is working. The capture below shows that I'm working on the good port and the route exists.

<img width="1268" alt="capture d ecran 2015-08-11 a 10 13 26" src="https://cloud.githubusercontent.com/assets/4437159/9193157/abb09062-4011-11e5-98ef-7f8c7c17530a.png">

I reinstalled the virtuelenv and I still have this issues. Do you guys have ever encountered this problem?
I'm using Python 2.7.6 and flask:
Flask==0.10.1
Werkzeug==0.10.4
Jinja2==2.7.3
Any answer is welcome.

Cheers,
Alexis.

Start with server not install in virtualenv (works fine).

```
# setup env                                                                 
cd /tmp                                                                     
rm -rf dataserv                                                             
git clone https://github.com/Storj/dataserv                                 
cd dataserv                                                                 
virtualenv -p /usr/bin/python3 env                                          
env/bin/python setup.py develop                                             

# start server (XXX have to kill process manually)                          
./env/bin/python -m dataserv.app &                                          
sleep 5                                                                     

# test calls                                                                
curl http://127.0.0.1:5000/api/register/1EdCc5bxUAsdsvuJN48gK8UteezYNC2ffU  
curl http://127.0.0.1:5000/api/height/1EdCc5bxUAsdsvuJN48gK8UteezYNC2ffU/2  
```

Start with server install in virtualenv (raises 404s for some calls).

```
# setup env                                                                 
cd /tmp                                                                     
rm -rf dataservenv                                                          
virtualenv -p /usr/bin/python3 dataservenv                                  
./dataservenv/bin/pip install dataserv                                      

# start server (XXX have to kill process manually)                          
./dataservenv/bin/python -m dataserv.app &                                  
sleep 5 # wait for server to start                                          

# test calls                                                                
curl http://127.0.0.1:5000/api/register/1EdCc5bxUAsdsvuJN48gK8UteezYNC2ffU  
curl http://127.0.0.1:5000/api/height/1EdCc5bxUAsdsvuJN48gK8UteezYNC2ffU/2  
```

As part of my PhD research on code authorship, we calculated the Truck Factor (TF) of some popular GitHub repositories.

As you probably know, the [Truck (or Bus) Factor](https://en.wikipedia.org/wiki/Bus_factor) designates the minimal number of developers that have to be hit by a truck (or quit) before a project is incapacitated. In our work, we consider that a system is in trouble if more than 50% of its files become orphan (i.e., without a main author).

More details on our work in this preprint: https://peerj.com/preprints/1233

We calculated the TF for **Flask** and obtained a value of **1**.

The developer responsible for this TF is:

Armin Ronacher - author of 90% of the files 

To validate our results, we would like to ask **Flask** developers the following three brief questions:

(a) Do you agree that the listed developer is the main developer of **Flask**?

(b) Do you agree that **Flask** will be in trouble if the listed developer leave the project (e.g., if he wins in the lottery, to be less morbid)?

(c) Does **Flask** have some characteristics that would attenuate the loss of the listed developer (e.g., detailed documentation)?

Thanks in advance for your collaboration,

Guilherme Avelino
PhD Student
Applied Software Engineering Group (ASERG)
UFMG, Brazil
http://aserg.labsoft.dcc.ufmg.br/

I have this route

```
@app.@app.route(/resource/<string:myresource>/details')
def handler(myresource):
  ....
  ...
```

When I have a leading backslash in the name, it doesn't seem to be getting routed correctly.

This works:

```
 /resource/testresource/details/
```

This does not work:

```
 /resource/%5Ctestresource/details
```

Is this expected? What am I doing wrong?

I'm trying to implement a decorator function in Flask that does two things: register a page route and add some things to my DB on definition time, and then on runtime, when a request is made to a page it processes whether a user is authenticated.

I know that I can do these in two separate decorator functions, but this won't work because I eventually need to process the same set of information (app, rule, access groups, etc.) at both definition time and runtime.

The code below is what I have been messing with, but I have not been able to get it to work. It compiles and you are able to see "Definition time" in the console and "index" in the browser, but "Runtime" never gets printed. Can anyone suggest what I may be doing wrong?

``` python
from flask import Flask
from functools import wraps

app = Flask(__name__)


def register(app, rule, **options):
    def wrapper(f):
        print "Definition time"
        endpoint = options.pop('endpoint', f.__name__)
        access_groups = options.pop('access_groups', None)
        methods = options.get('methods', ['GET'])

        app.add_url_rule(rule, endpoint, f, **options)

        @wraps(f)
        def wrapped(*args, **kwargs):
            print "Runtime"
            return f(*args, **kwargs)
        return wrapped

    return wrapper


@register(app, '/', methods=['GET', 'POST'], access_groups=['all-access'])
def index():
    return "index"

if __name__ == '__main__':
    app.run(debug=True)
```


#1361, #1498, and #1494 seem to indicate that some people don't see Blueprints as templates for application behavior, but want to treat them as little self-contained applications that are composed onto the main application.  Effectively, we would be taking [the app composition pattern](http://flask.pocoo.org/docs/0.10/patterns/appdispatch/#app-dispatch) and building it into the API.

What sort of an API would we need to properly support app composition for such purposes, since that would solve all of these use cases (404 / 405 error handlers at the "Blueprint" level, only able to see its own templates, etc.)?

The minimum API is `Flask#mount_app(app_or_blueprint)` - but that still leaves a few questions:
1. Does the parent app need to be able to route to sub-app routes via `url_for`?
2. Does the child app need to be able to route to parent or sibling-app routes via `url_for`?
3. Ditto for `static` and `templates` (although #1361 suggests that such uses would want the static and template folders to be distinct).
4. Other questions which I am certainly missing

What do _you_ need from Blueprints?  What else would you _expect_ `Flask#mout_app` to do?

It should be imported as:

> from werkzeug.utils import secure_filename

Not:

> from werkzeug import secure_filename

see http://werkzeug.pocoo.org/docs/0.10/utils/

Hi, 
looks like you have some issues with website:
Documentation:
- http://flask.pocoo.org/docs/flask-docs.pdf returns 404
- http://flask.pocoo.org/docs/flask-docs.zip returns 404
- feedback.flask.pocoo.org "Server not found"

An main question (why I try to use "feedback"):
- Any plans to full Python 3 support?

using the following html form

``` HTML
<h1>Debug Form</h1>
<form action="/debug" method="POST">
<input name="item[1][name]" value="" />
<input name="item[2][name]" value="" />
<button type="submit">test</button>
</form>
```

to the following flask application method / view

``` python
@app.route('/debug', methods=["GET","POST","PUT","PATCH","DELETE"])
def debug_info():
    return jsonify({"data":request.data,"formdata":request.form})
```

I get

``` JSON
{
  "data": "", 
  "formdata": {
    "item[1][name]": "fdhnnhdsfsdslkkl", 
    "item[2][name]": "djdfhdjfh"
  }
}
```

I expected to see

``` JSON
{
  "data": "", 
  "formdata": {
    "item":[
      {
         "name": "fdhnnhdsfsdslkkl"
       },
       { 
         "name": "djdfhdjfh"
       }
    ]
  }
}
```

The first and actual output requires further, more explicit parsing, from a sub-optimal data structure to achieve a nice dictionary; but I cannot see how the flat structure of the request.form object could be helping anyone...

is a good function

In the docs the section [The Status of Python 3](https://github.com/mitsuhiko/flask/blob/master/docs/advanced_foreword.rst) states that you _strongly recommend using Python 2.6 and 2.7_.

Well, isn't it about time to officially recommend to use Python 3 instead? Has this been discussed before (recently)?

I myself at least never ran in any problems using Python 3 with Flask. Though, admittedly, I don't have any large projects or unusual dependencies - or maybe I just instinctively avoid anything that's not Python 3 compatible and thus never noticed problems.

Still, it seems to me that a recommendation to Python 3 is reasonable, unless you have special dependencies, and it doesn't look to me that there are many (active) Flask-\* packages that require Python 2.

I made the changes to correct the error when serializing json array

Flask version is 0.10.1 and the below is code of server side.

``` python
from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello World!'

if __name__ == '__main__':
    app.run()
```

The below is input and output of `netcat` tool.

``` http
GET foo://127.999.999.999/ HTTP/1.1

HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 12
Server: Werkzeug/0.10.4 Python/2.7.10
Date: Tue, 28 Jul 2015 02:56:03 GMT

Hello World!
```

I am using flask-wtf v0.12
Regarding to this guide: https://github.com/mitsuhiko/flask/wiki/Large-app-how-to

![screen shot 2015-07-26 at 2 28 21 pm](https://cloud.githubusercontent.com/assets/2663509/8895502/ded8471c-33a2-11e5-8d94-50aef9a33875.png)

Does anyone know is the guide obsolete or am i missing something on the setup?

The idea of a metaclass _"that replaces itself with the actual metaclass"_ is really clever. Yet I cannot help but suspect that the current implementation of function `with_metaclass` is just a bit too much.

Why does the dummy metaclass extend the one to apply?

It never utilizes any of the base class' resources, except for the base class itself. Since this is done by direct invocation (not via `super()` or something), there should be no need to inherit from the caller-provided type in the first place.

Furthermore, given that the above obvservation is correct, there should be no need to explicitly utilize `type.__call__` and `type.__init__` any more. Not only because one can directly inherit from `type` here, but also because both seem to be required due to the aforementioned inheritance only: If the given `meta` class implements custom magic, the creation of the `temporary_class` could fail. Or even worse; succeed but silently misinterprete arguments.

Speaking of the `temporary_class` creation (and still assuming all of the above assumptions to be correct): There's no need to do that via the `metaclass` constructor at all, which actually saves not only the additional function call but also the condition within `__new__`.

Given I didn't miss something (and there is indeed no actual reason for the metaclass to extend the one to apply), then I believe the patch suggested with this pull request to significantly improve the code without changing any of the expected behavior.

Fixes #1528

New approach has only one drawback: in any custom tests that require sessions, you need to call `ctx_open_session` directly. I fixed existing tests in flask, but any user test may fail.

Fixes issue #1361.

Since the cli module does does fairly aggressive autodiscovery of a
flask application object anyway, supporting argument-less factory
functions is not far from the current behavior.

Argument-less factory function do happen if you configuration is based on your environment. There's a whole pattern around it (see http://12factor.net) that Heroku uses. I've written a Flask-Extension to support it (http://github.com/mbr/flask-appconfig) and I want to make sure it integrates well with the 1.0 CLI features.

While it is possible to write a script to get the same functionality, this is a bit of a convention-over-configuration issue and seeing that the CLI already searches pretty thoroughly for an app instance, looking for a callable `create_app()` function seems reasonable (and very useful!) to me.

This may get a bit confusing if `create_app()` does exepct arguments, but the resulting 

```
TypeError: create_app() takes exactly 1 argument (0 given)
```

seems very clear.

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/1536)

<!-- Reviewable:end -->

Sorry, i should have tested this first and not rely on my IDE.

Actually in python 2.7 this causes `AttributeError: 'BuildError' object has no attribute 'with_traceback'`

Therefore this has to be reverted.

Reverts mitsuhiko/flask#1534

- a raises statement with multiple values is no longer allowed in python 3
- It's just a documentation change, no functionality changed.

- caused by changes in the execution model of python 3 where the alias of an except clause is cleared on exit of the except
- tested with python 2.7.10 and 3.4.3

Fix #1531 

Since gevent 1.0, it has switched from libevent to libev, please refer: http://www.gevent.org/ and http://blog.gevent.org/2010/02/27/why-gevent/.

I would like to submit a pull request for this doc page: http://flask.pocoo.org/docs/0.10/deploying/wsgi-standalone/, please confirm this update and I will prepare the pull request, thanks!

Fixes issue #1529 
Signed-off-by: Aayush Kasurde aayush.kasurde@gmail.com

While debugging issue #1517 , found that `app.run()` line is missing in `jqueryexample.py`

RequestContext push is called in [wsgi_app method](https://github.com/mitsuhiko/flask/blob/master/flask/app.py#L1952), outside try..finally block. In [push() method](https://github.com/mitsuhiko/flask/blob/master/flask/ctx.py#L332) application's open_session call takes place, which can possibly lead to exception. But, since original call is not in try..finally block, removal of stack top never takes place. This leads to following problems:
### 1. Application context stack never updates again

RequestContext.push() only [checks](https://github.com/mitsuhiko/flask/blob/master/flask/ctx.py#L316) that application context exists or belongs to current application, but same rules apply to previous context.
### 2. Request context stack grows

Again, request context stack is pushed, but never removed. Actually just a memory leak :)
### 3. Misleading code comment about open_session usage

Inspired by [this comment](https://github.com/mitsuhiko/flask/blob/master/flask/ctx.py#L328), i started to develop multi-tenant application, and found nothing but disappointment. **You can't actually access request_context before open_session interface call.** This means, you can't configure which database to use before opening a session.
## My proposition.

Move open_session call to full_dispatch_request, and add interfaces and methods, similar to before_request - before_open_session, or call before_request before opening session (may break code that depends on session interface)

There is a misprint at http://flask.pocoo.org/docs/0.10/patterns/fileuploads/

`from werkzeug import secure_filename`

which is fixed in this [this repo](https://github.com/mitsuhiko/flask/blob/master/docs/patterns/fileuploads.rst)

`from werkzeug.utils import secure_filename`

I'm testing the behavior of a POST endpoint that issues a redirect.

I get the following traceback:

```
env/local/lib/python2.7/site-packages/flask/app.py:1820: in wsgi_app
    response = self.make_response(self.handle_exception(e))
env/local/lib/python2.7/site-packages/flask/app.py:1403: in handle_exception
    reraise(exc_type, exc_value, tb)
env/local/lib/python2.7/site-packages/flask/app.py:1817: in wsgi_app
    response = self.full_dispatch_request()
env/local/lib/python2.7/site-packages/flask/app.py:1477: in full_dispatch_request
    rv = self.handle_user_exception(e)
env/local/lib/python2.7/site-packages/flask/app.py:1381: in handle_user_exception
    reraise(exc_type, exc_value, tb)
env/local/lib/python2.7/site-packages/flask/app.py:1475: in full_dispatch_request
    rv = self.dispatch_request()
env/local/lib/python2.7/site-packages/flask/app.py:1453: in dispatch_request
    self.raise_routing_exception(req)
env/local/lib/python2.7/site-packages/flask/app.py:1439: in raise_routing_exception
    raise FormDataRoutingRedirect(request)
env/local/lib/python2.7/site-packages/flask/debughelpers.py:68: in __init__
    AssertionError.__init__(self, ''.join(buf).encode('utf-8'))
E   TypeError: unbound method __init__() must be called with AssertionError instance as first argument (got FormDataRoutingRedirect instance instead)
```

I understand the context around why we need to raise FormDataRoutingRedirect - and don't mind asserting that it's raised in my test. The problem here is the `TypeError: unbound method __init__() must be called with AssertionError`.

I'll see if I can fix it a bit later but wanted to report it first. I checked the other reported issues.

I'm using Python 2.7.9 and Flask 0.10.1

I have an issue with Flask + eventlet server, details in [this link](http://serverfault.com/q/703992/172260).

I integrated Flask with Openstack keystone middleware to authenticate for my Flask API server.

```
config_file = None
if config_file:
    prepare_service([None, '--config-file', config_file])
else:
    prepare_service()

application = setup_app()
application.wsgi_app = middleware.install_keystone_middleware(application.wsgi_app, cfg.CONF)
```

I profiled in Flask server and all things is normal, the server running time for each APIs is very low, from 2 to 20 ms.

```
--------------------------------------------------------------------------------                                           [5994/9927$
PATH: '/api/line_usages'
         6913 function calls (6817 primitive calls) in 0.019 seconds

   Ordered by: internal time
   List reduced from 748 to 5 due to restriction <5>

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
       50    0.001    0.000    0.002    0.000 /usr/lib/python2.7/logging/__init__.py:451(format)
       50    0.001    0.000    0.004    0.000 /opt/dev_myservice/openstack/common/log.py
:626(format)
        2    0.001    0.000    0.001    0.000 {method 'query' of '_mysql.connection' objects}
       50    0.001    0.000    0.001    0.000 {method 'write' of 'file' objects}
       25    0.001    0.000    0.001    0.000 /usr/lib/python2.7/logging/__init__.py:242(__init__)
```

But the response to client is still long. What is the reason for Flask slow response time and how can I solve this?

I'm getting the following error:

Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1836, in **call**
    return self.wsgi_app(environ, start_response)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1820, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1403, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1817, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1477, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1381, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1475, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1461, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "flask/examples/minitwit/minitwit.py", line 122, in user_timeline
    [username], one=True)
TypeError: string indices must be integers, not unicode

I get an exception when I attempt to use a relative import with Flask in debug mode.
### Steps to reproduce

My package looks like this:

```
mypkg\
  __init__.py
  mymodule.py
```

Here's `__init__.py`:

```
xyz = 123
```

And in `mymodule.py`:

```
from flask import Flask
from . import xyz

app = Flask(__name__)
app.run(debug=True)
```

Run the application using `python -m mypkg.mymodule`. I'm using Python 3.4.3 on a Windows machine, with Flask 0.10.1 (the version from PyPI).
### Actual results

The usual "you attempted to use a relative import but you're not in a package" exception:

```
Traceback (most recent call last):
  File "...\mymodule.py", line 2, in <module>
    from . import xyz
SystemError: Parent module '' not loaded, cannot perform relative import
```

If you remove `debug=True`, or use an absolute import (`from mypkg import xyz`), there is no error. The error persists if you name your module `__main__.py` (instead of `mymodule.py`) and use `python -m mypkg`. The error persists if you attempt to import a name from a submodule of the package (it's nothing to do with the import being from `__init__.py`).

I'm guessing it's something to do with Flask's magical reloading of edited files in debug mode.
### Expected results

No error; `xyz` is imported as usual.

合并原作者代码

I've been using Flask for about a month now and i can say that it's pretty awesome.

The one thing that annoys me is the "application context" and it's lack of proper documentation.

I understand that app context makes you able to instantiate multiple apps in a single python process. But i've been thinking for quite a while about what is a proper use case for this? can the documentation provide an example about why and how to do this?

In addition, if faced with "working outside application context" exception, how do you overcome this? for example in a celery task. Do we use something like, [Flask Celery Helper](https://github.com/Robpol86/Flask-Celery-Helper)? Because even using the Celery object alone would still result in such exception being raised inside whatever we do inside the celery task itself. That has been kind of a debugging nightmare.

Many Thanks



Hello everybody.

Please, forgive my poor english, and do not get me wrong, my question is not malicious.

Actually, are any plans to reach version 1.0? Or at least reach a new version?

1.0, or a more fluid release versions can be a way to attract more users and developers.

Greetings, and thanks for the work you do in Flask.

Hi,

I just downloaded the sourcecode for the AJAX with jQuery example (http://flask.pocoo.org/docs/0.10/patterns/jquery/). 

When i try and run index.html, it gives me an error: "Uncaught ReferenceError: $ is not defined" for index.html:5.
For layout.html, it gives 2 errors:
"GET http://localhost/templates/script.js" for layout.html:5
"Uncaught SyntaxError: Unexpected token {" for layout.html:7

Consequently, the example doesn't work as no result is generated if you put 2 numbers in the input boxes.

Cheers

i met cross-domain and i use this decorate to solve this problem,
    http://flask.pocoo.org/snippets/56/
but only if
@crossdomain(origin='*') 
can success,and when i try to point a specific domain such as @crossdomain(origin="test.123.com") or 
@crossdomain(origin=["test.123.com"]), it failed. what should i do to point a specific domain?
i need help, thx.

Previous pull request was #1176

Update the first example program in documentation to be consistent with the official website.

I think the first application should be (and the official site is):

``` python
from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello World!'

if __name__ == '__main__':
    app.run()
```

In this doc it's missing:

``` python
if __name__ == '__main__':
    app.run()
```

Hi. 
I wrote a post about benchmarking some web frameworks and found a strange bug in Flask.
Requests per seconds were very low and not above 600 req/s. @miguelgrinberg contacted me about it and first thought that the issue was on my side but he also experienced the same behaviour.

Here is the Link to the Blogpost:
https://medium.com/@tschundeee/express-vs-flask-vs-go-acc0879c2122

Something might be blocking requests in Flask or Werkzeug.

I am willing to help towards inverstigation. 
Cheers Bijan

``` diff
diff --git a/tests/test_basic.py b/tests/test_basic.py
index 695e346..1e064ff 100644
--- a/tests/test_basic.py
+++ b/tests/test_basic.py
@@ -387,6 +387,7 @@ def test_session_special_types():
         flask.session['dt'] = now
         flask.session['b'] = b'\xff'
         flask.session['t'] = (1, 2, 3)
+        flask.session['spacefirst'] = {' t': 'not-a-tuple'}
         return response

     @app.route('/')
@@ -403,6 +404,7 @@ def test_session_special_types():
     assert rv['b'] == b'\xff'
     assert type(rv['b']) == bytes
     assert rv['t'] == (1, 2, 3)
+    assert rv['spacefirst'] == {' t': 'not-a-tuple'}


 def test_session_cookie_setting():
```

While I don't see any cases where this would be likely to result in security problems (it would require custom types that are not safe to recreate with arbitrary arguments AND code that serializes a dict with both the key and value being provided by the user), I don't like that there's any input where `value != loads(dumps(value))` without an exception.

Two ways to fix this:
- raise an exception when trying to encode a dict that has a single item with a key starting with a space.
- tag such dictionaries so they are decoded properly instead of being decoded as if they are a valid tagged it em


While easy to implement with a custom `app_ctx_globals_class` class, I believe these two methods are useful enough to add them to the default class.

Especially setdefault makes lots of sense if you e.g. cache something on the app context globals and thus want to do something like this:

``` python
cache = g.setdefault('whatever_cache', {})
try:
    return cache['foo']
except KeyError:
    rv = cache['foo'] = get_foo()
    return rv
```

In flask-0.10.1, I can't find `SESSION_REFRESH_EACH_REQUEST` in `default_config`. But `SESSION_REFRESH_EACH_REQUEST` is in the doc. 
That means, in flask-0.10.1, there are 23 elements in `default_config`, but 24 in the doc of the flask.

So imagine I'm building an API from a set of blueprints like

```
<snip from the signup.py file>
signupbp = Blueprint('signupbp', __name__, url_prefix="/signup")

@signupbp.route("/")
def signup_start():
    return "signup_start"

@signupbp.route("/complete")
def signup_complete():
    return "signup_complete"
```

then in my main.py code I do something like:

```
app.register_blueprint(signupbp, url_prefix='/api')
```

I expect to see the following routes:

```
/api/signup/                    signupbp.signup_start   
/api/signup/complete            signupbp.signup_complete
/static/<path:filename>         static                  
```

What I actually see is:

```
/api/                    signupbp.signup_start   
/api/complete            signupbp.signup_complete
/static/<path:filename>  static                  
```

I imagine the url_prefixes should be additive not replacement (in the worse possible way). I've tried all combinations of `/` before and after the url_prefix params.

This is actually a very simplified example - in my API I'm using module names to implement versioning so I can't build the URL into any part of the code before thats suggested as a solution.

Hello!
The flash(...) function doesn't work at me – it raises an internal server error!

My code:
@app.route('/')
def main():
    flash('This message will be visible!')
    return str(get_flashed_messages())

that's all! And with just return "xxx" it works.

What's the problem? I'm using python 2.6.

I'm trying to port an application to python 3 and ran into this encoding issue with this unit test:

``` python
        with app.test_request_context():
            from flask import jsonify
            test_data = {'test': 1}
            response = jsonify(test_data)
            self.assertEqual(
                response.response,
                [json.dumps({'test': 1}, indent=2)]
            )
```

and getting this:

```
E           AssertionError: Lists differ: [b'{\n  "test": 1\n}'] != ['{\n  "test": 1\n}']
E
E           First differing element 0:
E           b'{\n  "test": 1\n}'
E           {
E             "test": 1
E           }
E
E           - [b'{\n  "test": 1\n}']
E           ?  -
E
E           + ['{\n  "test": 1\n}']
```

so it appears that somewhere along the line the returned json isn't getting decoded to UTF-8 and results in having the `b` designator in the output.  Is this maybe just something I'm doing wrong? The test passes in Python 2.7.

I'm using these versions and Python 3.4.2 and 3.3.6:

```
Flask==0.10.1
Flask-Assets==0.10
Jinja2==2.7.3
MarkupSafe==0.23
Werkzeug==0.10.4
itsdangerous==0.24
```

everytime when I changed some file , the flask will autoreload, but the reload process is too slow!
how solve this ?

![reload](https://cloud.githubusercontent.com/assets/3492992/8229198/4d64d922-15e7-11e5-836d-f813e94fdf1a.png)

I'm using nginx + gunicorn + flask. With request.url_root  i can not detect schema correctly because it's always http! although i'm routing with https configured in nginx!
e.g i browse this url:

```
https://www.example.com/hello
```

and request.url reads:

```
http://www.example.com/hello
```


Update ReST ref link from non-existent `python3-support` to working `python3` page.

Thanks!

The following code is in the tutorial:

``` python
@app.route('/add', methods=['POST'])
def add_entry():
    if not session.get('logged_in'):
        abort(401)
    g.db.execute('insert into entries (title, text) values (?, ?)',
                 [request.form['title'], request.form['text']])
    g.db.commit()
    flash('New entry was successfully posted')
    return redirect(url_for('show_entries'))
```

The second arg to `execute` should be a tuple, not a list.  `g.db.execute('INSERT INTO entries(title,text) VALUES(?,?)',(request.form["title"],request.form["text"]))`


Reproduce the bug:
- make a blueprint with an errorhandler for 404
- register the blueprint on the main app under `url_prefix="/blue"`

Now, if you visit some not existent page under blueprint url prefix, like `/blue/notExist` you will recive response from the main app 404 error handler.

The only way to trigger the blueprint 404 error handler is by calling `abort(404)` from within the blueprint.

The correct behaviour would be to choose which error handler to activate also on the basis of the `url_prefix` parameter.

``` Python
import unittest
from flask import Flask, Blueprint, abort, request


app = Flask(__name__)
myblueprint = Blueprint('myblueprint', __name__)

@myblueprint.route('/hello', methods=['GET'])
def hello():
    return 'hello world!'

@myblueprint.route('/forced_404', methods=['GET'])
def forced_404():
    abort(404)

myblueprint.errorhandler(404)(lambda e: ('myblueprint 404', 404))

app.register_blueprint(myblueprint, url_prefix="/blue")

app.errorhandler(404)(lambda e: ('app 404', 404))


class BlueprintOrAppTestCase(unittest.TestCase):

    def setUp(self):
        self.client = app.test_client()

    def test_200(self):
        resp = self.client.get('/blue/hello')
        self.assertEqual(resp.status_code, 200)
        self.assertEqual(resp.get_data(True), 'hello world!')

    def test_404_main(self):
        with app.test_client() as client:
            resp = client.get('/notExist')
            self.assertEqual(resp.status_code, 404)
            self.assertEqual(resp.get_data(True), 'app 404')

    def test_404_blueprint(self):
        with app.test_client() as client:
            resp = client.get('/blue/notExist')
            self.assertEqual(resp.status_code, 404)
            self.assertEqual(resp.get_data(True), 'myblueprint 404')
            self.assertEqual(request.blueprint, 'myblueprint')

    def test_404_forced_blueprint(self):
        with app.test_client() as client:
            resp = client.get('/blue/forced_404')
            self.assertEqual(resp.status_code, 404)
            self.assertEqual(resp.get_data(True), 'myblueprint 404')
            self.assertEqual(request.blueprint, 'myblueprint')

if __name__ == '__main__':
    # app.run(host="0.0.0.0", use_reloader=True)
    unittest.main()
```

Response:

``` Python
.F..
======================================================================
FAIL: test_404_blueprint (__main__.BlueprintOrAppTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "asd.py", line 43, in test_404_blueprint
    self.assertEqual(resp.get_data(True), 'myblueprint 404')
AssertionError: u'app 404' != 'myblueprint 404'

----------------------------------------------------------------------
Ran 4 tests in 0.013s

FAILED (failures=1)
```

The two links on (http://flask.pocoo.org/community/) to give feedback (http://feedback.flask.pocoo.org/) throw a 404 error.


Added a Q & A to a README from information found throughout the web

I really like being able to override the error templates for each blueprint using their errorhandler methods. All error codes work great for me. Except one. 405's are _AFAIK_ not catchable by the blueprint. This is a bit unfortunate when you have a JSON REST API where you want your consumers to be able to parse the data that they get back.

[This line in `werkzeug.routing`](https://github.com/mitsuhiko/werkzeug/blob/2b2d921eea7d1f896ce436ec5238890abe8b81bf/werkzeug/routing.py#L1558) is where the exception is raised. I feel a bit lost about the whole flow of a request in werkzeug/flask and don't really have any idea what I could do to be able to catch it in the Blueprint. Is this a bug? A known "feature"? Or am I doing something wrong?

Here's a test case which shows this behavior:

``` python
import unittest
from flask import Flask, Blueprint, request

app = Flask(__name__)
myblueprint = Blueprint('myblueprint', __name__)


@myblueprint.route('/', methods=['GET'])
def hello():
    return 'hello world!'

myblueprint.errorhandler(405)(lambda e: ('myblueprint 405', 405))
app.register_blueprint(myblueprint)
app.errorhandler(405)(lambda e: ('app 405', 405))


class BlueprintOrAppTestCase(unittest.TestCase):

    def setUp(self):
        self.client = app.test_client()

    def test_200(self):
        resp = self.client.get('/')
        self.assertEqual(resp.status_code, 200)

    def test_405(self):
        with app.test_client() as client:
            resp = client.post('/?http405')
            self.assertEqual(resp.status_code, 405)
            self.assertEqual(resp.get_data(True), 'myblueprint 405')
            self.assertEqual(request.blueprint, 'myblueprint')


if __name__ == '__main__':
    # app.run(use_reloader=True)
    unittest.main()
```

Running this gives:

``` python-traceback
.F
======================================================================
FAIL: test_405 (__main__.BlueprintOrAppTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "test.py", line 30, in test_405
    self.assertEqual(resp.get_data(True), 'myblueprint 405')
AssertionError: 'app 405' != 'myblueprint 405'
- app 405
+ myblueprint 405


----------------------------------------------------------------------
Ran 2 tests in 0.013s

FAILED (failures=1)
```

A version which tests more error codes can be found [in this gist](https://gist.github.com/jmagnusson/477d209ca3cee464674d).

I would love to see this project updated, but it seems to have been abandoned by its creator. Still doesn't support Python 3 and hasn't given any love to PyPI for almost 4 years. It seems impossible to get in contact with the creator. This PR removes the reference of `Flask-Uploads` from the docs. Another option would be to have a NOTE about it being abandoned. I think it also makes sense to remove it from the [Flask extensions list](http://flask.pocoo.org/extensions/) (where's the repo for that?)

[Here's a 2 year old ticket on Bitbucket that fixes Python 3 support](https://bitbucket.org/leafstorm/flask-uploads/pull-request/5/modernizing/diff). No reply what-so-ever from @leafstorm. His last public activity on Bitbucket was three years ago.

I'll e-mail him with a reference to this ticket to see if we can get a reply. Perhaps with this ticket we can get the project owner's attention.

The best alternative would of course be to get development going on the project again, perhaps by adding more contributors to the project. Let me know how you feel about all of this. :blush:

Is a new version planned?
Last version 0.10.1 is very old : on Jun 14, 2013 

A lot of things are trivial, or debatably trivial, but this is not one of them :)

Hey guys,

I tried seeking help on SO, but couldn't get any feedback.  Thought I'd reach out to the Flask community.

I'm trying to insert a new row through sqlalchemy. The parent table (Milestone) has a child table called Funding. Both tables share a relationship through a column called milestone_id. It is a one to one relationship.

I have looked it up, but I can't figure out how to reference the milestone_id when INSERTING a new row in the Funding table. The parent ID is an autoincrement. I am using Flask and SqlAlchemy.

models:

``` python
class Milestone(db.Model):
    __tablename__ = "**************"

   milestone_id = db.Column(db.Integer, primary_key=True)
   company_id = db.Column(db.Integer, db.ForeignKey('stlines_startups.company_id'))
   milestone_date = db.Column(db.Integer)
   snapshots = db.relationship('Snapshot', uselist=False, primaryjoin='Milestone.milestone_id==Snapshot.milestone_id', backref='milestone')
   fundraising = db.relationship('Funding', uselist=False, primaryjoin='Milestone.milestone_id==Funding.milestone_id', backref='milestone')

   def __init__(self, milestone_id, company_id, milestone_date, snapshots = [], fundraising = []):
    self.milestone_id = milestone_id
    self.company_id = company_id
    self.milestone_date = milestone_date
    self.snapshots = snapshots
    self.fundraising = fundraising

class Funding(db.Model):
    __tablename__ = "**************************"

   funding_id = db.Column(db.Integer, primary_key=True)
   funding_type = db.Column(db.Text)
   funding_message = db.Column(db.Text)
   funding_amount = db.Column(db.Integer)
   milestone_source = db.Column(db.Text)
   company_id = db.Column(db.Integer, db.ForeignKey('stlines_milestones.company_id'))
   milestone_id = db.Column(db.Integer, db.ForeignKey('stlines_milestones.milestone_id'))
   user_id = db.Column(db.Integer)
   funding_timestamp = db.Column(db.Integer)

def __init__(self, funding_id, funding_type, funding_message, funding_amount, milestone_source, milestone_id, company_id, user_id, funding_timestamp):
    self.funding_id = funding_id
    self.funding_type = funding_type
    self.funding_message = funding_message
    self.funding_amount = funding_amount
    self.milestone_source = milestone_source
    self.milestone_id = milestone_id
    self.company_id = company_id
    self.user_id = user_id
    self.funding_timestamp = funding_timestamp
```

Alchemy Query:

``` python
@app.route('/_add_funding')
def add_funding():
    funding_type = request.args.get('funding_stage', '', type=str)
    funding_message = request.args.get('funding_message', '', type=str)
    funding_amount = request.args.get('funding_amount', 0, type=int)
    milestone_source = request.args.get('milestone_source', '', type=str)
    milestone_date = request.args.get('milestone_date', '', type=str)
    company_id = request.args.get('company_id', '', type=int)

    milestone_date_final = datetime.datetime.strptime(milestone_date, '%B %d, %Y')

    ''' In this line, I try to reference milestone_id with new_milestone.milestone_id, but nothing shows up in the database '''
    new_funding = Funding('', funding_type=funding_type, funding_message=funding_message, funding_amount=funding_amount, milestone_source=milestone_source, company_id=company_id, milestone_id=new_milestone.milestone_id, user_id='1', funding_timestamp=milestone_date_final)
    new_milestone = Milestone('', company_id=company_id, milestone_date=milestone_date_final, snapshots=None, fundraising=new_funding)
    db.session.add(new_milestone)
    output = new_milestone.milestone_id
    db.session.commit()

    return jsonify(result=output)
```

How can I tell SqlAlchemy to use the auto generated milestone_id from the milestone table when insert the funding information in the funding table? Should these be two separate queries?  When I do them as two separate queries I get the error: sqlalchemy.orm.exc.ObjectDeletedError: Instance '<Milestone at 0x39ebeb0>' has been deleted, or its row is otherwise not present.

Any help would be greatly appreciated, thanks guys :)

Fixes #1488 : Adds support for a kwarg `provide_automatic_options` on `add_url_rule`, which
lets you turn off the automatic OPTIONS response on a per-URL basis even if
your view functions are functions, not classes (so you can't provide attrs
on them).

We're using flask to serve mostly REST endpoints, and doing some setup at startup to create all the URL rules. Effectively, we're calling `app.add_url_rule()` for each method for each endpoint. This means that flask autogenerates an OPTIONS method and function for each ( https://github.com/mitsuhiko/flask/blob/master/flask/app.py#L1019 ), with no way to override.

Can `provide_automatic_options` be added as a kwarg to `add_url_rule`, in case nothing is specified on the `view_func`?

update celery url

Hi there,

Changed a little the globals.py file to avoid some code repetition, and also changed the order. The main change in my opinion is that now the `current_app` proxy would use `return getattr(top, 'app')` instead of `return top.app`. Maybe this has some side effects which I am missing.

The FastCGI deployment documentation mentions that it may be necessary to configure some middleware to strip the `SCRIPT_NAME` environment variable of the actual script file name in order to prevent it appearing in the URL (e.g. `example.com/yourapplication.fcgi/news/`).

The default `mod_rewrite` configuration given in the CGI deployment documentation has the same issues yet no mention of this workaround is given. Please consider mentioning this on this page also.

See #1135

Alternative to #1403

This is a unit test and code fix for issue #1481 that keeps the previous behavior of get_root_path and intercepts the new `AttributeError` thrown by `pkgutil.get_loader`.

In Python2.7 get_loader returns an empty string if a loader isn't found.

```
$ python
Python 2.7.6 (default, Mar 22 2014, 22:59:56) 
[GCC 4.8.2] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import pkgutil
>>> pkgutil.get_loader("testing")
>>> pkgutil.get_loader(__name__)
<pkgutil.ImpLoader instance at 0x7f03a435f8c0>
>>> 
```

Python3.4 an AttributeError is thrown.

```
$ python
Python 3.4.0 (default, Apr 11 2014, 13:05:11) 
[GCC 4.8.2] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> import pkgutil
>>> pkgutil.get_loader(__name__)
<class '_frozen_importlib.BuiltinImporter'>
>>> pkgutil.get_loader("testing")
Traceback (most recent call last):
File "<stdin>", line 1, in <module>
File "/usr/lib/python3.4/pkgutil.py", line 467, in get_loader
    return find_loader(fullname)
File "/usr/lib/python3.4/pkgutil.py", line 488, in find_loader
    return spec.loader
AttributeError: 'NoneType' object has no attribute 'loader'
>>> 
```

This means that if someone does something like

```
from flask import Flask
app = Flask("testing")
```

Then 

```
AttributeError: 'NoneType' object has no attribute 'loader'
```

is thrown on Python3.4

Suggested changes in flask/flask/helpers.py 

in get_root_path

```
637    # Next attempt: check the loader.
638    loader = pkgutil.get_loader(import_name)
```

to 

```
load =  None
try:
    loader = pkgutil.get_loader(import_name)
except AttributeError:
    pass
```

After registering a custom errorhandler by exception class, raising any
unhandled exception in a view function swallows the error and instead
throws an `IndexError` on trying to look up the appropriate handler.
This patch avoids the uninformative `IndexError` and preserves the
original exception by looping until the deque of classes is empty, not
forever.

I added a new method `from_envjson` into `Config` class. It allows people to configure their applications with environment variables in JSON syntax, without any config file.

Storing config in environment variables is a recommended practice of [12-Factor App](http://12factor.net/config). It is supported by many development and deployment utilities, including systemd(`EnvironmentFile` field in service file), [honcho](https://github.com/nickstenning/honcho), [autoenv](https://github.com/kennethreitz/autoenv) and more.

Please review it. Thanks.

Is there a way to send intermittent responses to client to avoid timeout for long-running tasks (~2minutes)?

If not, I guess I will have to do the following flow:
1. User requests a webpage
2. Check if that webpage is available in cache
3. If not, redirect them to a holding page that checks ~15 seconds if that request is ready
4. Load the response

Seems less than ideal, but gets the added benefit of showing some sort of progress indicator to the user

https://github.com/mitsuhiko/flask/blob/master/flask/blueprints.py#L104

Blueprint.view_functions should be removed as it does nothing besides potentially confuse people.

Specially misleading the entry about the `static` directory, as it can have another name and still be valid.

Minor docummentation change

This is neither a bug or issue but a request.
Where can I find laptop decals for flask? I'm loving this framework and would like to promote it with a laptop decal or sticker but I cannot find any.   

Can we make this happen? Stickermule was suggested on reddit but I think this should be held in flask 'store' should this come about. 

After a day or two, my Flask app stops noticing new connections; strace says:

mk@pling /proc/31539/fd> strace -p 31539 -e '!stat'
Process 31539 attached - interrupt to quit
select(0, NULL, NULL, NULL, {0, 805175}) = 0 (Timeout)
select(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)
select(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)
select(0, NULL, NULL, NULL, {1, 0}^C <unfinished ...>
Process 31539 detached

(note that the stat() calls between each select() have been omitted).

So select() is being called without any fds, basically as a blocking primitive, but I seem to have the following fds:

lsof -p etc:
python  31539   mk    3u  IPv4 141934535      0t0      TCP *:5000 (LISTEN)
python  31539   mk    4u  IPv4 142787301      0t0      TCP 93.93.128.61:5000->61.240.144.65:60000 (ESTABLISHED)

So it should by rights be select()ing on fd 3 at the very least.

Hi, I added a method to register multiple blueprints.
#### Example

``` python
app.register_blueprints([a_blueprint, b_blueprint, c_blueprint])
```

Thanks.

It would be nice to have a feature that would let a function be called after the server is started. As far as I've seen there is no such feature.

With this method I can pass options to the blueprint when registering.
They are then available in the blueprint.

From the 'quickstart' dcoumentation:

```
The following converters exist:

int accepts integers
float   like int but for floating point values
path    like the default but also accepts slashes
```

Can other types be added please? I may need them for an OpenMeetings API wrapper.

Using full URL in flask test client. GET params are silently discarded:

```
import unittest
from flask import Flask, request

app = Flask(__name__)
app.testing = True

@app.route('/action')
def action():
    return ""


class MyTestCase(unittest.TestCase):

    def test_get_with_path(self):
        with app.test_client() as c:
            rv = c.get('/action?vodka=42')
            assert 'vodka' in request.args # assertion OK

    def test_get_with_complete_url(self):
        with app.test_client() as c:
            rv = c.get('http://domain.com/action?vodka=42')
            assert 'vodka' in request.args # assertion error

    def test_post_with_complete_url(self):
        with app.test_client() as c:
            rv = c.post('http://domain.com/action?vodka=42', data={'gin': 43})
            assert 'gin' in request.form # assertion OK
            assert 'vodka' in request.args # assertion error


if __name__ == '__main__':
    unittest.main()
```

This may also be considered inconsistent with the behaviour on POST params.

If this is not the way one should use test client, maybe put a warning in the docs ?

What about making Jinja2 optional, so one can install it with

```
pip install flask[jinja2]
```

?

That's easy with this directive in setup.py:

```
extras_require={
    'jinja2': [
        'jinja2 >= 2.4',
    ]
},
```

For users that develop APIs with Flask, this will allow to exclude extra dependencies.

Currently, `Request.get_json` is hardcoded to only accept JSON requests with a media type of `application/json`. There are a plethora of emerging JSON media types and it would be handy to be able to configure the application with a set of acceptable JSON media types.

A probably half brained idea is to change the conditional statement inside `Request.get_json` to something like:

``` python
json_mimetypes = _request_ctx_stack.top.app.config.get('JSON_MIMETYPES', ('application/json',))

if self.mimetype not in json_mimetypes and not force:
    return None
```

Hello, I'm new to Python and Flask so bare with me.  I'm using Windows 8, PyCharm, Python 2.7.4, and Flask 0.10.

I followed the documentation to create the Flaskr application which is working great!  So then I moved on to the unit testing application and began following the instructions.

I created a new module as instructed, copied and pasted the example code, and then ran python flaskr_tests.py and got the following:

Traceback (most recent call last):
    File "flaskr_tests.py", line 2, in <module>
        import flaskr
ImportError: No module named flaskr

I did everything as described but yet get this error?  I went back and checked everything and still can't figure out what I'm missing?

According to the [jQuery-File-Upload docs](https://github.com/blueimp/jQuery-File-Upload/wiki/Setup#wiki-content-type-negotiation) _Iframe based uploads require a Content-type of text/plain or text/html for the JSON response_

So I can't use `jsonify` as it sets the response mime type to `application/json` and must use code like this

```
resp = make_response(json.dumps({'error': 'File too big'}))
if request.headers.get('Accept', '').find('application/json') > -1:
    resp.mimetype = 'application/json'
else:
    resp.mimetype = 'text/plain'
return resp
```

In instead of

```
return jsonify({'error': 'File too big'})
```

Am I missing something? How clueless would I be if I were to suggest adding some option to `jsonify` to customize the response mime type depending on the requested mime type?

#950 showed that the pocoo docs are out of sync with the repository.

Does that set of documentation only get updated on releases?  Is it possible to make the Read The Docs the primary documentation reference?

See #922 for the conversation and rationale.


Here's a little proposal for a new function on the `Config` object. I often find it very useful to grab namespaced config options. I've used my own helper function for ages now and thought it might be useful to everyone. It's particularly useful for me when configuration options map to a set of keyword arguments for a function or a class constructor. A  test has been added as well to verify the feature.

Follows the same approach for switching between file-system and package loaders as used by werkzeug's wsgi.SharedDataMiddleware. That is, a string is assumed to be in the file system, and a tuple with length 2 is assumed to provide the (1) package name and (2) the template folder name in the package.

redirect_url_for(endpoint, *_values) == redirect(url_for(endpoint,
*_values)

allow files enf=ding with .jinja to also be auto escaped

It is kind of understandable if Flask is deliberately not sending the Debug Page when it is serving through WSGI, even if `app.debug = True`, because Flask doesn't want the user to show that page in production by mistake. It is probably a security feature for the greater good. However, this means, Flask _assumes_ that when the user is deploying it using WSGI, it is in _production mode_. Which may or may not be true. However, we can accept it for the sake of security.

That being said, the part that does not make sense is that it is not sending any data to WSGI in this situation. The least it could do is to send the 500 error page that it would have sent by default, if app.debug was False. Seeing an **empty reply** doesn't instinctively make sense.

I have setup a simple test to demonstrate the problem over here: https://github.com/recognosco/flask-uwsgi-error

Small typo correction. 

Small documentation fixes

HI, I was testing flaskr because I want to use it (for my website).
When you write javascript code into the text form a XSS appear:

![2014-01-15-190432_2732x768_scrot](https://f.cloud.github.com/assets/3002802/1923112/2799e6e4-7e10-11e3-8daa-be6684a86c89.png)

So, we have to fix it editing show_entries.html:
" { entry.title }} {{ entry.text| safe }} "

replacing it for : 
" {{ entry.title }} {{ entry.text }} "

Now, if I wirte the js code again, the xss will disappear:

![2014-01-15-190923_2732x768_scrot](https://f.cloud.github.com/assets/3002802/1923162/d5009e40-7e10-11e3-8288-f76a0be4b0ad.png)

<svg/onload=confirm(document.cookie);>

EDIT : I guess that it's an intentional vulnerability but is not the correct way to do it, we(my team and I) will continue writing it to improve the "example code"
Regards

Originally i intended to rewrite the error handling system to register an
error handler for each subclass of HTTPException on initialization of the
Flask object, removing the distinction between HTTP exceptions and other
exception types. However, with the current behavior of preferring the
first-registered handler when an error occurs, doing this without compromises
would require changing this to preferring the last-registered handler, a
backwards-incompatible change.

The following is a very minimal fix to only make Flask prioritize the user's
error handlers over others. I am not sure which performance implications this
has. Maybe a major rewrite of the error handling system is still desirable
(with more complex prioritization of errorhandlers -- something based on
"distance" in inheritance tree?), but at the moment i don't see a reason to do
so, given that the current system is primitive enough to be understandable,
while still usable.

This allows the developer to set which header to send to the webserver. The default is X-Sendfile.

DATABASE='/tmp/flaskr.db' does not work on my machine.

I changed it to (by removing the slash before 'tmp')

DATABASE='tmp/flaskr.db' 

and it then worked.

Since heroku is one of the recommended quickstart deployment options, after following the (great) flaskr tutorial I tried to deploy on heroku only to realize some hours later that heroku does not support sqlite3 and thus the flaskr tutorial will never deploy on heroku with 500 Internal Service Errors. Perhaps this should be mentioned in the Flaskr tutorial, as other beginners may also follow both official documentation suggestions to failure.

I'm not sure since when, but secure_filename is under werkzeug.utils now (http://werkzeug.pocoo.org/docs/utils/).

You may wish to port this to 0.10 branch if you'd like to release a wheel for 0.10 as well.


Use json method of response.Response

Flask's default JSON encoder handles only `datetime.datetime` objects (via Werkzeug's `http_date` function). It should also handle `datetime.date` objects, a common data type that occurs in JSON used to represent dates in backend models.

Added a favicon for the docs as requested in issue https://github.com/mitsuhiko/flask/issues/934

Small doc change, just updated the links for greenlet, which were leading to 404 errors on codespeak.net

When registering a handler for `werkzeug.exceptions.HTTPException`, it has no effect when an HTTP error is raised.

Assume the following handler:

``` python
@app.errorhandler(HTTPException)
def http_err_handler(error):
    response = jsonify({
        "success": False, 
        "message": error.name
    })
    response.status_code = error.code
    return response
```

When requesting a page for which no route exists, a JSON response should be returned by the error handler, but instead, the usual `Flask`-generated HTTP error page is returned.

On the other hand, if the error handler is defined to handle a specific error code (by passing the error code to the `app.errorhandler` decorator), the exception is trapped and the JSON message returned.

As `wekzeug.exceptions.HTTPException` is the class raised internally by the `abort()` function, why isn't it possible to create a "catch-all" handler like this? Am I missing something?

I tried using @before_first_request but ran into an AssertionError in @setupmethod because before actually executing the functions app._got_first_request was set to True indicating it's already too late. So I just moved it after the execution of the functions. Also I made the decorator leave the functions intact so they could be used directly.

Hello,

Just noticed that the default HTML errors (like 404 Not Found) are:

1) Not using HTML5 yet.

`<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">`

2) Don't indicate their encoding, which raises a message in the Firefox console:

" The character encoding of the HTML document was not declared. The document will render with garbled text in some browser configurations if the document contains characters from outside the US-ASCII range. The character encoding of the page must be declared in the document or in the transfer protocol. "

Cordially.

Hi,

In my flask apps I've overridden the behavior of Flask.make_response to enable tuple responses with headers but skipping the status in the case of the default status (200). I know that this in practice only means a less coma and status, but thinks this enable a more beautiful way to return tuple responses with the default status code (or status directly passed into the Response constructor) but contains other headers.

So instead of today

``` python
@app.route("/")
def index():
    return "hi", 200, {"X-Foo": "Bar"} 
```

This PR enable us to write

``` python
@app.route("/")
def index():
    return "hi", {"X-Foo": "Bar"} 
```

code as follows:

api = Blueprint('api', 'api')

@api.errorhandler(500)
def error_500(error):
    msg = {
        'message': 'Server Error'
    }
    return jsonify(msg), 500

but flask throw this error:

AssertionError: It is currently not possible to register a 500 internal server error on a per-blueprint level.

Fixes a typo in a comment. Thanks! 

Fixed incorrect grammar in "SESSION_REFRESH_EACH_REQUEST" configuration description.

I like to have the local documentation of Flask in a Firefox pinned tab along some others. To distinguish it from the others I include a &lt;link rel&gt; to the index.html:

&lt;link rel="icon" href="_static/flask.png" type="image/png" /&gt;

I tried to find where in the sources to make the change but I have no time now to learn sphinx.

Would it be possible to include it in the next release?

Overriding a blueprint's template does not take effect without restarting the development server. 

Follow these steps to reproduce:
- First, add and register the following blueprint without creating any templates. It should produce a "Template Not Found" error:

```
from flask import Blueprint, render_template

blueprint = Blueprint(
    'blueprint', 
    __name__, 
    template_folder='blueprint/templates')

@blueprint.route('/testoverride')
def TestOverride():
    return render_template('test.html')
```
- Next, add a new template called "test.html" under the blueprint's template directory and refresh the page. It should find the template without restarting the server. 
- Now add a second template having the same filename but different content under the application's template directory and refresh the page. The page's content will not change without restarting the server. 
- Restart the server and refresh the page. Confirm the content has now changed.

from `http://flask.pocoo.org/docs/patterns/appdispatch`

``` python
from werkzeug.wsgi import DispatcherMiddleware
from frontend_app import application as frontend
from backend_app import application as backend

application = DispatcherMiddleware(frontend, {
    '/backend':     backend
})
```

In deployment environment, I can only reload both `frontend` and `backend` app.

With the latest version of Celery (3.1.6), following this tutorial produces the following error when attempting to start the celery worker: 

```
    user_preload = tuple(self.app.user_options['preload'] or ())
AttributeError: 'Flask' object has no attribute 'user_options'
```

Using `app` as the variable name here confuses celery. Renaming `app` to `flask_app` in the tutorial solves the issue and allows the celery worker to start successfully.

When sending a file stream with a name, but the file doesn't exist,
when adding etags, an exception will raise. `OSError: [Errno 2] No such file or directory:`

## Pull request summary

Added `SESSION_COOKIE_PERMANENT` configuration to control whether the signed cookie based flask session will be initialized to permanent or not.
Corresponding documentation and tests
## Testing done

New unit test for positive and negative cases, as well as making sure the old tests didn't break

```
$ python run-tests.py 
........................................................................................................................................................................................................................................
----------------------------------------------------------------------
Ran 232 tests in 1.738s

OK
```
## Use case

As a flask application developer (user of the framework), I wanted to be able to set the browser session timeout.
## Steps to reproduce

```
from flask import Flask
from datetime import timedelta
app = Flask(__name__)
app.config['PERMANENT_SESSION_LIFETIME'] = timedelta(days=1)
```
## Expectation

The signed cookie based session times out after a day
## Reality

Session is transient unless `session.permanent` was set to `True`.
The documentation on the configuration option `PERMANENT_SESSION_LIFETIME` doesn't mention it only works after `session.permanent` was set.
Once figured out this, the natural thing I did was

```
from flask import Flask, session
from datetime import timedelta
app = Flask(__name__)
app.config['PERMANENT_SESSION_LIFETIME'] = timedelta(days=1)
session.permanent = True
```

It is a little bit frustrating to find out that we need a request context to access session, so that we either need to put it into a view_func, or a @before_request
## Alternatives
1. We can assume _having `PERMANENT_SESSION_LIFETIME` configured_ indicates that a permanent session is expected
2. Add another configuration key to control how the session object should be initialized.
## Evaluation and Fix

For alternative 1: In python, explicit is always better than implicit. Plus, since we already have `PERMANENT_SESSION_LIFETIME` default to 30 days, that means if we go this route, the default session behavior will change from transient to permanent. This breaks backward compatibility
Alternative 2 is the way to go

This implements issue #927 and allows us to load Flask config from JSON files that can be shared for example with frontend dev tools like grunt.

It might make sense to implement something like `app.config.from_jsonfile('config.json')` to be able to share the configuration with JS based frontend tools like grunt.

Hi

I have a very small number of requests incoming on my server and yet the flask server always ends up getting stuck/hanging indefinitely.

I tracked down the problem to : the allowed number of files that the server opens reaches ulimit.

The flask server creates sockets one after the other and I don't know why it doesn't close them. I am not doing anything crazy, just rendering a page or putting a number in a mongo database

Any thoughts ?

See full issue here : http://stackoverflow.com/questions/20540129/ever-increasing-number-of-opened-sockets-on-python-web-server

(I don't know how issues work on github, first timer here ; I don't mind copying the full issue here if you prefer)
Thanks

Message flashing as implemented in Flask is currently broken, under certain conditions it's possible for messages to be flashed to the wrong tab or in extreme cases the wrong device/browser.

A correct implementation would require functionality beyond Flask's scope, message flashing itself is arguably beyond Flask's scope already.

Why not make a piss-poor user account system that exists solely in session cookies? It seems like the same logic behind Flask's message flashing functionality.

The method connect_to_database doesn't exist, sqlite3 and DATABASE aren't used. Is this what was meant?

![407981438376](https://f.cloud.github.com/assets/63004/1688578/d861ee34-5e0a-11e3-8327-60963dc5c301.png)

One of these two things is a link, the other is not. Clear differentiation between the two would be really good.

I spent couple of hours yesterday trying to understand why `tojson` output had a different order from `json.dumps` order.

The thing is that Flask sets `sort_keys` to `True` by default (see https://github.com/mitsuhiko/flask/blob/master/flask/json.py#L102). Is it possible to add something regarding this, and the `JSON_SORT_KEYS` in the doc ?

The bug is basically: if a relative directory path is provided to [`send_from_directory`](https://github.com/mitsuhiko/flask/blob/master/flask/helpers.py#L585), in a [package application](http://flask.pocoo.org/docs/patterns/packages/) things get messed up, and it doesn't work at all:

I threw a longer explanation of the current issue [in a gist](https://gist.github.com/uniphil/7777590), and made a simple repo showing the problem [here](https://github.com/uniphil/flask-package-sendfile-test).

My proposal is to expand the `directory` argument of `send_from_directory(directory, filename, **options)` to an absolute path using `current_app.root_path` if it is not absolute.

This change will affect the arguments passed to `send_file` for module apps, but it's just breaking out the absolute path earlier, so I don't _think_ this should break anything that currently works? All the tests pass.

I also couldn't figure out where a test should go for this, or if a test should even be added. I couldn't find any tests for `send_from_directory` (there are some for `send_file`), and I also didn't know the best way for using a package app in a test. If you'd like tests added for this behavior I'd be happy to write them with a few pointers on how to approach it.

When using the test_client for unittesting, the return of the the tester is cast to bytestring instead of utf-8. As the default charset for webpages is now utf-8 and Flask also returning utf-8, the test_client should honor that.

_app.py_:

``` python
from flask import Flask
app = Flask(__name__)

@app.route("/")
def hello():
    return "Héllo, Wôrld!"

if __name__ == "__main__":
    app.run()
```

_test.py_

``` python
from app import app

import unittest

class BasicTestCase(unittest.TestCase):
    def test_DefaultReturnShouldBeUtf8(self):
        tester = app.test_client(self)
        response = tester.get("/", content_type="html/text")
        self.assertRegex(response.content_type, "charset=utf-8")
        self.assertEqual(response.data, "Héllo, Wôrld!")

    def test_DefaultReturnShouldBeUtf8_Workaround(self):
        tester = app.test_client(self)
        response = tester.get("/", content_type="html/text")
        self.assertRegex(response.content_type, "charset=utf-8")
        self.assertEqual(response.data.decode("utf-8", "strict"), "Héllo, Wôrld!")

if __name__ == "__main__":
    unittest.main()
```


Sessions don't seem to be working on heroku

```
2013-11-27T17:47:24.382234+00:00 app[web.1]: Traceback (most recent call last):
2013-11-27T17:47:24.382234+00:00 app[web.1]:     super(GeventWorker, self).handle_request(*args)
2013-11-27T17:47:24.382234+00:00 app[web.1]:   File "/app/.heroku/python/lib/python2.7/site-packages/flask/app.py", line 1701, in __call__
2013-11-27T17:47:24.382234+00:00 app[web.1]:     return self.wsgi_app(environ, start_response)
2013-11-27T17:47:24.382469+00:00 app[web.1]:     response = self.make_response(self.handle_exception(e))
2013-11-27T17:47:24.382656+00:00 app[web.1]:     client.resource_owner_key = tup[0]
2013-11-27T17:47:24.382469+00:00 app[web.1]:   File "/app/.heroku/python/lib/python2.7/site-packages/flask/app.py", line 1689, in wsgi_app
2013-11-27T17:47:24.382469+00:00 app[web.1]:   File "/app/.heroku/python/lib/python2.7/site-packages/flask/app.py", line 1358, in full_dispatch_request
2013-11-27T17:47:24.382469+00:00 app[web.1]:     rv = self.dispatch_request()
2013-11-27T17:47:24.382656+00:00 app[web.1]:     data = self.handle_oauth1_response()
2013-11-27T17:47:24.382656+00:00 app[web.1]:   File "/app/.heroku/python/lib/python2.7/site-packages/flask_oauthlib/client.py", line 528, in handle_oauth1_response
2013-11-27T17:47:24.382234+00:00 app[web.1]: 2013-11-27 17:47:24 [10] [ERROR] Error handling request
2013-11-27T17:47:24.382234+00:00 app[web.1]:   File "/app/.heroku/python/lib/python2.7/site-packages/gunicorn/workers/async.py", line 45, in handle
2013-11-27T17:47:24.382234+00:00 app[web.1]:   File "/app/.heroku/python/lib/python2.7/site-packages/gunicorn/workers/async.py", line 93, in handle_request
2013-11-27T17:47:24.382469+00:00 app[web.1]:   File "/app/.heroku/python/lib/python2.7/site-packages/flask/app.py", line 1360, in full_dispatch_request
2013-11-27T17:47:24.382469+00:00 app[web.1]:     rv = self.handle_user_exception(e)
2013-11-27T17:47:24.382234+00:00 app[web.1]:   File "/app/.heroku/python/lib/python2.7/site-packages/gunicorn/workers/ggevent.py", line 119, in handle_request
2013-11-27T17:47:24.382234+00:00 app[web.1]:     respiter = self.wsgi(environ, resp.start_response)
2013-11-27T17:47:24.382656+00:00 app[web.1]: TypeError: 'NoneType' object has no attribute '__getitem__'
2013-11-27T17:47:24.382469+00:00 app[web.1]:     response = self.full_dispatch_request()
2013-11-27T17:47:24.382469+00:00 app[web.1]:   File "/app/.heroku/python/lib/python2.7/site-packages/flask/app.py", line 1344, in dispatch_request
2013-11-27T17:47:24.382469+00:00 app[web.1]:     return self.view_functions[rule.endpoint](**req.view_args)
2013-11-27T17:47:24.382469+00:00 app[web.1]:   File "/app/.heroku/python/lib/python2.7/site-packages/flask/app.py", line 1687, in wsgi_app
2013-11-27T17:47:24.382656+00:00 app[web.1]:   File "/app/.heroku/python/lib/python2.7/site-packages/flask_oauthlib/client.py", line 594, in decorated
```

localhost cookies (this works):

```
session="xxxx?_fresh=yyyy==&twitter_oauthtok=zzzz"
```

heroku cookies (doesn't work):  

```
None="xxxx=?_id=yyyy==&twitter_oauthtok=zzzz"
```

I was trying to check out some DropBox API code, and came up with the following Flask server (mostly lifted from the Dropbpx docs)::

```
from dropbox.client import DropboxOAuth2Flow
from flask import (Flask, request, session, g, redirect, url_for,
                   abort, render_template, flash)

# configuration
#DATABASE = '/tmp/flaskr.db'
#PASSWORD = 'default'
DEBUG = True
SECRET_KEY = 'development key'
USERNAME = 'admin'

app = Flask("test_connect")
app.config.from_object("test_connect")

DROPBOX_APP_KEY = 'APP_KEY' # use your own value
DROPBOX_APP_SECRET = 'APP_SECRET' # use your own value

@app.route('/')
def home():
    if not 'access_token' in session:
        return redirect(url_for('dropbox_auth_start'))
    return 'Authenticated.'

@app.route('/dropbox-auth-start')
def dropbox_auth_start():
    return redirect(get_auth_flow().start())

@app.route('/dropbox-auth-finish')
def dropbox_auth_finish():
    try:
        access_token, user_id, url_state = get_auth_flow().finish(request.args)
    except ValueError:
        abort(400)
    else:
        session['access_token'] = access_token
    return redirect(url_for('home'))

def get_auth_flow():
    redirect_uri = url_for('dropbox_auth_finish', _external=True)
    return DropboxOAuth2Flow(DROPBOX_APP_KEY, DROPBOX_APP_SECRET, redirect_uri,
                         session, 'dropbox-auth-csrf-token')

if __name__ == "__main__":
    app.run()
```

When I submit the root URI I see the following console output:

<pre>
(py3)localhost:ipynb3 sholden$ 127.0.0.1 - - [26/Nov/2013 14:13:42] "GET / HTTP/1.1" 302 -
127.0.0.1 - - [26/Nov/2013 14:13:42] "GET /dropbox-auth-start HTTP/1.1" 302 -
127.0.0.1 - - [26/Nov/2013 14:13:48] "GET /dropbox-auth-finish?code=EtdzRFdUsSsAAAAAAAAAAYsGGTJcWs8YtbQB_gvT99c&state=nBOWOVAN6XTqH-wdOaSmpw%3D%3D HTTP/1.1" 500 -
Traceback (most recent call last):
  File "/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/app.py", line 1836, in __call__
    return self.wsgi_app(environ, start_response)
  File "/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/app.py", line 1820, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/app.py", line 1403, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/app.py", line 1817, in wsgi_app
    response = self.full_dispatch_request()
  File "/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/app.py", line 1477, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/app.py", line 1381, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/app.py", line 1475, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/flask/app.py", line 1461, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/Users/sholden/Projects/Python/ipynb3/test_connect.py", line 33, in dropbox_auth_finish
    access_token, user_id, url_state = get_auth_flow().finish(request.args)
  File "/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/dropbox/client.py", line 1234, in finish
    if not _safe_equals(csrf_token_from_session, given_csrf_token):
  File "/Users/sholden/.virtualenvs/py3/lib/python3.3/site-packages/dropbox/client.py", line 1306, in _safe_equals
    res |= ord(ca) ^ ord(cb)
TypeError: ord() expected string of length 1, but int found
</pre>

Using the excellent Werkzeug debugging features I discovered the trouble appears to be due to the finish() function calling _safe_equals() with one bytes argument and one string.

Of course there could easily be something wrong with my code, in which case sorry for the spurious issue report.


As of celery 3.1.4. `-A` does not work but `--app` does and the syntax changed to `celery <command> <options>` switching the order does not work for me.

Seeing that I have (some) experience in Flask I really really want to use it for a new project we're about to start here in our company. I'm now looking for a couple websites that are either or all of the below:
- high traffic
- slick looking
- big/known names

I checked out the "powered by" part of the Flask website (http://flask.pocoo.org/community/poweredby/) but I can't find any big names on there. I think I once saw a little list of good sites using Flask, but I can't find them anymore.

Anybody any tips?

If I use `try` and `except`, Flask still prints the "Running on http..." from the `try` clause.

I have:

```
try:
    app.run(host='public_ip.com')
except Exception:
    app.run(host='local_ip')
```

I get:

```
* Running on http://public_ip.com/
* Running on http://local_ip/
```

Even though the second one is the only one that is running.

Hi,

I get **Address already in use** if I use threads...
Why is that happening ?

I have:

```
thread_empty_trash()
...
app.run(....  use_reloader=False .... )
```


added exception logging in debug mode

....

I think that flask needs some sort of dedicated channel to announce critical updates (or in general, new versions). 

The reason is that flask grew to a point where there is a lot of activity on the repository and the general mailing list. Listening on the mailing list or "watching" the repository for maintenance-only projects in order to catch new critical updates means siphoning through a lot of messages.

Would setting up something like a separate announce list be possible?

I'm getting the following error once in a while, notice the request path

 Thu Nov 07 16:14:42 UTC 2013 : ERROR, Exception on /刺客版本.rar [HEAD]
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1817, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1477, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1381, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1475, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1461, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/usr/local/lib/python2.7/dist-packages/flask/helpers.py", line 822, in send_static_file
    cache_timeout=cache_timeout)
  File "/usr/local/lib/python2.7/dist-packages/flask/helpers.py", line 613, in send_from_directory
    if not os.path.isfile(filename):
  File "/usr/lib/python2.7/genericpath.py", line 29, in isfile
    st = os.stat(path)
UnicodeEncodeError: 'ascii' codec can't encode characters in position 41-44: ordinal not in range(128)

Kenneth Reitz is still the author, but David Baumgold is now the maintainer; there doesn't seem to be a good way to indicate this. :(

Would you be open to a patch allowing the use of subdomain routing with no SERVER_NAME pre-configured?

The motivation is to allow multiple domains to match a request, just like it does when SERVER_NAME is None, while still benefiting from the nice subdomain matcher. This is particularly useful in DEV to be able to develop on machine.local but also tunnel the instance to a vpn, and use things like xip.io (which all change the host).

The change would probably be mostly focused on create_url_adapter(). I imagine a configuration variable switching a different logic on for this function: it would look for subdomains and deduce the server_name which is the reverse of what's going on today.
The list of subdomains could come from the configuration I suppose, or better be deduced from the compilation of the routes.

1) What do you think of this idea?
2) If you are opposed to it, what alternative approach do you suggest instead?
3) If you are not opposed to it, how do you think the implementation should look like?

I'm trying to post files to a MongoDB collection with Flask. I decided to use the Dropzone.js library to make a file drop zone. After some troubleshooting, I realized my database code was fine, but Flask isn't returning anything when request.method == "POST". Does anyone know why Flask isn't hitting the return statement when the request method is post for the index view?

```

from flask import Flask, request, render_template, redirect
from flask.ext.mongoengine import MongoEngine 
import datetime

app = Flask(__name__)

#set up database
app.config["MONGODB_SETTINGS"] = {'DB': 'pdfs'}
app.config['SECRET_KEY'] = "reallysecret"

db = MongoEngine(app)

class PDF(db.Document):
    pdf = db.FileField()
    uploaded_at = db.DateTimeField(default=datetime.datetime.now)
    file_size = None

    def __unicode__(self):
        return self.uploaded_at

    meta = {
        'indexes':['-uploaded_at'],
        'ordering':['-uploaded_at']
    }

@app.route('/', methods=["GET", "POST"])
def index():
    if request.method == "GET":
        return render_template('index.html')
    if request.method == "POST":
        return "Didn't do anything with POST, but here's a message."

```

My index.html template looks like this:

```

<!doctype html>
<head>
    <title>File Upload</title>
    <link rel=stylesheet type=text/css href="{{ url_for('static', filename='dropzone.css') }}">
    <script src="{{url_for('static', filename='dropzone.js')}}"></script>
</head>
<body>
    <form action="{{url_for('index')}}" class="dropzone dz-clickable">
        <div class="dz-default dz-message"></div>
    </form>
</body>

```

In Terminal, it looks like the POST request succeeded (code 200), but the return message does not display in the browser and Dropzone says the server responded with code 0.

Terminal output: 127.0.0.1 - - [03/Nov/2013 18:37:06] "GET / HTTP/1.1" 200 - 127.0.0.1 - - [03/Nov/2013 18:37:06] "GET /static/dropzone.css HTTP/1.1" 304 - 127.0.0.1 - - [03/Nov/2013 18:37:06] "GET /static/dropzone.js HTTP/1.1" 304 - 127.0.0.1 - - [03/Nov/2013 18:37:06] "GET /static/spritemap.png HTTP/1.1" 304 - 127.0.0.1 - - [03/Nov/2013 18:37:07] "GET /favicon.ico HTTP/1.1" 500 - 127.0.0.1 - - **[03/Nov/2013 18:37:13] "POST / HTTP/1.1" 200 -**

**Browser window**, Dropzone says server responded with code 0: http://imgur.com/JsfISMp

With Flask 0.9 and Werkzeug 0.8.3 I was able to test many of our functions by creating a SecureCookie with

```
from werkzeug.contrib.securecookie import SecureCookie
session = SecureCookie(dict(uid=uid), app.secret_key).serialize()
```

But that now gives me an empty session when we get to the request function, even though

```
    SecureCookie.unserialize(request.cookies['session'], app.config['SECRET_KEY'])
```

gives the correct dict that was passed through.

I tried to figure it out from the source, but couldn't quite get the gist of it.

I have a simple site which used flask. but the question is that the site always hang. 
I start it but after several hours or sometimes longer, the site is hanged.
Any  one has suggestion about this question?

My site is :  

```
http://116.255.163.99:5000/recommend
```

Hi,

The documentation could be improved a bit. Chapter 10 "Configuration Handling" explains well ho to set the config. However, it doesn't explain how to retrieve values from the config in other files. I found the following solution:

```
from flask import current_app as app
...
app.config['MY_SETTINGS']
```

It should be added to the docs.

Best,

Laszlo

Here's an example:

```
from flask import Flask
app = Flask(__name__)

@app.route('/<urlvar>')
def hello_world(urlvar):
    return 'Hello World! ' + repr(urlvar)

if __name__ == '__main__':
    app.run(debug=True)
```

When running:

```
curl http://localhost:5000/aaa%2Fbbb
```

I would expect to see:

```
Hello World! u'aaa/bbb'
```

Instead I get:

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server.  If you entered the URL manually please check your spelling and try again.</p>
```

I tested this against Flask 0.9 and Flask 0.10.1. Both had the same error.

While searching for existing bug reports, I came across this: https://github.com/mitsuhiko/werkzeug/issues/21

Is this related? If yes, what's the status?

In any case, being a WSGI spec problem or not, this is behaviour is incorrect!


Today in our system, one user managed to update the profile of another user.(
The only explanation I can come up with to this is that the Flask g context contained
the user_id of user_a when user_b updated his profile.

Am I using g incorrectly or is this maybe a bug?
We have about 15k users and this is the first time I saw this happen.

Flask==0.10.1

```
@app.before_request
def before_request():
    g.user_token = UserToken.from_request_token(
        request.headers.get('Authorization')
        .replace('Token token="', '').replace('"', ''))

@app.route('/api/profile',  methods=['GET', 'PUT'])
def profile():
    if request.method == 'PUT':
        try:
            user_service.update_userprofile(
                UserProfile(
                    g.user_token.user_id,
                    request.json.get('name'),
                    request.json.get('gender'),
                    request.json.get('location')
                    None))
            return PostResultModel(PostResult.Success,
                                   'Userprofile updated',
                                   PostResultErrorCode.NoError).json()
        except:
            return PostResultModel(PostResult.Error,
                                   'Could not update profile',
                                   PostResultErrorCode.ServerError).json()
```

Updated quickstart to make clear that URL reversing refers to the use of
url_for() to build the URL. Issue #779

This is related to #766 - still broken when View.as_view() is used to register views, as in all the documentation.

This is probably best illustrated with an example:

```
#!/usr/bin/env python 

from flask import Flask
from flask.views import View

app = Flask(__name__)

class IndexView(View):
    methods = ['GET']

    def dispatch_request(self, name=None):
        if not name:
            name = 'user'

        return 'Hello %s!' % name

app.add_url_rule('/', view_func=IndexView.as_view('hello'))
app.add_url_rule('/<name>', view_func=IndexView.as_view('hello'))

if __name__ == '__main__':
    app.run() 
```

app.add_url_rule() complains here, because of the equality check referenced in #766:

```
>>> IndexView.as_view('hello') == IndexView.as_view('hello')
False
```


fix typo of double "at".


Could it be the case that instantiating the flask application opens some file and doesn't close it?
I have tests with py.test and I didn't specify the scope of the flask application fixture to be 'sesson' so the flask application was instantiated basically for every test that needs it (we are using url map actively).

At some point I get the traceback related to the limit of the files open etc.
I understand that probably you don't have to instantiate more than one app per process,  but it might be also interesting to clean up the resources. At least if you test the app creation with different configurations. Maybe I could call something in the fixture finalizer to release the resources?

self = <Application 'httpapi.server'>

```
def auto_find_instance_path(self):
    """Tries to locate the instance path if it was not provided to the
        constructor of the application class.  It will basically calculate
        the path to a folder named ``instance`` next to your main file or
        the package.

        .. versionadded:: 0.8
        """
```

> ```
>   prefix, package_path = find_package(self.import_name)
> ```

../.virtualenvs/my/lib/python2.6/site-packages/Flask-0.10.1-py2.6.egg/flask/app.py:622: 

---

import_name = 'httpapi.server'

```
def find_package(import_name):
    """Finds a package and returns the prefix (or None if the package is
    not installed) as well as the folder that contains the package or
    module as a tuple.  The package path returned is the module that would
    have to be added to the pythonpath in order to make it possible to
    import the module.  The prefix is the path below which a UNIX like
    folder structure exists (lib, share etc.).
    """
    root_mod_name = import_name.split('.')[0]
    loader = pkgutil.get_loader(root_mod_name)
    if loader is None or import_name == '__main__':
        # import name is not found, or interactive/main module
        package_path = os.getcwd()
    else:
        # For .egg, zipimporter does not have get_filename until Python 2.7.
        if hasattr(loader, 'get_filename'):
```

> ```
>           filename = loader.get_filename(root_mod_name)
> ```

../.virtualenvs/my/lib/python2.6/site-packages/Flask-0.10.1-py2.6.egg/flask/helpers.py:668: 

---

self = <pkgutil.ImpLoader instance at 0x10db70290>, fullname = 'httpapi'

```
def get_filename(self, fullname=None):
    fullname = self._fix_name(fullname)
    mod_type = self.etc[2]
    if self.etc[2]==imp.PKG_DIRECTORY:
```

> ```
>       return self._get_delegate().get_filename()
> ```
> 
> E           AttributeError: 'NoneType' object has no attribute 'get_filename'

/System/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/pkgutil.py:313: AttributeError


Noticed that the error names weren't consistent while browsing the documentation.

Of course, the SQL script worked as previously written, but I recommend escaping the 'text' column name to distinguish it from the keyword.  This might avoid potential confusion for newbies - the target audience for the flask example projects - especially if they're new to SQL.


Example use case: trying to register a blueprint as lately as possible.

```
bp = Blueprint(...)

@app.before_first_request
def register_bp():
    app.register_blueprint(bp)
```

In debug mode we will get an AssertionError from `setupmethod` decorator, saying "A setup function was called after the first request was handled.".
https://github.com/mitsuhiko/flask/blob/master/flask/app.py#L54

This is because `_got_first_request` flag is set to True before `before_first_request_funcs` are called.
https://github.com/mitsuhiko/flask/blob/master/flask/app.py#L1493

Is there a reason for not setting the flag after handlers have been called? or is it safe (and thus it should be allowed) to call such "setupmethods"?

Fixed some incorrect variable references.

Previous documentation referenced a non-existent property on the Flask object called "build_error_handler".

This should actually reference Flask.url_build_error_handlers.

I created an example gist with the broken documentation version and the working version here, https://gist.github.com/jmhobbs/6942394 for Flask 0.10.1


I believe the information deleted in this commit was not relevant to app factories.  It if is relevant, further docs are needed to tie it into the surrounding context.

To illustrate the issue, see this code snippet:

``` python
from flask import Flask

app = Flask(__name__)

@app.teardown_request
def teardown(exc = None):
    if exc is not None:
        print "An exception has occured!"

try:
    raise Exception('dummy')
except:
    pass

# uncomment this to remove the issue
# import sys; sys.exc_clear()

with app.test_request_context():
    print "Nothing happening here"

# Output:
# Nothing happening here
# An exception has occured! <== this is unexpected!
```

This happens because flask relies on sys.exc_info() to figure out if some exception happened in the request. However, sys.exc_info() gets populated whenever an except block has been executed. This could lead to weird behavior in unit tests, perhaps the **enter** method on RequestContext should contain a sys.exc_clear()?

Config will not load variables unless they are all uppercase. Perhaps loading custom variables into config is discouraged but if it isn't you should note this in the tutorial. It took me too long to figure this out.


Hello,

When you set an initialization function with the before_app_first_request decorator you expect this function to be launched once **before** the first request.

But, if this function takes some time to execute, flask may respond to requests before it has finished.

Here is the code of Flask.try_trigger_before_first_request_functions(self)

``` python
if self._got_first_request:
    return
with self._before_request_lock:
    if self._got_first_request:
        return
    self._got_first_request = True
    for func in self.before_first_request_funcs:
        func()
```

Now, imagine 2 concurrent requests when the server starts:
- the first one takes the lock and sets _got_first_request to True BEFORE calling functions in self.before_first_request_funcs
- the second sees that _got_first_request is True and returns

The fix is simple: just put self._got_first_request = True after the calls to functions in self.before_first_request_funcs.

quickstart HTTP methods example doesn't work without `request` import:

```
from flask import request
```

Fixed a typo.

Currently jinja environment checks for changes in the template file every time you need to render it. But disk I/O is costly and it may be viable to disable this feature in production.

I added `TEMPLATES_AUTO_RELOAD` config option which allows to set `auto_reload` attribute of `jinja2.Environment` to `False` when the application is running in non-debug mode. This allows to make the template rendering a little more efficient because it disables a checking of changing templates file each time before template is rendered.

In some situations, this could give a significant increase of performance (from 60 to 200 rps in my case). Unfortunately, if you want to do the same by overriding of `Flask.jinja_options` attribute, it would be uncomfortable because a reloading of templates is needed for debugging.

This change should not affect existing applications. Also, it might make sense to disable reloading by default.

Check the file path by canonicalizing it rather than checking for
presence of ".." or it being starting with "/".


In the various tutorials test functions, the returned data is always accessed as if it was a str.  In python 3.3, the results are binary, so they must be decoded:

Instead of:
    assert "Some string" in rv.data
use:
    assert "Some string" in rv.data.decode('utf-8')

(there are other ways too - encode the string constant, etc.).


Currently only @mitsuhiko can update the site, which is rather suboptimal. Not sure if this could/should be made with the help of travis.

Hasura is Kubernetes based microservices platform with Postgres based BaaS features, including authentication, data, files and notification APIs. 

https://hasura.io/hub/project/hasura/hello-python-flask is a boilerplate which can be deployed easily to a free Hasura cluster using a simple git-push. It also integrates with Hasura data and auth APIs to provide authentication and database out-of-the-box.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

  
Below is what i get when i try to install it

```
C:\Users\TIBZY>pip install flask
Collecting flask
  Using cached Flask-0.12.2-py2.py3-none-any.whl
Collecting itsdangerous>=0.21 (from flask)
  Using cached itsdangerous-0.24.tar.gz
    Complete output from command python setup.py egg_info:
    running egg_info
    creating pip-egg-info\itsdangerous.egg-info
    writing pip-egg-info\itsdangerous.egg-info\PKG-INFO
    writing dependency_links to pip-egg-info\itsdangerous.egg-info\dependency_links.txt
    writing top-level names to pip-egg-info\itsdangerous.egg-info\top_level.txt
    writing manifest file 'pip-egg-info\itsdangerous.egg-info\SOURCES.txt'
    error: [Errno 2] No such file or directory: 'c:\\users\\tibzy\\python36\\python36.zip\\lib2to3\\Grammar.txt'

    ----------------------------------------
Command "python setup.py egg_info" failed with error code 1 in C:\Users\TIBZY\AppData\Local\Temp\pip-build-az__2i6f\itsdangerous\
```
### Repro

1. Create minimal hello world application as in http://flask.pocoo.org/
2. Also create file `/static/my_style.css` with arbitrary content
3. Run the application: `FLASK_APP=hello.py flask run`
4. Visit `http://localhost:5000/static/my_style.css`
5. Refresh the page to trigger "not modified" response

### Expected behavior

Only request log to appear in stderr:
```
127.0.0.1 - - [31/Dec/2017 22:24:38] "GET /static/my_style.css HTTP/1.1" 200 -
127.0.0.1 - - [31/Dec/2017 22:24:38] "GET /favicon.ico HTTP/1.1" 404 -
127.0.0.1 - - [31/Dec/2017 22:24:43] "GET /static/my_style.css HTTP/1.1" 304 -
```

### Actual behavior

The following also appears in stderr:

```pytb
Error on request:
Traceback (most recent call last):
  File "c:\python36\lib\site-packages\werkzeug\serving.py", line 270, in run_wsgi
    execute(self.server.app)
  File "c:\python36\lib\site-packages\werkzeug\serving.py", line 263, in execute
    write(b'')
  File "c:\python36\lib\site-packages\werkzeug\serving.py", line 232, in write
    status < 200 or status in (204, 304)):
TypeError: '<' not supported between instances of 'str' and 'int'
```

When this happens, `status` is `'304 NOT MODIFIED'`.

I think this defect became visible after [0c5cad57](https://github.com/pallets/werkzeug/commit/0c5cad57c2370c4b916b3651adb4d82eb9fbf5ec).

### Environment

* Python version: Python 3.6.4 (v3.6.4:d48eceb, Dec 19 2017, 06:04:45) [MSC v.1900 32 bit (Intel)] on win32
* Flask version: 0.12.2
* Werkzeug version: 0.14

Currently, the env var in `.env` or `.flaskenv` will not override existing value. However, if a user installed `python-dotenv` and created a `.flaskenv`, he will expect the variables in `.flaskenv` override the old values. It's inconvenience when you develop multiple applications at the same time.
### Expected Behavior

Debugging a app with `app.run(debug=True)` should work, where started a JVM by `jpype`

```python
startJVM(getDefaultJVMPath(), '-ea')
if not isThreadAttachedToJVM():
      attachThreadToJVM()
```

### Actual Behavior

app exited.

```pytb
#
# A fatal error has been detected by the Java Runtime Environment:
#
#  SIGSEGV (0xb) at pc=0x00007fb74759d090, pid=8686, tid=140425282705152
#
# JRE version: Java(TM) SE Runtime Environment (7.0_79-b15) (build 1.7.0_79-b15)
# Java VM: Java HotSpot(TM) 64-Bit Server VM (24.79-b02 mixed mode linux-amd64 compressed oops)
# Problematic frame:
# C  [_jpype.cpython-35m-x86_64-linux-gnu.so+0x65090]  JPJavaEnv::FindClass(char const*)+0x20
#
# Failed to write core dump. Core dumps have been disabled. To enable core dumping, try "ulimit -c unlimited" before starting Java again
#
# An error report file with more information is saved as:
# /home/jiajie/project/superset/superset/bin/hs_err_pid8686.log
#
# If you would like to submit a bug report, please visit:
#   http://bugreport.java.com/bugreport/crash.jsp
#
```

### Environment

* Python version: 3.5.2
* Flask version: 0.12.2
* Werkzeug version: 0.11.10
* Jpype1 version: 0.6.2

This PR introduces `FLASK_ENV` which should mirror the conventions from node as much as possible. The idea here is that we no longer try to map the development mode from the production mode by the `DEBUG` setting. This is intended because we want users to be able to are in a non debug development mode.

The docs are updated to largely refer to `FLASK_ENV` only.

One change to node is that we default to production instead of defaulting to development. This is done because most people will not set the environment and we do not want users to accidentally have debug features on.

This refs #2569
I don't have a good description for the issue yet but one of the issues I keep running into myself in 2017 is that it's not convenient to marry Flask and webpack. The issue here is that one wants to both have a server app as well as a client app and each uses a hot reloader for code.

There is a lot of boilerplate to make two services work and there is absolutely no support on the side of Flask to make it work. So here is what Flask most likely should do:

# Environment Awareness

Flask needs to know about environments. For now I would propose to mirror the node model where we have an environment flag and depending on the environment flag some flags get flipped automatically. In development for instance we would turn on debug by default. This discourages apps to make too many assumptions about the debug flag but instead use an environment flag instead.

This means debug can be flipped on and off in development mode. A potential webpack integration extension can then forward that flag to webpack.

# Proxy or be-proxied Capabilities

Right now one either needs front/backend to be running different servers on different ports or use some manual proxy setup to make this work. Right now the webpack server can pass through to the Flask server but it's quite hacky and non trivial.

In an ideal case Flask in development mode can spawn another process (like a webpack server, ngrok etc.) and manage this process. It would work independently of the Flask reloader but shut down together.

If it spawns a process on a different port Flask should itself be proxied through that other server or proxy to another server if that's easier. This would most likely require that the Werkzeug server learns HTTP proxying as we might not be able to do this on the WSGI level.
Fixed Typo in the tutorials
Changed when -> how

Using the `test_client()` inside an app context, seemingly prevents the `flask.g`-object from being reset.

A test case like this 

```python
app = flask.Flask(__name__)

@app.route('/')
def index():
    if hasattr(flask.g, 'value'):
        flask.g.value += 1
    else:
        flask.g.value = 0
    return bytes(flask.g.value)

with app.app_context():
    with app.test_client() as client:
        resp = client.get('/')
        # `resp.data` will be '0'

        resp = client.get('/')
        # `resp.data` will be '1' here
```

will return `'1'` from the second request made by the test client. As the `flask.g`-object is local to the request, I would expect a `'0'` to be returned.

This may outside of the scope of supported use-cases, or simply the way it _should_ behave. I can accept that, but I just wanted it here at least for future users.

### Rationale for using `test_client()` inside an app context

The reason I do this is to be able to use `url_for()` inside my view tests, and have code like 

```python
response = client.post(
    url_for('blueprint_api.add_user'),
    json={'name': 'John', 'email': 'john@example.org'},
)
```

Basically I believe that my view tests shouldn't be testing a hard-coded URL (the single source of truth for that should be the route), but rather the logic of the view function.

### Environment

* Python version: 2.7.13
* Flask version: 0.13.0
* Werkzeug version: 0.13

https://github.com/pallets/flask/issues/2564



Since we have implemented application discover, there is no need to create an application instance manually for `flask run`.
<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

According to the [documentation](http://flask.pocoo.org/docs/0.12/api/#flask.session.new), **new** attribute returns **True** if the session is new. Otherwise **False**, but it's not like that. How to reproduce:

```
from flask import Flask, session

app = Flask(__name__)
app.config["SECRET_KEY"] = "thisisasecret"
app.config['SESSION_TYPE'] = 'filesystem'

@app.route("/")
def index():
    if 'user_id' not in session:
        session['user_id'] = 'jon'
    print(session.new)
    print(session.modified)
    return 'testing sessions'
# just for debugging
@app.route("/clear")
def clear():
    session.clear()
    return 'clear'

if __name__ == "__main__":
    app.run(debug=True)
```

Run app and call _/_ endpoint twice. Output:

```
127.0.0.1 - - [19/Dec/2017 16:18:20] "GET /clear HTTP/1.1" 200 -
False # value of session.new
True
127.0.0.1 - - [19/Dec/2017 16:18:25] "GET / HTTP/1.1" 200 -
False # value of session.new
False
```

As I Understood when we initialize session, **session.new** should return **True**(when we call endpoint at first time). Is it right?

### Environment

* Python version: 2.7.13
* Flask version: 0.12.2
* Werkzeug version: 0.13

[Link](https://stackoverflow.com/questions/47885251/unexpected-working-of-new-attribute-of-session-class-in-flask) to question on SO
### Expected Behavior

Given we have an app with a `teardown_request` and a `route` that always raises exception, when the app is first launched either with `debug=True` or through `uWSGI`, the teardown request should execute. 

```python
from flask import Flask

app = Flask(__name__)


@app.teardown_request
def teardown(exc):
    print('Teardown request executed')

@app.route('/')
def error_route():
    e = 3 / 0

if __name__ == '__main__':
    app.run(debug=True)
```

### Actual Behavior

Instead for the first request (in uWSGI case, for each worker's first request), the teardown does not execute. After few hours debugging with PyCharm the best information we can share (I hope it's actually useful) is that in `flask.ctx.RequestContext.push()` the `_request_ctx_stack.top` is None.

### Environment

* Python version: 3.5
* Flask version: 0.12.2
* Werkzeug version: 0.13

I always use app.run(debug=True) during the developer session. When I update a .htlm file the server restart and you can see the change.

Now I started to work with
```
@app.template_filter()
```
but even if you are in the debug mode, if you change a .html file, you have to restart the server manually to see your change. I notice this weird behavior only when you define an @app.template_filter()

### Environment

* Python version: Python 3.5.2
* Flask version: 0.12.2
* Werkzeug version: 0.13
* Jinja2 version: 2.10
* MarkupSafe version: 1.0
* Browser : Chrome (version 63.0.3239.90)

Added a (minimal) mention of `--host` and `--port` `flask run` options.  Replaces #2557.
In practice, it is often important to have more than one test file. Though this is in the pytest domain, I thought that it would be important to illustrate the capability of fixture sharing.

I updated the docs and flaskr code example to use a `conftest.py`file.
Make appveyor configuration cleaner.

When browsing the CLI doc, I found myself wanting to know how to set host bind interface and port.  These are not currently discussed, and are revealed with `flask run --help`.

Added that output to the page.
The documentation for installing Sentry's raven client was incorrect. It should state that the client must be installed with the extra flask dependencies as mentioned in getsentry/raven-python#1075

pallets/meta#24

I'll test 2.6 and 3.3 before I release 1.0, which will be the last version to support these.
This fixes issue #2550, where some tests fail when using newer pytest (after version 3.2.5).

The reason for this issue is that pytest added a plugin that instantiates a handler for the logging module, while the tests were expecting no handlers.

The PR solves the issue by temporarily disabling the logging module and removing any handlers for all tests on the file




<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->



<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

### Expected Behavior

On running ```pytest``` all tests should pass.

To reproduce please execute ``` pytest ```
### Actual Behavior

5 tests fail 

Here is the full output of pytest: https://paste.ubuntu.com/26177622/

### Environment

* Python version: 3.5.2


It seems `Request.is_xhr` is deprecated. Getting warnings here... How do we fix this?

```
flask.jsonify(**{...})
File "/usr/local/lib/python2.7/site-packages/flask/json.py", line 251, in jsonify
if current_app.config['JSONIFY_PRETTYPRINT_REGULAR'] and not request.is_xhr:
File "/usr/local/lib/python2.7/site-packages/werkzeug/local.py", line 347, in __getattr__
return getattr(self._get_current_object(), name)
File "/usr/local/lib/python2.7/site-packages/werkzeug/wrappers.py", line 689, in is_xhr
), stacklevel=2)
DeprecationWarning: Request.is_xhr is deprecated. Given that the X-Requested-With header is not a part of any spec, it is not reliable
```
The docs are inaccurately suggesting a db connection would be available at `g.db`, after calling `get_db()` a connection will be available at `g._database` but even then I think instructing the user to use `get_db()` is the best way forward.


I learned from multiple issues (like https://github.com/kennethreitz/httpbin/issues/340, https://github.com/pallets/werkzeug/issues/1149, https://github.com/pallets/flask/issues/367) that Flask developers are making a push to implement `wsgi.input_terminated` as a way for wsgi servers and apps to support chunked requests.

However, it is extremely hard to navigate these issues and figure out what works and what does not. Is there an intention to document the support for this flag? This is a great feature, but from the user's perspective it is currently very hard to even figure out how it works. I propose at least keeping an issue alive with information on which environments will support it.

Here is what worked for me:
Flask 0.12.2 + Gunicorn 19.7.1
Flask 0.12.2 + Werkzeug 0.13

What did not work for me
Flask 0.12.2 + uWSGI 2.0.15
On Windows send_from_directory() fails because posix path from safe_join() and Windows path from current_app.root_path gets mixed up.

I see problem in this line:
https://github.com/pallets/flask/blob/eb1c2faf9f1fd785616203dc00f6dd680682dc38/flask/helpers.py#L691
E.g. running app from C:\PythonApps\FlaskApp: 
```python
send_from_directory("instance/data", "file1.txt")
filename = safe_join(directory, filename)
# filename == "instance/data/file1.txt"
if not os.path.isabs(filename):
        filename = os.path.join(current_app.root_path, filename)
        # here's the problem -> filename == "C:\\PythonApps\\FlaskApp\\instance/data/file1.txt"
    try:
        if not os.path.isfile(filename):
            # here it fails
            raise NotFound()
```
Returning posix path from safe join is imo ok (see #2284) but joining with non posix path fails.
I think solution can be using os.path.normpath after joining path parts:
```python
filename = os.path.normpath(os.path.join(current_app.root_path, filename))
```
Same problem is with send_file():
https://github.com/pallets/flask/blob/d08d96acbcabcde23307ed060f71f95ba9cb7b8d/flask/helpers.py#L520

### Environment

* Python version 3.5.4:
* Flask version 0.12.2:
* Werkzeug version 0.12.2:

In `flask/config.py` when loading a config file in `silent=True` mode, can you add ENOTDIR as part of the errnos that are absorbed?

https://github.com/pallets/flask/blob/789715adb9949f58b7b0272bed1a58d7cd0fad30/flask/config.py#L132  (and the other similar lines)

I've installed a package with pip, which stores its settings into directory `~/.grip` as one of the potential locations to store its config flags. But the ubuntu package grip uses the same path as a regular file.
When the python-grip tries `config.from_pyfile(x, silent=True)` to figure out its settings, it borks.

It's definitely a packaging bug with the grip tools to use the same path to store their settings (and I'll file that with them), but it remains that I believe in the case of loading config files, passing a non-existent file should silently fail. I don't see the case as being that different than EISDIR (which is already handled).

I'm happy to do a pull request on this.

### Expected Behavior

When loading a config with `Config.from_pyfile()` and friends, from a path in which a (non-basename) component in the path is a regular file, I would expect the config loading to silently fail when `silent=True`,

```python
Paste a minimal example that causes the problem.
```

    # I use Xresources here, because it probably already exists on most systems. but in my
    # case it's ".grip".
    import os, os.path
    import flask
    APPNAME = "Xresources"
    SETTINGS_FILE = os.path.expanduser(
        os.path.join("~", "." + APPNAME, "settings.py"))

    cfg = flask.Config(".")

    # borks -- ~/.Xresources already exists as a regular file
    cfg.from_pyfile(SETTINGS_FILE, silent=True)

### Actual Behavior

ENOTDIR is not absorbed and is raised.

```pytb
Paste the full traceback if there was an exception.
```

    Traceback (most recent call last):
      File "sample.py", line 11, in <module>
        cfg.from_pyfile(SETTINGS_FILE, silent=True)
      File "/usr/local/lib/python2.7/dist-packages/flask/config.py", line 129, in from_pyfile
        with open(filename, mode='rb') as config_file:
    IOError: [Errno 20] Unable to load configuration file (Not a directory): 
    '/home/me/.Xresources/settings.py'


### Environment

* Python version: 2.7.x
* Flask version: 0.12.2
* Werkzeug version: x



Hi, I am currently using flask to build a small web service, and I was looking at this doc page about "deploying flask using setuptools", and found a minor issue.
In this chapter: [Tagging Builds](http://flask.pocoo.org/docs/0.12/patterns/distribute/),
there is a missing double quote about the aliases settings, also it might be better to have newlines.

The correct formatting should be like below:
![screenshot-2017-12-6 deploying with setuptools flask 0 13 dev documentation](https://user-images.githubusercontent.com/10107120/33655364-1fc8f220-da73-11e7-8849-3f8ea70c6c75.png)
@davidism 



### Expected Behavior

In flask website use tutorials, in the third step ` flask run ` to run my web, appear this mistake.
In py files line first, I use the ` # - coding: utf-8 -- ` specified utf-8.
I'm writing code in Pycharm. Start the web with the CMD run command.
I copy the project directory into ubuntu and it works.
No related problems were found on the Internet.
Please give us some ideas and solve this problem.
thank you

Below is a screenshot of the Pycharm

![](http://ono3vb8rf.bkt.clouddn.com/FiQ9vFgwM9dNrd29zW0gHiFNUUs8.png)

Tell us what should happen.

```shell
kevin@DESKTOP-5KM5T43:~/workspaces/flaskr$ flask run
 * Serving Flask app "flaskr"
 * Forcing debug mode on
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 244-441-781
```

### Actual Behavior

Tell us what happens instead.

```pytb
D:\workspace\development\python\WebProject\flaskr>flask run
 * Serving Flask app "flaskr"
 * Forcing debug mode on
 * Restarting with stat
  File "D:\ProgramData\Anaconda3\Scripts\flask.exe", line 1
SyntaxError: Non-UTF-8 code starting with '\x90' in file D:\ProgramData\Anaconda3\Scripts\flask.exe on line 1, but no encoding declared; see http://python.org/dev/peps/pep-0263/ for details
```

### Environment

* Operating system

```
OS name: Microsoft Windows 10 professional edition
OS version: 10.0.16299 temporary lack of Build 16299
```

* Python version:

```
D:\workspace\development\python\WebProject\flaskr>python --version
Python 3.6.3 :: Anaconda, Inc.
```

* Flask version:

```
D:\workspace\development\python\WebProject\flaskr>python -m flask --version
Flask 0.12.2
Python 3.6.3 |Anaconda, Inc.| (default, Oct 15 2017, 03:27:45) [MSC v.1900 64 bit (AMD64)]
```

* Werkzeug version:

```
Werkzeug (0.12.2)
```



Minor documentation fix: 
`return` is required to make 'http methods' example work


Update Pycharm instructions to run via module name #2535 

The templates in `.github` directory are Markdown. They should be end with `.md` for better rendering on GitHub.
### Expected Behavior

Tell us what should happen.

```python
Paste a minimal example that causes the problem.
```
from wtforms import StringField
from wtforms import BooleanFiled
### Actual Behavior

Tell us what happens instead.
ImportError: cannot import name BooleanFiled

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version:Anaconda 4.1.0
* Flask version:
* Werkzeug version:

It works well

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Slightly misleading file path, added full path

Update documentation for #2529.

2017.3 added the ability to run modules instead of needing to find the `flask` executable in the virtualenv. The instructions in `cli.rst` should be updated to show selecting "Module name:" and then typing "flask".

cc @doobeh 
I noticed the following error while compiling something and it was irksome. Maybe it is worth looking at idk. 

The issue is the following. 

Say I have the entrypoint to my app be main.py and I export it with `export FLASK_APP=main.py`. If I then later go back and rename the entrypoint run.py and export it, then sometimes flask will continue to use the main.pyc file which will break the application. It may be that this sometimes also occurs with other .pyc files in general, I am not sure - it irks me that previous .pyc files are not destroyed between FLASK_APP runs if shadowing is a possibility. 

Just thought I would point this out - it took me some debugging time and maybe it will save someone else a bit of time. 

Thanks.
When running the selftests for the 0.12.2 distfile from pypi on NetBSD 8.99.7/amd64 with python-3.6.3 and werkzeug 0.12.2, I see two failures:
````
======================================================================================= ERRORS ========================================================================================
____________________________________________________________________ ERROR at teardown of test_session_expiration _____________________________________________________________________

recwarn = WarningsRecorder(record=True)

    @pytest.yield_fixture(autouse=True)
    def catch_deprecation_warnings(recwarn):
        yield
        gc.collect()
>       assert not recwarn.list
E       assert not [<warnings.WarningMessage object at 0x7ede1af11d58>]
E        +  where [<warnings.WarningMessage object at 0x7ede1af11d58>] = WarningsRecorder(record=True).list

conftest.py:134: AssertionError
====================================================================================== FAILURES =======================================================================================
______________________________________________________________________________ test_no_error_swallowing _______________________________________________________________________________

flaskext_broken = None

    def test_no_error_swallowing(flaskext_broken):
        with pytest.raises(ImportError) as excinfo:
            import flask.ext.broken
    
>       assert excinfo.type is ImportError
E       AssertionError: assert <class 'ModuleNotFoundError'> is ImportError
E        +  where <class 'ModuleNotFoundError'> = <ExceptionInfo ModuleNotFoundError tblen=4>.type

test_ext.py:183: AssertionError
============================================================== 1 failed, 314 passed, 10 skipped, 1 error in 7.12 seconds ==============================================================
*** Error code 1
````

This does some bad string parsing to not accidentally silence other errors
(Probably not ideal but that's the best I can come up with)
It's way too easy currently to deadlock the server with background resource
fetching.  We really should have threads enabled by default now in my mind.
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->


```python
from flask import Flask, send_file

app = Flask(__name__)
app.use_x_sendfile = True


@app.route('/')
def index():
    return send_file('/etc/passwd', mimetype='text/plain', conditional=True)
```

`http get http://127.0.0.1:8009/ Range:bytes=10000-` (the range needs to be invalid, so depending on the file sent the number needs to be higher) fails with this ValueError:

```pytb
Traceback (most recent call last):
  File "/home/adrian/dev/indico/env/lib/python2.7/site-packages/flask/app.py", line 1982, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/adrian/dev/indico/env/lib/python2.7/site-packages/flask/app.py", line 1614, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/adrian/dev/indico/env/lib/python2.7/site-packages/flask/app.py", line 1517, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/home/adrian/dev/indico/env/lib/python2.7/site-packages/flask/app.py", line 1612, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/adrian/dev/indico/env/lib/python2.7/site-packages/flask/app.py", line 1598, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/home/adrian/dev/indico/src/flasktest.py", line 10, in index
    return send_file('/etc/passwd', mimetype='text/plain', conditional=True)
  File "/home/adrian/dev/indico/env/lib/python2.7/site-packages/flask/helpers.py", line 594, in send_file
    file.close()
AttributeError: 'NoneType' object has no attribute 'close'
```

Probably just a missing `if file is not None` check.
In recent versions of Twisted Web, the `--port` option syntax has changed, and it is now necessary to specify the protocol along with the port.
Hello,

flask stable version 0.12 , docs  doesn't cover this.   Only dev version has , which not work for 0.12.

I want to change the logging format , after  I add below code 
```
    steam_formatter = logging.Formatter("[STREAM][%(levelname)s][%(asctime)s][%(name)s][Line:%(lineno)d] %(message)s")
    stream_handler = logging.StreamHandler()
    stream_handler.setLevel(logging.DEBUG)
    stream_handler.setFormatter(steam_formatter)
    app.logger.addHandler(stream_handler)
```

I find flask would print two log message with different format .  Soon I understand flask still keep its original stream handler . I think reset logging format should be clarified in stable docs.
### Expected Behavior

Examples in the documentation should be running after copying them. In this case the import statement for the `flash` function is missing in the example code.

### Actual Behavior

Running the example from [Uploading Files](http://flask.pocoo.org/docs/0.12/patterns/fileuploads/) results in
```console
NameError: global name 'flash' is not defined
```

This adds an entry to the patterns section for [Dramatiq]. Let me know if there's anything I should change! 

[Dramatiq]: https://dramatiq.io
When [`Flask.create_url_adapter`](https://github.com/pallets/flask/blob/c74f46979a8b8358437bd7f76e478d04248a9c72/flask/app.py#L1923) is supplied with a request, it passes the request on to [`Map.bind_to_environment` from `werkzeug.routing`](https://github.com/pallets/werkzeug/blob/master/werkzeug/routing.py#L1253). This will result in a call to `Map.bind`, where the `script_name` argument is set to the value of the environment variable `SCRIPT_NAME`.

However, when it isn't supplied with a request, `Flask.create_url_adapter` will call `Map.bind` directly. Instead of `SCRIPT_NAME`, it passes the value of `APPLICATION_NAME` via the `script_name` argument. Per #1714, I understand that `APPLICATION_NAME` has nothing to do with routing. I guess this should change, but I'm not sure.

I discovered this when debugging a tangentially related issue that turned out to be in my own code (I assumed `MapAdapter` could ultimately be used to translate whole URL paths to endpoints, but it seems I have to strip off `SCRIPT_NAME` myself).
`View.as_view` creates a function that instantiates the class every request. This seems inefficient for no real gain.

```python
class DeleteView(View):
    methods = ['DELETE']

    # this only needs to happen once
    def __init__(self, model):
        self.model = model
        # imagine if we did something expensive here
        # like generating a form based on the model
```

The only argument I could think of for instantiating every request is if the constructor does something different based on the request. That seems like bad design, but any use that I can think of for that could be accomplished with properties instead.

Yes, there are ways to make it less expensive, like generating more ahead of time and passing more arguments, but that is not intuitive, and makes the class just a more complicated view factory.
Hello!

I might've missed it, but when you follow the tutorial, it seems to forget to mention that you need to expose `init_db´ on the module.

Here is a proposal to add it :)

Cheers,

Bernard
MacOS
* Python version: 2.7.10
* Flask version: 0.12.2
* Werkzeug version: 0.12.2 

I have a view function that render a html template named "MyViewFunc", then I add a route rule to this function ```app.add_url_rule("/a/b/c", "MyViewFunc", MyViewFunc)```.

This caused a strange mistake in browser:
![snip20171113_2](https://user-images.githubusercontent.com/4526759/32707800-ff513d84-c7eb-11e7-8fa9-995cf2fd6eaf.png)

But when write as ```app.add_url_rule("/a", "MyViewFunc", MyViewFunc)```, it's ok


### Expected Behavior

auto_pop of the request context should be executed regardless of whether an exception happened after pushing the context(for example, when opening a session).

We're using Redis sessions from flask_session:
```python
def _setup_session(app):
    from util.cache.region import cache_region
    from dogpile.cache.backends.null import NullBackend
    from flask_session import RedisSessionInterface

    if not isinstance(cache_region.backend, NullBackend):
        redis = cache_region.backend.client
        session_interface = RedisSessionInterface(redis, 'test.session.', use_signer=False, permanent=False)
        app.session_interface = session_interface
```

### Actual Behavior

The request context is not popped whenever there is a timeout getting the session from Redis. 
We can see in following requests the 'g' object still holds information from the failing request.

In ctx.py the context is first pushed and then the session is opened:
```pytb
        _request_ctx_stack.push(self)

        # Open the session at the moment that the request context is
        # available. This allows a custom open_session method to use the
        # request context (e.g. code that access database information
        # stored on `g` instead of the appcontext).
        self.session = self.app.open_session(self.request)
```

But if open_session() fails, then ctx.auto_pop() is not executed. Perhaps ctx.push() should also be under the try...finally block in app.py?

This is the exception that triggers the context not to be popped:
```pytb
redis.exceptions:TimeoutError: Timeout reading from socket
Traceback (most recent call last):
File "/var/www/censored_production/env/lib/python2.7/site-packages/newrelic-2.74.0.54/newrelic/api/web_transaction.py", line 738, in __iter__
File "/var/www/censored_production/env/lib/python2.7/site-packages/newrelic-2.74.0.54/newrelic/api/web_transaction.py", line 1114, in __call__
File "/var/www/censored_production/env/lib/python2.7/site-packages/werkzeug/contrib/fixers.py", line 152, in __call__
File "/var/www/censored_production/www/censored/util/logging.py", line 136, in __call__
File "/var/www/censored_production/env/lib/python2.7/site-packages/flask/app.py", line 1813, in wsgi_app
File "/var/www/censored_production/env/lib/python2.7/site-packages/flask/ctx.py", line 321, in push
File "/var/www/censored_production/env/lib/python2.7/site-packages/flask/app.py", line 825, in open_session
File "/var/www/censored_production/env/lib/python2.7/site-packages/flask_session/sessions.py", line 132, in open_session
File "/var/www/censored_production/env/lib/python2.7/site-packages/newrelic-2.74.0.54/newrelic/hooks/datastore_redis.py", line 67, in _nr_wrapper_Redis_method_
File "/var/www/censored_production/env/lib/python2.7/site-packages/redis/client.py", line 880, in get
File "/var/www/censored_production/env/lib/python2.7/site-packages/redis/client.py", line 573, in execute_command
File "/var/www/censored_production/env/lib/python2.7/site-packages/redis/client.py", line 585, in parse_response
File "/var/www/censored_production/env/lib/python2.7/site-packages/redis/connection.py", line 577, in read_response
File "/var/www/censored_production/env/lib/python2.7/site-packages/redis/connection.py", line 238, in read_response
File "/var/www/censored_production/env/lib/python2.7/site-packages/redis/connection.py", line 168, in readline
File "/var/www/censored_production/env/lib/python2.7/site-packages/redis/connection.py", line 139, in _read_from_socket
```

### Environment

* Python version: 2.7.6
* Flask version: 0.10.1
* Werkzeug version: 0.11.11

### Expected Behavior
Line which exports FLASK_APP ends with success.

### Actual Behavior
Line which exports FLASK_APP ends with error:
bash syntax error near unexpected token ('

PR: https://github.com/pallets/flask/pull/2515
Describe what this patch does to fix the issue.
Export of FLASK_APP ends with success.

commit rev: 470112dd6e708a18eb4ec1daa10c4ea276620dbf
python: 3.6.2

in the `docs` directory, just execute `make latexpdf`, there are issues with `\maketitle` and an unicode char.
```
(/usr/share/texlive/texmf-dist/tex/latex/hyperref/nameref.sty
(/usr/share/texlive/texmf-dist/tex/generic/oberdiek/gettitlestring.sty))
! Undefined control sequence.
\maketitle ...tnoterule \relax \ifsphinxpdfoutput 
                                                  \begingroup \def \\{, } \p...
l.66 \maketitle
               
? 
```

```
! Package inputenc Error: Unicode char 🎉 (U+1F389)
(inputenc)                not set up for use with LaTeX.

See the inputenc package documentation for explanation.
Type  H <return>  for immediate help.
 ...                                              
                                                  
l.20767 Celebrate 🎉
                      
? 
```

```
Collected error summary (may duplicate other messages):
  pdflatex: Command for 'pdflatex' gave return code 1
      Refer to 'Flask.log' for details
Latexmk: Use the -f option to force complete processing,
 unless error was exceeding maximum runs of latex/pdflatex.
make[1]: *** [Makefile:33: Flask.pdf] Error 12
make[1] : on quitte le répertoire « /home/stephane/src/github.com/pallets/flask/docs/_build/latex »
make: *** [Makefile:101: latexpdf] Error 2
```
Rewrite the tutorial and corresponding example, taking into account new and common patterns for Flask.

- [x] example
- [x] tutorial
Sentry has this for example, and they simply run uWSGI (which can be installed via `pip`); configured with sane defaults through environment variables: https://github.com/getsentry/sentry/blob/master/src/sentry/services/http.py

I think this would make sense for Flask too since it'd make simple use cases easier (people just wanting to run a small application without having to configure much).

---

This could be done in a separate standalone package providing a new cli command instead of having it in the Flask core, but I think having an issue here is a good idea anyway in case someone is looking for something to contribute.
There is currently no documentation for how to "officially" test Flask CLI commands. It seems appropriate that there should be a section about it on this page: http://flask.pocoo.org/docs/0.12/testing/.

I know there was a previous issue (#1709) that got closed, but I do believe it is an issue that there is no documentation on this very important topic. Furthermore, it is also very hard to find information about how to do it online (that old issue is literally the only page I found that is relevant).
Please improve the [readme file](https://github.com/pallets/flask/blob/master/examples/flaskr/README) for the flaskr example.

Include more details on how to set it up, **especially for step 1**.  

I could not get step 3 to work probably because I didn't get step 1 to work. This is the error I'm getting:
`$ export FLASK_APP=flaskr.factory:create_app() `
`-bash: syntax error near unexpected token `(' `

Thanks !


Changed "when" to "how" as the subsequent text talks about "how to store data on the `g` object".
<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Similar to the static route, add configuration and a route to serve uploaded files. Default to `os.path.join(app.instance_path, 'uploads')` and `/media/<path:filename>`. I've observed new developers thinking they should place user uploads in the static folder, which is not a good pattern (since that would be modifying package assets). A separate media folder will hopefully help with this.
### Expected Behavior

When a forward slash (`/`) is percent encoded, it should not be treated as a delimiter in a URL but instead should be treated as a string character.

```python
from flask import Flask
app = Flask(__name__)

@app.route('/<string:foo>')
def index(foo):
    return foo

app.run('localhost', 3000)
```

```bash
$ curl localhost:3000/foo%2Fbar
foo/bar
```


### Actual Behavior

```bash
$ curl localhost:3000/foo%2Fbar
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server.  If you entered the URL manually please check your spelling and try again.</p>
```

### Environment

* Python version: `Python 3.5.3`
* Flask version: `0.12.2`
* Werkzeug version: `0.12.2`

venv:
```
click==6.7
Flask==0.12.2
itsdangerous==0.24
Jinja2==2.9.6
MarkupSafe==1.0
Werkzeug==0.12.2
```

### Use Case

A website has the URL rule `/<string:company>/<string:user>`. Company names and users would have to have the slash character disallowed otherwise they would not be able to be cleanly represented as a URL.


### A Second Example

A second issue that I assume is directly related is that `url_for` doesn't escape the forward slash.

```python
from flask import Flask, Markup, request, redirect, url_for
app = Flask(__name__)

@app.route('/', methods=('GET', 'POST'))
def index():
    if request.method == 'POST':
        return redirect(url_for('other', foo=request.form['foo'], bar=request.form['bar']))
    else:
        return Markup(
            '''<form method="POST">
                 <input name="foo" type="text">
                 <input name="bar" type="text">
                 <input type="submit" value="Submit">
               </form>
            ''')


@app.route('/other/<string:foo>/<string:bar>')
def other(foo, bar):
    return '{}<br>{}'.format(foo, bar)


app.run('localhost', 3000)
```

In the browser, submitting `foo/moarfoo` and `bar` into the two fields yields the URL `/foo/moarfoo/bar` instead of `/foo%2Fmoarfoo/bar`.
Allows to create "empty" configuration object in order to initialize it in later during runtime. #2495
I get this error with: python -m app.py
**Error while finding module specification for 'app.py' (AttributeError: module 'app' has no attribute '__path__')**

and with python app.py nothing happening, either in venv or system.
Fixes #2481.


<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

### Expected Behavior

I'm trying to embed an audio player in my Flask website. Here's the relevant part of my `index.html`:

    <audio controls>
    <source src="/static/{{audio_file}}" type="audio/wav">
    Your browser does not support the audio element.
    </audio>

This works well in Firefox, but not in Safari.

### Actual Behavior

- Safari does show the audio controls, but the audio doesn't load.  
- I can download the file in Safari if I right-click the audio player.
- 'Open audio in new window' gives me a window with the 'play' button with a line struck through, indicating that Safari cannot play the file.

What's frustrating is that *the exact same HTML* (replacing `{{audio_file}}` with the actual filename) does work in Safari when I'm not using Flask (i.e. just opening static html in Safari). So something inside Flask keeps the audio from working.

I just tried a different file type (mp3, using `house_lo.mp3` copied from the pygame examples), and that works fine in Safari. So the problem only occurs when using `.wav` files. mp3 could solve the problem for me (just convert everything), but it's not ideal.

    <audio controls>
    <source src="/static/house_lo.mp3" type="audio/mp3">
    Your browser does not support the audio element.
    </audio>

### Environment

* Python version: 3.6.1 , Anaconda, OS X Sierra
* Flask version: 0.12
* Werkzeug version: 0.11.15

I've posted this issue on [StackOverflow](https://stackoverflow.com/questions/46914468/how-to-make-embedded-wav-audio-work-in-safari-using-flask) as well.
Fix typo in documentation.
It is recommended by GitHub as a part of its [community standards](https://opensource.guide/).
As it facilitates healthy and constructive community behavior.
More on this [here](https://opensource.guide/code-of-conduct/).
This fixes a self-reported issue.

The final sections of `appfactories.rst` stood out to me while I was going through the docs.

Made some minor changes to sentences so that they flow better.
The punctuation is also more consistent now (in the final list).

With regards to:

> The following changes are straightforward and possible:

"possible" was removed because it felt like it was implied in the context (why suggest them if they're not possible?). I did not get the same feeling about the implementation part, so I added an explicit "to implement" (because that's what the straightforwardness refers to).
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

hi,I used Flask to upload files to the server,.while I was uploading,nothing went wrong and there were not any bugs either, after the file was uploaded,the database was also modified, but when uploading finished, I clicked on the file link to find that no corresponding file on the server so the downloading process failed.Actually,there was a judgment after uploading,only when the file saved successfully success that it would write the database, but now the result turned out to be opposite,so I don't know where went wrong.Can somebody have a look?

### my upload file function
```
def upload_file(file_src, des_path, allowed_type=None):
    if file_src.filename == '':
        message = gettext('No selected file')
        return False, message

    extension = file_src.filename[file_src.filename.rfind('.')+1:]
    file_type = extension_to_file_type(extension)
    folder = des_path[:des_path.rfind('/')]

    if not allowed_type:
        allowed_type = current_app.config['ALLOWED_RESOURCE_TYPE']

    if file_src and '.' in file_src.filename and file_type in allowed_type:
        if not os.path.exists(folder):
            os.makedirs(folder)
        file_src.save(des_path)
        unique_uri = os.stat(des_path).st_mtime
        if os.path.exists(des_path):
            return True, unique_uri
        else:
            message = gettext("Save File Failed!")
            return False, message
    else:
        message = gettext("Invalid file")
        return False, message
```


```python
Paste a minimal example that causes the problem.
```



### Environment

* Python version: 2.7.14
* Flask version: 0.11.1
* Werkzeug version:

https://bitsup.blogspot.fr/2016/05/cache-control-immutable.html

It would mean adding the `immutable` attribute to [ResponseCacheControl](http://werkzeug.pocoo.org/docs/0.12/datastructures/#werkzeug.datastructures.ResponseCacheControl) (default to False).
i installed flask and flask-ask . and then i wrote flask run command but error occured
it says : Could not locate Flask application. You did not provide the FLASK_APP environment variable.
i'm stuck here.
plz help me.

### Expected Behavior

It may be an unusual case, but I initialize Config objects just to load remote secure environment variables in addition to my normal app config loading. I've always just initialized with Config(None) under Python 2, but have just switched over to Python 3 and it throws an exception as described below. Note that the file is loaded into a local temp file.

I can work around the problem by putting anything in for root_path, but it would be cleaner if I could pass None for the root_path. I would expect Flask to assume fully qualified paths for files if root_path is not set.

```python
config = Config(None)
with tempfile.NamedTemporaryFile() as s3_file:
    if get_config_file(stage, s3_file.name):
        config.from_pyfile(s3_file.name)
```

### Actual Behavior

The os.path.join() call fails since the root_path is None.

```pytb
  File "/app/config.py", line 28, in _from_s3
    config.from_pyfile(s3_file.name)
  File "/usr/lib/python3.6/site-packages/flask/config.py", line 125, in from_pyfile
    filename = os.path.join(self.root_path, filename)
  File "/usr/lib/python3.6/posixpath.py", line 78, in join
    a = os.fspath(a)
TypeError: expected str, bytes or os.PathLike object, not NoneType
```

### Environment

* Python version: 3.6
* Flask version: 0.12.2
* Werkzeug version: 0.12.2

Hi,
I'm always confuse about  keyword args in test method(GET, POST...). 
For example, test post files or json, but I find solutions in StackOverFlow everytimes. 

I debug in source code, find  `FlaskClient.open` and `werkzeug.EnvironBuilder` .

Maybe, we could give some test demo in  Testing and  give more explict description in `FakeClient.open` like [requests](http://docs.python-requests.org/en/master/api/)



IMO, you would normally interpret "creating and closing database connections all the time" as "creating and closing database connection on each request" as opposed to keeping persistent database connection for a lifetime of an application. However, the documentation is either misleading or "creating and closing database connection on each query" was implied. This, and the term "**application** context" itself makes it look like data placed into flask.g will be available for the following requests, which is not true at all. Let's make the documentation more explicit on this.
Remove extra parenthesis from RequestFormatter constructor.


Reword the CLI loader errors to use current examples and try to describe the issues more accurately. Refactor the loader code.

Entirely rewrite the CLI docs. Wording is tightened up, sections are reorganized. Section about app detection quickly explains basics and shows typical values, then explains full rules.

closes #2027 

### Expected Behavior

inside blueprints.flaskr.py from flask examples I add some code

```python
from foo import Foo

@bp.route('/')
def index():
    a = Foo()
    print a
    # a is valid Foo object, no error here
    with open('some_pkl_file', 'rb') as f:
        # Foo object in some_pkl_file
        my_foo = cPickle.load(f)
    print my_foo
    # other things
```

### Actual Behavior

cPickle and pickle can't find Foo. Even after I installed ```foo``` as package. Looks like ```import``` inside flask application imports packages to some special namespace or context, where ```pickle``` or ```cPicke``` can't find them. I open this issue because I spent a day and didn't find any information about this. If someone know how to fix this, help me =)

```pytb
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1997, in __call__
    return self.wsgi_app(environ, start_response)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1985, in wsgi_app
    response = self.handle_exception(e)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1540, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1982, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1614, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1517, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1612, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1598, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/path/flaskr/flaskr/blueprints/flaskr.py", line 58, in index
    my_foo = cPickle.load(f)
AttributeError: 'module' object has no attribute 'Foo'
```

### Environment

* Python version: 2.7
* Flask version:0.12.2
* Werkzeug version:'0.12.2'

I working from i didn't face any issues but now i'm getting issues when i am submitting form data like this  "flask_wtf.Form" has been renamed to "FlaskForm" and will be removed in 1.0.
Hello,

I have an issue. I am basically reading out of a book. I run a Debian Distro kernel 4.4.x on a beagleBone Black Wireless.

I am using Adafruit_BBIO for software to hardware connections. Adafruit_BBIO is basically a Rasp. Pi build for the BBB with PWM, i2c, UART, ADC, and others.

Expected Behavior of the Program:

This software runs a Flask app to allow me to know when, while online via 192.168.7.2:5000, someone has opened my door and for how long. I have followed some directions out of a book I purchased.

There is also a LED that should allow for dimming and brightening via Web address and a numerical value of that address. 

    from flask import Flask, render_template
    app = Flask(__name__)
    import Adafruit_BBIO.GPIO as GPIO
    import Adafruit_BBIO.PWM as PWM

    PWM.start("P8_13", 0.0)

    @app.route("/")
    def hello():
        if GPIO.input(P8_11):
            doorStatus = "open"
        else:
            doorStatus = "closed"
        templateData = {
            'doorStatus': doorStatus,
        }
        return render_template('main-door.html', **templateData)
    
    @app.route('/ledLevel/<level>')
    def pin_state(level):
        PWM.set_duty_cycle("P8_13", float(level))
        return "LED level set to " + "."
    
    if __name__ == "__main__":
        app.run(host='192.168.7.2', port=5000, debug=True)

I get an error code. 

    Exception in thread Thread-1 (most likely raised during interpreter shutdown):
    Traceback (most recent call last):
      File "/usr/lib/python2.7/threading.py", line 801, in __bootstrap_inner
      File "/usr/lib/python2.7/threading.py", line 754, in run
      File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 702, in inner
      File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 539, in serve_forever
      File "/usr/lib/python2.7/SocketServer.py", line 236, in serve_forever
      File "/usr/lib/python2.7/threading.py", line 585, in set
      File "/usr/lib/python2.7/threading.py", line 407, in notifyAll
    <type 'exceptions.TypeError'>: 'NoneType' object is not callable

![book work](https://user-images.githubusercontent.com/9708195/31322636-2904638c-ac61-11e7-94ee-8981d78a2321.JPG)



### Environment

* Python version: 2.7.13
* Flask version: 0.12.2
* Werkzeug version: I cannot find what version is located on my system. I did find this when trying to sudo pip install flask:  Werkzeug>=0.7

Seth

P.S. If you have time to review all this mess, please let me know. If you want me to look up items, please direct me. Thank you again for any support. 

## Reasons for dropping old ones

### 2.6

* Unsupported since [2013-10-29](https://en.wikipedia.org/wiki/CPython#Version_history)
* https://snarky.ca/stop-using-python-2-6/
* http://www.curiousefficiency.org/posts/2015/04/stop-supporting-python26.html
* http://www.python3statement.org
* Current pip 9 deprecates Python 2.6 support, pip 10 won't support it (https://github.com/pypa/pip/issues/3955)
* Not much PyPI traffic (June 2016) https://github.com/pypa/pip/issues/3796

### 3.2

* (Already dropped 👍 )

### 3.3

* Unsupported since [2017-09-29](https://en.wikipedia.org/wiki/CPython#Version_history)
* pip 10 will deprecate Python 3.3 support, pip 11 won't support it (https://github.com/pypa/pip/issues/3796)
* Very little PyPI traffic (June 2016) https://github.com/pypa/pip/issues/3796

### Also

This prevents this project's dependencies, such as MarkupSafe, from moving forward. See https://github.com/pallets/markupsafe/pull/79#issuecomment-335014965.
* [ ] Changelog


### Expected Behavior

If I active debug mode the program fails as is shown below. However with deactivated debug mode the program runs fine.

```python
from flask import Flask

app = Flask(__name__)


@app.route('/')
def hello_world():
    return 'Hello World!'


if __name__ == '__main__':
    app.run()
```

### Actual Behavior


```pytb
* Serving Flask app "flask_hello_world"
 * Forcing debug mode on
 * Restarting with stat
  File "C:\Users\Tim\Anaconda3\envs\flaskr\Scripts\flask.exe", line 1
SyntaxError: Non-UTF-8 code starting with '\x90' in file C:\Users\Tim\Anaconda3\envs\flaskr\Scripts\flask.exe on line 1, but no encoding declared; see http://python.org/dev/peps/pep-0263/ for details
```

### Environment

I am running it on Windows 10. Python and packages are installed through Anaconda.

* Python version: 3.6
* Flask version: 0.12.2
* Werkzeug version: 12.2

Prior to werkzeug 0.12.2, it was possible to manipulate the status code to exception type maps flask used by invoking

    flask.abort.mapping.update(mapping)

This brings that back by creating a flask specific werkzeug.exceptions.Aborter object and exposing it as flask.aborter. It also implements a flask.abort function so that the correct docstring is exposed:

    flask.aborter.mapping.update(mapping)

I've included tests for the new feature which include 100% coverage of the new code branches, and all tests pass (in python 2.7).

This also helps address #2218 without having to lock to the specific version of werkzeug.
I pulled the latest master branch and ran "python setup.py install". 
Then, I tried to load flask.app.test_client(), but it fails.
Please let me know how to overcome this. Thank you!

```
MOOLE04mac1231:flask moole04$ python
Python 2.7.10 (default, Feb  7 2017, 00:08:15)
[GCC 4.2.1 Compatible Apple LLVM 8.0.0 (clang-800.0.34)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import flaskr
>>> t= flaskr.app.test_client()
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
AttributeError: 'module' object has no attribute 'app'
>>>
```
I've encountered an avoidable bug in Flask's jsonify module. 
When trying to push a dictionary with includes one (or multiple) Decimal objects through jsonify we encounter the following error:
 

> TypeError: Decimal('1.600') is not JSON serializable

I've traced back the error to the following python file:
/usr/lib64/python2.7/site-packages/flask/json.py


The JSON module used by Flask comes from 'itsdangerous' which doesn't seem like a great idea, mostly because the version seems depreciated. 
Since a lot of users run queries from the database through jsonify it is not unthinkable that more users are facing this issue, and have to jump around in hoolaphoops to get it working. 
By using the 'simplejson' module ( > 2.1 ; released on 11 Mar 2010) we can avoid this and use the 'use_decimals' option in simplejson.dump. 

Thefore I would like to propose the following codechange in flask/json.py: 
[import statement]
```
# Try to use the default simplejson implementation. This is good for performance and stability.
# Otherwise use the same json implementation as itsdangerous on which we
# depend anyways.
try:
    import simplejson as _json
except ImportError:
    try:
        from itsdangerous import simplejson as _json
    except ImportError:
        from itsdangerous import json as _json
```

### Environment

* Python version: 2.7
* Flask version: 0.12.2
* Werkzeug version: 0.12
* simplejson version: 3.11.1

See https://github.com/travis-ci/travis-ci/issues/1094#issuecomment-215019909 and 
https://github.com/mozilla/build-tools/commit/c13a297. Using a secure value for the IRC channel prevents notifications from forks.
Hi all, 

[removed link]

If it can help you in study and practices, I would like to share with you a complete flask demo app, easy professional examples of common web services we can get with this great micro-framework flask ; Featurng bootstrap themes, authentication and backoffice admin, Secured admin panel, pagination, resources CRUD, modular structure, REST json responses or Html renders, some utils like config files for Nginx and Gunicorn and much more. 


### Environment
* Python version: 2 and 3
* Flask version: 0.12
* Werkzeug version: 0.11.15

---

### Expected Behavior

The app should've run

```python
any flask app really
```

### Actual Behavior

Flask didn't startup properly and threw an errorcode

```pytb
$ flask run
* Serving Flask app "falsker"
* Forcing debug mode on
* Restarting with stat
File "C:\Anaconda3\envs\flaskui\Scripts\flask.exe", line 1
SyntaxError: Non-UTF-8 code starting with '\x90' in file C:\Anaconda3\envs\flaskui\Scripts\flask.exe on line 1, but no encoding declared; see http://python.org/dev/peps/pep-0263/ for details
```

### Environment

* Python version: 3.6.2 on Anaconda
* Flask version:0.12.2
* Werkzeug version:0.12.2

Inside my flask app, I want to have a dictionary to which key-value pairs can be added throughout the app lifecycle.

Here is what I am trying to do:

```
app = Flask(__name__)

@app.route('/incoming_key_value', methods=['POST'])
def add_dic_element():
    global results
    results[time.time()] = time.time()
    print (results)
    return 'OK'

if __name__ == '__main__':
    results = {'test':00000}
    app.run()
```
I want to add a key-value pair to the dictionary with every POST request.

So, after hitting `add_dic_element` function twice I would expect my `results` to look like this:

`{1506672672.252906: 1506672672.2529054, 1506672665.4726737: 1506672665.472673, 'test': 00000}`

But regardless how many times I hit the `add_dic_element` function the `results` will only have the initial element and the **last** value added by `add_dic_element`. Like this:

`{1506672672.252906: 1506672672.2529054, 'test': 0}`

How do I make so that I keep adding elements to the global dictionary?
The main purpose of this is to have a single place where extensions
can register their cleanup functions. If you are creating many app
instances for testing purposes, you need to keep track of all
individual extensions and release the resources from all of them.
Allowing them to register a cleanup function inside init_app would
hide the complexity and app.close() would be the only thing tests
need to care about.
Tracebacks in [Travis CI](https://travis-ci.org/pallets/flask/jobs/278955320) :
```pytb
codecov runtests: commands[2] | codecov
Traceback (most recent call last):
  File "/home/travis/build/pallets/flask/.tox/codecov/bin/codecov", line 7, in <module>
    from codecov import main
  File "/home/travis/build/pallets/flask/.tox/codecov/lib/python2.6/site-packages/codecov/__init__.py", line 8, in <module>
    import argparse
ImportError: No module named argparse
ERROR: InvocationError: '/home/travis/build/pallets/flask/.tox/codecov/bin/codecov'
___________________________________ summary ____________________________________
  py: commands succeeded
ERROR:   codecov: commands failed
```

Tips in [argparse's PyPI page](https://pypi.python.org/pypi/argparse):
> As of Python >= 2.7 and >= 3.2, the argparse module is maintained within the Python standard library. For users who still need to support Python < 2.7 or < 3.2, it is also provided as a separate package, which tries to stay compatible with the module in the standard library, but also supports older Python versions.

Relevant pull request: #2475 
Delete repeat word in comment.

### flask thread is always running, can't stop
I use flask as http server, for Multi-threaded support, I set `threaded=True`, The Call Stack shows every thread is running and not cancel when function finished.

![20170920194345](https://user-images.githubusercontent.com/4026598/30746348-24f4018a-9fdc-11e7-9a37-d93867813967.png)

And the memory has been growing until crashed.
![ilekf](https://user-images.githubusercontent.com/4026598/30746436-6139ae24-9fdc-11e7-98a9-8aaa6433f98e.png)

```
[2017-09-22 21:05:07,303] ERROR in app: Exception on /api [POST]
Traceback (most recent call last):
  File "D:\Program_Files\Python\Python2\lib\site-packages\flask-0.12.2-py2.7.egg\flask\app.py", line 1982, in wsgi_app
    response = self.full_dispatch_request()
  File "D:\Program_Files\Python\Python2\lib\site-packages\flask-0.12.2-py2.7.egg\flask\app.py", line 1614, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "D:\Program_Files\Python\Python2\lib\site-packages\flask-0.12.2-py2.7.egg\flask\app.py", line 1517, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "D:\Program_Files\Python\Python2\lib\site-packages\flask-0.12.2-py2.7.egg\flask\app.py", line 1612, in full_dispatch_request
    rv = self.dispatch_request()
  File "D:\Program_Files\Python\Python2\lib\site-packages\flask-0.12.2-py2.7.egg\flask\app.py", line 1598, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "d:\Workspace\python\ftp-server\code\Http_Server.py", line 37, in api
    for index in socket_map:
RuntimeError: dictionary changed size during iteration
```

### Environment

* Python version: 2.7.13
* Flask version: flask-0.12.2-py2.7.egg
* Werkzeug version: werkzeug-0.12.2-py2.7.egg

it woul be great if it would be possible to register a blueprint inside of an other blueprint
to increase modularity

### Expected Behavior

Sending commands through the serial port.

```python
app = Flask(__name__)
serialPort = serial.Serial(port = "COM5", baudrate=1000000,
                           bytesize=8, timeout=2, stopbits=serial.STOPBITS_ONE)

lamp = {
   1 : {'name' : 'n1', 'state' : True},
   2 : {'name' : 'n2', 'state' : True} 
}

@app.route("/")
def hello():
   templateData = {
      'lamp': lamp
      }

   
   return render_template('main.html', **templateData)


@app.route("/setPin/<action>")
def action(action):

   if action == "on":

      serialPort.write(b"n2c1111\r\n")
      lamp[1]["state"] = True

   if action == "off":
      serialPort.write(b"n2c0000\r\n")
      lamp[1]["state"] = False


   templateData = {
      'lamp': lamp
   }

   return render_template('main.html', **templateData)

if __name__ == "__main__":
   app.run(host='0.0.0.0', port=5000, debug=True)
```


### Actual Behavior

I can not access the serial port with  FLASK_ENV = development and FLASK_DEBUG = 1. Everything works fine with DEBUG mode disabled.

```pytb
FLASK_APP = app.py
FLASK_ENV = development
FLASK_DEBUG = 1
In folder C:/Users/user/PycharmProjects/Ho_server
C:\Users\user\Anaconda3\python.exe -m flask run
 * Serving Flask app "app.py" (lazy loading)
 * Environment: development
 * Debug mode: on
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 138-068-963
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
127.0.0.1 - - [30/Oct/2018 10:49:27] "GET /setPin/on HTTP/1.1" 500 -
Traceback (most recent call last):
  File "C:\Users\user\Anaconda3\lib\site-packages\flask\_compat.py", line 35, in reraise
    raise value
  File "C:\Users\user\PycharmProjects\H_server\app.py", line 8, in <module>
    bytesize=8, timeout=2, stopbits=serial.STOPBITS_ONE)
  File "C:\Users\user\Anaconda3\lib\site-packages\serial\serialwin32.py", line 31, in __init__
    super(Serial, self).__init__(*args, **kwargs)
  File "C:\Users\user\Anaconda3\lib\site-packages\serial\serialutil.py", line 240, in __init__
    self.open()
  File "C:\Users\user\Anaconda3\lib\site-packages\serial\serialwin32.py", line 62, in open
    raise SerialException("could not open port {!r}: {!r}".format(self.portstr, ctypes.WinError()))
serial.serialutil.SerialException: could not open port 'COM5': PermissionError(13, 'Access is denied.', None, 5)
```

### Environment

* Python version: 3.6.5
* Flask version: 1.0.2

Describe what this patch does to fix the issue.

Fix inconsistent data in testing document.

Link to any relevant issues or pull requests.

N/A

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

**Summary**
Adds the instance folder to the template search path for `Flask` objects.

**Pupose**

Instance folders are currently limited to specifying config. However, they have the potential to be more flexible. 

For example, consider writing a static site generator in flask. The CLI could handle initialising the application, setting up routes etc. It would make sense to specify the site directory as an instance folder, for loading configuration. This pull request would enable features like custom themes by adding them to the site directory, overriding or extending the package defaults.

**Changes**

The Jinja `FileSystemLoader` allows for multiple search paths to be specified. Each path will be tested in order, so we simply override `_PackageBoundObject.jinja_loader`, and add the instance folder to the searchpaths.

**Evaluation of Alternatives**

One alternative solution to the example specified above would be to instead change the `root_path` of the application. However, this wouldn't allow for the user to use resources installed in the package.

Another alternative solution would be to use Blueprints to solve cases where we want to create multiple similar applications. If this is the preferred solution, the I'm happy to close the request.

**Other points**

I noticed that `tests/test_templating.py::test_custom_template_loader` tested overriding `Flask.create_global_jinja_loader`. I changed the test to use the recommended method of overloading `_PackageBoundObejct.jinja_loader` instead. Let me know if you think this should be in a separate pull request.

**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

Tell us what should happen.

```python
Paste a minimal example that causes the problem.
```

### Actual Behavior

Tell us what happens instead.

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version:
* Flask version:
* Werkzeug version:

A substitute for #2971 and Fix #2967, if needed.
On the examples page: http://flask.pocoo.org/community/poweredby/
many links are dead.
I think this prevents newcomers from being awe-inspired by what one can do with flask.  
Clarify documentation as discussed here: https://github.com/pallets/flask/issues/2967
Increase readability of "AJAX with jQuery" tutorial by adding a where clause
Update docs to use https for external links wherever possible.

Please also consider supporting https on all the subdomains of pocoo.org in near future :-)
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Would it be beneficial to others following the tutorial to explicitly say that you should run the `flask run` command in the parent directory of "flaskr" and not in  "flaskr"? I stumbled on this getting an error when trying to run the flask developer server from the flaskr directory while following along in the [tutorial](http://flask.pocoo.org/docs/1.0/tutorial/factory/#the-application-factory)
https://github.com/pallets/flask/blob/master/docs/tutorial/factory.rst
[`after_this_request()`][1] callback function has to return a response object.

[1]: http://flask.pocoo.org/docs/1.0/api/#flask.after_this_request
Jinja2 template not update

---

### Expected Behavior

Tell us what should happen.

```python
Paste a minimal example that causes the problem.
```

### Actual Behavior

Tell us what happens instead.

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version: 3.6.4
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

Docs chapter "Patterns for Flask" has a section dedicated to MongoKit,
but MongoKit lib seems unmaintained and is not compatible with recent
versions of PyMongo.

This commit replaces MongoKit guide with a new one using MongoEngine.

Closes #2907
Flask currently supports importing app through a combination of module path and app variable name, such as '/usr/app.py:my_app'. When the module path contains a colon, it will conflict with this import way and a `flask.cli.NoAppException` will be raised.

A file path on a Windows system may contain a colon followed by a slash. So we solved this problem on Windows by ignoring the colon followed by a slash when we split `app_import_path`. 

Fix issue #2961.
I know this PR is too trivial, so you can close it at will.

I just think `Flask` as a famous framework needs to be stricter with itself.

### Expected Behavior
Previously in our development environment we ran flask app from vscode but after we updated to the latest version of flask we started experiencing problems. After some investigation I found out that in our run configuration we specify the whole path to the app.py-file. Changing to just referencing it directly (i.e. app.py instead of C:\Path\To\My\app.py) I got it to work.

I recreated the fault in another simpler environment:

The following command runs 
``` env "FLASK_APP=`pwd`/app.py" "FLASK_ENV=Development" "FLASK_DEBUG=1" env/Scripts/python.exe -m flask run```

but when you try to access localhost:5000/ you get the following error

```Traceback (most recent call last):
  File "C:\Users\AlexanderS\code\flask-bugg\env\lib\site-packages\flask\cli.py", line 330, in __call__
    rv = self._load_unlocked()
  File "C:\Users\AlexanderS\code\flask-bugg\env\lib\site-packages\flask\cli.py", line 317, in _load_unlocked
    self._app = rv = self.loader()
  File "C:\Users\AlexanderS\code\flask-bugg\env\lib\site-packages\flask\cli.py", line 372, in load_app
    app = locate_app(self, import_name, name)
  File "C:\Users\AlexanderS\code\flask-bugg\env\lib\site-packages\flask\cli.py", line 246, in locate_app
    'Could not import "{name}".'.format(name=module_name)
flask.cli.NoAppException: Could not import "C".
```


### Actual Behavior
The application should run without errors.

### Environment

* Python version: 3.6.5
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

Recreated the bug with the follow app.py

```python
from flask import Flask

app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello world2'
```

Desiring a deep copy of **session** `RequestContext` data is present as a separate [issue](https://github.com/pallets/flask/issues/2935) and [pull request](https://github.com/pallets/flask/pull/2936).  This issue is focused on desiring a deep copy of the **request** `RequestContext` data for use in a separate thread.  To pursue this, it is necessary to copy the `environ` data in a new function or the same `copy_current_request_context` function with a boolean argument to enable the deep copy.

### Expected Behavior

For using a thread with a copy of a request, it is advantageous to have the functionality present in `copy_current_request_context`, though the request needs a deep copy instead of a shallow copy.  Based on the code comment of the `RequestContext` `copy` function, the intent of the function was a shallow copy, due to "Because the actual request object is the same this cannot be used to move a request context to a different thread unless access to the request object is locked.".

For having a copy of a request for a separate thread, I found it necessary to modify the `flask.copy_current_request_context` function to be:

    def _copy_current_request_context(function):
        top = _request_ctx_stack.top
        if top is None:
            raise RuntimeError('This decorator can only be used at local scopes '
                               'when a request context is on the stack.  '
                               'For instance within view functions.')
        reqctx = top.copy()
        # environ is used by headers too, so only a copy of environ is necessary
        reqctx.request.environ = reqctx.request.environ.copy()
        def wrapper(*args, **kwargs):
            with reqctx:
                return function(*args, **kwargs)
        return update_wrapper(wrapper, function)

If the request `environ` is not copied, it is possible with flask 1.0.2 to have older requests in a separate thread read the environ data from newer requests with methods like `request.method`, which is not desirable at all.  I am not suggesting modifying `flask.copy_current_request_context` to be like the source code above (1 line change), but rather suggesting the `RequestContext` `copy` function could be modified to create a deep copy of a request by providing an `environ.copy()` to the `RequestContext` class to create a new request object.  The deep copy could occur based on a boolean keyword argument added to `flask.copy_current_request_context`.

However, if you want that functionality for threads, you also need to be able to copy the current_app context:

    def _copy_current_app_context(function):
        app_context = _app_ctx_stack.top
        def current_app_context_decorator(*args, **kwargs):
            with app_context:
                return function(*args, **kwargs)
        return current_app_context_decorator

Then you would want to use them together with a single decorator:

    def bind_context(function):
        function = _copy_current_request_context(function)
        function = _copy_current_app_context(function)
        return function

### Actual Behavior

`flask.copy_current_request_context` will only do a shallow copy and the `copy_current_app_context` decorator is not provided, nor is the `bind_context` decorator.  That makes development with threads require more custom source code and be more error-prone than it needs to be.

### Environment

* Python version: 2.7.9
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](http://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

```flask-tutorial
$ coverage run -m pytest
Name                 Stmts   Miss Branch BrPart  Cover
------------------------------------------------------
flaskr/__init__.py      22      0      2      0   100%
flaskr/auth.py          54      0     22      0   100%
flaskr/blog.py          54      0     16      0   100%
flaskr/db.py            24      0      4      0   100%
------------------------------------------------------
TOTAL                  154      0     44      0   100%
```

### Actual Behavior

```flask-tutorial
$ coverage run -m pytest
============================================================== test session starts ==============================================================
platform darwin -- Python 2.7.10, pytest-3.9.1, py-1.7.0, pluggy-0.8.0
rootdir: /Users/adamg9999/Development/flask-tutorial, inifile: setup.cfg
collected 24 items

tests/test_auth.py ........                                                                                                               [ 33%]
tests/test_blog.py ............                                                                                                           [ 83%]
tests/test_db.py ..                                                                                                                       [ 91%]
tests/test_factory.py ..                                                                                                                  [100%]

=========================================================== 24 passed in 1.15 seconds ===========================================================
```

for coverage > 4.0 need to first run `coverage run -m pytest` this will print the pytest output to STDOUT, then a followup `coverage report` will output the expected report:

```$ coverage report
Name                 Stmts   Miss Branch BrPart  Cover
------------------------------------------------------
flaskr/__init__.py      22      0      2      0   100%
flaskr/auth.py          54      0     22      0   100%
flaskr/blog.py          54      0     16      0   100%
flaskr/db.py            24      0      4      0   100%
------------------------------------------------------
TOTAL                  154      0     44      0   100%```

### Environment

$ python --version
Python 2.7.10 :: Continuum Analytics, Inc.
(py2.7.10) adamg9999 flask-tutorial
$ flask --version
Flask 1.0.2
$ coverage --version
Coverage.py, version 4.5.1 with C extension

**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](http://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

Following the Tutorial step by step I received errors when testing HTTP requests.
The errors where  caused for a missing 'WTF_CSRF_ENABLED' in the app config.

in file conftest.py changed the create_app to:

app = create_app({
        'TESTING': True,
        'DATABASE': db_path,
        'WTF_CSRF_ENABLED': False       # this solved the problem
    })

```python
Paste a minimal example that causes the problem.
```

### Actual Behavior

Tell us what happens instead.

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version: 3.7
* Flask version: 1.0.2
* Werkzeug version:

In `helpers.py` when `file` is a `BytesIO`, `fsize` was not setted. It should be setted.

Issue: https://github.com/pallets/flask/issues/2943

- [x] add tests that fail without the patch
- [x] ensure all tests pass with ``pytest``
- [x] add documentation to the relevant docstrings or pages
- [x] add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
- [x] add a changelog entry if this patch changes code


### Expected Behavior

Login form is rendered correctly

```python
return render_template('login.html', form=LoginForm())
```

### Actual Behavior

We've reviewed this using pdb; it seems that the return value from dumps isn't always bytes, and when serializing the csrf_token on the second pass it comes back as dict.

```pytb
Traceback (most recent call last):
  File "C:\Users\jburke\AppData\Local\Continuum\anaconda3\lib\site-packages\flask\app.py", line 2308, in __call__
    return self.wsgi_app(environ, start_response)
  File "C:\Users\jburke\AppData\Local\Continuum\anaconda3\lib\site-packages\beaker\middleware.py", line 156, in __call__
    return self.wrap_app(environ, session_start_response)
  File "C:\Users\jburke\AppData\Local\Continuum\anaconda3\lib\site-packages\flask\app.py", line 2294, in wsgi_app
    response = self.handle_exception(e)
  File "C:\Users\jburke\AppData\Local\Continuum\anaconda3\lib\site-packages\flask\app.py", line 1739, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "C:\Users\jburke\AppData\Local\Continuum\anaconda3\lib\site-packages\flask\_compat.py", line 35, in reraise
    raise value
  File "C:\Users\jburke\AppData\Local\Continuum\anaconda3\lib\site-packages\flask\app.py", line 2291, in wsgi_app
    response = self.full_dispatch_request()
  File "C:\Users\jburke\AppData\Local\Continuum\anaconda3\lib\site-packages\flask\app.py", line 1815, in full_dispatch_request
    return self.finalize_request(rv)
  File "C:\Users\jburke\AppData\Local\Continuum\anaconda3\lib\site-packages\flask\app.py", line 1832, in finalize_request
    response = self.process_response(response)
  File "C:\Users\jburke\AppData\Local\Continuum\anaconda3\lib\site-packages\flask\app.py", line 2113, in process_response
    self.session_interface.save_session(self, ctx.session, response)
  File "C:\Users\jburke\AppData\Local\Continuum\anaconda3\lib\site-packages\flask\sessions.py", line 375, in save_session
    val = self.get_signing_serializer(app).dumps(dict(session))
  File "C:\Users\jburke\AppData\Local\Continuum\anaconda3\lib\site-packages\itsdangerous\serializer.py", line 114, in dumps
    payload = want_bytes(self.dump_payload(obj))
  File "C:\Users\jburke\AppData\Local\Continuum\anaconda3\lib\site-packages\itsdangerous\url_safe.py", line 45, in dump_payload
    compressed = zlib.compress(json)
TypeError: a bytes-like object is required, not 'dict'
```

The problem is the return from:

```python
json = super(URLSafeSerializerMixin, self).dump_payload(obj)
```

and as mentioned above we see the key serialized with one serializer (`TaggedJSONSerializer`) which returns bytes, while the value itself appears to be serialized with another(`_CompactJSON`) which fails.

### Environment

* Python version: 3.6.5
* Flask version: 1.0.2/1.1dev0
* Werkzeug version: 0.14.1

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Currently we set minimum versions only, with no maximum version requirement. Should we prevent implicit updates to new major versions of any of our dependencies?
itsdangerous v1 has a breaking change that changes the session hashing algorithm.

Users would be signed out when an build of flask that has depended on the new itsdangerous v1.0 is released.

https://github.com/pallets/flask/issues/2952


### Expected Behaviour
User sessions should remain valid across versions.

### Actual Behaviour

itsdangerous v1.0 was release about 16 hours ago.
Users are signed out when an build of flask that has depended on the new itsdangerous v1.0 is released. This is because the new version has a breaking change that changes the session hashing algorithm.

https://github.com/pallets/itsdangerous/blob/master/CHANGES.rst
https://github.com/pallets/flask/blob/master/flask/sessions.py#L6 
https://github.com/pallets/flask/blob/master/setup.py#L39
https://pypi.org/project/itsdangerous/#history

### Environment

* Python version: 3.6
* Flask version: 1+


### Expected Behavior

This snippet should open a serial port and start flask in debug mode.

```python
from flask import Flask
import serial 

ser = serial.Serial('\\\\.\\COM3',9600)
app = Flask(__name__)

app.run(debug=True)
```

### Actual Behavior

An exception is thrown saying that the serial port is in use.
This only happens if debug=True is present.
It works as expected if I only have app.run()


### Environment

* Python version:  3.6.5
* Flask version: 1.0.2'

https://github.com/pallets/flask/blob/673772cac931fea88b6134e57643bba9f0b27d44/flask/__main__.py#L12

It's always true.
Because of usual practice?
The `flask.testing` `FlaskClient` has clean-up which only happens if you use the test client in a `with` block:

```python
class FlaskClient(Client):

    # ...

    def __exit__(self, exc_type, exc_value, tb):
        self.preserve_context = False

        # on exit we want to clean up earlier.  Normally the request context
        # stays preserved until the next request in the same thread comes
        # in.  See RequestGlobals.push() for the general behavior.
        top = _request_ctx_stack.top
        if top is not None and top.preserved:
            top.pop()
```

This is described in the API documentation for [`app.test_client()`](http://flask.pocoo.org/docs/0.12/api/#flask.Flask.test_client), but isn't mentioned in the [Testing Flask Applications](http://flask.pocoo.org/docs/1.0/testing/) chapter of the documentation, and the "testing skeleton" code doesn't use `test_client()` in a `with` block:

```python
@pytest.fixture
def client():
    db_fd, flaskr.app.config['DATABASE'] = tempfile.mkstemp()
    flaskr.app.config['TESTING'] = True
    client = flaskr.app.test_client()

    with flaskr.app.app_context():
        flaskr.init_db()

    yield client
```

The [Testing Flask Applications](http://flask.pocoo.org/docs/1.0/testing/) chapter should demonstrate using the test client in _some way_ which does teardown.

I raise this because I used the skeleton code as basis for a `pytest` fixture, and I _believe_ I've run into intermittent test failure issues which are caused by request context leaking between tests.
---

### Expected Behavior

Handle any exception in route function

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
from flask import Flask, Blueprint

bp = Blueprint('section', __name__)


@bp.route("/")
def hello():
    return "you are visiting 'http://hostname/section/'"

@bp.route("/exc")
def exc_test():
    raise Exception("bug")

app = Flask(__name__)


@app.errorhandler(Exception)
def any_unknown_error(e):
    upload_exception_to_log_server(e)
    if app.debug:
        raise e  # Show Werkzeug debugger while debugging

    # return api json with message
    # rather than break front-end page ajax
    return '{"code": 5, "message": "%s"}' % e


app.register_blueprint(bp, url_prefix='/%s' % bp.name)

```

### Actual Behavior

This break strict_slash redirect, which raised a `werkzeug.routing.RequestRedirect: 301 Moved Permanently: None` to do the redirection

To reproduce this, visit localhost:5000/section  (without trailing slash)

```pytb
File "f:\code\flask_bug_test\venv\lib\site-packages\flask\app.py", line 2309, in __call__
    return self.wsgi_app(environ, start_response)
File "f:\code\flask_bug_test\venv\lib\site-packages\flask\app.py", line 2295, in wsgi_app
    response = self.handle_exception(e)
File "f:\code\flask_bug_test\venv\lib\site-packages\flask\app.py", line 1741, in handle_exception
    reraise(exc_type, exc_value, tb)
File "f:\code\flask_bug_test\venv\lib\site-packages\flask\_compat.py", line 35, in reraise
    raise value
File "f:\code\flask_bug_test\venv\lib\site-packages\flask\app.py", line 2292, in wsgi_app
    response = self.full_dispatch_request()
File "f:\code\flask_bug_test\venv\lib\site-packages\flask\app.py", line 1815, in full_dispatch_request
    rv = self.handle_user_exception(e)
File "f:\code\flask_bug_test\venv\lib\site-packages\flask\app.py", line 1713, in handle_user_exception
    return self.handle_http_exception(e)
File "f:\code\flask_bug_test\venv\lib\site-packages\flask\app.py", line 1644, in handle_http_exception
    return handler(e)
File "F:\Code\flask_bug_test\start.py", line 21, in any_unknown_error
    raise e  # Show exception while debugging
File "f:\code\flask_bug_test\venv\lib\site-packages\flask\app.py", line 1813, in full_dispatch_request
    rv = self.dispatch_request()
File "f:\code\flask_bug_test\venv\lib\site-packages\flask\app.py", line 1791, in dispatch_request
    self.raise_routing_exception(req)
File "f:\code\flask_bug_test\venv\lib\site-packages\flask\app.py", line 1774, in raise_routing_exception
    raise request.routing_exception
File "f:\code\flask_bug_test\venv\lib\site-packages\flask\ctx.py", line 336, in match_request
self.url_adapter.match(return_rule=True)
File "f:\code\flask_bug_test\venv\lib\site-packages\werkzeug\routing.py", line 1542, in match
safe='/:|+') + '/', query_args))
    werkzeug.routing.RequestRedirect: 301 Moved Permanently: None
```

### Environment

* Python version: 3.6.6
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

Dear Flask Team,

MailboxValidator had introduced a new Flask extension that can help Flask users to validate email in various purpose. We would like to submit this extension for listing in the Flask Extension Registry.

Extension Name: Flask_MailboxValidator
PYPI link: https://pypi.org/project/flask-MailboxValidator/ 
Version: 1.0.1
Maintainer: MailboxValidator <support@mailboxvalidator.com>
Repository: https://github.com/MailboxValidator/Flask_MailboxValidator
License: MIT
Documentation link: https://flask-mailboxvalidator.readthedocs.io/en/latest/

Thank You.

async_mode = None
app = Flask(__name__)
app.config['SECRET_KEY'] = 'secret!'
socketio = SocketIO(app, async_mode=async_mode)
thread = None

@app.route('/')
def index():
    emit('response', {'code': '200', 'msg': 'start to process...'})
    return render_template('index.html')

if __name__ == "__main__":
    socketio.run(app, host='0.0.0.0', debug=True, port=5001)

---

### Expected Behavior

WebSocket transport not available. Install eventlet or gevent and gevent-websocket for improved performance.
E:\Project\JDGoods\venv\lib\site-packages\flask_socketio\__init__.py:496: Warning: Silently ignoring app.run() because the application is run from the flask command line executable.  Consider putting app.run() behind an if __name__ == "__main__" guard to silence this warning.
  use_reloader=use_reloader, **kwargs)

### Environment

* Python version:  2.7
* Flask version: 1.0.2
* Werkzeug version:1.0
* Flask-SocketIO version 3.0.2

Hi, I am new to flask and i am using the following [flask cookiecutter](https://github.com/sloria/cookiecutter-flask) to start with a quick prototype. The main idea of project is to collect data from hive cluster and push it to the end user using flask. 

Although, i was successfully able to connect flask to the hive server using `pyhive` connector but I am getting a weird issue that's the related to the `select limit` where i am trying to query more than 50 items.

In my case i built just Hive class similar to the flask extension development around  for `pyhive` similar  demo:

```
from pyhive import hive
from flask import current_app

# Find the stack on which we want to store the database connection.
# Starting with Flask 0.9, the _app_ctx_stack is the correct one,
# before that we need to use the _request_ctx_stack.
try:
    from flask import _app_ctx_stack as stack
except ImportError:
    from flask import _request_ctx_stack as stack


class Hive(object):

    def __init__(self, app=None):
        self.app = app
        if app is not None:
            self.init_app(app)

    def init_app(self, app):
        # Use the newstyle teardown_appcontext if it's available,
        # otherwise fall back to the request context
        if hasattr(app, 'teardown_appcontext'):
            app.teardown_appcontext(self.teardown)
        else:
            app.teardown_request(self.teardown)

    def connect(self):
        return hive.connect(current_app.config['HIVE_DATABASE_URI'], database="orc")

    def teardown(self, exception):
        ctx = stack.top
        if hasattr(ctx, 'hive_db'):
            ctx.hive_db.close()
        return None

    @property
    def connection(self):
        ctx = stack.top
        if ctx is not None:
            if not hasattr(ctx, 'hive_db'):
                ctx.hive_db = self.connect()
            return ctx.hive_db
```

and created an endpoint to load data from hive:
```
@blueprint.route('/hive/<limit>')
def connect_to_hive(limit):
    cur = hive.connection.cursor()
    query = "select * from part_raw where year=2018 LIMIT {0}".format(limit)
    cur.execute(query)
    res = cur.fetchall()
    return jsonify(data=res)
```

At the first run everything works fine if i try to load things with limited to 50 items, but as soon as i increase it keeps in state where nothing load. However when i load data using jupyter notebooks it works fine that's why i suspect  that i might missed something from my flask code.
Starting Click v7.0 subcommands that are named by the function automatically have underscores replaced with dash (see the 4th item from the bottom for the changelog of Click v7.0 at http://click.palletsprojects.com/en/7.x/changelog/).

This caused the Custom Commands example in the documentation not working with Click v7.x, so I have added a warning for the Click v7.x users.
Hi! 

Why function send_file don't support Range header in request?
I send request with next header: Range: bytes=0-10.

 this is part of my code: 
 return send_file(file, attachment_filename=filename, conditional=True)

 But flask application return status code 200 instead 206. 

---

### Expected Behavior
status code = 206


### Actual Behavior
status code = 200

### Environment

* Python version: 3.5.3
* Flask version: 1.0.2
* Werkzeug version:

Updating posts was not working due to a positional argument not playing well with the @login_required function (using Python 3.6).

I changed the function to accept positional arugments, which fixes the problem.
**related:** flask-restful/flask-restful#782

Complete cource code can be found in [coaxis-asp/opt](https://github.com/Coaxis-ASP/opt/tree/master/daemon/api) repository.

### Requirements

`Python 3.6.6`

```
Flask==1.0.2
Flask-RESTful==0.3.6
```

### Project Layout

```
./api/
├── __init__.py
├── tests
│   ├── __init__.py
│   ├── test_views.py  
└── views.py  # declare API (cf. below)
```

### `views.py`

```
from flask import Flask, Response, request
from flask_restful import Api, Resource, abort

app = Flask(__name__)
api = Api(app, prefix='/api')

class Root(Resource):
    def get(self):
        return {
            'results': None
        }

api.add_resource(Root, '/')

if __name__ == "__main__":
    app.run(debug=True, host='0.0.0.0')
```

### `test_views.py`

```
from pprint import pprint
from unittest import TestCase

from views import app

class TestIntegrations(TestCase):
    def setUp(self):
        self.app = app.test_client()

    def test_thing(self):
        response = self.app.get('/sites/')
        pprint(response)
        self.assertDictEqual(response.json, {'results': None})
```

### Error

```
$ python3 -m unittest tests.test_views --verbose
test_thing (tests.test_views.TestIntegrations) ... 
<Response streamed [404 NOT FOUND]>
FAIL

======================================================================
FAIL: test_thing (tests.test_views.TestIntegrations)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/data/projects/coaxis-opt/daemon/api/tests/test_views.py", line 13, in test_thing
    self.assertDictEqual(response.json, {'results': None})
AssertionError: None is not an instance of <class 'dict'> : First argument is not a dictionary

----------------------------------------------------------------------
Ran 1 test in 0.007s

FAILED (failures=1)
```

### Question

Despite my API responding correctly in the browser and all my other tests running with `unittest`, the test case for the API fail with an error `404`. What the matter ?
This patch fixes a typo in the "handle_user_exception" method in app.py.

<!--
Link to any relevant issues or pull requests.

Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

In the ``flask.cli`` module, the ``load_dotenv`` function is not consistent in its return type. It should either return True or False depending on whether it has loaded the file or not, respectively.

fixes https://github.com/pallets/flask/issues/2937

Commit checklist:

- [x] add tests that fail without the patch

- [x] ensure all tests pass with ``pytest``

- [x] add documentation to the relevant docstrings or pages

- [x] add ``versionadded`` or ``versionchanged`` directives to relevant docstrings

- [x] add a changelog entry if this patch changes code

### Expected Behavior

I have templates layout.html, index.html and 200.html, index and 200 inherit layout.html
I try to submit a picture(base64 encoded) in index page, and if successful, redirect to 200.html

````

<!-- extend base layout -->
{% extends "layout.html" %}

{% block content %}
<body>

<div align="center" id="container">

    <h2>Demo</h2>

    <video playsinline autoplay></video>
    <button type="submit" class="btn btn-primary">snapshot</button>
    <canvas></canvas>
    <br>
    <label>name：</label><input type="text">
        <br><br>
	<button id="submit" type="submit" class="btn btn-primary">submit</button>


</div>
<div id="myDiv"></div>
<script type="text/javascript" src="{{ url_for('static', filename='js/lib/adapter.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/main.js') }}" async></script>

</body>
{% endblock %}
````

main.js
```javascript
const submit = document.getElementById("submit");

submit.onclick = function() {  // post submit
const xmlhttp =new XMLHttpRequest();
	xmlhttp.onreadystatechange=function()
	  {
	  if (xmlhttp.readyState==4 && xmlhttp.status==200)
		{
		document.getElementById("myDiv").innerHTML=xmlhttp.responseText;
		}
	  }
const name = document.querySelector('input').value;	  
xmlhttp.open("POST","/save_img/"+name,true);
xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
// dataURL = dataURL.replaceAll("\\+", "%2B");
dataURL = encodeURIComponent(dataURL)
    xmlhttp.send("img=" + dataURL);
}
```

```python

@app.route('/save_img/<string:name>', methods=['POST', 'GET'])
def save_image(name):
    # todo feature code
    img_base64 = request.form.get("img")
    base64_data = re.sub('^data:image/.+;base64,', '', img_base64).encode()
    feature_code = codec.func_call(base64_data, name)
    # todo save img and name to db
    data = Feature(feature_code, name)
    db.session.add(data)
    db.session.commit()
    flash('successful!!')
    return redirect(url_for('successful'))

@app.route('/successful')
def successful():
    return render_template('200.html')

```

### Actual Behavior

content of index.html still remains in the page, and content in 200.html also show on the page.

```pytb
no exception
```

### Environment

* Python version: 2.7.13
* Flask version:1.0.2 and 0.12
* Werkzeug version: 0.14.1

### Expected Behavior

If no file is loaded/exists, `flask.cli.load_dotenv` should return False.

### Actual Behavior

This code:

```python
from flask import Flask
from flask.cli import load_dotenv

app = Flask(__name__)
result = load_dotenv('not-exist')
assert result
```

does not fail.

### Environment

* Python version: 3.5.5
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

Updates `flask.copy_current_request_context` to add a copy of the current session object to the request context copy. This prevents `flask.session` pointing to an out-of-date object.

- [x] add tests that fail without the patch
- [x] ensure all tests pass with ``pytest``
- [x] add documentation to the relevant docstrings or pages
- [x] add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
- [x] add a changelog entry if this patch changes code

Please refer to #2935 for background on this
### Expected Behavior

When using `copy_current_request_context` in the middle of a request, I'm expecting it to copy the current state of `flask.request` and `flask.session` at the time it's called. 


### Actual Behavior

The current state of `flask.request` is copied, but `flask.session` is from before the current request and doesn't contain changes made during the current request, before `copy_current_request_context` was called. To me this seems like unexpected behaviour. If it's not I'd like to understand a bit more about why, and also to find out whether there's any workaround or alternative approach I can take. 

### Example

Here's a fully functional example you can save and run. It adds a test value to `flask.request` and `flask.session` during the request, then uses `copy_current_request_context` to decorate a method that will retrieve those same values in another thread. Two requests are made; on the first request the copied context can find the new value added to `flask.request` but cannot find the value added to `flask.session`. On the second request, the copied context can find the value added to `flask.request`, and now finds the value that was previously added to `flask.session` in the first request.


```python
import concurrent.futures
import random

from flask import Flask, copy_current_request_context, request, session


app = Flask(__name__)
app.config['SECRET_KEY'] = 'test'
executor = concurrent.futures.ThreadPoolExecutor()


@app.route('/')
def session_context():
    test_value = random.randint(1, 1001)
    request.test_value = test_value
    session['TEST_VALUE'] = test_value

    original_context = (
        ('request', request.test_value),
        ('session', session.get('TEST_VALUE'))
    )

    @copy_current_request_context
    def debug_session():
        return (
            ('request', request.test_value),
            ('session', session.get('TEST_VALUE'))
        )

    future = executor.submit(debug_session)
    print('original_context:', original_context)
    print('copied_context:', future.result())
    return 'ok'


if __name__ == '__main__':
    client = app.test_client()
    print('### First request ###')
    client.get('/')
    print('### Second request ###')
    client.get('/')
```

Example output:

```bash
$ python session_context.py
### First request ###
original_context: (('request', 27), ('session', 27))
copied_context: (('request', 27), ('session', None))
### Second request ###
original_context: (('request', 63), ('session', 63))
copied_context: (('request', 63), ('session', 27))
```

### Environment

* Python version: 3.7.0
* Flask version: Flask==1.0.2
* Werkzeug version: Werkzeug==0.14.1


Also, for whatever it's worth: I'm investigating this as part of improving this project: https://github.com/dchevell/flask-executor
1. If attachment filename is bytes type and contains non-ascii coded bytes,
then the following ASCII encoding process will raise a ``UnicodeDecodeError`` exception.

2. Since the following exception handling uses ``unicodedata`` for normalization, this also implies that the attachment filename is a ``unicode`` when encoding .
https://github.com/pallets/flask/blob/363205bdc3abcfeed08c7e85e397fb7a7dc9ef07/flask/helpers.py#L570-L577

3. Since ``UnicodeDecodeError`` exception was raised, we can see that an ASCII decoding process was also performed implicitly when encoding bytes string. So this solution won't introduce unnecessary overhead.

fixes #2933 
### Expected Behavior

Using flask.send_file should just work no matter what the attachment_filename string parameter contains including unicode characters.

```python
# -*- coding: utf-8 -*-
from flask import Flask, send_file
app = Flask(__name__)

@app.route("/")
def hello():
    fn = 'é.py'
    # alternate value
    # fn = '\xc3\xa9.py'
    return send_file('hello.py', as_attachment=True, attachment_filename=fn)
```

### Actual Behavior

Exception is thrown. UnicodeDecodeError is not handled with a proper fallback.

```pytb
Traceback (most recent call last):
  File "/home/remyroy/VirtualEnvs/TestingFlask/local/lib/python2.7/site-packages/flask/app.py", line 2292, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/remyroy/VirtualEnvs/TestingFlask/local/lib/python2.7/site-packages/flask/app.py", line 1815, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/remyroy/VirtualEnvs/TestingFlask/local/lib/python2.7/site-packages/flask/app.py", line 1718, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/home/remyroy/VirtualEnvs/TestingFlask/local/lib/python2.7/site-packages/flask/app.py", line 1813, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/remyroy/VirtualEnvs/TestingFlask/local/lib/python2.7/site-packages/flask/app.py", line 1799, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/home/remyroy/Projects/TestingFlask/hello.py", line 10, in hello
    return send_file('hello.py', as_attachment=True, attachment_filename=fn)
  File "/home/remyroy/VirtualEnvs/TestingFlask/local/lib/python2.7/site-packages/flask/helpers.py", line 567, in send_file
    attachment_filename = attachment_filename.encode('latin-1')
UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 0: ordinal not in range(128)
```

### Environment

* Python version: 2.7.12
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

i was trying to run it , packaging it  but it fails to import module

![screenshot 123](https://user-images.githubusercontent.com/11151000/46415729-7774e880-c758-11e8-8086-b7a500c3718f.png)

![screenshot 124](https://user-images.githubusercontent.com/11151000/46415788-9e331f00-c758-11e8-989a-7183352ac998.png)
![screenshot 125](https://user-images.githubusercontent.com/11151000/46415789-9ecbb580-c758-11e8-8d51-7d7cb5d8e9c0.png)
![screenshot 126](https://user-images.githubusercontent.com/11151000/46415790-9ecbb580-c758-11e8-8fbd-9e4c2a684de9.png)

I can not run Flask commands with Click 7.0 which is released the last week. When I replace it with the version 6.7, it works fine.

### Environment
* OS: Windows 10
* Python version: 3.6.4
* Flask version: 1.0.2
* Werkzeug version: 0.14

```
astroid==2.0.4
beautifulsoup4==4.6.0
click==6.7
cloudpickle==0.5.6
colorama==0.3.9
coverage==4.5.1
doit==0.31.1
Flask==1.0.2
gunicorn==19.9.0
isort==4.3.4
itsdangerous==0.24
Jinja2==2.10
lazy-object-proxy==1.3.1
MarkupSafe==1.0
mccabe==0.6.1
nose==1.3.7
nosexcover==1.0.11
pycryptodome==3.4.7
pylint==2.1.0
pymongo==3.7.1
PyYAML==3.12
six==1.11.0
typed-ast==1.1.0
urllib3==1.22
Werkzeug==0.14.1
wrapt==1.10.11
 

(env) flask clean_db
[2018-10-03 16:34:13,364 INFO] Running ...

```

If I install Click==7.0, my error is:
```

(env) flask clean_db
Usage: flask [OPTIONS] COMMAND [ARGS]...
Try "flask --help" for help.
 
Error: No such command "clean_db".
```
Improve error reporting of the application factory built during the tutorial by not swallowing all `OSError` exceptions that could happen when trying to create the instance folder.

This PR is inspired by the following SO entry: https://stackoverflow.com/a/273227

AFAIK this is portable code (see https://stackoverflow.com/a/273872 for a discussion on errno's portability), and I tested it under Linux and Windows.
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Fix #2926 

In `app.py`, compare possible port values with `None` explicitly, instead of relying on bool casting. Thanks to this, `0` is treated as legitimate port value, and not overwritten by the default value.

I just upgraded to Flask 1.0.2 and my code (which was working):

```
from http.client import MOVED_PERMANENTLY

@app.errorhandler(MOVED_PERMANENTLY)
def error_handler(err):
    print(err)
```

now fails with:
```
 mod_wsgi (pid=66451): Target WSGI script 'app.py' cannot be loaded as Python module.
 mod_wsgi (pid=66451): Exception occurred processing WSGI script 'app.py'.
 Traceback (most recent call last):
   File "app.py", line 128, in <module>
     @app.errorhandler(MOVED_PERMANENTLY)
   File "python2.7/site-packages/flask/app.py", line 1316, in decorator
     self._register_error_handler(None, code_or_exception, f)
   File "python2.7/site-packages/flask/app.py", line 66, in wrapper_func
     return f(self, *args, **kwargs)
File "python2.7/site-packages/flask/app.py", line 1349, in _register_error_handler
" HTTPException with that code instead.".format(code_or_exception)
KeyError: "'301' is not a recognized HTTP error code. Use a subclass of HTTPException with that code instead."
```

Am I doing something wrong?
### Expected Behavior

When running a flask application with `app.run(port=0)`, flask should pass the '0' port down to werkzeug to use a port assigned by the operating system.

### Actual Behavior

The logic in flask/app.py:932 sets the port to the default 5000, which can cause port conflicts, which is the exact situation that setting `port=0` should avoid. This is a regression from the behaviour exhibited in prior versions.

```pytb
>>> app.run(port=0)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/.../lib/python3.6/site-packages/flask/app.py", line 943, in run
    run_simple(host, port, self, **options)
  File "/.../lib/python3.6/site-packages/werkzeug/serving.py", line 814, in run_simple
    inner()
  File "/.../lib/python3.6/site-packages/werkzeug/serving.py", line 774, in inner
    fd=fd)
  File "/.../lib/python3.6/site-packages/werkzeug/serving.py", line 660, in make_server
    passthrough_errors, ssl_context, fd=fd)
  File ".../lib/python3.6/site-packages/werkzeug/serving.py", line 577, in __init__
    self.address_family), handler)
  File "/.../lib/python3.6/socketserver.py", line 453, in __init__
    self.server_bind()
  File "/.../lib/python3.6/http/server.py", line 136, in server_bind
    socketserver.TCPServer.server_bind(self)
  File "/.../lib/python3.6/socketserver.py", line 467, in server_bind
    self.socket.bind(self.server_address)
OSError: [Errno 98] Address already in use
```

### Environment

* Python version: 3.6
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

### Expected Behavior

I have a piece of hardware that only supplies a 32 bit .dll, but it needs to be integrated into a piece of software that must be 64 bit for other reasons.  So I used the opportunity to setup a 32-bit python server in Flask to communicate with device and be controlled by a client in my existing 64-bit program.

The 32 bit server should simply just exist as a pass through for my 64 bit client to the hardware.  

### Actual Behavior

This all works well and fine for some number of function calls, however I get very repeatable timeouts after a specific number of function calls to the server.  I have been able to reproduce this using a very simple simulation without any hardware that I can share below.  

In my program, the 64 bit version of python spins up a 32-bit python exe and specifies the server .py file.  So to run this, you'll need to specify a location to your 32-bit version of python.  Simply specify the location of the 32 bit python .exe in client.py and then run client.py in a 64 bit version of python.

In any event, I'm finding that after 54 calls to the server from the client, the server just doesn't respond anymore.  I initially remedied this by killing all 32 bit python processes and restarting the server, but this is really unstable to do over a long time, and this program needs to run for weeks without crashing.  This seems like some sort of bug, but I've been unable to troubleshoot further since this is a bit out of my experience area.

### Code Examples

Put the code below into a file called "server.py"
```python
# Simple server.py example to demonstrate timeout

from flask import Flask
import json

app = Flask(__name__)

@app.route('/')
def start():
    # Do nothing on root other than verify that server connects successfully
    response={}
    response["Connection"]=0
    return json.dumps(response)

@app.route('/dosomething')
def hardwaredoessomething():
    # in the full use case the client would tell the server to tell the
    # hardware to do something, and then the function would return
    # when that is done.  This is simulated here.
    response={}
    response["Status"]=0
    response["Complete"]=0
    return json.dumps(response)
          
app.run()
```

Put the code below into a file called client.py, in the same folder as server.py
```python
# Simple client.py example

import os
import urllib.request
import subprocess
import json
import time

# insert path to your 32 bit version of python here
python32bitpath = r'C:\Python\32 bit Python 3\python-3.4.4\python.exe'
serverpath = os.getcwd() + r'\server.py'

# Start the 32 bit python server
p1 = subprocess.Popen([python32bitpath,serverpath],\
                           stdout=subprocess.PIPE,
                           stderr=subprocess.PIPE)



# Specify the location of the server
root = 'http://localhost:5000/'

# give a couple seconds for the server to initialize
time.sleep(3)

# Verify you can connect to the server
ret = urllib.request.urlopen(root)
response = ret.read().decode()
print(response)

numCalls = 0

for i in range(100):
    ret = urllib.request.urlopen(root+'dosomething')
    response = ret.read().decode()
    print('response',response)
    print("number of calls",numCalls)
    numCalls+=1
    time.sleep(0.5)
```

### Environment
* Python version: I've seen this on python 3.4 and python 3.6
* Flask version: 0.11.1

### Follow up
Also just as a follow up, I also tested this code by having a 64 bit client and a 64 bit server as well.  Still stops at 54 calls.  I definitely would appreciate the help as this would enable my program to be much more robust.  I just wish hardware vendors would get modern and supply 64 bit .dlls.
### Actual Behavior

Link to the section "For a more optimized setup, see configuring uWSGI and NGINX."  on [this page](http://flask.pocoo.org/docs/1.0/deploying/wsgi-standalone/#uwsgi) answers 404.



### Expected Behavior

When you open documentations with `pydoc3 <modulename>` most modules just display documentation, and that's it. 

### Actual Behavior

When called from same directory as the user's script, `pydoc3 flask` will also start executing the script 
itself an display timestamps, which also eventually overwrite the documentation display.

At first you see delay:

```$ pydoc3 flask
1537766131.0147438
```

Then  overtime timestamps fill the screen. An example:
```
DESCRIPTION
    flask
    ~~~~~
    
    A microframework based on Werkzeug.  It's extensively documented
:1537766141.022547
1537766146.0282607
1537766151.0338132
1537766156.0372663
```

Using  the following does not help:
```
 if __name__ == '__main__':
       app.run()
```
### Environment

* Python version: 3.6.5
* Flask version:  1.0.2-1 as reported by `apt-cache policy python3-flask`
* Werkzeug version:  unsure how to check that

The `Request` wrapper class contains properties that only return on valid logic checks. If the logic fails, a reference to the property object is returned instead of a value that is valid within the context of the property:

```python
# pytest source (abridged)
        unpatched_size = app.request_class.max_content_length
...
        assert unpatched_size == DEFAULT_UPLOAD_SIZE

# pytest output
...
>       assert unpatched_size == DEFAULT_UPLOAD_SIZE
E       assert <property object at 0x7fbb9ee964a8> == 67108864
```

This aims to tidy this up by always returning None or something relevant to the property, like an empty string.

This also avoids misleading assertion failures like "the `max_content_length` property is not X" rather than "None is not X".

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

If we just want to access configuration, it's important to not use push
and pop methods of the actual app context object since that would mean
the cleanup handlers will be called. And app context object implements 
"context management protocol" to facilitate the use of these two methods.


Fix issue #2900.
Fix some typos in config.rst

1. Grammar error: 'return' should be 'returns'; 'would is' should be 'would be'.
2. Reloader is used to reload and fork process if modules were changed rather than when an exception occurred.
3. The sample code is not concise enough.
http://flask.pocoo.org/docs/1.0/quickstart/#url-building

In the URL Building section of the quickstart, the script output is shown right after the code.

This breaks syntax highlighting for the whole code-block. To fix this, I have made the output into comments.
Otherwise the example fails with the following error: 
"name = name or cmd.name AttributeError: 'function' object has no attribute 'name'". 

More details: https://stackoverflow.com/a/51923415/4619705
When propagate exceptions, the function call of "_find_error_handler" makes no sense.
https://github.com/pallets/flask/blob/0b7a74dda3284b03fac49851eaf130e876f183bd/flask/app.py#L1733-L1748

Without CONTRIBUTING.rst filoe, documentation is not buildable:
docs/contributing.rst:1: WARNING: Problems with "include" directive path:
InputError: [Errno 2] No such file or directory: 'CONTRIBUTING.rst'.


In the tutorial of flaskr, an error is raised when running the auth.py. In the development server, the following error is raised:

```python
File "~\flaskr\auth.py", line 90, in login
elif not check_password_hash(user['password'], password):
TypeError: tuple indices must be integers or slices, not str
```

And then I trace back, in line 84, the following code:
```python
user = db.execute(
        'SELECT * FROM user WHERE username = ?', (username,)
).fetchone().
```

The function fetchone() should return a tuple. But in line 90, the function try to access the tuple by user['password']. Can tuple be accessed by this calling? I'm not pretty sure. But I can access the tuple by calling user[2] instead of user['password']. And actually the same situation in other python scripts. I'm not sure what is the case. 
### Environment

* Python version: 3.7.0
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

While build docs, some errors occurred.
```
Running Sphinx v1.7.8
loading pickled environment... not yet created

Theme error:
no theme named 'flask' found (missing theme.conf?)
```
For details, see https://github.com/pallets/pallets-sphinx-themes/issues/15

## Reason

If we use a theme of a sphinx extension which doesn't add themes into ``sphinx.html_themes`` entry points, at the same time we don't declare it as our extensions, ``sphinx`` will not find the theme.

## Solutions

There are two solutions:

1. The sphinx extension adds its themes into ``sphinx.html_themes`` entry points.

2. In the ``docs``' ``conf.py``, we declare the sphinx extension as our extensions.

I think solution **2** will be more applicable.
This simple flask app has one resource routed:

```
from flask import Flask
app = Flask(__name__)
 
@app.route("/test.html")
def index():
    return "Hello World!"
 
if __name__ == "__main__":
    app.run(host='0.0.0.0', port=4000)
```

While the following returns 200 
```
http://127.0.0.1/test.html
```

And the following (correctly) returns 404:
```
http://127.0.0.1/asd/test.html
```

The following returns 200 and output `Hello World!` while it shouldn't:
```
http://127.0.0.1//asd/test.html
```

### Environment

* Python version: 2.7.15
* Flask version: 0.12.2 (but tested also 1.0.2)
* Werkzeug version: 0.12.2 (but tested also 0.14.1)

### Expected Behavior

I follow the tutorial on http://flask.pocoo.org/docs/1.0/tutorial/ and try to run tests

```(venv) ...\flaskproj>pytest```


### Actual Behavior

```Traceback (most recent call last):
  File "...\flaskproj\venv\lib\site-packages\_pytest\config\__init__.py", line 381, in _getconftestmodules
    return self._path2confmods[path]
KeyError: local('...\\flaskproj\\tests')

During handling of the above exception, another exception occurred:
Traceback (most recent call last):
  File "...\flaskproj\venv\lib\site-packages\_pytest\config\__init__.py", line 412, in _importconftest
    return self._conftestpath2mod[conftestpath]
KeyError: local('...\\flaskproj\\tests\\conftest.py')

During handling of the above exception, another exception occurred:
Traceback (most recent call last):
  File "...\flaskproj\venv\lib\site-packages\_pytest\config\__init__.py", line 418, in _importconftest
    mod = conftestpath.pyimport()
  File "...\flaskproj\venv\lib\site-packages\py\_path\local.py", line 668, in pyimport
    __import__(modname)
  File "...\flaskproj\venv\lib\site-packages\_pytest\assertion\rewrite.py", line 296, in load_module
    six.exec_(co, mod.__dict__)
  File "...\flaskproj\tests\conftest.py", line 5, in <module>
    from flaskr import create_app
ModuleNotFoundError: No module named 'flaskr'
ERROR: could not load ...\flaskproj\tests\conftest.py
```

### Environment

* Python version: 3.6.5
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

I was just starting a little project with Flask + Mongo + Python3. 

Since the only reference to Mongo in the official docs is the "MongoKit in Flask" page, I went straight to install and create my schema using MongoKit. Just to find out that this lib is not updated since 2015 and has no support for recent versions of PyMongo.

Shouldn't we remove that from the docs?

[Flask `test_client` could not find endpoints registred from namesapces](https://github.com/noirbizarre/flask-restplus/issues/402)
I get this problem too.
What resolve this? Or it's bug?
Both  in http://flask.pocoo.org/docs/1.0/testing/ and http://flask.pocoo.org/docs/1.0/blueprints/
there's not much said about Blueprint and unittesting.

Let's say that the project is organized such as:

```
myapp/
  __init__.py
  other_stuff.py
  myblueprint/
    __init__.py
    utils.py
tests/
  __init__.py
  some_unit_tests.py
```

In `myapp/__init__.py`, we register the blueprint

```python
from myblueprint import myblueprint
app.register_blueprint(myblueprint)
```

In `utils.py`, we import `do_amazing` from `other_stuff.py`.

Then for mocking `do_amazing`, we usually import it in the context of `utils.py`. This is done by something like:

```python
with patch('myapp.myblueprint.utils.do_amazing') as mock_amazing:
    # More stuff and test.
```

When there is no blueprint, this is working well. 
As soon as myblueprint is a Blueprint object we end up having an error as soon as we hit the `patch` context.

AttributeError: 'Blueprint' object has no attribute 'utils'

If we print in the test before the patch.
```python
        print 'myapp', myapp
        print 'myapp.myblueprint', myapp.myblueprint
        print 'myapp.myblueprint.utils', myapp.myblueprint.utils
```

We get:


```
myapp <module 'myapp' from '/Users/well/code/project/myapp/__init__.pyc'>
myapp.myblueprint <flask.blueprints.Blueprint object at 0x108847450>
ERROR
```

I still wonder if
*  it is the ambiguity of using the same name for folder and blueprint keywords
* it is a limitation of the Mock library when patching.
* it is a limitation of Blueprints themselves.

But it would be probably good to have something in the documentation under [Blueprints](http://flask.pocoo.org/docs/1.0/blueprints/) or [Testing](http://flask.pocoo.org/docs/1.0/testing/) addressing either the limitations or a minimal example of a test scenario for Blueprint cases.

Add the following badges for easier access: travis, appveyor, coverage,
supported pypi versions, pypi version. All badges include links to the
proper urls. Badges also add better visibility into our code coverage
as well as give better visibility into the build status.

If the contributors, we can also simplify the docs by removing some
of the links at the bottom that are now included in the badges.

---

### Expected Behavior

Tell us what should happen.

### Code
```python
def check(s,c):
    print(22222222222222)
    app = current_app._get_current_object()
    logger = current_app.logger
    ...

class fix_service(Resource):
    def post(self, service_id):
            ...
            logger.info('fix: {name} done，start check'.format(name=service.name))
            # check
            with multiprocessing.Pool() as pool:
                print(111111111)
                check_results = pool.starmap(check, containers)

            logger.info('fix: check done')
            ...
```

### Actual Behavior

Tell us what happens instead.


```pytb
#### console just can see 111111111 and 6730  was deadlock . Not often, but occasionally#### 
# ps -elf
0 S root       6517   5322  0  80   0 - 50490 poll_s 10:54 ?        00:00:00 /usr/local/bin/python3.5 /usr/local/bin/gunicorn --threads 8 app:create_app("test") -b 0.0.0.0:18113 --access-lo
1 S root       6520   6517  1  80   0 - 290893 ep_pol 10:54 ?       00:00:10 /usr/local/bin/python3.5 /usr/local/bin/gunicorn --threads 8 app:create_app("test") -b 0.0.0.0:18113 --access-lo
1 S root       6730   6520  0  80   0 - 290690 futex_ 11:01 ?       00:00:00 /usr/local/bin/python3.5 /usr/local/bin/gunicorn --threads 8 app:create_app("test") -b 0.0.0.0:18113 --access-lo

(gdb) bt
#0  0x00007f99c0e31a00 in sem_wait () from /lib64/libpthread.so.0
#1  0x00007f99b5950ff1 in semlock_acquire (self=0x7f99ace44688, args=<value optimized out>, kwds=<value optimized out>) at /opt/soft/Python-3.5.2/Modules/_multiprocessing/semaphore.c:307
#2  0x00007f99c10fd961 in PyCFunction_Call (func=0x7f99ad2000d8, args=0x7f99c16ff048, kwds=<value optimized out>) at Objects/methodobject.c:98
#3  0x00007f99c1184f25 in call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4705
#4  PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:3236
#5  0x00007f99c1185e99 in _PyEval_EvalCodeWithName (_co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=1, 
```

### Environment

* Python version:3.5.2
* Flask version:0.11.1
* Werkzeug version:

**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](http://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

Tell us what should happen.

Providing a custom JSON encoder doesn't break if simplejson happens to be included in the pip dependencies

```python

    pip install simplejson #OR install any library that has simplejson as a dependency

    ----

    import json
    
    class JsonSerializer:
      def __init__(self, encodings=None, **kwargs):

        if encodings:
            self._encodings = encodings
        else:
            self._encodings = self._get_default_type_encodings()
        # dict of kwargs
        if kwargs is None:
            self._kwargs = {}
        else:
            self._kwargs = kwargs

      def encode(self, o):
        return self.dumps(o)

      def dumps(self, obj, kwargs_dict=None):
        kwargs = self._kwargs.copy()

        # Override init kwargs
        if kwargs_dict is not None:
            kwargs.update(kwargs_dict)

        return json.dumps(obj, **kwargs_dict)

    ----

    application.json_encoder = JsonSerializer

    jsonify({"some": "object})
```

### Actual Behavior

Tell us what happens instead.

Results in 
```pytb
    ....
    File "/opt/pyenv/versions/***/lib/python3.5/site-packages/flask/json.py", line 263, in jsonify
      (dumps(data, indent=indent, separators=separators), '\n'),
    File "/opt/pyenv/versions/***/lib/python3.5/site-packages/flask/json.py", line 123, in dumps
      rv = _json.dumps(obj, **kwargs)
    File "/opt/pyenv/versions/***/lib/python3.5/site-packages/simplejson/__init__.py", line 399, in dumps
      **kw).encode(obj)
    ...
    File "/opt/pyenv/versions/3.5.4/lib/python3.5/json/__init__.py", line 237, in dumps
    **kw).encode(obj)
    TypeError: __init__() got an unexpected keyword argument 'for_json'
```

Noticed this conversation https://github.com/pallets/flask/issues/1602. It's unfortunate that it was closed with no action being taken, implicitly switching between incompatible json implementations based on presence of a library seems like an egregiously bad design decision.

### Environment

* Python version: 3.5
* Flask version: 0.12.1
* Werkzeug version: 0.12.1

At this moment, when a Flask test client method uses the **json** argument, a new application context is created in the line below.

https://github.com/pallets/flask/blob/b9b88b0cdf70190dee5c7d31a83efb1cae888a63/flask/testing.py#L82

The problem is that when the above created context goes out of scope, anything registered to `teardown_appcontext` is called. This is the case of Flask-SQLAlchemy, which remove the current session when that happens.

This is problematic is some tests scenarios.

I am using PostgreSQL SAVEPOINT to rollback any changes made by a test case. My approach is similar to this example provided by [SQLAlchemy here](http://docs.sqlalchemy.org/en/latest/orm/session_transaction.html#joining-a-session-into-an-external-transaction-such-as-for-test-suites), so I'm not going to put all my code here, just a shallow example.

I have a class that creates a nested transaction and rollback everything when needed.

```python
client = app.test_client()
trn = TransactionManager(database)

with app.app_context():
    trn.start() # start a new nested transaction

    client.post('/products', data=json.dumps({'name': 'Cake'}))
    client.get('/products')
    
    trn.end() # Rollback before the session is removed.
```

The above works well because everything happens inside the same transaction and each test client interaction can see changes made to the database by previous client calls.

But using the **`json`** argument, the POST call will first create an application context, which immediately will go out of scope making Flask-SQLAlchemy's `teardown_appcontext` registered function **remove the current session before the next client call**, making each database interaction in a different transaction.

Why do we need an application context to dump the JSON string?
https://github.com/pallets/flask/blob/b9b88b0cdf70190dee5c7d31a83efb1cae888a63/flask/testing.py#L83


I don't understand, but if the the above logic is necessary I think the code should check first if there is an application context pushed already using **`has_app_context`**.

Am I doing something wrong or I am missing something?






i'm trying factory app in flask 
![deepinscreenshot_20180901001145](https://user-images.githubusercontent.com/18476845/44941991-711cd680-ad7e-11e8-884a-8e860a8aa90a.png)
![deepinscreenshot_20180901001231](https://user-images.githubusercontent.com/18476845/44941992-711cd680-ad7e-11e8-9852-65e272535044.png)
![deepinscreenshot_20180901001259](https://user-images.githubusercontent.com/18476845/44941993-71b56d00-ad7e-11e8-8509-450e968d335f.png)
![deepinscreenshot_20180901001505](https://user-images.githubusercontent.com/18476845/44941994-71b56d00-ad7e-11e8-9ed5-43903b6964d5.png)
![deepinscreenshot_20180901002053](https://user-images.githubusercontent.com/18476845/44941995-71b56d00-ad7e-11e8-8f2b-f634c7dcabdd.png)
![deepinscreenshot_20180901003345](https://user-images.githubusercontent.com/18476845/44942008-b9d48f80-ad7e-11e8-88b9-b5f15d7dd46f.png)

BUT my factory dont work!!
Someone help-me solved this question!!
Thnaks for advanced!






Fix #2897 

To define a list of files the reloader should watch additionally to the modules
as in ``extra_files`` argument used in the ``app.run`` and ``werkzeug.serving.run_simple``
you can either use the ``--extra-files`` (or multiple ``-f``) option or define the
``FLASK_RUN_EXTRA_FILES`` environment variable.

```bash
    # on windows use ``;`` instead of ``:`` to separate paths
    export FLASK_RUN_EXTRA_FILES=/path/to/file1:/path/to/file2
    flask run
     * Running on http://127.0.0.1:8000/
     * Detected change in '/path/to/file1', reloading
```

On command line the same can be achieved with ``flask run -f /path/to/file1 -f /path/to/file2``.

### Expected Behavior

I expected to have `FLASK_RUN_EXTRA_FILES` to be processed in the same way of `FLASK_RUN_PORT` and `FLASK_RUN_HOST`

When using the old style `app.run` we can define an `extra_files` to be watched for changes by the reloader, that is useful for example, if you have a static settings file like `settings.toml` (using [dynaconf](https://dynaconf.readthedocs.io/en/latest/guides/flask.html)) or another kind of static config or themed templates loaded from other paths

### Actual Behavior

In the `run` command https://github.com/pallets/flask/blob/master/flask/cli.py#L775 the argument `extra_files` is not being passed to `wekzeug.run_simple` https://github.com/pallets/werkzeug/blob/master/werkzeug/serving.py#L738

### Suggestion

Add `FLASK_RUN_EXTRA_FILES="path1,path2,path"` to flask run command.

or

Map all variables from `werkzeug.run_simple` - https://github.com/pallets/werkzeug/blob/master/werkzeug/serving.py#L738

In to `FLASK_RUN_*` prefixed env var or `WERKZEUG_RUN_*` prefixed env var.



### Environment

* Python version: 3.6
* Flask version: 1.0.2
* Werkzeug version:  0.14.1

### Expected Behavior

Starting the server should show all the information lines:

```
* Serving Flask app "testfla" (lazy loading)
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: on
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 222-285-885
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
```

```python
from flask import Flask
app = Flask(__name__)

@app.route('/')
def index():
   return 'This is the homepage'

if __name__ == '__main__':
   app.run(debug=True
```

### Actual Behavior

Only the following line is displayed when starting the server:

```
* Restarting with stat
```

### Environment

* Python version: 3.6
* Flask version: 1.0.2
* Werkzeug version:

Anaconda 5.2, Spyder 3.1

After some use-cases of flask microservices I find `url_for` helper to be quite problematic to use. 

If I use an app via two subdomains then by default `url_for` will use the request host name to generate the full url. As I want to use only one subdomain (`app.sitename.com/view/` and not `api.sitename.com/view/`; and without subdomain routing setup) for the urls I have to handle this - `_external=False` and do it on my own.

If I use a custom flask command to execute some code that reverses an url then it needs the app context and `SERVER_NAME` even when it's explicitely `_external=False` (as url_adapter won't be present without `SERVER_NAME` set).  `SERVER_NAME`  has other usages and causes side effects (and breaks health checks on kubernetes deployment if set globally).

So there is a lot of magic going on in reversing view name to an url. There should be path-only equivalent for `url_for` to avoid all those requirements if absolute urls aren't needed.
### Expected Behavior

When a chained exception is thrown, the full exception chain should be logged.

```python
from flask import Flask

app = Flask(__name__)


def do_something():
  raise ValueError("Foo")


@app.route('/exception_test', methods=['GET', 'POST'])
def process():
  try:
    do_something()
  except Exception as e:
    raise ValueError("Wrapper") from e

if __name__ == '__main__':
  app.debug = True
  app.config['PROPAGATE_EXCEPTIONS'] = True
  app.run(debug=True)
```

Then `wget  http://127.0.0.1:5000/exception_test`

### Actual Behavior

Instead only the exception at the "end of the chain" is logged:

```pytb
127.0.0.1 - - [29/Aug/2018 17:18:56] "GET /exception_test HTTP/1.1" 500 -
Traceback (most recent call last):
  File "/Users/gabbard/anaconda3/envs/gaia-alternatives/lib/python3.6/site-packages/flask/app.py", line 2309, in __call__
    return self.wsgi_app(environ, start_response)
  File "/Users/gabbard/anaconda3/envs/gaia-alternatives/lib/python3.6/site-packages/flask/app.py", line 2295, in wsgi_app
    response = self.handle_exception(e)
  File "/Users/gabbard/anaconda3/envs/gaia-alternatives/lib/python3.6/site-packages/flask/app.py", line 1741, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/Users/gabbard/anaconda3/envs/gaia-alternatives/lib/python3.6/site-packages/flask/_compat.py", line 35, in reraise
    raise value
  File "/Users/gabbard/anaconda3/envs/gaia-alternatives/lib/python3.6/site-packages/flask/app.py", line 2292, in wsgi_app
    response = self.full_dispatch_request()
  File "/Users/gabbard/anaconda3/envs/gaia-alternatives/lib/python3.6/site-packages/flask/app.py", line 1815, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/Users/gabbard/anaconda3/envs/gaia-alternatives/lib/python3.6/site-packages/flask/app.py", line 1718, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/Users/gabbard/anaconda3/envs/gaia-alternatives/lib/python3.6/site-packages/flask/_compat.py", line 35, in reraise
    raise value
  File "/Users/gabbard/anaconda3/envs/gaia-alternatives/lib/python3.6/site-packages/flask/app.py", line 1813, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/gabbard/anaconda3/envs/gaia-alternatives/lib/python3.6/site-packages/flask/app.py", line 1799, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/Users/gabbard/projects/gaia/gaia-alternatives/repos/vista-nlp-jvm/vista_nlp_serialization/chained_exception_mcve.py", line 22, in process
    raise ValueError("Wrapper") from e
ValueError: Wrapper
```

The same problem appears in the HTML stack traces.

This problem was also mentioned by @mscheper  in [this comment](https://github.com/pallets/flask/issues/2023#issuecomment-301493159)

### Environment

* Python version: 3.6
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

**TLDR;**
Use `PIPENV_DONT_LOAD_ENV=1 pipenv shell`

### Expected Behavior

Flask sets/overrides environment variables specified in .env each time `flask run` is run.

### Actual Behavior

Flask is unaware that the .env file in my project directory has changed and does not refresh it's own environment variables.

### Environment

* Pipenv
* Python version: 3.6.5
* Flask version: 1.0.2
* Werkzeug version: 0.14.1
Describe what this patch does to fix the issue.

I fixed the documentation for request context.

Link to any relevant issues or pull requests.

requesting **without** {'Content-Type': 'application/json'} 
request.get_json(force=True) returns nothing (not as expected)
request.get_json(force=False) returns None (not as expected)

requesting **with** {'Content-Type': 'application/json'} 
request.get_json(force=True) returns the JSON parsed to dict
request.get_json(force=False) returns the JSON parsed to dict

Expected behavior: 
Shouldn't request.get_json(force=True) like mentioned in the docs "Ignore the mimetype and always try to parse JSON."?

thx, and keep up the great work


Apparently there's been some changes in the way the docs are generated on RTD.

I see there's a rtd branch with a commit (https://github.com/pallets/flask/commit/86acd842cebe0174870d399228bb25c1693ae8f3) dedicated to RTD adding `docs/requirements.txt`.

The build on this branch passes but there's that warning on top of the page: 

> Warning: This is an old version. The latest stable version is Version 1.0.2..

The other builds (1.0.2 and master) fail: https://readthedocs.org/projects/flask/builds/.

I suppose the config was change in RTD to look for that `requirements.txt` file that only appears in rtd branch.

As a user, I don't mind the warning, but I'm building a documentation for a lib using Flask with this intersphinx mapping:

```py
intersphinx_mapping = {
    'flask': ('http://flask.readthedocs.io/en/latest/', None),
}
```

 I get an error due to the failed build as `http://flask.readthedocs.io/en/latest/objects.inv` is not fetchable.

Should I use `https://flask.readthedocs.io/en/rtd/objects.inv` or is this temporary?

Thanks.
Currently [docs](http://flask.pocoo.org/docs/1.0/patterns/celery/) are recommending to call `run()` method after creating a Flask context. It seems that calling `super().__call__()` instead would be a better approach, because calling run() directly skips Celery's internal threading stack management:

https://github.com/celery/celery/blob/master/celery/app/task.py#L382
```python
    def __call__(self, *args, **kwargs):
        _task_stack.push(self)
        self.push_request(args=args, kwargs=kwargs)
        try:
            return self.run(*args, **kwargs)
        finally:
            self.pop_request()
            _task_stack.pop()
```

I've applied this change in our project and can confirm that it still works without any issues.
### Expected Behavior

Flask gets POST Data from form in every browser via request.form

```python
@app.route('/backend', methods=['GET', 'POST'])
def backend():
    print(request.form)
```

### Actual Behavior
In Chrome it gets the information of the form correctly, in firefox not.
(I have not tested more browser)

The echoed request.form in firefox
```pytb
ImmutableMultiDict([])
```

### Environment

* Python version: Python 3.6.5
* Flask version: 1.0.2 
* Werkzeug version: 0.14.1  
I need to map multiple domains to a single app but each unique domain also has an "admin" subdomain.

Examples:

admin.example1.com
admin.example2.com

where the subdomain and domains are essentially the same blueprints with just different things pulled from the db.

So far I've only seen that you need to hardcode the SERVER_NAME in the config. Is there another way to do this?
**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](http://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

Tell us what should happen.

```python
`from flask import Flask


app = Flask(__name__)


@app.route('/')
def index():
    return 'hello world'


if __name__ == '__main__':
    app.run()`
```

### Actual Behavior

Tell us what happens instead.

```pytb
`C:\Users\Administrator\venv\Scripts\python.exe E:/flaskproject/ihome/hello.py
Traceback (most recent call last):
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python36-32\Lib\asyncio\__init__.py", line 16, in <module>
    from . import _overlapped
ImportError: cannot import name '_overlapped'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "E:/flaskproject/ihome/hello.py", line 1, in <module>
    from flask import Flask
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python36-32\lib\site-packages\flask\__init__.py", line 19, in <module>
    from jinja2 import Markup, escape
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python36-32\lib\site-packages\jinja2\__init__.py", line 82, in <module>
    _patch_async()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python36-32\lib\site-packages\jinja2\__init__.py", line 78, in _patch_async
    from jinja2.asyncsupport import patch_all
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python36-32\lib\site-packages\jinja2\asyncsupport.py", line 13, in <module>
    import asyncio
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python36-32\Lib\asyncio\__init__.py", line 18, in <module>
    import _overlapped  # Will also be exported.
ImportError: DLL load failed: 找不到指定的程序。`

```

### Environment

* Python version:3.6.4
* Flask version:1.0.2
* Werkzeug version:0.14.1

### Expected Behavior

`flask.url_for(endpoint, **values)` prototype should be intuitively understood by general public. That could be done if Flask doesn't redefine common understanding of `endpoint` its own abstraction.

The common understanding is that `endpoint` is an URL.

* https://stackoverflow.com/questions/9807382/what-is-a-web-service-endpoint
* https://en.wikipedia.org/wiki/Web_API#Endpoints

If Flask uses `routename` instead of `endpoint`, then documentation could make sense for people not aware with Flask specifics. I mean this is not normal - https://stackoverflow.com/questions/19261833/what-is-an-endpoint-in-flask - 77 votes, 52 favorites (means people need to get back to it), 176 upvotes (about 99 people who maybe thought they know what `endpoint` is, but maybe was confused about real meaning or function).

Alternative text.
```
 flask.url_for(routename, **values)

    Generates a URL for the given `routename` with URL arguments converted from `values`.

    `values` that are missing from route declaration are appended to the generated URL as query 
arguments. If the value of a query argument is None, the whole pair is skipped. In case blueprints are 
active you can shortcut references to the same blueprint by prefixing the local endpoint with a dot (.).

    This will reference the index function local to the current blueprint:

    url_for('.index')

    For more information, head over to the Quickstart.

    To integrate applications, Flask has a hook to intercept URL build errors through 
Flask.url_build_error_handlers. The url_for function results in a BuildError when the current app does 
not have a URL for the given routename and values.
...
```

### Actual Behavior

http://flask.pocoo.org/docs/1.0/api/#flask.url_for

### Environment

* Flask version: 1.0.2

the vscode error  info:
 `"message": "E1101:Method 'logger' has no 'info' member",`
`"message": "E1101:Method 'logger' has no 'addHandler' member",`

but I can still run it `python test.py`, I don't know why and i get nothing in app.log.

***test.py***
```python
from flask import Flask

import logging
from logging.handlers import RotatingFileHandler

app = Flask(__name__)

hand_log = RotatingFileHandler('app.log')
hand_log.setFormatter(logging.Formatter(
    '[%(asctime)s]%(levelname)s: %(message)s'))
hand_log.setLevel(logging.INFO)
app.logger.addHandler(hand_log)

@app.route('/')
def foo():
    app.logger.info('welcome')
    return "hello"

app.run(debug=True)
```

### Environment

* Python version: 3.6.2
* Flask version: 1.0.2

### Expected Behavior

It should be possible to use jinja2 precompiled templates using loader shown in documentation: http://jinja.pocoo.org/docs/2.10/api/#jinja2.ModuleLoader

Sample repo: https://github.com/iljau/flask_precompiled_templates_issue

```python
from flask import Flask, render_template
from jinja2 import ChoiceLoader, FileSystemLoader, ModuleLoader

app = Flask(__name__)

app.jinja_env.compile_templates(
    target='templates_compiled', zip=None,
    ignore_errors=False
)

loader = ChoiceLoader([
    ModuleLoader('templates_compiled'),
    FileSystemLoader('templates')
])
app.jinja_loader = loader

@app.route('/')
def hello_world():
    return render_template("index.jinja2")


if __name__ == '__main__':
    app.run(debug=True)
```

### Actual Behavior

Tell us what happens instead.

```pytb
  File ..\lib\site-packages\flask\app.py", line 1813, in full_dispatch_request
    rv = self.dispatch_request()
  File ..\lib\site-packages\flask\app.py", line 1799, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "C:\Users\Ilja\Code\flowers_v2\flowers\flowers_app.py", line 301, in general_expenses_list
    return render_template("general_expenses.jinja2", transactions=transactions, form=form)
  File ..\lib\site-packages\flask\templating.py", line 134, in render_template
    return _render(ctx.app.jinja_env.get_or_select_template(template_name_or_list),
  File ..\lib\site-packages\jinja2\environment.py", line 869, in get_or_select_template
    return self.get_template(template_name_or_list, parent, globals)
  File ..\lib\site-packages\jinja2\environment.py", line 830, in get_template
    return self._load_template(name, self.make_globals(globals))
  File ..\lib\site-packages\jinja2\environment.py", line 804, in _load_template
    template = self.loader.load(self, name, globals)
  File ..\lib\site-packages\jinja2\loaders.py", line 113, in load
    source, filename, uptodate = self.get_source(environment, name)
  File ..\lib\site-packages\flask\templating.py", line 58, in get_source
    return self._get_source_fast(environment, template)
  File ..\lib\site-packages\flask\templating.py", line 83, in _get_source_fast
    return loader.get_source(environment, template)
  File ..\lib\site-packages\jinja2\loaders.py", line 90, in get_source
    self.__class__.__name__)
RuntimeError: ModuleLoader cannot provide access to the source
```

### Environment

* Python version: 3.7.0
* Flask version: 1.0.2
* Werkzeug version: 0.14.1
Exception happened during processing of request from ('xxx.xxx.xxx.xxx', xxxxx)
Traceback (most recent call last):
  File "C:\Users\USER\AppData\Local\Programs\Python\Python37-32\lib\socketserver.py", line 313, in _handle_request_noblock
    self.process_request(request, client_address)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python37-32\lib\socketserver.py", line 662, in process_request
    t.start()
  File "C:\Users\USER\AppData\Local\Programs\Python\Python37-32\lib\threading.py", line 847, in start
    _start_new_thread(self._bootstrap, ())
RuntimeError: can't start new thread

I get error like this when run in few hour



**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](http://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

Tell us what should happen.

```python
Paste a minimal example that causes the problem.
```

### Actual Behavior

Tell us what happens instead.

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version:3.7
* Flask version: 0.12.2
* Werkzeug version: 0.14.1

Hellow. I know that this platform is for bag-tracking and i'm so sorry to write here about my silly question. But my question on stackoverflow was mostly ignored and i tried to find a way to write to you cause i often see your answers there and I really need help. Moreover, it seems to me that for you it's just a couple of minute to solve that question. Pls, just take a look on in https://stackoverflow.com/questions/51687362/how-can-i-edit-data-fetched-from-db-in-html-table-flask-jinja2. 
Citing from issue #1575:

> The biggest one is to somehow make it clear why the flask executable is recommended over app.run() for local development and to gently guide this through from the documentation. ( https://github.com/pallets/flask/issues/1575#issuecomment-146516535) 

Looking through http://flask.pocoo.org/docs/1.0/quickstart/ I cannot see any explanation in this regard. I also don't understand why the name of the app must be exported as environment variable and cannot simply be an argument to the flask command. Without an explanation that seems very cumbersome to me. And what is the recommendation on how to run a flask app not for local development?

The website https://flask.pocoo.org response 400, it's practically down.
### Expected Behavior

```python
import flask

# in /tmp/flask
app = flask.Flask('tmp_name', root_path='/tmp')
print(flask.helpers.get_root_path('tmp_name'))
# => expect `/tmp` but `/tmp/flask`
```

### Environment

* Python version: 3.6.5
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

This patch does the following things:

* Add "$" prefix for all command except Windows-specific commands.
* Add ">" prefix for all Windows commands.
* Change "#" to "$" in some commands.
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
<!-- Tell us what should happen. -->
I am trying to develop a web page and create a button to generate PDF. I realised that if i were to include @Media print after defining my static url for css. It does not go through. 

```python
# The method as per documentation 
<link rel=stylesheet href="{{ url_for('static', filename='css/style.css') }}">

# What I want to create 
<link rel=stylesheet href="{{ url_for('static', filename='css/print.css') }}" media= "print" >

@media print {
logo{
       width : 50px !important
       height : 100px !important
  }
}
```

### Actual Behavior

```pytb
PDF preview still shows the original-sized image. 
```

### Environment

*Python 3.7.4
*Flask 1.1.1
*Werkzeug 0.16.0

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
<!-- Tell us what should happen. -->
Users are authenticated with flask-login, and should only be able to view files that they upload. `current_user.uuid` stores a unique directory for their uploads to go to so that unauthenticated users cannot access a specific users uploaded files. 

```python
@app.route('/show/<filename>')
@login_required
def show(filename: str) -> Union[Response, str]:
    print('show hit')
    filename = secure_filename(filename)  # clean user input
    user_dir = os.path.join(app.config['UPLOAD_FOLDER'], current_user.uuid)
    if os.path.exists(os.path.join(user_dir, filename)):
        return send_from_directory(directory=user_dir, filename=filename)
    else:
        abort(404)
```

### Actual Behavior
<!-- Tell us what happens instead. -->
I can visit the `show/x.png` url and I will be able to see x.png regardless of my authentication status. 

The strange thing is that in production (Nginx, Dokku, gunicorn), the `show/x.png` request never hits the flask app, possibly cached? (Nginx doesn't have caching set up, Gunicorn doesn't cache, so not sure what's happening, not my browser cache either)

Locally, I can reproduce this as well, even when I'm confident there is no browser caching going on. 

### Environment

* Python version: 3.7
* Flask version: 1.1.1
* Werkzeug version: 0.15.5

Add hyperlink of `contributing-testsuite` in CONTRIBUTING.rst and remove the duplicate dot.
Fixed typos I saw in the Request Context documentation.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Hi, when I used flask to get POST request, it ouccured "20" Exception, the 20 is not means it has 20 Exceptions, it means the Exception is 20, when this Exception appeared, didn't print any information, just print 20, what's going on? anyone can help me?

I need to scale the flask based micro-service to handle 1K-requests/sec, but the call are sync calls to 3rd party which would block 8 to 10 secs. Celery or RQ is not an option (due to certain restrictions).

Is there a specific example of how to approach using the gunicorn + gevent + workers + flask

### Environment

* Python version: 3.7
* Flask version: 1.11
* Werkzeug version:

Example 3 (user | post | path) currently fails because 'escape' has not yet been imported. Either re-insert the import here, or add 'escape' to the original import at the top.

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

https://github.com/pallets/flask/blob/599f32c7a4012ae5988c2599344503cfddeb1a08/examples/tutorial/flaskr/auth.py#L81

I was following the tutorial and I got the exception **jinja2.exceptions.TemplateNotFound:** auth/register.html while rendering the register template.
**Actual code:** `return render_template("auth/register.html")`
**Solution:** `return render_template("register.html")`

Apply the update docs config and theme to the 0.12.x branch so it can be built on Read the Docs.

related to #3350 
Based on https://github.com/pallets/flask/pull/3374#discussion_r327215251. This isn't a hard requirement, so I'm using "should" instead of "must".
* Explain that we don't do approved extensions anymore, but the guidelines are still applicable. Refresh the guidelines.
* Remove mention of old snippet site.
* Remove mention of old extensions list.
* Update mailing list and Discord links.
* Update deprecated Werkzeug imports.

closes #3356, closes #3373
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
<!-- Tell us what should happen. -->
It seems to me the DispatcherMiddleware is not available when call **werkzeug.wsgi** on flask 1.1.1. 

```python
from werkzeug.wsgi import DispatcherMiddleware
```



### Actual Behavior
<!-- Tell us what happens instead. -->

Should be in the document:

from werkzeug.middleware.dispatcher import DispatcherMiddleware



### Environment

* Python version: 3.6
* Flask version: 1.1.1
* Werkzeug version: 0.16.0

I have try many way and search to find the answer, but it seems not the real answer to solve the error : **unable to load app 0 (mountpoint='') (callable not found or import error)**
I make a single .py file to use flask successfully, but with a moulde to use this flask demo ,to deploy with uWSGI badly. its always get "unable to load app 0 (mountpoint='/flaskr') (callable not found or import error)" error, I cry three thousand times now. 
【nginx config】
![image](https://user-images.githubusercontent.com/34828669/65393320-dee4d780-ddb1-11e9-99d8-09f7487800fb.png)
【command 】
I make a single .py file to use flask successfully, but with a moulde to use this flask demo ,to deploy with uWSGI badly. its always get "unable to load app 0 (mountpoint='/flaskr') (callable not found or import error)" error, I cry three thousand times now. 
【nginx config】
![image](https://user-images.githubusercontent.com/34828669/65393320-dee4d780-ddb1-11e9-99d8-09f7487800fb.png)
【command 】
Most of the other arguments passed into ``response.set_cookie()`` in ``SecureCookieSessionInterface.save_session()`` use the overridable methods of ``SessionInterface`` to fill in each argument. Except for the cookie name, which is statically set to ``app.session_cookie_name``.

Sometimes a cookie name needs to be set dynamically based on the current request, for example, a cookie name that is dependent on the current subpath in the URL. At the moment, the best way of doing this is to override the ``save_session()`` method of ``SecureCookieSessionInterface`` and make it dynamically pass in the cookie name to ``response.set_cookie()``. 

To avoid having to override the whole of ``save_session()``, this pull request adds in an overridable ``get_cookie_name()`` method on ``SessionInterface`` to match the other ``get_xxx()`` methods of that class.

Note: I originally posted a question about this in Stackoverflow (_["Something like get_cookie_name in Flask's SessionInterface?"](https://stackoverflow.com/questions/55281983/something-like-get-cookie-name-in-flasks-sessioninterface)_) and also asked the question (using the Stackoverflow link) in the Flask Discord chat. I was not satisfied with the response I got, so I've opened up this pull request.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Most of the other arguments passed into ``response.set_cookie()`` in ``SecureCookieSessionInterface.save_session()`` use the overridable methods of ``SessionInterface`` to fill in each argument. Except for the cookie name, which is statically set to ``app.session_cookie_name``.

Sometimes a cookie name needs to be set dynamically based on the current request, for example, a cookie name that is dependent on the current subpath in the URL. At the moment, the best way of doing this is to override the ``save_session()`` method of ``SecureCookieSessionInterface`` and make it dynamically pass in the cookie name to ``response.set_cookie()``. 

To avoid having to override the whole of ``save_session()`` this PR adds in an overridable ``get_cookie_name()`` method on ``SessionInterface`` to match the other ``get_xxx()`` methods of that class.

Note: I originally posted a question about this in Stackoverflow (_["Something like get_cookie_name in Flask's SessionInterface?"](https://stackoverflow.com/questions/55281983/something-like-get-cookie-name-in-flasks-sessioninterface)_) and also asked the question (using the Stackoverflow link) in the Flask Discord chat. I was not satisfied for the response I got, so I've opened up a PR.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

### Expected Behavior
When a user enters a route to a location with a trailing slash but leaves the trailing slash off, they either receive a 404 or they are redirected to that location with a trailing slash using the same scheme they provided (https vs http)

```python
@sp_app.route('/acs/', methods=["GET", 'POST'])
def acs():
    # example code here
```

### Actual Behavior
Flask will happily accept a route appended with a slash. When a user navigates to that route without the trailing slash they will be redirected with a 308 PERMANENT REDIRECT. This redirection does not maintain the schema of the original request, always dropping the request to HTTP. 

This can be abused by an attacker to force transmission by a user over HTTP by sending a crafted link such as https://mysite.com/acs instead of https://mysite.com/acs/. It is also likely an administrator might make this mistake when configuring locations or distributing links. 

### Environment
* Python version: 2.7.16
* Flask version:  1.1.1

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
<!-- Tell us what should happen. -->

```python
# Paste a minimal example that causes the problem.
```

### Actual Behavior
<!-- Tell us what happens instead. -->
- I use tensorflow for authentication code recognition. No problem with local testing. But when I put the code on Flask Server. It`s can`t work. 
- The Exceptions
```
The Session graph is empty.  Add operations to the graph before calling run().
```
```pytb
Paste the full traceback if there was an exception.
2019-09-19 12:24:53,001 data_recovery_controller.py[line:178] [recovery_samsung_report_daily_data] ERROR recovery_samsung_report_daily_data fail! cause:The Session graph is empty.  Add operations to the graph before calling run().
Traceback (most recent call last):
  File "/usr/local/lib/python3.7/site-packages/flask/app.py", line 1997, in __call__
    return self.wsgi_app(environ, start_response)
  File "/usr/local/lib/python3.7/site-packages/flask/app.py", line 1985, in wsgi_app
    response = self.handle_exception(e)
  File "/usr/local/lib/python3.7/site-packages/flask/app.py", line 1540, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/usr/local/lib/python3.7/site-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "/usr/local/lib/python3.7/site-packages/flask/app.py", line 1982, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/lib/python3.7/site-packages/flask/app.py", line 1615, in full_dispatch_request
    return self.finalize_request(rv)
  File "/usr/local/lib/python3.7/site-packages/flask/app.py", line 1630, in finalize_request
    response = self.make_response(rv)
  File "/usr/local/lib/python3.7/site-packages/flask/app.py", line 1740, in make_response
    rv = self.response_class.force_type(rv, request.environ)
  File "/Users/mjvcp/Library/Python/3.7/lib/python/site-packages/werkzeug/wrappers/base_response.py", line 269, in force_type
    response = BaseResponse(*_run_wsgi_app(response, environ))
  File "/Users/mjvcp/Library/Python/3.7/lib/python/site-packages/werkzeug/wrappers/base_response.py", line 26, in _run_wsgi_app
    return _run_wsgi_app(*args)
  File "/Users/mjvcp/Library/Python/3.7/lib/python/site-packages/werkzeug/test.py", line 1119, in run_wsgi_app
    app_rv = app(environ, start_response)
TypeError: 'BaseResponse' object is not callable

```
- but when i Reduced version with Flask 0.12.2. The program runs ok.


### Environment

* Python version: 3.7
* Flask version: 1.1.1
* Werkzeug version:

### Expected Behavior
Every time I call send file it should be sending the recently updated file.

```python
# @app.route('/data/<file>-<key>', methods=['GET'])
def data_download(file, key):
    from flask import send_file
    # Reading the path from environment
    csvfile = os.environ['data_path']+"/{}".format(file)
    if key == "abc":
        return send_file(csvfile,
                         mimetype='text/csv',
                         attachment_filename=file,
                         as_attachment=True).
```

### Actual Behavior
First time when this method is called it sends the latest file, however after that, if there are changes made in the file it's not sending the updated file it just sends the file containing same data as it had previously though the data is getting updated in the original file.

```pytb
No exception it just does not sends the updated file.
```

### Environment

* Python version:3.6
* Flask version:1.1.1
* Werkzeug version:0.15.5

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
<!-- Tell us what should happen. -->
Flask should load the correct MIME type for dict ("application/json")
```python
from flask import Flask
import sqlite3
app = Flask(__name__)

@app.route('/cards')
def hello_world():
    #some sql to create my data
    result = {a:b for a,b in list(zip(names,my_radical))}
    return result
    #things i also tried:
    #return jsonify(result)
    #return Response(jsonify(result), mimetype="application/json")

```

### Actual Behavior
<!-- Tell us what happens instead. -->
I GET my JSON as "text/html" literal, with no unicode(could encoding be the problem?)
This happens if i try using `Response()` directly:
```pytb
Error on request:
Traceback (most recent call last):
  File "/home/john/Documents/wk6-server/venv/lib/python3.6/site-packages/werkzeug/serving.py", line 303, in run_wsgi
    execute(self.server.app)
  File "/home/john/Documents/wk6-server/venv/lib/python3.6/site-packages/werkzeug/serving.py", line 293, in execute
    for data in application_iter:
  File "/home/john/Documents/wk6-server/venv/lib/python3.6/site-packages/werkzeug/wsgi.py", line 507, in __next__
    return self._next()
  File "/home/john/Documents/wk6-server/venv/lib/python3.6/site-packages/werkzeug/wrappers/base_response.py", line 45, in _iter_encoded
    for item in iterable:
TypeError: 'Response' object is not iterable
```

### Environment


```
$ flask --version
Python 3.6.8
Flask 1.1.1
Werkzeug 0.15.6
```
The first one is to fully leverage Py3 features. Also, Py2 EOL is due in a few months.
The second one is to add speed. Much speed. So Flask can handle more requests with the same hardware, and run smoother while doing so.

Maybe both of these are already in the works?

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
<!-- Tell us what should happen. -->
request.form should contain data posted from an html form.

```
import os
import functools
from flask import(
    Flask, Blueprint, flash, g, redirect, render_template_string, request, session, url_for
)

bp = Blueprint('new', __name__, url_prefix="/")

html = """
<!DOCTYPE html>
<title> Example Issue</title>
<section class="content">
<form method="POST">
        <label for="task">Task</label>
        <input name="task" id="task" required>
        <input type="submit" name="Add" value="Submit">
    </form>
</section>
"""

@bp.route('/new', methods=('GET', 'POST'))
def new():
    if request.method == 'POST':
        print(request.form.__dict__)
    return render_template_string(html)

def create_app():
    app = Flask(__name__)
    app.register_blueprint(bp)
    return app

```

### Actual Behavior
`request.form` is empty. The output of `request.__dict__` is 

```
{'environ': {'wsgi.version': (1, 0), 'wsgi.url_scheme': 'http', 'wsgi.input': <_io.BufferedReader name=5>, 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='UTF-8'>, 'wsgi.multithread': True, 'wsgi.multiprocess': False, 'wsgi.run_once': False, 'werkzeug.server.shutdown': <function WSGIRequestHandler.make_environ.<locals>.shutdown_server at 0x7f0d2c2fa8c0>, 'SERVER_SOFTWARE': 'Werkzeug/0.15.6', 'REQUEST_METHOD': 'POST', 'SCRIPT_NAME': '', 'PATH_INFO': '/new', 'QUERY_STRING': '', 'REQUEST_URI': '/new', 'RAW_URI': '/new', 'REMOTE_ADDR': '127.0.0.1', 'REMOTE_PORT': 49372, 'SERVER_NAME': '127.0.0.1', 'SERVER_PORT': '5000', 'SERVER_PROTOCOL': 'HTTP/1.1', 'HTTP_HOST': '127.0.0.1:5000', 'HTTP_USER_AGENT': 'Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0', 'HTTP_ACCEPT': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8', 'HTTP_ACCEPT_LANGUAGE': 'en-US,en;q=0.5', 'HTTP_ACCEPT_ENCODING': 'gzip, deflate', 'HTTP_REFERER': 'http://127.0.0.1:5000/new', 'CONTENT_TYPE': 'application/x-www-form-urlencoded', 'CONTENT_LENGTH': '26', 'HTTP_CONNECTION': 'keep-alive', 'HTTP_UPGRADE_INSECURE_REQUESTS': '1', 'werkzeug.request': <Request 'http://127.0.0.1:5000/new' [POST]>}, 'shallow': False, 'url_rule': <Rule '/new' (HEAD, POST, GET, OPTIONS) -> new.new>, 'view_args': {}, 'url': 'http://127.0.0.1:5000/new'}
```

### Environment

* Python version: 3.74
* Flask version: 1.1.1
* Werkzeug version: 0.15.6

Firefox console shows the form data as a param

![DeepinScreenshot_select-area_20190914001412](https://user-images.githubusercontent.com/23251147/64903349-4c07b700-d6a6-11e9-8476-b640c5eb54ae.png)

**Problem:**
Creating a custom command for the flask CLI with an import exception is silent, even when running the command, e.g. `start` with `flask start` directly.
This makes it difficult to debug import errors in changing environments, as you're left with
```
Error: No such command "start".
```
without further explanation.

**Origin:**
https://github.com/pallets/flask/blob/d694eb443a6243e248df974e9cd64defb591bf38/src/flask/cli.py#L541-L546
`NoAppException` is caught silently with a `pass`, even though `get_command` seems to only be used to execute a single command rather than an entire command listing.
However, even the command listing of `list_commands` explicitly prints the traceback with `traceback.print_exc()`.
Why that is not done in `get_command` is not clear to me at this point.
For a project of mine I had the need to have a request context available in a cli command. This PR adds the code used, together with test and relevant code.

I have not added the ``versionadded`` yet, should it contain 1.1.2?

Hi,

I have a Python package, let's call it `mypackage`. After creating a Flask app inside the package, I noticed that all logging messages from my own package started appearing twice.

I tracked the cause to Flask automatically creating a `logging.Logger` instance (accessible as `app.logger`) that has the name `mypackage`. This follows from the fact that name of my Flask app is also `mypackage` (this is required to set up some static assets correctly). However, as `logging.Logger` instances are singletons, Flask ends up accessing an existing logger inside my package hierarchy and silently attaching its own stderr handler to it. Since all logging messages from my package end up propagating into the `mypackage` logger (before they propagate to the root logger), I now get all log messages twice.

Possible remedies that I can think

- do not automatically set up logging handlers inside Flask, or only set them up in special circumstances
- if the app logger really needs to be automagically set up and equipped with a handler, give it a name of 'Flask.{insert_appname}' or something to reduce chance of name collisions

Using Flask 1.1.1, Python 2.7.16

`Flask.send_file` sends blank files when using `io.StringIO` in Python 3. There is a warning that this is wrong but the response code is still 200 but with a blank file. 

Testing this behavior with a test_client will however still result in output. Which doesn't really make sense. 

Related Info:
https://stackoverflow.com/questions/35710361/python-flask-send-file-stringio-blank-files

### Expected Behavior

- `Flask.send_file` should accept an `io.StringIO` file object and send it to the browser properly
- `Flask.send_file` should 500 on the the request instead of a blank file
- `app.test_client` shouldn't have data in this setup

Test Case:
Run in Python 3
```python
import sys
if sys.version_info >= (3, 0):
    from io import StringIO
else:
    from StringIO import StringIO

from flask import Flask, send_file
import csv
app = Flask(__name__)

@app.route('/')
def hello_world():
    temp = StringIO()
    writer = csv.writer(temp)
    header = ['test', 'test']
    writer.writerow(header)

    temp.seek(0)

    return send_file(
        temp,
        as_attachment=True,
        cache_timeout=-1,
        attachment_filename="test.csv"
    )

app.test_client()

with app.test_client() as c:
    rv = c.get('/')
    print(rv.data)

app.run(debug=True, threaded=True, host="127.0.0.1", port=4000)
```
```
❯ python3 test_case.py
b'test,test\r\n'
 * Serving Flask app "test_case" (lazy loading)
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: on
 * Running on http://127.0.0.1:4000/ (Press CTRL+C to quit)
 * Restarting with stat
b'test,test\r\n'
 * Debugger is active!
 * Debugger PIN: 881-854-930
127.0.0.1 - - [10/Sep/2019 02:15:54] "GET / HTTP/1.1" 200 -
Error on request:
Traceback (most recent call last):
  File "/Users/kchung/.virtualenvs/ctfd3/lib/python3.7/site-packages/werkzeug/serving.py", line 303, in run_wsgi
    execute(self.server.app)
  File "/Users/kchung/.virtualenvs/ctfd3/lib/python3.7/site-packages/werkzeug/serving.py", line 294, in execute
    write(data)
  File "/Users/kchung/.virtualenvs/ctfd3/lib/python3.7/site-packages/werkzeug/serving.py", line 274, in write
    assert isinstance(data, bytes), "applications must write bytes"
AssertionError: applications must write bytes
```

```
❯ curl -vvv http://localhost:4000
* Rebuilt URL to: http://localhost:4000/
*   Trying ::1...
* TCP_NODELAY set
* Connection failed
* connect to ::1 port 4000 failed: Connection refused
*   Trying 127.0.0.1...
* TCP_NODELAY set
* Connected to localhost (127.0.0.1) port 4000 (#0)
> GET / HTTP/1.1
> Host: localhost:4000
> User-Agent: curl/7.54.0
> Accept: */*
>
* HTTP 1.0, assume close after body
< HTTP/1.0 200 OK
< Content-Disposition: attachment; filename=test.csv
< Content-Type: text/csv; charset=utf-8
< Cache-Control: public, max-age=-1
< Expires: Tue, 10 Sep 2019 06:29:28 GMT
< Connection: close
< Server: Werkzeug/0.15.6 Python/3.7.4
< Date: Tue, 10 Sep 2019 06:29:29 GMT
<
* Closing connection 0
```

### Actual Behavior
- With Python 3 Hitting the endpoint in a browser results in an empty file but in the test_client there is a data response. 

### Environment

* Python version: 3.7.4
* Flask version: 1.1.1
* Werkzeug version: 0.15.3

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->
<!-- Tell us what should happen. -->
This error occasionally occurs on the production server, which using flask combine uwsgi and nginx. 

What I can see in the traceback below is the REQUEST_METHOD parameter is missing from the environment variable uwsgi passes to flask app.
```
Traceback (most recent call last):
  File "/home/projects/igor/virtualenv/lib/python2.7/site-packages/flask/app.py", line 1994, in __call__
    return self.wsgi_app(environ, start_response)
  File "/home/projects/igor/virtualenv/lib/python2.7/site-packages/flask/app.py", line 1977, in wsgi_app
    ctx = self.request_context(environ)
  File "/home/projects/igor/virtualenv/lib/python2.7/site-packages/flask/app.py", line 1938, in request_context
    return RequestContext(self, environ)
  File "/home/projects/igor/virtualenv/lib/python2.7/site-packages/flask/ctx.py", line 242, in __init__
    self.url_adapter = app.create_url_adapter(self.request)
  File "/home/projects/igor/virtualenv/lib/python2.7/site-packages/flask/app.py", line 1765, in create_url_adapter
    server_name=self.config['SERVER_NAME'])
  File "/home/projects/igor/virtualenv/lib/python2.7/site-packages/werkzeug/routing.py", line 1524, in bind_to_environ
    environ["REQUEST_METHOD"],
KeyError: 'REQUEST_METHOD'
```
<!-- Tell us what happens instead. -->

### Environment

* Python version:2.7.9
* Flask version:0.12

### Expected Behavior
I was wondering if there is still an access to Flask snippets? I tried to follow http://flask.pocoo.org/snippets/70/ but the documentation has evolved since this link has been written, I get the documentation main page (https://palletsprojects.com/p/flask/).

### Actual Behavior
Actually, the same behavior is observable in the official documentation. The Flask snippet archive URL in documentation (http://flask.palletsprojects.com/en/1.1.x/patterns/) is somehow obsolete or missing, as it redirects to doc main page:

```
There are more user contributed snippets and patterns in the `Flask
Snippet Archives <http://flask.pocoo.org/snippets/>`_.
```

### Environment

* Flask version: 1.1
Describe what this patch does to fix the issue.
add a system environment variable `FLASK_ENV_PATH` to specify `dotenv` to load file

Link to any relevant issues or pull requests.
https://github.com/pallets/flask/issues/3108

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

### Expected Behavior
All tutorial steps should work


### Actual Behavior
error in method not imported

```pytb
return "User  %s" % escape(username)
NameError: name 'escape' is not defined
```

I think all the steps of the tutorial should be followed without errors, this helps the beginners. At [Quickstart](https://flask.palletsprojects.com/en/1.1.x/quickstart/#quickstart), [Variable Rules](https://flask.palletsprojects.com/en/1.1.x/quickstart/#variable-rules) generate an error because the escape method was not imported earlier in the tutorial. I could open a PR for that, but repeating the previous code doesn't make much sense to me, and I can't think of a way to not make it messy. So I'll open this issue before I sleep and forget it.

It may seem like a silly issue, but I always worry about documentation and how easy it should be for beginners to follow.

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
<!-- Tell us what should happen. -->
I was expecting that running my flask application would only spin one process with no subprocesses.  Like the following screenshot. (This is with importing pandas commented)
![Screen Shot 2019-09-05 at 3 52 46 PM](https://user-images.githubusercontent.com/52763317/64376130-8b267000-cff5-11e9-9251-c170e549d9dc.png)

The following is example of the which replicates the issue.

```python
from flask import Flask
import pandas as pd

app = Flask(__name__)

@app.route('/')
def hello():
    return "Hello World!"

if __name__ == '__main__':
    app.run().
```

### Actual Behavior
<!-- Tell us what happens instead. -->
Importing pandas in a Flask app multiple subprocesses are spun up. I have a Flask app that uses Flask and pandas to show basic tables. When I run the app multiple flask and python instances instances are spun up. I normally wouldn't have bothered but this is causing the application when hosted on gunicorn to be unstable.( Running 2-4 workers spins up a lot of processes and the application keeps restarting. See the screenshot below - 
![Screen Shot 2019-09-05 at 3 45 46 PM](https://user-images.githubusercontent.com/52763317/64376755-f755a380-cff6-11e9-82b9-8be278b0a2e6.png)
![Screen Shot 2019-09-05 at 3 48 13 PM](https://user-images.githubusercontent.com/52763317/64376756-f755a380-cff6-11e9-8332-02157ffd662b.png)


### Environment

* Python version: 
```
Python 3.7.4 (default, Jul 30 2019, 19:56:38)
[GCC 7.3.1 20180712 (Red Hat 7.3.1-6)] on linux
```
* Flask version:`1.0.2`
* Werkzeug version:`0.15.2`

### Expected Behavior
I am adding headers to the response of every request in my app (a [pep 503](https://www.python.org/dev/peps/pep-0503/) style web-app to serve out internally hosted python libraries).  The extra header shows up in almost every response.

```python
app = Flask(__name__)

@app.after_request
def extra_header(response):
    response.headers['foo'] = 'bar'
    return response

### pep 503 endpoint to serve pip installs
@app.route('/packages/<package_name>/<filename>')
def get_package(package_name, filename):
    ### logic to get library from internal databases
    ### directory, filename get defined here
    return send_from_directory(directory, filename)
```

Then the users run a `pip install index-url=<flask-app url>`.  Every request/response must include the custom header though or it is blocked by internal gates.

### Actual Behavior
When a user runs a `pip install 'internal_library>1.2'` or similar syntax without a `--no-cache-dir` option, pip sends a GET to the server with `If-None-Match` and `If-Modified-Since` headers.  When those match, the web-server responds with status code **304** and headers that include `ETag` and `Cache-Control`, but not the custom headers specified in the `after_request` function.

### Environment

* Python version: 3.5.1
* Flask version: 0.12.2
* Werkzeug version: 0.12.2

Trying to upload a file named `Расшифровка RootKit.com [63k].txt` via `requests.post(files={'file': open(fn, 'rb')})`. I checked the file is sent with its correct name. On the other side, `request.files['file']` does not have the good filename.

### Expected Behavior
The file should be should saved with its filename.

```python
def _upload_file(filename):
    def filter_filename(filename: str) -> str:
        """Stolen from werkzerg and add exotic letters"""
        from unicodedata import normalize
        # filtered = normalize("NFKD", filename)
        filtered = filename
        for s in sep, altsep:
            if s:
                filtered = filtered.replace(s, " ")
        pattern = re.compile(r"[^\w.-]")
        filtered = pattern.sub("", "_".join(filtered.split()))
        filtered = filtered.strip("._")
        # filtered = filtered.encode('utf-8')
        return filtered

    global TMP_PATH
    u_file = request.files[filename]
    u_path = pjoin(TMP_PATH, filter_filename(path))
    u_file.save(u_path)  # crash: UnicodeEncodeError
    return u_path
```

### Actual Behavior
Flask fails to save the uploaded file.

```pytbssh
File "/var/www/app/eyeaieouille/app/api.py", line 174, in post_leak
[Wed Sep 04 11:46:21.960213 2019] [wsgi:error] [pid 72138:tid 140145960113920] [remote 192.168.180.67:53369]     u_path = _upload_file('dump')
[Wed Sep 04 11:46:21.960240 2019] [wsgi:error] [pid 72138:tid 140145960113920] [remote 192.168.180.67:53369]   File "/var/www/app/eyeaieouille/app/api.py", line 76, in _upload_file
[Wed Sep 04 11:46:21.960261 2019] [wsgi:error] [pid 72138:tid 140145960113920] [remote 192.168.180.67:53369]     u_file.save(u_path)
[Wed Sep 04 11:46:21.960266 2019] [wsgi:error] [pid 72138:tid 140145960113920] [remote 192.168.180.67:53369]   File "/usr/lib/python3/dist-packages/werkzeug/datastructures.py", line 2725, in save
[Wed Sep 04 11:46:21.960274 2019] [wsgi:error] [pid 72138:tid 140145960113920] [remote 192.168.180.67:53369]     dst = open(dst, 'wb')
[Wed Sep 04 11:46:21.960291 2019] [wsgi:error] [pid 72138:tid 140145960113920] [remote 192.168.180.67:53369] UnicodeEncodeError: 'ascii' codec can't encode characters in position 5-15: ordinal not in range(128)

```

Whenever I try to print `request.files['file'].filename` with `app.logger.info()`, I have:

```pytb
[Wed Sep 04 11:40:08.636779 2019] [wsgi:error] [pid 71927:tid 140645057996544] [remote 192.168.180.67:53298] Message: '\xd0\xa0\xd0\xb0\xd1\x81\xd1\x88\xd0\xb8\xd1\x84\xd1\x80\xd0\xbe\xd0\xb2\xd0\xba\xd0\xb0 RootKit.com [63k].txt'
```

### Environment

* Python version: 3.6.8
* Flask version: 0.12.2
* Werkzeug version: 0.14.1

EDIT:
I took a look at Wireshark, and this is what I saw:  
`Content-Disposition: form-data; name="dump"; filename*=utf-8''%D0%A0%D0%B0%D1%81%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%BA%D0%B0%20RootKit.com%20%5B63k%5D.txt`
I think Flask turns this into `\xd0\xa0\xd0\xb0\xd1\x81\xd1\x88\xd0\xb8\xd1\x84\xd1\x80\xd0\xbe\xd0\xb2\xd0\xba\xd0\xb0 RootKit.com [63k].txt` instead of `Расшифровка RootKit.com [63k].txt`. I am not expecting for a fix as long as the documentation advises to use the `werkzerg.secure_filename()` function, but as it erases some characters (`[^a-zA-Z0-9]` cleaning), but I would appreciate a wordaround, it did not manage to solve this issue.
https://flask.palletsprojects.com/en/0.12.x/deploying/wsgi-standalone/#proxy-setups used to be a valid link and no longer is.

@davidism is this intended? I can probably fix it in rtd.
It now describes how to install flaskr using pip so that all tests pass.

All tests in examples/tutorial/tests failed because the module flaskr could not be loaded, so I added a line describing how to install flaskr as an editable module. This should fix #2833 .
After changing to from version 1.0.3 to 1.1 my marshall with many code breaks

```python
from marshmallow import fields
from flask import Blueprint
from flask_apispec import marshal_with, doc
from database import Team
from marshmallow import Schema


bp = Blueprint("team", __name__, url_prefix="/teams")


class TeamSchema(Schema):
    id = fields.Str(required=True, dump_only=True, example="1")
    name = fields.Str(required=True, example="123 Abc")


@bp.route("")
@marshal_with(TeamSchema(many=True), description="A list of teams.")
@doc(tags=["Team"])
def search():
    """Fetch the list of teams, ordered by name."""
    return Team.query.order_by("name")
```
 And gives the following error when invoked either by localhost/teams
`TypeError: The view function did not return a valid response. The return type must be a string, dict, tuple, Response instance, or WSGI callable, but it was a list.`

When running when changing to flask 1.0.3 it works. Without an error

### Environment

* Python version: 3.6.8
* Flask version: 1.1
* Werkzeug version: 0.15.5
* marshmallow:  2.20.2
### Expected Behavior
register & un-register blueprints

is there any way to do such so ?
assuming I've registered (api_blueprint) then I want to un-register it and register it again (PLUG & UNPLG)
Describe default log level.
### Expected Behavior
Using the route decorator (below), I expect going to `/devices/1` to execute the related method, but instead it throws a 308 redirect response back to `devices`.

If I change the url to `/devices/2` it properly executes the method

Removing the 3rd route decorator does not change the behaviour, `devices/1` still redirects

```python

@app.route('/devices', methods=['GET'], defaults={"page":1,"per_page":1})
@app.route('/devices/<int:page>', methods=['GET'], defaults={"per_page":1})
@app.route('/devices/<int:page>/<int:per_page>', methods=['GET'])
def devices_get(page, per_page):

```

```
devices_get           GET      /devices/<int:page>/<int:per_page>
devices_get           GET      /devices/<int:page>
devices_get           GET      /devices
```

### Environment

* Python version: 3.7
* Flask version: '1.1.1'
* werkzeug-0.15.5

The guidelines for the first time setup of Flask for development lacks any details about the installation of pre-commit module. The command to install the pre-commit hooks is not set as a code block and is rendered as a quote.
As someone who decided to make a few contributions on the framework, this is a quite irritating start of the journey 😄 I've added a link to the official guide for the installation of the pre-commit and fixed the markdown to make the command a code block.
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

I want to get file list from form by using:

`photos = request.files.getlist("photo")
`
However if i haven't select anything, the photos value is never be [] like other fields.

So the way to check for empty field is failed:

```
if not photos:
   pass
```
The result for empty form is:
` [<FileStorage: '' ('application/octet-stream')>]`

How do i get rid of it?
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
<!-- Tell us what should happen. -->
flask run --host=0.0.0.0 --port=443 --cert=host.crt --key=host.key
It works after run command above

After deploy to apache using mod_wsgi,
It also works fine for basic request, but it does't work if you pass Authorization key as Headers, It seems the value can't be passed successfully


```python
# Paste a minimal example that causes the problem.
```

### Actual Behavior
<!-- Tell us what happens instead. -->

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version: python3.6
* Flask version: flask1.0
* Werkzeug version:Werkzeug0.15.5

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

I have stumbled upon this, at least for me, unexpected behaviour. For specific reasons, I have dictionary, which has str type key and None type key. When I try to use flask's json.dumps, it throws me TypeError, which I think should not happen, as is also described here: [https://docs.python.org/3/library/json.html#json.dump](https://docs.python.org/3/library/json.html#json.dump)

> If skipkeys is true (default: False), then dict keys that are not of a basic type (str, int, float, bool, None) will be skipped instead of raising a TypeError.

So I understand this as that if skipkeys is False (and it is False by default and I am not setting it otherwise) and I have a dictionary with key types str or None, I should not receive TypeError. 

Which is the case, when I try the same with regular python json library like this:
```
>>> import json
>>> print(json.dumps(test))
{"aa": 0, "null": {}}
>>> 

```

### Expected Behavior
<!-- Tell us what should happen. -->
So my expectation is, that I should have the same behaviour also with flask's json implementation for the same dictionary keys:
```python
>>> from flask import json as fjson
>>> test = {'aa': 0, None: {}}
>>> print(fjson.dumps(test))
{"aa": 0, "null": {}}
```
should print: `{"aa": 0, "null": {}}`

### Actual Behavior
<!-- Tell us what happens instead. -->

But instead of that, I receive TypeError.
```
>>> from flask import json as fjson
>>> test = {'aa': 0, None: {}}
>>> print(fjson.dumps(test))
```
ends up with: `TypeError: '<' not supported between instances of 'NoneType' and 'str'`
```pytb

Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/home/user/path/project/venv/lib/python3.7/site-packages/flask/json/__init__.py", line 211, in dumps
    rv = _json.dumps(obj, **kwargs)
  File "/usr/lib/python3.7/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/usr/lib/python3.7/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/usr/lib/python3.7/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
TypeError: '<' not supported between instances of 'NoneType' and 'str'
>>> 

```

### Environment

* Python version: 3.7
* Flask version: 1.1.1
* Werkzeug version: 0.15.2

Asyncio is the future of Python, does flask plan to support it?
Add a hosted deployment option for [render.com](https://render.com).
Flask apparently breaks sqlalchemy and requires you to pass named parameters as
[{}] 
no idea why, I'm to upset with Flask at the moment to go figure it out.
feel free to fix Flask for real, or fix this to be more sane, as I haven't gone spelunking, but this is the only way I could make named params actually work.

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->


<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Just fixes a minor typo I noticed while reading the docs.
The docs say (https://flask.palletsprojects.com/en/1.1.x/deploying/wsgi-standalone/#proxy-setups):
```python
from werkzeug.middleware.proxy_fix import ProxyFix
app.wsgi_app = ProxyFix(app.wsgi_app, x_proto=1, x_host=1)
```

I get this from mypy:
`qc/create_app.py:47: error: Cannot assign to a method`

What's the correct solution here?
code style related

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

An Windows, it is not possible for me to run `flask run` in development mode. I always run into
```
python.exe: No module named C:\Users\...\flask
```
This holds for PowerShell as well as for Git Bash.

I think it could be helpful to provide the solution to this issue in this docu.


16 * 1024 * 1024 = 16 MiB (Mebibyte)
16 * 1000 * 1000 = 16 MB (Megabyte)

The example is in megabytes, not in mebibytes.
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
App should run as expected on 127.0.0.1 with debugger mode enabled

```python
# Paste a minimal example that causes the problem.
# .. E:/web/public/myblog.in/hello.py
from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello, World!'
```
all configs and venv enabled as https://flask.palletsprojects.com/en/1.1.x/quickstart/
```bash
export FLASK_APP=hello.py

```


### Actual Behavior
<!-- Tell us what happens instead. -->
`flask run` works as expected. I can see the "Hello world" without issues, **unless** I enabled debug mode as `export FLASK_ENV=development` in which case if I run `flask run` I get 

```bash
$ flask run                                                                                                                                                                                                        
 * Serving Flask app "hello.py" (lazy loading)                                                                                                                                                                     
 * Environment: development                                                                                                                                                                                        
 * Debug mode: on                                                                                                                                                                                                  
 * Restarting with stat                                                                                                                                                                                            
e:\web\public\myblog.in\venv\scripts\python.exe: Error while finding module specification for 'E:\\web\\public\\myblog.in\\venv\\Scripts\\flask' (ModuleNotFoundError: No module named 'E:\\web\\public\\myblog')  
```

You can see in the last error it says `No module named 'E:\\web\\public\\myblog` (it should be ..`\\myblog.in` **(.in)** is missing, maybe that is the issue (bug)

### Environment

* Python version: 3.7.1
* Flask version: 1.1.x
* Werkzeug version: 0.15.5

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
The test client should be able to set cookies in a manner that the application object can read them. There's a `.set_cookie(...)` method but it doesn't seem to work -- after stepping through it I think the issue is that cookies aren't getting signed?

```python
import flask

app = flask.Flask("test")


@app.route("/")
def index():
    assert "thing" in app.session
    return "okay"


def test():
    with app.test_client() as client:
        client.set_cookie("example.com", "thing", "value")
        response = client.get("/", base_url="http://example.com")
    assert response.status_code == 200

test()
```

### Actual Behavior
The assertion is tripped due to an empty session, despite `set_cookie()` seemingly succeeding.


### Environment

* Python version: 3.6.7
* Flask version: 1.1.1
* Werkzeug version: 0.15.4

**TL;DR:** Python crashes because of libcrypto shenanigans. Ignoring for the moment that I'm running a beta OS, is this a Flask problem or a Python problem? Flask worked beautifully before I upgraded to Python 3.7.4, even on 10.15.

### Expected Behavior
My application starts.

```
FLASK_ENV=development flask run --host=0.0.0.0
```

### Actual Behavior
Python crashes.

```
 * Environment: development
 * Debug mode: on
 * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)
 * Restarting with stat
Abort trap: 6
 * Debugger is active!
 * Debugger PIN: 244-572-746
Traceback (most recent call last):
  File "/usr/local/bin/flask", line 10, in <module>
    sys.exit(main())
  File "/usr/local/lib/python3.7/site-packages/flask/cli.py", line 906, in main
    cli.main(args=args, prog_name=name)
  File "/usr/local/lib/python3.7/site-packages/flask/cli.py", line 569, in main
    return super(FlaskGroup, self).main(*args, **kwargs)
  File "/usr/local/lib/python3.7/site-packages/click/core.py", line 717, in main
    rv = self.invoke(ctx)
  File "/usr/local/lib/python3.7/site-packages/click/core.py", line 1137, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/usr/local/lib/python3.7/site-packages/click/core.py", line 956, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/usr/local/lib/python3.7/site-packages/click/core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "/usr/local/lib/python3.7/site-packages/click/decorators.py", line 64, in new_func
    return ctx.invoke(f, obj, *args, **kwargs)
  File "/usr/local/lib/python3.7/site-packages/click/core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "/usr/local/lib/python3.7/site-packages/flask/cli.py", line 783, in run_command
    threaded=with_threads, ssl_context=cert)
  File "/usr/local/lib/python3.7/site-packages/werkzeug/serving.py", line 1007, in run_simple
    run_with_reloader(inner, extra_files, reloader_interval, reloader_type)
  File "/usr/local/lib/python3.7/site-packages/werkzeug/_reloader.py", line 326, in run_with_reloader
    ensure_echo_on()
  File "/usr/local/lib/python3.7/site-packages/werkzeug/_reloader.py", line 315, in ensure_echo_on
    termios.tcsetattr(sys.stdin, termios.TCSANOW, attributes)
termios.error: (5, 'Input/output error')
```

Along with the traceback, I get a "Python quit unexpectedly." dialog from the OS itself:

```
Process:               Python [22680]
Path:                  /usr/local/Cellar/python/3.7.4/Frameworks/Python.framework/Versions/3.7/Resources/Python.app/Contents/MacOS/Python
Identifier:            Python
Version:               3.7.4 (3.7.4)
Code Type:             X86-64 (Native)
Parent Process:        bash [96512]
Responsible:           iTerm2 [96508]
User ID:               501

Date/Time:             2019-08-10 19:59:34.561 +0200
OS Version:            Mac OS X 10.15 (19A526h)
Report Version:        12
Bridge OS Version:     3.0 (14Y904)
Anonymous UUID:        01D731B3-953D-1E90-36A7-011EAA224529

Sleep/Wake UUID:       1BC6AE63-AA8F-4BEF-8027-28080B7A5B9E

Time Awake Since Boot: 16000 seconds
Time Since Wake:       6000 seconds

System Integrity Protection: enabled

Crashed Thread:        1

Exception Type:        EXC_CRASH (SIGABRT)
Exception Codes:       0x0000000000000000, 0x0000000000000000
Exception Note:        EXC_CORPSE_NOTIFY

Application Specific Information:
/usr/lib/libcrypto.dylib
abort() called
Invalid dylib load. Clients should not load the unversioned libcrypto dylib as it does not have a stable ABI.
```

### Environment

* Python version: 3.7.4
* Flask version: 1.1.1
* Werkzeug version: 0.15.5

Really groundbreaking stuff here, noticed this when I was glancing at the logging source.  Just a simple typo fix.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### How to reproduce

 * Have flask installed
 * Open up a terminal in an empty folder
 * run `set FLASK_DEBUG=1 && flask run` (yep, its windows)

### Expected Behavior
Flask should attempt to start in debug mode, should fail with `Error: Failed to find Flask application or factory in module "app". Use "FLASK_APP=app:name to specify one.` or if you have a valid app in the folder it should start normally in debug mode. Should not fail with `No module named C:\programs\Python37\Scripts\flask`

### Actual Behavior
Flask fails earlier, with message: `No module named C:\programs\Python37\Scripts\flask`

### Console dump

```
C:\workspace\aliz\temp\flaskbug>set FLASK_DEBUG=1 && flask run
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: on
 * Restarting with stat
c:\programs\python37\python.exe: No module named C:\programs\Python37\Scripts\flask
```

### Environment

```
C:\workspace\aliz\temp\flaskbug>python --version
Python 3.7.4

C:\workspace\aliz\temp\flaskbug>python -m pip show flask
Name: Flask
Version: 1.1.1
...

C:\workspace\aliz\temp\flaskbug>python -m pip show Werkzeug
Name: Werkzeug
Version: 0.15.5
...

C:\workspace\aliz\temp\flaskbug>python -c "import platform;print(platform.python_version(), platform.architecture())"
3.7.4 ('64bit', 'WindowsPE')
```

Hello,

I am submitting a form to insert data in my oracle-database.
Because I don't want to reload the page when submitting the form I am calling a js-function.

Here is my submit-button:
`<button class="btn btn-primary mt-3" type="button" onclick="createSubmit()">Speichern</button>`

The js-function called by the button:
```
function createSubmit() {
    var shortcode = document.getElementById("shortcode").value;
    var product = document.getElementById("productInput-hidden").value;
    var serialnumber = document.getElementById("serialnumber").value;
    var status = document.getElementById("statusInput-hidden").value;
    var user = document.getElementById("userInput-hidden").value;
    var acquireddate = document.getElementById("acquireddate").value;
    var installdate = document.getElementById("installdate").value;
    var remarks = document.getElementById("remarks").value;

    req = $.ajax({
        url : "/create_submit",
        type : "POST",
        data : { shortcode : shortcode, product : product, serialnumber : serialnumber, status : status, user : user, acquireddate : acquireddate, installdate : installdate, remarks : remarks }
    });
}
```

And here we got the route:
```
@bp.route('/create_submit', methods=['POST'])
@login_required
def create_submit():
    error = None
    short_code = request.form['shortcode']
    product = request.form['product']
    serial_number = request.form['serialnumber']
    status = request.form['status']
    user = request.form['user']
    acquired_date = request.form['acquireddate']
    date_installed = request.form['installdate']
    remarks = request.form['remarks']

    try:
        new = Items(short_code, remarks, short_code, '38', acquired_date, date_installed, product, serial_number,
                    status, '1', user, g.user[1])
        new.post()
    except:
        error = 'Request Fehler'
        new = False

    if new is not False:
        if new.r_status_code == 201:
            flash('Asset angelegt', 'success')
        elif new.r_status_code is not None:
            error = 'API Fehler'
        else:
            error = 'Keine Antwort'
    else:
        error = 'Objekt Fehler'

    if error is not None:
        flash(error, 'error')

    return jsonify({'result' : 'success'})
```

In general the mechanism is working corret, but the flash-messages generated by /create_submit are not showing immediately. The show up after a page refresh.
I think this happens because I am using ajax to call /create_submit and the return is not correct.

Is there a way to get the flash-messages to show immediately?

### Environment

* Python version: 3.7.3
* Flask version: 1.0.3
* Werkzeug version: 0.15.4

### Description
Uploaded image is not saved and when redirected to my template.html, broken image is shown for my html.

I am uploading image in flask. If Flask is used individually, upload is okay. But when integrating with Connexion[Swagger-UI], I did not have the expected results. The flow of my upload is in 1 python file. And I have 2 html files for the upload and display of image. I am sure that my configurations in swagger.yml is incorrect that is why I am not getting the results I'm expecting.


### Expected behaviour
Expectation: when /api/read is accessed, upload.html will be shown. select image to upload. after pressing 'Upload' button, will be redirected to template.html where will I see the image I uploaded.


### Actual behaviour
Actual: when accessing /api/read, redirected to upload.html and after pressing Upload button, I'll be redirected to template.html but the image is broken and image is not saved to my UPLOAD_FOLDER. This is shown in flask console:
```
172.28.59.117 - - [07/Aug/2019 16:51:08] "GET /api/read HTTP/1.1" 200 -
172.28.59.117 - - [07/Aug/2019 16:51:13] "POST /api/read HTTP/1.1" 200 -
172.28.59.117 - - [07/Aug/2019 16:51:13] "GET /api/read?filename= HTTP/1.1" 200 -
172.28.59.117 - - [07/Aug/2019 16:51:17] "GET /api/read?filename= HTTP/1.1" 200 -
```

Sometimes, error is like this:
```
TypeError: uploaded_file() missing 1 required positional argument: 'filename'
```

### Additional info:
upload.py
```
import os
from flask import Flask, request, redirect, url_for, send_from_directory, render_template
from werkzeug.utils import secure_filename
from app import application
import connexion
import logging

UPLOAD_FOLDER = '/root/trial/server/uploads/'
ALLOWED_EXTENSIONS = set(['txt', 'pdf', 'png', 'jpg', 'jpeg', 'gif'])

def allowed_file(filename):
    return '.' in filename and \
       filename.rsplit('.', 1)[1] in ALLOWED_EXTENSIONS

#@application.route('/', methods=['GET', 'POST'])

def landing_page():
  return render_template('upload.html')

def upload_file():
    if request.method == 'POST':
        global filename
        global file
        file = request.files['file']
        if file and allowed_file(file.filename):
            filename = secure_filename(file.filename)
            file.save(os.path.join(application.config['UPLOAD_FOLDER'], filename))
            return redirect(url_for('uploaded_file', filename=filename))
    return render_template('upload.html')

#@application.route('/show/<filename>')
def uploaded_file():
    #filename = 'http://127.0.0.1:5000/uploads/' + filename
    return render_template('template.html')

#@application.route('/uploads/<filename>')
def send_file(filename):
    return send_from_directory(UPLOAD_FOLDER, filename)

#@application.route('/')
def api_root():
    return 'Welcome'

if __name__ == '__main__':
    app.run()
```

swagger.yml
```
info:
  description: This is the swagger file that goes with our server code
  version: "1.0.0"
  title: Swagger REST Article
consumes:
  - "application/json"
produces:
  - "application/json"

basePath: "/api"

# Paths supported by the server application
paths:
  /read:
     get:
       operationId: "views.upload.upload_file"
       consumes: ["multipart/form-data"]
       produces: ["text/html"]
       tags:
         - "Upload"
       summary: "Uploads a file"
       parameters: [{
            name: file,
            required: false,
            in: formData,
            type: file
        }]
       description: "Uploads a file"
       responses:
         200:
           description: "Info Success!"
     post:
       operationId: "views.upload.uploaded_file"
       consumes: ["application/octet-stream"]
       produces: ["text/html"]
       tags:
         - "Upload"
       summary: "Uploads a file"
       description: "Uploads a file"
       responses:
         201:
           description: "OK"
           schema:
             type: string
             format: binary
     put:
       operationId: "views.upload.send_file"
       consumes: ["application/octet-stream"]
       produces: ["text/html"]
       tags:
         - "Upload"
       summary: "Save file"
       description: "Save file"
       responses:
         202:
           description: "Success upload"
           schema:
             type: string
             format: binary
```

template.html (snippet)
```
<img class="annotatable" id="ptolemy" src="{{url_for('/api.views_upload_send_file',filename=filename)}}" class="annotatable">
```
While inappropriate for a production public webserver, for certain
use-cases, the embedded Werkzeug server is perfectly acceptable and useful.
However, we might not want the messages cluttering up the console output.

This adds an environment variable knob that can be used to silence the
startup output. Set "FLASK_SILENCE_STARTUP" = "true" and the messages
will be skipped.

In an earlier attempt, I tried using the WERKZEUG_RUN_MAIN knob, but it has
other side-effects in Werkzeug and thus was unsuitable. The new knob _only_
has the effect of silencing the messages.

In our use-case, a "real" webserver is inappropriate as Flask is being used to add a REST-style interface to real-time data-analysis program in order to support internal messaging between parts. During the running of this program, some 20+ processes get spawned, with their own Flask interfaces, and in the system, several other related programs run with Flask app interfaces. This is basically being used only for internal messaging in an isolated system as such the reason to not use the embedded server in a "production" system is moot, and the embedded Werkzeug server is perfect for our case. However, the spawning of lots of Flask processes clutters up the startup log of the system making it unpleasant to try to find the actual messages we need to see.

We're using the 1.0.x branch and if this is deemed acceptable, I'll pull-request the same change for 1.0.x and 1.1.x if desired.
Do  No  Close the Issues!!!!!!!!!!  

if you add both post  and  get in the same flask , and get first then the next post request will not response !!!!!



```python
from flask import Flask,jsonify,request


class myWeb():
    def __init__(self,st):

        self.st = st
        self.flask = Flask("web_test")
        self.flask.add_url_rule('/stinfo',view_func=self.get_student_info)


        self.flask.add_url_rule('/alive',view_func=self.receive_test,methods=["POST"])

    def get_student_info(self):
        return jsonify(self.st)

    def receive_test(self):
        if request.method == "POST":
            print(request.json)
            return jsonify(self.st)

    def web_run(self):
        self.flask.run(host='10.61.96.171')



if __name__ == '__main__':
    st = dict()
    st['test'] = 1
    mw = myWeb(st)
    s = mw.web_run()
```
Using packaging.version to check whether the version is dev version.

resolve #3320 
### Scenario

As of v1.1.1.

1. Navigate to the Flask docs via the Pallets Project site.
2. Progress to [Tutorial :: Keep Developing!](https://flask.palletsprojects.com/en/1.1.x/tutorial/next/)
3. Follow the link to [example project](https://github.com/pallets/flask/tree/1.1.2.dev0/examples/tutorial)

### Expected Behavior

The version tag in the link matches the documentation version tag, and/or the target URL leads somewhere useful.

### Actual Behavior

Link target version is not the same as the doc version, and it refers to a development version that has not yet been tagged (404).

### Environment

N/A


### Expected Behavior
I need to stream data the Flask server to another external API. For this I'm using the request object from Flash with stream argument.

```python
from flask import request, Response

@blueprint.route("/upload3", methods=["POST"])
def upload3():
    resp = requests.post(
                    url,
                    data=request.stream,
                    auth=auth,
                    verify=False,
                    stream=True)
    return Response(status=200)
```

### Actual Behavior
It works properly when the client and Flask server are on the same network but it doesn't work when not.
client -> Flask server -> external API
Here the result on the same network
https://photos.app.goo.gl/wzRvN667791NxQhXA

Here the trouble : The server wait all incoming data before sending it to the other server. But we can see that the connection is already opend.
I can also see the python process eating the RAM memory corresponding to the data size.
https://photos.app.goo.gl/EAWPvSL4CCBZURKb6
https://photos.app.goo.gl/EGSnFU6fLHAwgPB46


### Environment

* Python version:3.6
* Flask version:1.0.3
* Werkzeug version:0.15.4```

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
Default digest_method for SecureCookieSessionInterface should be provide strong collision resistance.  Ideally, upgrade default to sha-256 or better.

```python
class SecureCookieSessionInterface(SessionInterface):
    """The default session interface that stores sessions in signed cookies
    through the :mod:`itsdangerous` module.
    """
    #: the salt that should be applied on top of the secret key for the
    #: signing of cookie based sessions.
    salt = 'cookie-session'
    #: the hash function to use for the signature.  The default is sha1
    digest_method = staticmethod(hashlib.sha1)
```

### Actual Behavior
hashlib.sha1 is default and must be overridden by a custom SessionInterface in applications using flask.  It would be more secure to default to a stronger hash algorithm.

```python
class CustomSecureCookieSessionInterface(SecureCookieSessionInterface):
    """"
    Custom override of flask.sessions.SecureCookieSessionInterface to use
    sha256 rather than sha1 for session signatures.
    """"
    digest_method = staticmethod(hashlib.sha256)```

app.session_interface = CustomSecureCookieSessionInterface()
### Environment

* Python version: 2, 3
* Flask version: all
* Werkzeug version: n/a

Remove the duplicate word 'automatically' from the sentence:
> They can automatically inject values into a call for :func:`~flask.url_for` automatically.

### Expected Behavior
The bot value should be filled with the current subdomain.
```python
@app.route('/', subdomain='<bot>')
def index(bot):
    return bot  # Or do something else
```

### Actual Behavior
The value is not filled, it is just an empty string.
This also happens if inside a blueprint:
```python
bp = Blueprint('foo', __name__, subdomain='<bot>')
@bp.route('/')
def my_route(bot):
    return bot  # Or do something else
```
```pytb
N/A
```

### Environment

* Python version: 3.6.6
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

*Yes, nginx and my DNS are configured correctly*

it is now required that Werkzeug >= 0.15
it is now required Werkzeug >= 0.15
### Expected Behavior
Should be able to run flask with FLASK_ENV=development or production

### Actual Behavior
I get the output
 * Serving Flask app "simple" (lazy loading)
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: on
 * Restarting with stat
c:\users\Riprock\Projects\simple s&r\venv\scripts\python.exe: No module named C:\Users\Riprock\Projects\Simple S&R\venv\Scripts\flask


### Environment

* Python version: 3.7.4
* Flask version: 1.1.1
* Werkzeug version:  0.15.5

I can't seem to get a flask server running after updating to the latest version of Flask and python. Before the update my FLASK_ENV=development and FLASK_DEBUG=1. Then I updated and started to encounter the error. I tried rebuilding my venv and getting the same error.

This paragraph: 

> But how do you run your application now? The naive `python yourapplication/__init__.py` will not work. Let’s just say that Python does not want modules in packages to be the startup file.

could be summarized as:

> You can't do that, and we won't explain why; just trust us.

In lieu of actually explaining, a link to the Python docs that actually do explain what's going on here seems in order.
### Expected Behavior
I think that the documentation for mocking request contexts in Flask 1.1.x might be a bit off. I'm filing an issue instead of submitting a pull request in case there is something about my configuration that doesn't fit the target audience of the documentation. 

The docs say that in order to mock a request context, you should use the `with` functionality as such: 

```python
with app.test_request_context(
        '/make_report/2017', data={'format': 'short'}):
    generate_report()
```

### Actual Behavior
In order to actually gain access to the request context, I has to insert as `as` with the `with`
```python
with app.test_request_context(
        '/make_report/2017', data={'format': 'short'}) as request:
    generate_report(request)
```

It's not hard to guess, but it seemed like it might be worth updating the docs. 

### Environment

* Python version: 3.7.3
* Flask version: 1.1.1
* Werkzeug version:  0.15.5

Hello! :wave: 

I have a problem in my Flask application. When the "Referer" header field is longer than about 1700 characters in any view, Flask does not perform the redirection but issues a 503 error.

### Actual behavior

```python
# PDB
import requests

headers = {
    {
        'host': 'https://myhost.com',
        'referer': 'https://myhost.com?id_token_hint=asuperlongtokenstrippedoutforconvenience'    
    }
}

requests.get('https://myurl.com', headers=headers)
<Response [503]>
```

```python
# views.py
@app.route('/aview')
def original_view():
    return redirect(url_for('home'))

@app.route('/')
def home():
    return render_template('home.html')
```

The redirection works when the referrer field is shorter than about 1700 characters, I tested it several times. Note that this happens only on staging or on production and never on my dev environment. 

My direction to bypass this problem is to **change the referrer** and then perform the redirection.

But if I change it in original_view, the referrer is still present in the redirected view (home). It does nothing. Example:

```python
# views.py
from flask import request

@app.route('/aview')
def original_view():
    real_request = request._get_current_object()
    real_request.environ['HTTP_REFERER'] = ''
    return redirect(url_for('home'))
```

Doing this, the `request` object is changed in `original_view` but reappears as it was before in `home` with the old referrer still present.

I read that Flask stores WSGI variables in a [local thread](https://flask.palletsprojects.com/en/1.1.x/quickstart/#context-locals) but I did not manage to change it and I don't know if it's even possible. I tried to get the context using `_request_ctx_stack` from `current app` but even if I change the referrer here, it still reappears after the redirection.

Does someone have an idea of what I can do to solve this problem in an elegant way? Thanks in advance!

### Expected Behavior

Perform the redirection without a 503 or delete the referrer.

### Environment

* Python version: 3.6.7 
* Flask version: 0.12.4
* Werkzeug version: 0.11.10

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Now python 3.7 has been added into [tox.ini](https://github.com/pallets/flask/blob/master/tox.ini), but the contributing guide has not been updated yet.
 And i added a missing comma.
<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

### Expected Behavior
When using `flask run` I expect it to use the variables I set in my code.

```python
from flask import Flask

class DevelopmentConfig(object):
    ENV = 'development'
    DEBUG = True

app = Flask(__name__)
app.config.from_object(DevelopmentConfig)

# then using `flask run`
```

### Actual Behavior
It uses the default 'production' enviroment with debug off.

> * Environment: production
>    WARNING: This is a development server. Do not use it in a production deployment.
>    Use a production WSGI server instead.
>  * Debug mode: off
>  * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)

### Environment

* Python version: 3.7.3
* Flask version: 1.0.3
* Werkzeug version: 0.15.4

Yes I realize that in the API documentation it explicitly says this won't work, yet it used to in older version of flask (at least when using app.run()). Perhaps this is more a of feature request?
Related to #2935 but for `g`.

### Expected Behavior

When I use `@copy_current_request_context` it should preserve the contents in `flask.g`.

I would expect that the `g` object is transparent to whether I'm in a normal request context, or one that has been copied using the `copy_current_request_context` decorator in another greenlet.

I borrowed the very nice test-script from #2935 and adapted it for `g` instead.

```python
import concurrent.futures
import random

from flask import Flask, g, copy_current_request_context, request, session

app = Flask(__name__)
app.config['SECRET_KEY'] = 'test'
executor = concurrent.futures.ThreadPoolExecutor()

@app.route('/')
def session_context():
    test_value = random.randint(1, 1001)
    g.test_value = test_value

    original_context = (
        ('g', getattr(g, 'test_value', None))
    )

    @copy_current_request_context
    def debug_session():
        return (
            ('g', getattr(g, 'test_value', None))
        )

    future = executor.submit(debug_session)
    print('original_context:', original_context)
    print('copied_context:', future.result())
    return 'ok'


if __name__ == '__main__':
    client = app.test_client()
    print('### Request ###')
    client.get('/')
```

### Actual Behavior

I get a new empty `g` object in the decorated function.

```
### Request ###
original_context: ('g', 750)
copied_context: ('g', None)
```

### Environment

* Python version: 3.7.3
* Flask version: 1.1.1
* Werkzeug version: 0.15.5


Remove links and descriptions relate to abandoned "Flask Extension
Registry" in the documentation.

resolve #3304

### Expected Behavior
The Flask docs should link to the correct page for the Flask Extension registry, or, if this no longer exists, references to it  should be removed from the docs.

### Actual Behavior
The page about extensions at https://flask.palletsprojects.com/en/1.1.x/extensions/ has a link to http://flask.pocoo.org/extensions/ which redirects to https://palletsprojects.com/p/flask/ This latter page does not contain any info about Flask extensions, nor does it indicate where that might be found.

### Environment

* Flask version: docs to Flask 1.1. Also current docs on master.

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
<!-- Tell us what should happen. -->
After installing flask and implementing tests using pytest I noticed some DepracatedWarnings coming from the default Jinja2 installation that comes with flask (pip install flask), see traceback below for details.

It shouldn't be the case, because it has been fixed already and merged:
https://github.com/pallets/jinja/commit/31bf9b7e71c3fee3b7866ffdc0f70f4525a490d9#diff-be2eb7812ee39a4147506e10763f89c6L13

Yet I can see in site-packages/jinja2/tests.py line:13 "from collections import Mapping" (also in other files under site-packages/jinja2).

Uninstalling jinja2 and reinstalling it via "pip install https://github.com/pallets/jinja/zipball/master" makes those warnings disappear.


Minimal project setup:
```python
(test-collections-warning) ➜  TestCollectionsWarning tree .
.
├── app.py
├── requirements.txt
└── tests
    ├── __init__.py
    └── test_app.py

#app.py
from flask import Flask

flask_app = Flask(__name__)

@flask_app.route('/')
def root():
    return 'Hello world'


#tests/test_app.py
import app

def test_hello_world():
    assert 1 == 1

#requirements.txt
flask
pytest
```

Steps to reproduce:
```python
mkvirtualenv --python=`which python3` test-collections-warning
pip --no-cache-dir install -r requirements.txt
...
(Collecting Jinja2>=2.10.1 (from flask->-r requirements.txt (line 1))
  Downloading https://files.pythonhosted.org/packages/1d/e7/fd8b501e7a6dfe492a433deb7b9d833d39ca74916fa8bc63dd1a4947a671/Jinja2-2.10.1-py2.py3-none-any.whl)
...
pytest
```

### Actual Behavior
<!-- Tell us what happens instead. -->
DeprecationWarnings are shown.

```pytb
(test-collections-warning) ➜  TestCollectionsWarning pytest
================================================= test session starts =================================================
platform darwin -- Python 3.7.3, pytest-5.0.1, py-1.8.0, pluggy-0.12.0
rootdir: /Users/jkozlowicz/PycharmProjects/TestCollectionsWarning
collected 1 item

tests/test_app.py .                                                                                             [100%]

================================================== warnings summary ===================================================
/Users/jkozlowicz/.virtualenvs/test-collections-warning/lib/python3.7/site-packages/jinja2/utils.py:485
  /Users/jkozlowicz/.virtualenvs/test-collections-warning/lib/python3.7/site-packages/jinja2/utils.py:485: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working
    from collections import MutableMapping

/Users/jkozlowicz/.virtualenvs/test-collections-warning/lib/python3.7/site-packages/jinja2/runtime.py:318
  /Users/jkozlowicz/.virtualenvs/test-collections-warning/lib/python3.7/site-packages/jinja2/runtime.py:318: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working
    from collections import Mapping

-- Docs: https://docs.pytest.org/en/latest/warnings.html
```

### Environment

* Python version: 3.7.3
* Flask version: 1.1.1
* Werkzeug version: 0.15.4
* OS: macOS Mojave 10.14.5
* pip: 19.1.1



### Expected Behavior
<!-- Gunicorn does not support the window system, what can be used in the window system instead of the gunicorn deployment -->

```python
# Paste a minimal example that causes the problem.
```

### question
<!-- Gunicorn does not support the window system, what can be used in the window system instead of the gunicorn deployment -->


```pytb
Gunicorn does not support the window system, what can be used in the window system instead of the gunicorn deployment
```

### Environment

* Python version: python3.5
* Flask version:
* system version:window 10

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
<!-- Tell us what should happen. -->

```python
# Paste a minimal example that causes the problem.
```

### Actual Behavior
<!-- Tell us what happens instead. -->

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version:
* Flask version:
* Werkzeug version:

I just found out that there is a newer page for documentation after strolling around on flask.pocoo.org for quite a while 🙈 I think there should be some more links on pocoo.org to the newer docs so that people don't accidentally read outdated stuff. Maybe someone also has ideas how to improve search engine stuff since pallets flask docs seem to be really hard to find right now.

### Expected Behavior
<!-- Tell us what should happen. -->

Searching for "flask documentation" on google.com or duckduckgo.com, https://flask.palletsprojects.com/en/1.1.x/ should be listed higher up, but at least the documentation on http://flask.pocoo.org/docs/1.0/ should have links to the newer documentation.

### Actual Behavior
<!-- Tell us what happens instead. -->

Pallets documentation is hard to find and the only link from Pocoo to Pallets seems to be on http://www.pocoo.org/ itself.
closes #3297 

Can be removed when pallets/click#536 is fixed.

The documentation for [uploading files](`docs/patterns/fileuploads.rst`) was not working due to an incorrect function name. 

I also changed the `file` variable to something _"less"_ reserved, even though it's not officially a reserved keyword, I don't agree it's good practice using it

![企业微信截图_f4c6df24-39ee-40d7-9bc6-dcd6b60a2469](https://user-images.githubusercontent.com/37997057/60977048-584b5d00-a361-11e9-8a3e-29a183deb1e5.png)

![E38F8C81-7897-4A0A-B2A9-877517931A5C](https://user-images.githubusercontent.com/37997057/60977073-6305f200-a361-11e9-84b5-8724f2e20675.png)


when FLASK_DEBUG set to 1
debugger will report 

   No module named flask.flask

error


when i revert back flask version to 1.0.4, the error disappear.
I think this error is related new version. 
please fix it, thank you.

### Environment

* Python version: 3.7.2
* Flask version: 1.1.0


I made a test code for this issue. I made a custom class because I want server to return jsonified list if view function returns list. It works on flask 1.0.2 but it doesn't work on the new flask version (1.1.1)

```python
from flask import Flask, Response, jsonify


class CustomResponse(Response):
    @classmethod
    def force_type(cls, response, environ=None):
        if isinstance(response, list):
            return jsonify(response)
        return super(CustomResponse, cls).force_type(response, environ)


app = Flask(__name__)
app.response_class = CustomResponse


@app.route('/', methods=['GET'])
def response_list():
    return ['it', 'is', 'test']


if __name__ == '__main__':
    app.run(host='127.0.0.1')

```

On 1.0.2 version, 

```python
# evaluate a WSGI callable, or coerce a different response
                # class to the correct type
                try:
                    rv = self.response_class.force_type(rv, request.environ)
                except TypeError as e:
                    new_error = TypeError(
                        '{e}\nThe view function did not return a valid'
                        ' response. The return type must be a string, tuple,'
                        ' Response instance, or WSGI callable, but it was a'
                        ' {rv.__class__.__name__}.'.format(e=e, rv=rv)
                    )
```

flask changes type forcely by calling force_type of `response_class`, but newest version doesn't change. (code below)

```python
            if isinstance(rv, (text_type, bytes, bytearray)):
                # let the response class set the status and headers instead of
                # waiting to do it manually, so that the class can handle any
                # special logic
                rv = self.response_class(rv, status=status, headers=headers)
                status = headers = None
            elif isinstance(rv, dict):
                rv = jsonify(rv)
            elif isinstance(rv, BaseResponse) or callable(rv):
                # evaluate a WSGI callable, or coerce a different response
                # class to the correct type
                try:
                    rv = self.response_class.force_type(rv, request.environ)
                except TypeError as e:
                    new_error = TypeError(
                        "{e}\nThe view function did not return a valid"
                        " response. The return type must be a string, dict, tuple,"
                        " Response instance, or WSGI callable, but it was a"
                        " {rv.__class__.__name__}.".format(e=e, rv=rv)
                    )
                    reraise(TypeError, new_error, sys.exc_info()[2])
            else:
                raise TypeError(
                    "The view function did not return a valid"
                    " response. The return type must be a string, dict, tuple,"
                    " Response instance, or WSGI callable, but it was a"
                    " {rv.__class__.__name__}.".format(rv=rv)
                )
```

Is it intended or just a bug?

### Expected

When I call `127.0.0.1:5000`, 

```
['it', 'is', 'test']
```

### Actual
```
[2019-07-10 16:36:33,554] ERROR in app: Exception on / [GET]
Traceback (most recent call last):
  File "C:\Users\Mapia\Desktop\develop\study\flask.py\venv\lib\site-packages\flask\app.py", line 2446, in wsgi_app
    response = self.full_dispatch_request()
  File "C:\Users\Mapia\Desktop\develop\study\flask.py\venv\lib\site-packages\flask\app.py", line 1952, in full_dispatch_request
    return self.finalize_request(rv)
  File "C:\Users\Mapia\Desktop\develop\study\flask.py\venv\lib\site-packages\flask\app.py", line 1967, in finalize_request
    response = self.make_response(rv)
  File "C:\Users\Mapia\Desktop\develop\study\flask.py\venv\lib\site-packages\flask\app.py", line 2130, in make_response
    " {rv.__class__.__name__}.".format(rv=rv)
TypeError: The view function did not return a valid response. The return type must be a string, dict, tuple, Response instance, or WSGI callable, but it was a list.
127.0.0.1 - - [10/Jul/2019 16:36:33] "GET / HTTP/1.1" 500 -
```


### Environment

* Python version: 3.7.3
* Flask version: 1.1.1
* Werkzeug version: 0.15.4

Previously flask (v1.0.3) was passing `sys.argv` to  `cli.main`:

https://github.com/pallets/flask/blob/1.0.3/flask/cli.py#L889-L906

Now flask (v1.1.1) is not passing `argv`, to `cli.main`.

https://github.com/pallets/flask/blob/1.1.1/src/flask/cli.py#L965-L966

This causes it to always get args via `get_os_args` via `click`. 

https://github.com/pallets/click/blob/7.0/click/core.py#L700-L704 

Which is this issue in click https://github.com/pallets/click/issues/536 

This basically breaks debugging (on windows with python 2.7), where the debugger re-writes `sys.argv` before `click` or `flask` is loaded. So, attempting to debug flask using `ptvsd` or `pydevd` results in the error message below. 

### Expected
```
>python -m ptvsd --host localhost --port 5692 -m flask run --no-debugger --no-reload --with-threads --port 5014
 * Serving Flask app "app"
 * Environment: development
 * Debug mode: on
 * Running on http://127.0.0.1:5014/ (Press CTRL+C to quit)
```

### Actual
```
>python -m ptvsd --host localhost --port 5692 -m flask run --no-debugger --no-reload --with-threads --port 5014
Usage: python -m flask [OPTIONS] COMMAND [ARGS]...
Try "python -m flask --help" for help.

Error: no such option: --host
```

### Environment

* Python version: 2.7
* Flask version: 1.1.1
* Werkzeug version: N/A
* Platform: Windows


`flask.json_available` was removed because it was marked deprecated in the code and doesn't do anything. `flask.json` is always available, and libaries that weren't sure about that should have used `try/except ImportError` while it was relevant. However, since a few dormant but popular extensions use it, it's added back in for now.

Anything doing `if json_available` or `if json_available == True`, such as Flask-Testing and Flask-DebugToolbar, will show a `DeprecationWarning`. `is` can't be overridden, so that won't show a warning, but I don't think things that were using this flag did that.

I've marked it for removal in 2.0.0, which will be a pretty big change anyway. Please reach out to extensions you use if you see this warning and offer to help maintain it if it's an extension you want to continue using as Flask moves forward.

closes #3288 
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

Since #3214 I am no longer able to use a custom Response class to catch and format internal objects.

Is there a more appropriate way to accomplish the same thing now that 1.1.0 is being picked up in my CI env?

### Expected Behavior
<!-- Tell us what should happen. -->

```python
from flask import Flask, Response, Blueprint                                    
import json                                                                     
                                                                                
class BizModel():                                                               
    def __init__(self, name):                                                   
        self.name = name                                                        
    def to_jsonable(self):                                                      
        return {"name": self.name}                                              
                                                                                
class BizResponse(Response):                                                    
    @classmethod                                                                
    def force_type(cls, rv, environ=None):                                      
        if isinstance(rv, BizModel):                                            
            return Response(json.dumps(rv.to_jsonable(), indent=4), mimetype='application/json', status=200)
        return super(BizResponse, cls).force_type(rv, environ)                  
                                                                                
app = Flask(__name__)                                                           
app.response_class = BizResponse                                                
                                                                                
@app.route('/biz')                                                              
def showbiz():                                                                  
    return BizModel('showbiz')                                                  
                                                                                
if __name__ == "__main__":                                                      
    test = app.test_client()                                                    
    r = test.get('/biz')                                                        
    assert r.is_json                                                            
    assert r.json['name'] == 'showbiz'
```

### Actual Behavior
<!-- Tell us what happens instead. -->

```pytb
[2019-07-08 12:24:58,237] ERROR in app: Exception on /biz [GET]
Traceback (most recent call last):
  File "/private/tmp/py3venv/lib/python3.7/site-packages/Flask-1.1.0-py3.7.egg/flask/app.py", line 2446, in wsgi_app
    response = self.full_dispatch_request()
  File "/private/tmp/py3venv/lib/python3.7/site-packages/Flask-1.1.0-py3.7.egg/flask/app.py", line 1952, in full_dispatch_request
    return self.finalize_request(rv)
  File "/private/tmp/py3venv/lib/python3.7/site-packages/Flask-1.1.0-py3.7.egg/flask/app.py", line 1967, in finalize_request
    response = self.make_response(rv)
  File "/private/tmp/py3venv/lib/python3.7/site-packages/Flask-1.1.0-py3.7.egg/flask/app.py", line 2130, in make_response
    " {rv.__class__.__name__}.".format(rv=rv)
TypeError: The view function did not return a valid response. The return type must be a string, dict, tuple, Response instance, or WSGI callable, but it was a BizModel.                                                                                                                     
Traceback (most recent call last):
  File "./flask3214.py", line 28, in <module>
    assert r.is_json
AssertionError
```

### Environment

* Python version: 3.7.2
* Flask version: 1.1.0
* Werkzeug version: 0.15.4

The comments are now visible only to the issue creator and do not need to be manually removed before submitting the issue.
### Expected Behavior

The selected command should be available in the application factory provided to the click integration.

I recently started adding instrumentation to an application, however when I run most CLI commands I don't want to trigger the instrumentation to be initialized. However by the time I gain access to the application it's too late to turn it off (things have been mucked with and monkeypatched, etc). It seems like the easiest thing to do is allow the selected command to be considered when running the application factory so the factory can make informed decisions about what should/shouldn't be initialized during application setup based on what I'm attempting to do.

There is the possibility of doing various things such as:

- adding a `--no-trace` flag to the top level command
- using a custom configuration when executing CLI commands _other_ than run
- probably some other gross things

I managed to work around this not being available out of the box by adding the following to a custom flask group (something we were already using):

```python
def get_command(self, ctx, name):
    # arguably belongs on ScriptInfo.data instead of just shoving it on there
    ctx.ensure_object(ScriptInfo).command = name
    super().get_command(ctx, name)
```

### Actual Behavior

Unless I'm missing something, it's not available through vanilla means.

### Environment

* Python version: 3.7
* Flask version: 1.0.2
* Werkzeug version: 0.14.1
* Click version: 6.7
### Expected Behavior

json_available should be available

```python
from flask import json_available
```

### Actual Behavior

```pytb
ImportError: cannot import name 'json_available'
```

### Environment

* Python version: 3.7.3
* Flask version: 1.1.0
* Werkzeug version: 0.15.4

---

### Expected Behavior
Catching an exception type in an error handler and raising another exception type breaks the flask app instead of passing control to the corresponding error handler.

Given the following `flask` application:
```
from flask import Flask, jsonify
from werkzeug.exceptions import BadRequest, HTTPException

class CustomAppException(Exception):
    pass

class AppFactory(object):
    def create(self):
        app = Flask(__name__)

        @app.errorhandler(HTTPException)
        def handle_generic_http_exceptions(e):
            return jsonify({
                "error": str(e)
            }), e.code

        @app.errorhandler(CustomAppException)
        def unhandled_meteor_errors(e):
            raise BadRequest(str(e))

        @app.route("/")
        def raise_error_endpoint():
            msg = 'some bad msg'
            raise CustomAppException(msg)

        return app
```
A get request to the endpoint `/` should show the following response: 
```
{
"error": "400 Bad Request: some bad msg"
}
```

### Actual Behavior

Instead it gives this response: 
```
{
"error": "500 Internal Server Error: The server encountered an internal error and was unable to complete your request. Either the server is overloaded or there is an error in the application."
}
```

### Environment
* Python version: 3.7.3
* Flask version: 1.1.0
* Werkzeug version: 0.15.4

```
$ pip freeze
atomicwrites==1.3.0
attrs==19.1.0
certifi==2019.6.16
Click==7.0
Flask==1.1.0
importlib-metadata==0.18
itsdangerous==1.1.0
Jinja2==2.10.1
MarkupSafe==1.1.1
more-itertools==7.1.0
packaging==19.0
pluggy==0.12.0
py==1.8.0
pyparsing==2.4.0
pytest==5.0.1
six==1.12.0
wcwidth==0.1.7
Werkzeug==0.15.4
zipp==0.5.1
```

This is not broken in `Flask 1.0.3`.  Here's the [repo](https://github.com/ArshanKhanifar/flask_bug_demonstration.git) that tests this. 



It was printed to stdout, which broke custom flask subcommands whose output was consumed by scripts (which might expect json or something else that's not just text).
Adds a warning for #3282 when config for the `"flask.app"` or `"flask"` loggers is found and the logger for `app.name` *isn't* configured.

> UserWarning: 'app.logger' is named 'example' for this application, but configuration was found for 'flask.app', which no longer has an effect. The logging configuration should be moved to 'example'.

closes #3283  
@app.cli.command('initdb')
def initdb_command():
    """Creates the database tables."""
    init_db()
    print('Initialized the database.')

http://flask.pocoo.org/docs/dev/deploying/#deployment

dotCloud [went out of business](http://venturebeat.com/2016/01/22/dotcloud-the-cloud-service-that-gave-birth-to-docker-is-shutting-down-on-february-29/).

Since [Zappa](http://github.com/Miserlou/Zappa) now integrates seamlessly with Flask, I was wondering if you'd be open to the notion of having Zappa as one of the documented deployment options. I'm willing to write the docs myself, but I wanted to confirm the feature before submitting a pull request. I've also already written a [small tutorial](https://gun.io/blog/serverless-microservices-with-zappa-and-flask/) if anybody is interested in learning more.

Thanks! 

Also add a more detailed explanation of how the request context and app
context interact.

Re-open of #1451, but against `master`.

Per #1765. This code already exists in it's own [repo](https://github.com/pocoo/flask-ext-migrate), this PR removes the script from the Flask source.

EDIT: Fix #1765

This moved to its own repo: [pocoo/flask-ext-migrate](https://github.com/pocoo/flask-ext-migrate).  It should probably be removed from the Flask repo and the documentation should be updated to mention the migration tool.

Changed repos references: from @mitsuhiko to pallets

Fixes issue #1761 


Hello,

while fuzzing my API, I think I've discovered a Flask issue. The static_file endpoint generate a 500 if the filename include a null byte (`\x00`).

Here is a minimal flask application:

```
from flask import Flask
app = Flask(__name__)


if __name__ == '__main__':
    app.run(debug=True)
```

I've tried launching it with either python 2 (2.7.11) or python 3 interpreter (3.5.1) with flask 0.10.1, then make this request:

```
import requests
requests.get('http://localhost:5000/static/\x00')
```

I get a 500, here is the traceback for python2:

```
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/site-packages/flask/app.py", line 1836, in __call__
    return self.wsgi_app(environ, start_response)
  File "/usr/local/lib/python2.7/site-packages/flask/app.py", line 1820, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/usr/local/lib/python2.7/site-packages/flask/app.py", line 1403, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/usr/local/lib/python2.7/site-packages/flask/app.py", line 1817, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/lib/python2.7/site-packages/flask/app.py", line 1477, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/lib/python2.7/site-packages/flask/app.py", line 1381, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/usr/local/lib/python2.7/site-packages/flask/app.py", line 1475, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/lib/python2.7/site-packages/flask/app.py", line 1461, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/usr/local/lib/python2.7/site-packages/flask/helpers.py", line 823, in send_static_file
    cache_timeout=cache_timeout)
  File "/usr/local/lib/python2.7/site-packages/flask/helpers.py", line 613, in send_from_directory
    if not os.path.isfile(filename):
  File "/usr/local/Cellar/python/2.7.11/Frameworks/Python.framework/Versions/2.7/lib/python2.7/genericpath.py", line 37, in isfile
    st = os.stat(path)
TypeError: must be encoded string without NULL bytes, not unicode
```

And here is the traceback for python 3:

```
Traceback (most recent call last):
  File "/usr/local/lib/python3.5/site-packages/flask/app.py", line 1836, in __call__
    return self.wsgi_app(environ, start_response)
  File "/usr/local/lib/python3.5/site-packages/flask/app.py", line 1820, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/usr/local/lib/python3.5/site-packages/flask/app.py", line 1403, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/usr/local/lib/python3.5/site-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "/usr/local/lib/python3.5/site-packages/flask/app.py", line 1817, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/lib/python3.5/site-packages/flask/app.py", line 1477, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/lib/python3.5/site-packages/flask/app.py", line 1381, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/usr/local/lib/python3.5/site-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "/usr/local/lib/python3.5/site-packages/flask/app.py", line 1475, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/lib/python3.5/site-packages/flask/app.py", line 1461, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/usr/local/lib/python3.5/site-packages/flask/helpers.py", line 823, in send_static_file
    cache_timeout=cache_timeout)
  File "/usr/local/lib/python3.5/site-packages/flask/helpers.py", line 613, in send_from_directory
    if not os.path.isfile(filename):
  File "/usr/local/Cellar/python3/3.5.1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/genericpath.py", line 30, in isfile
    st = os.stat(path)
ValueError: embedded null byte
```

The error is not exactly the same but isfile doesn't seems to love null bytes.

I've tried to fix it locally by adding this piece of code to detect null bytes in `send_static_file` (https://github.com/mitsuhiko/flask/blob/master/flask/helpers.py#L862):

```
if '\x00' in filename:
     raise RuntimeError("Null byte")
```

It seems to works with both python2 and python3, but I'm not sure what is the best response when the request include a null byte.

Here is the output of pip freeze if necessary:

```
Flask==0.10.1
itsdangerous==0.24
Jinja2==2.8
MarkupSafe==0.23
Werkzeug==0.11.5
```

I only tried on Mac OS X 10.11.4, I don't know if null byte are accepted in valid filename on other filesystems.

The setup.cfg declares the ability to compile a wheel, but release process isn't actually compiling a wheel.


I think it's supposed to be an upper-case 'F'. Cheers :)

Is there a way to design blueprints to incorporate DELETE?

I've been getting a error for a long time because I want to implement a form button action to just do a basic delete functionality for my app.

```
Method Not Allowed

The method is not allowed for the requested URL.
```

This is what my method looks like and nothing seems to be working...

```
@mod.route('/region/<region_id>', methods=['DELETE'])
def delete_region(region_id):
```

It seems as if Flask only does GET and POST not DELETE or PUT... And my only alternative is to do GET based DELETE methods as an alternative workaround... this however when logging proves to be not the best way to display my data and how it is modified or accessed. Any advice here? Thanks a bunch.

Also, I'm not making an API ... I just want to make a link to delete one specific entry.

```
GET based DELETE

@mod.route('/region/<region_id>/delete', methods=['GET'])
def delete_region(region_id):

```

References:
https://www.reddit.com/r/flask/comments/2ax1mf/af_delete_example/

I did this-- `if __name__ == '__main__':
    app.run(host='0.0.0.0',port='80')`

but i get Permission denied error... couldn't find anything in the documentation. Is there any other way to accomplish this? It was relatively easier to do this in  django.
Thanks!

I think it is awkward. Though semicolon can be used as a kind of supercomma, this sentence is not that kine of thing. Replacing it with comma would be more better. isn't it?

remove ;

All the converters are from werkzeug's builtin converters.

Documentation: http://werkzeug.pocoo.org/docs/dev/routing/#builtin-converters

i want to under the commit


Just a subject verb mismatch.

I was surprised to see that though flask.json.JSONEncoder accepts datetime objects, it ignores the timezone. I checked werkzeug.http.http_date and it can handle timezone aware dates just fine if they are passed in, but the JSONEncoder insists on transforming the datetime to a timetuple, like this

 `return http_date(o.timetuple())`

This means i have to convert all my dates to utc before encoding them, otherwise I should overwrite the dafault() method in the encoder. Can you help me understand why the encoder was made to function with naive dates only?
Thx

validators.Required() is marked as deprecated in favor of validators.DataRequired() and will be remove in WTForms 3.


the session['username'] isn't cleared when I close the program and then run the program.
I want to clear the session when I close the program. What shoud I do?

E.g:
http://flask.pocoo.org/docs/0.10/quickstart/#sessions


I have a fairly straightforward project scaffolded out that looks like 

```
my_app/
    my_app/
        __init__.py
        models.py
        mod1/
        mod2/
    instance/
        config.py
    config.py
    setup.py
```

I installed this as a package to a virtualenv with `setup.py develop`.  My `__init__.py` looks like:

```
from flask import Flask
from flask.ext.sqlalchemy import SQLAlchemy

app = Flask(__name__, instance_relative_config=True)
app.config.from_pyfile('config.py')

db = SQLAlchemy(app)
```

If I run this file, I get an error `Unable to load configuration file (No such file or directory): '/home/my_app/my_app/instance/config.py'`. Indeed, this is the wrong path; it should be looking in `/home/my_app/instance/config.py`.

The file `models.py` contains only one line of code so far: `from my_app import db`. I can run this without any errors, which is obviously executing all the code in `__init__.py` as well. If I check the value of `Flask.auto_find_instance_path` in this context it has the correct path, unlike above.

Unless I am doing something wrong here, or this is a consequence of `setup.py develop`ing that I'm not understanding -- I believe this is an issue with the `find_package` helper  called by `auto_find_instance_path` . When I run  `__init__.py` directly, `__name__` is set to `__main__`, which causes `find_package` to return `os.getcwd()`. When I run `models.py`, the `__name__` for `__init__.py` is set to `my_app` which causes it to resolve properly via the module name.

This is my first large/packaged Flask project so maybe I'm missing something, but I believe the docs say that your `instance` folder should be next to your main application module, not inside it. If that's the case, why does `find_package` attempt to look in the current working directory? Shouldn't it look in the parent directory?

This is somehow more readable, and improve consistency along the tests (currently there are assert 0/False along with pytest.raises)

make hostname configurable if it defined in the `SERVER_NAME` config

#1740

If the resource from the application's resource folder is encoded in different encoding than locale.getpreferredencoding the UnicodeDecodeError: 'charmap' codec can't decode byte 0x8d in position 217 occures. We should be able to set encoding on open_resource

Python 3.5.1, Flask 0.10.1

I have a problem with loading a utf-8 encoded config file using config.from_pyfile() function.

However,  It raised an following error message.

> UnicodeDecodeError: 'cp949' codec can't decode byte 0xec in position 99: illegal multibyte sequence.

So I add encoding parameter to solve the problem at from_pyfile() function.

> Test Environments;
- OS : MS Window 7 32bit - Korean Edition
- Python 3.5.1
- Flask 0.10.1


## executing this code on Python 2.7.10 [GCC 5.2.1 20151010] on linux2

```
import flask
from MySQLdb import escape_string as thwart
username="abc"

conn = MySQLdb.connect(host="localhost",user="root", passwd="xxxxxxx",db="pythonprogramming")
c       = conn.cursor()
x       = c.execute("SELECT * FROM users WHERE username = (%s)", (thwart(username)))

```

**getting error**
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: must be impossible<bad format char>, not str

**this is MySQL version on my PC**

> +-------------------------+------------------------------+
> | Variable_name                            | Value  
> +-------------------------+------------------------------+
> | innodb_version                          | 5.7.11  
> | protocol_version                        | 10  
> | slave_type_conversions            |  
> | tls_version                                 | TLSv1,TLSv1.1  
> | version                                      | 5.7.11  
> | version_comment                     | MySQL Community Server (GPL) |
> | version_compile_machine        | x86_64  
> | version_compile_os                  | Linux  
> +-------------------------+------------------------------+

I was trying to download the documentation from http://flask.pocoo.org/ using the PDF link and got a 404.  At the same time also tried the zipped HTML link and that returned a 404 as well.

The Docs archive/pdf download url on the website give a 404, but the 404 page looks very nice!!!

I made a public (and open source) Docker image that you can use to build a Python Flask web application.

It has uWSGI for running the application, Nginx to serve HTTP and Supervisord to control them, so you don't have to learn how to install and configure all those to build your Python Flask web app.

It seems like uWSGI with Nginx is one of the more robust (and with great performance) ways to deploy a Python web app. Here are the benchmarks: http://nichol.as/benchmark-of-python-web-servers.

If there was an official Flask Docker image for deployment I would like to use it. But then, if there was an open source performant Docker image that could help deploying an app without having to learn, install and configure uWSGI, Nginx, Supervisord, I would have liked to find it in your docs. 

Now that I built this one, you may want to include it in your docs, maybe as "a third party example" or something. If you think this could be useful, I could submit a PR.

I think it could be in **deploying**: http://flask.pocoo.org/docs/0.10/deploying/
Or in snippet category **deployment**: http://flask.pocoo.org/snippets/category/deployment/

There are even some template projects you can use to bootstrap your own. And also, you don't have to clone the full project or something, you can just use it as a base image.

Docker Hub: https://hub.docker.com/r/tiangolo/uwsgi-nginx-flask/
GitHub: https://github.com/tiangolo/uwsgi-nginx-flask-docker

Please see https://docs.python.org/2/distutils/sourcedist.html#commands for reference.

I'm not sure there is a kind of convention in url_prefix for registering blueprint. If not, It behaves weird. 
I'd made cs-log app and register it on app.py like this.

```
app.register_blueprint(
  inventory_views.blueprint,
  url_prefix='/v1/<project_uuid>/<app_name>/inventory-info')
app.register_blueprint(
  custom_query_views.blueprint,
  url_prefix='/v1/<project_uuid>/<app_name>/custom_query')
app.register_blueprint(
  cs_log_views.blueprint,
  url_prefix='/v1/<project_uuid>/<app_name>/cs-log')
```

and try to approach to cs-log, flask give me a 404 error. After a few of try to fixing it, I've changed an order of registering like this.

```
app.register_blueprint(
  inventory_views.blueprint,
  url_prefix='/v1/<project_uuid>/<app_name>/inventory-info')
app.register_blueprint(
  cs_log_views.blueprint,
  url_prefix='/v1/<project_uuid>/<app_name>/cs-log')
app.register_blueprint(
  custom_query_views.blueprint,
  url_prefix='/v1/<project_uuid>/<app_name>/custom_query')
```

then it works I expected. Did I miss something? I think underbar in url_prefix of customer_query_views affect to url_prefix with hyphen. 

If something can't understand in my article, reply me.

If I try to feed a string into jsonify, I get the following error:

ValueError: dictionary update sequence element #0 has length 1; 2 is required

I imagine this is intentional... perhaps it's related to the same problem described in issue #170 ?

Make safe_join behave like os.path.join, which accept multiple path components with *args.
Note that only the ``directory'' 's bound is respected and the path components are only joined together.

It could be useful to create an IPython shell in an application context, since IPython has several features a normal Python shell lacks, like autocompletion.

This patch adds support for it. In fact, it makes the IPython shell the privileged choice. The Python shell will be used if IPython is not available or the `--no-ipython` flag is passed.

The code is patterned on the similar feature available in `flask-script`: https://github.com/smurfix/flask-script/blob/d03cc660cf5a92e0bff367f982a872f7dd5bae07/flask_script/commands.py#L277-L312. Many thanks to @lnielsen for pointing out this snippet.

It is often useful to be able to return a vendor media type for JSON responses. For example, [JSON API](http://jsonapi.org/format/#content-negotiation) requires that all responses have the `Content-Type: applications/vnd.api+json` header.

Hi, 

From home page, the link to the pdf version of the documentation should be http://flask.pocoo.org/docs/flask-docs.pdf but it's currently unavailable.

If the link is wrong, could you please provide a correct one?

Hi, I was following the tutorial on Flask at [this](http://flask.pocoo.org/docs/0.10/tutorial/).
And I tried to return json data so I use `jsonify`

I found out that jsonify use `dict()` to convert params into a dict. But this will remove items with duplicate key.

In my case, I querried the data using this query

`cur = g.db.execute('SELECT title, text from entries order by id desc')`

The data was:

`[(u'Nope', u'hi, this is anoooother things'), (u'Nope', u'This is another'), (u'Hi', u'This is a sample entry')]`

So the jsonify just return:

`{
  "Hi": "This is a sample entry", 
  "Nope": "This is another"
}`

The code work correctly, but I don't know if this is intended or not?

Hi,

is it possible to let Flask run in a Thread?
I have the problem that in my project, I have to use the VBox XPCOM API, this api work only in the main thread:

`bash
return xpcom._xpcom.WaitForEvents(timeout)  
Exception: wrong thread, use the main thread
`

Now I want run as example a Job thread, this thread have to do sometimes, something with VBox.
And I want to let run the Flask Server with the arg threaded=True.

Now it will be very nice, if I can spawn the app.run into a Thread and in the main Thread run a loop whats call the VBox XPCOM API


Was reading through this section and figured that there was no needed
for gendered language when referring to the person who owns said server.
Thanks for the great project!

To make Flask more approachable to a larger number of users—from informed developers to curious passersby and new and interested visitors—I have added a new section to the technologyRepo README and created this file in .md format. The section is entitled What to Use Flask for and When to Use It. As the name suggests, the new section attempts to explain in plain and straightforward language what Flask is used for and when one should use it.

Other repositories may begin to use this new informative section soon, as my colleagues contact open-source technologies in an effort to make them more accessible to the many new users learning to code and GitHub every day.

Thank you for your consideration, I look forward to hearing your response. 

`interchangable` → `interchangeable`

I added a novice introduction to expand on some of the concepts that a novice might need to start using flask 

Hello:  

I am using flask 0.10.1
I have attempted the solution to this problem using several server configurations including the built in testing server, the eventlet server along with Miguel Grinberg's flask-socketio module ( as I want to use this module in the final product) and also using nginx setup with uwsgi and also as a proxy server listening on port 5000 for flask activity.   

I am attempting to serve media files, for download not streaming. I have been using flask.send_from_directory() and using the appropriate headers to cause down load in a browser and for the most part that works -- the as_attachment header causes a download box and download begins.  I have also written a wrapper around send_file() and attached headers to the response object and finally I have ignored a route and just allowed flask to deal with the static file alone. 

The issue is this.  A media file such as an .mp3 file should be able to be downloaded while playing as is the standard behavior of nginx standalone ( which I tried ) and apache ( which I setup and tried ) .. But with flash (regardless of the headers provided ) an .mp3 file and for that matter, any media file, is streamed to the player.  In other words it is not spun out as fast as bandwidth permits and does not trigger the player to gobble up the data and fill a buffer and start player when sufficient data arrives. What happens is the player thinks it has a "live broadcast" -- like an icecast server or similar. 

 Now this is a problem for the application I am building because the idea is to provide low bandwidth audio files for play back in a mobile or other device (say a itunes player or quicktime) -- In this way the file is quickly downloaded and begins playing as soon as enough data is available to meet the players buffer requirement. 

Next I did an experiment where I used the uwsgi server before the nginx and let nginx start the flask application when requested as specified in the uwsgi ini file and the nginx config file.  When I set up the server configuration this way -- nginx WILL serve the file  with the behavior I was expecting -- in other words, the file will be gobbled up by the player and play will begin when enough data is accumulated. 

I have tried all possible headers to cause the flask/nginx flask/eventlet flask/test-server to not stream the file but rather feed out as fast as bandwidth permits.   I believe this is a problem for people wanting to use Flask for purpose of serving media files in a specialized ways.  Having the flask server baby sit the stream leads to "broken pipe" problems in the player and the stream is restarted again.  I have also included the 'accept-ranges' = 'bytes' header with no difference.  I have compared the request headers with other download sites providing mp3 files for listening and they are the same -- except that the other sites do not stream the data is downloaded by the player while playing. 

lastly -- Please note that I can cause a download box to open on the browser using the as_attachment =true header .. but this does not affect the behavior with player apps such as quicktime or VLC etc .. 

Is there one or more things I might be overlooking?  Has anyone observed this phenomenon ?  Is there a work around ?  

http://flask.pocoo.org/docs/flask-docs.pdf
http://flask.pocoo.org/docs/flask-docs.zip

these are broken links. 

**Some version information**

```
1. Tengine version: Tengine/2.1.2 (nginx/1.6.2)
2.CentOS6.7  python2.6
3.Flask Version: 0.10.1
```

**Nginx configuration file content:**

```
    upstream weibo {
        ip_hash;
        server 127.0.0.1:7076;
        check interval=3000 rise=2 fall=5 timeout=1000 type=http;
        #check_http_expect_alive http_2xx http_3xx ;
        check_http_send "GET / HTTP/1.0\r\n\r\n";
    }
    server {
        listen 80;
        client_max_body_size 50M;
        server_name weibo.saintic.com;
        location / {
            proxy_pass_header Server;
            proxy_set_header Host $http_host;
            proxy_redirect off;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Scheme $scheme;
            proxy_pass http://weibo;
        }
        location /nstatus {
           check_status;
           access_log off;
        }
    }
```

**My flask app(https://github.com/saintic/ULR/blob/master/ulr.py)**

**Access log error:**

```
127.0.0.1 - - [04/Feb/2016 17:24:54] "GET / HTTP/1.0" 302 -
Traceback (most recent call last):
  File "/usr/lib64/python2.6/SocketServer.py", line 293, in _handle_request_noblock
    self.process_request(request, client_address)
  File "/usr/lib64/python2.6/SocketServer.py", line 319, in process_request
    self.finish_request(request, client_address)
  File "/usr/lib64/python2.6/SocketServer.py", line 332, in finish_request
    self.RequestHandlerClass(request, client_address, self)
  File "/usr/lib64/python2.6/SocketServer.py", line 628, in __init__
    self.finish()
  File "/usr/lib64/python2.6/SocketServer.py", line 671, in finish
    self.wfile.flush()
  File "/usr/lib64/python2.6/socket.py", line 303, in flush
    self._sock.sendall(buffer(data, write_offset, buffer_size))
error: [Errno 32] Broken pipe
```

- Use the compatible way to handle the exception. You can find the
  source code wsgi_app in app.py, and it use the compatible way, so update it
- Fix typo in config.py
- Fix typo in app.py

---

One more question, in the [flask.Flask.run](http://flask.pocoo.org/docs/dev/api/#flask.Flask.run) documentation, it says:

> It is not recommended to use this function for development with automatic reloading as this is badly supported. Instead you should be using the flask command line script’s runserver support.

I guess it should be:

> ...the flask command line script’s run support.

since flask cli has the `run` command not the `runserver` command.


If I am not mistaken the docs lack a good description on how to setup Flask to use a different _application root path_. I summarized my current understanding in [this Gist](https://gist.github.com/Larivact/1ee3bad0e53b2e2c4e40).

Also the name of Flask's APPLICATION_ROOT config variable is pretty misleading. One could wrongly assume that it affects routing (stripping away application_root) and `url_for()` (prepending application_root). I do not even get the point of the current `APPLICATION_ROOT` setting because there already is `SESSION_COOKIE_PATH`.

The bottom of the [quickstart](http://flask.pocoo.org/docs/0.10/quickstart/#quickstart) page has a link: [Sharing your Localhost Server with Localtunnel](http://flask.pocoo.org/snippets/89/)  to a page with old/outdated information on Localtunnel.  (it is pointing to Localtunnel [here](http://progrium.com/localtunnel/), which doesn't exist).

Localtunnel now appears to be: [here](https://localtunnel.me/) or on github [here](https://github.com/localtunnel/localtunnel), and is installed via `npm`, not `gem`.

52.90.119.128 - - [30/Jan/2016 17:51:03] "POST / HTTP/1.1" 500 -
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1836, in **call**
    return self.wsgi_app(environ, start_response)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1820, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1403, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1817, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1477, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1381, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1475, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1461, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/home/ubuntu/jarvis/main.py", line 55, in sms
    txt.append(line.split(None, 1)[0]) # add only first word

I have noticed that it would be better to have such a simple tool as decorator in code base to terminate port running by app.

A simple example:

```
from flask import Flask

app = Flask(__name__)

@app.reboot()
@app.route("/")
def hello():
    return "Hello world"

if __name__ == "__main__":
    app.run()
```

A user can specify a JSONEncoder on a Flask application, but it would be useful to be able to specify a JSONEncoder on a blueprint as well, so that requests made to that blueprint would receive responses interpreted by the specified JSON encoder.

This is important, for example, in [Flask-Restless](https://github.com/jfinkels/flask-restless), where we would like to transform SQLAlchemy objects into JSON objects at the blueprint level, without modifying the JSON Encoder assigned to the specific Flask application.

I have a number of custom commands that I have created

``` python
@app.cli.command()
@click.option('-c', '--with-coverage', is_flag=True, help="Turn on coverage reporting")
@click.option('-d', '--debug', is_flag=True, help="Enter pdb on test fail or error")
@click.option('-f', '--failfast', is_flag=True, help="Stop the test run after the first error or failure")
@click.option('-v', '--verbose', is_flag=True, help="Print test case names and statuses")
def tests(with_coverage, debug, failfast, verbose):
    """Testing operation commands"""
    options = list()
    options.append(sys.argv[0])

    if with_coverage:
        options.append('-C')
    if debug:
        options.append('-D')
    if failfast:
        options.append('-F')
    if verbose:
        options.append('-v')

    defaults = ['--coverage={}'.format(app.config['PROJECT_DIR']),
                '--coverage-config={}'.format(app.config['COVERAGE_CONFIG']),
                '--coverage-report=term-missing']
    options.extend(defaults)
    discover(argv=options)
```

Click provides a CliRunner class to help testing Click commands. Trying to test I get NoAppException with this message

```
Could not locate Flask application. You did not provide FLASK_APP or the --app parameter
```

Here is the test snippet

``` python
from app.commands import tests
from click.testing import CliRunner

runner = CliRunner()

Class TestCommands(unittest.TestCase):
    def test_tests(self):
        result = runner.invoke(tests)
        self.assertTrue(result.exit_code == 0) # fails
```


``` python
Exception on / [GET] [/usr/lib/python2.7/site-packages/flask/app.py:1423]
Traceback (most recent call last):
  File "/usr/lib/python2.7/site-packages/flask/app.py", line 1817, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/lib/python2.7/site-packages/flask/app.py", line 1478, in full_dispatch_request
    response = self.make_response(rv)
  File "/usr/lib/python2.7/site-packages/flask/app.py", line 1577, in make_response
    rv = self.response_class.force_type(rv, request.environ)
  File "/usr/lib/python2.7/site-packages/werkzeug/wrappers.py", line 847, in force_type
    response = BaseResponse(*_run_wsgi_app(response, environ))
  File "/usr/lib/python2.7/site-packages/werkzeug/test.py", line 871, in run_wsgi_app
    app_rv = app(environ, start_response)
TypeError: 'list' object is not callable
```

``` python
@app.route('/')
@cache.cached(timeout=30)
def site_index():
    _cates, cates = app.get_cates_home(), []
    if not _cates:
        return render_template('maintain.htm')
    route = routes['index']
    featured = app.get_news_by_priority(8, route['featured'])
    featured_ids = [fea['id'] for fea in featured]
    hotnews = app.get_news_hot(route['new'], featured_ids)
    popular = app.get_news_by_priority(7, route['popular'])
    result = {'pagetitle': app.appname,
              'featured': featured,
              'hot': hotnews,
              'popular': popular,
              'cates': cates}
    return render_template('index.htm', **result)
```

Why error. 2 my return function too return with function render_template.
Im' runing flask with uwsgi and 8 process. Error 1% request has this error.

Hello,
I'd like to propose splitting off the config.py module (encompassing the Config application and its various helpers) into it's own standalone Python module, and adding it as a dependency.

Reasoning:
1. It's a great standalone piece of functionality! People would find this useful on its own and be able to contribute / maintain it separately as an open source Python package, with all the benefits that has (e.g test coverage, functionality such as support for more config types etc etc - things that come with more usage and visibility of the project)
2. Specific real-world use case in mind which I ran into - In a scenario of having a SOA architecture comprised of many micro-services, and among  those services having a mix of Flask webapps (e.g APIs) and daemons (e.g services that have no web interface but run some periodic logic), it would be great to be able to use the same configuration mechanism to configure both types. Flask would only used for the API (webapp) services, and it feels excessive to need to add it as a requirement only to be able to extract its flask.config module...

I need to run several flask apps at the same time in my dev environment. 
All apps run in a Vagrant box on Debian 8 with Flaks 0.10.1

When I start in a shell the first flask app with debug and reload enabled and I touch a file on the project, all works fine. The flask app reload and I see the changes.
When I start another flask app in a second shell in debug mode at the same time, the app won’t reload.

In all cases, only the first app reload.

When I quit the app that won’t reload, I get this error.

```
Exception in thread Thread-2 (most likely raised during interpreter shutdown):
Traceback (most recent call last):
  File "/usr/lib/python2.7/threading.py", line 810, in __bootstrap_inner
  File "/home/politis/frontend.dev/local/lib/python2.7/site-packages/watchdog/observers/api.py", line 200, in run
<type 'exceptions.AttributeError'>: 'NoneType' object has no attribute 'Empty'
Exception in thread Thread-1 (most likely raised during interpreter shutdown):
Traceback (most recent call last):
  File "/usr/lib/python2.7/threading.py", line 810, in __bootstrap_inner
  File "/usr/lib/python2.7/threading.py", line 763, in run
  File "/home/politis/frontend.dev/local/lib/python2.7/site-packages/werkzeug/serving.py", line 657, in inner
  File "/home/politis/frontend.dev/local/lib/python2.7/site-packages/werkzeug/serving.py", line 497, in serve_forever
  File "/usr/lib/python2.7/SocketServer.py", line 241, in serve_forever
  File "/usr/lib/python2.7/threading.py", line 586, in set
  File "/usr/lib/python2.7/threading.py", line 407, in notifyAll
```

Some of these lists are getting a bit long and irrelevant.  We should remove everything that wasn't added or changed in 1.0 for the 1.0 release.  This will reset the baseline that things will be added or changed from in the future.

Cleanup some leftover stuff from #1671. PEP8 spacing, args/kwargs don't need to be converted to list/dict, and Sphinx formatting.

E301 (no empty line before function/class) is disabled for files where having compact code (e.g. non-decorator based properties) makes sense.

There is a similar question at http://stackoverflow.com/questions/25504149/why-does-running-the-flask-dev-server-run-itself-twice.
But i do not think it is my case. I just save all 
codes before run the server, but it still goes twice !
I do not want to use Flask.before_first_request, for i want it run
on startup , not wailt util a request comes in.

I write a small app with flask and celery.
I add some periodic tasks and they work well.
And I want a task run when the app starts, 
but I find celery receives it and run it twice,
why?

my `config.py` is

```
BROKER_URL = 'redis://localhost:6379/0'
BROKER_TRANSPORT_OPTIONS = {'visibility_timeout': 3600}  \# 1 hour.
CELERY_RESULT_BACKEND = 'redis://localhost:6379/0'
BROKER_TRANSPORT_OPTIONS = {'fanout_prefix': True}
CELERY_ACCEPT_CONTENT = ['pickle', 'json', 'msgpack', 'yaml']
CELERY_TASK_SERIALIZER = 'json'
CELERY_RESULT_SERIALIZER = 'json'
CELERY_TIMEZONE = 'Asia/Shanghai'
CELERY_ENABLE_UTC = True

CELERYBEAT_SCHEDULE = {
    'delcookiefiles-every-1-hour': {
        'task': 'TiebaTools.tasks.del_cookiefile',
        'schedule': timedelta(hours=1),
    },
    'daily_sign': {
        'task': 'TiebaTools.tasks.daily_sign',
        'schedule': crontab(minute=30, hour=0),
    },
}
...
```

my `proj/TiebaTools/__init__.py` is

```
...
app = Flask(__name__, instance_relative_config=True)
app.config.from_object('config')
app.config.from_pyfile('config.py')

\# integrae sqlalchemy
db.init_app(app)

\# integrae Celery
cel.conf.update(app.config)
TaskBase = cel.Task


class ContextTask(TaskBase):
    abstract = True

    def __call__(self, *args, **kwargs):
        with app.app_context():
            return TaskBase.__call__(self, *args, **kwargs)

cel.Task = ContextTask
...
```

my `proj/run.py` is

```
from TiebaTools import app, db
from TiebaTools.tasks import daily_sign
with app.app_context():
    db.create_all()

daily_sign.delay()
app.run()
```

I run the app as below

```
redis-server (in one terminal)
venv/bin/celery worker -B -A TiebaTools.cel --loglevel=info (in second terminal)
venv/bin/python run.py (in third terminal)
```

after first two commands execute, all go well, no task received.
   But after the third command executes, message as below comes out in the second terminal.

```
[2016-01-24 21:03:43,989: INFO/MainProcess] Received task: TiebaTools.tasks.daily_sign[7f229395-b403-4d4b-9d6f-a009b603f9f6]
[2016-01-24 21:03:43,991: WARNING/Worker-6] 
DEBUG in tasks [/home/dyh/svn/Tieba-Tools/TiebaTools/tasks.py:99]:
update_all_tblist task starts !

[2016-01-24 21:03:43,991: DEBUG/Worker-6] update_all_tblist task starts !
[2016-01-24 21:03:44,013: INFO/MainProcess] Task TiebaTools.tasks.daily_sign[7f229395-b403-4d4b-9d6f-a009b603f9f6] succeeded in 0.0229967209888855s: '{"result": "none TiebaList to sign !"}'
[2016-01-24 21:03:44,346: INFO/MainProcess] Received task: TiebaTools.tasks.daily_sign[fca044d1-29d8-4910-b71b-a7fc44d8a9a1]
[2016-01-24 21:03:44,347: WARNING/Worker-3] 
DEBUG in tasks [/home/dyh/svn/Tieba-Tools/TiebaTools/tasks.py:99]:
update_all_tblist task starts !

[2016-01-24 21:03:44,347: DEBUG/Worker-3] update_all_tblist task starts !
[2016-01-24 21:03:44,368: INFO/MainProcess] Task TiebaTools.tasks.daily_sign[fca044d1-29d8-4910-b71b-a7fc44d8a9a1] succeeded in 0.02192131800984498s: '{"result": "none TiebaList to sign !"}'
```

So, what's wrong? Finally I set DEBUG=False to resolve it . But how can I debug
or is it a bug , or is it needed to add a decorator like Flask.on_app_start ?

Hi,

I am currently struggling with a pretty weird bug. It only appears in specific situations. 

The whole code to reproduce it can be found in https://github.com/voidus/markupsafe_sniffer_issue or attached as 
[markupsafe_sniffer_issue.zip](https://github.com/mitsuhiko/markupsafe/files/102377/markupsafe_sniffer_issue.zip)

There has been an issue somewhat like that before but I can't find any encoding related problems.
https://github.com/mitsuhiko/markupsafe/issues/19

When I run a test via [sniffer](https://github.com/jeffh/sniffer), I get the following error every time except the first run. (Re-run can be triggered by touching e.g the application.py file)
`TypeError: object.__new__(Markup) is not safe, use unicode.__new__()`

I tried to debug that using pdb, but I cannot find any differences between runs. I also tried to minimize the problem by using jinja directly (see the second test), but that doesn't trigger the bug. As removing flask removes the bug, I'm posting this here. I have actually no Idea where the real problem is.

I'll also open an issue over at markupsafe linking here, so that the compined powers may find out what's wrong :)

Full Stack trace:

```
======================================================================
FAIL: test_application.test_application
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/<redacted>/env/lib/python2.7/site-packages/nose/case.py", line 197, in runTest
    self.test(*self.arg)
  File "/<redacted>/tests/test_application.py", line 8, in test_application
    assert response.status_code == 200
AssertionError: 
-------------------- >> begin captured logging << --------------------
application: ERROR: Exception on / [GET]
Traceback (most recent call last):
  File "/<redacted>/env/lib/python2.7/site-packages/flask/app.py", line 1817, in wsgi_app
    response = self.full_dispatch_request()
  File "/<redacted>/env/lib/python2.7/site-packages/flask/app.py", line 1477, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/<redacted>/env/lib/python2.7/site-packages/flask/app.py", line 1381, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/<redacted>/env/lib/python2.7/site-packages/flask/app.py", line 1475, in full_dispatch_request
    rv = self.dispatch_request()
  File "/<redacted>/env/lib/python2.7/site-packages/flask/app.py", line 1461, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/<redacted>/application.py", line 7, in index
    return render_template('t.html', c="baz")
  File "/<redacted>/env/lib/python2.7/site-packages/flask/templating.py", line 128, in render_template
    context, ctx.app)
  File "/<redacted>/env/lib/python2.7/site-packages/flask/templating.py", line 110, in _render
    rv = template.render(context)
  File "/<redacted>/env/lib/python2.7/site-packages/jinja2/environment.py", line 989, in render
    return self.environment.handle_exception(exc_info, True)
  File "/<redacted>/env/lib/python2.7/site-packages/jinja2/environment.py", line 754, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/<redacted>/templates/t.html", line 1, in top-level template code
    <script src="{{c}}"></script>
  File "/<redacted>/env/src/markupsafe/markupsafe/__init__.py", line 75, in __new__
    return text_type.__new__(cls, base)
TypeError: object.__new__(Markup) is not safe, use unicode.__new__()
--------------------- >> end captured logging << ---------------------
```

When I send an item to my server I get this error:

```
Traceback (most recent call last):
  File "C:\Python27\lib\site-packages\werkzeug\serving.py", line 648, in inner
    fd = int(os.environ['WERKZEUG_SERVER_FD'])
   File "C:\Python27\lib\os.py", line 425, in __getitem__
    return self.data[key.upper()]
 KeyError: 'WERKZEUG_SERVER_FD'
- - [23/Jan/2016 22:19:33] "POST / HTTP/1.1" 500 -
```

Can't seem to figure out why. I am sending the item to the server as a base64. I should note that I am sending an image as a base64

It's less confusing and it's slightly faster:

``` sh
$ python2.7 -m timeit -s 'foo="a"*1024' 'foo[:1]'
10000000 loops, best of 3: 0.0352 usec per loop
$ python2.7 -m timeit -s 'foo="a"*1024' 'foo[0]'
10000000 loops, best of 3: 0.0291 usec per loop
```

``` sh
$ python3.4 -m timeit -s 'foo="a"*1024' 'foo[:1]'
10000000 loops, best of 3: 0.0473 usec per loop
$ python3.4 -m timeit -s 'foo="a"*1024' 'foo[0]'
10000000 loops, best of 3: 0.0302 usec per loop
```

Commonly i do a check similar to

``` python
if request.path != url_for('auth.index'):


```

The issue with this on Python3.5 right now is that request.path is unicode while url_for is a string.

``` python
print(request.path, url_for('auth.index'))
>>> (u'/auth/', '/auth/')
```

Is this intended or is there a reason for it? Could we not have both return unicode?

As per the discussion on 33534bb4a9937e6faba5ec

Hello,

It's annoying to have to reimplement [this snippet](http://flask.pocoo.org/snippets/35/) for every web app in order for `url_for` to work properly behind an nginx reverse proxy mounted on a sub folder of the host's root URL.

Could the not the functionality not be built into Flask by default?

Sorry for opening an issue instead of a PR, I don't think I have the expertise to modify Flask's code base.

Regards,

Eric.

If a function is set with the `@app.teardown_request` decorator (assuming your Flask instance name is `app`), it _always_ gets passed an exception for the very first request to the server. This exception is a `KeyError` from Werkzeug (even though that particular error is handled in Werkzeug's code).

Try copying and running the following bare-bones flask app:

``` python
#!/usr/bin/env python
# -*- coding: utf-8 -*-

from flask import Flask

import sys
import traceback

app = Flask(__name__)

@app.teardown_request
def teardown_request(exception):
    if exception:
        print "teardown_request received an exception:"
        traceback.print_exception(*sys.exc_info())
    else:
        print "Request went through without passing an exception."

@app.route("/")
def works_but_not_really():
    return "This gets returned, so this function finishes."

if __name__ == '__main__':
    app.run('localhost', 5000)
```

Running this and performing two GET requests in a row to it results in the following output:

```
 * Running on http://localhost:5000/ (Press CTRL+C to quit)
teardown_request received an exception:
Traceback (most recent call last):
  File "C:\Python27\lib\site-packages\werkzeug\serving.py", line 647, in inner
    fd = int(os.environ['WERKZEUG_SERVER_FD'])
  File "C:\Python27\lib\os.py", line 425, in __getitem__
    return self.data[key.upper()]
KeyError: 'WERKZEUG_SERVER_FD'
127.0.0.1 - - [14/Jan/2016 14:57:30] "GET / HTTP/1.1" 200 -
Request went through without passing an exception.
127.0.0.1 - - [14/Jan/2016 15:03:32] "GET / HTTP/1.1" 200 -
```

Not only GET requests cause this - at the very least a POST will do the same, and I assume all other types will too. This is a problem in case the teardown request performs a database rollback on receiving an exception - because it means any changes the first request may make to the database are silently (since the page is still returned just fine) ignored.

This may not be an Issue / Bug. But may be due to my newness to Flask & lack of understanding.

I'm running Flask on a Raspberry Pi (Raspbarian OS). There's PUT path set up to upload files to a certain directory.

During one of my test runs, I killed Flask using Ctrl-C.

Thereafter:
1) Start python program, which starts Flask - no issues
2) Calls the PUT Path to upload 3 files - no issues
3) After the 3 files are uploaded (from (2)), Flask attempts to resume on a file that was perhaps in progress when I first Ctrl-C the program. The file `TEST_0059.MP4` in this case

This is the immediate error message - occurs **everytime** after files are uploaded

```
<path>/lib/python5.4/site-packages/werkzeug/filesystem.py:63: BrokenFilesystemWarning: Detected a misconfigured UNIX filesystem: Will use UTF-8 as filesystem encoding instead of 'ascii'
  BrokenFilesystemWarning)
192.168.1.8 - - [13/Jan/2016 22:03:50] "PUT /uploadMedia/TEST_0059.MP4 HTTP/1.1" 500 -
Traceback (most recent call last):
  File "<path>/lib/python3.4/site-packages/flask/app.py", line 1836, in __call__
    return self.wsgi_app(environ, start_response)
  File "<path>/lib/python3.4/site-packages/flask/app.py", line 1820, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "<path>/lib/python3.4/site-packages/flask/app.py", line 1403, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "<path>/lib/python3.4/site-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "<path>/lib/python3.4/site-packages/flask/app.py", line 1817, in wsgi_app
    response = self.full_dispatch_request()
  File "<path>/lib/python3.4/site-packages/flask/app.py", line 1477, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "<path>/lib/python3.4/site-packages/flask/app.py", line 1381, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "<path>/lib/python3.4/site-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "<path>/lib/python3.4/site-packages/flask/app.py", line 1475, in full_dispatch_request
    rv = self.dispatch_request()
  File "<path>/lib/python3.4/site-packages/flask/app.py", line 1461, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "<path>/cps_media_services.py", line 59, in to_hub_via_wifi
    f.write(request.data)
  File "<path>/lib/python3.4/site-packages/werkzeug/local.py", line 342, in __getattr__
    return getattr(self._get_current_object(), name)
  File "<path>/lib/python3.4/site-packages/werkzeug/utils.py", line 73, in __get__
    value = self.func(obj)
  File "<path>/lib/python3.4/site-packages/werkzeug/wrappers.py", line 446, in data
    return self.get_data(parse_form_data=True)
  File "<path>/lib/python3.4/site-packages/werkzeug/wrappers.py", line 477, in get_data
    rv = self.stream.read()
  File "<path>/lib/python3.4/site-packages/werkzeug/wsgi.py", line 1003, in read
    read = self._read(to_read)
MemoryError
```

**Questions:**
- What's telling Flask to resume the PUT operation that I killed earlier?
- Doesn't restarting Flask clear any previous states it had?

In http://flask.pocoo.org, "feedback website" link is 404 page. 

http://feedback.flask.pocoo.org/

I have a small Flask program which serves static file by itself instead of nginx. I want to change cache time for png file by get_send_max_age function. It works in Flask class, but it doesn't work if I implement it in blueprint.

Python 3.5
Flask 0.10.1
Werkzeug 0.11.2

Flask implementation

``` python
class MyFlask(Flask):
    def get_send_file_max_age(self,name):
        print("my function works")
        print(name)
        if name.lower().endswith('.png'):
            return 0
        else:
            return Flask.get_send_file_max_age(self,name)
app = MyFlask(__name__)
```

Blueprint implementation

``` python
class MyBlueprint(Blueprint):
    def get_send_file_max_age(self,name):
        print("my function works")
        print(name)
        if name.lower().endswith('.png'):
            return 0
        else:
            return Blueprint.get_send_file_max_age(self,name)
test = MyBlueprint('test',__name__)
```

In py3, `response.data` returns a byte value, meaning you can't do `if 'foo' in response.data` in tests, for example.

Currently, the best way to get the response body as a string seems to be `response.get_data(as_string=True)`, which is a bit tedious.

Maybe add a `response.text` property? That's what the requests package seems to have done.

If I try to search for “flash”, I get a 500 error:

http://flask.pocoo.org/search/?q=flash

I’ve found a few other searches related to flash that seem to fail; they may or may not be related:
- Leading/trailing whitespace, e.g. [“___flash”](http://flask.pocoo.org/search/?q=+++flash) or [“flash___”](http://flask.pocoo.org/search/?q=flash+++)
- Leading/trailing words with one or three characters – “a flash”, “big flash”, “flash a” and “flash big” all fail.
- “flashe” and “flashes” both fail – appending other characters seems okay.

And some searches that work:
- Prepending characters to “flash” – so “aflash”, “abflash”, “abcflash”, and so on seem to work.
- Leading/trailing words with other numbers of characters – “hi flash”, “flash ab”, “flash abcd”, “high flash”, “highest flash” all work.

Repro’d in Safari and Chrome on OS X. I’m coming from a UK-based ISP, if that’s significant.

I was trying to search for the [pages on message flashing](http://flask.pocoo.org/docs/0.10/api/#message-flashing). I couldn’t find a pattern to rejected searches, except that they all involve the word “flash”.

Remove 'flask' from etags to obscure server technologies.
When using `flask.send_from_directory`
The etag headers contain `flask` prefix. I removed it to obscure the use of flask.

Werkzeug 0.11.0 implements WERKZEUG_DEBUG_PIN.

imho, the problem is this code:

```
class Server(Command):
    """
    Runs the Flask development server i.e. app.run()

    :param host: server host
    :param port: server port
    :param use_debugger: if False, will no longer use Werkzeug debugger.
                         This can be overriden in the command line
                         by passing the **-d** flag.
    :param use_reloader: if False, will no longer use auto-reloader.
                         This can be overriden in the command line by
                         passing the **-r** flag.
    :param threaded: should the process handle each request in a separate
                     thread?
    :param processes: number of processes to spawn
    :param passthrough_errors: disable the error catching. This means that the server will die on errors but it can be useful to hook debuggers in (pdb etc.)
    :param options: :func:`werkzeug.run_simple` options.
    """

    help = description = 'Runs the Flask development server i.e. app.run()'

    def __init__(self, host='127.0.0.1', port=5000, use_debugger=True,
                 use_reloader=True, threaded=False, processes=1,
                 passthrough_errors=False, **options):

        self.port = port
        self.host = host
        self.use_debugger = use_debugger
        self.use_reloader = use_reloader
        self.server_options = options
        self.threaded = threaded
        self.processes = processes
        self.passthrough_errors = passthrough_errors
```

... where the defaults for use_debugger and use_reloader should be False and passing the -d,-r flags should turn the debugger and auto reloader on..

Hello!
When I login, I get the 400(Bad request) error. I don't know how to solve this problem. Can you help me? Thank you.

When I write the code on the layout.html, there is something wrong: 
<img width="1280" alt="screen shot 2016-01-05 at 10 28 07 am" src="https://cloud.githubusercontent.com/assets/5813472/12119022/233ca3f2-b397-11e5-901c-d76373bafa72.png">

The doc now clearly states that the method invokes two set of hook
functions, and how these are filtered before execution.



``` python
Exception happened during processing of request from ('127.0.0.1', 52838)
Traceback (most recent call last):
  File "/usr/local/Cellar/python3/3.5.1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/socketserver.py", line 318, in _handle_request_noblock
    self.process_request(request, client_address)
  File "/usr/local/Cellar/python3/3.5.1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/socketserver.py", line 344, in process_request
    self.finish_request(request, client_address)
  File "/usr/local/Cellar/python3/3.5.1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/socketserver.py", line 357, in finish_request
    self.RequestHandlerClass(request, client_address, self)
  File "/usr/local/Cellar/python3/3.5.1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/socketserver.py", line 684, in __init__
    self.handle()
  File "/Users/lxh/IdeaProjects/services/lib/python3.5/site-packages/werkzeug/serving.py", line 217, in handle
    rv = BaseHTTPRequestHandler.handle(self)
  File "/usr/local/Cellar/python3/3.5.1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/http/server.py", line 414, in handle
    self.handle_one_request()
  File "/Users/lxh/IdeaProjects/services/lib/python3.5/site-packages/werkzeug/serving.py", line 251, in handle_one_request
    elif self.parse_request():
  File "/usr/local/Cellar/python3/3.5.1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/http/server.py", line 340, in parse_request
    conntype = self.headers.get('Connection', "")
```

```
lasse@lssteady ~/tmp/pytesttest % cat asd.py 
from flask import request

def addstuff(a,b):
    """
    Adds stuff:

    >>> addstuff(4,5)
    9

    See?
    """
    return a+b

lasse@lssteady ~/tmp/pytesttest % python3   
Python 3.5.1 (default, Dec  7 2015, 12:58:09) 
[GCC 5.2.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> import asd
>>> import doctest
>>> doctest.testmod(asd)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/usr/lib/python3.5/doctest.py", line 1940, in testmod
    for test in finder.find(m, name, globs=globs, extraglobs=extraglobs):
  File "/usr/lib/python3.5/doctest.py", line 923, in find
    self._find(tests, obj, name, module, source_lines, globs, {})
  File "/usr/lib/python3.5/doctest.py", line 982, in _find
    if ((inspect.isroutine(inspect.unwrap(val))
  File "/usr/lib/python3.5/inspect.py", line 471, in unwrap
    while _is_wrapper(func):
  File "/usr/lib/python3.5/inspect.py", line 465, in _is_wrapper
    return hasattr(f, '__wrapped__')
  File "/usr/lib/python3.5/site-packages/werkzeug/local.py", line 343, in __getattr__
    return getattr(self._get_current_object(), name)
  File "/usr/lib/python3.5/site-packages/werkzeug/local.py", line 302, in _get_current_object
    return self.__local()
  File "/usr/lib/python3.5/site-packages/flask/globals.py", line 20, in _lookup_req_object
    raise RuntimeError('working outside of request context')
RuntimeError: working outside of request context
>>> 
```

Anyone any idea what happens there? I'd love to doctest my Flask application since it's especially awesome to document endpoints.

Fixes #1674.

By having Werkzeug always configured to let exceptions through we achieve the correct behavior for Flask. If Flask is configured to propagate exceptions (implicitly or explicitly, doesn't matter), then Werkzeug will get these exceptions and pass them through as well. If Flask is configured to not propagate exceptions, then Werkzeug will never see them, so no harm done if it is configured to pass them.

It looks like there is no testing for the new cli, so I have only added a test for the `app.run()` way of starting a server.

Code duplication was eliminated. The docstring was also improved.

The link http://flask.pocoo.org/docs/flask-docs.pdf throws an error 404 page

The method now looks at the type of the object returned from the view function, and returns a `self.response_class` object based on that type.

The docstring for the method has also been improved and contains a more
detailed explanation for what can be returned from a view function.

Also refactored the test for response creation.


In trying to set up a small Flask application to work with an external debugger, I noticed that the way exceptions are handled vs. propagated isn't working as documented in the [Working with Debuggers](http://flask.pocoo.org/docs/0.10/errorhandling/#working-with-debuggers) section of the documentation.

The documentation specifies that to use an external debugger you have to play with the `debug`, `use_debugger` and `use_reloader` settings. In the following table I show all possible combinations of `debug` and `use_debugger` and what the current behavior is (Note that I'm assuming `use_reloader` is always set to `False` for this discussion, as this setting is not part of the problem):

```
| debug | use_debugger | Who catches exceptions | Correct behavior?               |
+-------+--------------+------------------------+---------------------------------+
| True  | True         | Werkzeug's debugger    | Yes                             |
| False | True         | Flask, returns 500     | Yes (I think?)                  |
| True  | False        | Werkzeug's WSGI server | No, exceptions should propagate |
| False | False        | Flask, returns 500     | Yes                             |
```

The appropriate configuration for using an external debugger is the one shown in the 3rd row of the above table, but note that with this configuration, exceptions are not propagated all the way up and never reach an external debugger. With this configuration Flask does the right thing and reraises the exception, but the Werkzeug WSGI server then catches it and handles it by logging the stack trace and moving on, because it was not told otherwise.

For this set up to work as documented, Werkzeug's server should have `passthrough_errors` set to `True`. If I add this setting to `app.run()` then exceptions are allowed to reach an external debugger.

My impression is that the value of the `PROPAGATE_EXCEPTIONS` configuration item should be synchronized with Werkzeug's `passthrough_errors`, so that Flask and Werkzeug consistently handle or reraise exceptions.

I'm happy to submit a pull request with the fix (which is quite simple), if you accept this as a valid issue. Please let me know what you think.


Hi.
It's me(https://github.com/mitsuhiko/flask/pull/1303) again.

Happy New Year~ :)

Major discussion of the issue is in #248. 

I'm tired of working around it, so just like to get it fixed. 

This solution is similar to #1402 & #1209 with a few changes:
- I found it unexpected that in #1402 to convert a python list to a top level array you had to pass `jsonify(*l)`. I changed it so that both `jsonify(1,2,3)` and `jsonify([1,2,3])` serialize to `[1,2,3]` as I think that's the more intuitive behavior.
- Per the discussion in #1209 & #248, I didn't create a separate config variable to modify this behavior. 

I know it'd be nice to incorporate a fix for #1443 in here as well, but I don't fully understand the issue there. So let's get this merged, and then tackle that issue in a followup PR.

Fix #170, #248, #510, #673, #1177 and check one of the boxes on #1182 

...rappers.py. Should have gone with pull request #439.

At least, I don't have a single link to send users new to Flask and Python's std lib logging.  Flask doesn't log by default in production; okay, but what's a good example of logging requests?  Logging is currently scattered.


When `jsonify` is called on an object with a 'date' it throws:

```
TypeError: datetime.date(2012, 3, 30) is not JSON serializable
```

There is an innocuous fix - see http://stackoverflow.com/questions/455580

```
def date_handler(obj):
    if hasattr(obj, 'isoformat'):
        return obj.isoformat()
    else:
        raise TypeError, 'Object of type %s with value of %s is not JSON serializable' % (type(obj), repr(obj))
```

And https://github.com/mitsuhiko/flask/blob/master/flask/helpers.py#L142 becomes:

```
json_str = json.dumps(dict(*args, **kwargs), indent=None, default=date_handler)
```

This strikes me as preferable to TypeError.

Alternatively, `jsonify` could accept a `default` argument that is passed to `json.dumps`.

Added docs link.
Marked as approved, because it satisfies all the requirements for approved extensions.

If there's a reason for them being there, please enlighten me. :)

This allows to serve an application from a path containing non-ascii characters (see https://github.com/mitsuhiko/flask/issues/149 ).

Make the prose consistent with the code example.

flask.raw_context() would do the same thing as test_request_context but without actually creating a request.

(Would it then be called flask.test_context()? That might get confusing.)

Strange error happened to 100% working code (I mean this code has been working brilliantly for a while, but now gives strange errors).
Using flask (0.7.2), flask-wtf, flask-uploads.

Main code:

``` python
@app.route('/task/new', methods=['GET', 'POST'])
def task():
    form = TaskForm(request.form)
    if request.method == 'POST' and form.validate():
        print type(form.image) # <class 'flaskext.wtf.file.FileField'>
        print type(form.image.file) # <type 'unicode'>
        print type(form.image.data) # <type 'unicode'>
        print form.image.file.filename # gives AttributeError: 'unicode' object has no attribute 'filename'
```

Some part from forms.py:

``` python
from flaskext.wtf import ....... FileField,  file_allowed
from flaskext.uploads import UploadSet, IMAGES

images = UploadSet("images", IMAGES)

class TaskForm(Form):
    url = TextField(u'URL', [validators.Length(min=4, max=400), validators.Required()])
    title = TextField(u'TITLE', [validators.Length(min=4, max=4000), validators.Required()])
    description = TextAreaField(u'Desc', [validators.Length(min=4, max=4000), validators.Required()])
    image = FileField(u'Image', [file_allowed(images, "Images only!")])
```

Jinja 2 template:

``` jinja2
<form action="{{ url_for('task', task_id=task.id) }}" method="POST" enctype="multipart/form-data">
    {{ form.hidden_tag() }}
    {{ help.render_field(form.url) }} # using rendering form macro, no problem there
    {{ help.render_field(form.title) }}
        {{ help.render_field(form.description) }}
        {{ help.render_field(form.image) }}
        <button class="positive" type="submit">Save</button>
</form>
```

1) In Firefox submitting this form makes required fields (url, title, description) giving error "This field is required. " (Surely they are filled correctly).
2) In Chrome it's OK, but (from the main code): 

``` python
    print type(form.image) # <class 'flaskext.wtf.file.FileField'>
    print type(form.image.file) # <type 'unicode'>
    print type(form.image.data) # <type 'unicode'>
    print form.image.file.filename # gives AttributeError: 'unicode' object has no attribute 'filename'
```

Enctype is correct (it was working well, no changes were made).
So what can I do with this errors? It was working great, but now crashes. If needed, hosting is ep.io

Strange error happened to 100% working code (I mean this code has been working brilliantly for a while, but now gives strange errors).
Using flask (0.7.2), flask-wtf, flask-uploads.

Main code:

@app.route('/task/new', methods=['GET', 'POST'])
def task():
    form = TaskForm(request.form)
    if request.method == 'POST' and form.validate():
        print type(form.image) # <class 'flaskext.wtf.file.FileField'>
        print type(form.image.file) # <type 'unicode'>
        print type(form.image.data) # <type 'unicode'>
        print form.image.file.filename # gives AttributeError: 'unicode' object has no attribute 'filename'

Some part from forms.py:

from flaskext.wtf import ....... FileField,  file_allowed
from flaskext.uploads import UploadSet, IMAGES

images = UploadSet("images", IMAGES)

class TaskForm(Form):
    url = TextField(u'URL', [validators.Length(min=4, max=400), validators.Required()])
    title = TextField(u'TITLE', [validators.Length(min=4, max=4000), validators.Required()])
    description = TextAreaField(u'Desc', [validators.Length(min=4, max=4000), validators.Required()])
    image = FileField(u'Image', [file_allowed(images, "Images only!")])

Jinja 2 template:

<form action="{{ url_for('task', task_id=task.id) }}" method="POST" enctype="multipart/form-data">
    {{ form.hidden_tag() }}
    {{ help.render_field(form.url) }} # using rendering form macro, no problem there
    {{ help.render_field(form.title) }}
        {{ help.render_field(form.description) }}
        {{ help.render_field(form.image) }}
        <button class="positive" type="submit">Save</button>
</form>


1) In Firefox submitting this form makes required fields (url, title, description) giving error "This field is required. " (Surely they are filled correctly).
2) In Chrome it's OK, but (from the main code): 
    print type(form.image) # <class 'flaskext.wtf.file.FileField'>
    print type(form.image.file) # <type 'unicode'>
    print type(form.image.data) # <type 'unicode'>
    print form.image.file.filename # gives AttributeError: 'unicode' object has no attribute 'filename'

Enctype is correct (it was working well, no changes were made).
So what can I do with this errors? It was working great, but now crashes. If needed, hosting is ep.io


Fixed small typo (I assume) in documentation about Large applications.
Maybe some explanation of why it is needed to import all view functions in **init**.py should be added (note: I would propose something myself but as a total Flask noob I am not even sure that I understand the problem correctly).

An app can inject_url_defaults but it cannot otherwise change the url_for behavior.  I'd like for url_for to check the current_app to see if it provides its own url_for.  If it does; use it.  Otherwise proceed as currently implemented.

An alternative would be to register url-building handlers, but this would not fit well with multiple-app processes given that the current url_for is module-level.

I'm writing a Flask extension to provide cross-application URL-building, and I'd like to add a custom `url_for` method to all Flask instances which have been passed through `init_app`.

We can just iterate over the namespace dictionary's keys here.  We
don't need its values.

i can't get a charset in json responses with my Flask app 
running wsgi under apache.

for static json files outside of my Flask app with httpd.conf:

```
AddDefaultCharset UTF-8
AddType 'application/json; charset=UTF-8' .json
```

i get the proper response:

```
Content-Type:application/json; charset=utf-8
```

but in my Flask app i still get only:

```
Content-Type:application/json
```

is there a way to fix this without moving my json files outside 
of my app, or creating a view just for them? that would be silly,
wouldn't it?

as summary says.

Running tox, I get the following error for Python 2.5, 2.6 and PyPy, but not 2.7. I have no idea where the real problem is. Is it in CPython/PyPy rather than Flask?

```
FAIL: test_memory_consumption (flask.testsuite.regression.MemoryTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/simon/dev/projects/flask/flask/testsuite/regression.py", line 77, in test_memory_consumption
    fire()
  File "/home/simon/dev/projects/flask/flask/testsuite/regression.py", line 50, in __exit__
    self.testcase.fail('Example code leaked')
AssertionError: Example code leaked
```

Allow an existing function returning HTML to be used as a "safe" filter without adding a "def" just to wrap the results in `Markup`. Example:

```
from markdown import markdown
app.add_template_filter(markdown, safe=True)
```


Running the test suite from git master in an old virtualenv with Werkzeug 0.6.2 installed, I got a failure went away when upgrading Werkzeug to 0.7 or the latest 0.8.3:

```
FAIL: test_test_app_proper_environ (flask.testsuite.basic.BasicFunctionalityTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/simon/dev/projects/flask/flask/testsuite/basic.py", line 820, in test_test_app_proper_environ
    self.assert_equal(rv.status_code, 404)
  File "/home/simon/dev/projects/flask/flask/testsuite/__init__.py", line 133, in assert_equal
    return self.assertEqual(x, y)
AssertionError: 200 != 404
```

The fix was hinted by the test having different code paths for Werkzeug 0.7 and 0.8. Flask’s setup.py requires Werkzeug>=0.6.1, should that be changed to 0.7?

The `Flask.get_static_file_options` method uses the SEND_FILE_MAX_AGE_DEFAULT config, but there is nothing of the sort for blueprints. Tests fail on the current git master because of that:

```
FAIL: test_templates_and_static (flask.testsuite.blueprints.BlueprintTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/simon/dev/projects/flask/flask/testsuite/blueprints.py", line 370, in test_templates_and_static
    self.assert_equal(cc.max_age, expected_max_age)
  File "/home/simon/dev/projects/flask/flask/testsuite/__init__.py", line 133, in assert_equal
    return self.assertEqual(x, y)
AssertionError: 43200 != 3600
```

I’d write a patch, but I’m not sure how to access the app config from a blueprint method. Would using `flask.current_app` be appropriate?

Attempting to download large files using send_file with X-Sendfile headers did not work with Python 2.7.2, Apache 2.2.20 on Ubuntu 11.10, only an empty file was downloaded. Setting the "Content-Length" header solved the issue. I can't see why it would hurt to always have it there since response content is discarded when using X-Sendfile anyway.

Added an example of how to configure debugging with run_simple, it has to be enabled both for the Flask app and the Werkzeug server. Took me a while to figure this one out, might be useful to other folks.

Corrected MongoKit URL.

This is the basic key/val flask extension that was suggested at the pycon sprints.

It would be really nice to have a way to disable the LedgeIt button (so that I couldn't post tracebacks with potentially sensitive information to a public permanent storage with a _single click_ or by accidentally hitting enter) or make it point to 255.255.255.255 without turning off the debugging mode entirely.

Perhaps there can be a way to pass arguments to DebuggedApplication.**init** from werkzeug.debug (through **options of app.run or otherwise).

As of Flask 0.8, unhandled exceptions are logged in production mode. Wording fixed for this.
Also point out 2 ways of defining your own error handlers.
Also point out downsides to simple email log handler.

Inspired by issue #192, which is now obsolete, but needed some documentation updates.


There was a minor bug in the example extension that's
been fixed.

I also updated the description of the fixed code accordingly, and
expanded on the usage of _request_ctx_stack.top for adding data
that should be accesible to view functions.

I verified that the existing code as is works as expected.

This is an update to pull request #423, to move exception classes out of wrappers.py

I've changed a few words, but there's plenty I'd like to change / restructure about this Foreword.

Who is this foreword intended for? Experienced Pythonistas who are new to Flask? Folks who are new to flask regardless of their Python experience? Right now, this is a good foreword for the first group: its examples cover advanced topics that newer users won't understand, and whose only effect will be to scare those users. I would recommend splitting the foreword into two parts: (1) For new users (2) For experienced coders. This first portion would cover, in broad strokes, Flask's philosophy: convention over configuration, what "micro" means, "simple tasks should be simple", etc. The second portion, which we may want to hide on another page, will cover the implementation details of Flask's design decisions that advanced users will want to know about, such as the use of thread-local objects.

If that's a structure the community feels good about, I'd be happy to draft it up.

PyCon code sprints.

so we don't remain at 1 star metadata on http://py3ksupport.appspot.com/ :)

Minor grammar fix.

more explicit docs on client side sessions vs server side sessions (and how to implement server-side sessions)

recent mailing list discussion: http://flask.pocoo.org/mailinglist/archive/2012/3/1/is-it-wise-for-flask-to-store-session-variables-on-the-client/
unhappy feedback: http://feedback.flask.pocoo.org/message/223

I needed this method to adjust the cache control headers for .js files that one of my applications was statically serving.  The default expiration is buried in an argument to `send_file` and is set to 12 hours.  There was no good way to adjust this value previously.  So I added a new method to `_PackageBoundObject` named `get_static_file_options` that returns a dict (empty by default) of keywords to pass into `send_file`.  This can be overridden in the `flask.Flask` derivative to adjust values based on the debug flag or filename.

In my eyes flask-mongokit fulfil all requirements for a aproved extension.
Please review.

Thanks

PS: It is already listed under extensions.


This allows for a view function to return something like:

```
jsonify(error="error msg"), 400
```

unhappy comment: "The pdf version of the doc contains strange ' chars, thus copy-pasting the code won't work. (It's ok with the online version though)"

link: http://feedback.flask.pocoo.org/message/277

as suggested in: http://feedback.flask.pocoo.org/message/279


unhappy user feedback: "Message Flashing and Error Handling are not explained well in the Quickstart section."

link: http://feedback.flask.pocoo.org/message/282

from feedback site: "it doesn't support serving partial content (206), which seems to confuse browsers when serving them HTML5 media files even if it shouldn't."

link: http://feedback.flask.pocoo.org/message/288

For me, a single blueprint naturally goes in a module folder, and all the views go in a views.py there. If that's how you do it, it makes sense to lazy-load one blueprint at a time. But in order to do that, you have to change your whole routing system, using add_url_rule() instead of @bp.route(). I've got a fix for this, but it takes some modification of flask itself (so that there's a way to later .remove() the temporary lazy-loader rule added by add_url_rule; and so that you can app.full_redispatch_request after the lazy-loading is done).

Is this some horrid sin from the evil world of Django, or would my patches be welcome, or what?

Here's my lazyblueprint.py for reference:

```
from flask import Blueprint

class LazyBlueprint(Blueprint):
    def __init__(self, name, import_name, static_folder=None,
                 static_url_path=None, template_folder=None,
                 url_prefix=None, subdomain=None, url_defaults=None):
        super(LazyBlueprint, self).__init__(name, import_name, static_folder,
                 static_url_path, template_folder,
                 url_prefix, subdomain, url_defaults)
        self.views = '.'.join([import_name,'views'])
        print import_name, self.views
        self.lazyrules = []
        self.states = []
        self.record(self.setuplazyload)

    def setuplazyload(self, state):
        self.lazyrules.append(state.add_url_rule('/<path:endpoint>', 'index', self.lazyloadfor(state)))
        self.lazyrules.append(state.add_url_rule('/', 'index', self.lazyloadfor(state),
                                                  defaults={'endpoint':''}))
        self.states.append(state)

    def lazyloadfor(self, state):
        def innerlazyload(endpoint, **kw):
            for rule in self.lazyrules:
                rule.remove()
            self.base_functions, self.deferred_functions = self.deferred_functions, []
            __import__(self.views)

            state.app.debug, debug = False, state.app.debug #don't trigger setupfunction warnings
            for fixstate in self.states:
                for deferred in self.deferred_functions:
                    deferred(fixstate)
            state.app.debug = debug
            self.deferred_functions = self.base_functions + self.deferred_functions
            return self.redispatch(state, endpoint, **kw)
        return innerlazyload

    def redispatch(self, state, endpoint, **kw):
        return state.app.full_redispatch_request()
```

Here's how you'd use it: first skyblue/**init**.py:

```
from lazyblueprint import LazyBlueprint

skyblue = LazyBlueprint('simple_page', __name__,
                        template_folder='templates')
```

then skyblue/views.py:

```
from skyblue import skyblue

@skyblue.route('/')
def index():
    return "<html><body>sky:1...blue:2...<a href="hello">Say hi!</a></body></html>"

@skyblue.route('/hello')
def hello():
    return "Hello skyblue!"
```

On JSON requests, the JSON response should have Content-Type: application/json and the body of the response should be a JSON object. This is related to issue #422.

Suppose we have a situation in which a user creates a blueprint for a ReSTful JSON API and another blueprint for something else.  On a badly formatted request, the URLs in the API blueprint will be parsing JSON (using `Request.json`) and should return JSON responses (possibly using `Request.on_json_loading_failed`), but bad requests to URLs in the other blueprint should respond with regular old HTML responses.

In this case the user should be able to set a custom `Flask.request_class` _for the API blueprint only_ which overrides the `on_json_loading_failed` method.

Found this while searching for a solution: https://github.com/mitsuhiko/flask-babel/issues/19

In this issue, @ralfonso mentions that he is having trouble importing an editable babel package. I am having this problem too, but with another extension (flask_mongokit). 

from the python interpreter, if I import: 

``` python
from flaskext.mongokit import MongoKit
```

I get an ImportError: No module named mongokit

When I run my tests with nosetests, everything is fine. When I import from ipython, it works too. But running and importing from the plain interpreter fails.

sys.path contains:
~/.virtualenvs/myflask_project/src/flask-mongokit

I am not sure what is going on, because I know I ran the application before, and since then I pip installed/uninstalled many packages (non-editable).

**NOTE**

**After uninstalling flask-openid, the setup works again as intended. Is something wrong with flask-openid's  setup? Or with the flask exthook functionality?**

The site is 100% flask-based since almost a year now

it appears that `request.mimetype` is always an empty string - which I assume is a bug:

```
$ cat testcase.py
from flask import Flask, request, make_response


app = Flask(__name__)


@app.route("/")
def root():
    response = make_response("mimetype: %s\n\n%s" % (repr(request.mimetype),
            request.headers))
    response.headers["Content-Type"] = "text/plain"
    return response


if __name__ == "__main__":
    app.run()

$ python testcase.py &

$ curl -X GET -H "Accept: text/plain" http://127.0.0.1:5000/
mimetype: ''

Accept: text/plain
...

$ curl -X GET -H "Accept: application/json" http://127.0.0.1:5000/
mimetype: ''

Accept: application/json
...

$ curl -X GET -H \
    "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8" \
    http://127.0.0.1:5000/
mimetype: ''

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
...
```

My expectation was that `request.mimetype` be populated based on the Accept header - is this perhaps misguided?

(I've traced this into Werkzeug, but kinda got lost along the way.)

The iframe is too narrow, the number of watchers goes to the next line bellow the button instead of staying on the left. It is barely visible because of the iframe’s fixed height. Making it wider looks better.

In the snippet 'session.setdefault(...).append(...)', it was being
assumed that changes made to mutable structures in the session are
are always in sync with the session object, which is not true for
session implementations that use a external storage for keeping their
keys/values.

I just added my Flask-fillin extension to the extension overview.

Added a test to regress #414 and a simple fix.

`Config.from_envvar` raises an exception if the configuration variable exists and references a file that does not exist.  The expectation is that the following test case should pass:

``` python
    def test_config_from_envvar_missing(self):
        env = os.environ
        try:
            os.environ = {'FOO_SETTINGS': 'missing.cfg'}
            try:
                app = flask.Flask(__name__)
                app.config.from_envvar('FOO_SETTINGS')
            except IOError:
                pass
            else:
                self.fail('expected IOError')
            self.assertFalse(not app.config.from_envvar('FOO_SETTINGS', silent=True))
        finally:
            os.environ = env
```

As per #404.

Though i have a couple of issues:
1. I can't mount blueprint's static under "/", would be good to show how static could be inside blueprint too (#348)
2. For some reason, if i register same blueprint under `/` and `/pages/`, / works as expected showing me index template, but /pages/ redirects back to /. Is it desired behavior?

Add `flask.helpers.jsonify_status_code` function, a generalization of `flask.helpers.jsonify` which allows the user to set HTTP status code on JSONified responses. Documentation change, public API change, and additional test added as well.

I'm not totally sure that this is important enough to be part of the public API of Flask, but I've used this pattern enough in my code that I thought it might be worth at least a pull request discussion.


RequestContext.push pops and discards the top of the context stack if the top is preserved. Consequently, if you hit an exception in debug mode and drop into the debugger, but then make another request of the server, your debugger can no longer access the preserved context from the exception.

This is particularly a problem in Google Chrome, which follows each request with a request for "/favicon.ico". Any exception in debug mode will leave a preserved context on the stack, but will then immediately discard it when the favicon request arrives.

This would be very handy for dynamic template selection. For example i would override _some_ templates based on type of content rendered.

```
render_template(['%s.html % type, 'index.html'])
```

Typo fix

hi,when I test app on the bjoern server,console displays below errors 

Traceback (most recent call last):
  File "/usr/local/lib/python2.6/dist-packages/Flask-0.8-py2.6.egg/flask/app.py", line 1506, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/usr/local/lib/python2.6/dist-packages/Flask-0.8-py2.6.egg/flask/app.py", line 1504, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/lib/python2.6/dist-packages/Flask-0.8-py2.6.egg/flask/app.py", line 1264, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/lib/python2.6/dist-packages/Flask-0.8-py2.6.egg/flask/app.py", line 1262, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/lib/python2.6/dist-packages/Flask-0.8-py2.6.egg/flask/app.py", line 1248, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/usr/local/lib/python2.6/dist-packages/Flask-0.8-py2.6.egg/flask/helpers.py", line 623, in send_static_file
    return send_from_directory(self.static_folder, filename)
  File "/usr/local/lib/python2.6/dist-packages/Flask-0.8-py2.6.egg/flask/helpers.py", line 473, in send_from_directory
    return send_file(filename, conditional=True, **options)
  File "/usr/local/lib/python2.6/dist-packages/Flask-0.8-py2.6.egg/flask/helpers.py", line 385, in send_file
    data = wrap_file(request.environ, file)
  File "/usr/local/lib/python2.6/dist-packages/Werkzeug-0.8.3-py2.6.egg/werkzeug/wsgi.py", line 536, in wrap_file
    return environ.get('wsgi.file_wrapper', FileWrapper)(file, buffer_size)
TypeError: FileWrapper() takes exactly 1 argument (2 given)

Fix closing tag, also remove quotes to follow other docs style.

```
127.0.0.1 - - [21/Feb/2012 12:36:49] "GET / HTTP/1.1" 500 -
Traceback (most recent call last):
  File "/tmp/python2.7/lib/python2.7/site-packages/flask/app.py", line 1518, in __call__
    return self.wsgi_app(environ, start_response)
  File "/tmp/python2.7/lib/python2.7/site-packages/flask/app.py", line 1506, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/tmp/python2.7/lib/python2.7/site-packages/flask/app.py", line 1504, in wsgi_app
    response = self.full_dispatch_request()
  File "/tmp/python2.7/lib/python2.7/site-packages/flask/app.py", line 1264, in full_dispatch_
    rv = self.handle_user_exception(e)
  File "/tmp/python2.7/lib/python2.7/site-packages/flask/app.py", line 1262, in full_dispatch_
    rv = self.dispatch_request()
  File "/tmp/python2.7/lib/python2.7/site-packages/flask/app.py", line 1248, in dispatch_reque
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/tmp/t.py", line 8, in test
    raise Exception
Exception
127.0.0.1 - - [21/Feb/2012 12:36:49] "GET /?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1" 200 -
127.0.0.1 - - [21/Feb/2012 12:36:49] "GET /?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1" 200 -
127.0.0.1 - - [21/Feb/2012 12:36:49] "GET /?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1" 200 -
127.0.0.1 - - [21/Feb/2012 12:36:49] "GET /?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1" 200 -
127.0.0.1 - - [21/Feb/2012 12:36:49] "GET /?__debugger__=yes&cmd=resource&f=source.png HTTP/1.1" 200 -
127.0.0.1 - - [21/Feb/2012 12:36:49] "GET /?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1" 200 -
127.0.0.1 - - [21/Feb/2012 12:36:49] "GET /favicon.ico HTTP/1.1" 404 -
127.0.0.1 - - [21/Feb/2012 12:37:03] "GET /?__debugger__=yes&cmd=dump(request)&frm=13152656&s=EYoKchPnHhuZ75RuzgrG HTTP
127.0.0.1 - - [21/Feb/2012 12:37:05] "GET / HTTP/1.1" 500 -
Traceback (most recent call last):
  File "/tmp/python2.7/lib/python2.7/site-packages/flask/app.py", line 1518, in __call__
    return self.wsgi_app(environ, start_response)
  File "/tmp/python2.7/lib/python2.7/site-packages/flask/app.py", line 1506, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/tmp/python2.7/lib/python2.7/site-packages/flask/app.py", line 1504, in wsgi_app
    response = self.full_dispatch_request()
  File "/tmp/python2.7/lib/python2.7/site-packages/flask/app.py", line 1264, in full_dispatch_
    rv = self.handle_user_exception(e)
  File "/tmp/python2.7/lib/python2.7/site-packages/flask/app.py", line 1262, in full_dispatch_
    rv = self.dispatch_request()
  File "/tmp/python2.7/lib/python2.7/site-packages/flask/app.py", line 1248, in dispatch_reque
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/tmp/t.py", line 8, in test
    raise Exception
Exception
127.0.0.1 - - [21/Feb/2012 12:37:05] "GET /?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1" 200 -
127.0.0.1 - - [21/Feb/2012 12:37:05] "GET /?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1" 200 -
127.0.0.1 - - [21/Feb/2012 12:37:05] "GET /?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1" 200 -
127.0.0.1 - - [21/Feb/2012 12:37:05] "GET /?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1" 200 -
127.0.0.1 - - [21/Feb/2012 12:37:05] "GET /?__debugger__=yes&cmd=resource&f=source.png HTTP/1.1" 200 -
127.0.0.1 - - [21/Feb/2012 12:37:05] "GET /?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1" 200 -
127.0.0.1 - - [21/Feb/2012 12:37:05] "GET /favicon.ico HTTP/1.1" 404 -
127.0.0.1 - - [21/Feb/2012 12:37:11] "GET /?__debugger__=yes&cmd=dump(request)&frm=16515728&s=EYoKchPnHhuZ75RuzgrG HTTP
127.0.0.1 - - [21/Feb/2012 12:37:47] "GET /?__debugger__=yes&cmd=source&frm=16515728&s=EYoKchPnHhuZ75RuzgrG HTTP/1.1" 2
127.0.0.1 - - [21/Feb/2012 12:58:50] "GET /?__debugger__=yes&cmd=source&frm=16515728&s=EYoKchPnHhuZ75RuzgrG HTTP/1.1" 200 -
```

Chromium constantly requests favicon (http://code.google.com/p/chromium/issues/detail?id=39402) - hence the request context is cleared on every request to debugger.

This is not an issue on Firefox (as it caches 404 response).

Discussion on #403 points out the need for a runnable example in the `examples/` directory.  Convert the example in the doc at http://flask.pocoo.org/docs/blueprints into working project in examples/.  Write tests.  Register the blueprint twice to demonstrate Blueprint's design.

The Blueprints example on http://flask.pocoo.org/docs/blueprints is broken because it doesn't include the templates_folder param, which evidently is required now because templates_folder defaults to None (https://github.com/mitsuhiko/flask/blob/master/flask/blueprints.py).

See http://librelist.com/browser//flask/2011/9/17/templates-for-blueprints/#34dea3bacebdd468a670709228abb067
- James

Error page is fine, but it could be better.

For example see this: http://translate.google.com/translate?hl=cs&sl=cs&tl=en&u=http%3A%2F%2Fdoc.nette.org%2Fcs%2Fdebugging (I am sorry, the page doesn't have an English version, but I think the point is understandable via Google Translator)

Example is here: http://examples.nette.org/ndebug/nette-exception.html
PHP code: https://github.com/nette/nette/tree/master/Nette/Diagnostics

Moreover, it's plain HTML/JavaScript page, so framework can log right these into some defined place. It's very handy to run app on production -- when something fails, you can go to your log directory and see exactly what happened in the same way as it happened on your development server at localhost. You just open the saved HTML page with exception described and you can clearly see what happened. Of course, now you can e-mail the exceptions, but this dynamic plain HTML is so much more handy :-) E-mails are more like an alert, but they don't help much, even if they contain whole traceback.

I don't say we should have exactly this in Flask, I want to just suggest we could improve the page, we could learn something.

Let's be sure to release Flask with fully functional example application tests.  Inspired by #400.

The flaskr_tests.py app as constructed by the code on the page will fail all 3 tests. I copied the source file at https://github.com/mitsuhiko/flask/blob/master/examples/flaskr/flaskr_tests.py and it runs all tests successfully. A vimdiff showed the following issues between the files (I hope the formatting isn't mangled too badly - if so, it's not hard to copy, paste, and do another vimdiff):

source file from github:                                                              code from tutorial: 
https://github.com/mitsuhiko/flask/blob/                                  http://flask.pocoo.org/docs/testing/#testing
master/examples/flaskr/flaskr_tests.py

---

def tearDown(self):                                                                    def tearDown(self):  
          """Get rid of the database again after each test

```
os.unlink(flaskr.app.config['DATABASE'])                             os.unlink(flaskr.DATABASE) 
os.unlink(flaskr.app.config['DATABASE'])                             os.unlink(flaskr.DATABASE)  
```

def test_login_logout(self):                                                       def test_login_logout(self):  
  """Make sure login and logout works"""  
    rv = self.login(flaskr.app.config['USERNAME'],                     rv = self.login('admin', 'default') 
                          flaskr.app.config['PASSWORD'])            

```
rv = self.login(flaskr.app.config['USERNAME'] +                   rv = self.login('adminx', 'default')            
                      flaskr.app.config['PASSWORD'])             

rv = self.login(flaskr.app.config['USERNAME'],                     rv = self.login('admin', 'defaultx')            
                      flaskr.app.config['PASSWORD'] +         
```

def test_messages(self):                                                             def test_messages(self):  
    """Test that messages work"""                                                    self.login('admin', 'default')  
    self.login(flaskr.app.config['USERNAME'],  
    flaskr.app.config['PASSWORD'])       

@mitsuhiko, I'd like to spend some significant time improving some parts of the documentation. You should add me as a collab on the repo. @rduplain agrees :)

:metal::trollface::metal:

- Use distribute and pip, not setuptools and easy_install.
- Other nice fixes.

It would be nice to have a lightweight way to ignore the request's mime type and parse JSON regardless. My suggestion is an "ignore_mimetype" parameter that defaults to False.

I love Flask, thanks for an excellent framework.



Document a way to use functions via context processors. The example isn't the best one, but I couldn't figure out a better one.

replaced line-continuation backslashes

please see commit messages for details

since this was a bit of a stupefying task, careful review would be appreciated

makes it more readable (IMO)

The project is located [on Github here](https://github.com/rsenk330/Flask-Cake) and the documentation is located on [Read The Docs](readthedocs.org). I know I need unit tests yet to have it listed as an approved extension (will be adding those soon), but any other feedback and a listing as a non-approved extension (for now) would be appreciated.

PATCH should be supported by Flask, since Werkzeug does. See mitsuhiko/werkzeug#70.

From my experience, `send_from_directory()` sends a file but it's downloaded as the last part of the url as the browser see it.

Anyway to force the browser to download it as some other filename? I don't see the option, or know if it's even a flask thing or I have to do something else.

In the future please consider to publish the flask documentation not only in PDF but also in formats easily readable by an ebook reader like Kindle or Nook. At least for me it's much easier to read longer documentation on a e-ink device rather than a monitor, and PDF are rendered quite awfully on my Kindle 3g.

I see that there's a builder for Sphinx that permits to build epub files along with their HTML versions here: http://sphinx.pocoo.org/builders.html#module-sphinx.builders.epub

ePub would be a easier format to convert, through Calibre we could have a 1:1 conversion in MOBI format too.

Thank you

rewrapped lines (for short paragraphs) - please let me know whether you prefer no rewrapping in the future (cf. #369)

Hi, can I get your opinion on the following SO post? This may well be as-designed, and if so, the SO post should reflect that for others in the future.

http://stackoverflow.com/questions/8950674/debugging-a-flask-app-running-in-gunicorn

Thanks

Hi,
I come from a java background and I love using flask. But there is some itch with flask GET/POST API (production code and test code) I would like to discuss about.

In a java servlet, it doesn't matter what http method you're using (GET, POST, PUT), you always do this to get a parameter from input :

```
String username = request.getParameter("username");
String password = request.getParameter("password");
```

In flask, this is inconsistent :
for a  POST, flasks "assumes" data come from a form (wich is not mandatory, you can submit data without a form) :

```
username = request.form['username']
```

To me, in terms of API, form is wrong. But worse, if you do a GET, you can't use form, you'll have to user args :
GET :

```
username = request.args['username']
```

I would prefer to see, in POST/GET/PUT/whatever (I'm using parameter, as in java HttpServlet API) :

```
username = request.parameter['username']
```

As Im doing TDD, I observed the same inconsiancy in writing unit tests :
to test a POST, you can submit a dict (which is great and very pythonic) :

```
app.test_client().post('/login', data=dict(
        username=username,
        password=))
```

to test a GET, you can't pass a dict, you have to reconstruct the URL (which I don't find very pythonic) :

```
app.test_client().get('/agent/login?username=%s&password=%s' % (username, password))
```

I would love to be able to write this for a GET too : 

```
app.test_client().get('/login', data=dict(
        username=username,
        password=))
```

Anyway, what do you think ?
Thanks for your feedback.

There is a other implementation of JSONP inside of the _flask.jsonify_ function with tests. It works well with jquery.

Sometimes it is unavoidable to raise the assertion added in SHA: 5500986971b28f270a27db633acf19984eee609e

For example the scenario described here:
http://blog.madflex.de/2012/1/17/FlaskSQLAlchemy_PostgresqlConnector/

There should be an option to disable the assertion even in debug mode.

When debugging an application, it's surprising to get a simple "400 Bad Request" when accessing a form parameter that doesn't exist instead of a full traceback. I always forget that I also need to set TRAP_BAD_REQUEST_ERRORS.

Is there a reason why this isn't set by default when debugging is enabled?

If the test client could set debug=True, it would allow testing with assertions in view functions hit by the test client.

When updating tests for pull request 336, I noticed the testing pattern of making assertions inside an inner view function -- while clever -- must be done carefully.  Because the test client does not set debug=True, the exceptions caused by the assertions were swallowed (which could have resulted in silently failing tests).  With debug=False in the test client, you have to verify the status code in the test client to ensure all assertions pass, which the test case now does.
http://github.com/mitsuhiko/flask/blob/master/flask/testsuite/basic.py#L363

Here's the pull request for reference:
http://github.com/mitsuhiko/flask/pull/336

  File "/Users/aksonov/PycharmProjects/issuengine/flask/app.py", line 289, in **init**
    instance_path = self.auto_find_instance_path()
  File "/Users/aksonov/PycharmProjects/issuengine/flask/app.py", line 577, in auto_find_instance_path
    prefix, package_path = find_package(self.import_name)
  File "/Users/aksonov/PycharmProjects/issuengine/flask/helpers.py", line 532, in find_package
    filename = loader.archive
AttributeError: 'HardenedModulesHook' object has no attribute 'archive'
INFO     2012-01-16 12:52:07,534 dev_appserver.py:2832] "GET / HTTP/1.1" 500 


I just read this blog post: http://wekeroad.com/2011/10/24/a-fun-little-json-murder-mystery-with-ie9/

It mentions that IE9 requires json responses to have a proper charset set for it to parse it correctly. I looked at what my API currently does (which uses jsonify) and it does not set the charset at all.

I might be missing something but I think that it should set it.

http://flask.pocoo.org/docs/api/#flask.render_template_string

Parameters should be "source" and "context", now there is "template_name" and "context"

I have an app with two blueprints - `admin` and `default`. Both are stored in separate packages - `app.modules.admin` and `app.modules.default`. Both have separate `templates` and `static` folders. `default` is registered first (w/o `url_prefix`), `admin` is registered second (with `url_prefix='admin'`). Now, when rendering a template in an `admin` view function Flask searches for the file first in `default/templates` and then in `admin/templates`, so if I have file `home/index.html` in both blueprints (which is my case) Flask loads the file from first registered blueprint (`default` in my case), totally ignoring paths. The same goes for templates loaded with `extends` statement.


view.rst:

app.add_url_rule('%s<%s:%s>' % (url, **pk, pk_type**), view_func=view_func,
                     methods=['GET', 'PUT', 'DELETE'])

It should be: 

app.add_url_rule('%s<%s:%s>' % (url, **pk_type, pk**), view_func=view_func,
                     methods=['GET', 'PUT', 'DELETE'])

@rduplain has already listed it at http://flask.pocoo.org/extensions/#Flask-PyMongo

I believe it meets the criteria for approval, save that it could use more tests for the helper functions.

The “new snippet” has a nice explanation for the Creole dialect that is used:

http://flask.pocoo.org/snippets/new/

But there is no such thing when adding a new snippet comment. A link to the new snippet page or the creole website in the comment form should be enough.

This is a follow-up on a mailing-list question: http://flask.pocoo.org/mailinglist/archive/2011/12/31/how-do-i-add-code-markers-to-snippets/

(And in general in the quickstart) Instead of using "pass" which causes the code to break when pasted into hello.py:

@app.route('/projects/')
def projects():
    pass

@app.route('/about')
def about():
    pass

It would be nice if the code did enough so that the first-time user isn't faced with a non-working system. Even something as simple as:

@app.route('/projects/')
def projects():
    return "projects"

@app.route('/about')
def about():
    return "about"

If you paste the code from "Variable Rules" into your test app (hello.py), it generates error messages when you go to those URLs. That code needs some fleshing out so that it doesn't break; for example:

@app.route('/user/<username>')
def show_user_profile(username):
    # show the user profile for that user
    return "foo %s" % username

@app.route('/post/int:post_id')
def show_post(post_id):
    # show the post with the given id, the id is an integer
    return "bar %d" % post_id

I'm wondering if we can be slightly more permissive in the type of file we can use to specify the application instance. `.wsgi` seems to be a paradigm that it might sense to include. Look forward to hearing back on this!

### Expected Behavior
```
export FLASK_APP=/path/to/app.wsgi
flask shell
>>> working terminal yay! (i can import the sqla db object and do stuff)
```
### Actual Behavior

```
export FLASK_APP=/path/to/app.wsgi
flask shell
```
```
Traceback (most recent call last):
 ...
 ...
flask.cli.NoAppException: The file provided (/path/to/python.wsgi) does exist but is not a valid Python file.  This means that it cannot be used as application.  Please change the extension to .py
```
### Environment

* Python version: Python 3.5.2
* Flask version: Flask==0.12.2
* Werkzeug version: Werkzeug==0.14.1

### Expected Behavior

I have mounted multiple blueprints for serving static files at the same base url, as I use this pattern when developing with other web frameworks (though I am unfamiliar with the limitations of python web programming). Perhaps this is the incorrect suggested mechanism for accomplishing this with Flask?

```python
app.register_blueprint(Blueprint('mybp', __name__, static_folder='static', static_url_path=''), url_prefix='/a')
app.register_blueprint(Blueprint('mybp1', __name__, static_folder='static_', static_url_path=''), url_prefix='/a')
```

### Actual Behavior

The files in `static` where accessible and the ones in `static_` were not. The behavior was silent, there was no traceback. 

### Environment

* Python version: 2.7.12
* Flask version: 0.12.2
* Werkzeug version: 0.14.1

thanks so much, y'all! I'm just trying to figure out how to make an abstraction for my many folders to be accessible from a single route that serves static files.

I use **before_request** to set session's attribute,and use **teardown_request** to remove it.But only first request don't have session's attribute in **before_request**,other requests all decide request have session's attribute in **before_request**.Why?

Sample code:
`from flask import Flask,session
app = Flask(__name__)
app.secret_key='sdf'
@app.route('/')
def index():
    return """sessoin: {}""".format(session['hello'])
@app.before_request
def before():
    if not session.get('hello'):
        session['hello'] = 'Hello!'
        print('before: add hello')
    else:
        print('beforeL: have',session['hello'])
@app.teardown_request
def teardown(exception):
    if session.get('hello'):
        session.pop('hello')
        print('teardown: delete hello')
        try:
            print(session['hello'])
        except:
            print('teardown: no have')`

Output:
`* Serving Flask app "app"
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
before: add hello
teardown: delete hello
teardown: no have
127.0.0.1 - - [27/Mar/2018 18:17:35] "GET / HTTP/1.1" 200 -
beforeL: have Hello!
teardown: delete hello
teardown: no have
127.0.0.1 - - [27/Mar/2018 18:17:35] "GET /favicon.ico HTTP/1.1" 404 -
beforeL: have Hello!
teardown: delete hello
teardown: no have
127.0.0.1 - - [27/Mar/2018 18:17:35] "GET /favicon.ico HTTP/1.1" 404 -
beforeL: have Hello!
teardown: delete hello
teardown: no have
127.0.0.1 - - [27/Mar/2018 18:17:43] "GET / HTTP/1.1" 200 -
beforeL: have Hello!
teardown: delete hello
teardown: no have
127.0.0.1 - - [27/Mar/2018 18:17:46] "GET / HTTP/1.1" 200 -
beforeL: have Hello!
teardown: delete hello
teardown: no have
127.0.0.1 - - [27/Mar/2018 18:17:47] "GET / HTTP/1.1" 200 -
beforeL: have Hello!
teardown: delete hello
teardown: no have
127.0.0.1 - - [27/Mar/2018 18:17:50] "GET / HTTP/1.1" 200 -`


* Python version: 3.6.3
* Flask version: 0.12.2
* Werkzeug version: 0.12.2

Rough implementation of nested blueprints. Open to suggestions.
Fixes #593 
**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](http://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

The client browser should see all the HTML code, but it's missing the last few lines.

I'm running CGI on Apache 2.4.29 on Windows 10.  The problem occurs in other browers on Windows and Macs.  The problem does not happen on RHEL 7, or when using the webserver built into Flask.  The output is small, about one screenful.  I tried stripping almost all the HTML and code out of the template to a bare minimum but the results were the same.  Sending HTML directly from the Python script (without using the template) has the same results.  There are also no problems when I remove Flask and just have a simple Python script over CGI.

test.py:
```python
#!c:/usr/lib/python2.7/python.exe
from cgi import escape
from flask import Flask, render_template
import os, sys

app = Flask(__name__)

@app.route('/')
def index():
    return render_template('layout.html', title='Test ', user='username',
	    hostnames=['host1','host2','host3','host4'])
```

templates/layout.html
```
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{{title}}</title>
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='styles.css')}}">
</head>

<body>
<div id="main">

    <p> Hello <b>{{user}}</b>, welcome.
    </p>


    <form action="/rss/" method="post">
    <table id="main">
	<tr>
	    <th id="main">Host(s)</th>
	</tr>
	<tr>
	    <td id="main">
		{% for hostname in hostnames %}
		    <label><input type="checkbox" name="hostnames" value="{{hostname}}">{{hostname}}</label>
		    {% endfor %}
	    </td>
	</tr>
    </table>
    <br>
    <br>
    <input type="submit" value="submit" name="submit">
    </form>
</div>

</body>
</html>
```

test.cgi
```
#!c:/usr/lib/python2.7/python.exe
from wsgiref.handlers import CGIHandler
from test import app

CGIHandler().run(app)
```


### Environment

* Python version:  2.7.13
* Flask version:  0.12.2
* Werkzeug version:  0.12.2

### Expected Behavior

The template should render without any error.
When I run the app using `python manage.py run` I get an error when I open the app in the browser.
But when I start the app using gunicorn like `gunicorn -b 0.0.0.0:5000 --access-logfile -  "project.app:create_app()"` the error does not occur.

app.py
```python
def create_app(settings_override=None):
    """
    Create a Flask application using the app factory pattern.

    :return: Flask app
    """
    app = Flask(__name__, instance_relative_config=True)
    app.config.from_object('config.settings')
    app.config.from_pyfile('settings.py', silent=True)
    
    app.register_blueprint(antminer)
    app.register_blueprint(antminer_json)
    extensions(app)

    if settings_override:
       app.config.update(settings_override)

    @app.shell_context_processor
    def make_shell_context():
        return dict(app=app, db=db)

    
    return app
```

manage.py
```python
from flask.cli import FlaskGroup
from project.app import create_app

cli = FlaskGroup(create_app=create_app)

@cli.command()
def create_db():
    pass

@cli.command()
def update_db():
    pass

if __name__ == "__main__":
    cli()
```

### Actual Behavior

```pytb
Traceback (most recent call last):
  File "/home/pi/Projects/project/project/app.py", line 60, in create_app
    app.config.update(settings_override)
TypeError: 'ScriptInfo' object is not iterable
```

### Environment

* Python version: 2.7.9
* Flask version: 0.12.2
* Werkzeug version: 0.12.2

hello,

I've spent the best part of a week trying to get flask working with Apache, without success.

I am running
Redhat Linux lonrs12363 3.10.0-327.10.1.el7.x86_64
conda version : 4.5.0
conda-build version : 3.7.1
python version : 3.6.4.final.0
mod_wsgi-py36.cpython-36m-x86_64-linux-gnu.so
Apache/2.4.6 (Red Hat Enterprise Linux) mod_fcgid/2.3.9 PHP/5.4.16 mod_wsgi/3.4 Python/2.7.5

Now my Anaconda uses Python 3.6.4, and Red Hat's Apache appears to use Python 2.7.5.
Not sure how big a problem this is, but there are no Python 3 packages available via yum in the standard repo.

httpd.conf is configured as follows (with some details obfuscated):

```
LoadModule wsgi_module /pathto/anaconda3/lib/myProject3.6/site-packages/mod_wsgi/server/mod_wsgi-py36.cmyProject-36m-x86_64-linux-gnu.so
WSGISocketPrefix /var/run/wsgi
WSGImyProjectPath /pathto/anaconda3/lib/myProject3.6/site-packages:/pathto/myProject/code

<VirtualHost *>
    ServerName www.namechanged.com

    WSGIDaemonProcess foo myProject-path=/pathto/anaconda3/lib/myProject3.6/site-packages:/pathto/myProject/code user=user group=user threads=5
    WSGIProcessGroup %{GLOBAL}
    WSGIApplicationGroup %{GLOBAL}
    WSGIScriptAlias /foo /home/user/www/wsgi-scripts/foo.wsgi process-group=foo application-group=%{GLOBAL}

    <Directory /home/user/www/wsgi-scripts>
        WSGIProcessGroup foo
        WSGIApplicationGroup %{GLOBAL}
        Require all granted
    </Directory>
</VirtualHost>
```

my .wsgi file looks like:

```
#!pathto/anaconda3/bin/python
import sys
import site

if sys.platform == 'win32':
    ALLDIRS = ['python-path=C:\\dev\\apps\\Anaconda3\\Lib\\site-packages']
else:
    ALLDIRS = []
    ALLDIRS.append('pathto/myProject/code')
    ALLDIRS.append('pathto/anaconda3/lib/python36.zip')
    ALLDIRS.append('pathto/anaconda3/lib/python3.6')
    ALLDIRS.append('pathto/anaconda3/lib/python3.6/lib-dynload')
    ALLDIRS.append('pathto/anaconda3/lib/python3.6/site-packages')

# Remember original sys.path.
prev_sys_path = list(sys.path)

# Add each new site-packages directory.
for directory in ALLDIRS:
    site.addsitedir(directory)

# Reorder sys.path so new directories at the front.
new_sys_path = []
for item in list(sys.path):
    if item not in prev_sys_path:
        new_sys_path.append(item)
    sys.path.remove(item)

sys.path[:0] = new_sys_path
print(sys.path)

from analytics.signal import app as application
```

When I try access the web page made available by Apache, I get import errors of the form:

```
import numpy as np
ImportError: No module named numpy
```

When I run a standard Flask server, everything works perfectly fine.

help!

thank you.
Add a tip for installing python-dotenv when there are env files (.env, .flaskenv)
i want to keep-alive requests with flask apps, but actually, i send some requests in a tcp stream, it closed http connection,not tcp connection soon. so i want to know flask keep-alive time ,(like nginx keep-alive time can config by myself, only in conf writes like : keep-alive: 300s). is by default? 
PyCharm has added support for running using `python -m` as an alternative to script paths. Backport #2359 so users who remain on 0.12 don't see this confusing warning.
The BUG is:
    The cache object cache the **value** for the first call. Then the
    succedent call get the **same value** in the first time, no matter
    what are the arguments.

This PR fixed this BUG

Link to https://github.com/pallets/flask/issues/2651

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

BTW: This is my first PR on github. If have any problem in this PR, please tell me in detail. Thx  :-）
When I create a new blueprint, the template_folder is added to a Flask defined path, and the precedence to locate a template is

1. `app/templates/` first
2. `app/my-blueprint/templates/` second

I understand this makes sense from the point of view of a developer who's trying to reuse the same blueprints on many different projects. He can plug in an existing blueprint and replace the templates from the main app if needed.
There is a different  use case however, where this behavior is unwanted and problematic. That is, when I'm structuring my applications into independent "modules" such that different teams can work independently on their own model/blueprint. The biggest problems is, that blueprints hits templates outside their domain, that is templates defied somewhere else in another blueprint folder. With large projects, this becomes a pretty difficult model to reason on and debug, and the blueprints are too much coupled to one another. Secondly, in this development context I would prefer a blueprint to have precedence over the base templates.
Ideally, I think Flask should have an option to change the precedence of templates. For example use the current behavior by default, but introduce a new config option "blueprints_templates_first=True/False" to be defined somewhere (either at the app level, or for every single blueprint). The expected behavior would be the opposite of the default behavior:

1. look in `app/my-blueprint/templates/` first
2. look in `app/templates/` second
3. **do  not** look into other blueprints folders

I've seen other people come up with the same issue over the years, and I don't understand why there is so much resistance against supporting this feature. There is a real use case for this. I've always appreciated Flask because it's minimalist, concise, powerful, and doesn't get in the way I choose to structure my project. Opposing this option just seems to me as going against the nature of Flask itself, because the framework is dictating to me how I have to structure my files on disk, something that only bigger frameworks do and that Flask has proudly never done. Every workaround to this, such as adding a new inner folder `my-blueprint/templates/my-blueprint/`, just feels like a hack that goes against the ideas of simplicity and clarity.

I, and I believe a lot of other Flask users as well, would really appreciate if you guys could add this configuration option to Flask. Thanks.
**Idea:** Have separate session interface for each blueprint and app. 
It can be usefull when having one blueprint for site api and other one for pages. 

Added: 
* `session_interface` attribute to Blueprint object
* checking blueprint while creating/saving/etc. session in app
* one test to check this behavior

Usage example:
Assign SessionInterface object to Blueprint just the save way as with Flask application:
```python
blueprint = flask.Blueprint("bp", __name__)
blueprint.session_interface = MySessionInterface()
```
When uploading files exceed the limit set by `MAX_CONTENT_LENGTH`, the flask development server will reset the connection instead of return a 413 response. This behavior confused a lot of people:
- https://stackoverflow.com/questions/7371660/flask-resets-the-connection-instead-of-returning-a-413-when-the-file-is-to-big
- https://stackoverflow.com/questions/19911106/flask-file-upload-limit
- https://stackoverflow.com/questions/30414696/upload-file-larger-than-max-content-length-in-flask-results-connection-reset

I have a number of sites that I may be working on simultaneously, and to facilitate this I've arbitrarily designated a particular port that I run each site on in development, rather than running on the default port. I used to do this by having each project specify a hardcoded port when it called `app.run`:

    app.run(debug=True, port=8050)

With Flask 0.12, the recommended way to run Flask is using the `flask run` command, which seems like a good change overall. In each application's virtualenv setup, I can set the FLASK_APP and FLASK_DEBUG environment variables so that I don't have to set them manually every time I start up the development server. However, there is no environment variable or anything of the sort to set the port, so every time I run an application, I still need to manually specify the appropriate port each time - `flask run --port 8050` instead of just `flask run`.

In #2113 joelhed wanted to use the port in the SERVER_NAME config variable, and the issue was closed on the basis that it's technically infeasible to load app config before starting up the server, which makes sense. However, a FLASK_PORT environment variable would presumably not have this problem, and it would reduce friction significantly both for people like me and joelhed (and anyone else who for any reason can't run all their Flask applications on port 5000). Is there any chance for this to be added? I can make a pull request for this if necessary.
from app.controllers.dashboard.admin import dashboard1
from app.controllers.dashboard.supply import dashboard2

app.register_blueprint(dashboard1, subdomain='admin')
app.register_blueprint(dashboard2, subdomain='supply')

but 

@dashboard2.route('/')
def index():
       return url_for('company.index') 
is always appear that "http://admin.domain.com:5000/company"
### Expected Behavior

Given the barest possible flask app (_See this repo for full example: https://github.com/andymantell/flask-test-client-sendfile-lock_)

```python
from flask import Flask


app = Flask(__name__)

if __name__ == "__main__":
    app.run()
```

And the following test script:

```python
import os
from app import app


test_client = app.test_client()

filename = 'static/test.txt'
with open(filename, 'w+') as file:
    file.write('Hello')

response = test_client.get('/static/test.txt')

response_data = response.data.decode('utf-8')
assert response_data == 'Hello'

os.remove(filename)  # This throws an exception on windows, claiming that the file is busy
```

I would expect that the file /static/test.txt will be created, requested from the test_client, and then removed again. And indeed this is what happens on Linux.

### Actual Behavior

On Windows, the `os.remove` line throws an exception saying that the file is busy. It appears as if something inside the test client is locking the file.

If I switch to `requests.get` and fetch /static/test.txt over http instead of through the test client, the error does not occur, the file is not locked, and Windows successfully deletes the file.

```pytb
(env) C:\projects\flask-test-client-sendfile-lock-master>python test.py
Traceback (most recent call last):
  File "test.py", line 15, in <module>
    os.remove(filename)  # This throws an exception on windows, claiming
 that the file is busy
PermissionError: [WinError 32] The process cannot access the file because it is
being used by another process: 'static/test.txt'
```

### Environment
* Windows 7
* Python version: 3.4
* Flask version: 0.12
* Werkzeug version: 0.7

Now, work with cookies, we need to create a response object and then run it through all functions, but I suggest adding a global cookie object that allows you reading and setting cookies as request object.
I have a simple flask app that I want to restart if the server port is changed in a config file. I have the following code:

    #!/usr/bin/env python

    from flask import Flask, redirect
    import os
    import configparser

    config = configparser.ConfigParser()
    config.read('portnumber.ini')

    app = Flask(__name__,static_url_path='')

    HTTPPort = config['MAIN'].getint('portnumber')


    def touchMe():
        with open(__file__, 'a'):
            print(" - setting timestamp of " + __file__ )
            os.utime(__file__, None)

    @app.route("/newport/<newport>")
    def changeRoute(newport):
        HTTPPort = newport
        name = newport
        config['MAIN']['portnumber'] = newport
        with open('portnumber.ini', 'w') as configfile:
            config.write(configfile)
        touchMe()
        newurl = "http://192.168.11.15:" + HTTPPort + "/"
        print("Redirecting to " + newurl)

        return redirect(newurl, code=302)


    #------------------------------------------------------------
    if __name__ == "__main__":

        # load options from file, which change HTTPPort value
        # LoadConfig()
        while True:
            app.run(host="0.0.0.0", port=HTTPPort, debug=True, use_reloader=True)

The this code works as expected on Windows 10, however the port fails to change on Linux (or ssl_context also does not change if used). I am running Raspbian Jessie. I have also tried disabling the reloader and replacing the python process with the following call:

    os.execl(sys.executable, 'python', __file__, *sys.argv[1:])
    
This works on Windows, however on Linux, app.run() fails on reload with ""Address already in use"" error. I have reviewed the documentation and past issues however I have not found anything specific to these symptoms. 

I have found that, on Linux, if I use and external script to kill the python script (pkill) and reload the script it works about half of the time. When it fails it is due the "Address already in use" error.

I have also tried this with Watchdog and I get the same results on Linux. I have duplicated this with python 2.7.9 and 3.6.4. I am using Flask 0.12.2 

Is this a known issue and if so are there any workarounds? Is there another way to pragmatically change the port and ssl_context of a running Flask app on Linux?


### Environment
* Windows 10 and Raspbian Jessie
* Python version: 2.7.9 and 3.6.4
* Flask version: 0.12.2
* Werkzeug version: 0.12.2

---

### Expected Behavior

Taken directly from https://www.palletsprojects.com/p/flask/

```
from flask import Flask
app = Flask(__name__)

@app.route("/")
def hello():
    return "Hello World!"

if __name__ == "__main__":
    app.run()  # claim is that argument port=some_port is not needed
```

### Actual Behavior

Nothing happens.  Script executes, but flask web server never starts.

### Seems like

...this is required

```python
app.run(port=5000)
```

### Environment

* Python version: 3.6.4
* Flask version: 0.12.2
* Werkzeug version: 0.14.1

In our Flask web application we are facing 'CSRF Session Token is missing' only when morning first request. we have used the default session, csrf configuration not changed anything. cookie secret key only given.

We are using Nginx as our load balancer. We debugged the problem, For our HTML page Rquest cookies don't send 'session cookie', So we are Receiving  session cookie in 'Response Cookies'

The logic here used is if we not send session cookie, server returns session cookie in response as per our understanding.
So can anyone help why there is session cookie not received in response for first time of a day in a HTML page or is that cookie expired and due to that we are facing this problem?(Note: we are not using any cookie expiration time using default value)

### Environment

* Python version: 2.7.3
* Flask version:0.12
* Werkzeug version:0.11.15

### Environment

* Python version: 3.6.3
* Flask version: 0.12.2
* Werkzeug version: 0.14.1
* UWSGI version: 2.0.17
* Host: Raspberry Pi 3 running Raspbian stretch
* Nginx version: 1.10.3

If a function starts a subprocess and uses queues to coordinate with it, and the function is run from @app.before_first_request, the first request hangs. This only happens under uwsgi, and only the first request hangs, everything is fine after that. 

I can work around this problem by starting the subprocess from a separate thread. I can also work around the process by having the subprocess exit quickly instead of hanging around waiting for more work. 

Since it works under Werkzeug, I realize that it may be a UWSGI bug, but I don't know how to diagnose it further. 

Below is example code that does it. This was run on a Raspberry Pi (3) on stretch. 

Note that, using the more complex real code, which also uses Flask JSON RPC, attempting to browse the API with chrome timed out after a minute and reported ERR_INCOMPLETE_CHUNKED_ENCODING.

Test it with:

```curl -i http://your_host_here/ping```

and it will hang. Kill that process, do it again, and you'll get a response.

You can change global variables in the code to switch the behavior to broken or either of the two work arounds (see comments in code).

Code was run with this command:

```
sudo /usr/local/bin/uwsgi --ini /mypath/ts.ini --uid www-data --gid www-data  >& /dev/null &
```
and the ini file contents shown below the code.
```
import sys
import os
import json
import time
import threading
import multiprocessing as mp
import queue as Queue
from flask import Flask

app = Flask(__name__)
# change this to True and it works
do_in_thread=False
# or change this to True and it works
one_loop_only=False
    
def worker(job_q, result_q):
    go_command = job_q.get()
    result_q.put_nowait("ok")
    while(True):
        if not job_q.empty():
            try:
                message = job_q.get_nowait()
                if message == None:
                    result_q.put_nowait('gone')
                    return
                command = message.get('command', None)
                if command is not None:
                    if command == 'ping':
                        result = "pong"
                    else:
                        result = "error, invalid command {}".format(command)
                else:
                    result = "error invalid message, no command {}".format(message)
                result_q.put(result)
            except Queue.Empty:
                pass
        time.sleep(0.1)

def cmd_init_thread():
    job_queue = mp.Queue() # type: ignore
    result_queue = mp.Queue() # type: ignore
    p = mp.Process(target=worker, args=(job_queue, result_queue)) # type: ignore
    job_queue.put(dict(command="go"))
    p.start()
    start_res = result_queue.get()
    if start_res != 'ok':
        job_queue.put(None)
        raise Exception('got {}'.format(start_res))
    if one_loop_only:
        job_queue.put(None)
        return
    job_queue.put(dict(command="ping"))
    pong_res = result_queue.get()
    if pong_res != 'pong':
        job_queue.put(None)
        raise Exception('got {}'.format(pong_res))

@app.before_first_request
def cmd_init():
    if do_in_thread:
        thread = threading.Thread(target=cmd_init_thread, daemon=True)
        thread.start()
    else:
        cmd_init_thread()
        
@app.route('/ping', methods=['GET'])
def ping():
    return json.dumps({"pong": True})

def startup(host="0.0.0.0", port=5001):
    cmd_init()
    try:
        app.run(host=host, port=port)
    except RuntimeError:
        sys.exit(1)

if __name__ == "__main__":
    startup()
```

```
[uwsgi]
chdir = /mypath
module = ts
callable = app

master = true
processes = 1
threads = 2

uid = www-data
gid = www-data
socket = /tmp/my.sock
chmod-socket = 664
vacuum = true

die-on-term = true
req-logger = file:/mypath/req.log
logger = file:/mypath/error.log

```


Does Flask have support for working with `multipart/mixed `Content-Type?
If so, HOW? I'm having really hard time trying to understand how to do this. 

Request example:
```
curl -i -X POST 'http://localhost:5000/mixed' \
          -H 'Content-type:multipart/mixed' \
          -F 'file=@image.png;type=image/png' \
          -F 'foobar={
                "foo": "bar",
                "bar": "foo"
          }; type=application/json'
```

Flask request object output:
```
...
>> request.content_type
>> 'multipart/mixed; boundary=------------------------ef723eaaa4c75a7b'

>> request.files
>> ImmutableMultiDict([])

>> request.get_json()

>> request.data
>> b'--------------------------f1d947d065515352\r\nContent-Disposition: attachment; name="file"; filename="image.png"\r\nContent-Type: image/png\r\n\r\n\r\n--------------------------f1d947d065515352\r\nContent-Disposition: attachment; name="foobar"\r\nContent-Type: application/json\r\n\r\n{\n"foo": "bar",\n"bar": "foo"\n}\r\n--------------------------f1d947d065515352--\r\n'
...
```

### Expected Behavior
#### Sample Code

```python
app = Flask(__name__)

@app.route("/", methods=["POST"])
def broke_behvior():
    print(request.is_json)
    rv = request.get_json(silent=True)
    print(rv)
    rv = request.get_json()
    print(rv)
    return "", 200

client = app.test_client()
client.post("/", data="'invalid json'")
```

#### Output

```bash
False
None
<Response streamed [400 BAD REQUEST]>
```

### Actual Behavior

```bash
False
None
None
<Response streamed [200 OK]>
```


The fact that calling `get_json` with `silent` and then calling it without `silent` seems to break expected behavior. When I don't call `silent` I am depending on the exception being thrown, however, because the code `caches` even on error, you get this weird behavior.

While this might be expected behavior by the authors, the docs don't make this clear.

I would think, invalid json should not be cached, yet I can see the value of it, however, it adds an layer of uncertainty and therefore, I my opinion, is a bug.

### Environment

* Python version: 3.4
* Flask version: 0.12.2
* Werkzeug version: 0.14.1


I  do like that the site of "http://www.pythondoc.com/flask/tutorial/dbinit.html#tutorial-dbinit" writes,
but it shows a ValueError.
the following is my code:
+++++++++++++++++++++++++++++++++++++
Python 3.6.4 (default, Mar  4 2018, 12:03:44) 
[GCC 4.8.5 20150623 (Red Hat 4.8.5-16)] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> from flaskr import init_db
>>> init_db()
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/home/saber/flaskr/flaskr.py", line 29, in init_db
    db.cursor().executescript(f.read())
ValueError: script argument must be unicode.
>>> 

I suggest to change `PROPAGATE_EXCEPTIONS` config default value to `False` for more appropriate behavior at production environment: user should implement error handler for `500` and that's all.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

* Remove `flask.ext` from api docs.
* Remove section about `flaskext_compat.py`.
* No longer need to fall back to `_request_ctx_stack` and `teardown_request`.
* General rewrite of extensions introduction.

closes #2644 
Pytest puts all test directories on `sys.path`. Flask determines the `root_path` by import, so the path of the app in `tests/conftest.py` will think the root is `examples/tutorial/tests/` if the example also has a `conftest.py`.
Currently `Flask.test_client()` methods `get()`, `put()`, `post()` accept "data" argument but not "files" argument, which makes it incompatible with `requests`:
http://docs.python-requests.org/en/master/user/quickstart/#post-a-multipart-encoded-file

Making `Flask.test_client()` compatible with `requests` enables seamless transition between Flask unit and integration testing, e.g. via `pytest` fixtures.

A work-around via monkey-patching:
```python
orig_make_test_environ_builder = flask.testing.make_test_environ_builder
def make_test_environ_builder(*args, files=None, **kwargs):
    env = orig_make_test_environ_builder(*args, **kwargs)
    if files:
        env.files.update(files)
    return env
flask.testing.make_test_environ_builder = make_test_environ_builder
```
### Expected Behavior

Each published version of the "Flask Extensions" docs page should have a valid link to `scripts/flaskext_compat.py` under the "Flask Before 0.8" section.

Links:
http://flask.pocoo.org/docs/0.10/extensions/  
http://flask.pocoo.org/docs/0.11/extensions/  
http://flask.pocoo.org/docs/0.12/extensions/  
http://flask.pocoo.org/docs/dev/extensions/

### Actual Behavior

Each version of the docs points to `scripts/flaskext_compat.py` on Flask's master branch on GitHub. Since that file was removed from the current master branch via https://github.com/pallets/flask/commit/715a9a3e7bd65421c36428ba9d4a1ee06b98bbc1, all of the links to this script are broken.

For example, the docs for the version 0.12 uses this URL, which results in a 404:
https://raw.githubusercontent.com/pallets/flask/master/scripts/flaskext_compat.py

Also, the master branch version of the docs still show how to use this script that's been removed:
https://github.com/pallets/flask/blob/master/docs/extensions.rst

### Environment

Viewing different versions of Flasks docs on flask.pocoo.org in Google Chrome 64 on Windows 10.
I'm having this small issue where match route by type int matches actually unsigned int

---
### Expected Behavior

Doing a request with negative integer should match the route

```python
@app.route('/by_user/<int:user_id>', methods=["GET"])
def handle_user(user_id):
  # rest of the code
```

### Actual Behavior
when doing a GET request to the server, with the path `/by_user/-1` it won't match
when doing with unsigned int `/by_user/1` it works

### Environment

* Python version: Python 3.6.3
* Flask version: Flask 0.12.2

#### Note
I'm running the server via gunicorn, if it matters

Thanks a lot
I want to get a copy of flask pdf file. But I found a chapter 404 error message while clicking the pdf link.

---
Please fix it.

- '== cond' to 'is cond'
ex) app.templates_auto_reload == False to app.templates_auto_reload is False
- Change about blank lines
- Change field variable names intuitively
- Change about blank lines
- Change about continuation line's visual indent
- Change about importation

when use
function: request.args.to_dict()
it returns single value only

Example:
if url = 'http/?a=1&a=2'
function return {a:1} 
desires return {a:[1,2]}
i think it should sensitive on multiple values
![screenshot from 2018-02-25 16-47-26](https://user-images.githubusercontent.com/667418/36642668-96910ce0-1a4b-11e8-958f-aa64e99b7113.png)

Pretty self explanatory :)
I have a Flask application where I let users access third party applications and fetch data from them and perform some visualizations.Now the user has to provide the application name and it's credentials in order to fetch the data.Now I want to avoid putting the application name in the url and rather all of the data should be sent as a POST request where I will parse the POST data, connect to the required app with the given credentials and perform some visualizations.This is what the user will send as a POST data

```json
{
    "application_name": "appdynamics",
    "account_id": "sdf632sef",
    "username": "kuhku86tg",
    "password": "oihsd832"
}
```

Now I want to trigger my particular REST API class based on the application name provided by the user.

The way I planned was to create a seperate file that involves getting the POST data using request parser and then calling it in the main application where I will trigger my REST API class with a if condition based on the application name.Below is the file parse.py

```python
from flask_restful import reqparse

# create a parser object
parser = reqparse.RequestParser()
# add agruments to the parser object
parser.add_argument('account_id', type=str, required=False, help="Please define 'account_id'")
parser.add_argument('username', type=str, required=False, help="Please define 'username'")
parser.add_argument('password', type=str, required=False, help="Please define 'password'")
parser.add_argument('application_name', type=str, required=False, help="Please define 'application name'")

data = parser.parse_args()
```
Now I call it in the main application app.py

```python
from parser import data
from flask import Flask
from flask_restful import Api

app = Flask(__name__)
# create an API for the Flask app
api = Api(app)

# if the user demands info for appdynamics, trigger the Appdynamics API class
if data['application_name'] == "appdynamics":
    api.add_resource(AppdynamicsAPI, "/<string:name>")  # the string will contain the metric requirement

if __name__ == "__main__":
    app.run(port=5000, debug=True)
```

Below is the section where the logic for the REST API is written

```python
from parser import data
from flask_restful import Resource, reqparse
from fetch_data.appdynamics import fetch_all_apps, fetch_avg_resp_time, calls_per_min
from models.user import *

class AppdynamicsAPI(Resource):
    # authenticate users
    def post(self, name):
        first_data = data
        # if the user passes the credentials, insert it into the database otherwise use the last known credentials
        # ensure you only insert valid credentials
        if all([first_data['account_id'], first_data['password'], first_data['username']]):
            users.update(first_data, {i: j for i, j in first_data.items()}, upsert=True)
            print({i: j for i, j in first_data.items()})
        credentials = users.find_one({})
        print("Credentials", credentials)
        account_id = credentials['account_id']
        username = credentials['username']
        password = credentials['password']
        t_duration = first_data['t_duration']


        if name == "allapps":
            status_code, result = fetch_all_apps(account_id, username, password)
            if status_code == 200:
                return {"information": result}, status_code
            return {"message": "Please enter correct credentials"}, status_code
```

However I receive the below error

```pythontb
Traceback (most recent call last):
  File "/home/souvik/PycharmProjects/ServiceHandler/app.py", line 3, in <module>
    from resource.appdynamics_resource import AppdynamicsAPI
  File "/home/souvik/PycharmProjects/ServiceHandler/resource/appdynamics_resource.py", line 4, in <module>
    from authentication.parser import data
  File "/home/souvik/PycharmProjects/ServiceHandler/authentication/parser.py", line 14, in <module>
    data = parser.parse_args()
  File "/home/souvik/utorapp/lib/python3.5/site-packages/flask_restful/reqparse.py", line 302, in parse_args
    req.unparsed_arguments = dict(self.argument_class('').source(req)) if strict else {}
  File "/home/souvik/utorapp/lib/python3.5/site-packages/werkzeug/local.py", line 364, in <lambda>
    __setattr__ = lambda x, n, v: setattr(x._get_current_object(), n, v)
  File "/home/souvik/utorapp/lib/python3.5/site-packages/werkzeug/local.py", line 306, in _get_current_object
    return self.__local()
  File "/home/souvik/utorapp/lib/python3.5/site-packages/flask/globals.py", line 37, in _lookup_req_object
    raise RuntimeError(_request_ctx_err_msg)
RuntimeError: Working outside of request context.

This typically means that you attempted to use functionality that needed
an active HTTP request.  Consult the documentation on testing for
information about how to avoid this problem.
```
closes #2632 
Using a regular `CliRunner` requires passing a `ScriptInfo` instance that knows how to load the app being tested, otherwise `app.cli` commands will fail. This adds `app.test_cli_runner`, which creates an instance of `app.test_cli_runner_class`, which defaults to `FlaskCliRunner`.

This runner's `invoke` method adds `obj=ScriptInfo(create_app=lambda: app)` so that invoking commands works as expected. It also sets the command to `app.cli` by default, so `invoke(args=['my-command', ...])` can invoke commands by name to test that they were actually registered.
This fixes #998.  An argument can be made that this should actually land in
Werkzeug instead.  Question is if we want a new release for this or not.
Can be worked around in Flask for now.
This is a bit of a weird one cropping up under very particular circumstances, but I spent a while last week puzzling over the issue. Probably best explained through the example.

---

### Expected Behavior

Entering "Todd" into the form field in this simple example app and submitting the form takes the user to /hello/Todd, just like clicking the "Click here if your name is Todd" link does.

```python
from flask import Flask, redirect, request, url_for
app = Flask(__name__)

@app.route("/")
def form():
    return """
        <p><a href="{}">Click here if your name is Todd</a><p>
        <form action="{}" method="post">
            <input type="text" name="name">
            <button type="submit">This is my name!</button>
        </form>
    """.format(
        url_for("hello", name="Todd"),
        url_for("hello")
    )

@app.route("/hello", methods=["GET", "POST"])
@app.route("/hello/<name>")
def hello(name=None):
    if request.method == "POST":
        return redirect(url_for("hello", name=request.form.get("name")))
    if name:
        return "Hello {}!".format(name)
    else:
        return "Hello World!"
```

### Actual Behavior

Submitting the form instead takes you to /hello?name=Todd.

Through my own testing I've concluded that `url_for("hello", name="Todd")` will return `/hello?name=Todd` if
- we are currently processing a POST request, _and_
- the target endpoint has a parameter-less route with the POST method allowed (`/hello`), _but_ the route we actually want (`/hello/<name>`) only allows GET requests.

This seems obviously bizarre and counterintuitive.

### Environment

* Python version: 3.6.4
* Flask version: 0.12.2
* Werkzeug version: 0.13

Fix the README to reflect locate_app() in flask/cli.py

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

In the documentation, under [Quick Start/Unique URLs](https://github.com/pallets/flask/blob/master/docs/quickstart.rst#unique-urls--redirection-behavior) it is stated: "This behavior allows relative URLs to continue working even if the trailing slash is omitted" It is unclear what the described behavior has to do with relative URLs and how it helps to keep them working. Please clarify.

After tables creation, I want to populate them with initial datas (fixtures). For that I use sqlalchemy.event like in the code below. But in DEV mode, the automatic reloader "removes" these fixtures and lets the tables empty.

```python
import os

from flask import Flask
from flask_sqlalchemy import SQLAlchemy, event

db = SQLAlchemy()


class Test(db.Model):
    __tablename__ = 'test_table'
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String, unique=True, nullable=False)


INITIAL_TABLES = {
    Test: [
        {'name': 'NAME1'},
        {'name': 'NAME2'},
        {'name': 'NAME3'},
    ],
}


def initial_datas():
    def create(param):
        def callee(table, connection, **kwargs):
            for values in INITIAL_TABLES[param]:
                t = param(**values)
                db.session.add(t)
        return callee

    for table_class in INITIAL_TABLES:
        event.listen(table_class.__table__, 'after_create', create(table_class))

    db.session.commit()


class Config(object):
    ENV = 'dev'
    DEBUG = True
    DB_NAME = 'test.db'
    APP_DIR = os.path.abspath(os.path.dirname(__file__))
    PROJECT_ROOT = os.path.abspath(os.path.join(APP_DIR, os.pardir))
    DB_PATH = os.path.join(PROJECT_ROOT, DB_NAME)
    SQLALCHEMY_DATABASE_URI = 'sqlite:///{0}'.format(DB_PATH)
    SQLALCHEMY_TRACK_MODIFICATIONS = True


if __name__ == '__main__':
    app = Flask(__name__)
    app.config.from_object(Config)
    # if os.path.exists(Config.DB_PATH):
    #     print('drop db')
    #     os.remove(Config.DB_PATH)
    app.app_context().push()
    db.init_app(app=app)
    initial_datas()
    db.create_all(app=app)
    print(Test.query.all())

    app.run()
```
The resulting output shows the table is empty after reload:

```pytb
[<Test 1>, <Test 2>, <Test 3>]
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
[]
 * Debugger is active!
 * Debugger PIN: 110-171-224
```
As a fix, app.run(use_reloader=False) does the trick, or uncommenting the last lines for dropping the db... 

### Environment

* Python version: 3.5
* Flask version: last
* Werkzeug version: last

This corrects the docstring for `test_request_context` to say that it returns a `RequestContext`, rather than a WSGI environment; this is in line with the rest of the documentation, as well as the function's actual behaviour.

Fixes #2627.
Simple example file as below:

```
from __future__ import print_function

from flask import Flask, Blueprint, redirect

bp = Blueprint('bp', __name__)
app = Flask(__name__)

@bp.route('/b/')
def tmp():
    return "URI should be '/a/b/"


@app.route('/')
def index():
    return redirect("/a/b/")

app.register_blueprint(bp, url_prefix='/a/')

if __name__ == "__main__":
    print("app.url_map: ", app.url_map)
    app.run(port=5000, host='127.0.0.1', debug=True)
```

With the old code, there is one rule like this `<Rule '/a//b/' (HEAD, OPTIONS, GET) ->`.
With the new code, that rule would be change to `<Rule '/a/b/' (HEAD, OPTIONS, GET) ->`.
The tutorial currently describes why escaping in Jinja is good, then proceeds to do `{{ entry.text|safe }}`. There's an explanation for this in the introduction, "This HTML is not sanitized because we trust the user here." but that's not reiterated near the `safe` call, and isn't really a good pattern to teach in a tutorial anyway.

Many users end up copying the `nl2br` filter from the [Jinja docs](http://jinja.pocoo.org/docs/dev/api/#custom-filters) or [Flask snippet](http://flask.pocoo.org/snippets/28/). I think it's a common and reasonable use case between "trust user input" and "use markdown". It would allow nicely formatted posts in the tutorial without sacrificing security.
Some of the docs say (afaict, correctly) that `app.test_request_context()` returns a `RequestContext`:

> The test_request_context method can create us a RequestContext:
>
> ```python
> >>> ctx = app.test_request_context('/?next=http://example.com/')
> ```

from http://flask.pocoo.org/docs/0.12/reqcontext/

However, the API reference says that `app.test_request_context()` returns "a WSGI environment":

> Creates a WSGI environment from the given values (see werkzeug.test.EnvironBuilder for more information, this function accepts the same arguments).

from http://flask.pocoo.org/docs/0.12/api/#flask.Flask.test_request_context
I've just learned that many people are learning "how to structure Flask application" with this post: https://www.digitalocean.com/community/tutorials/how-to-structure-large-flask-applications via https://github.com/lepture/authlib/issues/8#issuecomment-364630521

This guide however it really a bad example and many people new to Flask are learning from it. I'd like to create a guide on this topic in the official docs. Here is my thoughts:

1. Use MVC pattern
2. Use factory pattern
3. Another simple example on other folder structure

```
app/
   __init__.py
   templates/
   models/
   controllers/  (or other names)
```
### Expected Behavior

Using `flask run` should result in appropriate import error messages if erroneous imports are used in a flask app.

Consider the two flask apps `worksjustfine.py`:
```python
from flask import Flask
app = Flask(__name__)
```
and `completelymisleading.py`:
```python
import flask
import batrachomyomachy
app = flask.Flask(__name__)
```
If you fire up `worksjustfine.py`, it works just fine:
```bash
$ FLASK_APP=worksjustfine.py flask run
 * Serving Flask app "worksjustfine"
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
```
If you fire up `completelymisleading.py`, you would expect something like this:
```bash
$ FLASK_APP=completelymisleading.py flask run
...
ImportError: No module named 'batrachomyomachy'
```
### Actual Behavior

```bash
$ FLASK_APP=completelymisleading.py flask run
Usage: flask run [OPTIONS]

Error: The file/path provided (completelymisleading) does not appear to exist.  Please verify the path is correct.  If app is not on PYTHONPATH, ensure the extension is .py
```

This error message is completely misleading, because the file does exist and `flask run` also starts to import this file. I imagine that somewhere in the `flask run` code there is a `try ... except ImportError` that is meant for the situation when the actual flask app can not be found, but one would definitely need a more specific error message for other import errors.

### Environment

* Python version: 3.5.3
* Flask version: 0.12

* new readme, use it for setup.py long_description
* links in changes
* revert copyright year to project start, add missing header to files
* add travis osx build, optional
* build docs separately in travis
Jinja2 added the `tojson` filter in [version 2.9](https://github.com/pallets/jinja/blob/31f92b5947e9dba8ba997dd93921cbf1538bb79f/CHANGES#L163). Now that we [bumped the dependency's versions](https://github.com/pallets/flask/pull/2622) to the latest, maybe we should delete it in Flask.

closes #2586 
### Expected Behavior
`_Validator` throw a custom exception if it fails which I was expecting to capture through `@errorhandler`.

```python
_Validator = ???
class MyConverter(BaseConverter):
    def to_python(self, value):
        return _Validator.parsed(value)

    def to_url(self, value):
        return ','.join(value)

app.url_map.converters['my'] = MyConverter
```

### Actual Behavior

Causes Internal Server Error not going through my `500` handler.

### Environment

* Python version: 3.6
* Flask version: 0.12.2
* Werkzeug version: 0.14.1

It would be nice if http://flask.pocoo.org/docs/0.12/deploying/mod_wsgi/ and hence `flask/docs/deploying/mod_wsgi.rst` sported some information on Python 3's venv virtual environment:

The information needed to deploy with `venv`is available here:

https://modwsgi.readthedocs.io/en/develop/user-guides/virtual-environments.html

Basically no `activate_this`-code is needed in the .wsgi file, just `WSGIDaemonProcess myapp python-home=/usr/local/venvs/myapp` in your httpd/apache config.

I'll draft something to merge if you think it is a good idea, otherwise this will have to serve as reference. 


This pull request updates the license year to 2018. 
Command "routes" is available at https://github.com/pallets/flask/blob/master/flask/cli.py#L798 but not documented. I tried it here, locally and it did not work ('function' object has no attribute 'make_context'). Not sure if I'm missing something or if the command is broken. Anyways, reporting.

### Environment

* Flask version: 0.12.x

I am trying to send a csv file as a base64 encoded string in the body of a post request to a flask server. It works find for small files. But when I try to post a file above ~150k the server does not respond and there is no error message. It seems to get hung up on `body = request.get_json()`. This non-responsiveness happens through postman and node. To throw a wrench into the problem, I can submit the file fine using pythons requests library. I am not sure what is causing this or what the difference between the three requests. The headers all look really similar and are included in the repo. I have included the minimal server (server.py), working python request (test.py), the not working node request (jstest.js) and the not working postman collection. Thanks for any help.

Here is a simple reproduction MCVE https://github.com/mdemin914/flask-largeish-csv-file-error-reproduction

### Environment

* Python version: 2.7.13
* Flask version: 0.12.2
* Werkzeug version: 0.14.1

I see that there is an suggestion saying "To fix this make sure to import all your view modules, database models and everything related at a central place before the application starts serving requests."

We have encountered this problem while adding an first-installation page for our app like WordPress. Now we are using Flask-Security for user management.  When our app is visited at the first time,  the installation page will display and allow user to config the database, admin account etc. 

The problem is that we need to setup the Flask-Security after the first request that providing the database setting because the Security instance can't be inited without a datastore.

Do you have any suggestions about this situation ?

Thanks ~
### Expected Behavior
Flask terminates when CTRL+C is pressed

### Actual Behavior
Nothing happens.... even when you hold CTRL+C down for a long time

### Environment
Flask 0.12.2 (Werkzeug 0.14.1)
Python 3.6.3 (py launcher)
Windows CMD line (Windows 10 v1709 build 16299.192 on Intel Core i7-5500U @ 2.40 GHz / 2.39 GHz with 8 GB of RAM)
This code change removes the code repetition to calculate the list length.

It finds the list length at the start of the code and assigns the length to a variable so that this variable can be used in the subsequent requirements.

This the minimal code optimisation done to avoid code repetition. 
Is `flask run` supposed to spin up a TLS listener if the app is configured with TLS?

Take this `app.py`:

```python
if __name__ == "__main__":
    app.run(ssl_context=('cert.pem', 'key.pem'))
```

- If i run `python app.py` i get the expected `Listening on https://...` and all is well - note the http**s**.
- If i run `flask run` i get an HTTP listener, `Listening on http://...`. No TLS.

Is this expected behaviour? May i suggest mentioning this somewhere in the quickstart? - http://flask.pocoo.org/docs/0.12/quickstart/

Would be great if someone would lay out the difference between the two invocations.

Ref:
https://stackoverflow.com/questions/48518584/
closes #2511
closes #2424 

If you use a custom entry point and introduce a module-level error, the reloader can't recover. Mention this as a reason to use the `flask` command.

Unrelated, mention which version of PyCharm adds Flask support.
For some reason nightly just fails with "invocation error" on Travis. May be related to pytest-dev/pytest#3011.
This pull request makes tab completion available in the flask shell, and sets `__name__` and `__doc__` so that those do not fall back to their counterparts in the builtins module (`code.InteractiveInterpreter` sets those for its default context, so I figure flask shell should also do this.)

I've set `__name__` to `'__flaskshell__'`, I don't really know if that's what it "should" be, it does provide a way for PYTHONSTARTUP to detect what's going on though. My next suggestion would be `'__console__'` which is what `code.InteractiveInterpreter` uses by default.


I've got roughly half a clue what I'm doing here, do tell if something should be different.

Link to issue:
https://github.com/pallets/flask/issues/2604
New Feature: Support for the cookie's SameSite attribute.

Support for cookie's SameSite attribute was lately added to Werkzeug 0.14.0., so implementing this feature in Flask.
simply set the SESSION_COOKIE_SAMESITE to "Strict" or "Lax", and your cookie will have the SameSite attribute set.
Please check https://www.owasp.org/index.php/SameSite for more info.
closes #2594 

Preferred use case is to manually generate a cert and key and pass them.

An interesting config is using `.flaskenv` and setting `FLASK_RUN_CERT` and `FLASK_RUN_KEY` instead of passing them in the command line.
I have an app factory under a function called ```create_app```:

```python
"""Factory for flask app."""
import os
from flask import Flask

def create_app(config=None):
    """Create the app and add extra config."""
    app = Flask('mini')

    app.config.update(dict(
        DATABASE=os.path.join(app.root_path, 'mini.db'),
        DEBUG=True,
        SECRET_KEY=b'thisisnolongersecret',
        USERNAME='admin',
        PASSWORD='default'
    ))

    return app
```

### Expected Behavior

I should be able to export my FLASK_APP and use that function like the following:

```
export FLASK_APP="app.factory:create_app()"
flask run 
```
### Actual Behavior

I am receiving:

```
RuntimeError: Failed to find application in module "mini.factory"
```

```pytb
Traceback (most recent call last):
  File "/Users/ara/anaconda/bin/flask", line 11, in <module>
    sys.exit(main())
  File "/Users/ara/anaconda/lib/python2.7/site-packages/flask/cli.py", line 513, in main
    cli.main(args=args, prog_name=name)
  File "/Users/ara/anaconda/lib/python2.7/site-packages/flask/cli.py", line 380, in main
    return AppGroup.main(self, *args, **kwargs)
  File "/Users/ara/anaconda/lib/python2.7/site-packages/click/core.py", line 696, in main
    rv = self.invoke(ctx)
  File "/Users/ara/anaconda/lib/python2.7/site-packages/click/core.py", line 1060, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/Users/ara/anaconda/lib/python2.7/site-packages/click/core.py", line 889, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/Users/ara/anaconda/lib/python2.7/site-packages/click/core.py", line 534, in invoke
    return callback(*args, **kwargs)
  File "/Users/ara/anaconda/lib/python2.7/site-packages/click/decorators.py", line 64, in new_func
    return ctx.invoke(f, obj, *args[1:], **kwargs)
  File "/Users/ara/anaconda/lib/python2.7/site-packages/click/core.py", line 534, in invoke
    return callback(*args, **kwargs)
  File "/Users/ara/anaconda/lib/python2.7/site-packages/flask/cli.py", line 423, in run_command
    app = DispatchingApp(info.load_app, use_eager_loading=eager_loading)
  File "/Users/ara/anaconda/lib/python2.7/site-packages/flask/cli.py", line 152, in __init__
    self._load_unlocked()
  File "/Users/ara/anaconda/lib/python2.7/site-packages/flask/cli.py", line 176, in _load_unlocked
    self._app = rv = self.loader()
  File "/Users/ara/anaconda/lib/python2.7/site-packages/flask/cli.py", line 237, in load_app
    rv = locate_app(self.app_import_path)
  File "/Users/ara/anaconda/lib/python2.7/site-packages/flask/cli.py", line 109, in locate_app
    % module)
RuntimeError: Failed to find application in module "mini.factory"
```
### Workaround

I can get it to work by setting:

```
export FLASK_APP=factory.create_app
```


### Environment

```
Flask 0.12.2
Python 2.7.9 |Anaconda custom (x86_64)| (default, Dec 15 2014, 10:37:34)
[GCC 4.2.1 (Apple Inc. build 5577)]
```
### Problem
`cli.py:shell_command` (flask shell) creates a context and passes it to `code.interact`
This leaves tab completion broken:

```
>>> stuff = 5
>>> stuTABTABTABTAB <- no match
```
### Suggestion
This can be remedied by supplying a completer to readline:

```
>>> import readline
>>> import rlcompleter
>>> readline.set_completer(rlcompleter.Completer(globals()).complete)
>>> stuTAB <- stuff! yay!
```

Or perhaps `flask/__main__.py` could be used as the context:

*file: flask/cli.py*
```
...
def shell_command():
...
    import __main__
    ctx = __main__.__dict__
...
```
This PR replace FLASK_DEBUG with FLASK_ENV in command and change the cli help string.
Is this relevant?

https://www.lanmaster53.com/2016/03/11/exploring-ssti-flask-jinja2-part-2/

https://twitter.com/_qll_/status/707714873774448640

If, how can it be mitigated?

### Environment

* Flask version: all

http://flask.pocoo.org/docs/0.12/api/#url-route-registrations

Getting a 5xx-error when requesting a route with defaults parameter 

### Code Example

```python
view = Blueprint("a", __name__, url_prefix="/a")

@view.route("/b", defaults={"consumer_id": "test"}, methods=["POST"])
@view.route("/b/<consumer_id>", methods=["POST"])
def check_consumers(consumer_id):
    return "consumer_id: {}".format(consumer_id)
```

---

### Expected Behavior

Send any other parameter - OK
```
curl -X POST '0.0.0.0:5500/a/b/anything'
```
```
consumer_id: anything
```
Send parameter == default one
```
curl -X POST '0.0.0.0:5500/a/b/test'
```
```
consumer_id: test
```

---

### Actual Behavior

Send parameter == `defaults` and get an internal error
```
curl -X POST '0.0.0.0:5500/a/b/test' -vvv
```
```
* Hostname was NOT found in DNS cache
*   Trying 0.0.0.0...
* Connected to 0.0.0.0 (127.0.0.1) port 5500 (#0)
> POST /a/b/test HTTP/1.1
> User-Agent: curl/7.35.0
> Host: 0.0.0.0:5500
> Accept: */*
> 
* Empty reply from server
* Connection #0 to host 0.0.0.0 left intact
curl: (52) Empty reply from server
```

Traceback:
```pytb
Note: this exception is only raised in debug mode
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1612, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1590, in dispatch_request
    self.raise_routing_exception(req)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1576, in raise_routing_exception
    raise FormDataRoutingRedirect(request)
FormDataRoutingRedirect: A request was sent to this URL (http://0.0.0.0:5500/a/b/test) but a redirect was issued automatically by the routing system to "http://0.0.0.0:5500/a/b".  Make sure to directly send your POST-request to this URL since we can't make browsers or HTTP clients redirect with form data reliably or without user interaction.
```

---

### Environment

* Python version: 2.7.6
* Flask version: 0.12.2
* Werkzeug version: 0.14.1


```
owner@Owners-MacBook-Pro ~/Library/Python 14:12:19 % ag "is_xhr"
2.7/lib/python/site-packages/flask/json.py
251:    if current_app.config['JSONIFY_PRETTYPRINT_REGULAR'] and not request.is_xhr:

2.7/lib/python/site-packages/werkzeug/wrappers.py
687:    def is_xhr(self):
697:            'Request.is_xhr is deprecated. Given that the X-Requested-With '
```

Full error:
>  /Users/owner/Library/Python/2.7/lib/python/site-packages/werkzeug/local.py:347:
DeprecationWarning: Request.is_xhr is deprecated. Given that the X-Requested-With
header is not a part of any spec, it is not reliable

### Environment

* Python version: 2.7.10
* Flask version: 0.12.2
* Werkzeug version: 0.14.1
Regarding this documentation: http://flask.pocoo.org/docs/0.12/api/#incoming-request-data

(Note: I'd just edit and PR myself, but I can't find these docs in this repo, or any instructions for contributing to it)

1. What mime-types does Flask recognize, and what does it do when it encounters them?
1. Reading `data` also reads `stream`, so if you call `data` and then `stream`, `stream` will be empty.
1. Similarly, reading `stream` before `data` results in an empty `data`
1. Sending a JSON payload in a GET request results in a populated `form` attribute (which, as per docs, only populates on POST and PUT)

These are very much not clear from the documentation, and led me to great frustration.

Note 2: Although it's reasonable that `form` does not automagically take JSON payloads and interpret them as form data.... it might be nice to point that out explicitly, given how much use JSON has.


The link http://flask.pocoo.org/docs/0.12/.latex/Flask.pdf referenced from http://flask.pocoo.org/ is broken.
Fix typo in docs (see: Issue #2595)  Sorry, about the long-read.  Let me know if I need to change anything :D

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

### Expected Behavior:
I expect examples in documentation to provide a fully working script with no errors.  The snippet in question is a basic example of saving a file in an uploads directory.  When ran, the file should be saved to the given upload directory designated by the global variable UPLOAD_FOLDER and then user should be redirected to a URL for the newly uploaded file.

Notes:
- I am using windows, so the upload folder works fine without a beginning '/' for os.join() [tested], but that really isn't the issue.
- When the redirect is called from within upload_file(), the supplied name for url_for() is 'uploaded_file' instead of 'upload_file'.


```python
import os
from flask import Flask, request, redirect, url_for, render_template, flash
from werkzeug.utils import secure_filename
app = Flask(__name__)
app.secret_key = "ThisIsSecret"

UPLOAD_FOLDER = 'uploads'
ALLOWED_EXTENSIONS = set(['txt', 'pdf', 'png', 'jpg', 'jpeg', 'gif'])
app.config['UPLOAD_FOLDER'] = UPLOAD_FOLDER

def allowed_file(filename):
    return '.' in filename and \
           filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS

@app.route('/', methods=['GET', 'POST'])
def upload_file():
    if request.method == 'POST':
        # check if the post request has the file part
        if 'file' not in request.files:
            flash('No file part')
            return redirect(request.url)
        file = request.files['file']
        # if user does not select file, browser also
        # submit an empty part without filename
        if file.filename == '':
            flash('No selected file')
            return redirect(request.url)
        if file and allowed_file(file.filename):
            filename = secure_filename(file.filename)
            file.save(os.path.join(app.config['UPLOAD_FOLDER'], filename))
            return redirect(url_for('uploaded_file',
                                    filename=filename))
    return '''
    <!doctype html>
    <title>Upload new File</title>
    <h1>Upload new File</h1>
    <form method=post enctype=multipart/form-data>
      <input type=file name=file>
      <input type=submit value=Upload>
    </form>
    '''

app.run(debug=True)
```

### Actual Behavior

The file is indeed saved, but upon redirect, the endpoint 'uploaded_file' cannot be found and thus produces the following traceback upon trying to build the endpoint.

```pytb
Traceback (most recent call last):
  File "C:\Users\Nickatak\downloads\venv\lib\site-packages\flask\app.py", line 1997, in __call__
    return self.wsgi_app(environ, start_response)
  File "C:\Users\Nickatak\downloads\venv\lib\site-packages\flask\app.py", line 1985, in wsgi_app
    response = self.handle_exception(e)
  File "C:\Users\Nickatak\downloads\venv\lib\site-packages\flask\app.py", line 1540, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "C:\Users\Nickatak\downloads\venv\lib\site-packages\flask\app.py", line 1982, in wsgi_app
    response = self.full_dispatch_request()
  File "C:\Users\Nickatak\downloads\venv\lib\site-packages\flask\app.py", line 1614, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "C:\Users\Nickatak\downloads\venv\lib\site-packages\flask\app.py", line 1517, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "C:\Users\Nickatak\downloads\venv\lib\site-packages\flask\app.py", line 1612, in full_dispatch_request
    rv = self.dispatch_request()
  File "C:\Users\Nickatak\downloads\venv\lib\site-packages\flask\app.py", line 1598, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "C:\Users\Nickatak\downloads\testing\server.py", line 32, in upload_file
    filename=filename))
  File "C:\Users\Nickatak\downloads\venv\lib\site-packages\flask\helpers.py", line 333, in url_for
    return appctx.app.handle_url_build_error(error, endpoint, values)
  File "C:\Users\Nickatak\downloads\venv\lib\site-packages\flask\app.py", line 1805, in handle_url_build_error
    reraise(exc_type, exc_value, tb)
  File "C:\Users\Nickatak\downloads\venv\lib\site-packages\flask\helpers.py", line 323, in url_for
    force_external=external)
  File "C:\Users\Nickatak\downloads\venv\lib\site-packages\werkzeug\routing.py", line 1776, in build
    raise BuildError(endpoint, values, method, self)
BuildError: Could not build url for endpoint 'uploaded_file' with values ['filename']. Did you mean 'upload_file' instead?
```

### Issue recreation steps:
- [x] Create a venv and activate it.
- [x] pip install flask.
- [x] Proceed to the following available documentation page: http://flask.pocoo.org/docs/0.12/patterns/fileuploads/#a-gentle-introduction
- [x] Assemble the two pieces of the script given under the above section as one server.py file ^.
- [x] Create a folder that has the same name as your UPLOAD_FOLDER variable/app.config['UPLOAD_FOLDER'].
- [x] Run the development server.
- [x] Navigate to localhost:5000.
- [x] Select a file to upload (any file in the allowed extensions will recreate this error) with the 'Choose File' button.
- [x] Attempt to upload the file with the 'Upload' button.


### Suggested solution:
Change this line in the function called upload_file:
`return redirect(url_for('uploaded_file',
                                    filename=filename))`
To this:
`return redirect(url_for('upload_file',
                                    filename=filename))`

Also, if you don't mind, I'd like to work on this issue (be assigned it as a newcomer), if this is sufficiently seen as an error.

### Environment

* Python version: 2.7.14
* Flask version: 0.12.2
* Werkzeug version: 0.14.1

### Expected Behaviour

I expect to be able to pass the `flask run` command any of the options which are valid for the `Flask.run()` method:

```sh
$ FLASK_APP=myapp/run.py FLASK_DEBUG=1 flask run --host=0.0.0.0 --ssl_context=adhoc
* Running on https://0.0.0.0:5000/ (Press CTRL+C to quit)
```

Specifically, I want to pass `ssl_context=adhoc`, but it seems sensible to extend the command to accept all valid keyword arguments for `Flask.run()` / `werkzeug.serving.run_simple()`.

### Actual Behaviour
```
Error: no such option: --ssl_context
flask run --host=0.0.0.0 --ssl_context=adhoc exited with code 2
```

### Environment

* Python version: 3.5.2
* Flask version: 0.12.2
* Werkzeug version: 0.12.2


Uses monkeypatch to unset env vars for the test session, and also reset them after each test in case they were changed without cleanup.

This doesn't affect Travis, but local tests will now pass if you happen to have a var set or a `.flaskenv` file.

closes #2589 
output extra server information
handle env var changed by load_dotenv
enable threading by default

closes #2590 
`flask run` outputs some extra information when starting. Extract this and print it when calling `app.run` too.

`app.run` runs after the app is loaded and the config created. It can call `load_dotenv`, which could change the `ENV` or `DEBUG` env vars, but the config won't be updated. If using dotenv, reconfigure `env` and `debug` if the env vars are set.

`flask run` enables threading by default, `app.run` does not.

Working on this, just creating the issue for tracking.
I had a `.flaskenv` file for running an example, and when I tried to run the tests, one of them called `app.run` which called `load_dotenv` and changed the debug flag for future tests. Can also reproduce by just setting the env var and running in a terminal, without dotenv.

Need a pytest fixture to clear these vars at the beginning of the session, and to reset them after each test.

Working on this, just creating the issue for tracking.
When a SyntaxError occurrs in a package's `__init__.py` file, Python seems to leave an empty module in `sys.modules`. This will result in any request after the first to give you a `NoAppException` instead of the `SyntaxError` again.

I'm not 100% sure this doesn't have any side effects... It's an hack... So please review and tell me what you think about this. (Maybe more conditions for triggering this?)

Fixes #2423 

### Sample
In `hello/__init__.py`:
```python
from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello, World!'
```

```cmd
set FLASK_APP=hello
set FLASK_DEBUG=1
flask run
```

Than edit `__init__.py` and introduce a syntax error.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

  
Werkzeug added support, need to update the security docs to reflect this. Add a new config to set the value for the session cookie, possibly default it to true. ref #2030
  
Currently we require:

* Werkzeug>=0.9 (4.5 years ago) (latest 0.14)
* Jinja2>=2.4 (8 years ago) (latest 2.10)
* itsdangerous>=0.21 (4.5 years ago) (latest 0.24)
* click>=4.0 (3 years ago) (latest 6.0, stable 5.0)

Should we bump these all to the latest versions?
### Expected Behavior

The documentation leads me to believe that an error handler registered like so:

```python
app.config["TRAP_HTTP_EXCEPTIONS"] = True
@app.errorhandler(HTTPException)
def handle_http_error(err):
    return flask.render_template("_error.html",
                                 errcode=err.code,
                                 errname=err.name,
                                 errdescription=err.description), err.code
```

... should be called for any HTTP error.  (The requirement to set TRAP_HTTP_EXCEPTIONS is inadequately clear, but that's an unrelated problem.)

### Actual Behavior

Instead, this configuration causes any HTTP error to turn into a 500 internal server error with this traceback:

```pytb

127.0.0.1 - - [06/Jan/2018 13:09:57] "GET /fnord.html HTTP/1.1" 500 -
Traceback (most recent call last):
  File "/usr/lib/python3/dist-packages/flask/app.py", line 1997, in __call__
    return self.wsgi_app(environ, start_response)
  File "/usr/lib/python3/dist-packages/flask/app.py", line 1985, in wsgi_app
    response = self.handle_exception(e)
  File "/usr/lib/python3/dist-packages/flask/app.py", line 1540, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/usr/lib/python3/dist-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "/usr/lib/python3/dist-packages/flask/app.py", line 1982, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/lib/python3/dist-packages/flask/app.py", line 1614, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/lib/python3/dist-packages/flask/app.py", line 1517, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/usr/lib/python3/dist-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "/usr/lib/python3/dist-packages/flask/app.py", line 1612, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/lib/python3/dist-packages/flask/app.py", line 1598, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/home/.../mysite.py", line 35, in page
    flask.abort(404)
  File "/usr/lib/python3/dist-packages/werkzeug/exceptions.py", line 707, in abort
    return _aborter(status, *args, **kwargs)
  File "/usr/lib/python3/dist-packages/werkzeug/exceptions.py", line 687, in __call__
    raise self.mapping[code](*args, **kwargs)
```

I dug around in the debugger a little: this is from the perspective of the `handle_user_exception` frame:

```python
>>> self.error_handler_spec
{None: {None: {<class 'werkzeug.exceptions.HTTPException'>: <function handle_http_error at 0x7fe7f49b4400>}}}
```

My application does not use blueprints, so the outer None in this structure is correct, and `_find_error_handler` understands it.  However, the inner None does not correspond to any HTTP code, and so `_find_error_handler` is unable to pass through that layer of nesting and do the intended lookup by class.

### Environment

* Python version: 3.6.4
* Flask version: 0.12.2
* Werkzeug version: 0.13
This changes Flask to only use the debug flag for the actual debugger
instead of also controlling the reloader.
Remove the classifier for 2.6 and 3.3. Cleanup related 2.6 and 3.3 information everywhere.

Related issues:

1. #2555
2. pallets/meta#24
Flask now requires werkzeug >= 0.9. There is no need to try import these werkzeug modules.
closes #2545 

`new` is set when no session data is loaded (no cookie, expired / invalid cookie). This means a session is "new" until there is persisted data, which could mean multiple requests see a "new" session.
 As the title says, I didn't find the parameters to set the listen backlog.

```
def run(
        self, host=None, port=None, debug=None, load_dotenv=True, **options
    ):
```
#1262 added a newline at the end of the response body from `jsonfiy`. It passed a tuple to the `Response`, which is more appropriate for streaming responses. Instead, use a simple `+ '\n'` and pass a string. This allows the content length header to be calculated while creating the response object (#1877).

ref pallets/werkzeug#1130
### Expected Behaviour

Body of a 412 response should be included on all Platforms. 
(Works on OS X, but not on linux system)

```python
from flask import Flask
app = Flask(__name__)
@app.route('/')
def r():
    return 'This should be visible\n', 412
app.run('0.0.0.0', port=8080)
```

```shell
curl localhost:8080

# Expected:
# > 127.0.0.1 - - [03/Jan/2018 17:00:15] "GET / HTTP/1.1" 412 -
# > This should be visible
```


### Actual Behavior

The response does have an empty body if executed on a linux system. (docker-image python)

```shell
curl localhost:8080

# Actual:
# > 127.0.0.1 - - [03/Jan/2018 17:00:15] "GET / HTTP/1.1" 412 -
```

### Environment

* Python version: 3.6.4
* Flask version: 0.12.2
* Werkzeug version: 0.14.1

  
I used [Attest](http://packages.python.org/Attest/) for testing my web application using Flask 0.8 and tried to upgrade it to 0.9.
Running the test after upgrade it, the testing raised an error when initializing a Flask app object.

Testing with Flask 0.8 has no problem.

Here is my traceback:

``` pytb
Traceback (most recent call last):
  File ".../testsuite/__init__.py", line 5, in <module>
    import project.api
  File "/Users/ecdysis/.virtualenvs/sheepfarm/lib/python2.7/site-packages/attest/hook.py", line 260, in load_module
    return imp.load_module(name, fd, fn, info)
  File ".../project/api/__init__.py", line 3, in <module>
    from .http import app, init
  File "/Users/ecdysis/.virtualenvs/sheepfarm/lib/python2.7/site-packages/attest/hook.py", line 260, in load_module
    return imp.load_module(name, fd, fn, info)
  File ".../project/api/http.py", line 40, in <module>
    app = Flask(__name__)
  File "/Users/ecdysis/.virtualenvs/sheepfarm/lib/python2.7/site-packages/Flask-0.9-py2.7.egg/flask/app.py", line 303, in __init__
    instance_path = self.auto_find_instance_path()
  File "/Users/ecdysis/.virtualenvs/sheepfarm/lib/python2.7/site-packages/Flask-0.9-py2.7.egg/flask/app.py", line 608, in auto_find_instance_path
    prefix, package_path = find_package(self.import_name)
  File "/Users/ecdysis/.virtualenvs/sheepfarm/lib/python2.7/site-packages/Flask-0.9-py2.7.egg/flask/helpers.py", line 727, in find_package
    if loader.is_package(root_mod_name):
AttributeError: 'AssertImportHook' object has no attribute 'is_package'
```

I think that Attest's [AssertImportHook](http://packages.python.org/Attest/api/hook/#attest.hook.AssertImportHook) broke the internal behavior of Flask. So I temporarily disabled it, and the above error disappeared.

in docstring of flask.stream_with_context()
line 116:should be a "::" not a ":" in line end.


See https://github.com/mitsuhiko/flask/blob/master/flask/views.py#L148.

When there's no HEAD handler, it uses the GET one but doesn't actually discard the response body, which it should. Most HTTP clients ignore it anyway so this should be safe to fix.


I just noticed that http://packages.python.org/Flask-Admin/ now redirects to Read the Docs, so I updated the link.

Hi,

the old regular expression in the lighttpd deployment documentation would also apply to any paths that start with '/static', but _are_ not actually the static/ directory - for example, /staticfoo would also be matched and passed through. As this can produce some nasty and hard-to-find bugs (when a route starts with 'static'), I've fixed the regex. It now matches /static, /static/, and everything below it. /staticfoo is no longer matched.
- Sven


Here is my code:

**init.py**:

```
app = Flask(__name__)
app.config.from_object(_config.DevConfig)#Without this line, It works well.
import model_name.view
```

view.py:

```
@app.route('/')                                                                 
def index():                                                                                                                                    
    return render_template('index.html')
```

Problem:When I use method `from_object`. The index page can't be found. But when I deleted it, It works very well.

I have a route:
@app.route("/links/", methods = ("GET", "POST"))
@app.route("/links/string:url/", methods = ("GET", "POST"))
def links(url = ""):
    dosomething()

When I get 127.0.0.1:5000/links/www.4399.com/special/26.htm,it return 404 bad.
Why?

Fixing some awkward wording.

What's the right way to write virtualenv?  Is it camel cased?  Do you capitalize it in the title?

With the recent introduction of flask.app_context() it is now possible to have code running in the context of an app, but without having a web request active.

I would like to be able to use render_template while in an app context but there are some code paths that assume there is an active request context while doing so.

The following code snippets should be adapted:
- https://github.com/mitsuhiko/flask/blob/master/flask/app.py#L675 This function should not try to include blueprint related context processors when no active request is present
- https://github.com/mitsuhiko/flask/blob/master/flask/templating.py#L20 The default context processor should only include the config from the app context, then check if a request is present, and include the additional keys (session, request, g)

It seems odd to not be able to render a template without a request, obviously the user has to make sure that templates rendered in an app context don't use request-related references but that seems quite reasonable.

Do you think this makes sense ? If yes, then i can provide a patch to do that, and if you think of any other issues related to this i'll be glad to fix them.

Thanks !

How can I get the raw data from a POST request in Flask?

I am moving from web.py to Flask and have some clients in production that unfortunately are using the content-type header application/x-www-form-urlencoded, so changing the header value of the request is not an option (unless it is overwritten on the server)

I cannot use: data = request.form.keys()[0] Because occasionally the '&' character shows up in my data and trying to loop through the form.keys adding the '&' seems to corrupt the data for some reason.

I'm currently using the solution proposed in this post: Python (Flask): How to get whole raw post body? But I'm not too sure if this has any performance issues.

I'm looking for one of three things: 
1. Confirmation that the WGSICopyBody method won't have any adverse performance issues 
2. Ability to make this (data = request.form.keys()[0]) method work by looping through the keys and properly restoring the & in the data 
3. Another solution to the problem, possibly by subclassing the Request class?

Look at the code below:

``` python
# -*- coding: utf-8 -*-

from flask import Flask, Blueprint

app = Flask(__name__)
app.config.DEBUG = True
#app.url_map.default_subdomain = 'www'

www = Blueprint('www', 'www', subdomain='www')
sub = Blueprint('sub', 'sub', subdomain='sub')


@www.route('/')
def www_hello():
    return 'www.www_hello'


@sub.route('/')
def sub_hello():
    return 'sub.sub_hello'


app.register_blueprint(www)
app.register_blueprint(sub)

if __name__ == '__main__':
    app.run(host='127.0.0.1', port=8888, debug=True)
```

Assuming the app's being served at mysite.com.
Navigating to www.mysite.com or sub.mysite.com will produce 404. When you uncomment `app.url_map.default_subdomain` both URLs will point to `www_hello`.

Is it me or there's something seriously not right with Flask's Blueprints?

When no endpoint name is given to app.route() Flask will currently
use view_func.**name**.

However, if you have view functions defined in several modules, you
can get name clashes. For example, if you have

```
@app.route('/users/list')
def list():
    ...
```

in users.py and

```
@app.route('/projects/list')
def list():
    ...
```

in projects.py then you end up with only one endpoint called 'list'
that will point to which ever view function was defined second.
Both routes will use the same endpoint.

By adding view_func.**module** to the endpoint name this problem
can be avoided.

Try this simple routing function:

@app.route(u'/♥/')
def heart():
    return "It works"

Or
@app.route('/%E2%99%A5/')
def heart():
    return "It works"

Trying to GET /%E2%99%A5/ HTTP/1.1
(which is what a browser does when trying to reach http://example.com/♥/)

You get a 404 not found in return.

I could not found anything in the doc talking about that, so I assume it’s a bug.

I am not sure if this is a bug, because I don't know what the expected behaviour is.  I am reporting it just in case (there should also be a mailing list message from 2012-07-15 about this topic).
##### behaviour (that might be) expected:

If any exception is trapped and passed to a Flask error handler, but that handler decides to re-raise the exception, the effect should be the same as if no handler had been registered.  For example,  if an HTTP error handler is registered by their numerical code but then re-raises the exception, it should result in Flask's default HTTP error page for that code, even if `TESTING=True`.
##### behaviour observed:

If an HTTP error handler is registered via its numerical code re-raises an exception, the exception is then handled is if it were a non-HTTP exception.  If `TESTING=True`, this results in a stack trace.  If `TESTING=False`, the client gets a "500 Internal Server Error" regardless of what the original exception was.

Shouldn't USE_RELOADER work with class based configuration? Doesn't seem to work. 

The explanation for how to use mod_wsgi doesn't explain that WSGIDaemonProcess only runs on Linux.
I added a windows-correct explanation.

Sources:
https://groups.google.com/forum/?fromgroups#!topic/django-users/pEDfNWyYv54
http://stackoverflow.com/questions/2802681/mod-wsgi-for-multiple-trac-projects-windows

My webapp is a single file app. It's also 37K now. I'm editing the file using BBedit via the built-in SFTP feature in BBedit. In the last 24hours I've been experiencing latency between my desktop and the remote system. When I "save" my PY file and flask detects the change it immediately tried to reload it.  When I was using vim locally it worked great. Now that I'm going remote... (1) flask tried to reload the py file but it's only partially there.

(yes, it would be better if BBedit save the file to a tmp file and then renamed it, however, I do not claim to know the motivation for the current methodology)

Anyway, give than I have no idea what the flask issues are... I'd recommend a token at the end of the file that could be detected to make sure that the entire file is ready before loading it.

Also, (2) the reloader seems to crash quietly each time.

Alernatively, `environ['SCRIPT_NAME'] = ''` should be replaced with something like:

```
if environ['SCRIPT_NAME'].startswith(self.to_strip):
    environ['SCRIPT_NAME'] = environ['SCRIPT_NAME'][len(self.to_strip):]
```

HTTP POST:

~~~
_ajax_nonce 7bf4f51ffb
action meta-box-order
order[column3] dashboard_incoming_links
order[normal] dashboard_recent_comments,dashboard_recent_drafts
order[side] dashboard_event_summary,dashboard_quick_press,dashboard_primary,dashboard_secondary,dashboard_plugins
page dashboard
page_columns 3
~~~

ImmutableMultiDict Got:

~~~
ImmutableMultiDict([
    ('page_columns', u'2'),
    ('order[column3]', u'dashboard_incoming_links'),
    ('order[side]', u'dashboard_event_summary,dashboard_quick_press,dashboard_primary,dashboard_secondary,dashboard_plugins'),
    ('order[normal]', u'dashboard_recent_comments,dashboard_recent_drafts'),
    ('action', u'meta-box-order'),
    ('_ajax_nonce', u'7bf4f51ffb'), ('page', u'dashboard')
])
~~~

How to get a MultiDict like:

~~~
{'order', {'column3': u'dashboard_incomming_links', 'side': '.......'}}
~~~
# !/usr/bin/env python
# coding=utf-8

from my_flask import create_app
from flask.ext.script import Manager
# from flask.ext.celery import install_commands as install_celery_commands

app = create_app('config.cfg')
manager = Manager(app)
# install_celery_commands(manager)

if **name** == "**main**":
    manager.run()
The app sometime automatic stop working and it's not any  tips which error , warning,notice .etc.Why?

this is a doubtful bug,

i found when i am trying to got the blueprint's url_prefix , it return none, 
but i have give it a url_prefix in app initialization stage via register_blueprint

so i check the source code, and found the reason

the calling chain is that

app.register_blueprint(blueprint_instance, _kargs) -> blueprint_instance.register(_*kargs)

and it will make a BlueprintSetupState object (called BSS)from these parameters , 

_IF_ the blueprints object has some deferred_functions, it will handle the  BSS for deferred processing

but in common user case, the dererred_functions is a empty list, so it would do nothing with the BSS

i know how it has been caused and how to fix it, but i dont know the design goal of flask, so i think 
it is just a doubtful bug, maybe you guys has some reason for avoiding this update action if user dont provide a special deferred func

the project is here:
https://github.com/dantezhu/flask_util_js

then you can use url_for in javascript like this:

var url = flask_util.url_for('sub.bpt_index', {y:2, x:'/sdf'});

may be it can be put on the http://flask.pocoo.org/extensions/ ? hoho, anyway, some one may need this~ enjoy it~

Request to add Flask-MakoTemplates to the extensions listing.

Request to add Flask-MakoTemplates to extension registry

In the cache documentation it states:

> If you want to use memcached, make sure to have one of the memcache modules supported (you get them from PyPI) and a memcached server running somewhere. 

However it doesn't state which modules are supported and the [werkzeug documentation](http://werkzeug.pocoo.org/docs/contrib/cache/#werkzeug.contrib.cache.MemcachedCache) is equally vague.


I had a newbie wonder in confusion about where the stuff would go. This should fix that.

The github url changed by transfer of the repository to my github user.
If you have questions than we can talk at europython 2012. ;)


Just some grammar.

This patch will remove weird behaviour and add `JSON_ASCII` configuration options.
I also had an audacity to correct mimetype encoding for JSON to 'utf-8' by default.

I don't sure what that patch must be applied in master but I just want to place it here for other guys :)


Update Flask-Principal repository

I had a friend that was going through the quickstart, and he had absolutely no idea that there were any extensions available for flask.

He was using SQLAlchemy directly and was becoming quite frustrated quickly.

Since an ecosystem is clearly part of a framework, I think we should add some hints about extensions throughout the documentation. Not necessarily usage examples, just "hey, this extension might be useful to you".


There was a missing parameter in the example method

Fixed indentation in return statement of **call** method in ScriptNameStripper class in the fastcgi documentation.

which sounds not conform to http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.26 :

if any of the entity tags match the entity tag of the entity that would have been returned in the response to a similar GET request (without the If-None-Match header) on that resource, or if "*" is given and any current entity exists for that resource, then the server MUST NOT perform the requested method, unless required to do so because the resource's modification date fails to match that supplied in an If-Modified-Since header field in the request. 

I think send_file should always check that cache_timeout is not None to allow for a (I hope legal) value of 0 for such parameter.

Apologies if this was fixed, but I can't find a solution online.

I'm following the tutorial in a virtualenv and when I try to run the flaskr.py file, I get:

ImportError: No module named inspect

I've seen references to this being a corrupted sys.path in virtualenv but not everyone seems to have this problem. I'm using Python 2.7.2 on OSX with the virtualenv setup described on the flask website.


The find_module method has an unused "path" argument.

It helps to find module when translated from

```
from flask.ext.random_module import RandomModule
```

to 

```
__import__('flask_random_module')
```


For some reason
`app = flask.Flask(__name__, static_folder='public', static_url_path='')`
will cause flask-login to return `AttributeError: 'RequestContext' object has no attribute 'user'`, and 
`app = flask.Flask(__name__, static_folder='public')`
works

I think we could remove the Link as long as it is dead.

The login example in the quickstart guide has an incorrect or unclear comment at the end.  If the comment is referring to the <code>error = 'Invalid username/password'</code> line, then this code will NOT be executed if the request method was GET.  If the comment is meant to mean that code placed after the comment would execute, then it should be re-worded as such.

```
@app.route('/login', methods=['POST', 'GET'])
def login():
    error = None
    if request.method == 'POST':
        if valid_login(request.form['username'],
                       request.form['password']):
            return log_the_user_in(request.form['username'])
        else:
            error = 'Invalid username/password'
    # this is executed if the request method was GET or the
    # credentials were invalid
```

Implemented change in comment at https://github.com/mitsuhiko/flask/pull/514#commitcomment-1395733

```
[TOX] py25: commands succeeded
[TOX] py26: commands succeeded
[TOX] py27: commands succeeded
[TOX] pypy: commands succeeded
[TOX] congratulations :)
```

Rephrased a region of the report of the Registry.

I am very new to python, flask, heroku, git etc. but I was able to easily and successfully flow through the quickstart guide and get the minimal app deployed on heroku.  I was very impressed with documentation flow and accuracy.  However, I ran into a significant stumbling block with the "HTTP Methods" section.  There were two issues that caused me stumble and I think others may stumble here as well.

The most significant issue was that the login example code calls descriptive stubs that don't exist.  This may be fine for those that already understand what the example is showing, but for people like me that learn by trying to run the code examples, it took quite a while to figure that my app was crashing due to the non-existent function calls.

The second issue involves the difference between the flask routing and what I was familiar with for form processing in PHP.   I initially expected something along the lines of a login.py script that would get invoked by <code>action="http://mysite.com/login.py"</code> attribute of the form.

Eventually I figured out how it worked by creating what I believe would be a more easily understood example for the method and form functionality.  This is the code that I eventually created to learn and confirm the functionality.

Please consider revising the Flask example(s) to show code that can actually be executed like the previous examples I have tried, and to show what the HTML would look like if needed. 

```
@app.route('/form', methods=['POST', 'GET'])
def form():
    if request.method == 'POST':
        return 'form POST dictionary: %s' % request.form
    if request.method == 'GET':
        return 'form GET args: %s' % request.args
```

```
<form method="POST" action="http://your_sites_url_here.com/form">
  Username: <input type="text" name="username" size="15" /><br />
  Password: <input type="password" name="password" size="15" /><br />
            <p><input type="submit" value="Login" /></p>
 </form>
```


Fix failing test: `AssertionError: 'application/javascript' != 'application/json'` in `flask/testsuite/helpers.py`, line 88

``` bash
ddrouin@Dave:~> git clone https://github.com/mitsuhiko/flask.git 
Cloning into 'flask'...
```

**version** = '0.9-dev' appears in flask/flask/**init**.py 

Tests run with Python 2.7.3 on Ubuntu 12.04 LTS

``` bash
ddrouin@Dave:~/flask> python run-tests.py 
........................................................................................................................................E..................................................
======================================================================
ERROR: test_jsonify (flask.testsuite.helpers.JSONTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/ddrouin/flask/flask/testsuite/helpers.py", line 88, in test_jsonify
    self.assert_equal(rv.mimetype, 'application/json', url)
TypeError: assert_equal() takes exactly 3 arguments (4 given)

----------------------------------------------------------------------
Ran 187 tests in 0.706s

FAILED (errors=1)
```

/kw and /dict work fine, occurs on /unpadded.
simplejson is present, version 2.3.2

line 136 in flask/flask.helpers has:

``` python
if 'padded' in kwargs:
     ....
     return current_app.response_class(content, mimetype='application/javascript')
```

So the defect is triggered by kwargs containing {'padded': False}.  To fix this - I ended up changing my copy to this and now the tests all pass:

``` python
    if 'padded' in kwargs:
        padded = kwargs['padded']
        del kwargs['padded']
    else:
        padded = False

    if padded:
        if isinstance(padded, str):
            callback = request.args.get(padded) or 'jsonp'
        else:
            callback = request.args.get('callback') or \
                       request.args.get('jsonp') or 'jsonp'
        json_str = json.dumps(dict(*args, **kwargs), indent=None)
        content = str(callback) + "(" + json_str + ")"
        return current_app.response_class(content, mimetype='application/javascript')
    return current_app.response_class(json.dumps(dict(*args, **kwargs),
        indent=None if request.is_xhr else 2), mimetype='application/json')
```

https://github.com/gyllstromk/Flask-WhooshAlchemy

I'm happy to resolve any issues.

https://github.com/gyllstromk/Flask-WhooshAlchemy

as the title says, can i use jsonify as this:

jsonify( [ { 'a': 1, 'b': 2 }, { 'c': 3, 'd': 4 } ] )

Link to docs:
http://flask.pocoo.org/docs/extensions/#flask-before-0-8

In some application I was writing I created a decorator to allow for streaming responses:

``` python
def stream(*args, **kwargs):
    def wrapper(f):
        @functools.wraps(f)
        def wrapped(*a, **kw):
            return flask.Response(f(*a, **kw), *args, **kwargs)

        return wrapped

    return wrapper
```

and another one to JSON'ify the response:

``` python

def jsonify(f):
    @stream(
        content_type='application/json',
        headers={
            'Cache-Control': 'no-cache',
        })
    @functools.wraps(f)
    def wrapped(*args, **kwargs):
        res = f(*args, **kwargs)

        for chunk in json.JSONEncoder().iterencode(res):
            yield chunk

    return wrapped
```

Using these on handlers which require access to a context fails though:

RuntimeError: working outside of request context

Full example with some ok and not-ok handers is available at https://gist.github.com/4a443e8214c2c6eea1a5

The "on bitbucket" link for the flask-login extension listed at http://flask.pocoo.org/extensions/ is incorrect. 

It should read:

"on github": https://github.com/maxcountryman/flask-login/




The comment in `flask.Blueprint.errorhandler` notes, "Please be aware that routing does not happen local to a blueprint so an error handler for 404 usually is not handled by a blueprint unless it is caused inside a view function."

Please add Blueprint-local routing for errors triggered by any request to an endpoint defined by a blueprint.

Bam! Also collapses multiple `json.dumps()` and `response_class()` statements into a single one, respectively. This is done because it will come in handy in the future when making changes to the arguments to those function calls.

Is this a problem?

```
>>> from flask import safe_join
>>> safe_join('/foo', '..')
'/foo/..'
```

I think it could be if we’re exposing not just files but also directories (maybe making indexes, ...). Should safe_join check for `'..'` and not just `'../'` ?

If flaskr loads into firefox 11 the css style sheet: flask/examples/flaskr/static/style.css doesn't render. 
I was able to correct it by renaming style.css to anythingelse.css. I believe that firefox is overriding style.css with its own style.css

This fixes issue #491

I would add a unit test for this, but, I'm not sure how I would test two separate domains since that's linked to server config. 


Flask.inject_url_defaults() incorrectly splits endpoint's to get blueprint's name. 

replaced call to endpoint.split() by endpoint.rsplit() on line 1471 of flask/app.py


When calling jsonify with the padded argument as True the expected behavior is padded JSON response that uses the callback argument. Example

``` javascript
handleResponse({"foo": "bar"})
```

However when setting padded to False the result is still a padded JSON response with the name of the callback function set to jsonp. Example

``` javascript
jsonp({"foo": "bar"})
```

Should be

``` javascript
{"foo": "bar"}
```

The Flask.inject_url_defaults() function splits the endpoint at the wrong location to retrieve the name of the blueprint. This causes url_for() not to work properly for blueprints when combined with Blueprint.url_defaults()

e.g.
endpoint = "catalogue.admin.products.index"
bp = endpoint.split('.', 1)[0]

bp is now 'catalogue' rather than 'catalogue.admin.products'

I presume rsplit() would be more appropriate than split() for this one. 

Because bountiful blunders damage delightful documentation. 

Marked Flask-Restless as approved extension. For more details see #485.

having 'example.com' and 'example.org' running on the same server with the same data backend I thought it would be simple to serve both from a single Flask app, especially since Werkzeug has host_matching but it isn't.

I currently workaround this by 'injecting' hostname into urls with nginx's url rewrites but this is a bit too hackish, you know.

I would like to have syntax like this:

```
@app.route("/", host="example.org")
def hello():
    return "Hello World!"
```

I tripped over this recently, and felt it was worth noting more clearly in the docs that the local internal webserver is HTTP/1.0 only, which is likely to cause AJAX libraries to fail in hard to notice ways (JQuery is an example).  

HIH

Thank you 



flask relies on loader.is_package in find_package(import_name) of flask.helpers

however that method is optional as per PEP 302, this it breaks with loaders that don't implement it


Source at https://github.com/jfinkels/flask-restless, documentation at http://readthedocs.org/docs/flask-restless. All requirements are met once I release version 0.5 tonight (which includes dual license—GNU AGPLv3 or BSD).

At the Flask sprint, @garbados split the foreword into two sections in #438, which I approve.  Now it's waiting on me to pass through the new foreword and revise as needed.  Excellent contribution; just needs a committer to make a pass.


- Custom theme? Should work.
- Autodoc? Yes.
- Other extensions? I don't know.

It should be possible to force the URL scheme to https for all things. That includes URL generation as well as automatic redirect checks on all requests.

I am not sure if this is a bug in Sphinx, but stuff like the `root_path` and `static_url_path` attributes/properties from `_PackageBoundObject` end up not documented in the API page of the docs. `api.rst` just contains this:

```
.. autoclass:: Flask
   :members:
   :inherited-members:
```

Fixes #477

Using 

```
return jsonify(d), 201
```

results in returning the client a response with the intended status code and body, but with a text/html mimetype.

I realize this may not be the intended way of using jsonify and the status code shortcut, nevertheless if would be a neat feature.

For the records, if you need to use jsonify and need to return a custom status code you could do

```
response = jsonify(d)
response.status_code = 201
return response
```

Or extend jsonify (I created a gist here: https://gist.github.com/2336085).

```
>>> collection = connection['test'].users
>>> user = {'name': u'admin', 'email': u'admin@localhost'}
>>> collection.insert(user)

print list(collection.find())
print collection.find_one({'name': u'admin'})
```

line 125 and 126 maybe missing ">>>" ,am I right?

Add favicon.

solves issue #472.
tests changes made in #417

test to check changes made to resolve issue #417

Flask-Restless is about to release version 0.5 with support for Flask-SQLAlchemy.

Add a test for #417.

Fix for issue #220 which adds a default `JSONEncoder` implementation to `Flask.json_encoder_class`, which users can override with their own implementation. Also makes jsonify use `current_app.json_encoder_class` as its encoder class. This is solution 1 as proposed by @jparise.

This solution asks users to subclass `flask.JSONEncoder`, which is now exposed as part of the public API for Flask. `flask.JSONEncoder` simply serializes `datetime` objects to ISO 8601 format strings. It can be changed in the future if some other data type becomes common, but I believe this is a reasonable default.

Marked Flask-SeaSurf as approved extension.
Unlisted flask-csrf, bacause it's nearly the same as Flask-SeaSurf, but with cheaper api, and it was marked to be unlisted.

First, [RFC 6265](https://tools.ietf.org/html/rfc6265) said:
> Origin servers SHOULD NOT fold multiple Set-Cookie header fields into a single header field.


But in flask-admin login(with flask-user) login response, multiple set-cookie(s) are folded:
> Set-Cookie: remember_token=...; Expires=Tue, 06-Feb-2018 05:23:25 GMT; Path=/
session=...; HttpOnly; Path=/

**CAUTION: Path=/[without a space]session=**

And in werkzeug, multiple Set-Cookie unittest(I added this code in werkzeug/tests/test_wrappers.py below), and passed.

    # set multi cookie once
    response = wrappers.BaseResponse()
    response.set_cookie('foo', 'bar', 60, 0, '/blub', 'example.org')
    response.set_cookie('blar', 'zag', 60, 0, '/blob', 'example.org')
    strict_eq(response.headers.to_wsgi_list(), [
        ('Content-Type', 'text/plain; charset=utf-8'),
        ('Set-Cookie', 'foo=bar; Domain=example.org; Expires=Thu, '
         '01-Jan-1970 00:00:00 GMT; Max-Age=60; Path=/blub'),
        ('Set-Cookie', 'blar=zag; Domain=example.org; Expires=Thu, '
         '01-Jan-1970 00:00:00 GMT; Max-Age=60; Path=/blob')
    ])

So I think this maybe a bug or flask. 
Any thought appreciated.

~~~python
@app.route('/<date>/<username>/<path:filename>')
@login_required
@nocache
def custom_static(filename, username, date):
    path = os.path.join(app.config['CUSTOM_STATIC_PATH'],"username", username, date)
    print "Path: {}".format(path)
    if os.path.isfile(os.path.join(path, filename)):
        return send_from_directory(path, filename)
    else:
        print "File does not exist: {}".format(filename](url))
        return
~~~

~~~
Path: ./DataWebserver/username/js/static
File does not exist: bootstrap-datepicker.min.js
~~~
I want to use dynamic extends,like this
`{% extends {{file}} %}`

this "file" is come from python file.
but I'cant use it,how to solve it?
I'm seeing some strange behavior I can't really explain. My CORS requests are hanging for long periods 10, 20, 30 seconds and I'm not sure why. It seems to be specific to both Flask and Chrome.

I'm using python 3.4.3, Flask 0.12, and Flask-Cors 3.0.2.

Consider the following Flask server that returns some basic HTML and some javascript that makes and AJAX request to an API.

```
from flask import Flask

app = Flask(__name__)

@app.route("/page1")
def page1():
    return '''
    <html>
        <head>
            <script>
                function resHandler () {
                    document.getElementById('status').innerHTML = 'done!';
                }

                function gopherIt() {
                    document.getElementById('status').innerHTML = 'making request...';
                    var oReq = new XMLHttpRequest();
                    oReq.addEventListener("load", resHandler);
                    oReq.open("GET", "http://localhost:3000/hang");
                    oReq.send();
                }
            </script>
        </head>
        <body>
            <div>
                <input type="button" value="Hang In There" onclick="gopherIt()" />
                <span id="status">Click the button</span>
            </div>
            <a href="http://localhost:8080/page2">Go to page 2</a>
        </body>
    </html>
    '''

@app.route("/page2")
def page2():
    return '''
    <html>
        <body>
            page 2
        </body>
    </html>
    '''

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
```

Here is the Flask API with CORS enabled:

```
from flask import Flask, json
from flask_cors import CORS

app = Flask(__name__)
CORS(app)

@app.route("/hang")
def hang10():
    return json.dumps({'iamkule': True})

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=3000)
```

Which renders a page like this:

![image](https://cloud.githubusercontent.com/assets/1686534/22615826/61772198-ea63-11e6-8a38-e3456bf2d175.png)

Steps to reproduce:

1. Click the `Go to page 2` link
2. Click the back browser's button
3. Click the `Hang In There` button

You'll see a message next to the button that says "making request..." that basically just sits there while the API request hangs. Sometimes clicking it multiple times kinds of wakes it up and fixes it but not always. Sometimes it will also happen right after you refresh the page. It isn't as consistent as using the back button though.

If you open the Chrome debugger you can see all the XHR requests just sitting there.

![image](https://cloud.githubusercontent.com/assets/1686534/22615858/9608c906-ea64-11e6-851c-217028ee2030.png)


Here are some interesting points to consider:

1. This does not happen when the CORS library is not used. If I open Chrome with the same origin policy checks disabled by running `open -a Google\ Chrome --args --disable-web-security --user-data-dir` and run the app, it will not hang.

2. This happens in Chrome on both macOS Sierra and Windows 10.

3. This does not happen in Firefox on Mac or Windows.

4. This does not happen in node. I rewrote the exact same static server and API using node and express and everything works fine (which is why I'm posting this here).

So it kind of seems like some combination of Flask and Chrome not getting along. Does anyone have any ideas about what's going on here?


when i am running python3 test.py it is working fine with mysql
but when i running on apache server i am getting **wsgi error no module name mysql**

Moved to https://github.com/pallets/werkzeug/issues/1068
I am having issues when retrieving static components on subfolders in my project. Let me explain

My structure is as follows:

Main.py
--- App1.py
--- App2.py

It is, i have a main page that has links that refers to App1.py or App2.py, which are also flask programs

When i access App1.py, i dont have static content displayed. The html of the page is correctly displayed (under templates/App1/app1.html), but, looks like it is unable to find the static component referred in that page (i am referring from the html to static component under static/app1/css/app1.css). I have a 404 response

Is that something that is not supported by flask?

Thanks
This will instruct Flask to read .env files and then to load the
environment variables from there.  Additionally it automatically
changes the working directory to the path the .env is contained in.
For an installed app there is currently no clean way to provide a custom (e.g. `testapp`) console script instead of using the `flask` script (which needs FLASK_APP to be set) - using any entry point that resides within the app's package would stop the reloader from surviving import-time errors in the app's package.

With this PR it's easy to define a custom console script and also specify its app or app factory, making `FLASK_APP` unnecessary when using that script.

The application's setup.py would simply have to add this to the `setup()` call:

```python
    entry_points={
        'console_scripts': [
            'testapp = flask.cli:main'
        ],
        'flask.cli_apps': [
            'testapp = testapp.app:make_app'
        ]
    }
```

---

### TODO

- [x] Override default FlaskGroup help for custom commands (do not mention `FLASK_APP`)
- [x] Changelog
- [x] Docs
- [ ] Tests?
When I use Flask 0.12 in my Google App Engine project I get no error messages. So a function that might throw an error would result in a log like:

```
INFO     2017-01-29 00:03:05,820 sdk_update_checker.py:229] Checking for updates to the SDK.
INFO     2017-01-29 00:03:06,428 api_server.py:205] Starting API server at: http://localhost:54929
INFO     2017-01-29 00:03:06,432 dispatcher.py:197] Starting module "default" running at: http://127.0.0.1:8080
INFO     2017-01-29 00:03:06,434 admin_server.py:116] Starting admin server at: http://localhost:8000
INFO     2017-01-29 00:03:10,212 module.py:787] default: "GET / HTTP/1.1" 500 291
INFO     2017-01-29 00:03:11,711 module.py:787] default: "GET /favicon.ico HTTP/1.1" 404 233
```

whereas when I downgrade to Flask 0.11.1 I actually get the error messaging I've come to know and love:

```
INFO     2017-01-28 23:58:06,986 sdk_update_checker.py:229] Checking for updates to the SDK.
INFO     2017-01-28 23:58:07,234 api_server.py:205] Starting API server at: http://localhost:54720
INFO     2017-01-28 23:58:07,238 dispatcher.py:197] Starting module "default" running at: http://127.0.0.1:8080
INFO     2017-01-28 23:58:07,240 admin_server.py:116] Starting admin server at: http://localhost:8000
ERROR    2017-01-28 23:58:11,804 app.py:1587] Exception on / [GET]
Traceback (most recent call last):
  File "/Users/alex/yphh/petition_companies/lib/flask/app.py", line 1988, in wsgi_app
    response = self.full_dispatch_request()
  File "/Users/alex/yphh/petition_companies/lib/flask/app.py", line 1641, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/Users/alex/yphh/petition_companies/lib/flask/app.py", line 1544, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/Users/alex/yphh/petition_companies/lib/flask/app.py", line 1639, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/alex/yphh/petition_companies/lib/flask/app.py", line 1625, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/Users/alex/yphh/petition_companies/main.py", line 70, in index
    1 / 0
ZeroDivisionError: integer division or modulo by zero
INFO     2017-01-28 23:58:11,821 module.py:787] default: "GET / HTTP/1.1" 500 291
INFO     2017-01-28 23:58:13,100 module.py:787] default: "GET /favicon.ico HTTP/1.1" 404 233
```

Aside from the traceback the two are the same.
I'm trying to start the extremely basic flask application noted here: http://flask.pocoo.org/docs/0.12/quickstart/

When I try to run "flask run" however I get the following error 

```
 * Serving Flask-SocketIO app "hello"
Traceback (most recent call last):
  File "/usr/local/bin/flask", line 11, in <module>
    load_entry_point('Flask', 'console_scripts', 'flask')()
  File "/home/rohan/flask/flask/cli.py", line 513, in main
    cli.main(args=args, prog_name=name)
  File "/home/rohan/flask/flask/cli.py", line 380, in main
    return AppGroup.main(self, *args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 696, in main
    rv = self.invoke(ctx)
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 1060, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 889, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 534, in invoke
    return callback(*args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/click/decorators.py", line 64, in new_func
    return ctx.invoke(f, obj, *args[1:], **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 534, in invoke
    return callback(*args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/flask_socketio/cli.py", line 58, in run
    run_server()
  File "/usr/local/lib/python2.7/dist-packages/flask_socketio/cli.py", line 50, in run_server
    socketio = app.extensions['socketio']
KeyError: 'socketio'
```

I've tried installing Flask via pip as well as from source, and verified that all the dependencies are installed. If I use the `app.run()` command in `main` it works fine, but I'd like to use `flask run` after exporting the program name but it doesn't seem to work. I've followed the instructions exactly from the website. Any advice? 

Hi,
I try to pass information in headers, such as passwords.
When receiving it in my program, special characters are not properly decoded, such as €£ and french accented chars.
It works fine if they're encoding in regular http args.

Example:
> curl -v  --header "user_email:toto@toto.com" --header "user_password:é€"  -X GET  "http://localhost:5000/api/private/v1.0/auth"
 >  Trying ::1...
 > connect to ::1 port 5000 failed: Connection refused
 > Trying 127.0.0.1...
 > Connected to localhost (127.0.0.1) port 5000 (#0)
> GET /api/private/v1.0/auth HTTP/1.1
> Host: localhost:5000
> User-Agent: curl/7.43.0
> Accept: */*
> user_email:toto@toto.com
> user_password:é€`



On the app side:

> Headers=Accept: */*
> Content-Length: 
> User-Agent: curl/7.43.0
> User-Password: Ã©â¬
> Host: localhost:5000
> User-Email: toto@toto.com
> Content-Type: 



Thank you for the awesome framework first!
      Sorry I find the problem was flask-session connecting  remote redis caused

I have set `FLASK_APP=manage.py', but got：

```
Error: The file/path provided (manage) does not appear to exist.  Please verify the path is correct.  If app is not on PYTHONPATH, ensure the extension is .py
```
Update from upstream
I have a handler that returns a 204 with no Content-Type, like this:
```python
from flask import Response

def make_204_response():
    resp = Response('', 204)
    del resp.headers['Content-Type']
    return resp
```

It works as expected, but when I run my unit tests using webtest I get this error:
```
Exception AssertionError: AssertionError(u'Iterator garbage collected without being closed',) in <bound method IteratorWrapper.__del__ of <webtest.lint.IteratorWrapper object at 0x7f90f7a6b550>> ignored
```

It looks like webob had pretty much the same problem:
https://github.com/Pylons/webob/issues/305
I got confused why setting FLASK_DEBUG environment variable to `False`, as it's written in Python, didn't disable debug.
Cleanup sphinx formatting to show that `request` is an object, not a class. The actual class name is `Request`.

Based on discussion [here](https://github.com/pallets/flask/pull/2151#issuecomment-272699147).
Is there any reason not to switch to markdown and add a build badge?
Addresses #2109 
Points flask.Request to appropriate place in the documentation.
I attempted to replace flask's internal [`session`](http://flask.pocoo.org/docs/0.12/quickstart/#sessions) by [implementing](http://flask.pocoo.org/snippets/75/) redis.  I thought this was a good idea, since it would mean more secure sessions, since they are not stored as cookies, rather on the redis-server:

- http://flask.pocoo.org/snippets/75/
- https://github.com/mrichman/flask-redis/blob/master/redissession.py

After copying the latter [reference](https://github.com/mrichman/flask-redis/blob/master/redissession.py), as [`redis_session.py`](https://github.com/jeff1evesque/machine-learning/blob/340e19ab43cd2162b712d1f485e69411ec83fe91/brain/cache/redis_session.py), followed by adjusting [`factory.py`](https://github.com/jeff1evesque/machine-learning/commit/4eea9251f69e392d2ce2e5ca6bbd2d53c964d2b0):

```python
            # replace default cookie session with server-side redis
            app.session_interface = RedisSessionInterface()
```

My travis ci indicated a [failed](https://travis-ci.org/jeff1evesque/machine-learning/builds/190594385#L3623-L3725) build:

>E           ConnectionError: Error 111 connecting to localhost:6379. Connection refused.

I'm not sure why my application failed to connect to redis.  The redis-server should have properly started via [`redis.dockerfile`](https://github.com/jeff1evesque/machine-learning/blob/962cfee5d8031fc09802da82f04b04a6280d4242/redis.dockerfile#L12), which is implemented by the overall [`travis.yaml`](https://github.com/jeff1evesque/machine-learning/blob/e801c5f8bffdf1b402af760c4ccbb2faf9991d76/.travis.yml#L105).  Prior to actually implementing `redis_session.py`, my application was already using redis successfully for other things (like serializing sciki-learn objects, and storing it into redis), as indicated by [prior builds](https://travis-ci.org/jeff1evesque/machine-learning/builds/190431244#L3624).  Specifically, the `test_model_generate` function from [`pytest_svm_file_upload.py`](https://github.com/jeff1evesque/machine-learning/blob/203ec97281314c9ca97ab58b0e3a3e7342990bd5/test/live_server/programmatic_interface/file_upload/pytest_svm_file_upload.py#L106-L125), basically computes a prediction object, then stores it into redis via a custom [`cache`](https://github.com/jeff1evesque/machine-learning/blob/203ec97281314c9ca97ab58b0e3a3e7342990bd5/brain/cache/cache_model.py#L45-L58) method:

```python
    def cache(self, hash_name, key):
        '''@cache
        This method serializes, then caches the provided model into a redis
        hash cache.
        '''

        try:
            serialized = Serialize_Model(self.model).serialize()
            self.myRedis.hset(hash_name, key, serialized)
        except Exception, error:
            self.list_error.append(str(error))
            print self.list_error
```

If the model was not properly cached into redis, then my successive unit test, [`test_model_predict`](https://github.com/jeff1evesque/machine-learning/blob/203ec97281314c9ca97ab58b0e3a3e7342990bd5/test/live_server/programmatic_interface/file_upload/pytest_svm_file_upload.py#L128-L147) which uncaches the same model, in order to perform corresponding computation, would fail.

Because my travis ci [builds](https://travis-ci.org/jeff1evesque/machine-learning/builds) began breaking with the introduction of overloading [`app.session_interface = RedisSessionInterface()`](https://github.com/jeff1evesque/machine-learning/commit/4eea9251f69e392d2ce2e5ca6bbd2d53c964d2b0#diff-ab2c5ef35603caa654ec40f8cad9162aR53) in my app factory, I'm wondering if the problem is redis, flask, docker, or a combination of the three?
Hi,

Whilst working on the "reproducible builds" effort [0], we noticed that flask-restful could not be built reproducibly.

SOURCE_DATE_EPOCH is explained [1]

[0] https://wiki.debian.org/ReproducibleBuilds
[1] https://wiki.debian.org/ReproducibleBuilds/TimestampsProposal


python 3.6 has deprecated the use of flags not at the start of regular expression,
plans for 3.7 is to rasie an exception: [http://bugs.python.org/issue22493](http://bugs.python.org/issue22493)

new on 3.6  [ModuleNotFoundError](https://docs.python.org/3/library/exceptions.html#ModuleNotFoundError)


What I am missing ?

```
aceback (most recent call last):
  File "main.py", line 225, in <module>
    main = Main()
  File "main.py", line 38, in __init__
    self.start_flask()
  File "main.py", line 44, in start_flask
    self.flask.run()
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 827, in run
    from werkzeug.serving import run_simple
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 70, in <module>
    from BaseHTTPServer import HTTPServer, BaseHTTPRequestHandler
  File "/usr/lib/python2.7/BaseHTTPServer.py", line 102, in <module>
    class HTTPServer(SocketServer.TCPServer):
AttributeError: 'module' object has no attribute 'TCPServer'
```

My code is:

```
from flask import Flask
app = Flask(__name__)

@app.route("/")
def hello():
    return "Hello World!"

if __name__ == "__main__":
    app.run()
```

What I am missing ?
Allow an default errorhandler for all HTTPException.

This will come handy when building a REST API where you want all Errors return JSON instead of the default behaviour.

PR https://github.com/pallets/flask/pull/2082 solves the same problem, but it didn't work in my environment. Tests are included.
The Flask 0.12 apparently changed the name of the file transfer. everything is stable in Flask 0.11-0.11.1.
http://flask.pocoo.org/ (BTW, can I haz HTTPS please?) says:

>  Latest Version: 0.11 

It should say:

>  Latest Version: 0.12 

(with the correct link).

:sparkles: 


This is your own development?

A very simple boilerplate Google App Engine example using Flask fails when upgrading from 0.10 to 0.12.  The problem is something cryptic relating to module path resolution.  

The straight-off-the-web GAE Flask Hello World example works fine when deployed to a live GAE project.  The reason why this works ok is that it is so simple that it makes no use of third-party libraries outside of those that are natively installed along with Flask as a standard 'pip' install.

But when I extended this example to make the simplest use of the Google Cloud Datastore, then when the code is deployed, and a GET request is made, it fails with the following stack traceback:
> Traceback (most recent call last):
>   File "/google/google-cloud-sdk/platform/google_appengine/google/appengine/runtime/wsgi.py", line 240, in Handle
>     handler = _config_handle.add_wsgi_middleware(self._LoadHandler())
>   File "/google/google-cloud-sdk/platform/google_appengine/google/appengine/runtime/wsgi.py", line 299, in _LoadHandler
>     handler, path, err = LoadObject(self._handler)
>   File "/google/google-cloud-sdk/platform/google_appengine/google/appengine/runtime/wsgi.py", line 85, in LoadObject
>     obj = __import__(path[0])
>   File "/home/cinchent/flask-skel/main.py", line 8, in <module>
>     from google.cloud import datastore
> ImportError: cannot import name datastore

Digging deeper into this, I tried to use the GAE development application server on my local Windows box, and lo! then even the stock Hello World example fails: Flask is unable to even successfully import the native Python 'msvcrt' module from within its own Click initializer.  Here's the traceback from that:

> Traceback (most recent call last):
>   File "C:\Program Files (x86)\Google\Cloud SDK\google-cloud-sdk\platform\google_appengine\google\appengine\runtime\wsgi.py", line 240, in Handle
>     handler = _config_handle.add_wsgi_middleware(self._LoadHandler())
>   File "C:\Program Files (x86)\Google\Cloud SDK\google-cloud-sdk\platform\google_appengine\google\appengine\runtime\wsgi.py", line 299, in _LoadHandler
>     handler, path, err = LoadObject(self._handler)
>   File "C:\Program Files (x86)\Google\Cloud SDK\google-cloud-sdk\platform\google_appengine\google\appengine\runtime\wsgi.py", line 85, in LoadObject
>     obj = __import__(path[0])
>   File "C:\CINCH\Freewave\GCP\appengine-flask-skeleton\main.py", line 8, in <module>
>     from flask import Flask
>   File "C:\CINCH\Freewave\GCP\appengine-flask-skeleton\lib\flask\__init__.py", line 21, in <module>
>     from .app import Flask, Request, Response
>   File "C:\CINCH\Freewave\GCP\appengine-flask-skeleton\lib\flask\app.py", line 26, in <module>
>     from . import json, cli
>   File "C:\CINCH\Freewave\GCP\appengine-flask-skeleton\lib\flask\cli.py", line 17, in <module>
>     import click
>   File "C:\CINCH\Freewave\GCP\appengine-flask-skeleton\lib\click\__init__.py", line 18, in <module>
>     from .core import Context, BaseCommand, Command, MultiCommand, Group, \
>   File "C:\CINCH\Freewave\GCP\appengine-flask-skeleton\lib\click\core.py", line 7, in <module>
>     from .types import convert_type, IntRange, BOOL
>   File "C:\CINCH\Freewave\GCP\appengine-flask-skeleton\lib\click\types.py", line 4, in <module>
>     from ._compat import open_stream, text_type, filename_to_ui, \
>   File "C:\CINCH\Freewave\GCP\appengine-flask-skeleton\lib\click\_compat.py", line 164, in <module>
>     import msvcrt
>   File "C:\Program Files (x86)\Google\Cloud SDK\google-cloud-sdk\platform\google_appengine\google\appengine\tools\devappserver2\python\sandbox.py", line 964, in load_module
>     raise ImportError('No module named %s' % fullname)
> ImportError: No module named msvcrt

GAE runs the Flask webapp within a sandbox, but it provides the proper module paths to the installed modules, provided those obey a somewhat orthodox Python path resolution technique, but whatever exotic technique Flask now uses in 0.12 fails within that sandbox.  (Other third-party libraries can be imported from within the sandbox just fine.)

These problems are completely absent in Flask 0.10.  (Once you're past the problem of importing 'protobuf', that is, a separate but known incompatibility with GAE's internal use, which has a workaround.)

I've googled high and low for any information about what I may be missing in the Flask initialization recipe -- surely I must not be the only person to have encountered this! -- but have turned up nothing.

---
In the enclosed 'main.py', setting the DATASTORE_EXAMPLE global to False causes it to behave as the stock GAE Hello World example app, and setting it to True extends that app to attempt use of the Cloud Datastore.

[bundle.zip](https://github.com/pallets/flask/files/681314/bundle.zip)

Add a trailing slash to the dummy static path alias in the fastcgi lighttpd setup
documentation. Omitting a trailing slash leads to unintended behavior.

Without the trailing slash, the result of the lighttpd alias looks like this(in debug mode):

    2017-01-02 02:25:11: (response.c.624) -- file not found
    2017-01-02 02:25:11: (response.c.625) Path : /var/www/myapp/staticfoo.txt

Instead of `/var/www/myapp/static/foo.txt`
When I run the 5th command 'flask run' for example/flaskr. It shows error

```
* Serving Flask-SocketIO app "flaskr"
Traceback (most recent call last):
  File "/usr/local/bin/flask", line 9, in <module>
    load_entry_point('Flask==0.13.dev0', 'console_scripts', 'flask')()
  File "/usr/local/lib/python2.7/dist-packages/flask/cli.py", line 507, in main
    cli.main(args=args, prog_name=name)
  File "/usr/local/lib/python2.7/dist-packages/flask/cli.py", line 374, in main
    return AppGroup.main(self, *args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 696, in main
    rv = self.invoke(ctx)
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 1060, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 889, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 534, in invoke
    return callback(*args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/click/decorators.py", line 64, in new_func
    return ctx.invoke(f, obj, *args[1:], **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 534, in invoke
    return callback(*args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/flask_socketio/cli.py", line 58, in run
    run_server()
  File "/usr/local/lib/python2.7/dist-packages/flask_socketio/cli.py", line 50, in run_server
    socketio = app.extensions['socketio']
KeyError: 'socketio'
```

How to solve this problem? Thankyou very much!

Fix #2132
Fixes: #2132
Signed-off-by: Patrick Uiterwijk <patrick@puiterwijk.org>
Currently this will cause `flask run` to show a `NoAppException` error:
```
from flask import Flask

raise ImportError()

testapp = Flask('testapp')
``` 

The expected behavior is to see the `ImportError` when you visit the page instead of the  `NoAppException` error.

This happens because the code does not differentiate between an `ImportError` when `flask run` tries to import the module and an `ImportError` from the module after it is imported.

The fix came from here: http://stackoverflow.com/a/24262408
Since Werkzeug 0.9, request.form is populated for all requests as long as they contain a Content-Type header (https://github.com/pallets/werkzeug/blob/master/werkzeug/wrappers.py#L328).
The Flask documentation however implies that request.form is only available with POST and PUT requests, and that is the case with Werkzeug<0.9 (well, 0.8.3 parses for POST, PUT and PATCH).
I chose the wrong base: https://github.com/pallets/flask/pull/2130

Original PR message:

> Addresses: #1902 (comment)
> 
> Confirms that the larger application as outlined in the docs, works as expected. For the sake of less confusion, for those working through this example, having src might be helpful. Not everyone will want to work along with the docs. If there are parts of the docs that are not clear, we should fix that as well. (They seemed clear to me).

Thiefmaster's response:

> The weird commits in this PR aside (rebase to upstream/master and force-push to fix), I'm not sure how useful this is to have in the repo... Especially since having a "large" app without an app factory is somewhat questionable...

My response:

> @ThiefMaster Sorry about that. I didn't choose correct base. I was thinking that in order to debug issues that people are having with code examples in the docs, it would be useful to have those examples on-hand.
> 
> I agree. But maybe until we can put something better together for #2027, this addition could just be temporary and we could deprecate this "larger applications" example at later time.
Addresses: https://github.com/pallets/flask/issues/1902#issuecomment-269781735

Confirms that the larger application as outlined in the docs, works as expected. For the sake of less confusion, for those working through this example, having src might be helpful. Not everyone will want to work along with the docs. If there are parts of the docs that are not clear, we should fix that as well. (They seemed clear to me).
Hello. How to setup this website?  Which script I should run then visit this website through 'losthost:5000'?
In python 3.6 Flask can't run and return error:

> Traceback (most recent call last):
  File "D:\enviroments\flask\lib\site-packages\werkzeug\serving.py", line 65, in <module>
    from SocketServer import ThreadingMixIn, ForkingMixIn
ModuleNotFoundError: No module named 'SocketServer'
During handling of the above exception, another exception occurred:
Traceback (most recent call last):
  File "C:/Users/User/Desktop/Blueprints/main.py", line 25, in <module>
    application.run()
  File "D:\enviroments\flask\lib\site-packages\flask\app.py", line 827, in run
    from werkzeug.serving import run_simple
  File "D:\enviroments\flask\lib\site-packages\werkzeug\serving.py", line 68, in <module>
    from socketserver import ThreadingMixIn, ForkingMixIn
ImportError: cannot import name 'ForkingMixIn'
Why doesn't flask reload when I change my code? It should automatically reload my app.... Is flask-script now obsolete in 0.12 flask? 

https://github.com/smurfix/flask-script/issues/172

Sorry to post this here as it is probably a question as opposed to an issue, but my query on stackoverflow yielded no answers. See http://stackoverflow.com/questions/40666325/flask-application-starts-without-giving-debugging-pin-also-no-request-info-disp

Any suggestions how to debug this would be appreciated.



'code icon', 'file code outline icon' is showing different then the link http://semantic-ui.com/elements/icon.html

http://jsfiddle.net/efp8z6Ln/428/
Fix #2118
This allows for
```
python flaskr.py initdb
python flaskr.py run
```
Hi, Im only posting my issue here as a last resort, I understand this is a bug tracker. But I think its fair to say that flask default session lasting 31 days is a bug and security flaw in itself, and havent found an easy way to change this.  Im simply trying to set a timeout of 15 minutes idle activity for my user sessions (site-wide but particularly for my @login_required '/dashboard/' area) I tried eliminating different variables to solve the problem but still the session lasts indefinitely.  Heres the post of my imports, config, dashboard, blueprint, register / login system in its entirety (dont worry its rather succinct).  Hopefully someone can see an error I overlooked.  Thank you.

https://dpaste.de/1pVD
It's done like this in other parts of this doc.
add step 2 to run minitwit
when I read my instance config file, I get an error. 

> exec(compile(config_file.read(), filename, 'exec'), d.__dict__)
> UnicodeDecodeError: 'gbk' codec can't decode byte 0x80 in position 437: illegal multibyte sequence
Then I modify the code of config.from_pyfile to this

> with open(filename, 'rb') as config_file:
The problem is resolved. 


This PR contains an update to docs/testing.rst:

The testing documentation was missing `TESTING` config from one of the examples.

fixes #1302 

I don't think that comma belongs there.
Implemented the solution purposed by @dsully for issue #1286 
I have an HTML template that works correctly and downloads a file when open it directly in the browser (Chrome or Firefox), but the window.open command does not run (does not download the file) when the HTML is called from flask.

<script>
window.open("file:///C:/mypath/mywordfile.docx")
</script>

see attached sample
[issue.txt](https://github.com/pallets/flask/files/659321/issue.txt)

When running a development server, using `flask run`, with the `SERVER_NAME` config variable set to a port number other than 5000, the server still defaults to 5000. Looking into the code, it seems that [`flask.cli.run_command`](https://github.com/pallets/flask/blob/7fca843b5f361e79534bd18c4cd20f3f44094337/flask/cli.py#L394) calls `werkzeug.serving.run_simple` directly, without passing through [`Flask.run`](https://github.com/pallets/flask/blob/7fca843b5f361e79534bd18c4cd20f3f44094337/flask/app.py#L782), where the code for processing the server name resides.

This is using python 3.5, and Werkzeug 0.11.11
I am new to Flask and wanted to try out the demo.

```
Traceback (most recent call last):
  File "/usr/local/bin/flask", line 11, in <module>
    sys.exit(main())
  File "/usr/local/lib/python2.7/dist-packages/flask/cli.py", line 478, in main
    cli.main(args=args, prog_name=name)
  File "/usr/local/lib/python2.7/dist-packages/flask/cli.py", line 345, in main
    return AppGroup.main(self, *args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 696, in main
    rv = self.invoke(ctx)
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 1055, in invoke
    cmd_name, cmd, args = self.resolve_command(ctx, args)
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 1094, in resolve_command
    cmd = self.get_command(ctx, cmd_name)
  File "/usr/local/lib/python2.7/dist-packages/flask/cli.py", line 316, in get_command
    rv = info.load_app().cli.get_command(ctx, name)
  File "/usr/local/lib/python2.7/dist-packages/flask/cli.py", line 209, in load_app
    rv = locate_app(self.app_import_path)
  File "/usr/local/lib/python2.7/dist-packages/flask/cli.py", line 89, in locate_app
    __import__(module)
ImportError: No module named minitwit

```
It's often useful to reference current endpoint, sometimes modifying some of arguments. For example, imagine some generic item viewer application which shows items from different sources:

```
@app.route("/<source>/<item>")
def item(source, item):
    return render_template("item.html")
```
```
<a href="{{ url_for(???) }}">This item from another source</a>
<a href="{{ url_for(???) }}">Different item from the same source</a>
```

Currently, request.endpoint and request.view_args may be used to construct such urls, but it's cumbersome if done generic way:

```
<a href="{{ url_for(request.endpoint, *dict(request.view_args, source="another")) }}">This item from another source</a>
<a href="{{ url_for(request.endpoint, *dict(request.view_args, item="different")) }}">Different item from the same source</a>
```

So I propose to add ```url_for_self()``` function which does it in simple way. I've implemented it like this for myself:

```
def url_for_self(**args):
    return flask.url_for(flask.request.endpoint, **dict(flask.request.view_args, **args))

app.jinja_env.globals['url_for_self'] = url_for_self
```

This simplifies above mentioned template code into much more readable:

```
<a href="{{ url_for_self(source="another") }}">This item from another source</a>
<a href="{{ url_for_self(item="different") }}">Different item from the same source</a>
```

Note that this allows both adding, modifying and clearing (with ```foo=None```) parameters.
On line #340 in sessions.py, I see that session.modified is being checked AFTER the session object has already been evaluated to False. Is that a bug? How does it work otherwise?

https://github.com/pallets/flask/blob/master/flask/sessions.py#L340
Assuming the SERVER_NAME config variable is configured as '0.0.0.0:5555':

1) Calling app.run(host=None, port=None) results in flask running on http://127.0.0.1:5555/
2) Calling app.run(host='127.0.0.1', port=5000) results in flask running on http://127.0.0.1:5000/

In both cases the SERVER_NAME config variable does not correspond to where flask is actually running.

The host and port parameters in app.run() must of course take precedence, but should be set according to the SERVER_NAME config variable if present.

The current implementation in app.run():

    if host is None:
        host = '127.0.0.1'
    if port is None:
        server_name = self.config['SERVER_NAME']
        if server_name and ':' in server_name:
            port = int(server_name.rsplit(':', 1)[1])
        else:
            port = 5000

Could be replaced by the following:

    _host = '127.0.0.1'
    _port = 5000
    servername = self.config['SERVER_NAME']
    if server_name:
        if server_name and ':' in server_name:
            _host, _port = servername.split(':', 1)
    if host is None:
        host = _host
    if port is None:
        port = _port

The following can be used to make sure the SERVER_NAME config variable corresponds to where flask is actually running:

    if servername:
        self.config['SERVER_NAME'] = host + ':' + port

when I specify absolute path like this `D:\personal\prjs\cfblog2\cfblog2\app.py` in FLASK_APP, run `flask db init` will raise a exception:
```
Traceback (most recent call last):
  File "c:\userprograms\python35\Lib\runpy.py", line 184, in _run_module_as_main
    "__main__", mod_spec)
  File "c:\userprograms\python35\Lib\runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "D:\personal\local\cfblog2\lib\site-packages\flask\__main__.py", line 15, in <module>
    main(as_module=True)
  File "D:\personal\local\cfblog2\lib\site-packages\flask\cli.py", line 479, in main
    cli.main(args=args, prog_name=name)
  File "D:\personal\local\cfblog2\lib\site-packages\flask\cli.py", line 346, in main
    return AppGroup.main(self, *args, **kwargs)
  File "D:\personal\local\cfblog2\lib\site-packages\click\core.py", line 696, in main
    rv = self.invoke(ctx)
  File "D:\personal\local\cfblog2\lib\site-packages\click\core.py", line 1060, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "D:\personal\local\cfblog2\lib\site-packages\click\core.py", line 1060, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "D:\personal\local\cfblog2\lib\site-packages\click\core.py", line 889, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "D:\personal\local\cfblog2\lib\site-packages\click\core.py", line 534, in invoke
    return callback(*args, **kwargs)
  File "D:\personal\local\cfblog2\lib\site-packages\click\decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "D:\personal\local\cfblog2\lib\site-packages\flask\cli.py", line 229, in decorator
    with __ctx.ensure_object(ScriptInfo).load_app().app_context():
  File "D:\personal\local\cfblog2\lib\site-packages\flask\cli.py", line 210, in load_app
    rv = locate_app(self.app_import_path)
  File "D:\personal\local\cfblog2\lib\site-packages\flask\cli.py", line 90, in locate_app
    __import__(module)
ImportError: No module named 'D'
```
It seems like function `locate_app` can't handle win-style path correctly.

And also please consider using command-line arguments to specify flask startup file/module instead of using environment.

http://flask.pocoo.org/docs/0.11/patterns/apierrors/

...discusses a pattern for defining and catching custom exceptions. However, this pattern does not work unless PROPAGATE_EXCEPTIONS is set, because the exception gets eaten and turned into a 500.

Confusingly it will work in DEBUG=True mode then break in production.

Can the docs be updated? Or am I missing something?
test.py:

```from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello, World!'
```

run:

```
$> FLASK_APP=test.py flask run
 * Serving Flask app "test"
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
```

query:

```
$> curl localhost:5000 -H "Host: '`python -c 'print \"\xbf\"'`" -i
HTTP/1.0 500 INTERNAL SERVER ERROR
Content-Type: text/html
Content-Length: 291
Server: Werkzeug/0.11.11 Python/2.7.12
Date: Mon, 05 Dec 2016 11:57:46 GMT

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<title>500 Internal Server Error</title>
<h1>Internal Server Error</h1>
<p>The server encountered an internal error and was unable to complete your request.  Either the server is overloaded or there is an error in the application.</p>
```

server log:
```
127.0.0.1 - - [05/Dec/2016 12:57:46] "GET / HTTP/1.1" 500 -
Error on request:
Traceback (most recent call last):
  File "/private/tmp/venv/lib/python2.7/site-packages/werkzeug/serving.py", line 193, in run_wsgi
    execute(self.server.app)
  File "/private/tmp/venv/lib/python2.7/site-packages/werkzeug/serving.py", line 181, in execute
    application_iter = app(environ, start_response)
  File "/private/tmp/venv/lib/python2.7/site-packages/flask/app.py", line 2000, in __call__
    return self.wsgi_app(environ, start_response)
  File "/private/tmp/venv/lib/python2.7/site-packages/flask/app.py", line 1983, in wsgi_app
    ctx = self.request_context(environ)
  File "/private/tmp/venv/lib/python2.7/site-packages/flask/app.py", line 1944, in request_context
    return RequestContext(self, environ)
  File "/private/tmp/venv/lib/python2.7/site-packages/flask/ctx.py", line 242, in __init__
    self.url_adapter = app.create_url_adapter(self.request)
  File "/private/tmp/venv/lib/python2.7/site-packages/flask/app.py", line 1771, in create_url_adapter
    server_name=self.config['SERVER_NAME'])
  File "/private/tmp/venv/lib/python2.7/site-packages/werkzeug/routing.py", line 1327, in bind_to_environ
    query_args=query_args)
  File "/private/tmp/venv/lib/python2.7/site-packages/werkzeug/routing.py", line 1239, in bind
    raise BadHost()
BadHost: 400: Bad Request
```

I'm not sure if this issue should be created here or on the werkzeug repository.

Anyway, I think a HTTP/400 should be returned to the client instead of a HTTP/500.
Possible solution for issue #2007, it gives a warning message when an IP is set as SESSION_COOKIE_DOMAIN as user untitaker asked us to do, SERVER_DOMAIN isn't checked because he didn't remembered why it was needed, but the function is_IP in /flask/helpers is prepared to it. If you have any doubt feel free to ask.
Quickly, before 2017 comes...


How can I authenticate a user with NTLM Authentication in Windows?

I have a Python Flask Application hosted in IIS server with Windows Authentication enabled. When a user visits the site within our network I want the user to be auto logged in else redirect the user to login page.

How can this be achieved?
Hi everyone, i have been seeing this issue some days intermittently.

I have some methods with request.method = POST, but when i want to resend the same request to the same endpoint, there is an issue with the request.method and Flask throws Method not Allowed.

`@app.route('/api/pause', methods=['POST'])`
`json = {"signature":"1234", "value":"b"}`

The first time was good and data was printed on console: `print request.json`

but the second time (i am doing the requests from Postman and this time i have changed value for a) i can see this on log:

`{"signature":"1234","value":"b"}POST /api/pause HTTP/1.1" 405 -`

the third time i can see this on log:

`{"signature":"1234","value":"a"}POST /api/pause HTTP/1.1" 405 -`

So, i do not know why Flask is inserting the previous POST values at the request.method and of course it throws Method Not Allowed, because pause method has not this allowed.

Note: I tried with or without threaded Flask option.

Do you know why i have this problem ? It is so important because i can not create a good API without POST or PUT as you would think.

Hi

Looks like flask works different than plain python with Unicode. Let me explain

If i assign an unicode string to a parameter, (test="%$£") it works fine

When i run this code as part of a flask execution, i have an error. UnicodeDecodeError: 'ascii' codec can't decode byte 0xc2 in position 3: ordinal not in range(128)

I can encode this in utf-8, but i would like to understand why the behaviour is different using flask?

Thanks


now, when we want to operate the model, we have to define the database model every time, whether we can add some code to the flask, so that we do not need to define the database like the cakephp model style....

The function I designated as `@app.teardown_appcontext` is running before the view code runs - at least according to my own investigations. Printing something in `teardown_appcontext` and something in a view body results in the former appearing before the latter, at the very least. Using `teardown_request`, however, works as expected.

[From the documentation](http://flask.pocoo.org/docs/0.11/api/#flask.Flask.teardown_appcontext), I would've expected `teardown_appcontext` to fire at roughly the same time ("These functions are typically also called when the request context is popped"), except it'd also work with `with app.app_context`. It seems that's not the case, however!

I'm on Python 2.7.12 with Flask 0.11.1 and Werkzeug 0.11.11.
added blank line before def
added whitespace before key

Running `flask routes` will list all registered routes for a given app, sorted by endpoint

Inspired by [`mix phoenix.routes`](http://www.phoenixframework.org/docs/routing), this will display a list of all registered routes in an application. This is basically #1446, but I have updated it and made it "dumber". 

NB: I know that the other PR is old and there doesn't seem to be much enthusiasm for it, but I do think this is useful to have to get a high level overview of application routes, especially if they are being generated programmatically. 

Example output:

```sh
$ flask routes
api.me                    GET              /api/users/me/
api.users                 GET              /api/users/
                          POST             /api/users/
                          PUT, DELETE, GET /api/users/<pk>
api.users_schema          GET              /api/users/schema/
auth_blueprint.authorized GET              /login/authorized
auth_blueprint.do_login   GET              /do-login
auth_blueprint.login      GET              /login
auth_blueprint.logout     GET              /logout
auth_blueprint.lr_test    GET              /lr
static                    GET              /static/<path:filename>
```


Removes usage of `_cached_json` property when `get_json` is called with
disabled cache argument. (closes #2087)

The `_cached_json` property is used even when arguments change.

Proposal:
```diff
         rv = getattr(self, '_cached_json', _missing)
-        if rv is not _missing:
+        if cache and rv is not _missing:
              return rv
```

Test case:
```python
# POST with an invalid JSON data
assert request.get_json(silent=True) is None
with pytest.raises(BadRequest):
    request.get_json(silent=False, cache=False)
```
Hi, 

when handling large file uploads +300MB, the files seem to be cached in memory till the upload is finished. This is not very practical.
The [doc](http://flask.pocoo.org/docs/0.11/patterns/fileuploads) states: 

>(...) So how exactly does Flask handle uploads? Well it will store them in the webserver’s memory if the files are reasonable small otherwise in a temporary location

I am unsure on how to interpret this, but as I saw it: cache the data on disk till the file is uploaded, before moving on. :-)

So my question is: is storing everything in memory during upload, intended behaviour?

To give a little more details on the code: 

```
def store_upload(project_id):
    file = request.files['file']
    # boiler plate checks ...
    file.save(os.path.join(destination_base, destination))  #save file to decent location
    return _response_stuff()
```
I am using python 3.5, flask 0.11.1. 

PS: I went through #pocoo and github issues here, but couldn't find any answer matching my request

Thanks!

This was broken in https://github.com/pallets/flask/commit/ad011bc32d7b9160354efafcd43e20f7042a6a13#diff-fd40cf2be7711772de9d8316da038cceR263
Hello I am working on a flask app and i want to creeate a query that has multiple filters in order to show the correct results within the same table:

example:
tab = session.query(Tabs).filter_by(column1 = hello).filter_by(column2 = world).all()

but none of the methods i am trying will work. 
BOTH of the definition columns are from the same table....
Error message:
`d:\projects\cfblog2_env\scripts\python.exe: can't open file 'D:\projects\cfblog2_env\Scripts\flask': [Errno 2] No such file or directory`

Environment: Win 10, Py 3.5.2(VirtualEnv)，Flask 0.11
This error was came from '_reload.py' in werkzeug.It seems like when run with flask.exe, sys.executable still equal to python's exe path and sys.argv is something like this:`'D:\\projects\\cfblog2_env\\Scripts\\flask', 'run'`

I am not sure what cause this problem actually(werkzeug,packer of flask.exe or flask itself).But this error happend when I using flask. So I put the issuse here.

To whom has the same error, you can use`python -m flask run` for workaround.
And last, sorry for my poor english.

Flask supports setting HttpException as error handler class:

    app.register_error_handler(HTTPException, lambda error: jsonify(error=error.code, text=str(error)))

This fills `error_handler_spec` with something like this for any blueprint `{None: {None: lambda_function}}`

However, when finding the error handler it checks the error code which is e.g. 404 and ignores None, the error handler for any error, previously set by register_error_handler. It doesn't find 404, doesn't check for None in the dict and falls back to the default error handler which shouldn't happen.
The linked page is the normal help docs for people who know at least roughly how WSGI works.  We also have a tutorial at http://blog.pythonanywhere.com/121/ that explains (for beginners) how to build a web app using Flask and MySQL (plus git) but that's probably not the best fit for this page.
I fixed up  flask-sphinx-themes so that it's an installable package. No longer need to copy files or use submodule, just `pip install Flask-Sphinx-Themes`.
We installed flask 0.11.1 from pip today. Our application would not start unless we also installed blinker via pip. Seems like blinker should be in your requires.txt.
Earlier this year I did some development involving Server-sent events (SSE) using Flask. I found there is no official documentation on how to best handle this. Since the specification is simple I ended up implementing it myself. However, I think there is room for improvement.

I find there are a couple of problems with working with SSE and Flask:

- Development environment requires using a separate service or threading. Using a separate service adds complexity and using threading disallows the use of frame inspection in the built-in Don't Panic debugger for all requests.
- There is no official information on best practices when it comes to deployment of SSE. Should it be a separate service or can it be included in the application? Especially for smaller applications I find the complexity of introducing a separate service for managing SSE adds a lot of complexity to an otherwise simple project.

The same points hold true for WebSockets as they are similar.
See https://github.com/pallets/flask/issues/1837 for context.




It is entirely sufficient to walk the MRO of the exception class, no need to check for classes re-appearing later on, no need to add the MRO of any superclass.

* Python refuses point-blank to create a class with a circular MRO.
* All classes in a superclass MRO *already* appear in the MRO of the derived type. Re-adding the contents of a superclass MRO is doing double work.
how do i solve
Internal Server Error
The server encountered an internal error and was unable to complete your request. Either the server is overloaded or there is an error in the application.


yousufs-MacBook-Pro:flask yousufsafwan$ flask run
 * Serving Flask app "template.py"
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
[2018-07-28 16:08:41,337] ERROR in app: Exception on / [GET]
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/flask/app.py", line 2292, in wsgi_app
    response = self.full_dispatch_request()
  File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/flask/app.py", line 1815, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/flask/app.py", line 1718, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/flask/_compat.py", line 35, in reraise
    raise value
  File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/flask/app.py", line 1813, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/flask/app.py", line 1799, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/Users/yousufsafwan/Documents/flask/template.py", line 8, in index
    return render_template("first.html")
  File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/flask/templating.py", line 134, in render_template
    return _render(ctx.app.jinja_env.get_or_select_template(template_name_or_list),
  File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/jinja2/environment.py", line 869, in get_or_select_template
    return self.get_template(template_name_or_list, parent, globals)
  File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/jinja2/environment.py", line 830, in get_template
    return self._load_template(name, self.make_globals(globals))
  File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/jinja2/environment.py", line 804, in _load_template
    template = self.loader.load(self, name, globals)
  File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/jinja2/loaders.py", line 113, in load
    source, filename, uptodate = self.get_source(environment, name)
  File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/flask/templating.py", line 58, in get_source
    return self._get_source_fast(environment, template)
  File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/flask/templating.py", line 86, in _get_source_fast
    raise TemplateNotFound(template)
jinja2.exceptions.TemplateNotFound: first.html
127.0.0.1 - - [28/Jul/2018 16:08:41] "GET / HTTP/1.1" 500 -


The wording of the docs makes it sound like the tutorials use the simple structure for a flask application, which they no longer do.
This commit re-words the docs to make it clearer.

Just add a missing 'is' in the docstring in db.py, from the flaskr example.

> If this request connected to the database

This should be: If this request **is** connected to the database.
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Incorrect articles was used
update the contents become more understandable
Improve documentation for the CLI using application factories and how/when the ScriptInfo object is passed with Application Discovery.
### Expected Behavior

In development mode, flask should detect changes in my files and reload the debugger successfully. 

### Actual Behavior

It outputs to terminal: "Detected change in /flask/flaskr/api.py, reloading" then never reloads.

### Environment

* Python version: 3.6.2
* Flask version: 1.0.2

### Expected Behavior

When a view return redirect('/') , it redirect to www.example.com

```python
if error is None:
    session.clear()
    session['user_id'] = user['id']
    return url_for('index')
```

### Actual Behavior

When a view return redirect('/') , it changeed the domain to 127.0.0.1

### Environment

* Python version:3.6
* Flask version:latest
* Werkzeug version:latest

### Expected Behavior

If I make a request to `http://localhost:5000/foo`, then `request.full_path` should contain `/foo`.

### Actual Behavior

It contains `/foo?`

### Minimal example

Save this to a file and run it:

```
from flask import Flask, request
app = Flask(__name__)
@app.route('/test')
def test():
    return request.full_path
app.run()
```

Then go to http://localhost:5000/test

You will see `/test?` in the browser.

### Environment

* Python version: 3.6.1
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

After upgrading to flask 1.0 logging from different apps using DispatcherMiddleware, each log emitted is written to all handlers in the different apps. I assume this caused by `app.logger` always having the name `flask.app`, maybe?

Here is a example:


```
from werkzeug.wsgi import DispatcherMiddleware
from flask import Flask
from logging.handlers import RotatingFileHandler


handler1 = RotatingFileHandler('app1.log')
app1 = Flask('app1')
app1.logger.addHandler(handler1)

handler2 = RotatingFileHandler('app2.log')
app2 = Flask('app2')
app2.logger.addHandler(handler2)


@app1.route("/")
def hello():
    app1.logger.error("from app1")
    return ''


@app2.route("/")
def hello2():
    app2.logger.error("from app2")
    return ''


app = DispatcherMiddleware(app1, {
    '/app2': app2
})
```

Run with
```
uwsgi --socket 0.0.0.0:8000 --protocol=http -w app --callable app
```

And then make a request to / and /app2/. Each error log will be written in both logfiles.

### Environment

* Python version: 3.6.5
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

My actual app is using `current_app.logger` with blueprints with the same behaviour, but I assume it the same issue.
I have some urls with DES encoded, for example: http://host/p?XXXXXXXX

XXXXXXXX == DES("a=1&b=2")

I need decode the args before route. In the before_request cannot change request.url, How to do this, thanks!

Hi,

add option timeout for redirect
### Expected Behavior

Running this code worked previously, then i switched form code editor to spyder IDE.


```python
from flask import Flask
from flask_restful import Api
from flask_jwt import JWT

from security import authenticate, identity
from resources.user import UserRegister
from resources.product import Product, ProductList

app = Flask(__name__)
app.secret_key = 'longandcomplicated'
api = Api(app)

jwt = JWT(app, authenticate, identity)

api.add_resource(ProductList, '/products')
api.add_resource(Product, '/product/<string:name>')
api.add_resource(UserRegister, '/register')

app.run(port=5000, debug=True)

```

### Actual Behavior

Tell us what happens instead.

```pytb

runfile('D:/pEshop/code/app.py', wdir='D:/pEshop/code')
Traceback (most recent call last):

  File "<ipython-input-1-84a080c78298>", line 1, in <module>
    runfile('D:/pEshop/code/app.py', wdir='D:/pEshop/code')

  File "C:\Users\user\Anaconda3\envs\pShop\lib\site-packages\spyder\utils\site\sitecustomize.py", line 705, in runfile
    execfile(filename, namespace)

  File "C:\Users\user\Anaconda3\envs\pShop\lib\site-packages\spyder\utils\site\sitecustomize.py", line 102, in execfile
    exec(compile(f.read(), filename, 'exec'), namespace)

  File "D:/pEshop/code/app.py", line 19, in <module>
    app.run(port=5000, debug=True)

  File "C:\Users\user\Anaconda3\envs\pShop\lib\site-packages\flask\app.py", line 938, in run
    cli.show_server_banner(self.env, self.debug, self.name, False)

  File "C:\Users\user\Anaconda3\envs\pShop\lib\site-packages\flask\cli.py", line 629, in show_server_banner
    click.echo(message)

  File "C:\Users\user\Anaconda3\envs\pShop\lib\site-packages\click\utils.py", line 259, in echo
    file.write(message)

UnsupportedOperation: not writable 
```

### Environment

* Python version: 3.6.6
* Flask version: 1.0.2
* Werkzeug version: 0.14.1
### Expected Behavior

After i've commentd out the line with the error it started to work fine, but I'm not getting messages in console anymore.

We need know more about versions when flask encounter error.

previous output of  versions:

* Flask XXX
* Python XXX

now:

* Flask versoin: XXX
* Jinja2 version: XXX
* Werkzeug version: XXX
* Python version: XXX

absolutely, I have added them into test-cli.py.
This PR…

* Fixes broken cross-references to other documentation
* Fixes all warnings from Sphinx when building the docs
* Makes an explicit call-out to contributing guidelines in README

I hit the broken cross-references when reading the docs, when opening the link to the uWSGI docs from the Standalone WSGI Containers page would give me a 404 error. It seems like there was some rearranging at some point and this was probably overlooked, so this should fix the broken links and make a better experience for others browsing the docs. :slightly_smiling_face: 

Additionally, in an oversight, I missed the contributing guidelines in the root directory of the repository but I did scan the README. When I came back to this, I found the contributing guidelines, but I would have noticed them quicker and submitted this PR a day earlier if I had seen them mentioned in the README. So I thought an explicit call-out to the existing contributing guidelines (which were well-written and very helpful to me) in the README might be useful for others too.

I successfully ran the tests on the docs and I was able to build them locally on my workstation.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

### Expected Behavior

* Install dotenv
** (In my case, dotenv is installed for reasons other than flask)
* put a `.env` file in a folder somewhere above the python package
** (In my case, a `.env` file is being used with docker-compose.yml in a containing folder)
* create a minimal flask app and run `flask` (it should just work)

### Actual Behavior

Your app wont work if run, and `flask` prints the following traceback.

```pytb
Traceback (most recent call last):
  File "./lib/python3.6/site-packages/flask/cli.py", line 235, in locate_app
    __import__(module_name)
ModuleNotFoundError: No module named 'manage'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "./lib/python3.6/site-packages/flask/cli.py", line 529, in list_commands
    rv.update(info.load_app().cli.list_commands(ctx))
  File "./lib/python3.6/site-packages/flask/cli.py", line 372, in load_app
    app = locate_app(self, import_name, name)
  File "./lib/python3.6/site-packages/flask/cli.py", line 246, in locate_app
    'Could not import "{name}".'.format(name=module_name)
flask.cli.NoAppException: Could not import "manage".
```

### Environment
* Flask version: 1.0


If I create a `.env` file at the top level of my python package/distribution (e.g. next to setup.py), the issue is solved.

To me, it appears that the problem is in `flask/cli.py`, line 617 on master.
```python
    if new_dir and os.getcwd() != new_dir:
        os.chdir(new_dir)
```
`new_dir` is the result of `dotenv.find_dotenv` which looks upwards in the folder hierarchy. The resultant directory is then outside the context of the project, and the `os.chdir` causes any attempted imports of local code to fail.

I would have submitted a PR removing that `os.chdir`, but I wasn't sure it would have been accepted. I assume its there to allow someone to run `flask` from inside a subfolder of their application, but the location of the `.env` file isn't necessarily indicative of that.
-clarified some sentences.
-fixed some confusing nominalizations.
-made some phrase concise.
-in "... provided by the community," it is confusing because there is no community mentioned beforehand.

This eliminates the deprecation warning fired by werkzeug's `Request.is_xhr` property for older versions of Flask by removing the check.

https://github.com/pallets/werkzeug/blob/da57cd54c97909856e05f490418000f9ab851358/werkzeug/wrappers.py#L696-L702 

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

### Issue
Jsonify always returns datetime objects as GMT timezone. Seems like this has been a problem in the past with these issues:

- https://github.com/pallets/flask/issues/2392
- https://github.com/pallets/flask/pull/2374

### Environment

* Python version: 2.7.5
* Flask version: 1.0.2
* Werkzeug version: 0.14.1
* pytz version: 2018.5

### Testcode
```
#!/usr/bin/env python2.7

from werkzeug.http import http_date
from datetime import datetime
import pytz

from flask import Flask, jsonify

app = Flask(__name__)

@app.route('/')
def root():
    # Localize time
    local_time = pytz.timezone("America/Chicago")
    time = datetime.utcnow().replace(microsecond=0).replace(tzinfo=pytz.utc)
    time = time.astimezone(local_time)

    print("iso format:", time.isoformat())
    print("object:", time.tzinfo)
    print("http date:", http_date(time))

    result = [time]

    print("Test object: %s" % result)

    return jsonify(result)

app.run(host='127.0.0.1', port=8080, debug=False)
```
### Console output:
```
Test object: [datetime.datetime(2018, 7, 10, 11, 45, 20, tzinfo=<DstTzInfo 'America/Chicago' CDT-1 day, 19:00:00 DST>)]
```
### Jsonify output:
```
["Tue, 10 Jul 2018 16:45:20 GMT"]
```

**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](http://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

Tell us what should happen.

```python
Paste a minimal example that causes the problem.
```

### Actual Behavior

Tell us what happens instead.

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version:
* Flask version:
* Werkzeug version:

try use `ipython` as defualt shell when run cmd `flask shell`

This PR updates documentation to be more clear that `config.from_object` does not instantiate the object. It also provides examples as to how to use `@property` in a configuration class.

Addresses #2853.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Are properties supported for configuration objects? It doesn't look like it.

Being able to use `@property` on configuration objects could simplify some of the more complex configurations out there:

```python
# Without @property
class BaseConfig(object)
    NAME = "a"
    HELLO = "Hello, " + NAME

class ProdConfig(BaseConfig):
    NAME = "b"
    HELLO = "Hello, " + NAME           # repeated code! Makes me 😢

# With @property
class BaseConfig(object)
    NAME = "a"

    @property
    def HELLO(self)
        return "Hello, " + self.NAME

class ProdConfig(BaseConfig):
    NAME = "b"                         # Don't need to define HELLO again, yay!
```


### Expected Behavior

It seems like it would be useful to be able to use properties when defining config variables using `from_object`:

```python
# my_config.py
class BaseConfig(object):
    NAME = "Terry Gilliam"

    @property
    def HELLO(self):
        return "Hello, " + self.NAME

class ProdConfig(BaseConfig):
     NAME = "Monty Python"
```

```python
# example.py
from flask import Flask
app = Flask(__name__)
app.config.from_object('my_config.ProdConfig')
print(app.config['HELLO'])
# "Hello, Monty Python"
```


### Actual Behavior

Because the config class is not actually instantiated, the `HELLO` property is simply a `<property object at 0x...>` rather than `Hello, Terry Gilliam` or `Hello, Monty Python`.

```python
# example.py
from flask import Flask
app = Flask(__name__)
app.config.from_object('my_config.ProdConfig')
print(app.config['HELLO'])
# <property object at 0x000001EC5404D458>
```


### Environment

* Python version: 3.5.2
* Flask version: 1.0.2
* Werkzeug version: 0.14.1


### Possible Resolution

If configuration objects are called `ProdConfig()`, then the property resolves. **I'm sure that there's a reason for not instantiating the config object, but I thought it would be worth a discussion.** I'm sure it's security related.

The fix might look like:

```python
# flask.config.Config.from_object
...
for key in dir(obj):
    if key.isupper():
        self[key] = getattr(obj, key)
        # only instantiate the object if a property is detected
        if isinstance(self[key], type(property())):
            self[key] = getattr(obj(), key)
Hello again,

I've made a flask [example project](https://github.com/Nadav-Ruskin/configsite) for simple uses because I feel those are scarce. I wonder if you would consider making a wiki page or something for flask where example projects can be stored?
I am not sure if this is required, but it seems to be a safe idea.

Before: 
> However, as a project **get** bigger

After: 
>However, as a project **gets** bigger
This pull request does the following changes for simplicity and elegance:
- Remove unnecessary comment about signals section
- Import and expose `jsonify` in a single line: following the other imports pattern (see line 21 to 32):
```python
from .module import value
```
- Also, simplify the comment about exposing `json.jsonify`
- Make the imports more [PEP8](https://www.python.org/dev/peps/pep-0008/#maximum-line-length)-like using parenthesis over back-slash (`\`)

> The preferred way of wrapping long lines is by using Python's implied line continuation inside parentheses, brackets and braces. Long lines can be broken over multiple lines by wrapping expressions in parentheses. These should be used in preference to using a backslash for line continuation.

I'm not sure if changes like these - prettifying - should be preceded by an issue. If so, feel free to close this pull requests and I will file an issue asap. Thanks!
This pull request uses the already implemented ` itervalues` from `_compat.py` module instead of the `iteritems` for iterating the **values** from a given dict (line 58).
As a consequence, the unused variable `k` is now removed since it's not necessary for iterating over the dict values.
```python
from flask import Flask

app = Flask(__name__)
posts = {
    0: dict(title='Hello World', content='This is my first ever post !')
}

@app.route('/')
def home():
    return 'Hello World!'

@app.route('/post/<int:post_id>') 
def post(post_id):
    post = posts.get(post_id)
    return f"Post {post['title']} , content:\n\n{post['content']}"

if __name__ == '__main__':
    app.run(debug=True)
```
**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](http://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

Create a file called frozenAccount.py to import the file and call the same name function defined in the file.

AttributeError: 'function' object has no attribute'frozenAccount'.

Replace the file name with others, and the program can be executed normally. So why can't this name be?

Or because it's a reserved word？

### Actual Behavior

Tell us what happens instead.

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version:2.7.13
* Flask version:0.12.2
* Werkzeug version:0.14.1

Currently, there is no way to modify the default 200 status in `jsonify`. This PR adds a kwarg for it.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Added deploying information to a shared hosting
This pull request changes the usage of `set()` method for the set literal (`{ ... }`) in the file uploading example.

Using the literal `{ }` for building non-empty sets is preferred for [it is faster](https://renzo.lucioni.xyz/pythons-set-literals/)
This PR removes a small piece of backward compatibility code from `flask/__init__.py` that accordingly to the comment on (ex-)line 47 should "go away" in version 1.0 of Flask.

However, if for some reason it must **not** be deleted, at least the commented line must be deleted or updated with a better description.

-  :heavy_check_mark: Tests ran successfuly
Hi,

We're looking at upgrading from Flask 0.12 to 1.0, and have run into an issue with routes that don't exist.

We have a custom error handler that we install for Python's built-in `Exception` class so that we can have a useful error message should any error occur during request execution. With Flask 1.0, we are finding that URLs that don't exist are triggering a call to the custom error handler.

We would like to preserve the behaviour so that non-existent URLs continue to return a 404/Not Found response.

I've tried reading the docs and couldn't see a way, so might have missed something:
http://flask.pocoo.org/docs/1.0/errorhandling/#error-handlers

What is the recommended way of doing this? Or is this a bug?

I wasn't 100% sure, but this could be the same as https://github.com/pallets/flask/issues/2778?

---

### Expected Behavior

With the Flask app running as below, the following command:

`curl -XGET http://127.0.0.1:5001/does-not-exist`

should return 404/Not Found.


```
#! python

"""
Simple Flask app with a global exception handler.
"""

from http import HTTPStatus

from flask import Flask


app = Flask(__name__)


@app.errorhandler(Exception)
def global_exception_handler(err):
    """ Global exception handler.
    """
    print("In global_exception_handler", err)
    return "From global_exception_handler\n", HTTPStatus.INTERNAL_SERVER_ERROR


@app.route("/error")
def error():
    """ Simple endpoint that raises an exception
    """
    # simulate a real error that can occur during request processing
    raise AttributeError("These aren't the attributes you are looking for.")


@app.route("/simple")
def simple():
    """ Simple endpoint
    """
    # sanity check
    return "Hello World!\n", HTTPStatus.OK


def main():
    """ The entry point
    """
    app.run(port=5001)


if __name__ == "__main__":
    main()

```

### Actual Behavior

Our global exception handler is invoked and instead of 404/Not found we get what it returns (500/internal server error).


Command line output when running the app with Flask 1.0.2:

```
dan@dan-desktop:/tmp $ curl -XGET http://127.0.0.1:5001/error
From global_exception_handler
dan@dan-desktop:/tmp $ curl -XGET http://127.0.0.1:5001/does-not-exist
From global_exception_handler
dan@dan-desktop:/tmp $ curl -XGET http://127.0.0.1:5001/simple
Hello World!
```

Command line output when running the app with Flask 0.12.4:

```
dan@dan-desktop:/tmp $ curl -XGET http://127.0.0.1:5001/error
From global_exception_handler
dan@dan-desktop:/tmp $ curl -XGET http://127.0.0.1:5001/does-not-exist
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server.  If you entered the URL manually please check your spelling and try again.</p>
dan@dan-desktop:/tmp $ curl -XGET http://127.0.0.1:5001/simple
Hello World!
```

### Environment

* Python version: Python 3.6.2
* Flask version: 1.0.2
* Werkzeug version: 0.14.1
This PR adds a short .rst doc that covers the process for deploying a Flask app to Dreamhost, specifically. This configuration works for any project that follows the Flaskr tutorial template (in that it makes an app generator method in the module). There are some links to Dreamhost's documentation on installing Python 3/Virtualenv on their servers, I kept them as external links rather than pulling them in to the documentation to make sure they stay accurate if DH changes anything.

No tests since it's just documentation. 

"keeps track on" -> "keeps track of"
https://dictionary.cambridge.org/dictionary/english/keep-track 

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

### Expected Behavior
```
FLASK_APP=src/app.py flask run # doesn't work
```

should run server as well as

```
FLASK_ENV=development FLASK_APP=src/app.py flask run  # works
```

### Actual Behavior
```
FLASK_ENV=production FLASK_APP=src/app.py flask run
 * Serving Flask app "src/app.py"
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: off
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.5/logging/__init__.py", line 986, in emit
    msg = self.format(record)
  File "/usr/lib/python3.5/logging/__init__.py", line 836, in format
    return fmt.format(record)
  File "/home/user/projects/phenom/-api/src/loggers.py", line 10, in format
    record.url = request.url
  File "/home/user/.local/share/virtualenvs/-api-GbHiIKAL/lib/python3.5/site-packages/werkzeug/local.py", line 347, in __getattr__
    return getattr(self._get_current_object(), name)
  File "/home/user/.local/share/virtualenvs/-api-GbHiIKAL/lib/python3.5/site-packages/werkzeug/local.py", line 306, in _get_current_object
    return self.__local()
  File "/home/user/.local/share/virtualenvs/-api-GbHiIKAL/lib/python3.5/site-packages/flask/globals.py", line 37, in _lookup_req_object
    raise RuntimeError(_request_ctx_err_msg)
RuntimeError: Working outside of request context.

This typically means that you attempted to use functionality that needed
an active HTTP request.  Consult the documentation on testing for
information about how to avoid this problem.
Call stack:
  File "/home/user/.local/share/virtualenvs/-api-GbHiIKAL/bin/flask", line 11, in <module>
    sys.exit(main())
  File "/home/user/.local/share/virtualenvs/-api-GbHiIKAL/lib/python3.5/site-packages/flask/cli.py", line 894, in main
    cli.main(args=args, prog_name=name)
  File "/home/user/.local/share/virtualenvs/-api-GbHiIKAL/lib/python3.5/site-packages/flask/cli.py", line 557, in main
    return super(FlaskGroup, self).main(*args, **kwargs)
  File "/home/user/.local/share/virtualenvs/-api-GbHiIKAL/lib/python3.5/site-packages/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/home/user/.local/share/virtualenvs/-api-GbHiIKAL/lib/python3.5/site-packages/click/core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/home/user/.local/share/virtualenvs/-api-GbHiIKAL/lib/python3.5/site-packages/click/core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/home/user/.local/share/virtualenvs/-api-GbHiIKAL/lib/python3.5/site-packages/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/home/user/.local/share/virtualenvs/-api-GbHiIKAL/lib/python3.5/site-packages/click/decorators.py", line 64, in new_func
    return ctx.invoke(f, obj, *args[1:], **kwargs)
  File "/home/user/.local/share/virtualenvs/-api-GbHiIKAL/lib/python3.5/site-packages/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/home/user/.local/share/virtualenvs/-api-GbHiIKAL/lib/python3.5/site-packages/flask/cli.py", line 771, in run_command
    threaded=with_threads, ssl_context=cert)
  File "/home/user/.local/share/virtualenvs/-api-GbHiIKAL/lib/python3.5/site-packages/werkzeug/serving.py", line 814, in run_simple
    inner()
  File "/home/user/.local/share/virtualenvs/-api-GbHiIKAL/lib/python3.5/site-packages/werkzeug/serving.py", line 776, in inner
    log_startup(srv.socket)
  File "/home/user/.local/share/virtualenvs/-api-GbHiIKAL/lib/python3.5/site-packages/werkzeug/serving.py", line 764, in log_startup
    display_hostname, port, quit_msg)
  File "/home/user/.local/share/virtualenvs/-api-GbHiIKAL/lib/python3.5/site-packages/werkzeug/_internal.py", line 88, in _log
```

I think that the problem is in:

```
# src/loggers.py

import logging
from logging.config import dictConfig

from flask import request

class RequestFormatter(logging.Formatter):
    def format(self, record):
        record.url = request.url
        record.remote_addr = request.remote_addr
        return super().format(record)


def init_logger():
    dictConfig({
        'version': 1,
        'formatters': {
            'default': {
                '()': 'src.loggers.RequestFormatter',
                'format': '[%(asctime)s] [%(process)d] %(remote_addr)s requested %(url)s\n'
                          '%(levelname)s in %(module)s: %(message)s'
            }
        },
        'handlers': {
            'views': {
                'class': 'logging.StreamHandler',
                'formatter': 'default'
            },
        },
        'root': {
            'level': 'INFO',
            'handlers': ['views']
        },
    })
```

init_logger()
called before app = Flask()

```
python3.5
Flask 1.0.2
```
This PR adds a command to list rules in blueprints documentation. Current documentation not contains this information and it was confusing for users.
### Expected Behavior

Debugger should show the right request object.

```python
Paste a minimal example that causes the problem.from flask import Flask, request
app = Flask(__name__)

@app.route('/')
def hello_world():
    print(request)
    x = y
    return 'Hello, World!'

if __name__ == "__main__":
    app.run(debug=True)
```

### Actual Behavior

We're seeing some honestly kind of dumbfounding behavior that makes no sense to us. I'm not a novice when it comes to troubleshooting things, but this one really baffles me because I'm basically certain I'm not doing anything weird.

Debugger doesn't show the right "request" object often. See https://pasteboard.co/HqFNzwq.png for a screenshot of a case where the browser's URL bar shows the right thing, printing the request object shows the right thing in console logs, but using the debugger does not.

The request object is sometimes unbound, sometimes right, and seemingly often "off by 1" based on history.

So far, we can only seem to reproduce this on Linux, using Chrome and Firefox (edit: at first we thought it wasn't happening with Firefox but we found a repro with Firefox on Ubuntu 16.04 ). It doesn't seem to be happening from a Mac OS chrome client.

### Environment
* Python version: both 2.7 and 3.6 (in virtualenv-based environments)
* Flask version: 1.0.x and it seems 0.12 as well
* Werkzeug version: 0.14.1
* Linux version(s): Ubuntu 18.04 , Ubuntu 16.04
* Chrome: Chrome/65.0.3325.183
Fixed pep8 no blank line issue in flask/_compat.py
Except for this one, I also notice that there are [two sentences](http://flask.pocoo.org/docs/dev/testing/#testing-cli-commands) end with period instead of colon before a code snippet, should we change it?
The chapter [Testing Flask Applications](http://flask.pocoo.org/docs/1.0/testing)  in docs need to be updated to compatible with the rewritten flaskr application.

See #2831 for more info.
## Summary
Provide a new config option to control how JSON is serialized. This would prevent situations where Flask returns a response that is not actually JSON specification compliant.

This proposal is an opt-in mechanism. For backwards compatibility, it is disabled by default.

## Purpose
The default Python JSON serializer is not strictly [RFC-compliant](https://docs.python.org/3/library/json.html#standard-compliance-and-interoperability). In particular, it [outputs](https://docs.python.org/3/library/json.html#infinite-and-nan-number-values)
 `Infinity` and `NaN` values.

This means that by default, JSON APIs written in Flask may produce output that cannot be parsed by the browser, especially when dealing with numerical data.

Enabling the newly provided `JSON_STRICT` option would treat this scenario as an application error server-side and raise an exception. It would be up to the application developer to identify their preferred handling of such values.

## Changes and scope
This adds a new `JSON_STRICT` config option, adding to the [existing config flags](http://flask.pocoo.org/docs/1.0/config/#JSON_AS_ASCII) that also control serialization. 

The default value is chosen to leave existing applications unaffected. If `JSON_STRICT` is `True`, the application will raise an error in situations where it previously would have produced invalid JSON. 

## Previous discussion
This pitfall has been noted previously elsewhere. Others have expressed an interest in a simple, explicit configurable error option, but I am not aware of any previous pull requests that implemented the idea.

- https://coderwall.com/p/amb0va/python-s-json-module-does-not-always-produce-valid-json
- https://github.com/miguelgrinberg/Flask-SocketIO/issues/208

Particularly due to backwards compatibility concerns, the Python standard library has rejected previous suggestions to change the default `json` module behavior:
https://bugs.python.org/issue26105

## Evaluation of alternatives
Libraries such as `simplejson` [provide](https://simplejson.readthedocs.io/en/latest/#simplejson.dumps) an [ECMA-262 compliant](https://www.ecma-international.org/ecma-262/8.0/index.html#sec-serializejsonproperty) `ignore_nan` option, in which out-of-range values are serialized as `null`.

However, this option is not supported by the Python standard library, and in practice the best choice of replacement value may be somewhat application specific.

### Expected Behavior

I am attempting to follow the example in [http://flask.pocoo.org/docs/1.0/testing/](http://flask.pocoo.org/docs/1.0/testing/)

I expect to see all tests pass after these steps:
```
git clone https://github.com/pallets/flask.git
cd flask
git checkout 1.0.2
cd examples/tutorial
python3 -m venv venv
. venv/bin/activate
pip install -e .
pip install '.[test]'
pytest
pip install pytest
printf 'import os\nimport tempfile\n\nimport pytest\n\nfrom flaskr import flaskr\n' > tests/test_flaskr.py
pytest
```

### Actual Behavior

Instead, the result of the final pytest call is:

```pytb
======================= test session starts ========================
platform darwin -- Python 3.6.5, pytest-3.6.1, py-1.5.3, pluggy-0.6.0
rootdir: /Users/anthonyaylward/Documents/web-projects/flask/examples/tutorial, inifile: setup.cfg
collected 24 items / 1 errors

============================== ERRORS ==============================
______________ ERROR collecting tests/test_flaskr.py _______________
ImportError while importing test module '/Users/anthonyaylward/Documents/web-projects/flask/examples/tutorial/tests/test_flaskr.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
tests/test_flaskr.py:6: in <module>
    from flaskr import flaskr
E   ImportError: cannot import name 'flaskr'
!!!!!!!!!!!!! Interrupted: 1 errors during collection !!!!!!!!!!!!!!
===================== 1 error in 0.52 seconds ======================
```

### Environment

* Python version: 3.6.5
* Flask version: 1.0.2

### Expected Behavior

When I click the "fork" button or go to https://github.com/pallets/flask/fork I should be able to choose the location where I want to fork the flask repository.

I am able to fork other repositories.


### Actual Behavior

1. If I click "Fork", the following dialog is loading forever:
![image](https://user-images.githubusercontent.com/8438821/41468312-f706538e-707f-11e8-80c3-15c56f067e2b.png)

2. If I go to "fork page" (https://github.com/pallets/flask/fork) I receive a HTTP 500 as following:
![image](https://user-images.githubusercontent.com/8438821/41468400-3eaa6eb4-7080-11e8-81ea-ddd71c5c330d.png)


### Environment

* Chrome version: 67.0.3396.87 (Official Build) (64-bit)

**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](http://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

There is an "old type" import statement in flask_cache/jinja2ext.py

```python
import flask_cache.jinja2ext
```

### Actual Behavior

jinja2ext.py does "from flask.ext.cache import make_template_fragment_key" which is referring to
an old module structure - flask.ext.cache has moved to flask_cache, hasn't it?

```pytb
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/home/jensand/ve_unpin/local/lib/python2.7/site-packages/flask_cache/jinja2ext.py", line 33, in <module>
    from flask.ext.cache import make_template_fragment_key
ImportError: No module named ext.cache

```

### Environment

* Python version: 2.7.12
* Flask version: 1.0.2
* Flask-Cache: 0.13.1
* Werkzeug version: 0.14.1

If people have a .flaskenv but python-dotenv not installed, the old tip may confuse them.
This PR fixes the issue of wrongly prompting to install dotenv if .env is a file

Link to any relevant issues or pull requests.
https://github.com/pallets/flask/issues/2823

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

otherwise the user is confronted with an unpleasant error
message when accessing the dev server the first time

> Describe what this patch does to fix the issue.
no code change
added init-db call to flask tutorial's README.rst

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Fixes issue [2824](https://github.com/pallets/flask/issues/2824)

Now when you run ```flask --version``` command it shows you the Werkzeug version as well. I changed the order as well to be Python, Flask and Werkzeug as it is shown in the issue template.

Let me know if it has to be done in some other way.
### Expected Behavior

Running `flask --version` should output Flask, Python and Werkzeug versions, as those are the versions asked in the issue template on github.

### Actual Behavior

`flask --version` only outputs Flask and Python versions (and GCC, for some reason?).

### Environment

* Python version: 3.6.5
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

I place my virtualenvs in a `.env` directory in my project directory. Flask 1.x sees this directory and thinks it might be a "dotenv" file (even though it is a directory).

### Expected Behavior

`flask` should ignore a `.env` directory when `python-dotenv` is not installed.

### Actual Behavior

`flask` says:

> * Tip: There are .env files present. Do "pip install python-dotenv" to use them.

### Environment

* Python version: 3.6.5
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

            ```org_schema = OrganisationSearchSerializer()
            result = org_schema.dump({'organisations': organisation_data})
           return jsonify(result)```

Sample Code

it gives output as 
``` [
    {
        "organisations": []
    },
    {}
]```

Actual output should be

```[
    "data":{
        "organisations": []
    },
    "error": {}
]```

there is some bug in jsonify it removes the key

### Expected Behavior

All methods added with `@app.before_request` should be run.

```python
Paste a minimal example that causes the problem.
```

### Actual Behavior

If an exception occurs in a single `@app.before_request` method, all following `@app.before_request` methods will not run.

### Context

For a detailed example of this causing an issue, see https://github.com/GoogleCloudPlatform/flask-talisman/issues/22.

In summary, Flask-Talisman does setup in an `@app.before_request` method which is expected to be done by the time it runs an `@app.after_request` method. However, if an exception occurs in an `@app.before_request` method that runs  before Flask-Talisman's, and that exception is caught by an `@app.errorhandler`, then Flask-Talisman's `@app.after_request` method can be run without the setup work ever being done.
I've encountered a strange behavior when passing the `static_url_path` on Flask app initialization and on a already instantiated app.

Below examples are built based  on a structure as follows:
```
run.py
static
  |_main.css
```

### Case Study 1:

```
from flask import Flask

app = Flask(__name__, static_url_path='/media')


if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080, debug=True)
```

#### Expected Behavior

`main.css` file should be accessible on `/media/main.css`

#### Actual Behavior

`main.css` file is accessible on `/media/main.css` as it should be

### Case Study 2:

```
from flask import Flask

app = Flask(__name__)


if __name__ == '__main__':
    app.static_url_path = '/media'    

    app.run(host='0.0.0.0', port=8080, debug=True)

```

#### Expected Behavior

`main.css` file should be accessible on `/media/main.css`

#### Actual Behavior

`main.css` file is not accessible on `/media/main.css`, instead is accessible on default `static_url_path`

```pytb
127.0.0.1 - - [08/Jun/2018 17:11:48] "GET /media/main.css HTTP/1.1" 404 -
127.0.0.1 - - [08/Jun/2018 17:11:53] "GET /static/main.css HTTP/1.1" 200 -
```

### Environment

* Python version: 3.6.5
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

### Expected Behavior
When an error occurs and traceback is printed out, the stderr should be flushed.

File `app.py`:
```python
from flask import Flask
app = Flask(__name__)

@app.route('/')
def err():
  return i_will_cause_an_error(" :'( ")

if __name__ == '__name__':
  app.run()
```
And then run it with `python app.py 2>out.txt` and connect to the server, e.g. using `curl http://localhost:5000/`

Here I'd expect to see the `127.0.0.1 - - [<date>] "GET / HTTP/1.1 500 -` and a full traceback for the `AttributeError` raised in the file `out.txt`

### Actual Behavior
Only `127.0.0.1 - - [<date>] "GET / HTTP/1.1 500 -` shows up in the `out.txt` file. Only when a new request is made the full traceback is flushed to the file, together with the new response log line.

### Environment
| | version|
| ------------- |:-------------:|
| Python | 3.5.2 |
| Flask | 1.0.2 |
| Werkzeug | 0.14.1 |
**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](http://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior
Template should be renderd

```python
taSession=Transaktionshandler(path,username,sha1pw[0][0])
...some basic session stuff....
return render_template(index.html)
```

### Actual Behavior
I am importing a Module that wraps my c++ code (python capi). That Modul contains a struct. When I create the struct some connections and threads are initialized. Nothing fails. After this i am doing some Session handling, nothing failes. But at the moment i want to render a template python crashes. When i return instate of render template somthing like  return "TEST", python do not crash.

On the other hand, when I don't load my Modul there is no problem.

I am Debugging with msvc and i can see that the render_template function runs, but i cant't jump into the _render function of the templatin.py file.

### Environment

* Python version: 3.5.4
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

### Expected Behavior

We have a Flask app defined in a file which sits inside a folder, say `app/run.py`:

```python
from flask import Flask

from foo import bar

app = Flask(__name__)

app.run()
```

The file imports from the top-level directory, in this case `foo.py`

```python
bar = "SOMETHING TO IMPORT"
```

The empty file `__init__.py` exists in the directory `app`.

Using the default environment (production), we can run the Flask app by invoking the module from the top-level directory, using `-m`

```
python -m app.run
```

The `foo` module is imported correctly and the app runs.

```
 * Serving Flask app "run" (lazy loading)
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
```

### Actual Behavior

If we try to use the development environment, setting the `FLASK_ENV` variable, it fails.

```
FLASK_ENV=development python -m app.run
```

```pytb
 * Serving Flask app "run" (lazy loading)
 * Environment: development
 * Debug mode: on
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
Traceback (most recent call last):
  File "/home/jack/z/flask_dev/app/run.py", line 3, in <module>
    from foo import bar
ImportError: No module named foo
```

### Environment

* Python version: 
    Python 2.7.12 (default, Nov 20 2017, 18:23:56) 
    [GCC 5.4.0 20160609] on linux2

* package versions:
    click==6.7
    Flask==1.0.2
    itsdangerous==0.24
    Jinja2==2.10
    MarkupSafe==1.0
    Werkzeug==0.14.1

Are there any plans to write upgrade notes from 0.12 to 1.x?

### Expected Behavior

Following the steps documented in https://github.com/pallets/flask/tree/1.0.2/examples/tutorial results in a functioning website in http://127.0.0.1:5000

### Actual Behavior

Tell us what happens instead.

```pytb
(venv) Main@DESKTOP-4DUIS04 C:\Git\flask\examples\tutorial
$ flask run
 * Serving Flask app "flaskr" (lazy loading)
 * Environment: development
 * Debug mode: on
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 204-731-212
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
127.0.0.1 - - [04/Jun/2018 11:35:09] "GET / HTTP/1.1" 500 -
Traceback (most recent call last):
  File "c:\git\flask\flask\app.py", line 2309, in __call__
    return self.wsgi_app(environ, start_response)
  File "c:\git\flask\flask\app.py", line 2295, in wsgi_app
    response = self.handle_exception(e)
  File "c:\git\flask\flask\app.py", line 1741, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "c:\git\flask\flask\_compat.py", line 35, in reraise
    raise value
  File "c:\git\flask\flask\app.py", line 2292, in wsgi_app
    response = self.full_dispatch_request()
  File "c:\git\flask\flask\app.py", line 1815, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "c:\git\flask\flask\app.py", line 1718, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "c:\git\flask\flask\_compat.py", line 35, in reraise
    raise value
  File "c:\git\flask\flask\app.py", line 1813, in full_dispatch_request
    rv = self.dispatch_request()
  File "c:\git\flask\flask\app.py", line 1799, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "C:\Git\flask\examples\tutorial\flaskr\blog.py", line 17, in index
    'SELECT p.id, title, body, created, author_id, username'
sqlite3.OperationalError: no such table: post
127.0.0.1 - - [04/Jun/2018 11:35:09] "GET /?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1" 200 -
127.0.0.1 - - [04/Jun/2018 11:35:09] "GET /?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1" 200 -
127.0.0.1 - - [04/Jun/2018 11:35:09] "GET /?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1" 200 -
127.0.0.1 - - [04/Jun/2018 11:35:09] "GET /?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1" 200 -
127.0.0.1 - - [04/Jun/2018 11:35:10] "GET /?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1" 200 -
127.0.0.1 - - [04/Jun/2018 11:37:07] "GET / HTTP/1.1" 500 -
```

### Reproduction steps
I've tried this multiple times, using both Windows python and Ubuntu on WSL, same issues. I've made sure to both read the documentation from 1.0.2 and checkout 1.0.2 from the documentation. I have made sure not to have flask or flaskr installed on my actual environments in case that matters, only in venv.

### Environment

* Python version: 3.6
* Flask version: 1.0.2
* Werkzeug version: Don't know what that is. It is not mentioned in the tutorial.
### Expected Behavior

Returns template


```python
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xa9 in position 17727: invalid start byte
```

### Actual Behavior

Tell us what happens instead.

```pytb
builtins.UnicodeDecodeError
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xa9 in position 17727: invalid start byte

```

### Environment

* Python version: 3.6
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

### Expected Behavior

Deployed a flask application which is reachable over multiple domains and ports:
- external via load balancer: `client - Host: example.org -> LB -> flask app`
- internal via DNS service discovery without load balancer: `client - Host: instance-1231.example.org -> flask app` 

If the client connects directly (`Host: instance-1231.example.org`) the app should be able to return absolute and stable URLs like `http://example.org/path/to/my/view` as the URL (`http://instance-1231.example.org/path/to/my/view`) with the internal DNS name is ephemeral.
Therefore I configured the `SERVER_NAME` config key and `url_for` generates the intended absolute URL by using `_external=True` within and without request context. But the app should be still able to route requests coming with `Host: instance-1231.example.org`.

### Actual Behavior

Flasks creates the `werkzeug.routing.MapAdapter` with `server_name=app.config['SERVER_NAME']` and therefore no view method will match to incoming requests with `Host: instance-1231.example.org`.

### Environment

* Python version: 2.7.13 (I'm sorry)
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

### Applied workaround:

Overwrite `Flask.create_url_adapter` and create `MapAdapter` for request context without `server_name` parameter. Routing and URL generation works fine.

I am using flask to run my long process that already related to session which hold user id and other information. i try to use new thread with both following methods but still got error 'RuntimeError: Working outside of request context.'

Method 1

```
import threading
Thread(target=lambda: fn(**args)).start()
```

Method 2

```
import thread
thread.start_new_thread(fn, (), args)
```
Add test for #2752 

### Expected Behavior
If a `multipart/form-data` body is not conforming to RFC return an HTTP error, do log a message or parse the data anyways.

Strangly [`werkzeug.formparser`](https://github.com/pallets/werkzeug/blob/master/werkzeug/formparser.py#L336) does throw an error, but I don't know what happens then in flask with it.

```
POST /garmin-inbox HTTP/1.1
Content-Type: multipart/form-data; boundary=Boundary_19_110302338_1527600550018

--Boundary_19_110302338_1527600550018
Content-Type: application/octet-stream

Hello123

--Boundary_19_110302338_1527600550018
Content-Type: application/json

blabla
--Boundary_19_110302338_1527600550018--
```

```python
@app.route('/inbox', methods=['POST'])
def inbox():
    pprint(request.form) # will be empty
    pprint(request.files) # will be empty
```

### Actual Behavior
If a http client behaves not like defined in [RFC7578](https://tools.ietf.org/html/rfc7578#section-4.2) the `request.form` and `request.files` fields are just empty. 


### Environment

* Python version: 3.6.5
* Flask version: 1.0.2
* Werkzeug version: 0.14.1



I added a test for the url generation when a parameter is used.

I followed the instructions of how to contribute and added a test that didn't have test coverage.
Fixes #2802

Changed the link to be a `:ref:` to the `uwsgi` document. Also mean it links to the top of the document, so includes the 'watch out' admonition for extra clarity.

Fixes #2802 

Just changed the link to be a `:ref:` to the `uwsgi` document.  Also mean it links to the top of the document, so includes the 'watch out' admonition for extra clarity.
closes #2766 

This produces the `filename*` header more often (since only ASCII characters are allowed now), but is compatible with Gunicorn and any other WSGI servers that are more strict about header encoding.
I have a setup where one route behaves as a form processor for various forms. Under the normal circumstance of uploading an audio file... (mp3)... I would be using "flask.request.files" to process this file.

But what if I do not have any forms on the site that upload files... what I have noticed and provided a file for to duplicate the issue ... is in the event of an audio file POST upload to a form processor that does not have a control to process files... ie "flask.request.files".... the "flask.redirect([route])" fails... 

Line 61 of the sample file is purposely left commented out...to demonstrate the redirect failure... by removing comment and enabling ..."posted_files = flask.request.files" .... the redirect magically works again...

There seems to be an issue in the fact that an audio file is being posted... the same test run with images file formats entered into line 40.....ie.... accept=".jpg, .png" do not effect the redirect... 

[flask_error.zip](https://github.com/pallets/flask/files/2043603/flask_error.zip)

In case anyone is interested.... I'm running Flask v1.0.2 on Python v3.6.3




In `flask/docs/deploying/wsgi-standalone.rst`, https://github.com/pallets/flask/blob/master/docs/deploying/uwsgi.html#starting-your-app-with-uwsgi link which is on `For a more optimized setup, see configuring uWSGI and NGINX.` line is broken.
Since a few days I am facing this error when running `Flask.run()` caused by `click` on Windows 10.0.17134 with Python 3.6.5, flask 1.0.2 and click6.7:
```
Traceback (most recent call last):
  File "D:\Code\GitHub\StarCraft-Casting-Tool\scctool\tasks\webapp.py", line 189, in run
    self.application.run(port=65010)
  File "c:\users\tasch\appdata\local\programs\python\python36-32\lib\site-packages\flask\app.py", line 938, in run
    cli.show_server_banner(self.env, self.debug, self.name, False)
  File "c:\users\tasch\appdata\local\programs\python\python36-32\lib\site-packages\flask\cli.py", line 629, in show_server_banner
    click.echo(message)
  File "c:\users\tasch\appdata\local\programs\python\python36-32\lib\site-packages\click\utils.py", line 217, in echo
    file = _default_text_stdout()
  File "c:\users\tasch\appdata\local\programs\python\python36-32\lib\site-packages\click\_compat.py", line 621, in func
    rv = wrapper_func()
  File "c:\users\tasch\appdata\local\programs\python\python36-32\lib\site-packages\click\_compat.py", line 385, in get_text_stdout
    rv = _get_windows_console_stream(sys.stdout, encoding, errors)
  File "c:\users\tasch\appdata\local\programs\python\python36-32\lib\site-packages\click\_winconsole.py", line 264, in _get_windows_console_stream
    f = getattr(f, 'buffer')
AttributeError: 'FileWrapper' object has no attribute 'buffer'
```

Can anybody help me?
I am using the following snippet to wrap an api result which i got from [this talk](http://mitsuhiko.pocoo.org/flaskfun.pdf) by @mitsuhiko (page 36-37)

```python
# api.py
class ApiResult:
    def __init__(self, value, status=200):
        self.value = value
        self.status = status

    def to_response(self):
        return make_response(jsonify(self.value), self.status)

# app.py
class ApiFlask(Flask):

    def make_response(self, rv):
        if isinstance(rv, ApiResult):
            return rv.to_response()
        return super().make_response(rv)
```

I've been using this code for a while in an App and everything worked fine. Now I am creating a new app and I am trying to use the same snippet but I get the following error:

```pytb
Traceback (most recent call last):
  File "xxx\site-packages\flask\app.py", line 1997, in __call__
    return self.wsgi_app(environ, start_response)
  File "xxx\site-packages\flask\app.py", line 1985, in wsgi_app
    response = self.handle_exception(e)
  File "xxx\site-packages\flask\app.py", line 1540, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "xxx\site-packages\flask\_compat.py", line 33, in reraise
    raise value
  File "xxx\site-packages\flask\app.py", line 1982, in wsgi_app
    response = self.full_dispatch_request()
  File "xxx\site-packages\flask\app.py", line 1615, in full_dispatch_request
    return self.finalize_request(rv)
  File "xxx\site-packages\flask\app.py", line 1630, in finalize_request
    response = self.make_response(rv)
  File "yyy\source\app.py", line 28, in make_response
    return super().make_response(rv)
  File "xxx\site-packages\flask\app.py", line 1740, in make_response
    rv = self.response_class.force_type(rv, request.environ)
  File "xxx\site-packages\werkzeug\wrappers.py", line 921, in force_type
    response = BaseResponse(*_run_wsgi_app(response, environ))
  File "xxx\site-packages\werkzeug\wrappers.py", line 59, in _run_wsgi_app
    return _run_wsgi_app(*args)
  File "xxx\site-packages\werkzeug\test.py", line 923, in run_wsgi_app
    app_rv = app(environ, start_response)
TypeError: 'ApiResult' object is not callable
```

which is super weird because both apps use the same flask and werkzeug versions.

Any idea what is going on ?


### Environment

* Python version: 3.6
* Flask version: 0.12.2
* Werkzeug version: 0.14.1

this does not work on fish (https://fishshell.com):
```shell
$ FLASK_APP=hello.py flask run
```

while this works (hopefully) on any shell:
```shell
$ env FLASK_APP=hello.py flask run
```
I have already done some coding and get app with 3 lang urls but it may not be clear
https://stackoverflow.com/questions/49496761/two-language-flask-site-with-or-without-blueprints/49948870#49948870


http://flask.pocoo.org/docs/1.0/patterns/deferredcallbacks/

documentation for this is not clear too 

Can anyone put the full example for international URLs in documentation ? and also using it in jinja and switching between languages and also using it without Babel

SSLContext was introduced in 2.7.9.
I strongly believe that more secure options should be the default. I know this is a breaking change and might spark some controversy, as it would break loads of small hobby projects that lack https running on localhost etc. 

I'm not too sure about under which version I should edit changes.rst and which version versionchanged should mention, so I will update those later if you decide to go through with this change. Sorry for the imperfect PR for now!
Add the link of pull so that it’s easy for readers to check the changes in code.
My python flask app runs using `nohup`. ie it is always live. I see that it creates a thread every time user submits from page. It is because flask.run is with `multithread=true`. But my problem is even after the processing is over, the thread doesn't seem to be closed. I'm checking this with the `ps -eLf |grep userid` command. where i see many threads still active long after the code execution is over. and it gets added when another submit is done. All threads are removed when the app itself is restarted.

What is the criteria for the thread to close without restarting the app?
is it because the memory not getting released?

```
app = Flask(__name__)
@app.route('/submit',methods = ['GET','POST'])
def submit():
    #obj1=class1()
    #obj2=class2(obj1)
    #obj3=class3(obj1)
    #refer objects
    #process data
    #done

if __name__ == "__main__":
    app.run(host='0.0.0.0', port=4000, threaded=True, debug=False)
```
gevent.wsgi is deprecated since gevent 1.1 and removed in gevent 1.3. 
gevent.pywsgi should be used instead

### Expected Behavior

When Flask isn't running from the command line, it should not try to initialize Click, or should not fail to start due to locale mismatches.


### Actual Behavior

I am running a Flask app on Dreamhost shared hosting using their Passenger-WSGI wrapper. As their wrapper is not configured to work with Pipenv, I use the following `passenger_wsgi.py` (based on [Dreamhost's instructions](https://help.dreamhost.com/hc/en-us/articles/215769548-Passenger-and-Python-WSGI)) to shunt my interpreter over to my pipenv's Python 3.6 and then import my `app` object from `main.py`:

```
import sys
import os
import subprocess

INTERP = subprocess.check_output(
    ['pipenv', 'run', 'which', 'python3']).strip().decode('utf-8')
if sys.executable != INTERP:
    os.execl(INTERP, INTERP, *sys.argv)

sys.path.append(os.getcwd())
from main import app as application
```

This was working fine before Flask added the Click dependency; however, after upgrading, I got the following error at startup:

```
Traceback (most recent call last):
File "/home/plaidfluff/opt/python-3.6.5/bin/pipenv", line 11, in <module>
sys.exit(cli())
File "/home/plaidfluff/opt/python-3.6.5/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 722, in __call__
return self.main(*args, **kwargs)
File "/home/plaidfluff/opt/python-3.6.5/lib/python3.6/site-packages/pipenv/vendor/cl ck/core.py", line 676, in main
_verify_python3_env()
File "/home/plaidfluff/opt/python-3.6.5/lib/python3.6/site-packages/pipenv/vendor/click/_unicodefun.py", line 118, in _verify_python3_env
'for mitigation steps.' + extra)
RuntimeError: Click will abort further execution because Python 3 was configured to use ASCII as encoding for the environment. Consult http://click.pocoo.org/python3/for mitigation steps.

This system supports the C.UTF-8 locale which is recommended.
You might be able to resolve your issue by exporting the
following environment variables:

export LC_ALL=C.UTF-8
export LANG=C.UTF-8

Traceback (most recent call last):
File "/home/plaidfluff/opt/python-3.6.5/bin/pipenv", line 11, in <module>
sys.exit(cli())
File "/home/plaidfluff/opt/python-3.6.5/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 722, in __call__
return self.main(*args, **kwargs)
File "/home/plaidfluff/opt/python-3.6.5/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 676, in main
_verify_python3_env()
File "/home/plaidfluff/opt/python-3.6.5/lib/python3.6/site-packages/pipenv/vendor/click/_unicodefun.py", line 118, in _verify_python3_env
'for mitigation steps.' + extra)
RuntimeError: Click will abort further execution because Python 3 was configured to use ASCII as encoding for the environment. Consult http://click.pocoo.org/python3/for mitigation steps.

This system supports the C.UTF-8 locale which is recommended.
You might be able to resolve your issue by exporting the
following environment variables:

export LC_ALL=C.UTF-8
export LANG=C.UTF-8
Traceback (most recent call last):
File "/dh/passenger/helper-scripts/wsgi-loader.py", line 320, in <module>
app_module = load_app()
File "/dh/passenger/helper-scripts/wsgi-loader.py", line 61, in load_app
return imp.load_source('passenger_wsgi', startup_file)
File "passenger_wsgi.py", line 33, in <module>
['pipenv', 'run', 'which', 'python3']).strip().decode('utf-8')
File "/usr/lib/python2.7/subprocess.py", line 573, in check_output
raise CalledProcessError(retcode, cmd, output=output)
subprocess.CalledProcessError: Command '['pipenv', 'run', 'which', 'python3']' returned non-zero exit status 1
```

Unfortunately, I don't have any control over the `LC_ALL` or `LANG` environment variables at startup, and simply overriding them via `os.execle()` or `os.putenv()` had no effect. However, I did find that adding these two lines to the beginning of my `passenger_wsgi.py` file worked to override this check:

```
os.environ['LANG'] = 'C.UTF-8'
os.environ['LC_ALL'] = 'C.UTF-8'
```

This is inelegant, but since I am not actually using Click (at least not directly) this felt like an okay compromise, although I am concerned it may have other encoding-related side-effects on other parts of my application.

In any case, it doesn't seem like Click should even be getting imported in a context where I have a Python script that instantiates a Flask app directly rather than through its command-line processor. Any mechanism that would prevent this RuntimeError from taking down my entire website would be greatly appreciated.

Thanks!

### Environment

* Python version: 3.6.5
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

I've done some homework and read up on #2450. I don't really understand the rationale behind that PR, and I don't think it really helps with Flask usage overall. To explain a bit...

I maintain a [relatively complex project](https://github.com/discord-python/site) that builds its own API on top of Flask. This change heavily breaks our application structure, as we currently use dots as separators for view classes under our blueprints. Consider the following:

* You have sets of blueprints - we use one for each subdomain
* Each blueprint has a name - for example, `main`
* Under a blueprint might be a logical section - for example, there might be an "about" section, so let's call this `main.about`
* The logical section will have pages under it - to me, the logical thing to do is use more dots as separators, so `main.about.privacy` for example

Now, one solution would be to use some other separator. Why not `about/privacy`? `about-privacy`? The thing is, regardless of what separator you decide to use there, blueprints must always be separated from the view name using a `.`. So in, `url_for()` for example, we would have to use `url_for("main.about/privacy")`, which just looks plain ugly.

<details>
<summary>Some sample code</summary>
A sample route:

```py
from pysite.base_route import TemplateView

class PrivacyView(TemplateView):
    path = "/about/privacy"
    name = "about.privacy"
    template = "main/about/privacy.html"
```

How we register this route:

```py
class TemplateView(RouteView):
    name = None  # type: str
    path = None  # type: str

    # We have a bunch of inheritance, but here's the relevant method from the superclass.
    # RouteView inherits from MethodView and we dynamically load all our routes on startup.

    @classmethod
    def setup(cls: "RouteView", manager: "pysite.route_manager.RouteManager", blueprint: Blueprint):
        """
        Set up the view by adding it to the blueprint passed in - this will also deal with multiple inheritance by
        calling `super().setup()` as appropriate.

        This is for a standard route view. Nothing special here.

        :param manager: Instance of the current RouteManager
        :param blueprint: Current Flask blueprint to register this route to
        """

        # ... misc code

        blueprint.add_url_rule(cls.path, view_func=cls.as_view(cls.name))
```

This seems like the correct way to be doing this, right?
</details>

---

So, to summarize, here's what I'm asking:

1. Why exactly was this change made in the first place?
2. What should we be doing otherwise?
We're still using Python 2.7.6 for some projects which causes the exception listed below when trying to execute `flask run`. The problem appears to be when the run command executes `flask.cli._validate_key` which then checks for Python version 2.7 or above before attempting to access `ssl.SSLContext`. The problem with that is that SSLContext was only added in 2.7.9 so the check needs to be more exact by checking for versions 2.7.9 and above.

Relevant tests already fail under Python 2.7.6 and have been updated so this patch doesn't require any additional tests as far as I can tell. Let me know if that is not the case.

```
Traceback (most recent call last):
  File "/usr/local/bin/flask", line 11, in <module>
    sys.exit(main())
  File "/usr/local/lib/python2.7/dist-packages/flask/cli.py", line 894, in main
    cli.main(args=args, prog_name=name)
  File "/usr/local/lib/python2.7/dist-packages/flask/cli.py", line 557, in main
    return super(FlaskGroup, self).main(*args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 1064, in invoke
    sub_ctx = cmd.make_context(cmd_name, args, parent=ctx)  
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 621, in make_context
    self.parse_args(ctx, args)
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 880, in parse_args
    value, args = param.handle_parse_result(ctx, opts, args)
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 1404, in handle_parse_result
    self.callback, ctx, self, value)
  File "/usr/local/lib/python2.7/dist-packages/click/core.py", line 78, in invoke_param_callback
    return callback(ctx, param, value)
  File "/usr/local/lib/python2.7/dist-packages/flask/cli.py", line 693, in _validate_key
    is_context = isinstance(cert, ssl.SSLContext)
AttributeError: 'module' object has no attribute 'SSLContext'
```

Version information:

```
$ flask --version
Flask 1.0.2
Python 2.7.6 (default, Jun 22 2015, 17:58:13) 
[GCC 4.8.2]
```
Using the example in the docs:

```python
import flask
import logging.config

logging.config.dictConfig({
    'version': 1,
    'formatters': {'default': {
        'format': '[%(asctime)s] %(levelname)s in %(module)s: %(message)s',
    }},
    'handlers': {'wsgi': {
        'class': 'logging.StreamHandler',
        'stream': 'ext://flask.logging.wsgi_errors_stream',
        'formatter': 'default'
    }},
    'root': {
        'level': 'INFO',
        'handlers': ['wsgi']
    }
})

app = flask.Flask(__name__)
```

produces the following error:
```
ValueError: Unable to configure handler 'wsgi': Cannot resolve 'flask.logging.wsgi_errors_stream': No module named 'flask.logging.wsgi_errors_stream'; 'flask.logging' is not a package
```

changing `ext://flask.logging.wsgi_errors_stream` to `stdout` stops the error, but log level is still ignored.

Using the following:
```python
import flask
import logging.config

logging.config.dictConfig({
    'version': 1,
    'formatters': {
        'default': {
            'format': '[%(asctime)s] %(levelname)s in %(module)s: %(message)s',
        }
    },
    'handlers': {
        'wsgi': {
            'class': 'logging.StreamHandler',
            'stream': 'stdout',
            'formatter': 'default',
        }
    },
    'root': {
        'level': 'DEBUG',
        'handlers': ['wsgi']
    }
})


app = flask.Flask(__name__)

app.logger.debug('I WORK')
app.logger.info('I WORK')
app.logger.warning('I WORK')
app.logger.error('I WORK')
app.logger.critical('I WORK')
```
(Note the log level set to `DEBUG`)

Actual Output:
```
[2018-05-17 11:35:20,069] ERROR in __init__: I WORK
[2018-05-17 11:35:20,069] CRITICAL in __init__: I WORK
```

Expected output:
```
[2018-05-17 11:35:20,069] DEBUG in __init__: I WORK
[2018-05-17 11:35:20,069] INFO in __init__: I WORK
[2018-05-17 11:35:20,069] WARNING in __init__: I WORK
[2018-05-17 11:35:20,069] ERROR in __init__: I WORK
[2018-05-17 11:35:20,069] CRITICAL in __init__: I WORK
```
I have also tried both setting the level in the handler and formatter and calling `app.logger.setLevel('DEBUG')`
neither made any difference.

TL;DR:
 - logging example in docs errors.
 - unable to set log level
---

### Environment

* Python version: 3.6.4
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

Added sys.stdout as a second parameter to click.echo. This helps with the 'UnsupportedOperation: not writable' error in Jupyter.

I think that Jupyter hijacks and locks the STDOUT/STDERR (at least the one click is trying to use) and if you don't provide a stream to click.echo(), it will attempt writing to the STDOUT/STDERR, hence the error.


<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Using `super()` with arguments for backward compatible.
Hi,
I follow readme in tutorial.
set FLASK_APP=flaskr
set FLASK_ENV=development
flask run
But i got 
**Error: Failed to find application in module "flaskr". Are you sure it contains a Flask application? Maybe you wrapped it in a WSGI middleware or you are using a factory function.**

I try to read many fixed issues about that and follow carefully http://flask.pocoo.org/docs/0.12/ but :(

So, this tries to address the ability to easily add commands to blueprints, and let them get stacked into the applications cli group in one of three ways.

The default is nested, with name taken from the bp name, giving you `flask user create`:

    bp = Blueprint('user', __name__)
    bp.cli.command('create')

Optionally you can override that grouping name, giving you `flask librarian create`:

    bp = Blueprint('user', __name__, cli_group='librarian')
    bp.cli.command('create')

Or, you can specify `None` as the group, which applies it directly to the root app's cli group giving `flask add_user`:

    bp = Blueprint('user', __name__, cli_group=None)
    bp.cli.command('add_user')

The tests show each of these options.  Let me know your thoughts and I'll add the documentation changes required if everyone think's it's useful to proceed.

`cli_group` can also be specified when registering on the app: `app.register_blueprint(bp, cli_group="librarian")` to override the bp level `cli_group` choice.

closes #1357 
This MR fixes issue with custom error handler not being called when exception is raised.

Issue #2778
Updating the documentation for error handling for writing custom error handlers for HTTPException and Internal Server Error.

Clarification for https://github.com/pallets/flask/issues/2778
This change expands the venerable `app.run()` function with cli support. At this point this is a proof of concept to investigate if this can be done without breaking existing applications. Feedback appreciated!

Given an application `myapp.py`, which ends with:

```python
if __name__ == '__main__':
    app.run()
```

The following features are supported:

- Running `python myapp.py` with no additional arguments is redirected to `flask run` in the cli module. The value of `FLASK_APP` is determined through introspection if not provided. If a value for `FLASK_APP` cannot be determined, then the original `app.run()` function is used.
- Running `python myapp.py` with any arguments redirects to the `flask` command with the same arguments. For example: `python myapp.py --help` is the same as `flask --help`, `python myapp.py shell` starts the shell, and so on. Custom cli commands are also supported.
- If the script passes `host` or `port` arguments in `app.run()`, those are also passed on to the `flask run` command in the cli module.
- If the script calls `app.run(debug=True)` then `FLASK_ENV=development` is added to the environment (only if `FLASK_ENV` is not set).
- If the `app.run()` call specifies any custom settings besides `host`, `port`, and `debug`, then the original logic is used for now. I can go through all the available options to `run_simple()` and see if there are other ones that can be supported through the cli.
Please add error handlers to Blueprint (404 and others)
For multi language Site I had to write app error handlers and cookies and after requests with session and cookie and a bit mess in my code so may error handling inside blueprint is good idea 

Thanks
**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](http://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

I should be able to log in just by `session['profile'] = current_user`

```python
Before Flask 1.X I could login simply by adding a user profile returned by `auth0` to flask session.
Then check if session['profile'] is set to know if the user is logged in and who he is.
```

### Actual Behavior

Tell us what happens instead.
I get: `set_cookie() got an unexpected keyword argument 'samesite'`

I've added to my config file the following:
`	SESSION_COOKIE_SAMESITE='Lax'`
I've also tried with 
`	SESSION_COOKIE_SAMESITE='Strict'`

```pytb
Paste the full traceback if there was an exception.

Traceback (most recent call last):
  File "/Users/c/Dev/Metri/Code/menv/lib/python3.6/site-packages/flask/app.py", line 2309, in __call__
    return self.wsgi_app(environ, start_response)
  File "/Users/c/Dev/Metri/Code/menv/lib/python3.6/site-packages/flask/app.py", line 2295, in wsgi_app
    response = self.handle_exception(e)
  File "/Users/c/Dev/Metri/Code/menv/lib/python3.6/site-packages/flask/app.py", line 1741, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/Users/c/Dev/Metri/Code/menv/lib/python3.6/site-packages/flask/_compat.py", line 35, in reraise
    raise value
  File "/Users/c/Dev/Metri/Code/menv/lib/python3.6/site-packages/flask/app.py", line 2292, in wsgi_app
    response = self.full_dispatch_request()
  File "/Users/c/Dev/Metri/Code/menv/lib/python3.6/site-packages/flask/app.py", line 1816, in full_dispatch_request
    return self.finalize_request(rv)
  File "/Users/c/Dev/Metri/Code/menv/lib/python3.6/site-packages/flask/app.py", line 1833, in finalize_request
    response = self.process_response(response)
  File "/Users/c/Dev/Metri/Code/menv/lib/python3.6/site-packages/flask/app.py", line 2114, in process_response
    self.session_interface.save_session(self, ctx.session, response)
  File "/Users/c/Dev/Metri/Code/menv/lib/python3.6/site-packages/flask/sessions.py", line 384, in save_session
    samesite=samesite
TypeError: set_cookie() got an unexpected keyword argument 'samesite'
```

### Environment

* Python version: Python 3.6.3
* Flask version:1.0.2
* Werkzeug version:0.12

If register an error handler for exception class `A` then this error handler will be called for any exception `B` that isn't `A` or subclass of `A`.

## Expected Behavior
Given error handler must be called only for exceptions that's instance of `A` or instance of subclass of `A`.

## Actual Behavior
Error handler processes any exception.

## How to reproduce
Minimal code:

```python3
import flask
from werkzeug.exceptions import HTTPException

app = flask.Flask(__name__)
app.register_error_handler(HTTPException, lambda e: (str(e), e.code))

@app.route('/')
def index():
    raise ValueError()

app.run()
```

1. Run script
2. Go to  http://127.0.0.1:5000/ 

Server logs exception `AttributeError: 'ValueError' object has no attribute 'code'`, i.e. registered error handler is called for `ValueError` exception, but the error handler is registered only for `HTTPException` and its subclasses.


## Environment

* Python version: 3.5.2
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

The `cli.main()` function captures the command-line arguments, and then attempts to change the arguments in the `sys.argv` list from `flask ...` to `python -m flask ...`. The problem is that it misses the `sys,argv[0]` element, so the modified argument list begins with `-m` in the 0th element.

I honestly don't remember why `sys.argv` needs to be changed to the `python -m` form, but I assume there is a good reason for that, so this change adds `sys.executable` as the first argument.
- [x] Many users falsely assume Flask's builtin server is suitable for
  deployment. Unfortunately the quickstart didn't explicitly mention this at
  all.
- [x] The change from `app.run` to the `flask` command has left some traces.
- [x] Not even the deployment docs themselves mention how bad the builtin
  server is, instead they plainly say "don't use it".

L496 in helpers.py
If i use flask as a package instead of a module,  I want to expose a file which is not in package.
checks in send_from_directory will be passed because of rel path.  However, in send_file,  added abs folder, it occur an error.

Here's the example:

``` python
from flask import Flask, flash, get_flashed_messages, redirect, url_for

app = Flask(__name__)
app.secret_key = 'some_secret'

@app.route('/')
def index():
    app.logger.debug(get_flashed_messages())
    return 'Hello world'

@app.route('/generate/success')
def page_success():
    flash('This message will be visible!')
    return str(get_flashed_messages())

@app.route('/generate/fail',)
def page_fail():
    flash('This message will be lost!')
    return redirect(url_for('index'))

if __name__ == "__main__":
    app.run()
```

As you can see flash() fails when using redirect. Tried with `SERVER_NAME` both set and unset. Using `Flask==0.10.1`.

Please resolve the issue ASAP since it's a top blocker in my project.

I use a flask server to serve static files from a server but once in a while the server becomes completely unresponsive, downloading a file keeps loading but never downloads. When I opened up the terminal, I found some weird requests, I hit CTRL + C and the server immediately becomes responsive again and downloads continue. This happens every so often and I have no idea what's causing this and how to prevent it from freezing my flask server, is this someone trying to hack?

```
user@server:~/worker# python server.py
 * Running on http://0.0.0.0:80/
93.134.13.318 - - [03/Sep/2014 02:07:18] code 400, message Bad request syntax ('\x00')
93.134.13.318 - - [03/Sep/2014 02:07:18] "" 400 -
93.134.13.318 - - [03/Sep/2014 02:07:19] "GET http://httpheader.net HTTP/1.1" 404 -
93.134.13.318 - - [03/Sep/2014 02:07:40] code 400, message Bad request syntax ('\x04\x01\x00P\xc6\xce\x0eu0\x00')
93.174.93.218 - - [03/Sep/2014 02:07:40] "P��u0" 400 -
^C----------------------------------------
Exception happened during processing of request from ('93.174.93.218 ', 45082)
Traceback (most recent call last):
  File "/usr/lib/python2.7/SocketServer.py", line 284, in _handle_request_noblock
    self.process_request(request, client_address)
  File "/usr/lib/python2.7/SocketServer.py", line 310, in process_request
    self.finish_request(request, client_address)
  File "/usr/lib/python2.7/SocketServer.py", line 323, in finish_request
    self.RequestHandlerClass(request, client_address, self)
  File "/usr/lib/python2.7/SocketServer.py", line 638, in __init__
    self.handle()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 200, in handle
    rv = BaseHTTPRequestHandler.handle(self)
  File "/usr/lib/python2.7/BaseHTTPServer.py", line 340, in handle
    self.handle_one_request()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 231, in handle_one_request
    self.raw_requestline = self.rfile.readline()
  File "/usr/lib/python2.7/socket.py", line 447, in readline
    data = self._sock.recv(self._rbufsize)
KeyboardInterrupt
----------------------------------------
42.36.63.90 - - [03/Sep/2014 03:21:20] "GET / HTTP/1.1" 404 -
63.63.193.195 - - [03/Sep/2014 03:21:20] "GET / HTTP/1.1" 404 -
```

i need to run '/etc/init.d/httpd start' in my flask app(port is 443),i used subprocess.Popen and apache can normal start,but i found strange phenomenon,i use lsof -i:443, below is output：
python  10549   root    5u  IPv4  25638      0t0  TCP *:443 (LISTEN)
httpd   10559   root    5u  IPv4  25638      0t0  TCP *:443 (LISTEN)
httpd   10559   root    6u  IPv4  25518      0t0  TCP kxddz_matchserver1:443->192.168.239.1:54365 (CLOSE_WAIT)
httpd   10561 apache    5u  IPv4  25638      0t0  TCP *:443 (LISTEN)
httpd   10561 apache    6u  IPv4  25518      0t0  TCP kxddz_matchserver1:443->192.168.239.1:54365 (CLOSE_WAIT)
httpd   10562 apache    5u  IPv4  25638      0t0  TCP *:443 (LISTEN)
httpd   10562 apache    6u  IPv4  25518      0t0  TCP kxddz_matchserver1:443->192.168.239.1:54365 (CLOSE_WAIT)
httpd   10563 apache    5u  IPv4  25638      0t0  TCP *:443 (LISTEN)
httpd   10563 apache    6u  IPv4  25518      0t0  TCP kxddz_matchserver1:443->192.168.239.1:54365 (CLOSE_WAIT)
httpd   10564 apache    5u  IPv4  25638      0t0  TCP *:443 (LISTEN)
httpd   10564 apache    6u  IPv4  25518      0t0  TCP kxddz_matchserver1:443->192.168.239.1:54365 (CLOSE_WAIT)
httpd   10565 apache    5u  IPv4  25638      0t0  TCP *:443 (LISTEN)
httpd   10565 apache    6u  IPv4  25518      0t0  TCP kxddz_matchserver1:443->192.168.239.1:54365 (CLOSE_WAIT)
httpd   10566 apache    5u  IPv4  25638      0t0  TCP *:443 (LISTEN)
httpd   10566 apache    6u  IPv4  25518      0t0  TCP kxddz_matchserver1:443->192.168.239.1:54365 (CLOSE_WAIT)
httpd   10567 apache    5u  IPv4  25638      0t0  TCP *:443 (LISTEN)
httpd   10567 apache    6u  IPv4  25518      0t0  TCP kxddz_matchserver1:443->192.168.239.1:54365 (CLOSE_WAIT)
httpd   10568 apache    5u  IPv4  25638      0t0  TCP *:443 (LISTEN)
httpd   10568 apache    6u  IPv4  25518      0t0  TCP kxddz_matchserver1:443->192.168.239.1:54365 (CLOSE_WAIT)

this why？

See https://github.com/pocoo/metaflask/issues/8
- [x] Remove assertion methods
- [x] Remove useless classes
- [x] Remaining testcase classes shouldn't inherit from "TestFlask"
- [x] Remaining testcase classes shouldn't use setup and teardown but autouse-fixtures
- [x] Remove `suite` functions

I saw `Flask.run` method was untested and I think a couple of tests wouldn't hurt (and increases code coverage). I would love to hear some feedback about it even if it is not merged at all. I feel pretty enthusiastic about contributing to Flask since I'm a heavy user of the framework.

This property is useful for generating cache keys and it is missing from the docs.


There was a blank line missing that was generating a warning when
building the doc. Also, a removed function from cli.py was left in api.rst
(without_appcontext specifically) so this was also generating warnings.

Also corrects the format for a code block and adds a link to Werkzeug's Headers
class.

Fix #1155

The links on the homepage for the documentation PDF http://flask.pocoo.org/docs/flask-docs.pdf or zipped HTML file http://flask.pocoo.org/docs/flask-docs.zip are not valid (-> chapter 404).

https://github.com/mitsuhiko/werkzeug/pull/528

Under **What do I need?** click should also be listed.

The documentation for the `Flask` class was missing a word. I felt that it is my duty to Python, Flask, and planet Earth to remedy this unfortunate snafu.

Happy Monday!

I followed the documentation found [on flask's site](http://flask.pocoo.org/docs/0.10/installation/#living-on-the-edge). What I was looking to do was `pip install Flask==dev`. Received the following traceback:

```
(burddy)crow@ burddy (master)$ pip install Flask==dev
Downloading/unpacking Flask==dev
  Could not find a version that satisfies the requirement Flask==dev (from versions: 0.1, 0.10.1, 0.10, 0.2, 0.3.1, 0.3, 0.4, 0.5.1, 0.5.2, 0.5, 0.6.1, 0.6, 0.7.1, 0.7.2, 0.7, 0.8.1, 0.8, 0.9)
Cleaning up...
No distributions matching the version for Flask==dev
```

Many channels for distribution of documentation (Internet Archive, most libraries) find it easier to distribute the documentation if it is Creative Commons (CC) licensed -  they aren't able to spend the time to read a custom license, even if it's just a modified Apache License. But for documentation only, there's really no difference between the Flask license and CC-BY http://creativecommons.org/licenses/by/4.0/

Closes #1151.

The following is an incomplete draft. However, I wanted to request comments immediately, in case anything was severely wrong.

The doc should be updated to include:
- [x] How context-local objects in Flask are implemented

Will squash commits later.

---

> The document still needs to cover:
- [ ] When to use the application context
- [ ] What happens during an exception (see http://flask.pocoo.org/docs/reqcontext/ and http://flask.pocoo.org/docs/api/#flask.ctx.RequestContext)

EDIT (08-21)
- [ ] It would useful to ensure anything relevant in "Testing Flask Applications" is included. http://flask.pocoo.org/docs/testing/#faking-resources-and-context
- [ ] It would probably be useful to separate the notion of context objects from proxies; context objects could exist without proxies.

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/1153)

<!-- Reviewable:end -->

I am curious why there isn't an after_response function, in the spirit of after_request. There are often tasks that can take a while and don't need to be 100% reliable, such as writing statistics to a data store, or hitting a third party API, and don't affect the response object. It'd therefore be nice to be able to do this work after the response object has been sent to the user, with an after_response function. This could be done with a task queue, but for a lot of projects this vastly increases complexity.

See: http://flask.pocoo.org/docs/appcontext/

There seems to be two main issues with this page.
1. I'm not sure how to say it, but the prose is vague and lacks focus. The effect in any case is that the concepts are difficult to grasp. [1] [2] [3]
2. Syntax errors and wordiness [4] [5] [6]

[1] "The application setup state in which the application implicitly is on the module level."
[2] "In contrast, during request handling, a couple of other rules exist"
[3] "There is a third state which is sitting in between a little bit."
[4] "The main reason for the application’s context existence is that in the past a bunch of functionality was attached to the request context in lack of a better solution. Since one of the pillar’s of Flask’s design is that you can have more than one application in the same Python process."
[5] "To make an application context there are two ways."
[6] "The context is typically used to cache resources on there that need to be created on a per-request or usage case."


In http://flask.pocoo.org/docs/ , the download link http://flask.pocoo.org/docs/flask-docs.pdf (_sha1:6ddf4ea31f4c5146afb7b68060bc9bd87eacc4c8_) is for v0.11-dev, like that:

![v0.11-dev](https://cloud.githubusercontent.com/assets/1926185/3921018/bc74cf98-23bc-11e4-91eb-f216a0bdfda8.png)

But, the latest release version of Flask is v0.10.1. Please fix it, thank you.

Hi,

I've created an Flaskr example application for a talk that can help people to run Selenium tests on their Flask apps. It uses Travis CI as continuous integration server and Sauce Labs to execute the tests in the cloud. If you're interested I would send you an PR. Here is the link:

https://github.com/christian-bromann/flask-webdriver-demo

Cheers

what I was doing on console: fairly self-explanatory

```
(burddy)crow@crow-VPCS111FM:~/code/burddy$ burddy --help
Usage: burddy [OPTIONS] COMMAND [ARGS]...

Options:
  --debug / --no-debug  Enable or disable debug mode.
  --help                Show this message and exit.

Commands:
  article  manage the articles
  db       Perform database migrations.
  initdb   create the database
  run      Runs a development server.
  seed     make a fake populated website
  shell    Runs a shell in the app context.
  user     manage the users
(burddy)crow@crow-VPCS111FM:~/code/burddy$ burddy db upgrade
(burddy)crow@crow-VPCS111FM:~/code/burddy$ burddy user --help
Usage: burddy user [OPTIONS] COMMAND [ARGS]...

  manage the users

Options:
  --help  Show this message and exit.

Commands:
  seed  adds fake users to database
(burddy)crow@crow-VPCS111FM:~/code/burddy$ burddy user seed
Usage: burddy [OPTIONS]

Error: Got unexpected extra arguments (user seed)
(burddy)crow@crow-VPCS111FM:~/code/burddy$ 
```

Some of the commands do work. If I did `burddy shell`, it works, or `burddy run`, or even `burddy db upgrade`, however, `article` and `user`, in particular, do not have access to their "subcommands".

My repo is [here](https://github.com/DarkCrowz/burddy) if you wish to view it

It would be nice to have an app level config setting for defaulting _external to True in [url_for](https://github.com/mitsuhiko/flask/blob/master/flask/helpers.py#L186) on sites where absolute URLs are required or preferred, removing the need to add the parameter on each url_for call.

Possibly near here:  https://github.com/mitsuhiko/flask/blob/master/flask/helpers.py#L292:

``` python
if current_app.config['NEW_SETTING_NAME_HERE']:
    external = True
```

I love Flask. It's really great.

But one of the things that bothers me about it is how un-opinionated it tries to be, which I think in the end makes it a lot more difficult to use.

There are at least half a dozen or so way of setting configurations:
- You can set values manually.
- You can read from an object.
- You can read from a JSON file.
- You can read from an environment variable.
- You can read from a string to a module.
- Not to mention all of the other extensions that add support for yaml, and other methods.

And then, where do you place them?
- You can use instance folders.
- You can not use instance folders.
- You can use some path defined in an environment variable.
- You can dump them with the app.

This makes it very difficult to figure out what the _best_ way of setting up a project, because if you look through all of the different example starter projects on GitHub, they're all laid out completely differently.

Then it comes to, how to structure your app?
- Do you use an app factory?
- Do you not use an app factory?

If you do use an app factory, and you want to use gunicorn:
- Do I create a simple gunicorn.py that creates an app from the factory and makes an app?
- Do I write a custom script with Click or Flask-Script that launches gunicorn?

Certainly, if you've deployed dozens of Flask apps already, and you have your own template project setup and figured out the way you want to do everything it's okay. But, for those new to Flask, or coming from other Frameworks it can be a bit daunting to have so many options, and not having anyone agree on what should be used.

Fix #1129


I think the import should not be flaskr since in tutorial the first test run gives no errors.

If the behaviour expected is to use `PREFERRED_URL_SCHEME` even in request context, it fixes #1129.

The latest [Milestones](https://github.com/mitsuhiko/flask/milestones) section is not that bad and it would really nice indication on what is left until the next version, or why is not there yet..

It's been more than a year since the last [release](https://github.com/mitsuhiko/flask/releases), but the project is far from inactive as we can see from the commits and issues.. 

There is a bug in detection of Flask.instance_path when run inside a virtualenv. I have experienced this issue on both python2.7 and python3.4. My machines are debian wheezy and debian jessie.
This issue is not present when run from system Python. I have described below the simplest code to reproduce the error. 
I am willing to submit a patch provided this issue is real, and not something wrong on my end.

Some sample code to reproduce the error:
Directory tree:

```
|-- app.py
|-- run.py
|-- views.py
```

**Contents of files**

```
#app.py
from flask import Flask
app = Flask(__name__)
import views

#run.py
from app import app
app.run()

#views.py
from app import app
@app.route('/')
def index():
    return app.instance_path
```

**Virtualenv python**

```
python run.py
--
curl http://127.0.0.1:5000
/home/saimadhav/development/demo/var/app-instance
```

**System python**

```
python3.4 run.py
--
curl http://127.0.0.1:5000
/home/saimadhav/development/demo/instance
```

EDIT1: The above 3 files in my instance are placed in a folder demo

Addressed issue #1134

Addressed issue #1134.

sad


Just what the title says. See #1116 for a longer discussion on the issue.

This decorator seems not supported anymore in 0.10
http://flask.pocoo.org/snippets/18/

How can we double decorate a function using a custom view?
In the case we don't want to define different endpoints, like this:

```
@view(app, '/<name>', render_html('page.html'))
@view(app, '/api/page/<name>', render_json)
def show_page(name):
    ...
```

Fix redirects and broken links

```
app.wsgi_app = DispatcherMiddleware(app.wsgi_app, {'/api': api}) # before this, I have a blueprint named web in app.
```

now, I have a endpoint named `validate_user` in api app, and how can i invoke this endpoint in blueprint web ?

Thanks

Okay, so I got an application running on `127.0.0.1:62781`.

I'm redirecting all traffic to this port, via htaccess.

Everything works quite well. Except for the automatic route redirect that kicks in if you have specified routes like these:

```
@app.route('/users/', defaults={'page': 1})
@app.route('/users/page/<int:page>')
def show_users(page):
    pass
```

Of course, I'm mostly using url_for, so it's not a huge problem, but if a user visits <domain>/users/page/1, he should get redirected to <domain>/users, but instead flask wants to send him to 127.0.0.1:62781/users.

How can I prevent that from happening?

I tried it with gunicorn and the "standard" run.py that looks like this:

```
import lesetagebuch.main as main
main.app.run(
    host='0.0.0.0',
    port=62781
)
```

To reproduce:

1) set a PREFERRED_URL_SCHEME in the app config != http
2) Use a url_for with _external=True
3) Note that the URL does not use the PREFERRED_URL_SCHEME

Notes: I'm using blueprints and Flask version 0.10.1

on http://flask.pocoo.org/docs/templating/
the "Jinja2 Template Documentation" link at the top of the page gives a 404 error. 
update link to http://jinja.pocoo.org/docs/templates/#

Convention is (and rightly so) that the master branch is stable. There have been several issues lately that are related to the accidental use of the development version.

Also the docs [here](http://flask.readthedocs.org/) track the development version so you can hardly blame someone for getting stuck trying to follow them when they have loads of stuff that doesn't apply to the current stable version.

Can we make an effort to sort this out?

If I do following:

``` python
app = Flaks(__name__, static_folder='/var/www/static')
```

all works just fine, but if I do

``` python
class Config(object):
    FLASK_STATIC_FOLDER = '/var/www/static'

app = Flask(__name__)
app.config.from_object(Config)
```

`current_app.send_static_file` can't find static file.  Is it any difference between those two settings?

Can someone from the team write in https://github.com/mitsuhiko/flask/wiki/Large-app-how-to#other-good-practices?

I am playing with the latest release of flask with <code>cli</code> module. I have created a command called <code>initdb</code> and when I call <code>flask initdb</code> it works as expected, but when I just call <code>flask</code> command it supposed to show the list of all available commands including <code>initdb</code>, which is not the case. Any idea why?

CLI docs could use some improvements by providing some example commands, using the `flask.cli.pass_script_info` decorator.

Three letter change, but gotta keep that grammar sharp. :)

On home page, "uses Jinja2 templating" points to a 404. I believe it should be "http://jinja.pocoo.org/docs/templates/"


`Config.from_object` don't accept python dictionary, I think it would be better if
explained as something like `config.update(json.load(open('filename')))`

In current design, methods decorated with `app.context_processor` is expected to return a dictionary. What was the reason behind this design? Can't we have decorator like `app.context_processor('name')` on method itself so that we can decorate method directly.


Corrected two errors on HTML syntax errors

I'm using Flask with Gunicorn using the "gevent" worker. The request completes, the client receives the response, and Gunicorn spits out "Error handling request", and then waits for a new request.

This is the stacktrace:

```
    2014-07-12 18:01:53 [38427] [INFO] Booting worker with pid: 38427
    2014-07-12 18:01:55 [38427] [DEBUG] POST /job/dev/job1
    2014-07-12 18:01:55 [38427] [ERROR] Error handling request
    Traceback (most recent call last):
      File "/Users/dustin/development/python/mapreduce/lib/python2.7/site-packages/gunicorn/workers/async.py", line 116, in handle_request
        raise StopIteration()
    StopIteration
```

(I should note that this is coming out of the "async" worker module, and not the intended "gevent" one).

This is the relevant portion of that module:

```
        except Exception:
            if resp and resp.headers_sent:
                # If the requests have already been sent, we should close the
                # connection to indicate the error.
                self.log.exception("Error handling request")
                try:
                    sock.shutdown(socket.SHUT_RDWR)
                    sock.close()
                except socket.error:
                    pass
                raise StopIteration()
            raise
        finally:
```

I'm a long-time user of Gunicorn, but haven't used Flask very often. I'm guessing that Flask is doing something to have the headers sent back early.

In https://github.com/mitsuhiko/flask/blob/master/flask/helpers.py#L401:

``` python
_request_ctx_stack.top.flashes = flashes = session.pop('_flashes') \
      if '_flashes' in session else []
```

This check for the key existence, and then a pop causes a race condition in my system because it is possible for the `_flashes` key to disappear between the check and the pop, leading to a `KeyError`. (I saw it happen under load.)

The fix is easy: use the "default" argument to the `pop`. That path is implemented in an atomic manner in my session code already.

I'm writing a website using Flask (I love it) in which I use a lot of decimals. This however, presents me with a problem when wanting to jsonify dicts or lists containing Decimals (which happens a lot in my website).

In [this stackoverflow answer](http://stackoverflow.com/a/16957370/1650012) there is a suggestion to overcome this with the basic json.dumps() method:

```
def decimal_default(obj):
    if isinstance(obj, decimal.Decimal):
        return float(obj)
    raise TypeError

json.dumps({'x': decimal.Decimal('5.5')}, default=decimal_default)
```

I wouldn't  know how to use this way of doing it with the flask builtin jsonify though. Does anybody know how I can make jsonify also convert Decimals correctly? All tips are welcome!

Fixes #1101

The current live version of these docs on http://flask.pocoo.org/ refers to the master branch, which is actively being used for development of both flask and flaskr, and so the latest stable release (0.10.1) doesn't work with the master branch of flaskr, even though that's what's linked here. So it's probably a good idea to include this alternative link for the majority of users.

Python 2.6 maintenance has been finished.




I have noticed a rather weird error when installing a package that has Flask in `install_requires`. Here is the partial output of `python setup.py install`

```
Searching for Flask
Best match: Flask RESTful-0.2.12
Downloading https://pypi.python.org/packages/source/F/Flask-RESTful/Flask-RESTful-0.2.12.tar.gz#md5=53049771f4ccb3f40194696bb683db77
Processing Flask-RESTful-0.2.12.tar.gz
Writing /tmp/easy_install-ljhjqn/Flask-RESTful-0.2.12/setup.cfg
Running Flask-RESTful-0.2.12/setup.py -q bdist_egg --dist-dir /tmp/easy_install-ljhjqn/Flask-RESTful-0.2.12/egg-dist-tmp-4d1snj
Flask-RESTful 0.2.12 is already the active version in easy-install.pth

Installed /home/ayrx/.virtualenvs/test/lib/python3.3/site-packages/Flask_RESTful-0.2.12-py3.3.egg
error: Could not find required distribution Flask
```

Here is the relevant bit of `setup.py`

```
    install_requires=[
        "Flask",
        "Flask-RESTful",
        "cryptography"
    ]
```

Changing "Flask" to "flask" seems to fix things. Not a breaking bug but seems weird nonetheless especially since the packaging [docs](http://flask.pocoo.org/docs/patterns/distribute/) seem to indicate that "Flask" works fine.


Links to Werkzeug and Jinja  on http://flask.pocoo.org/docs/ are wrong.
Linked to http://jinja.pocoo.org/2/documentation/ and http://werkzeug.pocoo.org/documentation/ instead of http://werkzeug.pocoo.org/docs/ and http://jinja.pocoo.org/docs/ 


In order to run a Flask application during development we have the `.run()` method or with 1.0 `flask run`. While both are convenient they are a bad idea.

First of all their naming implies that, they are used for running a Flask application, they aren't. They are for running a Flask application during development, a subtle but important difference that causes significant confusion. Apart from that though, running a Flask application is never what you want.

Instead you want to _develop_, _test_ or _deploy_ an application. While development and testing can imply running a web server, running a web server during development means something different than running a web server during testing. In deployment you don't actually want to run your application at all, you should let a web server do that.

So far we kind of allow people to signal their intent with DEBUG and TESTING, but this needs to be explicitly configured by every user and issues such as #1049, show that this is not without issues.

Therefore what I would like to propose is to create three commands `develop`, `test` and `deploy`. These commands should be extendable through extensions and users. It should be easily possible to use different configurations for these scenarios.  Extensions that are only helpful during development like Flask-Debugtoolbar could activate/deactivate themselves based on intent, Flask-Migrate could perform migrations during development and extensions dealing with assets could start background threads monitoring the file system for changes during development. It would further simply clear up a lot of confusion for newcomers.

Running flask with either of these commands should by default set `DEVELOPMENT` (for backwards compatibilty also DEBUG but let's remove that, the name is awful), `TESTING` or `DEPLOYMENT` respectively and issue a signal. Furthermore `develop` should run the development server as `run` does now. `test` and `deployment` shouldn't actually test or deploy the application as we don't want to enforce a specific test runner or deployment solution. Instead the user should be implement these, if so desired. Nevertheless they would be useful as they establish convention extensions can rely on.

I realize that such a change is probably somewhat controversial (which is why this is not a pull request), it would also distinguish us significantly from Django, which works like Flask does now. Nevertheless I think it would be a great idea and I'm curious what others think of this idea. So, thoughts?

I've been using Flask with Python 3 from since it was supported. Back then there were definitely some issues with certain libraries that were only compatible on the git repo and not on pypi. But I'm currently running quite a complex website using Python 3 and Flask and haven't had any real problems in like half a year. 

I think Python 3 has become mature, especially with Python 3.4, and the general opinion is that new projects should be using Python 3. The current docs quite strongly suggest otherwise. 
I would be happy to rewrite them, but before I do I would like to know if you guys agree.

With the inclusion of the app.run we now are able to execute the program, it would be great if we'd have even more detailed docs available for the examples

The error is that sqlite3 needs escaping on the database column 'text' in the line:
text text not null
so that it becomes:
'text' text not null

The example on mitsuhiko/flask is correct and helped me detecting the mistake.

http://flask.pocoo.org/community/badges/

Flask Badge Images are not working.Needs to be fixed

![issue](https://cloud.githubusercontent.com/assets/6115991/3432688/6d7aed72-0077-11e4-9841-cfa5ce894baa.PNG)

"require" -> "requires"

"Teared" should be "torn", I think?

It seems that .jsonify round up big numbers like 2114380775380674674 to 2114380775380674600 etc. Is it bug or some undocumented feature?

We recently stumbled across an issue with the @after_this_request decorator deferred callback pattern (described at http://flask.pocoo.org/docs/patterns/deferredcallbacks/).

This issue does not occur in v0.9, but does occur in v0.10 and v0.10.1. The issue also does not occur when using the @after_this_request decorator defined in 'flask/ctx.py'.

If an exception occurs in a function decorated with @teardown_request, any callback added with the @after_this_request decorator copied from the pattern will continue to be executed on subsequent requests. This occurs when running standalone:

  $ python flask_teardown_exception.py

and when running under uwsgi:

  $ uwsgi --yaml uwsgi.yaml (Be sure to correct paths if you want to use this)

We realize that @teardown_request documentation indicates that one should be careful never to throw an exception, but the end result was still very surprising.

A minimal testcase can be found in the github repo referenced at the bottom. It defines two functions to be executed after the current request. One using the built-in decorator, and one using the pattern and code sample. Both functions add a header to the response indicating the handling processID and an incrementing request ID. An exception can be triggered in the @teardown_request function by passing any value to the "e" GET parameter. After an exception is triggered, the built-in @after_this_request continues to work as expected an all subsequent requests that do not throw an exception. However, the functions added with the custom @after_this_request decorator following the pattern code sample continue to execute for all subsequent requests. For example, if I trigger an exception on request 6, and make 4 more requests, then the second to last request (request 9) will have the headers for request 6 ,7, 8 and 9; and the last request (request 10) will have the headers for request 6, 7, 8, 9 and 10.

The github repo also includes console output running under both uwsgi and standalone, and HTTP request/response pairs for 10 requests showing the outcome.

https://github.com/aegarbutt/teardown_request_exception

I recently had some trouble with trying to add dynamic parameters (at runtime) using url_for, because it requires specific method parameters. This is especially useful if you want to set additional HTTP GET parameters easily.

I decided to go for a dict-based approach, where the _runtime parameter for the url_for method would inject a few extra url_for parameters at runtime.
### Included
- Changes to url_for to add this functionality
- Testcase for this functionality
### Usecase

I needed a way to generate URLs to endpoints with additional GET parameters based on the current page's GET parameters. More specifically, for paginated search results (where the search query is a GET parameter).

With this change, you can use the following:

``` python
url_for('search', page=page, _runtime=request.args.to_dict())
```

instead of having to resort to ugly hacks or extra libraries to append the runtime parameters to the generated URL.

There is an issue when importing something inside an extension using Python 3 where Flask imports the classes in such a way that they are no longer equal to the same classes imported inside the extension. The issue occurs when importing from a submodule of an extension using `from flask.ext.xxx.yyy import zzz`. 

The classes imported using from-import get masked as `<class 'flask.ext.xxx.yyy.zzz'>`, where `<class 'flask_xxx.yyy.zzz'>` would be expected.

The issue is specific to Python 3.

Example:

```
Python 3.4.0 (default, Apr  9 2014, 11:51:10) 
[GCC 4.2.1 Compatible Apple LLVM 5.1 (clang-503.0.38)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> from flask.ext.restful.fields import String
>>> from flask_restful.fields import String as String_internal
>>> String == String_internal
False
>>> String
<class 'flask.ext.restful.fields.String'>
>>> String_internal
<class 'flask_restful.fields.String'>
>>> import flask.ext.restful
>>> import flask_restful
>>> flask.ext.restful.fields.String == flask_restful.fields.String
True
>>> flask.ext.restful.fields.String
<class 'flask_restful.fields.String'>
>>> flask_restful.fields.String
<class 'flask_restful.fields.String'>
```

Based on blueprint concept, I expected it to handle relative `url_for` nicely:

```
from flask import Blueprint, Flask, url_for

bp = Blueprint('foo', __name__)

@bp.route('/')
def func():
    return url_for('.func')

app = Flask(__name__)
app.register_blueprint(bp, url_prefix='/foo')
app.register_blueprint(bp, url_prefix='/bar')

client = app.test_client()
print client.get('/foo/').data
print client.get('/bar/').data
```

Both prints write the URL to the first blueprint registered (`/foo/`). Is it possible to mount two times the same blueprint and make relative `url_for` work? Is this behaviour expected?

Changes deprecated pkg_add to pkg install, adds documentation for yum

Updates the outdated "pkg_add" on FreeBSD, adds yum install command

Add descriptions about how leave from the virtual environment.

There are two links to the Jinja2 project website. Both should link to http://jinja.pocoo.org/docs/ instead of http://jinja.pocoo.org/2/ 

(All the links to the Jinja2 website that I see in the docs on github are correct.)

Dropped one extra whitespace.


How do I test this line? 
return render_template(u'http_error.html', error_detail=detail)

I am a beginner as far as flask testing is concerned. 

Could you document the answer to this on your testing page? http://flask.pocoo.org/docs/testing/

There is an unanswered question similar to this on stackoverflow.
http://stackoverflow.com/questions/23987564/test-flask-render-template-context

With [click](http://click.pocoo.org/) integrated in to Flask 1.0, the published documentation at [readthedocs](https://flask.readthedocs.org/en/latest/) is getting rather out of sync with 0.10 reality.

Specifically, today I could not link someone to the documentation on how to enable `debug=True` in their dev server, as the quickstart section on [Debug Mode](http://flask.readthedocs.org/en/latest/quickstart/#debug-mode) changed, and the 0.8 documentation is... outdated for 0.10 in places.

Can a 0.10 version of the docs be published too?

http://flask.pocoo.org/docs/errorhandling/

> By default if your application runs in production mode, Flask will display a very simple page for you and log the exception to the logger.

But https://github.com/mitsuhiko/flask/blob/master/flask/logging.py#L34

``` python
    class DebugHandler(StreamHandler):
        def emit(x, record):
            StreamHandler.emit(x, record) if app.debug else None
```

This means Flask just ignore all errors and not produce any logs.
We can't get exception message and traceback in production envirionment.

There is [mod_xsendfile](https://tn123.org/mod_xsendfile/beta/) which in it's current beta version supports `X-Sendfile-Temporary` which is like `X-Sendfile` but removes the file afterwards.

Is there some chance of supporting this? If not (because it's beta and not supported by other servers yet), what would be the recommended way to implement this myself? Of course I can just send the header, but I'm not sure if that's enough, judging by the length of `send_file()`.

`itms-services://?action=download-manifest&url=http://tietie-static.qiniudn.com/downloads/TieTie_iOS.plist` becomes
`itms-services:?action=download-manifest&url=http://tietie-static.qiniudn.com/downloads/TieTie_iOS.plist` when using redirect(url_here)

`get_wsgi_headers` will be called in `after_request` callback, so nothing works even I make redirect response by hand...
set autocorrect_location_header to False also not work

This makes Flask discard less object graphs with reference cycles.

the flaskr.py has a issue when i run ，the error is follow:
AttributeError: 'Flask' object has no attribute 'cli'

note configuration changes in apache 2.4

Steps to reproduce:
Write a trivial flask app, include a call to pdb.set_trace() in the request path, then request this url (browser, curl, ...). You're now in a pdb session. But at the same time flask's reloader is watching imported modules of your app for changes. Make a change in one of these modules (mod.py) and save the file. The reloader will restart your application, and abort your pdb session. Now you can stop the application with Ctrl+C. Result: your terminal no longer echos input.

Isolated test case:
https://gist.github.com/numerodix/c13ce7c1c0917b3b7dd9

This small change addresses #1074.

Under [SQL Abstraction Layer](flask.pocoo.org/docs/patterns/sqlalchemy/#sql-abstraction-layer) in the docs it says 

> If you just want to use the database system (and SQL) abstraction layer you basically only need the engine:

```
from sqlalchemy import create_engine, MetaData
```

But a few lines down is given the example

```
users = Table('users', metadata, autoload=True)
```

For this, `Table` also needs to be imported.

I have the following simple "Hello World" app:

```
from gevent import monkey
monkey.patch_all()
from flask import Flask
from gevent import wsgi

app = Flask(__name__)

@app.route('/')
def index():
  return 'Hello World'

server = wsgi.WSGIServer(('127.0.0.1', 5000), app)
server.serve_forever()
```

As you can see it's pretty straightforward.

The problem is that despite such simpliness it's pretty slow/inefficient as the following benchmark (made with Apache Benchmark) shows:

```
ab -k -n 1000 -c 100 http://127.0.0.1:5000/

Benchmarking 127.0.0.1 (be patient)
Completed 100 requests
Completed 200 requests
Completed 300 requests
Completed 400 requests
Completed 500 requests
Completed 600 requests
Completed 700 requests
Completed 800 requests
Completed 900 requests
Completed 1000 requests
Finished 1000 requests


Server Software:        
Server Hostname:        127.0.0.1
Server Port:            5000

Document Path:          /
Document Length:        11 bytes

Concurrency Level:      100
Time taken for tests:   1.515 seconds
Complete requests:      1000
Failed requests:        0
Write errors:           0
Keep-Alive requests:    0
Total transferred:      146000 bytes
HTML transferred:       11000 bytes
Requests per second:    660.22 [#/sec] (mean)
Time per request:       151.465 [ms] (mean)
Time per request:       1.515 [ms] (mean, across all concurrent requests)
Transfer rate:          94.13 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.6      0       3
Processing:     1  145  33.5    149     191
Waiting:        1  144  33.5    148     191
Total:          4  145  33.0    149     191

Percentage of the requests served within a certain time (ms)
  50%    149
  66%    157
  75%    165
  80%    173
  90%    183
  95%    185
  98%    187
  99%    188
 100%    191 (longest request)
```

Eventually increasing the number of connections and/or concurrency doesn't bring better results, in fact it becomes worse.

What I'm most concerned about is the fact that I can't go over 700 **Requests per second** and a **Transfer rate** of 98 Kbytes/sec.

Also, the individual **Time per request** seems to be too much.

I got curious about what Python and Gevent are doing in the background, or better, what the OS is doing, so I used a **strace** to determine eventual system-side issues and here's the result:

```
% time     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
 56.46    0.000284           0      1386           close
 24.25    0.000122           0      1016           write
 10.74    0.000054           0      1000           send
  4.17    0.000021           0      3652      3271 open
  2.19    0.000011           0       641           read
  2.19    0.000011           0      6006           fcntl64
  0.00    0.000000           0         1           waitpid
  0.00    0.000000           0         1           execve
  0.00    0.000000           0         3           time
  0.00    0.000000           0        12        12 access
  0.00    0.000000           0        32           brk
  0.00    0.000000           0         5         1 ioctl
  0.00    0.000000           0      5006           gettimeofday
  0.00    0.000000           0         4         2 readlink
  0.00    0.000000           0       191           munmap
  0.00    0.000000           0         1         1 statfs
  0.00    0.000000           0         1         1 sigreturn
  0.00    0.000000           0         2           clone
  0.00    0.000000           0         2           uname
  0.00    0.000000           0        21           mprotect
  0.00    0.000000           0        69        65 _llseek
  0.00    0.000000           0        71           rt_sigaction
  0.00    0.000000           0         1           rt_sigprocmask
  0.00    0.000000           0         3           getcwd
  0.00    0.000000           0         1           getrlimit
  0.00    0.000000           0       243           mmap2
  0.00    0.000000           0      1838       748 stat64
  0.00    0.000000           0        74           lstat64
  0.00    0.000000           0       630           fstat64
  0.00    0.000000           0         1           getuid32
  0.00    0.000000           0         1           getgid32
  0.00    0.000000           0         1           geteuid32
  0.00    0.000000           0         1           getegid32
  0.00    0.000000           0         4           getdents64
  0.00    0.000000           0         3         1 futex
  0.00    0.000000           0         1           set_thread_area
  0.00    0.000000           0         2           epoll_ctl
  0.00    0.000000           0        12         1 epoll_wait
  0.00    0.000000           0         1           set_tid_address
  0.00    0.000000           0        26           clock_gettime
  0.00    0.000000           0         2           openat
  0.00    0.000000           0         1           set_robust_list
  0.00    0.000000           0         1           eventfd2
  0.00    0.000000           0         1           epoll_create1
  0.00    0.000000           0         1           pipe2
  0.00    0.000000           0         1           socket
  0.00    0.000000           0         1           bind
  0.00    0.000000           0         1           listen
  0.00    0.000000           0      1000           accept
  0.00    0.000000           0         1           getsockname
  0.00    0.000000           0      2000      1000 recv
  0.00    0.000000           0         1           setsockopt
------ ----------- ----------- --------- --------- ----------------
100.00    0.000503                 24977      5103 total
```

As you can see there are 5103 errors, the worst offender being the **open** **syscall** which I suspect has to do with files not being found (**ENOENT**). To my surprise **epoll** didn't look like a _troubler_, as I heard of many horror stories about it.

I wish to post the full **strace** which goes into the detail of every single call, but it is way too large.

A final note; I also set the following system parameters (which are the maximum allowed amount) hoping it would change the situation but it didn't:

```
echo “32768   61000″ > /proc/sys/net/ipv4/ip_local_port_range
sysctl -w fs.file-max=128000
sysctl -w net.ipv4.tcp_keepalive_time=300
sysctl -w net.core.somaxconn=61000
sysctl -w net.ipv4.tcp_max_syn_backlog=2500
sysctl -w net.core.netdev_max_backlog=2500
ulimit -n 1024
```

My question is, given that the sample I'm using can't be changed so much to fix these issues, where should I look to correct them?

For a comparison I made the following "Hello World" script with Wheezy.web & Gevent and I got ~2000 Requests per second:

```
from gevent import monkey
monkey.patch_all()
from gevent import pywsgi
from wheezy.http import HTTPResponse
from wheezy.http import WSGIApplication
from wheezy.routing import url
from wheezy.web.handlers import BaseHandler
from wheezy.web.middleware import bootstrap_defaults
from wheezy.web.middleware import path_routing_middleware_factory

def helloworld(request):
    response = HTTPResponse()
    response.write('hello world')
    return response


routes = [
    url('hello', helloworld, name='helloworld')
]


options = {}
main = WSGIApplication(
    middleware=[
        bootstrap_defaults(url_mapping=routes),
        path_routing_middleware_factory
    ],
    options=options
)


server = pywsgi.WSGIServer(('127.0.0.1', 5000), main, backlog=128000)
server.serve_forever()
```

And the benchmark results:

```
ab -k -n 1000 -c 1000 http://127.0.0.1:5000/hello

Benchmarking 127.0.0.1 (be patient)
Completed 100 requests
Completed 200 requests
Completed 300 requests
Completed 400 requests
Completed 500 requests
Completed 600 requests
Completed 700 requests
Completed 800 requests
Completed 900 requests
Completed 1000 requests
Finished 1000 requests


Server Software:        
Server Hostname:        127.0.0.1
Server Port:            5000

Document Path:          /front
Document Length:        11 bytes

Concurrency Level:      1000
Time taken for tests:   0.484 seconds
Complete requests:      1000
Failed requests:        0
Write errors:           0
Keep-Alive requests:    0
Total transferred:      170000 bytes
HTML transferred:       11000 bytes
Requests per second:    2067.15 [#/sec] (mean)
Time per request:       483.758 [ms] (mean)
Time per request:       0.484 [ms] (mean, across all concurrent requests)
Transfer rate:          343.18 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    8  10.9      0      28
Processing:     2   78  39.7     56     263
Waiting:        2   78  39.7     56     263
Total:         18   86  42.6     66     263

Percentage of the requests served within a certain time (ms)
  50%     66
  66%     83
  75%    129
  80%    131
  90%    152
  95%    160
  98%    178
  99%    182
 100%    263 (longest request)
```

I find Wheezy.web's speed great, but I'd still like to use Flask as it's far simpler and less time consuming to work with.

in the example code of doc page
http://flask.pocoo.org/docs/patterns/mongokit/

the formatted string expression in the exception has two %s placeholders but only one variable.
see excerpt following:
'''
Here is an example document (put this also into app.py, e.g.):

def max_length(length):
    def validate(value):
        if len(value) <= length:
            return True
        raise Exception('%s must be at most %s characters long' % length)
    return validate
'''

---

UnicodeDecodeError: 'ascii' codec can't decode byte 0xd6 in position 17: ordinal not in range(128)
File "c:\Users\honglei\AppData\Local\Enthought\Canopy\User\Lib\site-packages\waitress\task.py", line 74, in handler_thread
  task.service()
File "c:\Users\honglei\AppData\Local\Enthought\Canopy\User\Lib\site-packages\waitress\channel.py", line 337, in service
  task.service()
File "c:\Users\honglei\AppData\Local\Enthought\Canopy\User\Lib\site-packages\waitress\task.py", line 173, in service
  self.execute()
File "c:\Users\honglei\AppData\Local\Enthought\Canopy\User\Lib\site-packages\waitress\task.py", line 392, in execute
  app_iter = self.channel.server.application(env, start_response)
File "c:\Users\honglei\AppData\Local\Enthought\Canopy\User\Lib\site-packages\flask\app.py", line 1917, in **call**
  return self.wsgi_app(environ, start_response)
File "c:\Users\honglei\AppData\Local\Enthought\Canopy\User\Lib\site-packages\flask\app.py", line 1901, in wsgi_app
  response = self.make_response(self.handle_exception(e))
File "c:\Users\honglei\AppData\Local\Enthought\Canopy\User\Lib\site-packages\flask\app.py", line 1483, in handle_exception
  self.log_exception((exc_type, exc_value, tb))
File "c:\Users\honglei\AppData\Local\Enthought\Canopy\User\Lib\site-packages\flask\app.py", line 1499, in log_exception
  ), exc_info=exc_info)
File "c:\Users\honglei\AppData\Local\Enthought\Canopy\User\Lib\site-packages\flask\app.py", line 1898, in wsgi_app
  response = self.full_dispatch_request()
File "c:\Users\honglei\AppData\Local\Enthought\Canopy\User\Lib\site-packages\flask\app.py", line 1553, in full_dispatch_request
  rv = self.handle_user_exception(e)
File "c:\Users\honglei\AppData\Local\Enthought\Canopy\User\Lib\site-packages\flask\app.py", line 1457, in handle_user_exception
  reraise(exc_type, exc_value, tb)
File "c:\Users\honglei\AppData\Local\Enthought\Canopy\User\Lib\site-packages\flask\app.py", line 1551, in full_dispatch_request
  rv = self.dispatch_request()
File "c:\Users\honglei\AppData\Local\Enthought\Canopy\User\Lib\site-packages\flask\app.py", line 1537, in dispatch_request
  return self.view_functions[rule.endpoint](**req.view_args)
File "c:\Users\honglei\AppData\Local\Enthought\Canopy\User\Lib\site-packages\flask\helpers.py", line 872, in send_static_file
  cache_timeout=cache_timeout)
File "c:\Users\honglei\AppData\Local\Enthought\Canopy\User\Lib\site-packages\flask\helpers.py", line 617, in send_from_directory
  filename = safe_join(directory, filename)
File "c:\Users\honglei\AppData\Local\Enthought\Canopy\User\Lib\site-packages\flask\helpers.py", line 587, in safe_join
  return os.path.join(directory, filename)
File "C:\Users\honglei\AppData\Local\Enthought\Canopy\App\appdata\canopy-1.3.0.1715.win-x86_64\Lib\ntpath.py", line 108, in join
##   path += "\" + b

> > > directory
> > > 'F:\Flask\EmberJS\\xd6\xd0\xce\xc4\Prj\static'
> > > filename
> > > u'todomvc/index.html'
> > > safe_join(directory.decode(sys.getfilesystemencoding()),filename)
> > > u'F:\Flask\EmberJS\\u4e2d\u6587\Prj\static\todomvc/index.html'

fixed various stylistic issues in an effort to slightly improve readability

notes:
- most changes/decisions are subjective (i.e. these are merely recommendations)
- I couldn't come up with reasonable criteria to split this into separate commits (so feel free to revert changes after pulling, should you decide to do so)
- I intentionally did not rewrap lines to avoid diff noise
- best reviewed with `git diff --ignore-all-space --color-words`
- I'm not yet intimately familiar with Flask or RST, so please review carefully

Please let me know whether this is useful at all. If so, I might put some effort in reviewing a few more chapters. If not, that's alright too.

Hi
It's seem that these lines are unused and can be remve.

https://github.com/mitsuhiko/flask/blob/master/flask/app.py#L518

```
    if self._logger and self._logger.name == self.logger_name:
        return self._logger
```

Flask seems to choke on chunked encoded requests (I've only tried with Content-Type: application/json). This results in an error when parsing the request body (and being able to deal with chunked encoding is a requirement of HTTP 1.1).

The example seemed to be lacking a closing tag for the <li> element. Please review. Thanks.

Fix a small error in documentation

The API docs of Flask state that there are 4 builtin converters, `unicode`, `int`, `float` and `path`.  While the werkzeug docs state that the `unicode` converter's name is actually `string`. Either change werkzeug name of converter or correct the flask docs.

http://werkzeug.pocoo.org/docs/routing/#werkzeug.routing.UnicodeConverter
http://flask.pocoo.org/docs/api/#url-route-registrations

Although Flask-Bcrypt is already in the extension registry it has been recently updated to include proper documentation and I believe should be listed as an approved extension.

Thanks!

Given a reference script like https://gist.github.com/1472832

I was expecting the form input named "drint_type" to be a list of multiple values, but it always == the first checkbox selected value.  I assume this is a problem with the lower level dependencies but wasn't sure. 

https://github.com/mitsuhiko/flask/blob/master/flask/helpers.py#L423

Conditional responses (`Response.make_conditional()`) cause the iterator to be converted to a list (which stores the contents of the file in memory) and then `''.join()` is used on the list (!!) which stores the contents of the file in memory AGAIN so Flask can use `len()` to determine content length. So for a short time it uses twice the item size in memory until the list conversion function returns the string from `''.join()` and the original list is destroyed.

This isn't mentioned anywhere in the Flask docs, and can be avoided by calculating the file size and setting the `Content-Length` header using `os.path.getsize()` or `fp.seek()` and `fp.tell()` before `rv.make_conditional` is called.

Project is located here: https://github.com/maxcountryman/flask-seasurf

Includes tests.

Documentation is located here: http://packages.python.org/Flask-SeaSurf/

Current docs for pluggable view (`Flask.views.MethodView` and `Flask.views.View`) decorators are a big vague - although it is mentioned that one cannot use regular view decorators, it doesn't actually give a working example how to write that decorator.

I'm proposing to use a simple active user check instead of current incomplete `rate_limited` example...

Current docs for pluggable view (`Flask.views.MethodView` and `Flask.views.View`) decorators are a big vague - although it is mentioned that one cannot use regular view decorators, it doesn't actually give a working example how to write that decorator.

I'm proposing to use a simple active user check instead of current incomplete `rate_limited` example...

I was having trouble with flask_autoindex which I documented here:

https://github.com/sublee/flask-autoindex/issues/1

This was installed with:

virtualenv --no-site-packages env
source env/bin/activate
pip install flask_autoindex

Here's the traceback

Traceback (most recent call last):
File "/Users/davidthewatson/github/flongo/env/lib/python2.7/site-packages/flask/app.py", line 1518, in call
return self.wsgi_app(environ, start_response)
File "/Users/davidthewatson/github/flongo/env/lib/python2.7/site-packages/flask/app.py", line 1506, in wsgi_app
response = self.make_response(self.handle_exception(e))
File "/Users/davidthewatson/github/flongo/env/lib/python2.7/site-packages/flask/app.py", line 1504, in wsgi_app
response = self.full_dispatch_request()
File "/Users/davidthewatson/github/flongo/env/lib/python2.7/site-packages/flask/app.py", line 1264, in full_dispatch_request
rv = self.handle_user_exception(e)
File "/Users/davidthewatson/github/flongo/env/lib/python2.7/site-packages/flask/app.py", line 1262, in full_dispatch_request
rv = self.dispatch_request()
File "/Users/davidthewatson/github/flongo/env/lib/python2.7/site-packages/flask/app.py", line 1248, in dispatch_request
return self.view_functionsrule.endpoint
File "/Users/davidthewatson/github/flongo/flaskengine/views.py", line 31, in archive
idx = AutoIndex(app, browse_root=curdir)
File "/Users/davidthewatson/github/flongo/env/lib/python2.7/site-packages/flaskext/autoindex/init.py", line 203, in init
*_silk_options)
File "/Users/davidthewatson/github/flongo/env/lib/python2.7/site-packages/flaskext/autoindex/init.py", line 72, in init
self.silk = Silk(self.base, *_silk_options)
File "/Users/davidthewatson/github/flongo/env/lib/python2.7/site-packages/flaskext/silk/init.py", line 40, in init
self.silkicon = self.base.route(rule)(self.silkicon)
File "/Users/davidthewatson/github/flongo/env/lib/python2.7/site-packages/flask/app.py", line 923, in decorator
self.add_url_rule(rule, endpoint, f, **options)
File "/Users/davidthewatson/github/flongo/env/lib/python2.7/site-packages/flask/app.py", line 56, in wrapper_func
raise AssertionError('A setup function was called after the '
AssertionError: A setup function was called after the first request was handled. This usually indicates a bug in the application where a module was not imported and decorators or other functionality was called too late.
To fix this make sure to import all your view modules, database models and everything related at a central place before the application starts serving requests.

The relevant code is:

from flaskext.autoindex import AutoIndex

@app.route('/archive/', methods=['GET'])
def archive(path='./archive'):
idx = AutoIndex(app, browse_root=curdir)
return idx.render_autoindex(path)

However, this works fine when I pip uninstall flask and pip install -I flask==0.7.0. I'm not sure where the bug is, but I thought I'd mention it in case I did something wrong or it can be resolved such that the default pip installed version will work in virtualenv.

Thanks.

See https://gist.github.com/1402052 for build log, but just looking at flask/testsuite/basic.py line 722, it seems to me that you don't really expect using  'Werkzeug>=0.6.1' which is what you require in setup.py.

So, what's correct ... setup.py or the testsuite?

Thanks

Basically, sets up a small directory structure for most projects, gives you a gitignore file, index template, main application file.

Upon initially reading the url_for function documentation I assumed that if I provided an endpoint matched to a URL rule with substitution tokens without specifying substitution values, it would return the base rule.  Having debugged my problem and re-read the url_for documentation closely, I realized that you tried to express this, it just isn't very 'tard friendly.

On http://flask.pocoo.org/docs/views/#method-views-for-apis
At the end of the page in the very last code example you have:

```
def register_api(view, endpoint, url, pk='id', pk_type='int'):
    view_func = view.as_view(endpoint)
    app.add_url_rule(url, defaults={pk: None},
                     view_func=view_func, methods=['GET', 'POST'])
    app.add_url_rule('%s<%s:%s>' % (url, pk), view_func=view_func,
                     methods=['GET', 'PUT', 'DELETE'])

register_api(UserAPI, 'user_api', '/users/', pk='user_id')
```

The last `app.add_url_rule` has three substitutions in the string, but the tuple only has two items.

It should read:

```
    app.add_url_rule('%s<%s:%s>' % (url, pk_type, pk), view_func=view_func,
                     methods=['GET', 'PUT', 'DELETE'])
```

https://github.com/dqminh/flask-lettuce

Extension has docs, example usage and tests.

This makes it impossible to add data to session in said callbacks. For example, the following code does not work, because session is never stored:

``` python
@app.before_request
def before_request():
    u = session.get('user')
    g.user = u and db.User(u) or None

@app.after_request
def after_request(response):
    session['user'] = g.user and dict(g.user) or None
    return response
```

Not sure if this is already fixed in the latest release. Seems related to this discussion:

http://librelist.com/browser//flask/2011/6/29/psa-routing-redirect-behavior/

..but this was apparently fixed in 0.7.1. 

I am getting an endless redirect loop when doing the following:

``` python
@app.route('/loop', defaults={"a":"Hello", "b":"World"})
@app.route('/loop.<b>', defaults={"a":"Hello"})
@app.route('/loop/<a>', defaults={"b":"World"})
@app.route('/loop/<a>.<b>')
def endless_loop(a, b):
    return "%s %s" % (a, b)
```

(In case you are interested, in my application b is a file extension that specifies my API's output format)

This is what happens when you visit /loop:

127.0.0.1 - - [16/Nov/2011 17:16:35] "GET /loop HTTP/1.1" 301 -
127.0.0.1 - - [16/Nov/2011 17:16:35] "GET /loop.World HTTP/1.1" 301 -
127.0.0.1 - - [16/Nov/2011 17:16:35] "GET /loop HTTP/1.1" 301 -
127.0.0.1 - - [16/Nov/2011 17:16:35] "GET /loop.World HTTP/1.1" 301 -

A good workaround for my use case was to simply disable the redirection for defaults:

``` python
app.url_map.redirect_defaults = False
```

This is ok in my case since I am developing an API that does not need or want to be indexed by search engines, but for normal websites it would be suboptimal.

The smallest test case I could produce that triggers the bug is the following:

``` python
@app.route('/loop2', defaults={"a":"Hello", "b":"World"}) 
@app.route('/loop2/<a>', defaults={"b":"World"})
def endless_loop2(a, b):
    return "%s %s" % (a, b)
```

127.0.0.1 - - [16/Nov/2011 17:15:31] "GET /loop2 HTTP/1.1" 301 -
127.0.0.1 - - [16/Nov/2011 17:15:31] "GET /loop2/Hello HTTP/1.1" 301 -
127.0.0.1 - - [16/Nov/2011 17:15:31] "GET /loop2 HTTP/1.1" 301 -
127.0.0.1 - - [16/Nov/2011 17:15:31] "GET /loop2/Hello HTTP/1.1" 301 -

I am running the packaged version of flask from ubuntu oneiric:

python-flask 0.7.2-1
python-werkzeug 0.6.2-1

Hey guys, 

Just ran through the tutorial and came across a couple of typos in the docs that I'd thought I'd help correct.

Thanks!
Craig

The option `static_folder` for blueprints only works correctly when the blueprint has been registered with a `url_prefix`, otherwise the application's default static URL takes precedence.

There is nothing wrong in that behavior, but it is not documented. It would be nice to have that fact mentioned at http://flask.pocoo.org/docs/blueprints/#static-files and/or http://flask.pocoo.org/docs/api/#blueprint-objects

I added a testcase for redirect and session keeparound bug, but please note that currently, without the fix, it blows up the whole testsuite - all the tests executed after this test start failing.

Use case: 
Most of the time we could use a reverse proxy to handle, enforce and redirect ssl pages. But there are scenarios where one might be interested in securing only POST request in a form, not entire page. In order to do that, url_for() should be capable to generate 'https' URL's.
This change is requesting in conjunction with a change (to accept the force_secure field to build()) in Werkzeug.

Commit 51e4a58a fixes issue, commit e345a3af fixes a string formatting issue that came up while testing.

I write my first app. On start my app consumes about 14mb, then at work increases the memory consumption. Can increase up to 60 mb after 7 days of work. Why is this and how to fix it. My version flask and python and code of my app there http://pastebin.com/n69tbVfR

Added details on how to make Flask's debugger work with Aptana/Eclipse.

Pretty sure this is an error in the documentation.  Not aware that any `instance_root` exists.

This change allows you to write the following, while allowing `None` (or missing) configuration values.

```
app.run(app.config.get('APP_HOST'), app.config.get('APP_PORT'))
```

Just a little comment clarification

<pre>
Downloading/unpacking Flask (from -r requirements.txt (line 1))
  Running setup.py egg_info for package Flask
    Traceback (most recent call last):
      File "<string>", line 14, in <module>
      File "/home/denekurich/Projects/langoid.com/build/Flask/setup.py", line 62
        print "Audit requires PyFlakes installed in your system."""
                                                                ^
    SyntaxError: invalid syntax
    Complete output from command python setup.py egg_info:
    Traceback (most recent call last):

  File "<string>", line 14, in <module>

  File "/home/denekurich/Projects/langoid.com/build/Flask/setup.py", line 62

    print "Audit requires PyFlakes installed in your system."""

                                                            ^

SyntaxError: invalid syntax
</pre>

Following the example code in [Method Views for APIs](http://flask.pocoo.org/docs/views/#method-views-for-apis) results in:

```
TypeError: post() got an unexpected keyword argument 'user_id'
```

Either the `post()` method needs to take a `user_id` (probably doesn't make sense), or an HTTP POST needs its own url_rule.

Fixes a doc bug.

I found it a bit difficult to render separate html blocks for individual flash categories similar to bootstrap: http://twitter.github.com/bootstrap/#alerts.

This patch allows you to filter flash categories via a list.  So you can do something like:

```
{% with errors = get_flashed_messages(category_filter=["error"]) %}
{% if errors %}
<div class="alert-message block-message error">
  <a class="close" href="#">×</a>
  <ul>
  {%- for msg in errors %}
  <li>{{ msg }}</li>
  {% endfor -%}
  </ul>
</div>
{% endif %}
{% endwith %}
```

...

Cheers,
  Steven

Hallo. In meinem Fall konnte ich egal wie Chrome 14.x und Firefox 7.x nicht überzeugen ein favicon im ICO format anzuzeigen. Glücklicherweise geht es eh besser mit PNG (transparenz is echt schick und eben bessere unterstützung in diversen grafikprogrammen). wie versucht in englisch oben zu beschreiben.

Danke, Marius


Old code in wtforms.rst:
from wtforms import Form, BooleanField, TextField, validators

Edited One:
from wtforms import Form, BooleanField, TextField, PasswordField, validators

While there is template_filter() decorator for creating jinja2 custom filters, it's good idea to add template_test:

```
def template_test(self, name=None):
    def decorator(f):
        self.jinja_env.tests[name or f.__name__] = f
        return f
    return decorator
```

Hi, 

I've got a issue about static file.

When I put css file in /static/css/style.css in static directory and I described view function with `Variable Rules`.
Please see sample code on https://gist.github.com/1254213

`GET /static/css/style.css` request dispatch to view function and css file did not send to browser correctly.
I expected to `GET /static/css/style.css` should send css file to browser, not dispatch to view function.

Regards.


As written here, the prefered way to register error_handlers to an application is through the app.error_handler decorator but, when using factories, this method becames far from ideal for "big application"  patterns. 

Charles Leifer
http://charlesleifer.com/docs/flask-peewee/index.html
https://github.com/coleifer/flask-peewee


Right now a test client can preserve the context for a little longer, so can exceptions. However there is no information if there is a context "on hold" on the stack which leads to the problem that if you continue to trigger exception you build up items on the stack in debug mode for nothing. There should always only be one context on the stack preserved and if another request comes in it should be removed.

This might also make the test client cleaner.

See title ^^ :)

PS. I'm not a native English speaker, so there might be some issues with my fixes...

The code contains a typo, and additionaly it registers a blueprint-local preprocessor instead of a global one.

In my local machine, using flask 0.7.2, if I set **SERVER_NAME** to "127.0.0.1:5000", with all other options set to defaul, the flash method stops working in webkit based browsers. Firefox works normally. 

I didn't dig further into the problem, but someone said it was fixed in 0.8dev. 

 Nothing special - just a tiny typo encountered while browsing through the codebase.

"create_jinja_loader" should be "jinja_loader" in http://flask.pocoo.org/docs/api/#flask.Flask.create_global_jinja_loader

I moved Flask-MongoKit to GitHub and changed the extension entry.

Christoph

Hello,

I added 4 functions to the Flask class that make routing basic http request easier. Now you can write:

```
@app.get('/')
def get_index():
    pass

@app.post('/')
def post_index():
    pass

@app.put('/')
def put_index():
    pass

@app.delete('/')
def delete_index():
    pass
```

instead of having to write methods=['POST'] in _route_. This makes writing RESTful api a lot cleaner.

There are also tests for these methods in the _HTTPRoutingTestCase_ class in testsuite/basic.py.

https://github.com/dag/flask-zodb

I'm releasing soon, but if there's any blockers for approval I'd like to fix them before the first release. Please review.

Slavi Pantaleev
http://packages.python.org/Flask-Sijax/

Jonathan Zempel
http://packages.python.org/Flask-Exceptional/
http://github.com/jzempel/flask-exceptional

In Flask 0.7.2, I have a route defined as:

```
@app.route('/venues/<float:lat>/<float:lon>/<float:rad>/')
```

Trying to access that route at http://127.0.0.1/10/20/30 will produce a "404 Not Found" error. If you change the route to

```
@app.route('/venues/<lat>/<lon>/<rad>/')
```

or substitute `int` for `float` using the conversion notation, then the route works correctly.

... and docs.

Several people on IRC have failed to use this decorator correctly. The problem is they forget to pass the "next" value along in their POST of the login form. The situation could be improved with a note in the docs for view decorators.

The confusion typically is that they think they have a "next" value in request.args, because they do in the GET request to their login view, and then suddenly for no apparent reason it's not there - because it's a new request, the POST request of the login credentials. The solution is to add a hidden input with the value of the next URL:

``` html+jinja
<input type=hidden name=next value="{{ request.values.next }}">
```

and then use either `request.values` or `request.form` instead of `request.args` in the login view where the POST request is handled.

``` irc
17:05 <flipmoe> Is there something to pay attention to if you try to access request args using blueprints and an app factory? I get 'None' although there is a next parameter in the url. Thx
17:07 <donri> flipmoe: from where are you doing this?
17:07 <flipmoe> donri: from my login view
17:08 <donri> paste code paste.pocoo.org
17:13 <flipmoe> donri: http://paste.pocoo.org/show/470727/ 
17:14 <donri> and the code that redirects to login?
17:15 <DasIch> donri: line 32
17:15 <donri> nope
17:16 <flipmoe> donri: you mean the login_required decorator?
17:16 <donri> probably
17:16 <flipmoe> donri: ok
17:17 <flipmoe> donri: http://paste.pocoo.org/show/470731/ 
17:26 <donri> flipmoe: ah i see it
17:26 <donri> flipmoe: your redirect results in the GET which renders the template, where i assume you have a form that POST to login
17:26 <donri> flipmoe: but you're probably not passing along the 'next' from the GET
17:27 <donri> flipmoe: add an input hidden to the form and use request.values
17:28 <donri> remember that your login view handles two different forms of requests (get and post)
17:28 <donri> and validate_on_submit checks that the request method is POST
17:29 <flipmoe> donri: ok thx, do you have an example for that hidden input?
17:29 <donri> <input type=hidden name=next value="{{ request.values.next }}">
17:29 <donri> request.values is just a combined dict of the request.form and request.args
17:30 <flipmoe> donri: ok thank you!
17:30 <donri> then make sure to use request.values in the login view too
17:30 <flipmoe> donri: jep
17:31 <donri> may need to do something more to make the form valid against LoginForm with "next" in the form dict
17:32 <donri> (you could just pass it in form action=login?next=... but mitsuhiko seems to think that's bad for some reason i forgot)
17:33 <flipmoe> ok
```

hi
App.config is a class based on dict object. 
So we must use it as a dict later and all settings in it accessed same as a dict.

like: 
app.config['DEBUG']

But i think it will be good to it can be accessed such as a class. 

app.config.DEBUG

it can be down by some simple overrided methods. i write simple code for this:

class EDict(dict):

```
def __init__(self, **kwargs):
    for key, value in kwargs.iteritems():
        self.__setitem__(key, value)
    dict.__init__(self)

def __getattr__(self, attr):
    return super(EDict, self).__getitem__(attr)

def __setattr__(self, attr, value):
    self[attr] = value

def __delattr__(self, key):
    return super(EDict, self).__delitem__(key)
```

When the testsuite was added to setup, it tries to add the test apps as directories. This breaks the install on Windows because the copy command used by setuptools can't copy directories recursively in Windows.

The fix is to use the include_package_data setting rather than specifying data directories by name. If directories shouldn't be added they can be filtered using the exclude_package_data setting.

Right now PERMANENT_SESSION_TIMEOUT can only be a datetime.timedelta object which is annoying. Make it possible to set this to an integer.

`session_transaction()` currently does not load the session correctly, as `environ_overrides` is never used.

Fixed the typo as discussed in #pocoo.

Allow passing the endpoint to the route decorators on Flask's `application` and `blueprints`.

It should be possible to set the Cookie Path to something different from "/", default should be the application root path.

I'd like to use Flask over pure Werkzeug but I don't need templating. It's fine for Jinja2 to be required to be installed since Flask extensions might expect it, but would it be possible (and worth it) for Flask to take an option to tell it not to bother setting up a default Jinja environment for the app since I won't be using it?

I actually wanted to add only the comment to the configuration file, but then spotted some places where docs could be improved. If you don't agree with them, then just commit the comment change for conf file example ;)

Quite nothing, a little typo I detected while reading the docs.

Silly mistake in the docs of not closing the <p> tag. The commit fixes it.

I think it would be convenient if we could have a  flash_error and get_flashed_errors (I don't know if this is to be included in Jinja, or here) method, because its quite a pain to filter through the categories every time, especially when the messages and errors must be on different parts of the page.

If you guys do approve, I would like to be able to write the code for solving the issue, if you don't mind.

Trying to fix https://github.com/mitsuhiko/flask/issues/290. I did not know if you like exceptions or not, so, right now it will return None if the mimetype is incorrect, if you like, I can do an exception instead.

Hi Armin -

I am using your make_release.py script in Bulbs, and the script was breaking when I was trying to make a release today because the parse_date function was replacing the the "st" in August (this may be an issue for other months too):

def parse_date(string):
    string = string.replace('th ', ' ').replace('nd ', ' ') \
                   .replace('rd ', ' ').replace('st ', ' ')
    return datetime.strptime(string, '%B %d %Y')
- James

What is the license for the Flask website? I would like to re-use the code for Librelist archives, but Flask’s website branch has no LICENSE file.

2 spelling errors, one incorrect usage, and 1 awkward construction.

I have added decorators for before_request and after_request, please ignore the README changes, they were errors I had trouble reversing. If it doesn't apply cleanly, please tell me so I can fix it. 

Also, keep up the excellent work, I love flask.

Added comments. 

When the app runs in debug mode, exceptions in handling GET requests would be displayed on the page and logging output. But for POST requests, it only returns "400 Bad Request", without any traceback, making debugging difficult. If it's a bad idea to display the traceback in web page, at least it should be displayed in the logging output.

Earlier on this page of docs, we write "add a new file called runserver.py next to the inner yourapplication folder . . ."

This change makes the example consistent.

Hi Armin, I'm implementing a `send_static_file_versioned` view (which gets urls like `/vstatic/<versionstamp>/<path>`) and I would like it to just return `app.send_static_file(filename, cache_timeout=HUGE)` but that function does not currently accept the additional options that `flask.helpers.send_file` accepts. I believe this patch would accomplish what I'm looking for. Would it make sense to merge back into flask?

I have a before_request function which I'd like to be actually run before every request. It sets some variables on `g` based on things like headers that I would like a custom error handler to be able to access. If I e.g. abort(404) from one of my own views, I'm fine, but if a request comes in that werkzeug can determine has no matching route, it bypasses my before_request function and goes straight to the error handler, so `g` is missing info.

`flask.request.json` is documented twice in http://flask.pocoo.org/docs/api/#incoming-request-data

The two descriptions should be merged. Also they should say what happens when the request is not JSON. Is the .json attribute None?

We do not encourage people to create more than one database connection and to connect to databases in arbitrary extensions. The obvious exception are extensions whose sole purpose is to connect to databases. Dependency resolving is done by the developer. Eg:

``` #!python
app = Flask(__name__)
db = SQLAlchemy(app)
something = SomethingElse(app, db)
```

The problem comes with blueprints. If SomethingElse wants to define models it has to do that at a local scope where it has the reference to the db. Assuming it provides blueprints, how does the blueprint's views and other code get to the models? The sad truth is that if you make up blueprints on the fly the views in that blueprint don't know how to reference it.

Drives me crazy.

During the development of a HTTP proxy (which uses flask for the response view generation) I came into the issue of setting multiple header values.
The problem is that I get multiple Set-Cookies response from the upstream HTTP server, which I have to insert into flask's response. But currently it seems it's impossible due to the dictionary interface.
Any ideas?

It only happens when I try to enable debugging but this is the traceback I get

Traceback (most recent call last):
  File "niftysite.py", line 33, in <module>
    main()
  File "niftysite.py", line 30, in main
    app.run(host='0.0.0.0')
  File "/home/aglenn/.virtualenvs/niftysite/local/lib/python2.7/site-packages/flask/app.py", line 553, in run
    return run_simple(host, port, self, **options)
  File "/home/aglenn/.virtualenvs/niftysite/local/lib/python2.7/site-packages/werkzeug/serving.py", line 609, in run_simple
    run_with_reloader(inner, extra_files, reloader_interval)
  File "/home/aglenn/.virtualenvs/niftysite/local/lib/python2.7/site-packages/werkzeug/serving.py", line 528, in run_with_reloader
    reloader_loop(extra_files, interval)
  File "/home/aglenn/.virtualenvs/niftysite/local/lib/python2.7/site-packages/werkzeug/serving.py", line 436, in reloader_loop
    reloader(fnames, interval=interval)
  File "/home/aglenn/.virtualenvs/niftysite/local/lib/python2.7/site-packages/werkzeug/serving.py", line 464, in _reloader_inotify
    mask = reduce(lambda m, a: m | getattr(EventsCodes, a), mask, 0)
  File "/home/aglenn/.virtualenvs/niftysite/local/lib/python2.7/site-packages/werkzeug/serving.py", line 464, in <lambda>
    mask = reduce(lambda m, a: m | getattr(EventsCodes, a), mask, 0)
AttributeError: type object 'EventsCodes' has no attribute 'IN_DELETE_SELF'

Document the debug param for Flask.run, it is not part of **options given to run_simple.

I am not sure bool() is appropriate.


As discussed on the mailing list:
http://flask.pocoo.org/mailinglist/archive/2011/7/22/application-mount-point/#abdbeee9ca8eda65f0e17a0aeb4fab5f

Make it possible to run a Flask application from the command line with this:

```
$ python -mflask.server yourapplication
```

What would that do?  It would attempt to import yourapplication and then looks for an object called "app".  If it finds that it uses that, otherwise you would have to do (yourapplication:application) or something.  Then it runs that with the development server.

What would that solve?

First of all it would no longer require `if __name__ == '__main__'`, secondly it would solve the double importing problems we commonly see as well as the fact that modules work different to applications.  Lastly the application object would no longer have to be a Flask application object but just any WSGI application object.

Just spotted these.


copy and paste approach failed in the file upload tutorial
fixed it
hope you like it

cheers

The docs are kinda inconsistent between route() and add_url_rule. The former should be documented as a decorator version of the latter which is true since Flask 0.3 at least.

Also with 0.7 and 0.8 we have some attributes on view functions that can have meanings attached. These now have a separate headline in the API docs, but I guess it would make sense to tidy this up a bit.

Line 85. "yourapplicaiton" where it should be "yourapplication":

```
        an SQL query in debug mode.  If the import name is not properly set
        up, that debugging information is lost.  (For example it would only
        pick up SQL queries in `yourapplicaiton.app` and not
        `yourapplication.views.frontend`)
```

Also, line 108, "ocurrs" where it should be "occurs":

```
    #: The debug flag.  Set this to `True` to enable debugging of the
    #: application.  In debug mode the debugger will kick in when an unhandled
    #: exception ocurrs and the integrated server will automatically reload
    #: the application if changes in the code are detected.
```


Corrected decorators to remove duplicate teardown_request() and add after_request()




Adds an app_template_filter decorator to blueprint objects. Works exactly like the Flask.template_filter decorator.

I think there is a small error in the description of teardown_request.

In 0.7.1..

When I follow the example at the end of http://flask.pocoo.org/docs/patterns/urlprocessors/, I get...

```
TypeError: 'dict' object is not callable
```

In Blueprint's **init**(), I see:

```
    if url_defaults is None:
        url_defaults = {}
    self.url_defaults = url_defaults
```

which seems to overwrite the "def url_defaults(..)" below.

Everything seem to work as expected if I use something like this:

```
Blueprint.url_defaults_fix = Blueprint.url_defaults

bp = Blueprint(....)

@bp.url_defaults_fix
def abc(..):
    ....
```

Adds the ability to measure code coverage via unit tests.
update the `:param` definition for the `errorhandler()` decorator in `app.py`.
2º  assignment

- `from flaskr.flaskr import app` in flaskr/**init**.py
  causes an import error with Python 2
- The relative import now used works for py2 and py3

Ref: https://github.com/pallets/flask/issues/2058 

The issue was that the absolute import `from flaskr.flaskr import app` works in python 3 but not python 2. While there is probably a simple answer why, for now, this relative import works on both.

also, minor typo fix.

When handling exceptions, some post processing on requests are not being called, such as `after_request` and `request_finished`.
This can be quite a problem in production environments when things such as logging and consistant headers are required.

For example, let's take this simple application:

``` python
from flask import Flask, request

from mysite.business_logic import do_work
from mysite.logging import log_req_res

app = Flask(__name__)

@app.route('/')
def index():
    return do_work(request)


@app.errorhandler(500)
def error_handler(exception):
    # Render a nice error message here
    pass


@app.after_request
def add_response_headers(response):
    response.headers['P3P'] = 'CP="IDC DSP COR ADM DEVi TAIi PSA PSD IVAi IVDi CONi HIS OUR IND CNT"'


@app.after_request
def log_request_response(response)
    from flask import request

    log_req_res(request, response)
    return response
```

One day, a change is made within `mysite.business_logic:do_work` that causes it to raise an exception to some users. Because of the current way things are working, the req/res will not be logged as well as not be applied the P3P header.
Currently there is no way to intercept ALL requests and responses for these use cases.

A simple solution, proposd in this PR is to process exception responses similarly to successful responses. This could be a breaking change to some library consumers so I'm putting it up as an RFC.

[tests to come soon]

Hi!

One of my machines has Git configured to fsck objects on transfer. On the Flask repository, it errors with:
`error: object 0b404df8c030cdeaca7b373956c3a697efd32f78: zeroPaddedFilemode: contains zero-padded file modes`.
Without fsck, cloning works fine.

To reproduce:

```
$ git clone https://github.com/pallets/flask.git
Cloning into 'flask'...
remote: Counting objects: 12684, done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 12684 (delta 0), reused 0 (delta 0), pack-reused 12680
Receiving objects: 100% (12684/12684), 3.56 MiB | 4.44 MiB/s, done.
Resolving deltas: 100% (8794/8794), done.

$ rm -Rf flask/

$ git config --global transfer.fsckobjects true

$ cat ~/.gitconfig 
[transfer]
        fsckobjects = true

$ git clone https://github.com/pallets/flask.git
Cloning into 'flask'...
remote: Counting objects: 12684, done.
remote: Compressing objects: 100% (4/4), done.
error: object 0b404df8c030cdeaca7b373956c3a697efd32f78: zeroPaddedFilemode: contains zero-padded file modes
fatal: Error in object
fatal: index-pack failed

# git --version
git version 2.10.1
```

I'd be curious if you can reproduce it or if this is a bug in Git or something.

- work right

`return redirect('{0}/{1}'.format('http://www.newweb.com/', page_name), code=301)`
- work loop

`return redirect('{0}/{1}'.format(app.config.get('NEW_SERVER_NAME'), page_name), code=301)`
- all my code

``` python
app = Flask(__name__)
app.config.update(NEW_SERVER_NAME='www.newweb.net')


@app.route('/<path:page_name>/')
@app.route('/')
def index(page_name=''):
    print '''
    UserAgent: {}
    Method   : {}
    GetArgs  : {}
    PostArgs : {}
    '''.format(
        request.headers.get('User-Agent'),
        request.method,
        request.args,
        request.form,
    )
    return redirect('{0}/{1}'.format(app.config.get('NEW_SERVER_NAME'), page_name), code=301)

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=9000, debug=app.debug)
```

> 127.0.0.1 - - [26/Oct/2016 17:20:03] "GET /www.newweb.net/www.newweb.net/www.new
> web.net/www.newweb.net/www.newweb.net/www.newweb.net/www.newweb.net/www.newweb.n
> et/www.newweb.net/www.newweb.net/asdasdas/asdasdasda HTTP/1.1" 301 -
> 
> i dont know why redirect with loop and before redirect code not running,please help, thank you very much~


I'm trying to auto generate API help using this piece of code:

```
@app.route('/api/help', methods=['GET'])
def api_help():
    """Returns all registered APIs available in this application."""
    func_list = {}
    for rule in app.url_map.iter_rules():
        if rule.endpoint != 'static':
            func_list[rule.rule] = app.view_functions[rule.endpoint].__doc__
    return jsonify(func_list)
```

It relies on `__doc__` of a function and works fine for APIs defined with a `route` decorator:

`@app.route('/someapi'...`

However, when a route is registered with `add_resource` the docstring is lost.

The help api returns data in this format:

```
{
  "/api/help": "Returns all registered APIs available in this application.", 
  "someapi": null
}
```

tried on latest versions:

> Name: Werkzeug
> Version: 0.11.11
> 
> Name: Flask
> Version: 0.11.1
> 
> python --version
> Python 3.5.1 :: Anaconda 4.0.0 (64-bit)


the dispatch_request() does not have any parameters. 

this is for resolution of https://github.com/pallets/flask/issues/2033

Base directory test is not extended to windows as not sure if they pose a security risk or not or what can the resolution be. Currentl base directory tests raise NotFound exception

The issue tracker is a tool to address bugs.
Please use the #pocoo IRC channel on freenode or Stack Overflow for questions.

~/flask-master/examples/flaskr$ flask run
Usage: flask run [OPTIONS]

Error: The file/path provided (flaskr) does not appear to exist.  Please verify the path is correct.  If app is not on PYTHONPATH, ensure the extension is .py

As requested in issue #2029, I added a section to the contributing file in case anyone has problems with cloning or pushing the repo.
@untitaker 

Where it says,
If you are a Windows user, the following command is for you:
$ venv\scripts\activate

The word 'scripts' should be capitalised, as 'Scripts'.

The given pattern caused Celery to lose the current Context.

```
> ~/celery/app/task.py(424)__call__()
-> try:
(Pdb) p self.request
<Context: {}>
```

And with this new pattern:

```
(Pdb) p self.request
<Context: {'called_directly': False, 'retries': 5, 'is_eager': True, 'loglevel': 0, 'delivery_info': {'is_eager': True}, 'args': (), 'callbacks': None, 'errbacks': None, 'kwargs': {}, 'logfile': None, 'id': '9fbd9fa0-1a42-4e70-9c52-558ad3bc9d72', 'headers': None}>
```

Note that I'm using Celery 3.1.24. The current pattern may be outdated (last change was 2013)

How to solve the problem of file descriptors, flask as main thread, when the main thread to exit the child thread inheritance file descriptor problem?

This PR is in reference to #2020 (cc @davidism). Basically, a CLI command was checked if it was a builtin, and if so, it executed it. I've changed this to now wait until it sees if the same command exists in the user-created commands.

Also, the test I added works both with and without the changes, so definitely let me know what I'm missing.


Currently, while following the dev docs or cloning the existing flaskr project on GitHub, it will not run in a Python 3 virtualenv. The error when running the cloned flaskr application is:

`Traceback (most recent call last):
  File "/home/todd/flaskr/flask/examples/flaskr/env/lib/python3.5/site-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "/home/todd/flaskr/flask/examples/flaskr/flaskr/__init__.py", line 1, in <module>
    from flaskr import app
ImportError: cannot import name 'app'`

This is the same error when following the docs to recreate the flaskr application. By modifying `flaskr/__init__.py` to include a relative import when using a Python 3 virtualenv, everything works fine.

That is, in `flaskr/__init__.py`, change:
`from flaskr import app`
to:
`from .flaskr import app`

(note the period)

At this point, I am still not comfortable contributing, nor do I know if this is the correct solution or if this has any implications for Python 2. Hence the issue, hoping someone else can confirm this is correct, or provide a better solution.

When running a script that performs several `requests.post` against flask's `app.py`, running in the background, various `ImportError`'s occur:

``` bash
Original exception was:
Traceback (most recent call last):
  File "app.py", line 32, in <module>
    app.run(host='0.0.0.0')
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 843, in run
    run_simple(host, port, self, **options)
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 694, in run_simple
    inner()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 659, in inner
    srv.serve_forever()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 499, in serve_forever
    HTTPServer.serve_forever(self)
  File "/usr/lib/python2.7/SocketServer.py", line 238, in serve_forever
    self._handle_request_noblock()
  File "/usr/lib/python2.7/SocketServer.py", line 297, in _handle_request_noblock
    self.handle_error(request, client_address)
  File "/usr/lib/python2.7/SocketServer.py", line 295, in _handle_request_noblock
    self.process_request(request, client_address)
  File "/usr/lib/python2.7/SocketServer.py", line 321, in process_request
    self.finish_request(request, client_address)
  File "/usr/lib/python2.7/SocketServer.py", line 334, in finish_request
    self.RequestHandlerClass(request, client_address, self)
  File "/usr/lib/python2.7/SocketServer.py", line 649, in __init__
    self.handle()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 216, in handle
    rv = BaseHTTPRequestHandler.handle(self)
  File "/usr/lib/python2.7/BaseHTTPServer.py", line 340, in handle
    self.handle_one_request()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 251, in handle_one_request
    return self.run_wsgi()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 193, in run_wsgi
    execute(self.server.app)
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 181, in execute
    application_iter = app(environ, start_response)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 2000, in __call__
    return self.wsgi_app(environ, start_response)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1991, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1746, in make_response
    rv = self.response_class.force_type(rv, request.environ)
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/wrappers.py", line 847, in force_type
    response = BaseResponse(*_run_wsgi_app(response, environ))
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/wrappers.py", line 56, in _run_wsgi_app
    from werkzeug.test import run_wsgi_app as _run_wsgi_app
ImportError: No module named test
```

**Note:** a more complete [traceback](https://github.com/jeff1evesque/machine-learning/pull/2763#issuecomment-251584807) can be reviewed.

My application has automatic pytest on the travis ci, which implements `live_server`, so the app context only lives for the duration of the unit tests.  This contraption was devised using a series of docker containers.  Long story short, I didn't have time to replicate this automated process for my vagrant development environment.  So, I created some unit tests, which predicates on the following assumptions:
- create self contain vagrant vm with [my application](https://github.com/jeff1evesque/machine-learning)
  - download virtualbox with virtualbox guest
  - download vagrant
  - clone repository
  - finally run `cd /path/to/clone/repository && vagrant up`
- app context needs to be created by manually running `(cd /vagrant && python app.py &)`

Then, the problems begin happening when I run a series of `requests.post` against the flask app.  I run such processes by triggering my manual pytests, which does a combination of `assert` against multiple `requests.post`.  So, in the same vagrant vm, I would run `(cd /vagrant/test && pytest manual)`.  This would run any python scripts prefixed with `pytest_*.py`, or `configure_.*.py`, in the [`manual/`](https://github.com/jeff1evesque/machine-learning/tree/master/test/manual) directory.

When I run my manual unit tests one pass through, the [tests succeed](https://github.com/jeff1evesque/machine-learning/pull/2763#issuecomment-251582653), and as intended:

``` bash
vagrant@vagrant-ubuntu-trusty-64:/vagrant/test$ pytest manual
========================================= test session starts ==========================================
platform linux2 -- Python 2.7.6, pytest-3.0.3, py-1.4.31, pluggy-0.4.0
rootdir: /vagrant/test/manual, inifile: pytest.ini
plugins: flask-0.10.0
collected 20 items

manual/configure_database.py .
manual/configure_redis.py .
manual/authentication/pytest_crypto.py .
manual/authentication/pytest_validate_password.py .
manual/programmatic_interface/dataset_url/pytest_svm_dataset_url.py ....
manual/programmatic_interface/dataset_url/pytest_svr_dataset_url.py ....
manual/programmatic_interface/file_upload/pytest_svm_file_upload.py ....
manual/programmatic_interface/file_upload/pytest_svr_file_upload.py ....

====================================== 20 passed in 51.27 seconds ======================================
```

However, if I run the same tests again, without restarting flask, it breaks:

``` bash
vagrant@vagrant-ubuntu-trusty-64:/vagrant/test$ pytest manual
========================================= test session starts ==========================================
platform linux2 -- Python 2.7.6, pytest-3.0.3, py-1.4.31, pluggy-0.4.0
rootdir: /vagrant/test/manual, inifile: pytest.ini
plugins: flask-0.10.0
collected 20 items

manual/configure_database.py .
manual/configure_redis.py .
manual/authentication/pytest_crypto.py .
manual/authentication/pytest_validate_password.py .
manual/programmatic_interface/dataset_url/pytest_svm_dataset_url.py ....
manual/programmatic_interface/dataset_url/pytest_svr_dataset_url.py ....
manual/programmatic_interface/file_upload/pytest_svm_file_upload.py ....
manual/programmatic_interface/file_upload/pytest_svr_file_upload.py [2016-10-05 01:11:23,116] ERROR in app: Exception on /load-data/ [POST]
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1988, in wsgi_app
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1641, in full_dispatch_request
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1544, in handle_user_exception
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1639, in full_dispatch_request
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1625, in dispatch_request
  File "/vagrant/interface/views.py", line 85, in load_data
  File "/vagrant/brain/load_data.py", line 78, in load_data_new
  File "/vagrant/brain/session/base_data.py", line 129, in save_premodel_dataset
  File "/vagrant/brain/session/data/save_dataset.py", line 34, in dataset
  File "/vagrant/brain/database/save_feature.py", line 86, in save_feature
  File "/vagrant/brain/database/db_query.py", line 98, in sql_connect
AttributeError: 'SQL' object has no attribute 'cursor'
Traceback (most recent call last):
  File "app.py", line 32, in <module>
    app.run(host='0.0.0.0')
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 843, in run
    run_simple(host, port, self, **options)
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 694, in run_simple
    inner()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 659, in inner
    srv.serve_forever()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 499, in serve_forever
    HTTPServer.serve_forever(self)
  File "/usr/lib/python2.7/SocketServer.py", line 238, in serve_forever
    self._handle_request_noblock()
  File "/usr/lib/python2.7/SocketServer.py", line 297, in _handle_request_noblock
    self.handle_error(request, client_address)
  File "/usr/lib/python2.7/SocketServer.py", line 295, in _handle_request_noblock
    self.process_request(request, client_address)
  File "/usr/lib/python2.7/SocketServer.py", line 321, in process_request
    self.finish_request(request, client_address)
  File "/usr/lib/python2.7/SocketServer.py", line 334, in finish_request
    self.RequestHandlerClass(request, client_address, self)
  File "/usr/lib/python2.7/SocketServer.py", line 649, in __init__
    self.handle()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 216, in handle
    rv = BaseHTTPRequestHandler.handle(self)
  File "/usr/lib/python2.7/BaseHTTPServer.py", line 340, in handle
    self.handle_one_request()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 251, in handle_one_request
    return self.run_wsgi()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 193, in run_wsgi
    execute(self.server.app)
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 181, in execute
    application_iter = app(environ, start_response)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 2000, in __call__
    return self.wsgi_app(environ, start_response)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1991, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1746, in make_response
    rv = self.response_class.force_type(rv, request.environ)
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/wrappers.py", line 847, in force_type
    response = BaseResponse(*_run_wsgi_app(response, environ))
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/wrappers.py", line 56, in _run_wsgi_app
    from werkzeug.test import run_wsgi_app as _run_wsgi_app
ImportError: No module named test
Error in sys.excepthook:
Traceback (most recent call last):
  File "/usr/lib/python2.7/dist-packages/apport_python_hook.py", line 63, in apport_excepthook
    from apport.fileutils import likely_packaged, get_recent_crashes
  File "/usr/lib/python2.7/dist-packages/apport/__init__.py", line 5, in <module>
    from apport.report import Report
ImportError: No module named report

Original exception was:
Traceback (most recent call last):
  File "app.py", line 32, in <module>
    app.run(host='0.0.0.0')
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 843, in run
    run_simple(host, port, self, **options)
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 694, in run_simple
    inner()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 659, in inner
    srv.serve_forever()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 499, in serve_forever
    HTTPServer.serve_forever(self)
  File "/usr/lib/python2.7/SocketServer.py", line 238, in serve_forever
    self._handle_request_noblock()
  File "/usr/lib/python2.7/SocketServer.py", line 297, in _handle_request_noblock
    self.handle_error(request, client_address)
  File "/usr/lib/python2.7/SocketServer.py", line 295, in _handle_request_noblock
    self.process_request(request, client_address)
  File "/usr/lib/python2.7/SocketServer.py", line 321, in process_request
    self.finish_request(request, client_address)
  File "/usr/lib/python2.7/SocketServer.py", line 334, in finish_request
    self.RequestHandlerClass(request, client_address, self)
  File "/usr/lib/python2.7/SocketServer.py", line 649, in __init__
    self.handle()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 216, in handle
    rv = BaseHTTPRequestHandler.handle(self)
  File "/usr/lib/python2.7/BaseHTTPServer.py", line 340, in handle
    self.handle_one_request()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 251, in handle_one_request
    return self.run_wsgi()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 193, in run_wsgi
    execute(self.server.app)
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 181, in execute
    application_iter = app(environ, start_response)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 2000, in __call__
    return self.wsgi_app(environ, start_response)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1991, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1746, in make_response
    rv = self.response_class.force_type(rv, request.environ)
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/wrappers.py", line 847, in force_type
    response = BaseResponse(*_run_wsgi_app(response, environ))
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/wrappers.py", line 56, in _run_wsgi_app
    from werkzeug.test import run_wsgi_app as _run_wsgi_app
ImportError: No module named test
FFFF

=============================================== FAILURES ===============================================
____________________________________________ test_data_new _____________________________________________

    def test_data_new():
        '''@test_data_new

        This method tests the 'data_new' session.

        '''

>       assert requests.post(
            endpoint_url,
            headers=headers,
            data=get_sample_json('svr-data-new.json', 'svr')
        )

manual/programmatic_interface/file_upload/pytest_svr_file_upload.py:71:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
/usr/lib/python2.7/dist-packages/requests/api.py:88: in post
    return request('post', url, data=data, **kwargs)
/usr/lib/python2.7/dist-packages/requests/api.py:44: in request
    return session.request(method=method, url=url, **kwargs)
/usr/lib/python2.7/dist-packages/requests/sessions.py:455: in request
    resp = self.send(prep, **send_kwargs)
/usr/lib/python2.7/dist-packages/requests/sessions.py:558: in send
    r = adapter.send(request, **kwargs)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <requests.adapters.HTTPAdapter object at 0x7fe471358810>, request = <PreparedRequest [POST]>
stream = False, timeout = <urllib3.util.Timeout object at 0x7fe4706dc0d0>, verify = True, cert = None
proxies = OrderedDict()

    def send(self, request, stream=False, timeout=None, verify=True, cert=None, proxies=None):
        """Sends PreparedRequest object. Returns Response object.

            :param request: The :class:`PreparedRequest <PreparedRequest>` being sent.
            :param stream: (optional) Whether to stream the request content.
            :param timeout: (optional) The timeout on the request.
            :param verify: (optional) Whether to verify SSL certificates.
            :param cert: (optional) Any user-provided SSL certificate to be trusted.
            :param proxies: (optional) The proxies dictionary to apply to the request.
            """

        conn = self.get_connection(request.url, proxies)

        self.cert_verify(conn, request.url, verify, cert)
        url = self.request_url(request, proxies)
        self.add_headers(request)

        chunked = not (request.body is None or 'Content-Length' in request.headers)

        if stream:
            timeout = TimeoutSauce(connect=timeout)
        else:
            timeout = TimeoutSauce(connect=timeout, read=timeout)

        try:
            if not chunked:
                resp = conn.urlopen(
                    method=request.method,
                    url=url,
                    body=request.body,
                    headers=request.headers,
                    redirect=False,
                    assert_same_host=False,
                    preload_content=False,
                    decode_content=False,
                    retries=self.max_retries,
                    timeout=timeout
                )

            # Send the request.
            else:
                if hasattr(conn, 'proxy_pool'):
                    conn = conn.proxy_pool

                low_conn = conn._get_conn(timeout=timeout)

                try:
                    low_conn.putrequest(request.method,
                                        url,
                                        skip_accept_encoding=True)

                    for header, value in request.headers.items():
                        low_conn.putheader(header, value)

                    low_conn.endheaders()

                    for i in request.body:
                        low_conn.send(hex(len(i))[2:].encode('utf-8'))
                        low_conn.send(b'\r\n')
                        low_conn.send(i)
                        low_conn.send(b'\r\n')
                    low_conn.send(b'0\r\n\r\n')

                    r = low_conn.getresponse()
                    resp = HTTPResponse.from_httplib(
                        r,
                        pool=conn,
                        connection=low_conn,
                        preload_content=False,
                        decode_content=False
                    )
                except:
                    # If we hit any problems here, clean up the connection.
                    # Then, reraise so that we can handle the actual exception.
                    low_conn.close()
                    raise
                else:
                    # All is well, return the connection to the pool.
                    conn._put_conn(low_conn)

        except socket.error as sockerr:
            raise ConnectionError(sockerr)

        except MaxRetryError as e:
>           raise ConnectionError(e)
E           ConnectionError: HTTPConnectionPool(host='localhost', port=5000): Max retries exceeded with url: /load-data/ (Caused by <class 'httplib.BadStatusLine'>: '')

/usr/lib/python2.7/dist-packages/requests/adapters.py:378: ConnectionError
___________________________________________ test_data_append ___________________________________________

    def test_data_append():
        '''@test_data_append

        This method tests the 'data_append' session.

        '''

>       assert requests.post(
            endpoint_url,
            headers=headers,
            data=get_sample_json('svr-data-append.json', 'svr')
        )

manual/programmatic_interface/file_upload/pytest_svr_file_upload.py:85:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
/usr/lib/python2.7/dist-packages/requests/api.py:88: in post
    return request('post', url, data=data, **kwargs)
/usr/lib/python2.7/dist-packages/requests/api.py:44: in request
    return session.request(method=method, url=url, **kwargs)
/usr/lib/python2.7/dist-packages/requests/sessions.py:455: in request
    resp = self.send(prep, **send_kwargs)
/usr/lib/python2.7/dist-packages/requests/sessions.py:558: in send
    r = adapter.send(request, **kwargs)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <requests.adapters.HTTPAdapter object at 0x7fe4706fa5d0>, request = <PreparedRequest [POST]>
stream = False, timeout = <urllib3.util.Timeout object at 0x7fe4706fa8d0>, verify = True, cert = None
proxies = OrderedDict()

    def send(self, request, stream=False, timeout=None, verify=True, cert=None, proxies=None):
        """Sends PreparedRequest object. Returns Response object.

            :param request: The :class:`PreparedRequest <PreparedRequest>` being sent.
            :param stream: (optional) Whether to stream the request content.
            :param timeout: (optional) The timeout on the request.
            :param verify: (optional) Whether to verify SSL certificates.
            :param cert: (optional) Any user-provided SSL certificate to be trusted.
            :param proxies: (optional) The proxies dictionary to apply to the request.
            """

        conn = self.get_connection(request.url, proxies)

        self.cert_verify(conn, request.url, verify, cert)
        url = self.request_url(request, proxies)
        self.add_headers(request)

        chunked = not (request.body is None or 'Content-Length' in request.headers)

        if stream:
            timeout = TimeoutSauce(connect=timeout)
        else:
            timeout = TimeoutSauce(connect=timeout, read=timeout)

        try:
            if not chunked:
                resp = conn.urlopen(
                    method=request.method,
                    url=url,
                    body=request.body,
                    headers=request.headers,
                    redirect=False,
                    assert_same_host=False,
                    preload_content=False,
                    decode_content=False,
                    retries=self.max_retries,
                    timeout=timeout
                )

            # Send the request.
            else:
                if hasattr(conn, 'proxy_pool'):
                    conn = conn.proxy_pool

                low_conn = conn._get_conn(timeout=timeout)

                try:
                    low_conn.putrequest(request.method,
                                        url,
                                        skip_accept_encoding=True)

                    for header, value in request.headers.items():
                        low_conn.putheader(header, value)

                    low_conn.endheaders()

                    for i in request.body:
                        low_conn.send(hex(len(i))[2:].encode('utf-8'))
                        low_conn.send(b'\r\n')
                        low_conn.send(i)
                        low_conn.send(b'\r\n')
                    low_conn.send(b'0\r\n\r\n')

                    r = low_conn.getresponse()
                    resp = HTTPResponse.from_httplib(
                        r,
                        pool=conn,
                        connection=low_conn,
                        preload_content=False,
                        decode_content=False
                    )
                except:
                    # If we hit any problems here, clean up the connection.
                    # Then, reraise so that we can handle the actual exception.
                    low_conn.close()
                    raise
                else:
                    # All is well, return the connection to the pool.
                    conn._put_conn(low_conn)

        except socket.error as sockerr:
            raise ConnectionError(sockerr)

        except MaxRetryError as e:
>           raise ConnectionError(e)
E           ConnectionError: HTTPConnectionPool(host='localhost', port=5000): Max retries exceeded with url: /load-data/ (Caused by <class 'socket.error'>: [Errno 111] Connection refused)

/usr/lib/python2.7/dist-packages/requests/adapters.py:378: ConnectionError
_________________________________________ test_model_generate __________________________________________

    def test_model_generate():
        '''@test_model_generate

        This method tests the 'model_generate' session.

        '''

>       assert requests.post(
            endpoint_url,
            headers=headers,
            data=get_sample_json('svr-model-generate.json', 'svr')
        )

manual/programmatic_interface/file_upload/pytest_svr_file_upload.py:99:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
/usr/lib/python2.7/dist-packages/requests/api.py:88: in post
    return request('post', url, data=data, **kwargs)
/usr/lib/python2.7/dist-packages/requests/api.py:44: in request
    return session.request(method=method, url=url, **kwargs)
/usr/lib/python2.7/dist-packages/requests/sessions.py:455: in request
    resp = self.send(prep, **send_kwargs)
/usr/lib/python2.7/dist-packages/requests/sessions.py:558: in send
    r = adapter.send(request, **kwargs)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <requests.adapters.HTTPAdapter object at 0x7fe4706f1ed0>, request = <PreparedRequest [POST]>
stream = False, timeout = <urllib3.util.Timeout object at 0x7fe4706939d0>, verify = True, cert = None
proxies = OrderedDict()

    def send(self, request, stream=False, timeout=None, verify=True, cert=None, proxies=None):
        """Sends PreparedRequest object. Returns Response object.

            :param request: The :class:`PreparedRequest <PreparedRequest>` being sent.
            :param stream: (optional) Whether to stream the request content.
            :param timeout: (optional) The timeout on the request.
            :param verify: (optional) Whether to verify SSL certificates.
            :param cert: (optional) Any user-provided SSL certificate to be trusted.
            :param proxies: (optional) The proxies dictionary to apply to the request.
            """

        conn = self.get_connection(request.url, proxies)

        self.cert_verify(conn, request.url, verify, cert)
        url = self.request_url(request, proxies)
        self.add_headers(request)

        chunked = not (request.body is None or 'Content-Length' in request.headers)

        if stream:
            timeout = TimeoutSauce(connect=timeout)
        else:
            timeout = TimeoutSauce(connect=timeout, read=timeout)

        try:
            if not chunked:
                resp = conn.urlopen(
                    method=request.method,
                    url=url,
                    body=request.body,
                    headers=request.headers,
                    redirect=False,
                    assert_same_host=False,
                    preload_content=False,
                    decode_content=False,
                    retries=self.max_retries,
                    timeout=timeout
                )

            # Send the request.
            else:
                if hasattr(conn, 'proxy_pool'):
                    conn = conn.proxy_pool

                low_conn = conn._get_conn(timeout=timeout)

                try:
                    low_conn.putrequest(request.method,
                                        url,
                                        skip_accept_encoding=True)

                    for header, value in request.headers.items():
                        low_conn.putheader(header, value)

                    low_conn.endheaders()

                    for i in request.body:
                        low_conn.send(hex(len(i))[2:].encode('utf-8'))
                        low_conn.send(b'\r\n')
                        low_conn.send(i)
                        low_conn.send(b'\r\n')
                    low_conn.send(b'0\r\n\r\n')

                    r = low_conn.getresponse()
                    resp = HTTPResponse.from_httplib(
                        r,
                        pool=conn,
                        connection=low_conn,
                        preload_content=False,
                        decode_content=False
                    )
                except:
                    # If we hit any problems here, clean up the connection.
                    # Then, reraise so that we can handle the actual exception.
                    low_conn.close()
                    raise
                else:
                    # All is well, return the connection to the pool.
                    conn._put_conn(low_conn)

        except socket.error as sockerr:
            raise ConnectionError(sockerr)

        except MaxRetryError as e:
>           raise ConnectionError(e)
E           ConnectionError: HTTPConnectionPool(host='localhost', port=5000): Max retries exceeded with url: /load-data/ (Caused by <class 'socket.error'>: [Errno 111] Connection refused)

/usr/lib/python2.7/dist-packages/requests/adapters.py:378: ConnectionError
__________________________________________ test_model_predict __________________________________________

    def test_model_predict():
        '''@test_model_predict

        This method tests the 'model_predict' session.

        '''

>       assert requests.post(
            endpoint_url,
            headers=headers,
            data=get_sample_json('svr-model-predict.json', 'svr')
        )

manual/programmatic_interface/file_upload/pytest_svr_file_upload.py:113:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
/usr/lib/python2.7/dist-packages/requests/api.py:88: in post
    return request('post', url, data=data, **kwargs)
/usr/lib/python2.7/dist-packages/requests/api.py:44: in request
    return session.request(method=method, url=url, **kwargs)
/usr/lib/python2.7/dist-packages/requests/sessions.py:455: in request
    resp = self.send(prep, **send_kwargs)
/usr/lib/python2.7/dist-packages/requests/sessions.py:558: in send
    r = adapter.send(request, **kwargs)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <requests.adapters.HTTPAdapter object at 0x7fe4706f3850>, request = <PreparedRequest [POST]>
stream = False, timeout = <urllib3.util.Timeout object at 0x7fe4706f3410>, verify = True, cert = None
proxies = OrderedDict()

    def send(self, request, stream=False, timeout=None, verify=True, cert=None, proxies=None):
        """Sends PreparedRequest object. Returns Response object.

            :param request: The :class:`PreparedRequest <PreparedRequest>` being sent.
            :param stream: (optional) Whether to stream the request content.
            :param timeout: (optional) The timeout on the request.
            :param verify: (optional) Whether to verify SSL certificates.
            :param cert: (optional) Any user-provided SSL certificate to be trusted.
            :param proxies: (optional) The proxies dictionary to apply to the request.
            """

        conn = self.get_connection(request.url, proxies)

        self.cert_verify(conn, request.url, verify, cert)
        url = self.request_url(request, proxies)
        self.add_headers(request)

        chunked = not (request.body is None or 'Content-Length' in request.headers)

        if stream:
            timeout = TimeoutSauce(connect=timeout)
        else:
            timeout = TimeoutSauce(connect=timeout, read=timeout)

        try:
            if not chunked:
                resp = conn.urlopen(
                    method=request.method,
                    url=url,
                    body=request.body,
                    headers=request.headers,
                    redirect=False,
                    assert_same_host=False,
                    preload_content=False,
                    decode_content=False,
                    retries=self.max_retries,
                    timeout=timeout
                )

            # Send the request.
            else:
                if hasattr(conn, 'proxy_pool'):
                    conn = conn.proxy_pool

                low_conn = conn._get_conn(timeout=timeout)

                try:
                    low_conn.putrequest(request.method,
                                        url,
                                        skip_accept_encoding=True)

                    for header, value in request.headers.items():
                        low_conn.putheader(header, value)

                    low_conn.endheaders()

                    for i in request.body:
                        low_conn.send(hex(len(i))[2:].encode('utf-8'))
                        low_conn.send(b'\r\n')
                        low_conn.send(i)
                        low_conn.send(b'\r\n')
                    low_conn.send(b'0\r\n\r\n')

                    r = low_conn.getresponse()
                    resp = HTTPResponse.from_httplib(
                        r,
                        pool=conn,
                        connection=low_conn,
                        preload_content=False,
                        decode_content=False
                    )
                except:
                    # If we hit any problems here, clean up the connection.
                    # Then, reraise so that we can handle the actual exception.
                    low_conn.close()
                    raise
                else:
                    # All is well, return the connection to the pool.
                    conn._put_conn(low_conn)

        except socket.error as sockerr:
            raise ConnectionError(sockerr)

        except MaxRetryError as e:
>           raise ConnectionError(e)
E           ConnectionError: HTTPConnectionPool(host='localhost', port=5000): Max retries exceeded with url: /load-data/ (Caused by <class 'socket.error'>: [Errno 111] Connection refused)

/usr/lib/python2.7/dist-packages/requests/adapters.py:378: ConnectionError
================================ 4 failed, 16 passed in 119.02 seconds =================================
```

When the flask errors, it also kills the `app.py` process, which I verified by running `netstat -ntlup`:

``` bash
vagrant@vagrant-ubuntu-trusty-64:/vagrant/test$ netstat -ntlup
(No info could be read for "-p": geteuid()=1000 but you should be root.)
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.1:6379          0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:55019           0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:111             0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -
tcp6       0      0 :::111                  :::*                    LISTEN      -
tcp6       0      0 :::22                   :::*                    LISTEN      -
tcp6       0      0 :::56952                :::*                    LISTEN      -
udp        0      0 0.0.0.0:111             0.0.0.0:*                           -
udp        0      0 0.0.0.0:40866           0.0.0.0:*                           -
udp        0      0 0.0.0.0:679             0.0.0.0:*                           -
udp        0      0 0.0.0.0:52672           0.0.0.0:*                           -
udp        0      0 127.0.0.1:739           0.0.0.0:*                           -
udp        0      0 0.0.0.0:68              0.0.0.0:*                           -
udp6       0      0 :::111                  :::*                                -
udp6       0      0 :::42109                :::*                                -
udp6       0      0 :::679                  :::*                                -
udp6       0      0 :::34032                :::*                                -
```

**Notice:** there is no process running on the default port `5000`.

So, I did some minor debugging, and found that my application never throttles [70.2% memory](https://github.com/jeff1evesque/machine-learning/pull/2763#issuecomment-251841492), of the `512MB` virtualbox virtual machine.  When the application finishes the series of `requests.post`, it returns to baseline measure:

![top-2](https://cloud.githubusercontent.com/assets/2907085/19150519/46828792-8b95-11e6-88b7-ca074b2a6b6c.PNG)

![top-3](https://cloud.githubusercontent.com/assets/2907085/19150527/4b82e782-8b95-11e6-8fa7-c4e8a79b3aed.PNG)

**Note:** top is always updating the processes in the terminal output, which is why I pasted two screenshots.  Also, these screenshots are taken about 8 hours since I ran my last attempt of my manual unit tests, which killed `app.py`.  So, `app.py` is not currently running.

I haven't configured uwsgi, or gunicorn.  I'm hoping if I configure gunicorn, it will create work processes, that can handle such `requests.post` against `app.py` more elegantly, to prevent `app.py` from exiting.   But, I'm not sure if my problem is an internal flask bug, given my use case.  Therefore, I'm not sure if gunicorn will solve my problem.

The [database user](https://github.com/jeff1evesque/machine-learning/blob/7a4989fc6d93a6df73027715dbbba16ae997776b/puppet/environment/docker/modules/database/manifests/server.pp#L28-L35) which runs the application, is allowed unlimited connections, and queries.  So, I don't know why my application stops running on the second iteration of the manual `pytest`'s.  Additionally, when my manual unit tests run, I make sure I empty the database tables, which will be operated on.  Since, [`configure_database.py`](https://github.com/jeff1evesque/machine-learning/blob/780d0cd1a6ca724e4db09c0bbceac522f03e2789/test/manual/configure_database.py#L43-L48) is the first file alphabetically closest to the start of the alphabet, it runs first.  So, the database is always refreshed on each iteration, and the [database user](https://github.com/jeff1evesque/machine-learning/blob/7a4989fc6d93a6df73027715dbbba16ae997776b/puppet/environment/docker/modules/database/manifests/server.pp#L44-L50) that performs the `TRUNCATE` operation on each of the database tables, has adequate permission.  I did have another idea, since I was getting errors related to database `cursor`.  Specifically, I thought that maybe my application was heavy on the database operations.  And, for the first time, I checked my database api [`db_query.py`](https://github.com/jeff1evesque/machine-learning/blob/c761a61d58e0444b1a325e81f62310f911c3f784/brain/database/db_query.py#L131), and realized that after each database transaction, including during connection, and disconnection, I write to a log file.  I think after running my manual unit tests, I checked in the corresponding text log file, and it was already 301MB.  This is just from writing to the logs for running the manual unit tests twice.  So, I commented out all instances of writing to a logfile, in `db_query.py`, the API for all of my database queries, and my errors still persists.

I am using **Python 3** and the following code:

```
@app.route('/')
def pdf():
    # [Generate PDF as a byte string]
    with open('file.pdf', 'wb') as f:
        f.write(pdf)
    return send_file(BytesIO(pdf))
```

On the server, a valid PDF file is written. On the client, I get an invalid PDF about twice the expected size.

it looks like an encoding issue, so I am guessing that the fact that I am using Python 3 may be relevant. The differences between the file saved on the server and the one I get on the client is similar to that of [this StackOverflow question](http://stackoverflow.com/questions/35368352/pdf-response-is-corrupted-in-python-3-but-works-in-python-2), but the poster there was passing the PDF data as a string, whereas in my code `pdf` is made of bytes (Python 3 would not let me write the file otherwise).

Addresses #1467. Now you can pass `environ_base` dictionary into `app.test_client`. This also allows overriding per `open` call (or `make_test_environ_builder` call).

Perhaps a better solution would be to edit werkzeug directly and add it to that init (which, in turn, would allow us to remove the subclass init). I don't believe that would cause any unintended behavior, but I'm open to further conversation on it.

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2047)

<!-- Reviewable:end -->

As mentioned in #2009, simplifying the CLI saw the removal of the `-a/--app` flag. Therefore, the only way to specify the module to import is by setting `FLASK_APP`.

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2046)

<!-- Reviewable:end -->

http://denizeren.net/2014/07/14/flask-file-descriptor-inheritance-problem/

In the example for MethodView, post() will not be called unless methods is set on the class or with add_url_rule

https://github.com/pallets/flask/blob/master/flask/views.py#L123

A fix might be having MethodView.methods set to a copy of http_method_funcs i.e. all available methods

If I am missing something here my apologies

assert should not be used in production because assert statements are discarded if the program is compiled to bytecode with the PYTHONOPTIMIZE turned on

https://github.com/pallets/flask/blob/master/flask/views.py#L148

What I am trying to achieve is pretty simple.

I want to use Flask to create a web app that connects to a remote Server via API calls (specifically ParseServer).
I am using a third-party library to achieve this and everything works perfectly when I am running my code in a stand-alone script. But when I add my code into the Flask I suddenly can't authenticate with the Server.

It seems to me that in Flask, the registration method used by the APi library is not remembered.

I tried many things of putting the registration and initialization code in different places in Flask, nothing worked. 

I asked a similar question in the Github of the [Library](https://github.com/milesrichardson/ParsePy/issues/147) with no help. 

So I guess I have **two questions** that could help me solve this:
1) Where should I put a registration method and import of the files from this library?
&
2) What can I do to identify the issue specifically, eg. to know precisely what's wrong?

Here's some code

The Flask code is here

```
@app.route('/parseinsert')
def run_parse_db_insert():
    """The method for testing implementation and design of the Parse Db
    """
    pc = ParseCommunication()
    print(pc.get_all_names_rating_table())
    return 'done'

```

The ParseCommunication is my Class that deals with Parse. If I run ParseCommunication from that script, with the same code as above in the **main** part, everything works perfectly.

I run the Flask app with dev_appserver.py from Google App Engine.

My folder structure 
/parseTest
  /aplication
    views.py
  app.yaml
  run.py

My run.py code

```
import os
import sys

sys.path.insert(1, os.path.join(os.path.abspath('.'), 'lib'))
sys.path.insert(1, os.path.join(os.path.abspath('.'), 'application'))

import aplication
```

Hi,

Can a flask extension be installed using pip and run without user code changes at all?

I want to write a flask extension that uses flask's before_request and after_request hooks.
The user will just need to `pip install flask_<my_extension>` and that's it.

Thanks in advance.

fix unclosed HTML tags

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2040)

<!-- Reviewable:end -->

I create a converter, this copied from docs:

```
import urllib

from flask import Flask, url_for
from werkzeug.routing import BaseConverter


class ListConverter(BaseConverter):
    def to_python(self, value):
        return value.split(',')

    def to_url(self, values):
        return ','.join(BaseConverter.to_url(value)
                        for value in values)


app = Flask(__name__)
app.url_map.converters['list'] = ListConverter


@app.route('/<list:lst>/')
def test(lst):
    return str(lst)


@app.route('/')
def index():
    return url_for('test', lst='a,b')


if __name__ == '__main__':
    app.run(host='0.0.0.0', port=4000, debug=True)
```

I visit `http://localhost:4000/a,b`, it works. but can not visit `http://localhost:4000/`:

```
TypeError: unbound method to_url() must be called with BaseConverter instance as first argument (got str instance instead)
```

Python 3 also raise error:

```
TypeError: to_url() missing 1 required positional argument: 'value'
```

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2039)

<!-- Reviewable:end -->

The http://flask.pocoo.org/docs/0.11/deploying/mod_wsgi/ site currently uses the old Google Code page for `mod_wsgi`. This PR updates the urls for `mod_wsgi` to point to the new [GitHub repo](https://github.com/GrahamDumpleton/mod_wsgi) and [documentation](http://modwsgi.readthedocs.io/en/develop/index.html).

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2038)

<!-- Reviewable:end -->

https://marketplace.visualstudio.com/search?term=flask&target=VSCode&sortBy=Relevance

i don't find it

can you help me  ?

my friend

Hi,

Packt is proud to publish a new book on Flask this year
[Flask By Example](https://www.packtpub.com/web-development/flask-example)

I would appreciate if you could fearure this book on http://flask.pocoo.org/ to help developers in their learning of Flask.

Let me know what you think.

Many thanks.

fix for issue: #1879 
The test of checking default location of the instance folder when running flask app as **main** fails from within VirtualEnv directory because the working directory shares a prefix with sys.prefix. That is partially how flask decides which kind of instance folder to return:

```
"package_path"/var/"name"-instance
or:
"working_dir"/instance.
```

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2035)

<!-- Reviewable:end -->


This seems like a bug on windows:
Test run on windows gave me the following error

```

> py.test tests\test_helpers.py
←[1m============================= test session starts ==========================
===←[0m
platform win32 -- Python 2.7.10, pytest-3.0.2, py-1.4.31, pluggy-0.3.1
rootdir: , inifile: setup.cfg
collected 42 items ←[0m←[1m
←[0m
tests\test_helpers.py ........................................F.

================================== FAILURES ===================================
←[1m←[31m_________________________ TestSafeJoin.test_safe_join _________________
________←[0m

self = <test_helpers.TestSafeJoin object at 0x02F3F790>

←[1m    def test_safe_join(self):←[0m
←[1m        # Valid combinations of *args and expected joined paths.←[0m
←[1m        passing = (←[0m
←[1m            (('a/b/c', ), 'a/b/c'),←[0m
←[1m            (('/', 'a/', 'b/', 'c/', ), '/a/b/c'),←[0m
←[1m            (('a', 'b', 'c', ), 'a/b/c'),←[0m
←[1m            (('/a', 'b/c', ), '/a/b/c'),←[0m
←[1m            (('a/b', 'X/../c'), 'a/b/c', ),←[0m
←[1m            (('/a/b', 'c/X/..'), '/a/b/c', ),←[0m
←[1m            # If last path is '' add a slash←[0m
←[1m            (('/a/b/c', '', ), '/a/b/c/', ),←[0m
←[1m            # Preserve dot slash←[0m
←[1m            (('/a/b/c', './', ), '/a/b/c/.', ),←[0m
←[1m            (('a/b/c', 'X/..'), 'a/b/c/.', ),←[0m
←[1m            # Base directory is always considered safe←[0m
←[1m            (('../', 'a/b/c'), '../a/b/c'),←[0m
←[1m            (('/..', ), '/..'),←[0m
←[1m        )←[0m
←[1m    ←[0m
←[1m        for args, expected in passing:←[0m
←[1m>           assert flask.safe_join(*args) == expected←[0m
←[1m←[31mE           assert '/a\\b\\c' == '/a/b/c'←[0m
←[1m←[31mE             - /a\\b\\c←[0m
←[1m←[31mE             + /a/b/c←[0m

←[1m←[31mtests\test_helpers.py←[0m:803: AssertionError
←[1m←[31m===================== 1 failed, 41 passed in 1.33 seconds =============
========←[0m
```

In windows the directories on an external location can be accessed using four back-slashes "\\\\" from python code. So I would suggest to return "\\\\a\\b\\c" if the env is windows. Of course this line of thinking can be naïve and maybe there is a better approach there.

In the sample code below, Testing... never show if I have time.sleep(1) there. If I remove it, I can see the debug message. I'm on macOS 10.11.6, Flask==0.11.1, Python 3.5.2, running inside virtualenv==15.0.2

```
from flask import Flask
import time

app = Flask(__name__)
app.DEBUG = True

@app.cli.command()
def streaming():
   app.logger.debug('Testing...')
   time.sleep(1)

```

<!-- Reviewable:start -->

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2031)

<!-- Reviewable:end -->

There's a new RFC for preventing CSRF by restricting cookies to same-site only (i.e. no 3rd party cookies).
At least Chrome seems to support it since the developer tools list it if you look at cookies.

Adding support for it in Flask should be pretty simple. (Add an attribute to Set-Cookie when setting the session cookie and a configuration option to configure this.)

See:

https://tools.ietf.org/html/draft-west-first-party-cookies-07

After cloning this repository with git and you run "git fsck" there are multiple errors:

`Checking object directories: 100% (256/256), done.
warning in tree 0b404df8c030cdeaca7b373956c3a697efd32f78: contains zero-padded file modes
warning in tree 51ea366fd4253b3a618289dc1c0c4bb16a3c2a22: contains zero-padded file modes
warning in tree 679afdb340e9e1011927b52d2cd48bd221159131: contains zero-padded file modes
warning in tree 77c7430020693d35500ca4fc292cff63fc3e672b: contains zero-padded file modes
warning in tree 6a37da079f3bed362608b2558b162617c0c3af5c: contains zero-padded file modes
Checking objects: 100% (12634/12634), done.`

This prevents the repository from being push'ed to another git server, for example:

`Counting objects: 12435, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (3696/3696), done.
remote: error: object 0b404df8c030cdeaca7b373956c3a697efd32f78: zeroPaddedFilemode: contains zero-padded file modes
remote: fatal: Error in object
error: pack-objects died of signal 13`

I suggest the repository is rebuilt to correct the corruption in it.

<!-- Reviewable:start -->

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2028)

<!-- Reviewable:end -->

see https://github.com/pallets/flask/pull/1536

<!-- Reviewable:start -->

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2026)

<!-- Reviewable:end -->

<!-- Reviewable:start -->

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2025)

<!-- Reviewable:end -->

Without this, the LICENSE file is never included in the built wheels: this makes it harder for users to comply with the license.
With this addition a file LICENSE.txt will be created in the `xxx.dist-info` directory with the content of the `license_file` file, e.g. the top level LICENSE.

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2024)

<!-- Reviewable:end -->

Flask started to ship with a default, hardcoded logging handler. Unfortunately this setup makes it harder to install custom logging setups, because then you'll have to undo all the things Flask did to the app logger, or replace the `app.logger` entirely. A symptom of this is #1993, where Flask's own logger had to be tweaked yet again such that messages didn't get logged twice (once via Flask's setup, once via the custom one).

My question is: **Do we even want Flask to do any logging setup?** It appears that this sort of default logging is only useful during development, so maybe it makes sense to set up a default logging handler in the new Flask CLI instead of from within the application.

Also added one missing comma for readability

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2022)

<!-- Reviewable:end -->

- Large apps play nicer with recommended project structure #1980 
- runserver.py --> setup.py
- Run as:
  
  pip install -e.
  export FLASK_APP=yourapplication
  flask run

I did not change much, one new paragraph.

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2021)

<!-- Reviewable:end -->

The default commands `run` and `shell` cannot be overridden.

Using a custom command called `shell`, I expect the custom `shell` to override the builtin `shell`

``` python
@app.cli.command('shell', short_help='My custom shell')
def shell():
    pass
```

But running `--help` still produces `flask.cli.shell`'s help

``` bash
> python -m flask
Usage: python -m flask [OPTIONS] COMMAND [ARGS]...

  This shell command acts as general utility script for Flask applications.

  It loads the application configured (either through the FLASK_APP
  environment variable) and then provides commands either provided by the
  application or Flask itself.

  The most useful commands are the "run" and "shell" command.

  Example usage:

    $ export FLASK_APP=hello
    $ export FLASK_DEBUG=1
    $ flask run

Options:
  --help  Show this message and exit.

Commands:
  run    Runs a development server.
  shell  Runs a shell in the app context.
```

And running gives me `flask.cli.shell`'s shell

``` bash
> python -m flask shell

Python 3.5.2 (default, Jul 17 2016, 00:00:00) 
[GCC 4.8.4] on linux
App: wallet
Instance: app/instance
>>> 
```

Also,

``` python
@app.cli.command('shell_plus', short_help='bar')
def shell_plus_1():
    pass

@app.cli.command('shell_plus', short_help='foo')
def shell_plus_2():
    pass
```

has the behaviour I expect

``` bash
Usage: python -m flask [OPTIONS] COMMAND [ARGS]...

  This shell command acts as general utility script for Flask applications.

  It loads the application configured (either through the FLASK_APP
  environment variable) and then provides commands either provided by the
  application or Flask itself.

  The most useful commands are the "run" and "shell" command.

  Example usage:

    $ export FLASK_APP=hello
    $ export FLASK_DEBUG=1
    $ flask run

Options:
  --help  Show this message and exit.

Commands:
  run         Runs a development server.
  shell       Runs a shell in the app context.
  shell_plus  foo
```

Unknown files must not raise errors when send with send-file if the
sending happens by filename.  This is particularly important for
send from directory which can send up loads of unknown files.

This regressed at one point in the last two weeks.  It came up
with woff2 files sent from static folders which are unknown in
the default mimetype database.

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2019)

<!-- Reviewable:end -->

<!-- Reviewable:start -->

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2018)

<!-- Reviewable:end -->

`_scheme` is passed to `url_for` but is not forwarded to error handlers if an exception is raised
I think it is a bug.

My code:

```
from __future__ import unicode_literals, absolute_import
from flask import Blueprint, request, jsonify
from flask_restful import Api, Resource
from six.moves.urllib.parse import unquote
from src.share import filemgr

api = Blueprint('api', __name__, url_prefix='/api')
api_wrap = Api(api)

@api.route('/list', methods=['get'])
def list():
    path = unquote(request.args.get('path', '/'))
    only_folder = request.args.get('only_folder', False)
    nodes = filemgr.list(path)
    if only_folder:
        nodes = filter(lambda x:x.isfolder, nodes)
    return jsonify(nodes)
```

---

ajax get:

```
var path = 'c - 副本'
ajax({
  url: 'http://localhost:5000/api/list',
  params: {
    path: encodeURI(path)
  }
});
```

---

But get `path` decode incorrectly : `u'c - \xe5\x89\xaf\xe6\x9c\xac'`.

It should be `'c - \xe5\x89\xaf\xe6\x9c\xac'` or `u'c - \u526f\u672c''`

I debug into  `list()` and found:

```
>>> request.url
u'http://localhost:5000/api/list?path=c%2520-%2520%25E5%2589%25AF%25E6%259C%25AC'

>>> request.args.get('path', '/')
u'c%20-%20%E5%89%AF%E6%9C%AC'

>>> unquote(request.args.get('path', '/'))
u'c - \xe5\x89\xaf\xe6\x9c\xac'
```

Here the string can not be decode, the correct string is 'c - \xe5\x89\xaf\xe6\x9c\xac', without `u` prefix.

Debug into `request.args at Lib\site-packages\werkzeug\wrappers.py`

in line 431

```
@cached_property
def args(self):
    """The parsed URL parameters.  By default an
    :class:`~werkzeug.datastructures.ImmutableMultiDict`
    is returned from this function.  This can be changed by setting
    :attr:`parameter_storage_class` to a different type.  This might
    be necessary if the order of the form data is important.
    """
    return url_decode(wsgi_get_bytes(self.environ.get('QUERY_STRING', '')),
                      self.url_charset, errors=self.encoding_errors,
                      cls=self.parameter_storage_class)
```

I try some value:

```
>>> wsgi_get_bytes(self.environ.get('QUERY_STRING', ''))
'path=c%2520-%2520%25E5%2589%25AF%25E6%259C%25AC'

>>> url_decode(wsgi_get_bytes(self.environ.get('QUERY_STRING', '')),
                          self.url_charset, errors=self.encoding_errors,
                          cls=self.parameter_storage_class)
ImmutableMultiDict([('path', u'c%20-%20%E5%89%AF%E6%9C%AC')])


`url_decode` decode querystring into wrong.
```

The problem is `url_decode`, should not decode here, because the querystring maybe quote(like my situation)

I was inspired to fix this by the following warning in pytest:
"[pytest] section in setup.cfg files is deprecated, use [tool:pytest] instead."

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2015)

<!-- Reviewable:end -->

Fixed minor error in the errorhandler doc string.

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2014)

<!-- Reviewable:end -->

Before this change after request functions were not correctly
invoked for error handlers.

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2013)

<!-- Reviewable:end -->

Howdy,

I'd like to add stubs for Flask to https://github.com/python/typeshed, a repository used to store PEP 484 type signatures for the python stdlib and  popular third party libraries.  As per PEP 484, permission is required from the library owner before merging type signatures into typeshed - https://www.python.org/dev/peps/pep-0484/#the-typeshed-repo

Here's the corresponding typeshed issue -
https://github.com/python/typeshed/issues/28

my code:

from flask import Flask, make_response, request
app = Flask(**name**)

@app.route("/dtu/<dtuid>/<addr>", methods=["GET","OPTIONS"])
def dtu(dtuid, addr):
    o = drawMultipleDtu(dtuid,addr)
    resp = make_response(o)
    resp.headers["Access-Control-Allow-Origin"] = "*"
    resp.headers["Access-Control-Request-Method"] = "POST,GET,PUT,DELETE,OPTIONS"
    resp.headers["Access-Control-Allow-Methods"] = "POST,GET,PUT,DELETE,OPTIONS"
    resp.headers["Access-Control-Allow-Headers"] = "X-Requested-With,Content-Type"

```
if request.method == 'OPTIONS':
    print "it's OPTIONS"
return resp
```

app.run(host="0.0.0.0", port=5010)
I always got this error:
## Exception happened during processing of request from ('192.168.44.1', 54412)

Traceback (most recent call last):
  File "/mnt/ENTER/lib/python2.7/SocketServer.py", line 290, in _handle_request_noblock
    self.process_request(request, client_address)
  File "/mnt/ENTER/lib/python2.7/SocketServer.py", line 318, in process_request
    self.finish_request(request, client_address)
  File "/mnt/ENTER/lib/python2.7/SocketServer.py", line 331, in finish_request
    self.RequestHandlerClass(request, client_address, self)
  File "/mnt/ENTER/lib/python2.7/SocketServer.py", line 654, in __init__
    self.finish()
  File "/mnt/ENTER/lib/python2.7/SocketServer.py", line 713, in finish
    self.wfile.close()
  File "/mnt/ENTER/lib/python2.7/socket.py", line 283, in close
    self.flush()
  File "/mnt/ENTER/lib/python2.7/socket.py", line 307, in flush
    self._sock.sendall(view[write_offset:write_offset+buffer_size])
error: [Errno 32] Broken pipe

For https://github.com/pallets/flask/issues/2007

which now is more inline with docs in the home page of http://flask.pocoo.org/

Before the change:

```
python hello_flask.py
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
127.0.0.1 - - [07/Sep/2016 11:08:55] "GET / HTTP/1.1" 200 -
127.0.0.1 - - [07/Sep/2016 11:08:55] "GET /favicon.ico HTTP/1.1" 404 -
127.0.0.1 - - [07/Sep/2016 11:09:14] "GET / HTTP/1.1" 200 -
127.0.0.1 - - [07/Sep/2016 11:09:14] "GET /favicon.ico HTTP/1.1" 404 -
```

After the change:

```
python hello_flask.py
 * Running on http://localhost:5000/ (Press CTRL+C to quit)
127.0.0.1 - - [07/Sep/2016 11:09:42] "GET / HTTP/1.1" 200 -
127.0.0.1 - - [07/Sep/2016 11:09:59] "GET / HTTP/1.1" 200 -
```

As you can see its not "getting" the favicon. Is that an issue?

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2010)

<!-- Reviewable:end -->

In short, the documents(both [the online one](http://flask.pocoo.org/docs/0.11/quickstart/#invalid-import-name) and the output of `flask --help`) is not fully updated after CLI interface is [simplified](https://github.com/pallets/flask/commit/523e27118359425048541d92892f20ee048c0b76). The `-a`/`--app` argument has been removed, but the document is somewhat misleading.

This issue comes from [a SO post](http://stackoverflow.com/q/39360392/5399734).  Please read through the comments for more information.

Flask + Zappa users are complaining about an error stemming from Flask's logging of exceptions.

We can reproduce this by generating an unhandled exception in a Flask application that breaks our handler's behavior, but which works for other frameworks (Django, Pyramid, etc.).

It looks like something in Flask is treating a string as if it were a stream, but I've been trying to disable all possible logging and I still see this error. I don't know what's happening. This is occurring with the Flask==0.11.1.

Here is an example:

```
[1473180521973] Traceback (most recent call last):
[1473180521973] File "/usr/lib64/python2.7/logging/init.py", line 880, in emit
[1473180521992] stream.write(fs % msg)
[1473180521992] File "/private/var/folders/00/vp4bg2md3ng4sqkg3hrz_j1003frjd/T/pip-build-RmqRtJ/Werkzeug/werkzeug/local.py", line 343, in getattr
[1473180521992] AttributeError: 'str' object has no attribute 'write'
[1473180521992] Logged from file app.py, line 1587
[1473180521992] [ERROR] 2016-09-06T16:48:41.973Z c29bebc5-7451-11e6-a6f9-bdc91c60ab58 Exception on /fail [GET]
Traceback (most recent call last):
File "/private/var/folders/00/vp4bg2md3ng4sqkg3hrz_j1003frjd/T/pip-build-KC9Xdu/flask/flask/app.py", line 1988, in wsgi_app
File "/private/var/folders/00/vp4bg2md3ng4sqkg3hrz_j1003frjd/T/pip-build-KC9Xdu/flask/flask/app.py", line 1641, in full_dispatch_request
File "/private/var/folders/00/vp4bg2md3ng4sqkg3hrz_j1003frjd/T/pip-build-KC9Xdu/flask/flask/app.py", line 1544, in handle_user_exception
File "/private/var/folders/00/vp4bg2md3ng4sqkg3hrz_j1003frjd/T/pip-build-KC9Xdu/flask/flask/app.py", line 1639, in full_dispatch_request
File "/private/var/folders/00/vp4bg2md3ng4sqkg3hrz_j1003frjd/T/pip-build-KC9Xdu/flask/flask/app.py", line 1625, in dispatch_request
File "/var/task/app.py", line 22, in fail
return 1/0
ZeroDivisionError: integer division or modulo by zero
```

Here is an example using Pyramid instead, failing as expected:
https://css89s7off.execute-api.us-east-1.amazonaws.com/dev/hello/asdf

and the same error in Flask, failing with the stream writing error:
https://pxzhirpoxd.execute-api.us-east-1.amazonaws.com/devor/fail

I am not sure what exactly is happening, and nobody in our little community has been able to figure it out either. We use Werkzeug for some middleware functionality, but since the other frameworks use this same code, I don't think this is the issue, unless there is a specific interaction between Flask and WZ, which I don't think there is.

So, I have a few theories:
    \* A log handler has been configured to write to a file by default. Since Lambda is (essentially) a read-only environment, this will fail.
    \* Code written for Python 3 isn't properly working in Python 2.
    \* Something related to this is happening: https://github.com/pallets/flask/issues/1995

Does anybody have any ideas what might be happening here?

Related tickets and discussion:
https://github.com/Miserlou/Zappa/issues/283
https://github.com/Miserlou/Zappa/pull/302

See #1946 and #1906. I think we should prevent setting those things to IP addresses in the first place and only allow `None` and domain names != `localhost`.

Fix #2005

Revert #1679 and #1996

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2006)

<!-- Reviewable:end -->

going through the tutorial on latest master, this exception is raised on `flask run`
(running inside a virtualenv)

```
>>> flask --version
Flask 0.11.2-dev
Python 3.5.2+ (default, Aug  5 2016, 08:07:14) 
[GCC 6.1.1 20160724]
>>> which -v flask
/home/laerus/.venvs/flask/bin/flask (from PATH element 0)
>>> flask run
 * Serving Flask app "flaskr"
 * Forcing debug mode off
Traceback (most recent call last):
  File "/home/laerus/.venvs/flask/bin/flask", line 9, in <module>
    load_entry_point('Flask==0.11.2.dev0', 'console_scripts', 'flask')()
  File "/home/laerus/.venvs/flask/lib/python3.5/site-packages/flask/cli.py", line 508, in main
    cli.main(args=args, prog_name=name)
  File "/home/laerus/.venvs/flask/lib/python3.5/site-packages/flask/cli.py", line 374, in main
    return AppGroup.main(self, *args, **kwargs)
  File "/home/laerus/.venvs/flask/lib/python3.5/site-packages/click/core.py", line 696, in main
    rv = self.invoke(ctx)
  File "/home/laerus/.venvs/flask/lib/python3.5/site-packages/click/core.py", line 1060, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/home/laerus/.venvs/flask/lib/python3.5/site-packages/click/core.py", line 889, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/home/laerus/.venvs/flask/lib/python3.5/site-packages/click/core.py", line 534, in invoke
    return callback(*args, **kwargs)
  File "/home/laerus/.venvs/flask/lib/python3.5/site-packages/click/decorators.py", line 64, in new_func
    return ctx.invoke(f, obj, *args[1:], **kwargs)
  File "/home/laerus/.venvs/flask/lib/python3.5/site-packages/click/core.py", line 534, in invoke
    return callback(*args, **kwargs)
  File "/home/laerus/.venvs/flask/lib/python3.5/site-packages/flask/cli.py", line 433, in run_command
    passthrough_errors=app.config['PROPAGATE_EXCEPTIONS'])
AttributeError: 'DispatchingApp' object has no attribute 'config'
```

As it was written, that init could not work as Flask was still trying to call it with no authorization parameter.

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2004)

<!-- Reviewable:end -->

`mimetype_filename` is not defined, it should be `attachment_filename`

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2003)

<!-- Reviewable:end -->

- reading sequentially through the tutorial works.
- fixes references to `export FLASK_APP=flaskr.flaskr`

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2002)

<!-- Reviewable:end -->

<!-- Reviewable:start -->

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2001)

<!-- Reviewable:end -->

- adds `from flaskr import app` to top-level in flaskr module
- effect is that `export FLASK_APP=flaskr` works over the more verbose
  `export FLASK_APP=flaskr.flask`
- see the readme for how to run
- all tests are passing with `py.test` or `python setup.py test` (in
  venv)

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/2000)

<!-- Reviewable:end -->

The config logic of flask is potentially useful for any other long running python server software.

I extracted it, extended is and started using it for my own projects : https://github.com/asmodehn/pyros-config.

It would be good if there was a dedicated (pallets) project for that part, not only in flask, so other could collaborate on it.

Thoughts ?

<!-- Reviewable:start -->

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/1998)

<!-- Reviewable:end -->

I have a def that looks like this 

``` python
@app.route("/")
def index():
    return render_template('main.html')
```

When trying to call this def I get 

```
TypeError: index() takes 0 positional arguments but 2 were given
```

Most examples I've found doesn't pass any parameters into the def so I'm not sue why I have too?  How can I go about using my def without passing in parameters?

So for whatever reason I have to pass in 2 arguments for gunicorn so I change my code to look like this:

``` python
@app.route("/")
def index(arg1, arg2):
    return render_template('main.html')
```

After passing in 2 parameters I get:

```
/python3.4/site-packages/flask/templating.py", line 132, in render_template
    ctx.app.update_template_context(context)

AttributeError: 'NoneType' object has no attribute 'app'
```

It appears by using gunicorn it doesn't appear it's setting up the correct context to use templates.  How would I go about setting up the 'app` context?

See pallets/werkzeug#954

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/1996)

<!-- Reviewable:end -->

Here is the code:

app.py

```
from flask import Flask, render_template

app = Flask(__name__)
app.config['DEBUG'] = True

@app.route('/')
def index():
    return render_template('unknown')

if __name__ == '__main__':
    from werkzeug.serving import run_simple
    run_simple('127.0.0.1', 5000, app)
```

Run it by 

```
python app.py
```

or  

```
export FLASK_APP=app.py 
flask run
```

then visit `http://127.0.0.1:5000` will see `ERR_EMPTY_RESPONSE` in browser and nothing in console.

I have a [`nested_dict`](https://pypi.python.org/pypi/nested_dict) that I want to use the `dictsort` filter on.  The template works without `dictsort`, and the filter works on regular dicts.  However, it fails with the following error when using `dictsort` with a `nested_dict`.

```
UndefinedError: nested_dict.implementation.nested_dict object has no element ('5.008008', defaultdict(<class 'nested_dict.implementation.nested_dict'>, {'full': 'perl-5.8.8', 'tiny': '5.8.8'}))
```

```
{% for perl_number in perl_num2ver|dictsort %}
    <th>{{ perl_num2ver[perl_number]['tiny'] }}</th>  
{% endfor %}
```

```
return render_template('pivot_table.html', perl_num2ver=perl_num2ver())
```

The method creating the `nested_dict` object:

```
from nested_dict import nested_dict

def perl_num2ver():
    cfg = nested_dict()  # so we can do hash of hash, dict of dict
    cfg['5.020003'][ 'full' ] = 'perl-5.20.3'
    # etc.
    return cfg
```

```
click==6.6
Flask==0.11.1
itsdangerous==0.24
Jinja2==2.8
MarkupSafe==0.23
pydumper==1.0.1
pymongo==3.3.0
Werkzeug==0.11.10
```

Main motivation for this is that `logging.basicConfig()` otherwise logs
all things twice by default since the logger propagates upwards to the
default handler.

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/1993)

<!-- Reviewable:end -->

How about implementing `__getattr__`  and `__setattr__` for `flask.config.Config` to support dot access?  
instead of writing  `app.config["DATABASE"]`, I'd like to write `app.config.DATABASE`  

`/usr/local/lib/python3.5/dist-packages/flask/exthook.py:71: ExtDeprecationWarning: Importing flask.ext.pymongo is deprecated, use flask_pymongo instead.
`

```
# pip3 show flask

---
Metadata-Version: 2.0
Name: Flask
Version: 0.11.1
Summary: A microframework based on Werkzeug, Jinja2 and good intentions
Home-page: http://github.com/pallets/flask/
Author: Armin Ronacher
Author-email: armin.ronacher@active-4.com
Installer: pip
License: BSD
Location: /usr/local/lib/python3.5/dist-packages
Requires: click, Werkzeug, itsdangerous, Jinja2
Classifiers:
  Development Status :: 4 - Beta
  Environment :: Web Environment
  Intended Audience :: Developers
  License :: OSI Approved :: BSD License
  Operating System :: OS Independent
  Programming Language :: Python
  Programming Language :: Python :: 2
  Programming Language :: Python :: 2.6
  Programming Language :: Python :: 2.7
  Programming Language :: Python :: 3
  Programming Language :: Python :: 3.3
  Programming Language :: Python :: 3.4
  Programming Language :: Python :: 3.5
  Topic :: Internet :: WWW/HTTP :: Dynamic Content
  Topic :: Software Development :: Libraries :: Python Modules
Entry-points:
  [console_scripts]
  flask=flask.cli:main

```

```
# apt-cache policy python3
python3:
  Installed: 3.5.1-4
  Candidate: 3.5.1-4
  Version table:
 *** 3.5.1-4 500
        500 http://ftp.debian.org/debian testing/main amd64 Packages

```


If you’re using the interactive debugger in the web browser, and autocorrect is feeling aggressive, it can kick in and try to “fix” the Python commands you’re typing. This is annoying for the end-user, and rarely helpful as autocorrect doesn’t know about Python. More than once this has bitten me, causing me to write invalid Python, or for variable names to change case mid-command.

I don’t have time to create a patch now, but I think the fix is just adding the following attribute to the `<input>` tag where you type commands:

```
autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
```

This probably isn’t really Flask’s fault – the OS is what actually makes the unhelpful autocorrections – but it seems like something Flask should be able to fix.

I spotted this on the developer builds of OS&nbsp;X Sierra, where autocorrect seems noticeably keener (especially in `<input>` fields) than older versions.
- Python 3.5.0
- Flask 0.11.1
- Werkzeug 0.11.10

Amend #1849

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/1988)

<!-- Reviewable:end -->

Python 3.4.2
TypeError: Type str doesn't support the buffer API

Minimal example below

``` python
# coding=utf8
from flask import Flask, Response

app = Flask(__name__)

@app.route('/')
def hello():
    response = Response("!!!")
    response.headers[b'Server'] = 'Flask'
    return response
```

In Python 2.7.12, the resulting response has a HTTP header of `Server: Flask`. In Python 3.5.2, the resulting response has HTTP headers of `Server: Werkzeug/0.11.10 Python/3.5.2` and `b'Server': Flask`.  Python 2 has the expected behavior.

Testing from within a Python 3 venv, `pip freeze` output is:

```
click==6.6
Flask==0.11.1
itsdangerous==0.24
Jinja2==2.8
MarkupSafe==0.23
Werkzeug==0.11.10
```

Python 3.4.2

Fix TypeError: Type str doesn't support the buffer API

Continuing #1416

All inline discussions have been resolved.
I have some code that basically does:

`self.data = session['cart']`

and then later:

`self.data['some-key'] = 'some-value'`

This always used to update the session, but now it doesn't.  If I change my code to be as follows:

`self.data['some-key'] = 'some-value'`
`session.modified = True`

It suddenly works again.

```
import os
import flaskr
import unittest
import tempfile

class FlaskrTestCase(unittest.TestCase):

    def setUp(self):
        self.db_fd, flaskr.app.config['DATABASE'] = tempfile.mkstemp()
        flaskr.app.config['TESTING'] = True
        self.app = flaskr.app.test_client()
        with flaskr.app.app_context():
            flaskr.init_db()

    def tearDown(self):
        os.close(self.db_fd)
        os.unlink(flaskr.app.config['DATABASE'])

    def test_empty_db(self):
        rv = self.app.get('/')
        assert b'No entries here so far' in rv.data
if __name__ == '__main__':
    unittest.main()
```

(flask) ➜  flask-demo git:(master) ✗ python tests/flaskr_tests.py
ERROR: test_empty_db (**main**.FlaskrTestCase)
Traceback (most recent call last):
  File "tests/flaskr_tests.py", line 9, in setUp
    self.db_fd, flaskr.app.config['DATABASE'] = tempfile.mkstemp()
AttributeError: 'module' object has no attribute 'app'

Ran 1 test in 0.004s
FAILED (errors=1)

Hi,
I fixed this line to conform with PEP-8.
Regards,

The [Larger Applications docs](http://flask.pocoo.org/docs/0.11/patterns/packages/) recommend creating a `runserver.py` as follows:

``` python
from yourapplication import app
app.run(debug=True)
```

This runs counter to the advice in the [Development Server](http://flask.pocoo.org/docs/0.11/server/) doc for working with the `flask run` command — the `app.run()` call should be under `if __name__ == '__main__'`.

That makes it work properly, anyway. But when using `flask run`, the `runserver.py` file can be removed altogether.

To reproduce:

https://github.com/PlasmaSheep/flask-bug

Clone repo and install flask (python2)

```
export FLASK_APP=/path/to/repo/flask-bug/autoapp.py 
flask run
```

Notice the output:

```
[$]>>> flask run
Using config: development
Debug is: True
 * Serving Flask app "autoapp"
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
```

So debug is enabled in the config, but the debugger is not actually active.

This does work if you set the `FLASK_DEBUG` env variable:

```
[$]>>>  flask run
 * Serving Flask app "autoapp"
 * Forcing debug mode on
Using config: development
Debug is: True
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
Using config: development
Debug is: True
 * Debugger is active!
 * Debugger pin code: 155-859-497
```

However I think that the debug parameter should be specified in only one place, and that place should be the application config file so that you don't have to worry about setting environment variables for things you already specified in the config.

The [declarative](https://github.com/pallets/flask/blob/master/docs/patterns/sqlalchemy.rst#declarative) section includes the following example:

```
Declarative
-----------

The declarative extension in SQLAlchemy is the most recent method of using
SQLAlchemy.  It allows you to define tables and models in one go, similar
to how Django works.  In addition to the following text I recommend the
official documentation on the `declarative`_ extension.

Here's the example :file:`database.py` module for your application::

    from sqlalchemy import create_engine
    from sqlalchemy.orm import scoped_session, sessionmaker
    from sqlalchemy.ext.declarative import declarative_base

    engine = create_engine('sqlite:////tmp/test.db', convert_unicode=True)
    db_session = scoped_session(sessionmaker(autocommit=False,
                                             autoflush=False,
                                             bind=engine))
```

`db_session` is a variable, and a paragraph below, it tries to import it. Which isn't really possible.

```

    from yourapplication.database import db_session

    @app.teardown_appcontext
    def shutdown_session(exception=None):
        db_session.remove()
```

This documentation is misleading 

On Python 3, New Relic uses `__qualname__` to trace transactions. Without setting `__qualname__` in `as_view()`, I don't get meaningful accounting of transactions in New Relic on my class-based views.

`__qualname__` is meaningless in Python 2, but I think it's just a harmless no-op in this context.

Fixes #1975 

From [this page](http://flask.pocoo.org/docs/0.11/deploying/uwsgi/)
uWSGI is started with a socket at `/tmp/uwsgi.sock` and the Nginx config points to `/tmp/application.sock`. Both example should point to the same socket, I'd suggest `/tmp/application.sock`.

Hi!
``
We've experienced an interesting issue:

Flask:

``` python
#post_flask.py
from flask import (Flask, request)
app = Flask(__name__)
app.config['MAX_CONTENT_LENGTH'] = 1600 * 1024 * 1024

@app.route('/pepe_post', methods=['POST'])
def post_pepe():
    print('Hey!!!')
    if request.method == 'POST':
        #print(len(request.data))  #<< Uncomment to fix!!!
        return 'hoho'

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5555, debug=True)
```

Client:

``` python
#do_post.py
import requests

def post(url, payload=None):
    """ Handles POST http requests having an url and some optional payload """
    print("POST against url: '%s'", url)
    print("POST payload size: '%s'", len(payload))
    resp = requests.post(url, data=payload, headers={'content-type':'application/json'})
    print("POST response: '%s'", resp.text)
    if resp.status_code != requests.codes.ok:
        print('Service Response indicates error: %s/%s',
                        resp.status_code, resp.content)
        resp.raise_for_status()

if __name__ == '__main__':
    url = 'http://localhost:5555/pepe_post'
    n = 1
    while True:
        print('post with payload of %s' % n)
        payload = n * 1024 * 'a'   # << this breaks avobe 690K payloads
        #payload = n * 1024 * 1024 * 'a'   # << this breaks inmediately
        post(url, payload)
        n += 1
```

Meaning, above ~690K posts, you get:

```
post with payload of 696
POST against url: '%s' http://localhost:5555/pepe_post
POST payload size: '%s' 712704
Traceback (most recent call last):
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/site-packages/requests/packages/urllib3/connectionpool.py", line 559, in urlopen
    body=body, headers=headers)
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/site-packages/requests/packages/urllib3/connectionpool.py", line 353, in _make_request
    conn.request(method, url, **httplib_request_kw)
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/http/client.py", line 1137, in request
    self._send_request(method, url, body, headers)
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/http/client.py", line 1182, in _send_request
    self.endheaders(body)
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/http/client.py", line 1133, in endheaders
    self._send_output(message_body)
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/http/client.py", line 967, in _send_output
    self.send(message_body)
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/http/client.py", line 929, in send
    self.sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/site-packages/requests/adapters.py", line 376, in send
    timeout=timeout
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/site-packages/requests/packages/urllib3/connectionpool.py", line 609, in urlopen
    _stacktrace=sys.exc_info()[2])
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/site-packages/requests/packages/urllib3/util/retry.py", line 247, in increment
    raise six.reraise(type(error), error, _stacktrace)
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/site-packages/requests/packages/urllib3/packages/six.py", line 309, in reraise
    raise value.with_traceback(tb)
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/site-packages/requests/packages/urllib3/connectionpool.py", line 559, in urlopen
    body=body, headers=headers)
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/site-packages/requests/packages/urllib3/connectionpool.py", line 353, in _make_request
    conn.request(method, url, **httplib_request_kw)
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/http/client.py", line 1137, in request
    self._send_request(method, url, body, headers)
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/http/client.py", line 1182, in _send_request
    self.endheaders(body)
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/http/client.py", line 1133, in endheaders
    self._send_output(message_body)
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/http/client.py", line 967, in _send_output
    self.send(message_body)
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/http/client.py", line 929, in send
    self.sock.sendall(data)
requests.packages.urllib3.exceptions.ProtocolError: ('Connection aborted.', BrokenPipeError(32, 'Broken pipe'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "do_post.py", line 21, in <module>
    post(url, payload)
  File "do_post.py", line 7, in post
    resp = requests.post(url, data=payload, headers={'content-type':'application/json'})
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/site-packages/requests/api.py", line 107, in post
    return request('post', url, data=data, json=json, **kwargs)
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/site-packages/requests/api.py", line 53, in request
    return session.request(method=method, url=url, **kwargs)
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/site-packages/requests/sessions.py", line 468, in request
    resp = self.send(prep, **send_kwargs)
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/site-packages/requests/sessions.py", line 576, in send
    r = adapter.send(request, **kwargs)
  File "/Users/lguzman/workspace/anaconda/anaconda3/envs/opportunity/lib/python3.4/site-packages/requests/adapters.py", line 426, in send
    raise ConnectionError(err, request=request)
requests.exceptions.ConnectionError: ('Connection aborted.', BrokenPipeError(32, 'Broken pipe'))
```

Can someone give us some information about this? is this by design? bug?

Version:
Flask==0.10.1

Thanks!

Just updated print 'Initialized the database.' with print('Initialized the database.') to be python3 compliant.

Problem description:

> In a URL with two path:... type arguments (both need to accept URL-path-encoded data) next to each other, a %2F (encoded /) gets included in the wrong parameter.

Versions:

> Python 2.7.11
> Flask 0.11
> Werkzeug 0.11.10

Request URL:
`http://localhost:5000/api/v1/entry/foo.com/%2Fbar%2Fbaz/block/12345/get`

Result:
`{"this_is_a_test": "XXX this is test code, not a real thing", "path": "bar/baz", "name": "foo.com/"}`

That is:

> name: foo.com/
> path: bar/baz

Expected Result:
`{"this_is_a_test": "XXX this is test code, not a real thing", "path": "/bar/baz", "name": "foo.com"}`

That is:

> name: foo.com
> path: /bar/baz

The code:

```
# The special modifier "path" as in "<path:somevariablename>" means
# "somevariablename" may be URL path encoded data.
@app.route('/api/v1/entry/<path:name>/get')
@app.route('/api/v1/entry/<path:name>/<path:path>/get')
def get_entry(name, path=None, methods=['GET']):
    name = urllib.unquote(name)

    if path is not None:
        path = urllib.unquote(path)

    return json.dumps({
        'this_is_a_test': 'XXX this is test code, not a real thing',
        'name': name,
        'path': path,
    })
```

`app.jinja_env` is a property that creates the environment on first access. If `app.debug` is not configured explicitly before accessing `app.jinja_env`, `env.auto_reload` will be calculated as `False`. The `run` command's `debug` flag can change the app's debug flag, at which point `auto_reload` needs to be reconfigured.

This extracts the logic for `auto_reload` to `Flask.templates_auto_reload`. It adds a new method to be called by `app.run` or `ScriptInfo.load_app` that will reconfigure the app if `debug` is set by the command.

continues #1910
closes #1907
``flask.json.JSONEncoder()`` encodes aware datetime objects in non-UTC timezone incorrectly using local time tuple with GMT.

### Expected Behavior

The following code segment should print ``"Sun, 01 Jan 2017 20:34:56 GMT"``  (12:34:56 PST8PDT is 20:34:56 GMT):

```python
from datetime import datetime
from pytz import timezone
dt = timezone('PST8PDT').localize(datetime(2017, 1, 1, 12, 34, 56))

from flask.json import JSONEncoder
encoder = JSONEncoder()
print(encoder.encode(dt))
```

### Actual Behavior

The preceding code segment prints ``"Sun, 01 Jan 2017 12:34:56 GMT"`` instead, that is, local timetuple() appended with GMT.

### Environment

* Python version: 3.5.3
* Flask version: 0.12.2
* Werkzeug version: 0.12.2

closes #1809

Make section available via intersphinx
For consistency with rest of pages. Linkable via intersphinx
There is an issue I've been having for a few years regarding Flask and I failed to articulate it correctly. I find ``from_envvar``'s behavior unintuitive. Also, I haven't been able to find prior discussions mentioning it. Probably because of [Chesterton's fence](https://en.wikipedia.org/wiki/Wikipedia:Chesterton%27s_fence), or they feel they'd be told to work around it. Which only takes one line:

``app.config.from_object(os.environ["app.config.dev"])``, see [Google results](https://www.google.com/search?q=%22from_object(os.environ%22)) 😄 

The first google result I see is [people perplexed by from_envvar](https://stackoverflow.com/questions/20062256/how-to-use-app-config-from-envvar-flask). Why? I'm not sure. For some reason, in recent years, Django (and frankly, Flask also) got devs accustomed to importing modules via strings.

Current behavior: 

- ``from_envvar`` forwards to ``from_pyfile``, which strictly requires an absolute/relative file path (*i.e. not a module string*).

Expected behavior:

- ``from_envvar`` should wrap ``from_object``

   Why:

   - ``from_envvar`` [only works with files](https://github.com/pallets/flask/blob/789715a/flask/config.py#L109)
   -  File from ``from_envvar`` [are interpreted as modules anyway](https://github.com/pallets/flask/blob/789715a/flask/config.py#L111)
   - ``from_envvar`` (``from_pyfile``) cannot point to classes
   - ``from_object`` supports **string**  module/class paths (e.g. ``app.config.dev``), which works with environmental variables
   - ``from_object``supports both [classes and modules](https://github.com/pallets/flask/blob/789715a/flask/config.py#L139). Especially important since the official documentation [gives examples of using classes](http://flask.pocoo.org/docs/0.12/config/#development-production).
   - It's more customary for users invoking configuration by *files* to do so via CLI arguments.
   - A local, dev, staging, or production deployment in practice would opt to use environmental variables to point to a python object (module/class) via string.

      For instance: Let's say we're deploying to production with a uwsgi config. Since python production deployment is highly driven by packages, *we've likely already done the work of figuring out our python environmental / package locations*. It'd be more intuitive to point to a python object by string, rather than by file path.

- Alternative: ``from_envvar`` should additionally wrap ``from_object`` for non-file paths.

* Python version: 3.6
* Flask version: 1.12
* Werkzeug version: 0.12.2


Addresses issue #2329 -- adds basic how-to on configuring a Flask application using environmental variables.
closes #2174
Sphinx autodoc `:inherited-members:` doesn't include attributes. The only solution is to duplicate the `_PackageBoundObject` attributes and their docs in the `Flask` and `Blueprint` classes.

The duplicated attributes can be removed once sphinx-doc/sphinx#741 is fixed.

closes #480
Caching handlers for the exception MRO caused issues with some inheritance setups. I don't expect hierarchies to be deep enough for this to affect most cases, but if performance is an issues handlers should be explicitly registered for each class they apply to.

closes #2267, closes #1433

* E309 expected 1 blank line after class declaration
* E128 continuation line under-indented for visual indent
* E265 block comment should start with "# "
* E306 expected 1 blank line before a nested definition, found 0

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

`python -m flask.cli` raises an import warning on > 2.6. It's only needed on 2.6, `python -m flask` works otherwise.
closes #2357
Continues #1984.

* `json` argument to test client request methods serializes data as JSON and sets content type.
* Extract request JSON methods to mixin, apply to Response.
### Expected Behavior

Given a project with the following structure:

```
project/
    my_cool_app/
        __init__.py
```

```python
from flask import Flask

app = Flask(__name__)
```

Running the following should work without warnings:

```
FLASK_DEBUG=1 FLASK_APP=my_cool_app python -m flask run
```

I use `python -m flask run` in order to not need `my_cool_app/__init__.py` as `FLASK_APP`, per the discussion around [this issue](https://github.com/pallets/flask/issues/1847).

### Actual Behavior

A warning is printed on the console when using the reloader:

```
/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/runpy.py:125:
RuntimeWarning: 'flask.cli' found in sys.modules after import of package 'flask',
but prior to execution of 'flask.cli'; this may result in unpredictable behaviour
```

### Environment

* Python version: 3.6.1 (MacOS 10.12.5)
* Flask version: 0.12.2
* Werkzeug version: 0.12.2

Add double quotation marks on documents for following web standards.

https://www.w3.org/TR/html4/intro/sgmltut.html#h-3.2.2
In the 0.12.2 release the version in `flask/__init__.py` is still 0.12.2-dev

This is causing problems with programs checking the flask version.
When using `stream_with_context`, a new session was being opened based on the original request data. If the view containing the generator had modified the session, those changes were not visible.

This does not enable modifying the session in the generator, as the headers will have already been sent. (Possibly does not apply to server-side sessions, but you would still need to manually save the session in the generator.)

Closes #1348.
Documentation does not currently mention that is_json accepts mimetypes that are not strictly application/json.
Continues #1452.

Refactors `flask.session.TaggedJSONSerializer` to a new `flask.json.tag` module. Creates a `JSONTag` interface and a `TaggedJSONSerializer.register` method to register new tags.

~~~python
from flask.json.tag import JSONTag

class TagOrderedDict(JSONTag):
    __slots__ = ('serializer',)
    key = ' od'

    def check(self, value):
        return isinstance(value, OrderedDict)

    def to_json(self, value):
        return [[k, self.serializer.tag(v)] for k, v in iteritems(value)]

    def to_python(self, value):
        return OrderedDict(value)

app.session_interface.serializer.register(TagOrderedDict, 0)
~~~

Since `register` takes an index, it can be used to override existing tags (although it would be slightly more efficient to subclass `TaggedJSONSerializer` instead). This can address #1908 by adding a higher-priority `dict` serializer that uses a different format to support non-string keys.

Closes #1438, #1511, #1908.

~Still needs:~

- [x] refactor to move the `serializer` argument to `self.serializer` instead. It was an attempt at optimization but didn't change anything.
- [x] refactor `TagDict` to split the logic between addressing #1511 and regular dict passthrough, as #1452 originally did. This was another optimization attempt that didn't help, it just made the code more confusing.
- [x] more tests
- [x] documentation
Hi 
   When I use Flask as my web server, I meet a diffcult problem.
   Because of network problem, the flask server sometimes hang forever(The client build a connection to server and then died before send anything). And I found it hanged at socket read function. The server was started by  "app.run()" (The way you don't suggest to use) . So I readed the flask and werkzeug code and found werkzeug didn't set socket timeout default. So I must writed a class extends serving.WSGIRequestHandler and set the timeout = 0.5 and  made it as a parameter for "app.run()" , it worked well.

 But there was another problem, I couldn't run this server in multi-thread mode, because when I used flask commod to run this server, there was no way to set timeout, it didn't make "app.run()" as the  start point。

I also tried gunicorn and still couldn't find a way both set timeout and run server in muti-thread mode. 

what should I do ?
When registering an error handler for a code that's not registered in `werkzeug.exceptions`, a `KeyError` is raised. This changes the error to show a helpful "use a HTTPException subclass" as well. Documentation is updated to describe this behavior and other clean up.

The supported pattern for unknown codes is:

~~~python
class UnknownError(HTTPException):
    code = 999
    description = "A very large error occurred."

app.register_error_handler(UnknownError, handle_999)

raise UnknownError
~~~

If a standard code does not work, submit a patch to add it to Werkzeug.

closes #1837
Adding Couchdb views from the blueprints are showing error... Tried with accessing the main app as 'current_app' but showing error 'RuntimeError: Working outside of application context.'
My Code from blueprint for adding/syncing couchdb views are as following:


```python
from flask import current_app as app
manager = CouchDBManager()

with app.app_context():
    manager.setup(app.app_context())
    manager.add_viewdef(my_couchdb_view_from_blueprint)
    manager.sync(app.app_context())
```


The error message is as following:


RuntimeError: Working outside of application context.
This typically means that you attempted to use functionality that needed
to interface with the current application object in a way.  To solve
this set up an application context with app.app_context().



* `TRAP_BAD_REQUEST_ERRORS` is enabled by default in debug mode
* `BadRequestKeyError` has the key in the description in debug mode

If `app.debug` is true but we're not running in the interactive debugger, this now raises a 500 error (the traceback in the console has the key error though). Can get the old behavior by setting `TRAP_BAD_REQUEST_ERRORS = False`.

This error is one of the most recurring questions about Flask on Stack Overflow. Making the error visible will hopefully answer a lot of questions before they're asked.

closes #382
`Flask.save_session`, `open_`, and `make_null_` are deprecated in favor of using a custom `session_interface`. Their docs already recommended doing that. Marked as deprecated in 1.0, removed in 1.1.

ref #1182
closes #2345
#2288 and #2322 added support for setting `Vary: Cookie` and not clobbering the existing `Vary` header. Unfortunately, there was already built-in support for that, we just missed it. Switch to this:

~~~python
response.vary.add('Cookie')
~~~
All places that use `APPLICATION_ROOT` were using the pattern `app.config.get('APPLICATION_ROOT') or '/'`. This sets the default config to `'/'` to simplify things, since it was the implicit default and didn't do anything special if it wasn't set.
* fix tox to test examples again 😞
* add detox env for faster testing, `tox -e detox`, although sometimes there are weird failures that work fine with plain `tox`
* clean up makefile, add tox target
* add extra group for installing dev requirements, `pip install -e ".[dev]"
* clean up contributing doc, build with docs
* expand issue template
* add pull request template
Fix issue https://github.com/pallets/flask/issues/2341
An example is in the Flickr app [link here](https://github.com/pallets/flask/blob/master/examples/flaskr/flaskr/factory.py#L19)

As a newcomer it is confusing when I follow the [README.md](https://github.com/pallets/flask/blob/master/examples/flaskr/README#L24), but the when running the app it results in the following error. 
![image](https://cloud.githubusercontent.com/assets/11146130/26524504/51b31274-4302-11e7-8dd6-21426b08bbbf.png)



https://blog.travis-ci.com/2017-05-11-introducing-build-stages

I am using the [RedisSessionInterface](https://pythonhosted.org/Flask-Session/#flask.ext.session.RedisSessionInterface) of [flask-session](https://pythonhosted.org/Flask-Session/) to implement my server side sessions.  I have a test case that relies on mutating the session and I have read that this is possible [from the Flask documentation](http://flask.pocoo.org/docs/dev/testing/#accessing-and-modifying-sessions).

Here's my test code (using [pytest](https://pytest.org/)):

``` python

def test_code_already_used(app, client):
    uri = url_for("login.username")
    response = client.get(uri)  # stores the initial state in the session
    assert response.status_code == 302

    query = urlparse(response.location).query
    payload = dict(parse_qsl(query))
    state = payload['state']  # get key for session state

    with app.test_client() as context:
        transaction = context.session_transaction()
        with transaction as mutable_session:
            mutable_session[state] = {'exchanged': True}  # mutates the session

    # test code later fails becase the modification is not propagated
```

My application relies on seeing `exchanged=True` but this change is not there.

Any ideas!?

https://travis-ci.org/pallets/flask/builds/236168998?utm_source=github_status&utm_medium=notification

there are currently 22 targets. There's no way those are all needed. 
Smallest PR ever, but that missing space has been annoying me for a very long time.

A guide showing how to get the `flask run` cli functionality directly within PyCharm-- addresses issue #2198. Even when PyCharm implements smoother integration, we're probably still going to need a variation of this to address factories/etc.
* reduce number of tox and travis envs, was taking way too long to run (~50 minutes)
* bump minimum werkzeug version to fix tests. I don't find this particularly controversial, but someone else can bump it back down if 0.9 from 2013 is too recent.
* use archive packages from github for devel, cloning was taking too long
* cache pip pacakges on travis
* collect branch coverage
* collect coverage of test code
* report coverage across envs
* test building docs, don't linktest by default
* enable codecov integration
Minor edits/formatting/add links in 8 files in the Flaskr tutorial pages.  Intended to aid newbies to follow.
On Heroku, we can't add a local config `instance/config.py` that's not part of the repo. Instead, they support configuration through env vars. Document this pattern.

`myapp/config.py`:

~~~python
MAIL_USERNAME = os.environ.get('FLASK_MAIL_USERNAME', 'default')
LDAP_PORT = int(os.environ.get('FLASK_LDAP_PORT', 636))
~~~
The issue tracker is a tool to address bugs.
Please use the #pocoo IRC channel on freenode or Stack Overflow for questions.
How Can I Make Pagination In Flask??
Hi,  I'm reading the docs and working on code at the same time with somewhat narrow windows.  
The Flask docs have a big sidebar on the left that is not always useful, and worse the body text has a fixed width that pushes it off the right side of the page.  Makes it very hard to read without constantly scrolling.

Doesn't fit in with old-school html wrapping or new responsive hotness.  Disabling:

```
div.document {
	/* width: 940px; */
}
```

with the dev tools fixed the width problem, responsive css could disable the sidebar when the window is narrow.  Cheers,

#2264 
I have found more spots in the test suite that could have been "DRYed" up.

Modify several tests to use the app and client test fixtures.
Closes #2317 
The test add coverage for methods: `Blueprint.app_url_defaults`, and
`Blueprint.app_url_preprocessing`. This PR increases the coverage of
blueprint module by 2%.
Flask requires click >= 4.0, not 2.0 as `click.echo` doesn't have `color` argument in 2.0
See https://lgtm.com/projects/g/pallets/flask/snapshot/d8cd0c47028efe0b0efe052bccc8bd52de87be7c/files/flask/cli.py#L163
#2266 
The `request` fixture is not needed anymore.
If the `Vary` header is already set, the current session code just adds another header line. What it should do is update the existing header by splitting, adding the new option to the set, joining, and setting the new value. See Django's [`patch_vary_headers`](https://github.com/django/django/blob/1ce04bcce0076360623ae164afd3541a5c031af2/django/contrib/sessions/middleware.py#L45).

Related to #2288 

This is just a small addition to the documentation, closing #2281. I included a dummy path in order to fit the appearance of the Windows CLI prompts.
Resolves issue #941, replaces pr #2082 and #2144, code based on #2144, tangentially related to #1383
Error handlers are now returned in order of blueprint:code, app:code, blueprint:HTTPException, app:HTTPException, None

Corresponding tests also added.

Resubmit of #2304 
https://github.com/pallets/flask/blob/c8e56d58077d29e2c9478f133b3c69ba73deead5/tests/test_reqctx.py#L147-L196 could be organized into a single class specifically for tests about greenlets. 

This is cleaner because Pytest supports conditionally skipping the entire class if greenlets are missing rather than having to mark each test separately. And can trigger just that class of tests etc.
I'm wondering if the [`modules_tmpdir` fixture](https://github.com/pallets/flask/blob/c8e56d58077d29e2c9478f133b3c69ba73deead5/tests/conftest.py#L68-L79), could be removed/replaced in the tests with `pytest`'s built-in [`tmpdir` fixture](https://docs.pytest.org/en/latest/tmpdir.html)? 

Not 100% confident this is possible/the right move, but it's worth investigating.
Hi,

Pytest's documentation recommends the use of the yield syntax over teardown functions.

I did not modify the flaskr example as it is being handled by #2307.
Also, I'm not familiar enough with Flask's tests to refactor the last two uses of `request.addfinalizer`:
- [tests/conftest.py#L126](https://github.com/pallets/flask/blob/master/tests/conftest.py#L126)
- [tests/test_instance_config.py#L131](https://github.com/pallets/flask/blob/master/tests/test_instance_config.py#L131)

Add notes about the following http headers and protocols:

 
- SSL/HTTPS
- Security Headers
- Content Security Policy (CSP)
- HTTP Strict Transport Security (HSTS)
- X-FRAME-OPTIONS (Clickjacking protection)
- X-Content-Type-Options
- Cookie options
- HTTP Public Key Pinning (HPKP)
>The downside is that you cannot unregister a blueprint once an application was created without having to destroy the whole application object.

this statement appears in the [docs](http://flask.pocoo.org/docs/0.12/blueprints/), but is there a design reason behind this, or is it just because it hasn't been implemented yet? if it's not possible, what are alternatives for disabling an endpoint other than using some kind of variable to store whether an endpoint should be active?
These changes look to replace references to `unittest` in the documentation with `pytest`.

In particular, for `docs/testing.rst`, code examples have been updated to reflect the current state of  `test_flaskr.py`: https://github.com/pallets/flask/blob/master/examples/flaskr/tests/test_flaskr.py
Using pytest fixtures for test cases. Resolves #2287 

Resolves issue #941, replaces pr #2082 and #2144, code based on #2144, tangentially related to #1383
Error handlers are now returned in order of blueprint:code, app:code, blueprint:HTTPException, app:HTTPException, None

Corresponding tests also added.

Got less coverage improvement than I was hoping, but it did get a bit more.
Talked with @davidism and decided to add section for uWSGI HTTP router / server via embedded mode.
Add test to cover following methodss to the `Blueprint` object:
`before_request`, `after_request`, `before_app_request`,
`before_app_first_request`, `after_app_request`.
This PR increases the coverage of flask.blueprints by 6%.
This references “Reorder deploy docs to mention standalone wsgi first” in project sprint.
This tests the `Blueprint.add_app_template_global` mothod, which internally
calls the `Blueprint.app_template_global` method. The methods are used to
registering a function to the jinja template environment.
This PR increases the test coverage for module `flask.blueprint` by 4%.
Test both context_processor and app_context_processor functions.
Two context parameters are added into the context: one added to
the blueprint locally; another added to the app globally. The test
asserts the behaviors in both blueprint scope and the app scope.
The coverage for flask.blueprints is increased by 3%.
Resubmit for #2265 (git issues)

This test case registers an application-wise error handler from
a Blueprint. Verifies the error handler by aborting the flask app
from the application itself as well as from another registered
Blueprint.
#2265 
#2261 
The `-a myapp:app` and `--debug` flags were removed from the CLI and became environment variables instead. I'm not very clear on the reasons behind that, but at the time it was stated that Click could be fixed to support that again. Has Click been fixed? Let's try adding it back.
Hello, I'm a novice.  I use pycharm for development, when I ran my application to listen on 0.0.0.0, I needed to type “http://localhost:5000" to webbroswer to visit my website. It's a bit inconvenient! So I add a some codes to the app.py file to render the url.

```
 * Restarting with stat
 * You can visit http://localhost:5000/
 * Debugger is active!
 * Debugger pin code: 294-762-868
 * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)
```

 In my opinion, it's convenient than before. 

Thanks you very much!

example
```
test = {
    "b": "test",
    "a": "test",
    "h": "test",
    "f": "test"
}
```
they should return
```
 {
    "b": "test",
    "a": "test",
    "h": "test",
    "f": "test"
}
```

adding this app.config["JSON_SORT_KEYS"] = False   will not follow my desire output
```
 {
    "h": "test",
    "b": "test",
    "f": "test",
    "a": "test"
}
```

removing that it will sort ...
```
 {
    "a": "test",
    "b": "test",
    "f": "test",
    "h": "test"
}
```
i just want like JSON.stringify output ... preserving its order..

You published 0.12.2 to PyPI but didn't tag a git release.
Based on [Django's behavior](https://github.com/django/django/blob/1ce04bcce0076360623ae164afd3541a5c031af2/django/contrib/sessions/middleware.py#L45), order is delete cookie if empty, append vary header if accessed, set cookie if modified.

continues #1026
The test suite is a bit of a mess as far as how each test sets up an app context, request context, etc.

It'd be nice to DRY this up using pytest fixtures.

Benefits:
1. More readable tests.
2. Tests are easier to write.
3. Tests are easier to refactor.
3. Tests are more robust because it's easier to run a test with multiple parameters.

This is a large project, but easy to tackle incrementally. Perhaps it should be broken into multiple issues, as each section of tests requires some specific fixtures, for example `jsonify()` tests require some specific `json` setup.

Related: #2286 


The testing docs still talk about unittest. We need to update these with modern patterns using PyTest and fixtures.
We should make sure we're providing good, thorough security defaults, or at least documentation on the available options. Not sure if this fits better as Flask config, Werkzeug middleware, or a separate Flask-HTTP-Security extension.

Overview of HTTP security headers: https://blog.appcanary.com/2017/http-security-headers.html
Django's security options: https://docs.djangoproject.com/en/1.11/topics/security/ (some things, such as CSRF and SQL are handled by other libraries, not Flask)

As a first step, good for beginners, it would be nice to get a writeup here of what's already covered and what's not.
Python on Windows supports mixed `/` and `\` separators, so this doesn't break anything. `/` is already assumed to be the safe separator anyway.

fixes #2033, closes #2059
Hi,

I am getting a segmentation fault when running the flask development server on Alpine Linux. Oddly, this issue only appears to occur when I install a recent version of the `requests` library (>= v2.13.0). In addition, this issue occurs even if my application is not using or importing the `requests` lib.

**Environment:**
- `python:3.6-alpine` Docker image
- Python 3.6.1
- Flask 0.12
- Werkzeug 0.12.1

**Commands ran:**

```
/app # flask run
 * Serving Flask app "service"
 * Forcing debug mode on
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 960-427-520


/app # pip install requests==2.12.5
...
Successfully installed requests-2.12.5
/app # flask run
 * Serving Flask app "service"
 * Forcing debug mode on
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 960-427-520


/app # pip install requests==2.13.0
...
Successfully installed requests-2.13.0
/app # flask run
 * Serving Flask app "service"
 * Forcing debug mode on
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
Segmentation fault
/app #  * Debugger is active!
 * Debugger PIN: 960-427-520
```

Thanks in advance
* Show a warning when the domain is dropped because the domain does not contain a `.`, for example for `localhost`.
* Show a warning when the domain is an IP address.
* Allow IP addresses in Chrome by not prepending `.`.
* Cache result of `SERVER_NAME` detection in `SESSION_COOKIE_DOMAIN` so it won't run every request (at least within a given process).

Continues #2105.
PowerShell's syntax is different than CMD's.

    $env:FLASK_APP = "hello.py"
    $env:FLASK_DEBUG = "1"
    flask run
Hi,

It seems that it is not possible to add HTTP headers to static files. Using this [link](http://stackoverflow.com/questions/30717152/python-flask-how-to-set-response-header-for-all-responses) as reference, it was only able to modify headers for routes (not static files). 

Remove doc about writing `after_this_request`, following up on #1965.

Hi, I'm a tech writer and I edited a portion of the quickstart as a homework assignment. Maybe you'll find some of these edits useful. I'm happy to adjust/correct my changes.

Changes:

- Edited the entire section for clarity and concision. I rewrote sentences to make them shorter and easier to understand.
- Added a code sample to show the path converter type
- Removed the HTTP method overview. Although it was well written, the overview wasn't necessary in the quickstart. Readers can easily find an overview elsewhere.

Fix some import order 
```python
import re

import json
import time
import mapi
import sys
from flask import Flask, request, abort, render_template

app = Flask(__name__)

@app.route('/cityinfo', methods=['GET'])
def cityinfo():
    if request.method == 'GET':
        echo_str = request.args.get('echostr', '')
        try:
            key = request.headers.get('location')
        except:
            return ''
        return mapi.getcity(key) #about use 10~59ms


@app.route('/alive', methods=['GET'])
def alive():
    return 'ok'
if __name__ == '__main__':
    crt = 'key/Nginx/1_bg.xxxx.club_bundle.crt'
    key = 'key/Nginx/2_bg.xxxx.club.key'
    try:
        app.run('0.0.0.0',port=443,threaded=True,ssl_context=(crt,key))
    except:
        print 'error'`
```

    nohup sudo python as.py >1.log 2>&1 &


about run in 1000+/day for wechatapp ,then it down by CLOSE_WAIT
When `app.config['DEBUG] = True`, `request.input_stream` object has `__enter__` and `__exit__` methods which is cool because we can use it with `with` clause.

When not in debug mode though, using `input_stream` object with `with` clause causes an `AttributeError: __exit__` to be thrown.

I am using `request.input_stream` object in a flask-restplus end-point to retrieve a file whose size is larger than RAM. I also realized that this stream object will not be there if the file size is small.

python version = 2.7.12
Pins Werkzeug to 0.16.1 due to breaking change in 1.0.0 release
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
A new major release of Werkzeug is available as of yesterday. https://pypi.org/project/Werkzeug/1.0.0/

This is not compatible with flask_admin and flask_wtf:

`  File "/home/airflow/miniconda/envs/conda_env/lib/python3.6/site-packages/flask_admin/model/base.py", line 8, in <module>
    from werkzeug import secure_filename
ImportError: cannot import name 'secure_filename'`

Pinning Werkzeug to version 0.16.1 should solve the issue. https://github.com/pallets/flask/blob/master/setup.py#L56

Flask Version: 1.0.4
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



I am using flask-marshmallow for user input validation .

```python
from marshmallow import Schema, fields, validate


class UserSchema(Schema):
    username = fields.String(required=True,
                            validate=[validate.Length(min=1, error="Field should not be empty.")])
    pincode = fields.Integer(required=True, validate=validate.Range(
        min=0, error="pincode is invalid, it should be a positive integer."))
```
```
class UserDetails(Resource):
    user_schema_obj = UserSchema()
    def post(self):
        if not request.is_json:
            return make_response(jsonify(error_dict(
                current_request_id(), "Unsupported media type, Requests must be JSON",
                415)), status.HTTP_415_UNSUPPORTED_MEDIA_TYPE)

        if not request.json:
            return make_response(jsonify(error_dict(
                current_request_id(), "Required parameter not found",
                400)), status.HTTP_400_BAD_REQUEST)
        request_jsn = UserDetails.user_schema_obj.load(request.get_json())
        username = request_jsn['username']
        pincode = request_jsn['pincode']
```
This is the way i am feeding user input to marshmallow schema . when i am doing app scan it saying ```gets user input from element **get_json**. This element’s value flows through the code without being properly sanitized or validated and is eventually stored in the server-side Session object, in post ```.
This constitutes a Trust Boundary Violation. 
Dont know how to resolve this ? 

### Environment

* Python version:3.7.4
* Flask version:1.1.1
* Werkzeug version:0.16.0

### Expected Behavior
<!-- Tell us what should happen. -->
A normal python script with the starter code, wont run. I think that it's the library that causes the error.

Script:
```python
from flask import Flask

app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello, World!'

if __name__ == "__main__":
	app.run(host="0.0.0.0", port=8080, debug=True)
```

### Actual Behavior
<!-- Tell us what happens instead. -->
It crashed with this traceback
```pytb
Exception in thread Thread-1:
Traceback (most recent call last):
  File "C:\Users\fredr\AppData\Local\Programs\Python\Python37-32\lib\threading.py", line 926, in _bootstrap_inner
    self.run()
  File "C:\Users\fredr\AppData\Local\Programs\Python\Python37-32\lib\threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
  File "C:\Users\fredr\AppData\Local\Programs\Python\Python37-32\lib\site-packages\werkzeug\serving.py", line 963, in inner
    fd=fd,
  File "C:\Users\fredr\AppData\Local\Programs\Python\Python37-32\lib\site-packages\werkzeug\serving.py", line 806, in make_server
    host, port, app, request_handler, passthrough_errors, ssl_context, fd=fd
  File "C:\Users\fredr\AppData\Local\Programs\Python\Python37-32\lib\site-packages\werkzeug\serving.py", line 699, in __init__
    HTTPServer.__init__(self, server_address, handler)
  File "C:\Users\fredr\AppData\Local\Programs\Python\Python37-32\lib\socketserver.py", line 452, in __init__
    self.server_bind()
  File "C:\Users\fredr\AppData\Local\Programs\Python\Python37-32\lib\http\server.py", line 139, in server_bind
    self.server_name = socket.getfqdn(host)
  File "C:\Users\fredr\AppData\Local\Programs\Python\Python37-32\lib\socket.py", line 676, in getfqdn
    hostname, aliases, ipaddrs = gethostbyaddr(name)
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xe6 in position 9: invalid continuation byte
```

### Environment

* Python version: Python 3.7.4
* Flask version: 1.1.1
* Werkzeug version: Don't know

I've added additional code that has been presented before in the quickstart but I included the escape module because it's not mentioned before and when you try to run the code without it you get various errors due to the escape methods being used in this part of the tutorial. 

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
<!-- Tell us what should happen. -->

I don't have a concrete example yet, but Werkzeug today released a v1.0.0, and flask only specifies `Werkzeug>=0.15` as the dependency, that means any backware incompatible changes made to v1.0.0 of werkzeug could potentially break things here.

```python
```

### Actual Behavior
<!-- Tell us what happens instead. -->

Things could be breaking

```pytb
```

### Environment

* Python version: 3.6.9
* Flask version: 1.1.1
* Werkzeug version: 1.0.0


If this is alright, then feel free to close this issue
Any fresh installs/updates to flask as of the last few hours crash with an import error
> ImportError: cannot import name 'url_encode' from 'werkzeug' (/Users/me/env/lib/python3.7/site-packages/werkzeug/__init__.py) 

due to a major version change in werkzeug (from 0.16.1 to 1.0.0), as per https://github.com/pallets/werkzeug/issues/1714

The original sentence has incorrect grammar. The change corrects the grammar error and expresses the intended meaning better

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->


<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

This is an obvious typo.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

> `__init__.py`

```
def create_app(test_config=True):

    app = Flask(__name__, instance_relative_config=True)

    app.config.from_object(__name__)

    db = Database(app)

    app.__setattr__('db', db)

    return app
```

-------------------------------------------------

> app.py

```
from flask import current_app
def close_request():
    current_app.__getattr__('db').close()
```

escribe the bug
Import error from scipy package

```
File "/env/lib/python3.7/site-packages/statsmodels/api.py", line 9, in
from . import regression
File "/env/lib/python3.7/site-packages/statsmodels/regression/init.py", line 1, in
from .linear_model import yule_walker
File "/env/lib/python3.7/site-packages/statsmodels/regression/linear_model.py", line 39, in
from scipy.linalg import toeplitz
File "/env/lib/python3.7/site-packages/scipy/init.py", line 156, in
from . import fft
File "/env/lib/python3.7/site-packages/scipy/fft/init.py", line 81, in
from ._helper import next_fast_len
File "/env/lib/python3.7/site-packages/scipy/fft/_helper.py", line 4, in
from . import _pocketfft
File "/env/lib/python3.7/site-packages/scipy/fft/_pocketfft/init.py", line 3, in
from .basic import *
File "/env/lib/python3.7/site-packages/scipy/fft/_pocketfft/basic.py", line 8, in
from . import pypocketfft as pfft
ImportError: SystemExit: 1"
```

*This happens only in Flask. When i use statsmodels

I'm running it in flask and here are my complete list of packages:

```APScheduler==3.3.1
attrs==19.3.0
autopep8==1.5
backcall==0.1.0
bleach==3.1.0
cachetools==4.0.0
cattrs==1.0.0
certifi==2019.11.28
chardet==3.0.4
Click==7.0
cloudstorage==0.10.0
cycler==0.10.0
decorator==4.4.1
defusedxml==0.6.0
entrypoints==0.3
Flask==1.1.1
Flask-Assets==2.0
Flask-CacheBuster==1.0.0
Flask-Cors==3.0.8
Flask-SQLAlchemy==2.4.1
flask-talisman==0.7.0
google-api-core==1.16.0
google-auth==1.11.0
google-cloud==0.34.0
google-cloud-core==1.2.0
google-cloud-storage==1.25.0
google-cloud-tasks==1.3.0
google-resumable-media==0.5.0
googleapis-common-protos==1.51.0
grpc-google-iam-v1==0.12.3
grpcio==1.26.0
idna==2.8
importlib-metadata==1.5.0
inflect==3.0.2
inflection==0.3.1
ipykernel==5.1.4
ipython==7.11.1
ipython-genutils==0.2.0
ipywidgets==7.5.1
itsdangerous==1.1.0
jedi==0.16.0
Jinja2==2.11.0
jsonschema==3.2.0
jupyter==1.0.0
jupyter-client==5.3.4
jupyter-console==6.1.0
jupyter-contrib-core==0.3.3
jupyter-contrib-nbextensions==0.5.1
jupyter-core==4.6.1
jupyter-highlight-selected-word==0.2.0
jupyter-latex-envs==1.4.6
jupyter-nbextensions-configurator==0.4.1
kiwisolver==1.1.0
looker-sdk==0.1.3b6
lxml==4.5.0
MarkupSafe==1.1.1
matplotlib==3.1.2
mistune==0.8.4
natural==0.2.0
nbconvert==5.6.1
nbformat==5.0.4
nltk==3.4.5
notebook==6.0.3
numpy==1.18.1
pandas==0.25.3
pandas-datareader==0.8.1
pandocfilters==1.4.2
parso==0.6.0
patsy==0.5.1
pexpect==4.8.0
pg8000==1.13.2
pickleshare==0.7.5
prometheus-client==0.7.1
prompt-toolkit==3.0.3
protobuf==3.11.2
psycopg2==2.8.4
ptyprocess==0.6.0
pyasn1==0.4.8
pyasn1-modules==0.2.8
pycodestyle==2.5.0
Pygments==2.5.2
pyparsing==2.4.6
pyrsistent==0.15.7
python-dateutil==2.8.1
python-magic==0.4.15
pytz==2019.3
PyYAML==5.3
pyzmq==18.1.1
qtconsole==4.6.0
requests==2.22.0
rsa==4.0
scipy==1.4.1
scramp==1.1.0
seasonal==0.3.1
Send2Trash==1.5.0
simple-salesforce==0.74.3
simplenlg==0.2.0
six==1.14.0
SQLAlchemy==1.3.13
statsmodels==0.11.0
stripe==2.42.0
terminado==0.8.3
testpath==0.4.4
tornado==6.0.3
traitlets==4.3.3
tzlocal==2.0.0
urllib3==1.25.8
wcwidth==0.1.8
webapp2==2.5.2
webassets==2.0
webencodings==0.5.1
Werkzeug==0.16.1
widgetsnbextension==3.5.1
zipp==2.1.0```

no error in ipython, but i get an error when i run it in flask



Hi,

This project is abandoned?

There is any roadmap?

Or it is stable?

Thanks.
I would like `url_for` to support some sort of proxy rewrite rule when the Flask app is behind a proxy that does more than just append a prefix to the url.

I'm aware of the werkzeug ProxyFix middleware that uses the `X-Forwarded-Prefix` to set the `SCRIPT_NAME` environ variable, which `url_for` appends to the url. But when the proxy does more that just append a prefix, and does some rewriting, I can't figure out how to get `url_for` to just work.

I have a stack overflow questions [here](https://stackoverflow.com/q/59862542/2233608) with some more details.
`flask.escape` used in [Variable Rule](https://flask.palletsprojects.com/en/1.1.x/quickstart/#variable-rules) section but doesn't import, this PR will add the missing import statement.

Fix #3471 
Intersphinx doesn't build document for my projects, due to missing https://flask.palletsprojects.com/objects.inv on the documentation site.

My current config:

```
intersphinx_mapping = {
    "flask": ("https://flask.palletsprojects.com/", None),
}
```

The error messages:

```
intersphinx inventory 'https://flask.palletsprojects.com/objects.inv' not fetchable due to <class 'requests.exceptions.HTTPError'>: 404 Client Error: Not Found for url: https://flask.palletsprojects.com/objects.inv
```


from flask import Flask, escape
@app.route('/user/<username>')
def show_user_profile(username):
    # show the user profile for that user
    return 'User %s' % escape(username)

@app.route('/post/<int:post_id>')
def show_post(post_id):
    # show the post with the given id, the id is an integer
    return 'Post %d' % post_id

@app.route('/path/<path:subpath>')
def show_subpath(subpath):
    # show the subpath after /path/
    return 'Subpath %s' % escape(subpath)
### Expected Behavior

Missing templates should raise a `TemplateNotFound` exception with the correct template name.

### Actual Behavior

The top-level template is used as the error string even when it is not the template that failed.

There appears to be an issue in Flask's `DispatchingJinjaLoader`. If a template called `parent.html` fails to find a sub-template such as `{% extends child.html %}`, the exception that is raised will be `TemplateNotFound('parent.html')` instead of the correct `TemplateNotFound('child.html')`. This will almost certainly confuse an end user.

This appears to be because https://github.com/pallets/flask/blob/1351d0a56580df36872b466eb245e7634c20dab5/src/flask/templating.py#L83 does not properly float up missing templates errors. If it fails to find *any* matching template it raises the name of whatever template was first passed to `render_template`.

### Environment

* Python version: all
* Flask version: all
* Werkzeug version: all

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
<!-- Tell us what should happen. -->
I should be able to set `SESSION_COOKIE_SAMESITE` to "None" in order to explicitly set `SameSite=None` on my session cookie.

This will allow my flask application to be loaded in an iframe with the session.

```python
app.config['SESSION_COOKIE_SAMESITE'] = "None"
```

### Actual Behavior
<!-- Tell us what happens instead. -->
Today I can only set `SESSION_COOKIE_SAMESITE` to "Strict", "Lax", or `None`.

If set to `None`, it will actually _not_ set a SameSite attribute at all on the session cookie, which Chrome will treat as `SameSite=Lax` [starting in Chrome 80](https://web.dev/samesite-cookies-explained/).

I need to be able to set SESSION_COOKIE_SAMESITE to explicitly "None", thus causing `SameSite=None` to be set on the cookie, which in turn allows the cookie to be sent in cross-origin requests, such as when my flask application is loaded in an iframe.

As it is, these applications load in an iframe without a session cookie, which breaks their functionality.

### Environment

* Python version: 3.7.4
* Flask version: 1.1.1
* Werkzeug version: 0.16.0

Note related Werkzeug issue which is tied up with the 1.0 release: https://github.com/pallets/werkzeug/issues/1549


```pytb
2020-01-14T20:33:48.807523+00:00 app[web.1]: Traceback (most recent call last):
2020-01-14T20:33:48.807525+00:00 app[web.1]: File "/app/.heroku/python/lib/python3.7/site-packages/gunicorn/workers/sync.py", line 135, in handle
2020-01-14T20:33:48.807528+00:00 app[web.1]: self.handle_request(listener, req, client, addr)
2020-01-14T20:33:48.807530+00:00 app[web.1]: File "/app/.heroku/python/lib/python3.7/site-packages/gunicorn/workers/sync.py", line 176, in handle_request
2020-01-14T20:33:48.807534+00:00 app[web.1]: respiter = self.wsgi(environ, resp.start_response)
2020-01-14T20:33:48.807536+00:00 app[web.1]: File "/app/.heroku/python/lib/python3.7/site-packages/flask/app.py", line 2463, in __call__
2020-01-14T20:33:48.807538+00:00 app[web.1]: return self.wsgi_app(environ, start_response)
2020-01-14T20:33:48.807540+00:00 app[web.1]: File "/app/.heroku/python/lib/python3.7/site-packages/flask/app.py", line 2449, in wsgi_app
2020-01-14T20:33:48.807542+00:00 app[web.1]: response = self.handle_exception(e)
2020-01-14T20:33:48.807544+00:00 app[web.1]: File "/app/.heroku/python/lib/python3.7/site-packages/flask/app.py", line 1866, in handle_exception
2020-01-14T20:33:48.807546+00:00 app[web.1]: reraise(exc_type, exc_value, tb)
2020-01-14T20:33:48.807548+00:00 app[web.1]: File "/app/.heroku/python/lib/python3.7/site-packages/flask/_compat.py", line 39, in reraise
2020-01-14T20:33:48.807549+00:00 app[web.1]: raise value
2020-01-14T20:33:48.807551+00:00 app[web.1]: File "/app/.heroku/python/lib/python3.7/site-packages/flask/app.py", line 2446, in wsgi_app
2020-01-14T20:33:48.807553+00:00 app[web.1]: response = self.full_dispatch_request()
2020-01-14T20:33:48.807554+00:00 app[web.1]: File "/app/.heroku/python/lib/python3.7/site-packages/flask/app.py", line 1952, in full_dispatch_request
2020-01-14T20:33:48.807556+00:00 app[web.1]: return self.finalize_request(rv)
2020-01-14T20:33:48.807557+00:00 app[web.1]: File "/app/.heroku/python/lib/python3.7/site-packages/flask/app.py", line 1969, in finalize_request
2020-01-14T20:33:48.807559+00:00 app[web.1]: response = self.process_response(response)
2020-01-14T20:33:48.807560+00:00 app[web.1]: File "/app/.heroku/python/lib/python3.7/site-packages/flask/app.py", line 2268, in process_response
2020-01-14T20:33:48.807562+00:00 app[web.1]: self.session_interface.save_session(self, ctx.session, response)
2020-01-14T20:33:48.807563+00:00 app[web.1]: File "/app/.heroku/python/lib/python3.7/site-packages/flask/sessions.py", line 387, in save_session
2020-01-14T20:33:48.807565+00:00 app[web.1]: samesite=samesite,
2020-01-14T20:33:48.807567+00:00 app[web.1]: File "/app/.heroku/python/lib/python3.7/site-packages/werkzeug/wrappers/base_response.py", line 481, in set_cookie
2020-01-14T20:33:48.807568+00:00 app[web.1]: samesite=samesite,
2020-01-14T20:33:48.807570+00:00 app[web.1]: File "/app/.heroku/python/lib/python3.7/site-packages/werkzeug/http.py", line 1161, in dump_cookie
2020-01-14T20:33:48.807571+00:00 app[web.1]: raise ValueError("invalid SameSite value; must be 'Strict', 'Lax' or None")
2020-01-14T20:33:48.807573+00:00 app[web.1]: ValueError: invalid SameSite value; must be 'Strict', 'Lax' or None```
before_request
addr：/
method：GET
---headers--start--
Host: localhost:5000
Connection: keep-alive
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML,
like Gecko) Chrome/72.0.3626.119 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/a
png,*/*;q=0.8
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
---headers--end----
GET args：ImmutableMultiDict([])
POST args：ImmutableMultiDict([])
[2020-01-14 10:16:30,833] ERROR in app: Exception on / [GET]
Traceback (most recent call last):
  File "c:\python37\lib\site-packages\flask\app.py", line 2446, in wsgi_app
    response = self.full_dispatch_request()
  File "c:\python37\lib\site-packages\flask\app.py", line 1952, in full_dispatch
_request
    return self.finalize_request(rv)
  File "c:\python37\lib\site-packages\flask\app.py", line 1969, in finalize_requ
est
    response = self.process_response(response)
  File "c:\python37\lib\site-packages\flask\app.py", line 2266, in process_respo
nse
    response = handler(response)
TypeError: after_request() takes 0 positional arguments but 1 was given
[2020-01-14 10:16:30,834] ERROR in app: Request finalizing failed with an error
while handling an error
Traceback (most recent call last):
  File "c:\python37\lib\site-packages\flask\app.py", line 2446, in wsgi_app
    response = self.full_dispatch_request()
  File "c:\python37\lib\site-packages\flask\app.py", line 1952, in full_dispatch
_request
    return self.finalize_request(rv)
  File "c:\python37\lib\site-packages\flask\app.py", line 1969, in finalize_requ
est
    response = self.process_response(response)
  File "c:\python37\lib\site-packages\flask\app.py", line 2266, in process_respo
nse
    response = handler(response)
TypeError: after_request() takes 0 positional arguments but 1 was given

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "c:\python37\lib\site-packages\flask\app.py", line 1969, in finalize_requ
est
    response = self.process_response(response)
  File "c:\python37\lib\site-packages\flask\app.py", line 2266, in process_respo
nse
    response = handler(response)
TypeError: after_request() takes 0 positional arguments but 1 was given
127.0.0.1 - - [14/Jan/2020 10:16:30] "GET / HTTP/1.1" 500 -
update version

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
<!-- Tell us what should happen. -->

I was working on the *auth blueprint* part of the tutorial. When I tested the `login()` function under the debug mode, with inputing correct pair of username/passowrd, it should've thrown `werkzeug.routing.BuildError: Could not build url for endpoint 'index'.`.

```python
# flaskr/auth.py
@bp.route('/login', methods=('GET', 'POST'))
def login():
    if request.method == 'POST':
        username = request.form['username']
        password = request.form['password']
        db = get_db()
        err = None
        # ...

        if err is None:
            session.clear()
            session['user_id'] = user['id']
            return redirect(url_for('index'))
        # ...

# flaskr/__init__.py
def create_app(test_config=None):
    """Instead of creating an app (instance of `Flask` globally),
    loading configurations and other setups inside `create_app`.
    """
    app = Flask(__name__, instance_relative_config=True)
    app.config.from_mapping(
        SECRECT_KEY='dev',
        DATABASE=os.path.join(app.instance_path, 'flaskr.sqlite'),
    )
    # ...
```

### Actual Behavior
<!-- Tell us what happens instead. -->

However, I got 

```pytb

  File "/.../.venv/lib/python3.7/site-packages/flask/app.py", line 2463, in __call__
    return self.wsgi_app(environ, start_response)
  File "/.../.venv/lib/python3.7/site-packages/flask/app.py", line 2449, in wsgi_app
    response = self.handle_exception(e)
  File "/.../.venv/lib/python3.7/site-packages/flask/app.py", line 1866, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/.../.venv/lib/python3.7/site-packages/flask/_compat.py", line 39, in reraise
    raise value
  File "/.../.venv/lib/python3.7/site-packages/flask/app.py", line 2446, in wsgi_app
    response = self.full_dispatch_request()
  File "/.../.venv/lib/python3.7/site-packages/flask/app.py", line 1951, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/.../.venv/lib/python3.7/site-packages/flask/app.py", line 1820, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/.../.venv/lib/python3.7/site-packages/flask/_compat.py", line 39, in reraise
    raise value
  File "/.../.venv/lib/python3.7/site-packages/flask/app.py", line 1949, in full_dispatch_request
    rv = self.dispatch_request()
  File "/.../.venv/lib/python3.7/site-packages/flask/app.py", line 1935, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/.../pycourse/flaskr_project/flaskr/auth.py", line 73, in login
    session.clear()
  File "/.../.venv/lib/python3.7/site-packages/flask/sessions.py", line 103, in _fail
    "The session is unavailable because no secret "
RuntimeError: The session is unavailable because no secret key was set.  Set the secret_key on the application to something unique and secret.
```

So I checked `SECRET_KEY` and `session`. And I was confused since the secret_key seemed to be set but the session was still null.

```python
<Config {'ENV': 'development', 'DEBUG': True, 'TESTING': False, ..., 'SECRECT_KEY': 'dev', 'DATABASE': '.../instance/flaskr.sqlite'}>

<session> <NullSession {}>
```

I tried to fixed it by using `app.secret_key`.

```python
def create_app(test_config=None):
    """Instead of creating an app (instance of `Flask` globally),
    loading configurations and other setups inside `create_app`.
    """
    app = Flask(__name__, instance_relative_config=True)
    app.config.from_mapping(
        SECRECT_KEY='dev',
        DATABASE=os.path.join(app.instance_path, 'flaskr.sqlite'),
    )
    app.secret_key = 'secret'
    # ...
```

This line didn't change the `SECRET_KEY` in `app.config`. But this time I got the `werkzeug.routing.BuildError`.

### Environment

* Python version: 3.7.2
* Flask version: 1.1.1
* Werkzeug version: 0.16.0
* (Also the tutorial is from) Doc version: 1.1.x

Just like this [old issue](https://github.com/pallets/flask/issues/998) said, routing behavior changed even when `subdomain_matching` defaults to false, so take [this repository](https://github.com/namieluss/python-flask-with-subdomain/blob/master/app.py) as example, if you comment following lines, 

```
@app.before_request
def start():
    """
    init globals and set the schema search path for the current request.
    """
    g.user = session.get('user', None)
    current_url = urlparse(request.url)
    subdomain = current_url.hostname.split('.')

    if subdomain.__len__() > 2:
        """
        redirect to home page
        """
        if current_url.path == "/":
            return redirect(url_for('index'))
        pass
    pass
```

then requests to `user1.flask-subdomain.com` won't route to `index`, default 404 as response. Or am I missing something, as a result have misunderstood it. Thanks very much.

```
@app.route('/')
def index():
    return render_template('index.html')
```

### Environment

* Python version: 3.6
* Flask version: 1.1.1
* Werkzeug version: 0.16.0
I want to simply response with a cookie to a client. But I get a strange error from: <br>`/usr/local/lib/python3.6/dist-packages/werkzeug/wrappers/base_response.py`.

Error log here: https://pastebin.com/XjqFt7tW

    response = jsonify(filterData)
    response.headers = api_response['headers']
    response.set_cookie('name', 'value')
    return response


`filterData` is a simple `dict`


Python 3.6.9
Flask 1.1.1
Werkzeug 0.16.0
I have a python(2.7) flask(0.10.1) app running and configured celery(3.1.25) along with it in the following way

**tasks.py**
```
from celery import Celery
broker_urls = [
    'amqp://my_user:passwd@rabbit-host-1:5672//',
    'amqp://my_user:passwd@rabbit-host-2:5672//',
    'amqp://my_user:passwd@rabbit-host-3:5672//',
]
celery = Celery('tasks', broker=broker_urls)
celery.conf.BROKER_FAILOVER_STRATEGY = "round-robin"

@celery.task
def add(x, y):
    return x + y
```
**app.py**
```
from gevent.wsgi import WSGIServer
from flask import Flask

app = Flask("testapp")
http_server = WSGIServer(('',8000), app)
http_server.serve_forever()


```

**urls.py**
```
from flask import Blueprint

api = Blueprint('api',__name__)

@api.route("/")
def index_api():
    add(10,20)
```

I run the application as `python app.py`,
When I run the flask application if `rabbit-host-1` is down it is picking up the next live broker
`rabbit-host-2` and working fine. But if `rabbit-host-1` is down after I started my app I think it is still connected to `rabbit-host-1` and things are not working even `rabbit-host-2` and `rabbit-host-3` are alive.

But the celery worker was able to failover immediately when any of the brokers are down, by using given `round-robin` fashion.

`celery worker --app=tasks`


Have I missed something to configure properly which is causing failover not to work with flask? 
This PR removes the comment in the foreword that tells Flask extensions are reviewed by Flask maintainers

update version

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

It's confusing when not adding the `static_url_path` to `Flask` Class.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Consider the following blueprint file:

```python
from flask import Blueprint

bp = Blueprint('bp', __name__)


@book.route('/')
def bp():
    return "hello"
```

When one tries to register `bp` from this file like so:
```python
from app.bp import bp
app.register_blueprint(bp)
```

This error is raised:

```
AttributeError: 'function' object has no attribute 'name'
```

The cause is obvious, but the error message does not correspond with the actual error. This could be fixed by checking if an added blueprint is of type `Blueprint`, or a subclass, and returning an error if that's not the case.
Fix app.run() when port is not specified and `SERVER_NAME` contains only host name
Fixes #3457

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->


### Expected Behavior
app.run() should work when port is not specified in `SERVER_NAME`.

```python
from flask import Flask

app = Flask(__name__)
app.config['SERVER_NAME'] = 'example.com'

@app.route('/')
def hello_world():
    return 'Hello, World!'

app.run()
```

### Actual Behavior
```
application fails during start
```

```pytb
Traceback (most recent call last):
  File "mini_svr_2.py", line 10, in <module>
    app.run()
  File "/Users/rickwang/Source/flask/src/flask/app.py", line 973, in run
    port = int(next((p for p in (port, sn_port) if p is not None), _port))
ValueError: invalid literal for int() with base 10: '
```

### Environment

* Python version: Python 3.7
* Flask version: latest 1.1.2.dev0
* Werkzeug version: 0.16.0

Fixes #3452

Strip the ending slash when passed to `os.path.basename`, so that the last part can be used for static url path correctly.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

I accidentally deleted my virtualenv that I had generated a few weeks ago. I tried to reinstall my dependencies and now I get an error on startup when before it would work fine. Using `.env/bin/uwsgi --http :9800 --file ./wsgi.py --callable app` also breaks with the same traceback. This was after I noticed a vulnerability was in the Werkzeug module of GitHub but hadn't reinstalled a new version. Can't seem to find a working version setup now.

I'm able to run `from werkzeug.wrapper.json import JSONmixin` in the interpreter without failure.

### Expected Behavior
`flask run` should run my application. 

### Actual Behavior
`flask run` returns an import error with werkzeug for JSONmixin. Below is the traceback:

```pytb
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.6/bin/flask", line 6, in <module>
    from flask.cli import main
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/flask/__init__.py", line 21, in <module>
    from .app import Flask
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/flask/app.py", line 69, in <module>
    from .wrappers import Request
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/flask/wrappers.py", line 14, in <module>
    from werkzeug.wrappers.json import JSONMixin as _JSONMixin
ModuleNotFoundError: No module named 'werkzeug.wrappers.json'; 'werkzeug.wrappers' is not a package
```

### Environment

* Python version: 3.6.8
* Flask version: 1.1.1
* Werkzeug version: 0.16.0

### Expected Behavior
In Python 3.7.5, this works just fine and does nothing:

```python
from unittest.mock import patch
import flask

@patch("flask.request")
def foo(patched_request):
    pass

foo()
```

### Actual Behavior
In Python 3.8.0, it fails with

```
RuntimeError: Working outside of request context.
```
This happens because `patch` now tries to return an AsyncMock in some cases and Python's [mock.py line 51](https://github.com/python/cpython/blob/4594565b56e9c99d2d3fb7549041bbca5ecba8e2/Lib/unittest/mock.py#L51) calls asyncio.iscoroutinefunction() on flask.request. This will then call `getattr(func, '_is_coroutine', None)` in [coroutines.py line 167](https://github.com/python/cpython/blob/4594565b56e9c99d2d3fb7549041bbca5ecba8e2/Lib/asyncio/coroutines.py#L167) which flask then complains about.

It might be fixable by adding a special case to raise AttributeError instead when the `_is_coroutine` attribute is accessed.

### Environment

* Python version: 3.8.0
* Flask version: 1.1.1 and git master
* Werkzeug version: 0.16.0 and git master

Hi!

This fixes a docstring and remove redundant parentheses, if you want me to submit as separated PR or you need me to do something else just let me know.

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

I am trying to serve a React app with Flask. The React app uses React Router which means some routes should simply be handled by React. To achieve this one can usually use a catch-all route that returns the index.html. I first couldn't get the catch-all route to work at all, and then I got it working by removing the trailing slash for the `static_folder` parameter when calling Flask.

### Expected Behavior
When one enter a path with trailing forward slash in the `static_folder` parameter for flask.Flask() it shouldn't affect whether a catch-all route goes into effect or not.

In the below code remove the trailing slash for the `static_folder` and you are able to reach the catch-all route (home function) by entering a random route like `/something`.

```python
from flask import Flask, render_template

app = Flask(__name__, static_folder="frontend/build/", template_folder="frontend/build")

@app.route("/")
def route1():
    return "route1"


@app.route("/<path:path>")
def home(path):
    return "routeAny"
```

### Actual Behavior
Steps to reproduce
1. Run the above flask app
2. Open browser and verify that it renders the text "route1" for route `/`
3. Browse to `/something` and see that you get 404 Not Found.

### Environment

* Python version: 3.7.
* Flask version: 1.1.1
* Werkzeug version: 0.16.0

I have a testing fixture to make a test client in my flask app:
```python
@pytest.fixture(scope='session') 
def test_client():
	""" Create the application and the test client. 
	"""
	print('----------Setup test client----------')
	app = create_app(config_class=config.TestConfig)
	testing_client = app.test_client()

	ctx = app.test_request_context() 
	ctx.push()
	yield testing_client # this is where the testing happens
	print('-------Teardown test client--------')
	ctx.pop()
```

I would like to add a header for "User-Agent" to this test request context because in my application I check the browser of the user. I am retrieving the browser name in my app via
```python
user_agent = flask.request.user_agent.browser
```
This line returns None if I use the test client above. While I can successfully set the 'User-Agent' header in individual requests within a single test, e.g.:
```python
user_agent_str = 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36'

response = test_client.get('/some_flask_route',
		environ_base={'HTTP_USER_AGENT': user_agent_str},
		follow_redirects=True)
```
After doing this:
`flask.request.user_agent.browser` 
returns 'chrome' as expected.

However, this is very redundant because it requires me to insert the environ_base line of code into every single one of my many tests. 

### Expected Behavior
<!-- Tell us what should happen. -->
I would expect that I could set the header when I make the test request context in my test fixture, e.g.:

```python
user_agent_str = 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36'

@pytest.fixture(scope='session') 
def test_client():
	""" Create the application and the test client. 
	"""
	print('----------Setup test client----------')
	app = create_app(config_class=config.TestConfig)
	testing_client = app.test_client()
	ctx = app.test_request_context(environ_base={'HTTP_USER_AGENT': user_agent_str}) 
	ctx.push()
	yield testing_client # this is where the testing happens
	print('-------Teardown test client--------')
	ctx.pop()
```
and this would set the environment for all requests, eliminating the need to set environ_base in every one of my requests.

### Actual Behavior
While adding environ_base into test_request_context() does not break the fixture, it does not set the 'User-Agent' header and 
```python
flask.request.user_agent.browser
```
returns None.


### Environment

* Python version: 3.7.3
* Flask version: 1.1.1
* Werkzeug version: 0.15.4

I have tried the solution suggested in the question here: https://stackoverflow.com/questions/15278285/setting-mocking-request-headers-for-flask-app-unit-test

but it does nothing. I am simply running the flask server on localhost with no deployment yet, i.e. essentially just:
```python
app = Flask(__name__)
app.run(host='127.0.0.1',port=5000,debug=True)
```

Is there a way to enable Jinja's LINE_STATEMENT_PREFIX option from inside of Flask?
I'm currently using this ugly hacky way:

```python
def customRender(file, **kwargs):
    env = jinja2.Environment(loader=jinja2.FileSystemLoader(searchpath="./templates"), line_statement_prefix='#')
    template = env.get_template(file)
    return template.render(kwargs)
```

* Python version: 3.7.4
* Flask version: 1.1.1
* Werkzeug version: 0.16.0

### Expected Behavior
PyCharm shouldn't highlight the line as an warning

```python
from flask import Flask

app = Flask(__name__)

@app.router("/")
def index():
    resp = redirect("")
    resp.set_cookie("key", "val", samesite='strict')
```

### Actual Behavior
![image](https://user-images.githubusercontent.com/30751516/71026964-9451cd80-210a-11ea-9e8c-55c11d8dff79.png)

### Environment

* Python version: 3.7.5
* Flask version: 1.1.1
* Werkzeug version: 0.16.0

This is a minimised version of an issue I ran into on a larger project. This is possibly working-as-designed, but it seemed odd, so I figured I'd report it here just in case.

Consider the following app:

```python
from flask import Flask, request

app = Flask(__name__)


@app.route("/")
def index():
    return """
    <html>
      <form action="/explode" method="post">
        <input name="text">
        <button type="submit">BOOM!</button>
      </form>
    </html>
    """


@app.route("/explode", methods=["POST"])
def explode():
    assert 0


app.run(debug=True)
```

You run this app, the user is presented with a single text field. They enter some text, click "submit", and the AssertionError causes a server error to be thrown. You're dropped into the Werkzeug console.

I open the interactive debugging console, type `request.data`, and a stack trace immediately pours all over the screen:

```
[console ready]
>>> request.data
Traceback (most recent call last):
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/wsgi.py", line 939, in read
    read = self._read(to_read)

During handling of the above exception, another exception occurred:
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/formparser.py", line 131, in wrapper
    return f(self, stream, *args, **kwargs)
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/formparser.py", line 264, in _parse_urlencoded
    form = url_decode_stream(stream, self.charset, errors=self.errors, cls=self.cls)
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/urls.py", line 893, in url_decode_stream
    return cls(decoder)
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/datastructures.py", line 420, in __init__
    for key, value in mapping or ():
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/urls.py", line 897, in _url_decode_impl
    for pair in pair_iter:
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/wsgi.py", line 801, in make_chunk_iter
    first_item = next(_iter, "")
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/wsgi.py", line 681, in _make_chunk_iter
    item = _read(buffer_size)
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/wsgi.py", line 941, in read
    return self.on_disconnect()
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/wsgi.py", line 911, in on_disconnect
    raise ClientDisconnected()

During handling of the above exception, another exception occurred:
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/wsgi.py", line 939, in read
    read = self._read(to_read)

During handling of the above exception, another exception occurred:
  File "<debugger>", line 1, in <module>
    request.data
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/local.py", line 348, in __getattr__
    return getattr(self._get_current_object(), name)
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/utils.py", line 90, in __get__
    value = self.func(obj)
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/wrappers/base_request.py", line 425, in data
    return self.get_data(parse_form_data=True)
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/wrappers/base_request.py", line 455, in get_data
    self._load_form_data()
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/flask/wrappers.py", line 88, in _load_form_data
    RequestBase._load_form_data(self)
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/wrappers/base_request.py", line 318, in _load_form_data
    self._get_stream_for_parsing(), mimetype, content_length, options
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/formparser.py", line 232, in parse
    return parse_func(self, stream, mimetype, content_length, options)
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/formparser.py", line 135, in wrapper
    exhaust()
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/wsgi.py", line 925, in exhaust
    self.read(chunk)
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/wsgi.py", line 941, in read
    return self.on_disconnect()
  File "/Users/alexwlchan/.virtualenvs/tempenv-388f210986880/lib/python3.7/site-packages/werkzeug/wsgi.py", line 911, in on_disconnect
    raise ClientDisconnected()
werkzeug.exceptions.ClientDisconnected: 400 Bad Request: The browser (or proxy) sent a request that this server could not understand.

>>> 
```

If we modify the `explode()` method to print the value of `request.data` before throwing, like so:

```python
@app.route("/explode", methods=["POST"])
def explode():
    print(request.data)
    assert 0
```

then looking up `request.data` in the console works correctly. (In this case, it prints `b''`.)

Same request, different server code – which makes me think “the browser (or proxy) sent a request that this server could not understand” wasn’t actually the underlying issue, because it could parse the (empty) request body just fine before it had thrown.

### Environment

* Python version: 3.7.5
* Flask version: 1.1.1
* Werkzeug version: 0.16.0
### Expected Behavior
Flask app should start normally. Im not sure where stdout/stderr go when running as a Windows service, but it should not crash.

Example service wrapper

```python
import servicemanager
import socket
import sys
import win32event
import win32service
import win32serviceutil
import os

class Service(win32serviceutil.ServiceFramework):
    _svc_name_ = "Name"
    _svc_display_name_ = "Display Name"
    _svc_description_ = "Description"

    def __init__(self, args):
        win32serviceutil.ServiceFramework.__init__(self, args)
        self.hWaitStop = win32event.CreateEvent(None, 0, 0, None)
        socket.setdefaulttimeout(60)

    def SvcStop(self):
        self.ReportServiceStatus(win32service.SERVICE_STOP_PENDING)
        win32event.SetEvent(self.hWaitStop)
        self.ReportServiceStatus(win32service.SERVICE_STOPPED)

    def SvcDoRun(self):
        os.chdir(os.path.dirname(__file__))
        from . import __main__
        __main__.app.run(port=8080, host="0.0.0.0")

if __name__ == "__main__":
    if len(sys.argv) == 1:
        servicemanager.Initialize()
        servicemanager.PrepareToHostSingle(Service)
        servicemanager.StartServiceCtrlDispatcher()
    else:
        win32serviceutil.HandleCommandLine(Service)
```

`__main__` just contains a basic flask app.

This might be a problem with `click` or `pywin32`.
I am using the below monkey patch in `__main__` to avoid this issue. It would be nice if I didnt have to do this or there was a better workaround (or even a fix!).

```python
# Stops app from crashing when started as a service
flask.cli.show_server_banner = lambda *args: None
```

### Actual Behavior

Actual stack trace

```pytb
Traceback (most recent call last):
  File "C:\test\ui.py", line 31, in SvcDoRun
    __main__.main(port=8080, host="0.0.0.0")
  File "C:\test\ui\__main__.py", line 28, in SvcDoRun
    app.run(**args)
  File "C:\Users\User\AppData\Local\Programs\Python\Python37\lib\site-packages\flask\app.py", line 938, in run
    cli.show_server_banner(self.env, self.debug, self.name, False)
  File "C:\Users\User\AppData\Local\Programs\Python\Python37\lib\site-packages\flask\cli.py", line 629, in show_server_banner
    click.echo(message)
  File "C:\Users\User\AppData\Local\Programs\Python\Python37\lib\site-packages\click\utils.py", line 260, in echo
    file.write(message)
AttributeError: 'NoneType' object has no attribute 'write'
```

### Environment

* Python version: 3.7
* Flask version: 1.02
* Werkzeug version: 0.14.1
* Related Issue: https://github.com/top2topii/FlaskServiceWin32/issues/1

Factors is a very useful function, which is used to generate flask with different configuration files in different environments

Look at the example, it is well integrated with flask SQL alchemy

Flask Sqlalchemy only needs db.init app (APP)



Sqlalchemy needs more information to set up

engine = create_engine('sqlite:////tmp/test.db', convert_unicode=True)

db_session = scoped_session(sessionmaker(autocommit=False,autoflush=False,bind=engine))

Base = declarative_base()

Base.query = db_session.query_property()



How to combine the two effectively?

I'm sorry for my poor English.
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
<!-- Tell us what should happen. -->
When a user creates a route that returns None flask raises

>  `TypeError: The view function did not return a valid response. The function either returned None or ended without a return statement.`

 The problem is that it doesn't include the route that actually caused the error. It's obviously not a huge deal, just a little tedious to go search through all of the routes.

full traceback:

```pytb
Traceback (most recent call last):
  File "/var/www/mysite.com/venv/lib/python3.6/site-packages/werkzeug/middleware/proxy_fix.py", line 232, in __call__
    return self.app(environ, start_response)
  File "/var/www/mysite.com/venv/lib/python3.6/site-packages/flask/app.py", line 2449, in wsgi_app
    response = self.handle_exception(e)
  File "/var/www/mysite.com/venv/lib/python3.6/site-packages/flask/app.py", line 1866, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/var/www/mysite.com/venv/lib/python3.6/site-packages/flask/_compat.py", line 39, in reraise
    raise value
  File "/var/www/mysite.com/venv/lib/python3.6/site-packages/flask/app.py", line 2446, in wsgi_app
    response = self.full_dispatch_request()
  File "/var/www/mysite.com/venv/lib/python3.6/site-packages/flask/app.py", line 1952, in full_dispatch_request
    return self.finalize_request(rv)
  File "/var/www/mysite.com/venv/lib/python3.6/site-packages/flask/app.py", line 1967, in finalize_request
    response = self.make_response(rv)
  File "/var/www/mysite.com/venv/lib/python3.6/site-packages/flask/app.py", line 2097, in make_response
    "The view function did not return a valid response. The"
TypeError: The view function did not return a valid response. The function either returned None or ended without a return statement.
```

### Environment

* Python version: 3.6
* Flask version: 1.1.1
* Werkzeug version: 0.16

Re: https://github.com/pallets/flask/blob/master/src/flask/cli.py#L607

### Expected Behavior
Should not change directory, or at least log a warning that is happening.


### Cause

Have a package tree that is not in the root of the project. 

### Actual Behavior
* Changes CWD of the process.  
* If PYTHONPATH is not set then werkzeug's debug reload fails. 
* relative file path do not resolve.

### Suggestion.

Allow a toggle environment variable to disable this behaviour.


### Environment

* Python version: 3.6
* Flask version: 1.1.1
* Werkzeug version: 0.16


### Notes

We have a multi-program codebase where there is lots of shared code and a couple of Flask webapps, along with other programs in the same project tree.  A shared .env (which we had no idea was loaded, just because we have python dotenv installed) 
This file stores common paths to other resources, services etc. 

The python codebase is in $PROJECT_ROOT/codebase/src and there are lots of other things in the root (like frontend SPA sources etc)



### Expected Behavior
request.files['file'] should contain the file. It doesn't. File contents are visible in `request.stream.read()`.

Raw request in attachment (request.stream.read()):
[request.bin.zip](https://github.com/pallets/flask/files/3939767/request.bin.zip)

This only occurs with funky characters in the filename. Such as Ofslútdyk.jpg. Same file without special character works as expected. 

```python
@app.route(f"/images", methods=['GET', 'POST', 'PUT'])
def images_endpoint(project, group):
    user = get_user(request.headers)

    if request.method in ['PUT', 'POST']:
        file = request.files['file'] # Returns 400 to client. 
```

No errors in console.

### Actual Behavior
Flask returning 400 to client.

### Environment
* Python version: 3.6.9
* Flask version: 1.1.1
* Werkzeug version: 0.16.0



Hi everybody:
  I have write some tests like this:
```python
@pytest.fixture
def app():
    app = create_app({"DB_CONNECT": TEST_DB_CONNECT})
    yield app

@pytest.fixture
def client(app):
    """A test client for the app."""
    return app.test_client()

def test_hello_1(app, client):
    # test that viewing the page renders without template errors
    assert client.get("/hello").status_code == 200


def test_hello_2(app, client):
    # test that viewing the page renders without template errors
    assert client.get("/hello").status_code == 200
```

and the interface hello like this(this interface locate at a blueprint):
```python
from flask import Blueprint,  current_app

bp = Blueprint('interface_map', __name__)

@bp.route('/hello')
def hello():
    current_app.logger.info('hello world test log')

    return "hello world"
```

when I running tests:

### Expected Behavior
```
[2019-12-05 15:56:10,693] 127.0.0.1 requested http://localhost/hello INFO in interface_demo: 
hello world test log
[2019-12-05 15:56:11,065] 127.0.0.1 requested http://localhost/hello INFO in interface_demo: 
hello world test log
```

### Actual Behavior

```pytb
[2019-12-05 15:56:10,693] 127.0.0.1 requested http://localhost/hello INFO in interface_demo: 
hello world test log
[2019-12-05 15:56:11,065] 127.0.0.1 requested http://localhost/hello INFO in interface_demo: 
hello world test log
[2019-12-05 15:56:11,065] 127.0.0.1 requested http://localhost/hello INFO in interface_demo: 
hello world test log
```

I run two tests but it log three times!
I have no idea what happened and I am not sure it is appropriate use current_app.logger in blueprint.

I also tried replace current_app.logger to print() or write to a file use open('file_name', 'a'), it behavior no problem

### Environment

* Python version:  3.7.1
* Flask version:  1.0.2
* Werkzeug version: 0.14.1

appreciate for any ideas
### Expected Behavior
It should return the **_'Last-Modified'_** header when returning 304 Not Modified HTTP response.

```python
**_Here is my code:_**

def get_response:
  headers = {
    'Last-Modified': last_modified_after,  Wed, 04 Dec 2019 01:47:01 GMT #
    'Cache-Control': 'no-cache',
    'Name': 'Test'
  }
  if user_has_old_version:
    return cloud_doc, 200 headers
  else:
    return cloud_doc, 304, headers
```

### Actual Behavior
my issue is when I returning the response with the headers including the header **_Last-Modified_** it is gone missing when it receives to the client end, But all the other headers are present. I wonder how only that header is gone missing.

When I get the response for the **_else_** condition (i.e HTTP 200 response) I only get the _Cache-Control_ header and the custom _Name_ header, this _Last-Modified_ gone missing. But when I receive the  **_if_** (i.e HTTP 304 response) case, I'm getting all the headers including the _Last-Modified_ header.

* Python version: 3.7
* Flask version: 1.1.1
* Werkzeug version: 0.16.0

Here is an subtle improvement of simplifying the way we get `subdomain` and `url_prefix` at `blueprints.py`

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

I can't seem to find a good place to share enhancement proposals and I've not come across any similar idea, so I thought I'd just ask it here. Coding static "/static" URLs is not the recommended style and we should use `{{ url_for('static', filename='xyz.abc') }}` in templates. While this is a great way of keeping Flask simple and dynamic, it's also becoming quite a lot of characters there if we have more resources we'd like to link to. Hence, wouldn't it be a considerably comfortable alternative if we had short forms like `{{ u("static", "xyz.abc") }}` or at least for the static files like this: `{{ s("xyz.abc") }}` ?
I know this reduces readability, but inside a `<link>`s href it's self-explanatory and still just an additional way of specifying resources in a shorter form.
* Mentioned Pallets Discord as a way of getting help
* Updated it to use the new format, to fix the warning that shows right now
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



I have `select` inside the html 

```
<select class="js-select2 partner_list" id="partner_option" name="partner_list_select" onchange="myFunction()">
      <option value = "choose">Choose an option</option>
      <option value = "active_partner"><a href="{{url_for('active_partners')}}">Active Partners</a></option>
      <option value = "filter_partner">Filter/Edit Partner</option>
      <option value = "add_new_partner">New Partner</option>
</select>
```

triggering `myfunction()` works fine on selecting the option.

I want to run a `flask view function` when `Active Partner` option is selected

I did import `url_for`

`from flask import url_for`

I have a simple print command when the this flask view function is called

**server.py**

```
@app.route('/all_active_partners')
def active_partners() :
    print('HERE#############################')
    return redirect('/')
```

When i click on the option `Active Partners`, the `active_partners` flask view function never gets called!

when I load this link `http://127.0.0.1:5000/all_active_partners`

I get
### Expected Behavior
`HERE#############################`

Where am I going wrong?


### Actual Behavior
Nothing

### Environment

* Python version: 3.6.8
* Flask version: 1.1.1
* Werkzeug version: 0.16.0

fixes #3358 

Due to the way `send_file` works, passing a text mode file-like object, such as `io.StringIO` in Python 3, would respond with 200 OK and an empty file, while printing a traceback to the terminal. Even in Python 2, this only worked by accident, and would probably fail if given a `StringIO.StringIO` object with Unicode data that did not encode with the system encoding. It appears `send_file` was only intended to work with binary mode data.

Now, if the object is an instance of `io.TextIOBase` it raises a `ValueError`. This doesn't help for file-like objects that don't use the `io` ABCs (including Python 2), but it should cover most cases.
fixes #3431
fixes #3430

If neither `--eager-loading` or `--lazy-loader` are passed to `flask run`, the default is now to eager load on the first run, then lazy load on reloads. This makes the command fail immediately if there is already an error, and the server remains up if errors are introduced later.
when it tried to read text file with 
f=open('filename.txt','r')
f.read()
it's shows me the lines like one line  1-sjdhjfh 2-djdhsh 3-jkjsla
but I want to view lines in my html like this
1-sjdhjfh
2-djdhsh
3-jkjsla

 

See https://github.com/pallets/flask/issues/3430
The default behavior of the `flask run` command is to lazily import the application if the reloader is enabled. This prevents syntax errors from crashing the app on reload, but it also means that such errors are deferred until the first request.

If the reloader is enabled, use eager loading the first time to show errors immediately. This way, initial errors will be shown to the user when they run the command, but errors introduced later will not crash the server.
I have been annoyed for a while by Flask's lazy loading feature, without even knowing about the feature or why it was annoying me. (The specific problem: when I have a bug in my app factory that should cause an immediate crash on startup, Flask swallowed the exception and only showed it to me with the first request.)

So this morning, I dug into the code and learned that this is not a bug, but clearly a deliberate feature added back in 2014 ago. I also learned about the workaround for this feature: `flask run --eager-loading`. Perfect! Nothing to fix here, right?

So what's the problem? Documentation! I had to dig into the source code to understand what was going on, and to figure out how make Flask behave the way I want. That should be described in the manual.

### Expected Behavior

In my perfect world, a bug in the app factory would cause an immediate crash on startup. But since delaying such crashes was clearly added deliberately to Flask, and has been there for 5 years, I do NOT propose changing this behaviour.

What should happen: the next person who is annoyed or confused by this behaviour should find an explanation and a workaround in the docs.

```python
import flask

app = flask.Flask(__nam__)                     # <<< TYPO!!!

@app.route('/')
def index():
    return flask.make_response({"foo": 42}, 200)
```

### Actual Behavior

I google'ed, I searched the manual, and I could not figure out why Flask was making it hard to see my bugs. I had to read the source code to find out about `--eager-loading`.

### Environment

* Python version: 3.6, 3.7
* Flask version: 1.1.1
* Werkzeug version: 0.16.0

### Expected Behavior
Static file from under static path should be served if it has UTF-8 encoded characters in its name.
I'm running Flask in combination with Gunicorn. Although my ubuntu system encoding is UTF-8 it doesn't seem to behave correctly.

```python
# simple file name:
42%C3%A9.jpg
```

### Actual Behavior
I get a 404 status code

### Environment

* Python version: 3.6.8
* Flask version: 1.0.2
* Werkzeug version: 0.14.1


<img width="1280" alt="Screen Shot 2019-11-15 at 7 28 50 PM" src="https://user-images.githubusercontent.com/2676602/68946908-4c274e80-07de-11ea-845c-afee494533a6.png">
Just a grammatical error. Expecting `a(n) Exception` instead of `a Exception`
To reproduce: return an exception from a view.
* Python version: `3.7`
* Flask version: `1.1.1`
* Werkzeug version: `0.16.0`

Update documentation link and project page link for Flask, Werkzeug, and Jinja.

pocoo.org --> palletsprojects.com

continue #3426 
Link now goes to `palletsprojects.com` instead of `pocoo.org`
According to the change log at https://github.com/pallets/flask/blob/master/CHANGES.rst, the release `Config.from_file` will be published with is now 2.0.0 rather than 1.2.0.

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

I am calling an endpoint i made to update a customer. When passing my json body i get a 400 Bad request. Seems like a json body that contains accent characters is not parsed correctly by the request object.

So this is the json body im sending to my endpoint:
```
{
  "last_name": "Gélinas"
}
```

### Expected Behavior
The `get_json` fonction should not return a 400 Bad Request
```
request.get_json(force=True)
```

The `request.data` should not remove the last `}` from the body when it contains accent character
```
request.data
# Should contain : "b'{\\n \"last_name\": \"G\\xc3\\xa9linas\"\\n}'"
```

### Actual Behavior
When reaching the endpoint, i am using the request object provided by flask to retrieve the body like so: 
```
request.get_json(force=True)
```
But with this code, i am getting a 400 Bad Request error. So i try using raw data instead like so:
``` 
request.data
```
I found out the request.data contains:
```
"b'{\\n \"last_name\": \"G\\xc3\\xa9linas\"\\n'"
```
As you can see, there is a missing `}` at the end which brakes any call to `json.loads` function

### Environment

* Python version: 3.7.4
* Flask version: 1.1.1
* Werkzeug version: 0.16.0

If ever the `flask.session` is used, and there's an intermediary cache between the Flask app and the user (Squid, Cloudinary, whatever), there's a significant risk that a user could see a page that was built for another user, exposing sensitive information (e.g. see https://stackoverflow.com/questions/13768007/browser-caching-issues-in-flask and https://github.com/mattupstate/flask-security/issues/334).

The solution to this is for the application developer to return a `cache-control: no-cache` or `cache-control: private` header with any pages that might contain sensitive information.

However, many project developers will likely forget to do this. Would it make sense for Flask to explicitly return a `cache-control: private` header by default if the `flask.session` is not empty?

In the meantime, we're planning to implement something like this in our apps:

``` python3
@app.after_request
def make_sessions_private(response):
    if flask.session:
        response.cache_control.private = True
        response.cache_control.public = False
    return response
```

Does this make sense?
Getting this error sometimes when running flask with uwsgi and nginx:
Possibly similar to the issue here: [3357](https://github.com/pallets/flask/issues/3357)?

```pytb
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/site-packages/flask/app.py", line 2463, in __call__
    return self.wsgi_app(environ, start_response)
  File "/usr/local/lib/python3.6/site-packages/flask_uwsgi_websocket/_gevent.py", line 59, in __call__
    return self.wsgi_app(environ, start_response)
  File "/usr/local/lib/python3.6/site-packages/flask/app.py", line 2453, in wsgi_app
    return response(environ, start_response)
  File "/usr/local/lib/python3.6/site-packages/werkzeug/wrappers/base_response.py", line 700, in __call__
    app_iter, status, headers = self.get_wsgi_response(environ)
  File "/usr/local/lib/python3.6/site-packages/werkzeug/wrappers/base_response.py", line 689, in get_wsgi_response
    app_iter = self.get_app_iter(environ)
  File "/usr/local/lib/python3.6/site-packages/werkzeug/wrappers/base_response.py", line 662, in get_app_iter
    environ["REQUEST_METHOD"] == "HEAD"
KeyError: 'REQUEST_METHOD'
```

### Environment

* Python version: 3.6.8
* Flask version: 1.1.1
* Werkzeug version: 0.16.0
* uWSGI version: 2.0.18

Gunicorn 20.0.0 no longer supports the factory pattern. 
A simple change to the documentation will prevent users from trying this method 

Here is the github issue regarding the change:
https://github.com/benoitc/gunicorn/issues/2159



From a build log against Python 3.8:

```
[   42s] ______________ TestSendfile.test_send_from_directory_bad_request _______________
[   42s] 
[   42s] self = <test_helpers.TestSendfile object at 0x7fa523850cd0>
[   42s] app = <Flask 'flask_test'>
[   42s] req_ctx = <RequestContext 'http://localhost/' [GET] of flask_test>
[   42s] 
[   42s]     def test_send_from_directory_bad_request(self, app, req_ctx):
[   42s]         app.root_path = os.path.join(
[   42s]             os.path.dirname(__file__), "test_apps", "subdomaintestmodule"
[   42s]         )
[   42s]     
[   42s]         with pytest.raises(BadRequest):
[   42s] >           flask.send_from_directory("static", "bad\x00")
[   42s] 
[   42s] tests/test_helpers.py:789: 
[   42s] _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
[   42s] 
[   42s] directory = 'static'
[   42s] filename = '/home/abuild/rpmbuild/BUILD/Flask-1.1.1/tests/test_apps/subdomaintestmodule/static/bad\x00'
[   42s] options = {}
[   42s] 
[   42s]     def send_from_directory(directory, filename, **options):
[   42s]         """Send a file from a given directory with :func:`send_file`.  This
[   42s]         is a secure way to quickly expose static files from an upload folder
[   42s]         or something similar.
[   42s]     
[   42s]         Example usage::
[   42s]     
[   42s]             @app.route('/uploads/<path:filename>')
[   42s]             def download_file(filename):
[   42s]                 return send_from_directory(app.config['UPLOAD_FOLDER'],
[   42s]                                            filename, as_attachment=True)
[   42s]     
[   42s]         .. admonition:: Sending files and Performance
[   42s]     
[   42s]            It is strongly recommended to activate either ``X-Sendfile`` support in
[   42s]            your webserver or (if no authentication happens) to tell the webserver
[   42s]            to serve files for the given path on its own without calling into the
[   42s]            web application for improved performance.
[   42s]     
[   42s]         .. versionadded:: 0.5
[   42s]     
[   42s]         :param directory: the directory where all the files are stored.
[   42s]         :param filename: the filename relative to that directory to
[   42s]                          download.
[   42s]         :param options: optional keyword arguments that are directly
[   42s]                         forwarded to :func:`send_file`.
[   42s]         """
[   42s]         filename = fspath(filename)
[   42s]         directory = fspath(directory)
[   42s]         filename = safe_join(directory, filename)
[   42s]         if not os.path.isabs(filename):
[   42s]             filename = os.path.join(current_app.root_path, filename)
[   42s]         try:
[   42s]             if not os.path.isfile(filename):
[   42s] >               raise NotFound()
[   42s] E               werkzeug.exceptions.NotFound: 404 Not Found: The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.
[   42s] 
[   42s] ../../BUILDROOT/python-Flask-1.1.1-2.2.x86_64/usr/lib/python3.8/site-packages/flask/helpers.py:767: NotFound
```

This occurs because os.path.isfile() no longer raises ValueError with invalid sequences under Python 3.8, instead just returns False.

I can see it, there are two ways to fix this test:
* Catch either Bad Request or Not Found, call it good.
* Or change the code to raise Bad Request if we look for invalid sequences.

I'm happy to push up a PR with a pointer to which direction you'd like to take.
fixes #3358
Hi,

I was working on a project using Flask and PyMongo, well when I try to parse the document from the mongo database and return it to the client I get an error that ObjectId can't be parsed, so I build a class base on JsonEncoder that fix this problem and I want to add it in Flask
Hi, 

I was working on a project using Flask and PyMongo, well when I try to parse the document from the mongo database and return it to the client I get an error that ObjectId can't be parsed, so I build a class base on JsonEncoder that fix this problem and I want to add it in Flask 



<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

We had implemented a two-in-one backend with Flask. For the website itself (which we call it `tekid`), we're having no trouble. But for the management portal (which we call it `tekid-admin`), even though using the same view registries, the WSGI server (both dev and prod) returns **404 NOT FOUND** for all requests.

### Expected Behavior
<!-- Tell us what should happen. -->

**NB: `tekid` and `tekid-admin` should give the same output**

The `routes` command would give like this:

```text
$ tekid routes
# or
$ tekid-admin routes
Endpoint        Methods            Rule
--------------  -----------------  -----------------------------------
load_contact    GET, POST          /contact/
load_expertise  GET                /expertise/
load_index      GET                /
load_news       GET, POST          /news/
...
static          GET                /static/<path:filename>
```

We try `curl http://127.0.0.1:5000/` after `run` on the website (`tekid`):

```text
$ tekid run
 * Environment: development
 * Debug mode: on
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 332-955-135
/fakepath/.venv/lib/python3.7/site-packages/flask/sessions.py:220: UserWarning: The session cookie domain is an IP address. This may not work as intended in some browsers. Add an entry to your hosts file, for example "localhost.localdomain", and use that instead.
  "The session cookie domain is an IP address. This may not work"
127.0.0.1 - - [07/Nov/2019 17:20:03] "GET / HTTP/1.1" 200 -
```

```text
$ curl http://127.0.0.1:5000
<!--
  _______   _    _____ _____    _     _      _
 |__   __| | |  |_   _|  __ \  | |   | |    | |
    | | ___| | __ | | | |  | | | |   | |_ __| |
    | |/ _ \ |/ / | | | |  | | | |   | __/ _` |
    | |  __/   < _| |_| |__| | | |___| || (_| |_
    |_|\___|_|\_\_____|_____/  |______\__\__,_(_)
-->
... (the actual HTML page)
```

### Actual Behavior
<!-- Tell us what happens instead. -->

With the same configs as above, we try `curl http://127.0.0.1:5000/` after `run` on the management portal (`tekid-admin`):

```text
$ tekid-admin run
 * Environment: development
 * Debug mode: on
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: ***-***-***
/fakepath/.venv/lib/python3.7/site-packages/flask/sessions.py:220: UserWarning: The session cookie domain is an IP address. This may not work as intended in some browsers. Add an entry to your hosts file, for example "localhost.localdomain", and use that instead.
  "The session cookie domain is an IP address. This may not work"
127.0.0.1 - - [07/Nov/2019 17:06:25] "GET / HTTP/1.1" 404 -
```

```text
$ curl http://127.0.0.1:5000
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>
```

### Environment

* Python version: 3.7.4
* Flask version: 1.1.1
* Werkzeug version: 0.16.0

So that it can be copy&pasted then work directly.

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Describe what this patch does to fix the issue.

**It fixes a typo in docs.**
This will require Python 2 support to be dropped, which as I understand isn't likely to happen till 2020. Which is a bonus as it gives time to consider this change and the implications of it. (I also need to spend some time cleaning up this implementation, yet it serves as a proof of concept).

I've written [this blog post](https://pgjones.dev/blog/flask-async-quart-sync-2019/) to add some extra context, but I see a key aspect to this change is that whilst it adds `async` support it does not do so throughout and specifically does not support ASGI. This means that Flask is constrained (when using `async`) to have worse performance than the ASGI equivalents. This is necessary as I don't think Flask can be `async` throughout (or support ASGI) whilst being backwards compatible. Yet this change is good overall, in that users would be able to add some async usage to their existing codebases. I would also like to note that they can switch to Quart if their usage becomes mostly async. 

This allows for async functions to be passed to the Flask class
instance, for example as a view function,

    @app.route("/")
    async def index():
        return "Async hello"

this comes with a cost though of poorer performance than using the
sync equivalent.

python 2.7.15  flask 1.1.1 macOs 10.15 Beta版(19A573a)
```log
2019-10-29 11:36:17,762 [Thread-13] ERROR  werkzeug - 10.25.72.175 - - [29/Oct/2019 11:36:17] code 400, message Bad request version ('\x00\x01\x00\x00\x00\x10ScannerHeartbeat')
2019-10-29 11:36:17,762 [Thread-13] INFO  werkzeug - 10.25.72.175 - - [29/Oct/2019 11:36:17] "��   J H      ScannerHeartbeat" 400 -
Traceback (most recent call last):
  File "/Users/dreampie/miniconda/envs/python2/lib/python2.7/logging/__init__.py", line 891, in emit
    stream.write(fs % msg.encode("UTF-8"))
UnicodeDecodeError: 'utf8' codec can't decode byte 0xab in position 103: invalid start byte
Logged from file _internal.py, line 122
```
![image](https://user-images.githubusercontent.com/3667080/67735926-9a97c780-fa40-11e9-8a5f-e4a76b257bec.png)

The patch changes the exception test based on the python version. If python version is greater than or equal to `3.8`, the exception raised is `NotFound`. Otherwise, it is a `BadRequest`.

fixes #3402

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
Am assuming calling response.location should return the current location i.e. url path

```python
# app/__init__.py
def create_app():
    app = Flask(__name__)

    @app.route('/')
    def hello():
        return 'Hello, World!'

    return app


# app/conftest.py
import pytest
from app import create_app

@pytest.fixture
def app():
    app = create_app()
    app.config['TESTING'] = True

    yield app


@pytest.fixture
def client(app):
    return app.test_client()


# app/test_hello.py
def test_hello(client):
    response = client.get('/')
    assert response.status_code == 200
    assert response.data == b'Hello, World!'
    assert response.location == "http://localhost/"
```

### Actual Behavior
Running `pytest` command results in a failed test

```pytb
client = <FlaskClient <Flask 'app'>>

    def test_hello(client):
        response = client.get('/')
        assert response.status_code == 200
        assert response.data == b'Hello, World!'
>       assert response.location == "http://localhost/"
E       AssertionError: assert None == 'http://localhost/'
E         -None
E         +'http://localhost/'

app/test_app.py:5: AssertionError

```

### Environment

* Python version: 3.8
* Flask version: 1.1.1
* Werkzeug version: 0.16.0

Whilst working on the [Reproducible Builds](https://reproducible-builds.org/) effort we noticed that flask could not be built reproducibly.

This is because it includes an absolute build directory in the documentation as the `json_module` attribute points to a Python class/module which has a string representation including its path.

This commit skips this (inherited) member from the documentation.

(This was originally filed in Debian as [#943674](https://bugs.debian.org/943674).)
I added a function named  send_from_filepath in helpers.py which user can download file from its absolute path and the filename just show to browser. sometimes , user store the file which rename  as MD5 value. so send_from_directory 。However, user can't get the correct name when downloading.
Best wish!
I noticed old printf style string formatting in quite a few places in the documentation.
When I cloned to fix the quick start guide, I noticed it was already changed to f-strings style formatting in quickstart so I changed the rest too. 
This updates the `Blueprint.route` decorator to support decorating `MethodView` classes.

Fixes Issue #3404.

#### Comments
+ I assume this will be part of the v2.0.0 release, so that's what I used for `versionchanged` and the changelog entry. If this is incorrect please let me know.
+ I wasn't sure where to put the tests - the code changes are part of `blueprints.py` but really only effect `views`, so I put it in `view.py`.
+ Let me know what other tests should be added.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->


### TL;DR:
+ Being able to use a Blueprint's `@pb.route` decorator on a `MethodView` class can help made code more readable
+ It should be a pretty trivial fix.
+ I'm working on tests and a merge request right now.


### Expected Behavior
Users should be able to combine blueprints with `MethodView`.

```python
from flask import Blueprint
from flask.views import MethodView

api = Blueprint("api", __name__, url_prefix="/api/v1")

@api.route("/users")
@api.route("/users/<user_id>")
class UserAPI(MethodView):

    def get(self, user_id=None):
        if user_id is None:
            return "list of all users"
        else:
            return f"just user {user_id}"

    def post(self, user_id):
        return f"POST {user_id}"

    def delete(self, user_id):
        return f"DELETE {user_id}"

    def put(self, user_id):
        return f"PUT {user_id}"

    def PATCH(self, user_id):
        return f"PATCH {user_id}"
```


### Actual Behavior
Using a blueprint's `@route` decorator on a `MethodView` results in `TypeError` is raised:

```pytb
Traceback (most recent call last):
  File "/c/gitlab/mocvd/sic-inventory/.venv/lib/python3.6/site-packages/flask/app.py", line 2463, in __call__
    return self.wsgi_app(environ, start_response)
  File "/c/gitlab/mocvd/sic-inventory/.venv/lib/python3.6/site-packages/flask/app.py", line 2449, in wsgi_app
    response = self.handle_exception(e)
  File "/c/gitlab/mocvd/sic-inventory/.venv/lib/python3.6/site-packages/flask/app.py", line 1866, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/c/gitlab/mocvd/sic-inventory/.venv/lib/python3.6/site-packages/flask/_compat.py", line 39, in reraise
    raise value
  File "/c/gitlab/mocvd/sic-inventory/.venv/lib/python3.6/site-packages/flask/app.py", line 2446, in wsgi_app
    response = self.full_dispatch_request()
  File "/c/gitlab/mocvd/sic-inventory/.venv/lib/python3.6/site-packages/flask/app.py", line 1952, in full_dispatch_request
    return self.finalize_request(rv)
  File "/c/gitlab/mocvd/sic-inventory/.venv/lib/python3.6/site-packages/flask/app.py", line 1967, in finalize_request
    response = self.make_response(rv)
  File "/c/gitlab/mocvd/sic-inventory/.venv/lib/python3.6/site-packages/flask/app.py", line 2130, in make_response
    " {rv.__class__.__name__}.".format(rv=rv)
TypeError: The view function did not return a valid response. The return type must be a string, dict, tuple, Response instance, or WSGI callable, but it was a UserAPI.
```

Instead, users need to manually add rules to the app after the fact, which can be hard to read and requires that the `app` instance be available in the module.

```python
user_view = UserAPI.as_view('user_api')
app.add_url_rule('/users/', defaults={'user_id': None},
                 view_func=user_view, methods=['GET',])
app.add_url_rule('/users/', view_func=user_view, methods=['POST',])
app.add_url_rule('/users/<int:user_id>', view_func=user_view,
                 methods=['GET', 'PUT', 'PATCH', 'DELETE'])
```


### Environment

* Python version: 3.6.8
* Flask version: 1.1.1
* Werkzeug version: 0.16.0


### The Fix

Based on my testing is *should* be relatively trivial to support this. All that needs to be done is edit `Blueprint.route`:

```diff
diff --git a/src/flask/blueprints.py b/src/flask/blueprints.py
index 8978104d..f6f62dd6 100644
--- a/src/flask/blueprints.py
+++ b/src/flask/blueprints.py
@@ -11,6 +11,8 @@
 """
 from functools import update_wrapper

+from .views import MethodViewType
+
 from .helpers import _endpoint_from_view_func
 from .helpers import _PackageBoundObject

@@ -276,6 +278,11 @@ class Blueprint(_PackageBoundObject):

         def decorator(f):
             endpoint = options.pop("endpoint", f.__name__)
+
+            # Support decorating MethodView classes
+            if isinstance(f, MethodViewType):
+                f = f.as_view(endpoint)
+
             self.add_url_rule(rule, endpoint, f, **options)
             return f
```

**Note:** I originally saw this feature in the `marshmallow-code/flask-smorest` library (originally `Nobatek/flask-rest-api`) [flask_smorest/blueprint.py](https://github.com/marshmallow-code/flask-smorest/blob/cc618f74abc2035d9f2904efed32cfc3bafad3ab/flask_smorest/blueprint.py#L90).
The above code is taken almost verbatim from that library.
### Expected Behavior
All tests should pass in Python 3.8. However this one:

```python
    def test_send_from_directory_bad_request(self, app, req_ctx):
        app.root_path = os.path.join(
            os.path.dirname(__file__), "test_apps", "subdomaintestmodule"
        )

        with pytest.raises(BadRequest):
            flask.send_from_directory("static", "bad\x00")
```

Which calls:

```python
def send_from_directory(directory, filename, **options):
    # ...
    try:
        if not os.path.isfile(filename):
            raise NotFound()
    except (TypeError, ValueError):
        raise BadRequest()
    # ...
```

Is now affected by a change from 3.7 to 3.8.

[Python 3.8 now fixes the bug](https://docs.python.org/3.8/whatsnew/3.8.html#os-path) where a NULL character in a file name would trigger a ValueError in some `os.path` functions, such as `os.path.isfile`:

> os.path functions that return a boolean result like exists(), lexists(), isdir(), isfile(), islink(), and ismount() now return False instead of raising ValueError or its subclasses UnicodeEncodeError and UnicodeDecodeError for paths that contain characters or bytes unrepresentable at the OS level. (Contributed by Serhiy Storchaka in bpo-33721.)

The expectation is that this test should not be there, as it is testing buggy python behaviour. Furthermore, since the correct behaviour is now known, I would expect `send_from_directory` to raise `NotFound` also for paths with NULL characters in them.

### Actual Behavior

`send_from_directory` raises `BadRequest` for paths with null characters in them. This makes tests fail in python 3.8

```pytb
====================================== FAILURES =======================================
__________________ TestSendfile.test_send_from_directory_bad_request __________________
tests/test_helpers.py:789: in test_send_from_directory_bad_request
    flask.send_from_directory("static", "bad\x00")
.tox/py38/lib/python3.8/site-packages/flask/helpers.py:767: in send_from_directory
    raise NotFound()
E   werkzeug.exceptions.NotFound: 404 Not Found: The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.
====================== 1 failed, 572 passed, 1 skipped in 4.14s =======================
```

### Environment

* Python version: 3.8
* Flask version: master
* Werkzeug version: 0.16.0

Hello,

Python 3.8 is released, so I believe that it would be nice to declare support for it.

Python 3.8.0 release announcement:
https://discuss.python.org/t/python-3-8-0-is-now-available/2478

Best regards!

P.S. Unfortunately, Azure Pipelines don't support Python 3.8 yet.
https://github.com/microsoft/azure-pipelines-image-generation/issues/1317
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

I can't figure out how to define a custom command with an application factory.

`app/__init__.py`:

```
import click
from flask import Flask
from flask.cli import with_appcontext
from config import config


def create_app():
    app = Flask(__name__)
    app.config.from_object(config)
    app.cli.add_command(seed)

    with app.app_context():
        from flask_bootstrap import Bootstrap
        from flask_sqlalchemy import SQLAlchemy
        from flask_migrate import Migrate
        from app.models import db
        from app.main import main_blueprint
        from app.api_1_0 import api_blueprint

        bootstrap = Bootstrap()
        migrate = Migrate()

        bootstrap.init_app(app)
        db.init_app(app)
        migrate.init_app(app, db)

        # Register Blueprints
        app.register_blueprint(main_blueprint)
        app.register_blueprint(api_blueprint, url_prefix='/api/v1.0')        

        return app


@click.command()
def seed():
    from app.seed import seed
    seed()
```

When I run `flask seed` I got the error `No such command "seed"`. I used to use flask script but I would like to "migrate" to the CLI. Is that even possible without installing the app in dev mode like in #3289 ?

## Creating Blueprint folders and routes at the run time for a form builder project.
In run time Blueprints successfully gets registered , I can even see url routes in **app.url_map** 
But without restarting the server I can't access those routes.
Any thoughts ? 
Asked it in Stack overflow and got down voted can anyone help https://stackoverflow.com/questions/58292455/how-to-register-routes-generated-by-code-without-reloading-the-server
TOML is a very popular format now, and is taking hold in the Python
ecosystem via pyproject.toml (among others). This allows toml config
files via,

    app.config.from_file("config.toml", toml.loads)

it also allows for any other file format whereby there is a loader
that takes a string and returns a mapping.

This is an alternative to #3386.
update readme.md, i'm adding guide to install flask on python3
I'm trying to add default headers to Flask's test client requests by overriding `FlaskClient.open`. When following redirects, the second request raises an error that an `EnvironBuilder` instance is being passed to `url_parse`.

### Expected Behavior

```python
from flask import Flask, redirect, url_for
from flask.testing import FlaskClient

app = Flask(__name__)

class CustomClient(FlaskClient):
    def open(self, *args, **kwargs):
        kwargs["headers"] = {"Extra-Key": "extra value"}
        return super().open(*args, **kwargs)

@app.route("/")
def home():
    return redirect(url_for("test"))

@app.route("/test")
def test():
    return "Hello, World!"

app.test_client_class = CustomClient
c = app.test_client()
rv = c.get("/", follow_redirects=True)
print(rv.data)
```

### Actual Behavior
```pytb
Traceback (most recent call last):
  File "/home/david/Projects/flask/example.py", line 21, in <module>
    rv = c.get("/", follow_redirects=True)
  File "/home/david/.virtualenvs/flask/lib/python3.8/site-packages/werkzeug/test.py", line 1029, in get
    return self.open(*args, **kw)
  File "/home/david/Projects/flask/example.py", line 9, in open
    return super().open(*args, **kwargs)
  File "/home/david/Projects/flask/src/flask/testing.py", line 222, in open
    return Client.open(
  File "/home/david/.virtualenvs/flask/lib/python3.8/site-packages/werkzeug/test.py", line 1016, in open
    environ, response = self.resolve_redirect(
  File "/home/david/.virtualenvs/flask/lib/python3.8/site-packages/werkzeug/test.py", line 948, in resolve_redirect
    return self.open(builder, as_tuple=True, buffered=buffered)
  File "/home/david/Projects/flask/example.py", line 9, in open
    return super().open(*args, **kwargs)
  File "/home/david/Projects/flask/src/flask/testing.py", line 215, in open
    builder = EnvironBuilder(self.application, *args, **kwargs)
  File "/home/david/Projects/flask/src/flask/testing.py", line 73, in __init__
    url = url_parse(path)
  File "/home/david/.virtualenvs/flask/lib/python3.8/site-packages/werkzeug/urls.py", line 457, in url_parse
    i = url.find(s(":"))
AttributeError: 'EnvironBuilder' object has no attribute 'find'
```
### Environment

* Python version: 3.6.9
* Flask version: 1.1.1
* Werkzeug version: 0.16.0

Redundant "are" was removed.
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->


### Expected Behavior
Should use clear language and variable names.

Example: https://flask.palletsprojects.com/en/0.12.x/patterns/celery/

### Actual Behavior
Use the variable celery instead of something like celery_app. Also imports Celery from celery package.

I would rename the variable `celery` to `celery_app` or `just app`.  `app` makes more sense because it is what is used in Celery documentation.

If you want to make this change, I am all ears. I would love to send the PR.
I've had a problem with the after_request decorator for a long time,I don't know when the exception will not execute after_request
Does flask support other templating engines like `ejs`, `handlebars` etc? If no, is there any way to create your own templating engine?
* introduce escape, and explain why it's omitted in examples
* clean up imports in examples

closes #3354 
closes #3378
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

```python
from flask_api import FlaskAPI
from flask import request
from werkzeug.exceptions import HTTPException
from flask import json


app = FlaskAPI(__name__)


@app.errorhandler(HTTPException)
def handle_exception(e):
    """Return JSON instead of HTML for HTTP errors."""
    # start with the correct headers and status code from the error
    response = e.get_response()
    # replace the body with JSON
    response.data = json.dumps({
        "code": e.code,
        "name": e.name,
        "description": e.description,
    })
    response.content_type = "application/json"
    return response


@app.route('/', methods=['GET'])
def get_value():
    key = request.args.get('key')

    if not key:
        raise HTTPException("HELLO")

    return "done"


if __name__ == "__main__":
    app.run(debug=True)

```
When making a request on `http://127.0.0.1:5000/` I get:
```html
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<title>None Unknown Error</title>
<h1>Unknown Error</h1>
<p>HELLO</p>
```
By changing the original code by:
```python
    if not key:
        raise HTTPException()
```
I thought that the code above will assign the error as HTTP error and  I expect the result would return JSON instead of HTML but it doesn't work.

- Another try on `http://127.0.0.1:5000/abcdef`, I get:
```json
{
    "code": 404,
    "description": "The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.",
    "name": "Not Found"
}
```


### Environment

* Python version: 3.7
* Flask version: 1.1.1
* Werkzeug version: 0.16.0

I was following the [tutorial](http://flask.palletsprojects.com/en/1.1.x/tutorial/templates/), and got to the bottom of the page, where it says

> Try clicking the “Register” button without filling out the form and see that the browser shows an error message.

### Expected Behavior
I was expecting to see an error message in the browser


### Actual Behavior
I don't see an error message - instead, it seems to already work beautifully:
![image](https://user-images.githubusercontent.com/33491632/66699054-533cd780-ecdb-11e9-8981-e97d43d368c7.png)




### Environment

Python 3.7.4
Flask 1.1.1
Werkzeug 0.16.0

I just upgraded the macOS to 10.15 (Catalina) on my MacBook (Retina, 12-inch, Early 2015) and encountered a weird issue:

1. I'm running a python flask app on local area network which worked fine before the upgrade, but other people could not access to my server now;
2. With Wireshark, I know the TCP SYN requests was received but not responded; And the flask server did not received the request at all;
3. I started a simple TCP server with a python script in terminal. By allowing Python.app to access to the network on a pop-up, this simple TCP server could be connected by others;
4. If I turn down the firewall on macOS, the flask server could be connected by others;
5. In the firewall configuration, the Python was allowed to access to the network; And there was no pop-ups to allow the network access when I started the flask app;

Anything i missed?

### Environment

* macOS 10.15
* Python version: 3.7.2
* Flask version: 0.12.2
* Werkzeug version: 0.14.1

TOML is a very popular format now, and is taking hold in the Python
ecosystem via pyproject.toml (among others). This adds toml as an
extra dependency usuable if installed with the toml extra.

I've recently added similar code in [Quart](https://gitlab.com/pgjones/quart/commit/e49d4f6eeaa71f1883f52f4154bb95d9871ef4ed) and I've been using toml configs with Flask and Quart for some time now. In my view TOML has crossed a threshold of usage to warrant direct support in Flask.
### Expected Behavior
I use `flask db init` execute error

```python
from flask import Flask
from flask_sqlalchemy import SQLAlchemy
from flask_migrate import Migrate

app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///app.db'

db = SQLAlchemy(app)
migrate = Migrate(app, db)


class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(128))


@app.route('/')
def hello_world():
    return 'Hello World!'


if __name__ == '__main__':
    app.run()

```

### Actual Behavior
<!-- Tell us what happens instead. -->

```pytb
$ flask db init
Traceback (most recent call last):
  File "d:\data\conda\envs\sys_server\lib\runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "d:\data\conda\envs\sys_server\lib\runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "D:\data\conda\envs\sys_server\Scripts\flask.exe\__main__.py", line 9, in <module>
  File "d:\data\conda\envs\sys_server\lib\site-packages\flask\cli.py", line 966, in main
    cli.main(prog_name="python -m flask" if as_module else None)
  File "d:\data\conda\envs\sys_server\lib\site-packages\flask\cli.py", line 586, in main
    return super(FlaskGroup, self).main(*args, **kwargs)
  File "d:\data\conda\envs\sys_server\lib\site-packages\click\core.py", line 717, in main
    rv = self.invoke(ctx)
  File "d:\data\conda\envs\sys_server\lib\site-packages\click\core.py", line 1132, in invoke
    cmd_name, cmd, args = self.resolve_command(ctx, args)
  File "d:\data\conda\envs\sys_server\lib\site-packages\click\core.py", line 1171, in resolve_command
    cmd = self.get_command(ctx, cmd_name)
  File "d:\data\conda\envs\sys_server\lib\site-packages\flask\cli.py", line 527, in get_command
    self._load_plugin_commands()
  File "d:\data\conda\envs\sys_server\lib\site-packages\flask\cli.py", line 523, in _load_plugin_commands
    self.add_command(ep.load(), ep.name)
  File "C:\Users\tao\AppData\Roaming\Python\Python37\site-packages\pkg_resources\__init__.py", line 2345, in load
    self.require(*args, **kwargs)
  File "C:\Users\tao\AppData\Roaming\Python\Python37\site-packages\pkg_resources\__init__.py", line 2368, in require
    items = working_set.resolve(reqs, env, installer, extras=self.extras)
  File "C:\Users\tao\AppData\Roaming\Python\Python37\site-packages\pkg_resources\__init__.py", line 789, in resolve
    raise VersionConflict(dist, req).with_context(dependent_req)
pkg_resources.ContextualVersionConflict: (Jinja2 2.10 (c:\users\tao\appdata\roaming\python\python37\site-packages), Requirement.parse('Jinja2>=2.10.1'),
 {'Flask'})

```

### Environment

* Python version: Python 3.7.3
* Flask version: 1.0.2
* Werkzeug version:0.16.0
* Flask-Migrate version: 2.5.2


Flask-7.0 uses with statement without "from **future** import with_statement" in helpers.py, which cause broken on Python 2.5 environment.

The FIX:

add "from **future** import with_statement" to helpers.py

Commit message (and pull req.) tells it all, I guess... Just 3 characters missing in the docs. 

The new blueprint template lookup scheme where the templates folder is just added to the searchpath instead of doing some weird stuff with the names as before. The documentation has to be clearer about that.

Added with_statement import from **future** to ensure appengine compatibility.

helpers.py in 0.7 uses the with_statement, but doesn't import it from **future**. This breaks appengine compatibility, at least when running with their runtime locally.

Fix is to do as app.py does and import with_statement.



Flask 0.8 should provide support for class based views similar to how they work in Django.

Additionally each CBV can provide the methods it responds so you don't have to register them on the route yourself, same with the endpoint.

Because browsers send the filename of a filename if the enctype is urlencoded we could provide helpful warnings if the user attempts to use a file that's not there because the wrong enctype is set.


We want to encourage blueprint names with dots in, make sure they work.

This changes several instances of "he" to "he or she" in various places in the documentation.

url_for docstrings still reference module which are gone in 0.7

https://github.com/mitsuhiko/flask/blob/master/flask/helpers.py#L152

I accidentally gq'd the lines to a width of 80, making it harder to see exactly what I've changed -- sorry! If that makes my suggestions unusable, you can simply refuse this request. I'm reading the docs to learn about Flask so I thought I might as well suggest improvements as I go.

Here is what we still need to do:
1. improve the upgrading documentation.
2. expain some patterns you can do with blueprints
3. show how blueprints can be provided by extensions
4. show patterns with blueprints

Not sure how cookies are supposed to work with ports right now, but we got reports that they don't work with an explicitly set port. Investigate.

Thanks!

Any errors that occur inside `request_context` are not properly caught by `handle_exception`. From app.py:

```
def wsgi_app(self, environ, start_response):
    with self.request_context(environ):
        try:
            response = self.full_dispatch_request()
        except Exception, e:
            response = self.make_response(self.handle_exception(e))
            return response(environ, start_response)
```

As an example, create an error handler for error code 500. Set `config['SERVER_NAME']` to something your client won't send, and visit the application. The call to `url_map.bind_to_environ` in `RequestContext` results in a ValueError from werkzeug.

Bug fix in the documentation for Deploying with Fabric: as of Fabric 1.0, in the local() function capture=False by default, so it must be explicitly set to capture=True so it returns a python string 
quick link to docs: http://docs.fabfile.org/en/1.0.1/api/core/operations.html#fabric.operations.local

Improving documentation for loading jQuery. Now using Google CDN with fallback to local jQuery.

ECMAscript 5 changed behavior of Array literals. That part of the documentation is outdated by now. We should check what browsers are affected by this and update the docs accordingly.

@rstacruz recently pointed me to the [JSON security](http://flask.pocoo.org/docs/security/#json-security) section of your documentation. It is irresponsible to pass off some sort of buggy browser behaviour (which probably doesn't even exist) as an inherent issue with using an array as the top-level object in a JSON document. The ecmascript 5 specification [very clearly states](http://es5.github.com/#x11.1.4):

> Let _array_ be the result of creating a new object as if by the expression `new Array()` where `Array` is the **standard built-in constructor** with that name.

Any browsers that behave as you say they _should_ in your documentation are not following the spec. I tested for this behaviour in Chrome, Opera, and Firefox, and none of them behaved as was described. Because of that, I ask that you remove that section of the documentation and put in its place a disclaimer that what was there previously (for over a year now!) was not factual. If anyone _does_ find this behaviour in any browser, report it instead in the proper place.

After the 0.7 release we really should be splitting up the testsuite into more than one file :)

New `flask.__version__` to determine what version of Flask is being used. 

Related: #216

http://flask.pocoo.org/docs/patterns/appfactories/#basic-factories
- How do you get access the application with the config?
- How do you get access to the application with the config?


Added initial uwsgi deployment documentation for nginx; updated nginx URL in fastcgi deployment docs; added uwsgi to deployment index

On : http://flask.pocoo.org/docs/tutorial/dbcon/#tutorial-dbcon, the second sample code which should illustrate the teardown_request is not well formated.

@app.before_request def before_request():
  g.db = connect_db()

@app.teardown_request def teardown_request(exception):
  g.db.close()

Source code looks good anyway ?!?!

How do I include [FragmentCacheExtension example](http://jinja.pocoo.org/docs/extensions/#example-extension) into Flask?

Hi,

Here's the thing :
- the first commit only passes the status argument to the Response base class.
- the second one updated the tests.

Thanks for this great microframework !

Change the documentation for the SERVER_NAME configuration value to tell that it can also take a port number. The port number is actually for url_for() to work with subdomains, as in issue #209.

send_file uses adler32 to build etags (which is enabled by default). adler32 takes a byte-string, and will try to encode unicode strings as ASCII which may fail. This patch encodes unicode filenames as UTF-8 before passing them to adler32.

Add Frozen-Flask to the extension registry.

Also, I believe that it and Flask-Flatpages meet all the requirements for approved extensions, if someone wants to review them.

Thanks.

**twitter.py lines 65--70**

```
        for word in self.required:
            if word not in text:
                return False
        for word in self.optional:
            if word in text:
                return True
        return False
```

True can only be returned, if optional keywords are given. Therefore I recommend returning True if none of the for loops returned a value.

The python logging facility provides a getter for the base logger class, logging.getLoggerClass().  This allows the base class of the logging singleton to be extended multiple times without overriding previous calls to logging.setLoggerClass(),   In my case specifically I'm setting up a base logging facility via an extended Logger,  flask won't play nice with this because its DebugLogger is not extended from the class returned via getLoggerClass().  For a patched version of the create_logging function see https://gist.github.com/981450

Hello guys,

I applied this change to my fork to alleviate an encoding problem.  I was sending http post with formadata jsonified.  The client machine uses iso-8859-1 and for most cases, I have to specify that encoding for xml and json work.

This works for my install, hopefully it will help others.

Ronnie and I discussed this in irc a while today.

Prevent pop if flashes not in session to avoid modification to session fixes #227

When I do the following in a fresh virtualenv initialized with --no-site-packages

```
pip install flask==dev
```

and then

```
pip freeze
```

then the result looks like this

```
Warning: cannot find svn location for Flask==0.7dev-20110514
## FIXME: could not find svn URL in dependency_links for this package:
Flask==0.7dev-20110514
Jinja2==2.5.5
Werkzeug==0.6.2
wsgiref==0.1.2
```


makes caching w/varnish easier

``` diff
diff -r 66cb5def7b6e flask/app.py
--- a/flask/app.py      Fri Dec 31 15:21:46 2010 +0100
+++ b/flask/app.py      Thu May 05 15:45:18 2011 -0400
@@ -439,6 +439,8 @@ class Flask(_PackageBoundObject):
                         object)
         :param response: an instance of :attr:`response_class`
         """
+        if not session:
+            return
         expires = domain = None
         if session.permanent:
             expires = datetime.utcnow() + self.permanent_session_lifetime
```

I could be wrong, but I think there are a couple of errors in the example fabfile. This fixes them.

Commit c6e4d743 is really what you want, the other two can be ignored. Couldn't figure out how to have make git behave.

I recently added message flashing to one of my apps, and noticed that it started re-issuing the session cookie on _every_ response.

A bit of digging revealed that `get_flashed_messages()` calls `session.pop('_flashes')` without first checking to see if `session['_flashes']` is missing or empty.  This has a side effect of triggering `ModificationTrackingDict.on_update()`, which in turn marks the session as modified even though it wasn't.  It happens even when no flash messages are set.

The fix should be easy.  Replace this part of `get_flashed_messages()`:

```
if flashes is None:
    _request_ctx_stack.top.flashes = flashes = session.pop('_flashes', [])
```

With something like this:

```
if flashes is None and '_flashes' in session:
    _request_ctx_stack.top.flashes = flashes = session.pop('_flashes')
else:
    _request_ctx_stack.top.flashes = flashes =  []
```

Hi,
I've encountered a strange bug while working with Flask. When I have two modules (say 'frontend' and 'admin') static files aren't found in frontend module. Admin module is url_prefixed with '/admin' and everything is fine with it.

The only workaround I found was to add a /static route in frontend module and serve files manually.

I've created a simple demo app to show the bug. It's available here: https://github.com/tomekwojcik/Flask-Module-Static-Files

Best ragards.

The example in the docs under _Application Dispatching > Combining Applications_ is incorrect:

```
from werkzeug.wsgi import DispatcherMiddleware
from frontend_app import application as frontend
from backend_app import application as backend

application = DispatcherMiddleware(frontend, {
    '/backend':     backend
})
```

It leaves you with nothing to run, because `application` is _not_ an application (and thus cannot be `run()`) but an instance of `DispatcherMiddleware`, which nothing can be done with whatsoever. Google had no mention of DispatcherMiddleware apart from the above page and the Werkzeug web site. You therefore try to run it as a Werkzeug application, but:
- The Werkzeug documentation is lame and no help at all;
- It is not the right approach anyway.

The code sample should either be:

```
from werkzeug.wsgi import DispatcherMiddleware
from frontend_app import application as frontend
from backend_app import application as backend

frontend.wsgi_app = DispatcherMiddleware(frontend.wsgi_app, {
    '/backend':     backend
})

frontend.run()
```

or:

```
from flask import Flask
from werkzeug.wsgi import DispatcherMiddleware
from frontend_app import application as frontend
from backend_app import application as backend

application = Flask(__name__)

application.wsgi_app = DispatcherMiddleware(frontend, {
    '/backend':     backend
})

application.run()
```

There is one hint of this in _Quickstart > Hooking in WSGI Middlewares_ and another in the API reference for the `Flask` class, but neither of them is returned in Google searches about _Flask Werkzeug middleware_ for example.

(Related to #20)

I just discovered that, when passing extra arguments to [url_for()](http://flask.pocoo.org/docs/api/#flask.url_for), it skips those whose values are None.  This is a convenient feature.  If it was documented, I would use it without worrying that it might disappear in the next version.

When restarting in debug mode, this error was output:
- Detected change in 'atest.py', reloading
  Unhandled exception in thread started by
  sys.excepthook is missing
  lost sys.stderr
- Restarting with reloader...

It may be related to a known issue calling sys.excepthook from threads, see http://bugs.python.org/issue1230540

Using Flask 0.6.1, Werkzeug 0.62 under Python 2.7 64-bit on Solaris10/SPARC.

In the WTForms' documentation on [displaying errors](http://wtforms.simplecodes.com/#displaying-errors) it gives an example of putting all of a form's errors in a neat little section (second example) but when I run the aforementioned code Flask returns:

```
ValueError
ValueError: too many values to unpack
```

I imagine it comes from this line:

```
{% for field_name, field_errors in form.errors if field_errors %}
```

Is their example Django specific or am I just missing something?

- It should be made clear that for some problems (such as a custom Jinja environment), subclassing is _the_ solution and Flask is explicitly designed for it.
- Some examples and best-practices would be helpful, maybe as a 'pattern'. How to extend rather than replace the defaults, how to deal with immutable containers etc.
- The reasons for the need to subclass, and the design choice of immutable containers, could be explained and defended. (Needed at construction time?)

On IRC, questions for which subclassing is the answer, are not uncommon, and at the same time few realize that you can and _should_ do this for some things, and they're often confused as to _how_ it's properly done.

If I find the energy I might try to draft some of the above.

It would be neat to be able to control the serialization of arbitrary objects with jsonify. The dumps function allows you to pass a callable for this. I propose the addition of either an overridable method on the Flask class that is passed by jsonify, or a decorator for registering such a function. The "default default" could simply raise TypeError, the "default default" for the json module.

``` python
class JSONAdaptiveFlask(Flask):

    def json_defaults(self, obj):
        if isinstance(obj, datetime):
            return obj.isoformat()
        try:
            return obj.__json__()
        except AttributeError:
            raise TypeError
```

… or …

``` python
@app.json_defaults
def json_adaption(obj):
    if isinstance(obj, datetime):
        return obj.isoformat()
    try:
        return obj.__json__()
    except AttributeError:
        raise TypeError
```

Unlike the rejected pull-request, this should be thread-safe. As for direct use of the json module, one can simply pass the reference:

``` python
json.dumps(obj, default=app.json_defaults)
```

In a discussion on IRC, Armin expressed concern that this kind of adaption isn't very useful in practice, because it differs between requests _what_ one wants serialized from an object. This problem can be solved by exploiting the fact that jsonify is request-bound, and the defaults function is able to read context-locals such as 'g'. It may not "feel" right but it is essentially what we need: a global state for the request.

``` python
class User(Model):

    def __json__(self):
        data = dict(name=self.name, joined=self.created_at)
        if g.user is self:
            data.update(email=self.email)
        if g.verbose_json:
            data.update(posts=self.posts)
```

The gain is that we can simplify views and structure the code better by moving model-logic to models. We can avoid repeating ourselves — the serialization is recursive, we just reference a datetime object and a list of instances of the Post model. We don't lose anything because by default it will behave as before and regardless we can still pass standard types directly to jsonify.

If you [Armin] approve the idea and decide on an API, I'll try my hand at a patch if you like.

Right now before_request cannot emit HTTP exceptions. This should be improved by allowing a certain useful subset of exception functionality there.

Change to match headers in https://github.com/mitsuhiko/werkzeug/blob/master/werkzeug/contrib/fixers.py

A GET request is allowed for any route, even when it is not in the listed methods. The result is a 404 for the GET request.

For example:

<pre><code>@module.route('/foo', methods=["PUT"])
def foo():
    return Response(status=204)</code></pre>


Here's the result of an OPTIONS request with the incorrect additional GET in the Allow header:

<pre><code>$ curl -IX OPTIONS http://localhost:5000/foo

HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Allow: PUT, HEAD, OPTIONS, GET
Content-Length: 0
Server: Werkzeug/0.6.2 Python/2.7
Date: Fri, 15 Apr 2011 17:17:31 GMT</code></pre>


A GET request responds with a 404:

<pre><code>$ curl -IX GET http://localhost:5000/foo

HTTP/1.0 404 NOT FOUND
Content-Type: text/html
Content-Length: 238
Server: Werkzeug/0.6.2 Python/2.7
Date: Fri, 15 Apr 2011 17:17:42 GMT</code></pre>

I need to work around a problem in flask that is fixed in the development code. I wish flask had something like sys.version_info that my code could check before enabling the workaround.

Sometimes I want to use send_from_directory with special cases like pre-processing some file extensions or adding directory indexes. To access the relevant file myself, I need its filename. safe_join returns this name without sending the file directly.

I could just copy 6 lines from Flask, but this part is the one that is easy to get wrong (and accidentally expose /etc/passwd ...)

The new function appears nicely in the API docs, tests pass, but I did not add any test. Should we unit test it individually or are tests that use send_from_directory enough?

Fixed a typo that was preventing second code block from appearing in a code block

I've had a problem with the after_request decorator for a long time until I realized that decorated functions must take one parameter and return a response. This updated documentation will hopefully help others not to make the same mistake.

When trying to use Module.after_app_request, it causes the following exception:

<pre>
Traceback (most recent call last):
  File "/Users/remyroy/VirtualEnvs/issueproject/lib/python2.6/site-packages/flask/app.py", line 889, in __call__
    return self.wsgi_app(environ, start_response)
  File "/Users/remyroy/VirtualEnvs/issueproject/lib/python2.6/site-packages/flask/app.py", line 883, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/Users/remyroy/VirtualEnvs/issueproject/lib/python2.6/site-packages/flask/app.py", line 881, in wsgi_app
    response = self.process_response(response)
  File "/Users/remyroy/VirtualEnvs/issueproject/lib/python2.6/site-packages/flask/app.py", line 796, in process_response
    response = handler(response)
TypeError: after_request() takes no arguments (1 given)
</pre>


Steps to reproduce:
1.  Create a new folder issueproject.
2.  Create a file called issueproject.py in that folder with the following content:
   <pre>
   # -_\- coding: utf-8 -_-
   from flask import Flask
   from issueproject.views import views

app = Flask(**name**)

app.config.from_object('issueproject.config.Config')
app.register_module(views)

if **name** == "**main**":
    app.run()
</pre>
3.  Create a sub folder issueproject.
4.  Add a file called views.py in that sub folder with the following content:

<pre>
# -*- coding: utf-8 -*-
from flask import Module
views = Module(__name__)

@views.after_app_request
def after_request():
    pass

@views.route('/')
def index():
    return 'hello world'
</pre>
1.  Add a file called config.py in that sub folder with the following content:
   <pre>
   # -_\- coding: utf-8 -_-

class Config(object):
    DEBUG = True
    TESTING = False
</pre>
6.  Run the main issueproject.py with the following command line:

<pre>
python issueproject.py
</pre>
1.  Navigate to http://localhost:5000/ .
2.  See the exception.

Here is the pip freeze from my environment:

<pre>
Flask==0.6.1
Jinja2==2.5.5
PyRSS2Gen==1.0.0
Twisted==8.2.0
Werkzeug==0.6.2
altgraph==0.6.8.dev
bdist-mpkg==0.4.3.dev
bonjour-py==0.3
decorator==3.2.1
jsonrpc==0.01
macholib==1.2.1.dev
mercurial==1.8
modulegraph==0.7.2.dev
numpy==1.2.1
py==1.4.2
py2app==0.4.2
pyOpenSSL==0.7
pyobjc-core==2.2b3
pyobjc-framework-AddressBook==2.2b3
pyobjc-framework-AppleScriptKit==2.2b3
pyobjc-framework-Automator==2.2b3
pyobjc-framework-CFNetwork==2.2b3
pyobjc-framework-CalendarStore==2.2b3
pyobjc-framework-Cocoa==2.2b3
pyobjc-framework-Collaboration==2.2b3
pyobjc-framework-CoreData==2.2b3
pyobjc-framework-CoreText==2.2b3
pyobjc-framework-DictionaryServices==2.2b3
pyobjc-framework-ExceptionHandling==2.2b3
pyobjc-framework-FSEvents==2.2b3
pyobjc-framework-InputMethodKit==2.2b3
pyobjc-framework-InstallerPlugins==2.2b3
pyobjc-framework-InstantMessage==2.2b3
pyobjc-framework-InterfaceBuilderKit==2.2b3
pyobjc-framework-LatentSemanticMapping==2.2b3
pyobjc-framework-LaunchServices==2.2b3
pyobjc-framework-Message==2.2b3
pyobjc-framework-PreferencePanes==2.2b3
pyobjc-framework-PubSub==2.2b3
pyobjc-framework-QTKit==2.2b3
pyobjc-framework-Quartz==2.2b3
pyobjc-framework-ScreenSaver==2.2b3
pyobjc-framework-ScriptingBridge==2.2b3
pyobjc-framework-SearchKit==2.2b3
pyobjc-framework-SyncServices==2.2b3
pyobjc-framework-SystemConfiguration==2.2b3
pyobjc-framework-WebKit==2.2b3
pyobjc-framework-XgridFoundation==2.2b3
pyopencl==0.92
pytest==2.0.2
python-dateutil==1.2
pytools==11
virtualenv==1.5.1
wsgiref==0.1.2
wxPython==2.8.8.1
wxPython-common==2.8.8.1
wxaddons==2.8.8.1
xattr==0.5
zope.interface==3.5.1
</pre>

While porting to flask, I found that there is no easy way to make flask look for templates and static files in the directories my application already uses for those files.  For various reasons, "static" and "templates" are not good choices for my app.  I wish I could configure flask to use my existing ones.

I was getting someone started on a project with flask and he jumped right on the tutorial and never saw a note on actually starting the application. I've added a note on where it seems most appropriate. 

I've got a module based Flask app and expected to see the http://host:port/asset.file when calling url_for(".static"...

It does everything right except not listing the port number.

Right now it's not quite clear to many people how the request context can be used in unittests. It's a little bit weird because of a bunch of different issues.
- an application in non debug mode will not propagate exceptions. There should be a TESTING mode that raises exceptions through and also closes down the context unless preserved.
- Extensions should not connect to databases and similar things in before_request but attach to the context as necessary by themselves.
- Docs should outline how testing is supposed to happen.

Why not:

```
imp.load_source('', path)
```

instead of https://github.com/mitsuhiko/flask/blob/master/flask/config.py#L123

Small docstring fix.

Right now ExtensionName==dev is required to be approved however supporting that turns out to be surprisingly hard if you have changing repository URLs. We should either drop this requirement or provide a script that updates all existing descriptions with new names.

Right now a lot of Pocoo stuff itself does not support ==dev.

Here's a second take at reworked extensions dev documentation. Again, the main point of these changes was to remove the example where a db was put on the g object.

Note also that I've removed the initialization function example, as it would be very difficult to implement without use of the g object.

Matt

with help from @brainsik

Silent flag added with checking for ENOENT & EISDIR. Test included.

Hey Armin -

I've update the extensions dev documentation as we discussed at the first sprint session.

As a reminder, the idea here was to make sure that the docs didn't recommend putting things like db objects on the g object in an extension - and especially not using before_request or after_request.

What I've tried to do is use patterns from the sqlalchemy extension. The one difference is a kind of "manager" pattern where the initialized extension returns a manager that has the db connection on it.

Let me know if this works for you. Obviously, I'm open to reworking if needed.

Matt

There are some minor wording issues/awkward sentences in a few places on the Testing Flask application page.

Multiple applications should be documented on top of dispatcher middleware and some other things.

Right now from_envvar does not support silent falling back. This should be fixed and implemented similar to from_pyfile.

Approve new extension reviewers and do a bunch of extension reviewing at pycon.

Couldn't make it to PyCon but helping out with the sprint remotely :)

https://github.com/mitsuhiko/flask/issues/labels/feedback#issue/180

Corrected a few small typos in the documentation for the start of the PyCon sprint. There are only two real typos, the rest are mostly a question of hyphenation and wording.

This is required to implement a custom session storage with for example the following code:

```
class CustomSession(Session):
    def __init__(self, *args, **kwargs):
        super(self.__class__, self).__init__(*args, **kwargs)
        self._db_instance = None


class CustomSessionStore(SessionStore):
    def get(self, sid):
        if not self.is_valid_key(sid):
            return self.new()

        instance = SessionData.query.get(sid)
        data = instance.data if instance else {}
        session = self.session_class(data, sid, False)
        session._db_instance = instance
        return session

    def save(self, session):
        if session._db_instance:
            session._db_instance.data = dict(session)
        else:
            instance = SessionData(id=session.sid, data=dict(session))
            db.session.add(instance)
            session._db_instance = instance
        db.session.commit()
```

Each time I start up a new flask project I run into the same mental block while re-reading the documentation. The Packages section says to put the view imports at the bottom of the file. So each time I run into that problem I spend 20 minutes thinking "Sure, that works for packages but I need to register my modules and I can't do that if the import has to be the last thing in the file." I think the language changes here make it clear that the import doesn't have to be the last thing.

I'm working on a project where we're running flask w/mod_wsgi in development and it'd be really nice to be able to route all errors the app's log (vs having some in the app's log and some in the apache log).  Though the built-in dev server is more convenient, we're running mod_wsgi in development for consistency with production.

The readme is horribly outdated, especially the 'Is it ready?' section. It should be updated to reflect the maturity of the project.

Also it mentions that Flask is intended for small projects which, even though it is true, probably scares away people who want to build a medium to large sized project, which is really not necessary.

Many Flask questions on the mailing list or IRC are easily answered by reading Werkzeug documentation. Maybe Flask docs should make more obvious (and repeat everywhere) that many thing (Request and Response objects, routing, ...) are just inherited from Werkzeug, and link to the relevant documentation.

{{ url_for('static', filename='style.css') }} is not working, gives error 500.
Python 2.7.1, Flask 0.6.1
Try to run minitwit.py

Please review the [Flask-FlatPages](http://packages.python.org/Flask-FlatPages/) and [Flask-Static](http://packages.python.org/Flask-Static/) extensions for approval.

All [requirements](http://flask.pocoo.org/docs/extensiondev/#approved-extensions) are met as far as I can tell.

Added link to issue tracker from main page and community page.

Added a link to issue tracker from the left navigation of documentation.

Added a link to issue tracker from the left navigation of documentation.

I noticed that runserver.py was missing from one of the directory listings in the documentation.  Great work on Flask, so far I'm really liking it and can't wait to hear more about it at PyCon!

People seem to be put off by the lack of auth&auth in Flask. Just because it's not there it does not mean it's hard. Documentation should show an example, maybe with Flask-SQLAlchemy.

Related feedback issues:
- http://feedback.flask.pocoo.org/message/54

There seem to be a few situations left where "nothing is rendered and nothings is displayed" ends up for the user. This probably means that the debug mode was not enabled. We should probably add a stderr based error logging by default in production mode because of that or at least warn the user in the documentation more.

Related feedback issues:
- http://feedback.flask.pocoo.org/message/56

The documentation is currently very discouraging to many new users. We shouldn't have written the documentation that way because nobody else does and honesty is not expected I guess :)

Related feedback issues:
- http://feedback.flask.pocoo.org/message/60

The documentation should cross reference better. A few of these might be caused by the recent moving around inside Werkzeug.

Related feedback issues:
- http://feedback.flask.pocoo.org/message/92

We have to expand the mod_wsgi deployment chapter.

Related feedback issues:
- http://feedback.flask.pocoo.org/message/98

People have a hard time finding the issue tracker apparently. We should probably link that from more prominent places.

Related feedback issues:
- http://feedback.flask.pocoo.org/message/103

Many people struggle with deploying a simple Flask application. The tutorial should show that and provide some helpful pointers to other parts of the documentation that handle deployment.

Related feedback issues:
- http://feedback.flask.pocoo.org/message/105

There should be a larger tutorial that not only shows how to use Flask but also some extensions (maybe Flask-Script, Flask-SQLAlchemy and Flask-WTF) and modules (or what we will call them then)

Related feedback issues:
- http://feedback.flask.pocoo.org/message/115

Currently you can only declare error handler for Werkzeug exceptions. That's pretty much the case because what is not raised as a Werkzeug HTTP exception can't be catched. However since Python 2.4 is currently in the process of being phased out we could now finally make exceptions actual response objects if we prefer so it would make sense to keep that in mind and provide catching not only by code but also by any kind of instance check.

This also affects Werkzeug.

Related feedback issues:
- http://feedback.flask.pocoo.org/message/112

after_request is not executed if an exception happens in debug mode. This is annoying for databases because it requires that you restart the server to tear down the connection. Sometimes that's what you want, otherwise not. The original intention was that you want to continue having the transaction in the interactive debugger.

Generally however we need a separate decorator that always executes after request, even if an exception happened. Signals are one option, if that is what we want we should document it better. I would prefer a separate decorator however.

Related feedback issues:
- http://feedback.flask.pocoo.org/message/108
- http://feedback.flask.pocoo.org/message/76

Currently the documentation does not explain well enough how to deal with circular imports.

Related feedback issues:
- http://feedback.flask.pocoo.org/message/99
- http://feedback.flask.pocoo.org/message/18

Currently Flask calls the blueprint for reusable thingies "Module" which is a terrible name because it already has a lot of meaning in Python. Because Modules also need to be pimped we should consider introducing a new concept altogether with a new name and phase out modules.

For all changes that are backwards incompatible we should consider that people hate updating their code so at the very least provide a script like the werkzeug import rewriter.

Related feedback issues:
- http://feedback.flask.pocoo.org/message/10
- http://feedback.flask.pocoo.org/message/21
- http://feedback.flask.pocoo.org/message/99
- http://feedback.flask.pocoo.org/message/117

url_for is currently the wrong way round compared to absolute imports. This also makes converting into larger applications hard when you suddenly introduce modules and a few views on the application itself remain (eg: static exports). The problem with "reversing" is that it breaks current code, so at the very least it should be an option.

We also have to investigate how many extensions this would affect.

Related feedback issues:
- http://feedback.flask.pocoo.org/message/7

I was suprised to find that jsonify(['hello', 'world']) will raise a TypeError even though 

> [
>     "hello",
>     "world"
> ]

is valid json.

I think there should be a check to see if the first argument is a list instance and just do a json dump of the first argument if it is or something like that.

Fixes #3125
Worked on with @seawolf42 :smile:

- Remove  Flask's JSONMixin class to use Werkzeug's, which in version >=0.15 imported  Flask's JSONMixin.
- Update minimum Werkzeug version to >=0.15
- Remove one test that no longer applies (referencing app's debug mode - not applicable in Werkzeug environment)
- Update two test cases to remove app custom encoder and decoder and instead compare raw responses.

begginers like me get stucked at the URL Building section, as it is a little bit more advanced, so I moved URL Building down the text with Redirects and Error. Also Added a little description of the output expected when running "flask run..." with the new code in the URL Building section

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

* Describe what this patch does to fix the issue.
    * Fix the error that `methods` variable in `MethodView` won't be inherited when it's not overwritten.
* Link to any relevant issues or pull requests.
    * closes #3138 
Ticket is referenced in [#Issue 1](https://github.com/pallets/meta/issues/1) in the Meta repo.
I spoke with @davidism and the decision was to use Contributor Covenant. It has easy GitHub integration and quality content.


begginers like me get stucked at the URL Building section, as it is a little bit more advanced, so I moved URL Building down the text with Redirects and Error. Also Added a little description of the output expected when running "flask run..." with the new code in the URL Building section

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

fixes #3163 

Note that @davidism has also recommended re-architecting this helper, David, do you want to own opening the new issue to track that?
Lines in RST files should be no longer than 80 characters
closes #3163
All Pallets projects should have a link to the official chat server on Discord.
Also triggers on maintenance branches now!


fixes #3168 

New, more explicit warning message on `app.run(debug=True)`:
![image](https://user-images.githubusercontent.com/13977519/57159683-cfef8f80-6de6-11e9-89c1-8884fab7f2e0.png)


<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->



I'm preparing for my PyCon tutorial, for which I'm trying to look at things from the perspective of a beginner. The output of `flask run` is actually very confusing if you don't have a bit of background. Here is an example:

```
(venv) $ flask run
* Environment: production
  WARNING: Do not use the development server in a production environment.
  Use a production WSGI server instead.
* Debug mode: off
* Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
```

First of all, is this a development server? How would you know if you are new to Flask? And more importantly, we are told that we shouldn't use the development server in a production environment. But the line right above appears to claim the current environment is production!

I would like to propose a rewording of this warning to avoid ambiguous terms such as "environment". My proposal:

```
  WARNING: This is a development server. Do not use it in a production deployment.
  Use a production WSGI server instead.
```

Thoughts?
I've discovered a weird interaction between Flask, pytest, SQLAlchemy, and FactoryBoy that I _think_ is a Flask bug. Consider these two identical routes that should both return the number of records in a database table:

```py
bp = Blueprint('example', __name__, url_prefix='/example')

@bp.route('/form', methods = ['POST'])
def test_form():
    return str(db_session.query(Person).count())

@bp.route('/json', methods = ['POST'])
def test_json():
    return str(db_session.query(Person).count())
```

The difference is in the unit tests:

```py
def test_form(self, client):
    person = PersonFactory()
    resp = client.post('/example/form', data={'foo': 'bar'})
    assert resp.data == b'1'

def test_json(self, client):
    person = PersonFactory()
    resp = client.post('/example/json', json={'foo': 'bar'})
    assert resp.data == b'1'
```

We're posting form data in the first test and JSON in the second. The first test succeeds and you see this in the log:

```pytb
2019-04-30 14:26:05,425 INFO sqlalchemy.engine.base.Engine BEGIN (implicit)
2019-04-30 14:26:05,427 INFO sqlalchemy.engine.base.Engine INSERT INTO people (id) VALUES (%(id)s)
2019-04-30 14:26:05,427 INFO sqlalchemy.engine.base.Engine {'id': '658e241a-5522-47ca-9e61-bd6862d6ddc6}
2019-04-30 14:26:05,432 INFO sqlalchemy.engine.base.Engine SELECT count(*) AS count_1 FROM (SELECT people.id AS people_id FROM people) AS anon_1
2019-04-30 14:26:05,432 INFO sqlalchemy.engine.base.Engine {}
2019-04-30 14:26:05,433 INFO sqlalchemy.engine.base.Engine ROLLBACK
```

FactoryBoy correctly inserts the data and rolls it back when the test is done. However, the second test fails because the test person isn't inserted:

```pytb
2019-04-30 14:28:27,341 INFO sqlalchemy.engine.base.Engine BEGIN (implicit)
2019-04-30 14:28:27,342 INFO sqlalchemy.engine.base.Engine SELECT count(*) AS count_1 
FROM (SELECT people.id AS people_id FROM people) AS anon_1
2019-04-30 14:28:27,342 INFO sqlalchemy.engine.base.Engine {}
2019-04-30 14:28:27,343 INFO sqlalchemy.engine.base.Engine ROLLBACK

tests/test_example.py:40 (TestExample.test_json)
b'0' != b'1'
```

See this gist for how I'm creating the Flask app, initializing SQLAlchemy, and configuring the test suite: https://gist.github.com/dpmccabe/6d3bed81c37817c38fb3f2b262d1393d

Apologies if I'm doing anything unconventional, since I'm new to Flask.

---

### Expected Behavior

The format of the request body (form data vs. JSON) should have nothing to do with whether FactoryBoy inserts records.

### Actual Behavior

FactoryBoy records are not inserted when testing a post endpoint with a JSON body. It seems like there's some preprocessing step that's not performed with a JSON body.

### Environment

* Python version: 3.7
* Flask version: 1.0.2
* Werkzeug version: 0.15.2
Describe what this patch does to fix the issue.
- removes seemingly unused import of url_join

Link to any relevant issues or pull requests.
#3165 

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

https://github.com/pallets/flask/blob/827536e20ad2079f3f50db11aac03e037e98503e/flask/blueprints.py#L13
**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

Tell us what should happen.

```python
Paste a minimal example that causes the problem.
```

### Actual Behavior

Tell us what happens instead.

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version:
* Flask version:
* Werkzeug version:

In Python 3, `mode='rt'` is synonymous with `mode='r'` but Flask disallows it thinking it is not a valid mode for reading. While this is true in Python 2, Flask could (at least) provide a more meaningful error message, if not just allow it.

A simple solution might change these lines in `flask/helpers.py`:

```python
    def open_resource(self, resource, mode='rb'):
        """..."""  # truncated for example
        if mode not in ('r', 'rb'):
            raise ValueError('Resources can only be opened for reading')
        return open(os.path.join(self.root_path, resource), mode)
```

...to...

```python
    def open_resource(self, resource, mode='rb'):
        """..."""
        if mode == 'rt':
            mode = 'r'
        if mode not in ('r', 'rb'):
            raise ValueError('Resources can only be opened for reading')
        return open(os.path.join(self.root_path, resource), mode)
```

A heavier solution might use `io.open()` (and also allow `encoding`, but see #1740):

```python
    def open_resource(self, resource, mode='rb', encoding=None):
        """..."""
        if mode not in ('r', 'rb', 'rt'):
            raise ValueError('Resources can only be opened for reading')
        return io.open(os.path.join(self.root_path, resource), mode=mode, encoding=encoding)
```

### Expected Behavior

Calling `open_resource()` with `mode='rt'` should open a file in text mode (at least in Python 3).

```python
from flask import Flask

app = Flask(__name__)
with app.open_resource('README.md', mode='rt') as f:
    print(f.read())
```

### Actual Behavior

A misleading exception is raised.

```pytb
Traceback (most recent call last):
  File "mwe.py", line 5, in <module>
    with app.open_resource('README.md', mode='rt') as f:
  File "/home/goodmami/repos/OMW/py3env/lib/python3.6/site-packages/flask/helpers.py", line 1002, in open_resource
    raise ValueError('Resources can only be opened for reading')
ValueError: Resources can only be opened for reading
```

### Environment

* Python version: 3.6.7
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

- Added that an empty `FLASK_APP` environment variable will also look for an `app` package in addition to the two files.
- Added instructions for running Gunicorn with an app factory that lacks an explicit application instance but has a function that returns one.

Regarding the Gunicorn update, perhaps the other application servers should have a similar update? It looks like uWSGI takes the same type of arguments as Gunicorn. Perhaps others more familiar with those apps can offer how to handle the same type of application I've updated the Gunicorn documentation for?
At flask.testing:81, there exists the block below added in e97253e4c:

```
    if 'json' in kwargs:
        ...
        # push a context so flask.json can use app's json attributes
        with app.app_context():
            kwargs['data'] = json_dumps(kwargs.pop('json'))
```

This enables the werkzeug client to use app or blueprint defaults for the JSONEncode to use. However this invokes an app context and consequently (and surprisingly) the handlers handlers registered to the app context lifecycle.

Since this behavior only happens when the `json` kwarg is used on the test client, it can lead to surprising behavior in tests that make use of json and inconsistent behavior between tests that do and do not use json. A more expected behavior would be to have consistent behavior both when and when not using the `json` kwarg. 

I also do not see any other usages of the app_context context manager in flask.testing, so this doesn't seem like a pattern that should be expected (not that I'm well versed in Flasks internal patterns, so take that for what its worth).

I discovered this because Flask-SQLALchemy registers an app context teardown that removes the session and unexpectedly rolls back a session mid testcase. I imagine this behavior is not unique to Flask-SQLAlchemy.

I propose removing the app_context context handler surrounding the `json_dumps` call, since

* **this was the behavior prior to e97253e4c**
* the general flask pattern is already to wrap the higher level calls in an app context, so there is unlikely to be significant impact
* json_dumps already degrades gracefully when there is no app context
* the behavior change is constrained to the testing utilities

I can submit the PR for this if there's appetite, since it's just a couple of lines.

Python3, flask 1.02.

### Expected Behavior

I was trying to write unit tests for my flask restful api which uses BasicHttpAuth on the initial request and returns a JWT token. All subsequent requests have this token in an x-access-header up to an expiry of 15 mins, then re-authentication happens( the code for this is in the anacropapi repo on my profile under api.__init__.py). I have noted the error in the template. I thought this test client would be fully compatible with the requests package. Does anyone know of a work around for this or can an auth keyword arg be added ?

```python
import unittest 

class ApiTest(unittest.TestCase): 

    def setUp(self):
        # creates a test client
        self.app = app.test_client()
        # add a user into the account code goes here ...

    def tearDown(self):
        db.drop_all()
        # etc...

    def test_login(self):
        # sends HTTP GET request to the application
        # on the specified path with an auth kwarg passed like in requests 
         result = self.app.get('/login', auth=requests.auth.BasicHttpAuth(username, password)) 
```

### Actual Behavior

```pytb
this returns no auth arg found error i cant remember the specfic error off hand 
```

### Environment

* Python version: 3.6
* Flask version: latest
* Werkzeug version: latest



Using abort() makes static code analysis harded because it only works if the IDE knows that abort() interrupts the function execution.

Is there a reason why flask handler abortion isn't done with a raise instead of abort?

Would an abortion interfaced based on raising exceptions directly be accepted into the code?
* Fixes pytest-dev/pytest-flask#42

Entering a client preserves all context from being poped, but exiting only poped one preserved context. This PR pops all preserved context.
Ensure that Jinja2 version isn't vulnerable to the str.format_map vulnerability

Link to any relevant issues or pull requests.
https://nvd.nist.gov/vuln/detail/CVE-2019-10906



The 2.10.1 version was released 2019-04-06 and contains important security fix.
This change allows flask users to avoid implicit insecure dependency.
Use a more explicit explanation on how to write code to test own code
when sessions are needed.
The previous code was not fully explicit that the client is supposed
to be called after the session transaction and not during.
That caused https://stackoverflow.com/questions/55500672/flask-testing-endpoint-with-session-data-the-call-has-no-session and what it duplicates.

This patch makes the documentation on this part more explicit and more idiot-proof.

**Note:** Due to 
```
Exception occurred:
  File "conf.py", line 3, in <module>
    from pallets_sphinx_themes import get_version
ImportError: No module named 'pallets_sphinx_themes'
```
I can't test the documentation locally
```python
# Importing the libraries
from flask import Flask, render_template, request
from flask_wtf import FlaskForm
from wtforms import SelectField, SubmitField
import threading
import numpy as np
import matplotlib.pyplot as plt
import pandas as pd

# code snippet
app = Flask(__name__)
app.config['SECRET_KEY'] = ''
if __name__ == '__main__':
   #app.run(debug = True ,use_reloader=False)
   threading.Thread(target=app.run(debug = True ,use_reloader=False)).start()
```

```pytb
Traceback (most recent call last):
  File "C:\Users\Monali\Anaconda3\envs\myenv\lib\site-packages\flask\app.py", line 2309, in __call__
    return self.wsgi_app(environ, start_response)
  File "C:\Users\Monali\Anaconda3\envs\myenv\lib\site-packages\flask\app.py", line 2295, in wsgi_app
    response = self.handle_exception(e)
  File "C:\Users\Monali\Anaconda3\envs\myenv\lib\site-packages\flask\app.py", line 1741, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "C:\Users\Monali\Anaconda3\envs\myenv\lib\site-packages\flask\_compat.py", line 35, in reraise
    raise value
  File "C:\Users\Monali\Anaconda3\envs\myenv\lib\site-packages\flask\app.py", line 2292, in wsgi_app
    response = self.full_dispatch_request()
  File "C:\Users\Monali\Anaconda3\envs\myenv\lib\site-packages\flask\app.py", line 1815, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "C:\Users\Monali\Anaconda3\envs\myenv\lib\site-packages\flask\app.py", line 1718, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "C:\Users\Monali\Anaconda3\envs\myenv\lib\site-packages\flask\_compat.py", line 35, in reraise
    raise value
  File "C:\Users\Monali\Anaconda3\envs\myenv\lib\site-packages\flask\app.py", line 1813, in full_dispatch_request
    rv = self.dispatch_request()
  File "C:\Users\Monali\Anaconda3\envs\myenv\lib\site-packages\flask\app.py", line 1799, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "C:\Users\Monali\conda projects\BIL_miniProject\home.py", line 65, in linReg
    plt.show()
  File "C:\Users\Monali\Anaconda3\envs\myenv\lib\site-packages\matplotlib\pyplot.py", line 244, in show
    return _show(*args, **kw)
  File "C:\Users\Monali\Anaconda3\envs\myenv\lib\site-packages\matplotlib\backend_bases.py", line 192, in __call__
    self.mainloop()
  File "C:\Users\Monali\Anaconda3\envs\myenv\lib\site-packages\matplotlib\backends\backend_qt5.py", line 149, in mainloop
    signal.signal(signal.SIGINT, signal.SIG_DFL)
  File "C:\Users\Monali\Anaconda3\envs\myenv\lib\signal.py", line 47, in signal
    handler = _signal.signal(_enum_to_int(signalnum), _enum_to_int(handler))
ValueError: signal only works in main thread
```

* Python version: 3.5.5
* Flask version: 1.0.2



### Expected Behavior

The following set of commands should result in all tests being passed or skipped (no failures).

```
git clone https://github.com/pallets/flask
cd flask
python3 -m venv env
. env/bin/activate
pip install -e ".[dev]"
pip install pytest
```

### Actual Behavior

I get the following failures:

```
=================================== FAILURES ===================================
____________________________ test_main_module_paths ____________________________

modules_tmpdir = local('/tmp/pytest-of-vedantroy/pytest-5/test_main_module_paths0/modules_tmpdir')
purge_module = <function purge_module.<locals>.inner at 0x7fdb8852a268>

    def test_main_module_paths(modules_tmpdir, purge_module):
        app = modules_tmpdir.join('main_app.py')
        app.write('import flask\n\napp = flask.Flask("__main__")')
        purge_module('main_app')
    
>       from main_app import app
E       ModuleNotFoundError: No module named 'main_app'

tests/test_instance_config.py:32: ModuleNotFoundError
________________________ test_uninstalled_package_paths ________________________

modules_tmpdir = local('/tmp/pytest-of-vedantroy/pytest-5/test_uninstalled_package_paths0/modules_tmpdir')
purge_module = <function purge_module.<locals>.inner at 0x7fdb88548f28>

    def test_uninstalled_package_paths(modules_tmpdir, purge_module):
        app = modules_tmpdir.mkdir('config_package_app')
        init = app.join('__init__.py')
        init.write(
            'import os\n'
            'import flask\n'
            'here = os.path.abspath(os.path.dirname(__file__))\n'
            'app = flask.Flask(__name__)\n'
        )
        purge_module('config_package_app')
    
>       from config_package_app import app
E       ModuleNotFoundError: No module named 'config_package_app'

tests/test_instance_config.py:61: ModuleNotFoundError
______________________ test_installed_module_paths[True] _______________________

modules_tmpdir = local('/tmp/pytest-of-vedantroy/pytest-5/test_installed_module_paths_Tr0/modules_tmpdir')
modules_tmpdir_prefix = local('/tmp/pytest-of-vedantroy/pytest-5/test_installed_module_paths_Tr0/modules_tmpdir')
purge_module = <function purge_module.<locals>.inner at 0x7fdb8852a268>
site_packages = local('/tmp/pytest-of-vedantroy/pytest-5/test_installed_module_paths_Tr0/modules_tmpdir/lib/python3.6/site-packages')
limit_loader = None

    def test_installed_module_paths(modules_tmpdir, modules_tmpdir_prefix,
                                    purge_module, site_packages, limit_loader):
        site_packages.join('site_app.py').write(
            'import flask\n'
            'app = flask.Flask(__name__)\n'
        )
        purge_module('site_app')
    
>       from site_app import app
E       ModuleNotFoundError: No module named 'site_app'

tests/test_instance_config.py:73: ModuleNotFoundError
______________________ test_installed_module_paths[False] ______________________

modules_tmpdir = local('/tmp/pytest-of-vedantroy/pytest-5/test_installed_module_paths_Fa0/modules_tmpdir')
modules_tmpdir_prefix = local('/tmp/pytest-of-vedantroy/pytest-5/test_installed_module_paths_Fa0/modules_tmpdir')
purge_module = <function purge_module.<locals>.inner at 0x7fdb884dd488>
site_packages = local('/tmp/pytest-of-vedantroy/pytest-5/test_installed_module_paths_Fa0/modules_tmpdir/lib/python3.6/site-packages')
limit_loader = None

    def test_installed_module_paths(modules_tmpdir, modules_tmpdir_prefix,
                                    purge_module, site_packages, limit_loader):
        site_packages.join('site_app.py').write(
            'import flask\n'
            'app = flask.Flask(__name__)\n'
        )
        purge_module('site_app')
    
>       from site_app import app
E       ModuleNotFoundError: No module named 'site_app'

tests/test_instance_config.py:73: ModuleNotFoundError
______________________ test_installed_package_paths[True] ______________________

limit_loader = None
modules_tmpdir = local('/tmp/pytest-of-vedantroy/pytest-5/test_installed_package_paths_T0/modules_tmpdir')
modules_tmpdir_prefix = local('/tmp/pytest-of-vedantroy/pytest-5/test_installed_package_paths_T0/modules_tmpdir')
purge_module = <function purge_module.<locals>.inner at 0x7fdb8850b950>
monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7fdb884f5a90>

    def test_installed_package_paths(limit_loader, modules_tmpdir,
                                     modules_tmpdir_prefix, purge_module,
                                     monkeypatch):
        installed_path = modules_tmpdir.mkdir('path')
        monkeypatch.syspath_prepend(installed_path)
    
        app = installed_path.mkdir('installed_package')
        init = app.join('__init__.py')
        init.write('import flask\napp = flask.Flask(__name__)')
        purge_module('installed_package')
    
>       from installed_package import app
E       ModuleNotFoundError: No module named 'installed_package'

tests/test_instance_config.py:89: ModuleNotFoundError
_____________________ test_installed_package_paths[False] ______________________

limit_loader = None
modules_tmpdir = local('/tmp/pytest-of-vedantroy/pytest-5/test_installed_package_paths_F0/modules_tmpdir')
modules_tmpdir_prefix = local('/tmp/pytest-of-vedantroy/pytest-5/test_installed_package_paths_F0/modules_tmpdir')
purge_module = <function purge_module.<locals>.inner at 0x7fdb884dd488>
monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7fdb8851b390>

    def test_installed_package_paths(limit_loader, modules_tmpdir,
                                     modules_tmpdir_prefix, purge_module,
                                     monkeypatch):
        installed_path = modules_tmpdir.mkdir('path')
        monkeypatch.syspath_prepend(installed_path)
    
        app = installed_path.mkdir('installed_package')
        init = app.join('__init__.py')
        init.write('import flask\napp = flask.Flask(__name__)')
        purge_module('installed_package')
    
>       from installed_package import app
E       ModuleNotFoundError: No module named 'installed_package'

tests/test_instance_config.py:89: ModuleNotFoundError
_______________________ test_prefix_package_paths[True] ________________________

limit_loader = None
modules_tmpdir = local('/tmp/pytest-of-vedantroy/pytest-5/test_prefix_package_paths_True0/modules_tmpdir')
modules_tmpdir_prefix = local('/tmp/pytest-of-vedantroy/pytest-5/test_prefix_package_paths_True0/modules_tmpdir')
purge_module = <function purge_module.<locals>.inner at 0x7fdb8850bc80>
site_packages = local('/tmp/pytest-of-vedantroy/pytest-5/test_prefix_package_paths_True0/modules_tmpdir/lib/python3.6/site-packages')

    def test_prefix_package_paths(limit_loader, modules_tmpdir,
                                  modules_tmpdir_prefix, purge_module,
                                  site_packages):
        app = site_packages.mkdir('site_package')
        init = app.join('__init__.py')
        init.write('import flask\napp = flask.Flask(__name__)')
        purge_module('site_package')
    
>       import site_package
E       ModuleNotFoundError: No module named 'site_package'

tests/test_instance_config.py:102: ModuleNotFoundError
_______________________ test_prefix_package_paths[False] _______________________

limit_loader = None
modules_tmpdir = local('/tmp/pytest-of-vedantroy/pytest-5/test_prefix_package_paths_Fals0/modules_tmpdir')
modules_tmpdir_prefix = local('/tmp/pytest-of-vedantroy/pytest-5/test_prefix_package_paths_Fals0/modules_tmpdir')
purge_module = <function purge_module.<locals>.inner at 0x7fdb8850bea0>
site_packages = local('/tmp/pytest-of-vedantroy/pytest-5/test_prefix_package_paths_Fals0/modules_tmpdir/lib/python3.6/site-packages')

    def test_prefix_package_paths(limit_loader, modules_tmpdir,
                                  modules_tmpdir_prefix, purge_module,
                                  site_packages):
        app = site_packages.mkdir('site_package')
        init = app.join('__init__.py')
        init.write('import flask\napp = flask.Flask(__name__)')
        purge_module('site_package')
    
>       import site_package
E       ModuleNotFoundError: No module named 'site_package'

tests/test_instance_config.py:102: ModuleNotFoundError
============== 8 failed, 492 passed, 13 skipped in 12.53 seconds ===============
```

### Environment

* Python version: 3.6.7
* Flask version: 1.1.dev
* Werkzeug version: 0.15.2

Ubuntu 18 LTS.
Here's the result of `ls` in the `flask` directory:
```
artwork           docs      Flask.egg-info  README.rst  tests
AUTHORS           env       LICENSE         scripts     tox.ini
CHANGES.rst       examples  Makefile        setup.cfg
CONTRIBUTING.rst  flask     MANIFEST.in     setup.py
```


Adding the missing `int` URL converter for URL variable, since the related route defaults value is integer type. Without it, the default redirect behavior described above will not be triggered.
If a uWSGI app handles query at the root path `/?query=xxx` then is mounted at the `https://host/app` by `uwsgi` and `nginx`, any query `https://host/app?query=xxx` would generate an HTTP error but `https://host/app/?query=xxx` will be successful.

This fix just redirects `https://host/app?query=xxx` to `https://host/app/?query=xxx`.
### Expected Behavior
The POST request to /login should result in a response with status code 200.

```python
    def initialize_authentication(self):
        soup = BeautifulSoup(self.client.get(os.environ['URL'] + "login/").data, features="html5lib")
        csrf_token = soup.find('input', dict(name='csrf_token'))['value']

        self.client.set_cookie(key='csrf_token', value=csrf_token, server_name='localhost')

        payload = {
            'username': os.environ['username'],
            'password': os.environ['password'],
        }
        headers = {
            'X-CSRFToken': csrf_token,
            'Accept': 'application/json'
        }

        response = self.client.post(os.environ['URL'] + "login/", data=payload, headers=headers,
                               follow_redirects=True)
        self.assertEqual(200, response.status_code, "Login Request failed!")
        return csrf_token
```

### Actual Behavior

Tell us what happens instead.

```pytb
Error
Traceback (most recent call last):
  File "/usr/lib/python3.5/unittest/case.py", line 58, in testPartExecutor
    yield
  File "/usr/lib/python3.5/unittest/case.py", line 596, in run
    self.setUp()
  File "/home/lenovo/Desktop/ML/mv/tests/mv_tests/integration_tests/parent_join_integration_tests.py", line 31, in setUp
    self.csrf_token = self.initialize_authentication()
  File "/home/lenovo/Desktop/ML/mv/tests/mv_tests/mv_base_tests.py", line 35, in initialize_authentication
    _, status_code = self.post(os.environ['URL'] + "login/", data=payload, csrf_token=csrf_token)
  File "/home/lenovo/Desktop/ML/mv/tests/mv_tests/mv_base_tests.py", line 58, in post
    rv = self.client.post(url, data=data, headers=self.get_headers(csrf_token), follow_redirects=True)
  File "/home/lenovo/Desktop/ML/mv/venv/lib/python3.5/site-packages/werkzeug/test.py", line 1038, in post
    return self.open(*args, **kw)
  File "/home/lenovo/Desktop/ML/mv/venv/lib/python3.5/site-packages/flask/testing.py", line 127, in open
    follow_redirects=follow_redirects)
  File "/home/lenovo/Desktop/ML/mv/venv/lib/python3.5/site-packages/werkzeug/test.py", line 1016, in open
    response, new_location, environ, buffered=buffered
  File "/home/lenovo/Desktop/ML/mv/venv/lib/python3.5/site-packages/werkzeug/test.py", line 947, in resolve_redirect
    return self.open(builder, as_tuple=True, buffered=buffered)
  File "/home/lenovo/Desktop/ML/mv/venv/lib/python3.5/site-packages/flask/testing.py", line 122, in open
    builder = make_test_environ_builder(self.application, *args, **kwargs)
  File "/home/lenovo/Desktop/ML/mv/venv/lib/python3.5/site-packages/flask/testing.py", line 29, in make_test_environ_builder
    url = url_parse(path)
  File "/home/lenovo/Desktop/ML/mv/venv/lib/python3.5/site-packages/werkzeug/urls.py", line 457, in url_parse
    i = url.find(s(":"))
AttributeError: 'EnvironBuilder' object has no attribute 'find'

```

### Environment

* Python version: 3.5.2
* Flask version: 0.12.2
* Werkzeug version: 0.15.1

Hi,
I prepared  presentation about locust with flaskr as test app.
http://ddarus.pythonanywhere.com/www/index.html#/step-11

In my case using falskr in docker makes its much simpler.

Maybe it will be useful for someone else.

Best Regards,
Darek 
### Expected Behavior

My code SHOULD dump a json object into the file using json.dump()

keep_alive.py

```python
from flask import Flask
from threading import Thread

app = Flask('')

@app.route('/')
def main():
    return "Your bot is alive!"

def run():
    app.run(host="0.0.0.0", port=8080)

def keep_alive():
    server = Thread(target=run)
    server.start()
```

main.py

```python
import discord, os, random, base64, json

"""from dotenv import DotEnv

dotenv = DotEnv()"""

import time




TOKEN = os.getenv('token')
ADMIN_ID = os.getenv('admin')

CURRENCY_DATA = json.load(open("text.json", 'r'))

yee = discord.Client()

@yee.event
async def on_ready():
  await yee.send_message(yee.get_channel('558024841572253706'), "Ready")
  await yee.change_presence(game=discord.Game(name="use b!help for help!"))
  
message_log = []

@yee.event
async def on_message(message):
  if message.author == yee.user:
    return
  
  if message.content.startswith('b!hello'):
    msg = "Hello, {0.author.mention}".format(message)
    await yee.send_message(message.channel, msg)
    return
  
  if message.content.startswith('b!invite'):
    msg = "{0.author.mention} Go to https://discordapp.com/oauth2/authorize?client_id=555115104769933383&scope=bot".format(message)
    await yee.send_message(message.channel, msg)
    return
  
  if message.content.startswith('b!help'):
    msg = "{0.author.mention}\n```\nb!hello - say hello to the bot!\nb!invite - invite me to your server!\nb!help - You just used this command!".format(message)
    msg += "\nb!luckynumber - gives you a lucky number!\nb!bal - look at how many testcoin you have\nb!shop - look at the various money genorators that you can/can't buy!\n"
    msg += "b!buy <x> - use to buy generator with a purchase ID of x (remove the brackets)\n```"
    await yee.send_message(message.channel, msg)
    return
  
  if message.content.startswith('b!luckynumber'):
    msg = "{0.author.mention} Your lucky number is ".format(message) + str(random.randint(0,9999))
    await yee.send_message(message.channel, msg)
    return

  if message.content.startswith('b!bal'):
    if str(message.author.id) not in CURRENCY_DATA["Users"]:
      CURRENCY_DATA["Money"][str(message.author.id)] = 0.0001
      CURRENCY_DATA["Updates"][str(message.author.id)] = time.time()
      CURRENCY_DATA["Money Inventory"][str(message.author.id)] = [0,0,0]
      CURRENCY_DATA["Users"].append(str(message.author.id))
      CURRENCY_DATA["Inventory"][str(message.author.id)] = []
    for i in range(len(CURRENCY_DATA["Money Generators"])):
        CURRENCY_DATA["Money"][str(message.author.id)] += round(CURRENCY_DATA["Money Inventory"][str(message.author.id)][i] * CURRENCY_DATA["Money Generators"][i]["CPS"] * (time.time() - CURRENCY_DATA["Updates"][str(message.author.id)]), 5)
    CURRENCY_DATA["Updates"][str(message.author.id)] = time.time()
    CURRENCY_DATA["Money"][str(message.author.id)] = round(CURRENCY_DATA["Money"][str(message.author.id)], 5)
    msg = "{0.author.mention}, You have {1} TestCoin.".format(message, CURRENCY_DATA["Money"][str(message.author.id)])
    await yee.send_message(message.channel, msg)
    json.dump(CURRENCY_DATA, open('text.json','w'))
    return

  if message.content.startswith('b!shop'):
      if str(message.author.id) not in CURRENCY_DATA["Users"]:
        CURRENCY_DATA["Money"][str(message.author.id)] = 0.0001
        CURRENCY_DATA["Updates"][str(message.author.id)] = time.time()
        CURRENCY_DATA["Money Inventory"][str(message.author.id)] = [0,0,0]
        CURRENCY_DATA["Users"].append(str(message.author.id))
        CURRENCY_DATA["Inventory"][str(message.author.id)] = []
      for i in range(len(CURRENCY_DATA["Money Generators"])):
        CURRENCY_DATA["Money"][str(message.author.id)] += round(CURRENCY_DATA["Money Inventory"][str(message.author.id)][i] * CURRENCY_DATA["Money Generators"][i]["CPS"] * (time.time() - CURRENCY_DATA["Updates"][str(message.author.id)]), 5)
      CURRENCY_DATA["Updates"][str(message.author.id)] = time.time()
      msg = "{0.author.mention}, You have {1} TestCoin.".format(message, CURRENCY_DATA["Money"][str(message.author.id)])
      msg += '\n```\n'
      for i in CURRENCY_DATA["Money Generators"]:
          msg += i['name'] + ' $'
          msg += str(i['increase_amount'] * (1 + CURRENCY_DATA["Money Inventory"][str(message.author.id)][i['id']]) * i['base_price']) + '\n'
          msg += i['info'] + '\n'
          msg += 'Purchase code: ' + str(i['id']) + '\n\n'
      msg += '\n```'
      await yee.send_message(message.channel, msg)
      json.dump(CURRENCY_DATA, open('text.json', 'w'))
      return
  
  if message.content.startswith('b!buy'):
      for i in range(len(CURRENCY_DATA["Money Generators"])):
        CURRENCY_DATA["Money"][str(message.author.id)] += round((1 + CURRENCY_DATA["Money Inventory"][str(message.author.id)][i]) * CURRENCY_DATA["Money Generators"][i]["CPS"] * (time.time() - CURRENCY_DATA["Updates"][str(message.author.id)]), 5)
      CURRENCY_DATA["Updates"][str(message.author.id)] = time.time()
      buy_id = message.content[5:]
      try:
          try:
              adjusted_cost = CURRENCY_DATA["Money Generators"][int(buy_id)]["base_price"] * (CURRENCY_DATA["Money Generators"][int(buy_id)]['increase_amount'] * CURRENCY_DATA["Money Inventory"][str(message.author.id)][int(buy_id)])
          except ValueError:
              await yee.send_message(message.channel, "The value of the generator you are trying to buy could not be converted. blease try again using the purchase code of the generator you want to buy.")
              return
      except IndexError:
          await yee.send_message(message.channel, "The purchase id is not valid")
          return
      if CURRENCY_DATA["Money"][str(message.author.id)] >= adjusted_cost:
          CURRENCY_DATA["Money"][str(message.author.id)] -= adjusted_cost
          CURRENCY_DATA["Money Inventory"][str(message.author.id)][int(buy_id)] += 1
          await yee.send_message(message.channel, "Purchase successful.")
          return
      else:
          await yee.send_message(message.channel, "Error, not enough funds")
          return

  if message.content.startswith('b!inventory'):
    if str(message.author.id) not in CURRENCY_DATA["Users"]:
      CURRENCY_DATA["Money"][str(message.author.id)] = 0.0001
      CURRENCY_DATA["Updates"][str(message.author.id)] = time.time()
      CURRENCY_DATA["Money Inventory"][str(message.author.id)] = [0,0,0]
      CURRENCY_DATA["Users"].append(str(message.author.id))
      CURRENCY_DATA["Inventory"][str(message.author.id)] = []
    msg = "```\n"
    for i in CURRENCY_DATA["Inventory"][str(message.author.id)]:
      msg += CURRENCY_DATA["Items"][i["id"]]["Name"] + ' ' + str(i["quantity"]) + '\n'
    msg += '```'
    await yee.send_message(message.channel, msg)
    json.dump(CURRENCY_DATA, open('text.json','w'))
    return

  if message.content.startswith('b@') and message.author.id == ADMIN_ID:
    if message.content.startswith('b@dumpchannels'):
      msg = '```\n'
      channels = yee.get_all_channels()
      a = 0
      for i in channels:
        msg += str(i.name).ljust(25,'-') + str(i.id).ljust(25,'-') + str(i.server) + '\n'
        a += 1
        if a > 19:
          await yee.send_message(message.channel, msg+'```')
          a = 0
          msg = '```\n'
      msg += '```'
      print(msg)
      await yee.send_message(message.channel, msg)
      return
  else:
    if message.content.startswith('b@'):
      await yee.send_message(message.channel, message.author.mention + ', you do not have access to this command!')

yee.run(TOKEN)

import keep_alive
keep_alive.keep_alive() 
```

### Actual Behavior

This code does not update the JSON file

No errors

### Environment

* Python version: 3.6
* Flask version: 0.12
* Werkzeug version:N/A

## Ask help for my demo
Hey, guys. I deploy the simple demo on my server, and then use 'export FLASK_APP=demo.py' , 'flask run --host=0.0.0.0' to launch the program. 
However, I have tried every possible way to visit my web page, but failed all the same. It shows `time out`. I'm waiting sincerely for your help!!

### My code:
 ```
from flask import Flask
 app = Flask(__name__)
 
@app.route('/')
def hello_world():
    return 'Hello, World!'

if __name__ == '__main__':
    app.run( host='0.0.0.0',port=5000)
```
### Note:
1. I am sure there firewall(iptables) is closed on my server.
2. I used Chrome to visit the web page, and got the result `time out`.

(I am not very exprienced) 
Whenever I try to run the code, I get this error: 

Traceback (most recent call last):
  File "C:\Users\User\source\repos\FlaskWebProject1\FlaskWebProject1\FlaskWebProject1\views.py", line 48, in <module>
    @app.route('/register', methods=['GET', 'POST'])
  File "C:\Program Files (x86)\Microsoft Visual Studio\Shared\Anaconda3_64\lib\site-packages\flask\app.py", line 1250, in decorator
    self.add_url_rule(rule, endpoint, f, **options)
  File "C:\Program Files (x86)\Microsoft Visual Studio\Shared\Anaconda3_64\lib\site-packages\flask\app.py", line 66, in wrapper_func
    return f(self, *args, **kwargs)
  File "C:\Program Files (x86)\Microsoft Visual Studio\Shared\Anaconda3_64\lib\site-packages\flask\app.py", line 1221, in add_url_rule
    'existing endpoint function: %s' % endpoint)
AssertionError: View function mapping is overwriting an existing endpoint function: register
Press any key to continue . . .

This is the function register:

@app.route('/register', methods=['GET', 'POST'])
def register():
    form = RegistrationForm(request.form)
    if request.method == 'POST' and form.validate():
        user = User(form.username.data, form.email.data,
                    form.password.data)
        db_session.add(user)
        flash('Thanks for registering')
        return redirect(url_for('/home'))
    else:
        return render_template(
            'register.html', 
            year=datetime.now().year,
            month=datetime.now().month,
            day=datetime.now().day,
            hour=datetime.now().hour,
            minute=datetime.now().minute,
            form=form
         )
Can anyone help me?

I don't know what's causing this error, as I've just added few lines of code and it just seemed to ruin the code.

Here is the function register and it's class + app.route.
class RegistrationForm(Form):
    username = StringField('Username', [validators.Length(min=4, max=25, message='Username must be 4-25 chars long')])
    email = StringField('Email Address', [validators.Length(min=6, max=35, message='Email must be 6-35 chars long')])
    password = PasswordField('Password', [validators.Length(min=8, max=12, message='Passwords must be 8-12 chars long')])
    confirm = PasswordField('Repeat Password')
    
    accept_tos = BooleanField('I accept the new user', [validators.DataRequired()])

@app.route('/register', methods=['GET', 'POST'])
def register():
    form = RegistrationForm(request.form)
    if request.method == 'POST' and form.validate():
        user = User(form.username.data, form.email.data,
                    form.password.data)
        db_session.add(user)
        flash('Thanks for registering')
        return redirect(url_for('/home'))
    return render_template(
        'register.html', 
        year=datetime.now().year,
        month=datetime.now().month,
        day=datetime.now().day,
        hour=datetime.now().hour,
        minute=datetime.now().minute,
        form=form
     )

There's just this error: 

Traceback (most recent call last):
  File "C:\Users\User\source\repos\FlaskWebProject1\FlaskWebProject1\FlaskWebProject1\views.py", line 47, in <module>
    @app.route('/register', methods=['GET', 'POST'])
  File "C:\Program Files (x86)\Microsoft Visual Studio\Shared\Anaconda3_64\lib\site-packages\flask\app.py", line 1250, in decorator
    self.add_url_rule(rule, endpoint, f, **options)
  File "C:\Program Files (x86)\Microsoft Visual Studio\Shared\Anaconda3_64\lib\site-packages\flask\app.py", line 66, in wrapper_func
    return f(self, *args, **kwargs)
  File "C:\Program Files (x86)\Microsoft Visual Studio\Shared\Anaconda3_64\lib\site-packages\flask\app.py", line 1221, in add_url_rule
    'existing endpoint function: %s' % endpoint)
AssertionError: View function mapping is overwriting an existing endpoint function: register
Press any key to continue . . .


* Python version: newest
* Flask version: newest

Altered the proxy-setup docs to replace deprecated sample code as per issue #3139 

It's my first PR so if there's anything I've done wrong then give me a shout!

closes #3139
I'm trying to run a Tacotron-2 training in flask, get parameters in json format. but the following error arises when I execute the training:

```
ARNING: The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
If you depend on functionality not listed there, please file an issue.
Using TensorFlow backend.
 * Serving Flask app "server" (lazy loading)
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: on
 * Running on http://0.0.0.0:8891/ (Press CTRL+C to quit)
 * Restarting with stat
/usr/local/lib/python3.6/dist-packages/numba/errors.py:105: UserWarning: Insufficiently recent colorama version found. Numba requires colorama >= 0.3.9
  warnings.warn(msg)
WARNING: The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
If you depend on functionality not listed there, please file an issue.
Using TensorFlow backend.
 * Debugger is active!
 * Debugger PIN: 303-138-053
Checkpoint path: logs-Tacotron-2/taco_pretrained/tacotron_model.ckpt
Loading training data from: tacotron-files/servex-tacotron/training_data/train.txt
Using model: Tacotron
Hyperparameters:
  GL_on_GPU: True
  NN_init: True
  NN_scaler: 0.3
  allow_clipping_in_normalization: True
  attention_dim: 128
  attention_filters: 32
  attention_kernel: (31,)
  attention_win_size: 7
  batch_norm_position: after
  cbhg_conv_channels: 128
  cbhg_highway_units: 128
  cbhg_highwaynet_layers: 4
etc...
Tacotron Parameters       29.039 Million.
WARNING:tensorflow:From /usr/local/lib/python3.6/dist-packages/tensorflow/python/ops/losses/losses_impl.py:667: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.cast instead.
initialisation done /gpu:0
Initialized Tacotron model. Dimensions (? = dynamic shape): 
  Train mode:               False
  Eval mode:                True
  GTA mode:                 False
  Synthesis mode:           False
  Input:                    (?, ?)
  device:                   0
  embedding:                (?, ?, 512)
  enc conv out:             (?, ?, 512)
  encoder out:              (?, ?, 512)
  decoder out:              (?, ?, 80)
  residual out:             (?, ?, 512)
  projected residual out:   (?, ?, 80)
  mel out:                  (?, ?, 80)
  linear out:               (?, ?, 1025)
  <stop_token> out:         (?, ?)
  Tacotron Parameters       29.039 Million.
Tacotron training set to a maximum of 200000 steps
holaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
Loading checkpoint logs-Tacotron-2/taco_pretrained/tacotron_model.ckpt-0
WARNING:tensorflow:From /usr/local/lib/python3.6/dist-packages/tensorflow/python/training/saver.py:1266: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
Exiting due to exception: '<' not supported between instances of 'int' and 'str'
Traceback (most recent call last):
  File "/home/manuel_garcia02/Tacotron/tacotron/train.py", line 224, in train
    while not coord.should_stop() and step < args.tacotron_train_steps:
TypeError: '<' not supported between instances of 'int' and 'str'
186.179.100.228 - - [07/Apr/2019 02:52:15] "POST /tts/train HTTP/1.1" 200 -
Generated 15 test batches of size 32 in 0.891 sec
Generated 64 train batches of size 32 in 2.169 sec
Exception in thread background:
Traceback (most recent call last):
  File "/usr/lib/python3.6/threading.py", line 916, in _bootstrap_inner
    self.run()
  File "/usr/lib/python3.6/threading.py", line 864, in run
    self._target(*self._args, **self._kwargs)
  File "/home/manuel_garcia02/Tacotron/tacotron/feeder.py", line 169, in _enqueue_next_train_group
    self._session.run(self._enqueue_op, feed_dict=feed_dict)
  File "/usr/local/lib/python3.6/dist-packages/tensorflow/python/client/session.py", line 929, in run
    run_metadata_ptr)
  File "/usr/local/lib/python3.6/dist-packages/tensorflow/python/client/session.py", line 1075, in _run
    raise RuntimeError('Attempted to use a closed Session.')



```
Why can it be produced?
---

### Expected Behavior

I should start training normally

```python
Paste a minimal example that causes the problem.
```

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version: 3.6
* Flask version: 1.0.2
* Werkzeug version:

### Expected Behavior

I'm trying to add a decorator to a flask route, but the status code of the Response object is wrong. Here's an example (note I changed the status code to 202 just as an example):

```python
from flask import Flask, jsonify
from functools import wraps

def my_decorator(og_func):
    @wraps(og_func)
    def wrapper(*args, **kwargs):
        result, status_code = og_func(*args, **kwargs)
        print(f"status code of flask.wrappers.Response object: {result.status_code}")
        print(f"status code of actual response: {status_code}")
        # log status code somewhere
        return result, status_code
    return wrapper

app = Flask(__name__)

@app.route("/")
@my_decorator
def home():
    data = {"hello": "world"}
    return jsonify(data), 202
```

I'd image the status code on the response object would be the same as the status code I returned.

### Actual Behavior

If I run this flask api and hit the home endpoint using postman or curl, I get the following logs on my backend:

```pytb
status code of Response object: 200
status code of actual response: 202
127.0.0.1 - - [04/Apr/2019 11:44:42] "GET / HTTP/1.1" 202 -
```

Any reason why the status code on the response object is incorrect? Am I doing something wrong or is this a bug?

### Environment

* Python version: 3.6.8
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

In the document of [proxy-setup](http://flask.pocoo.org/docs/1.0/deploying/wsgi-standalone/#proxy-setups),
`from werkzeug.contrib.fixers import ProxyFix` has been deprecated since werkzeug 0.15.
The sample code should be `from werkzeug.middleware.proxy_fix import ProxyFix`.

The sample usage become `app.wsgi_app = ProxyFix(app.wsgi_app, x_proto=1)` that 
works for my application behind HTTPS proxy.

Reference:
* https://werkzeug.palletsprojects.com/en/0.15.x/contrib/fixers/
* https://werkzeug.palletsprojects.com/en/0.15.x/middleware/proxy_fix
To reproduce:
```python
import flask
import flask.views

class BaseView(flask.views.MethodView):
    methods = ['GET', 'PROPFIND']

class MyView(BaseView):
    def get(self):
        return None, 200
    def propfind(self):
        return None, 200

app = flask.Flask(__name__)
app.add_url_rule('/test', view_func=MyView.as_view('test'))

for rule in app.url_map.iter_rules():
    print(rule, ','.join(rule.methods))
```

### Expected Behavior
````
/test OPTIONS,PROPFIND,GET,HEAD
/static/<path:filename> OPTIONS,GET,HEAD
````

### Actual Behavior
````
/test OPTIONS,GET,HEAD
/static/<path:filename> OPTIONS,GET,HEAD
````

### Environment

* Python version: 3.7.1
* Flask version: Python 3.7.1 (default, Dec 10 2018, 22:54:23) [MSC v.1915 64 bit (AMD64)] :: Anaconda, Inc. on win32
* Werkzeug version: 0.15.2

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->


```python
@app.route('/', defaults={'path': ''}, methods=['GET', 'POST'])
def catch_all(path):
     session_id = 'session1'
     if session_id not in sessions:
         session = Session()
         sessions[session_id] = session
     else:
         session = sessions[session_id]

     session.start()
     queue = register_queue()
     def events():
         try:
             if queue:
                 while True:
                     for _, data in queue:
                         yield data
         finally:
             # THIS POINT HERE IS NEVER BEING REACHED
             # FOR SOME CLIENTS, becase the connection
             # is getting stuck in the CLOSE_WAIT state

             deregister_queue(queue)
             if len(queues) == 0:
                 session.kill()
                 del sessions[session_id]

  return Response(events(), content_type='text/event-stream')
```

### Expected Behavior

All sockets are getting closed after they are closed from the client side.

### Actual Behavior

Some sockets are getting stuck in the CLOSE_WAIT state
after they are closed from the client side.

### Environment

* Python version: Python 2.7.16rc1
* Flask version: `Flask==1.0.2`
* Werkzeug version: `Werkzeug==0.15.1`
* gevent version: `gevent==1.4.0`
https://github.com/pallets/flask/blob/a74864ec229141784374f1998324d2cbac837295/flask/app.py#L560

Urljoin seems like more robust way to join urls. I just tried to set static_url_path = '/' and it failed, but static_url_path = '' succeed. IMHO, this is bad and unexpected behaviour.
### Expected Behavior

App run with debug mode raise OSError
```python
app = make_app()
celery = make_celery(app)
KafkaProducerExt(app)
if __name__ == "__main__":
    app.run(debug=True)

```

### Actual Behavior

App run with debug mode raise OSError, when i change debug to False, everything ok
```pytb
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: on
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
Traceback (most recent call last):
  File "app/app.py", line 8, in <module>
    app.run(debug=True)
  File "/home/khanhdv/.virtualenvs/api_jd/lib/python3.5/site-packages/flask/app.py", line 943, in run
    run_simple(host, port, self, **options)
  File "/home/khanhdv/.virtualenvs/api_jd/lib/python3.5/site-packages/werkzeug/serving.py", line 988, in run_simple
    run_with_reloader(inner, extra_files, reloader_interval, reloader_type)
  File "/home/khanhdv/.virtualenvs/api_jd/lib/python3.5/site-packages/werkzeug/_reloader.py", line 332, in run_with_reloader
    sys.exit(reloader.restart_with_reloader())
  File "/home/khanhdv/.virtualenvs/api_jd/lib/python3.5/site-packages/werkzeug/_reloader.py", line 176, in restart_with_reloader
    exit_code = subprocess.call(args, env=new_environ, close_fds=False)
  File "/usr/lib/python3.5/subprocess.py", line 557, in call
    with Popen(*popenargs, **kwargs) as p:
  File "/usr/lib/python3.5/subprocess.py", line 947, in __init__
    restore_signals, start_new_session)
  File "/usr/lib/python3.5/subprocess.py", line 1551, in _execute_child
    raise child_exception_type(errno_num, err_msg)
OSError: [Errno 8] Exec format error

```

### Environment

* Python version: Python 3.5.2 
* Flask version:1.0.2
* Werkzeug version:0.15.1

**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

Tell us what should happen.

```python
Paste a minimal example that causes the problem.
```

### Actual Behavior

Tell us what happens instead.

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version:
* Flask version:
* Werkzeug version:

**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

run should work

this is the project can reproduce the bug

```python
https://github.com/cielpy/flask_bug

pipenv install
pipenv run python run.py
```

### Actual Behavior

crashed

```pytb
$ pipenv run python run.py
 * Serving Flask app "app" (lazy loading)
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: on
 * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)
 * Restarting with stat
Traceback (most recent call last):
  File "run.py", line 3, in <module>
    app.run(host='0.0.0.0', debug=True)
  File "/Users/xxx/Documents/workspace/flask_bug/.venv/lib/python3.6/site-packages/flask/app.py", line 943, in run
    run_simple(host, port, self, **options)
  File "/Users/xxx/Documents/workspace/flask_bug/.venv/lib/python3.6/site-packages/werkzeug/serving.py", line 988, in run_simple
    run_with_reloader(inner, extra_files, reloader_interval, reloader_type)
  File "/Users/xxx/Documents/workspace/flask_bug/.venv/lib/python3.6/site-packages/werkzeug/_reloader.py", line 332, in run_with_reloader
    sys.exit(reloader.restart_with_reloader())
  File "/Users/xxx/Documents/workspace/flask_bug/.venv/lib/python3.6/site-packages/werkzeug/_reloader.py", line 176, in restart_with_reloader
    exit_code = subprocess.call(args, env=new_environ, close_fds=False)
  File "/Users/xxx/.pyenv/versions/3.6.5/lib/python3.6/subprocess.py", line 267, in call
    with Popen(*popenargs, **kwargs) as p:
  File "/Users/xxx/.pyenv/versions/3.6.5/lib/python3.6/subprocess.py", line 709, in __init__
    restore_signals, start_new_session)
  File "/Users/xxx/.pyenv/versions/3.6.5/lib/python3.6/subprocess.py", line 1344, in _execute_child
    raise child_exception_type(errno_num, err_msg, err_filename)
FileNotFoundError: [Errno 2] No such file or directory: '/Users/xxx/Documents/workspace/flask_bug/run.py': '/Users/xxx/Documents/workspace/flask_bug/run.py'
```

### Environment

* Python version: 3.6.5
* Flask version: 1.0.2
* Werkzeug version: 0.15.1

with Werkzeug 0.14.1, this will not happened
Issue came up while trying to send an empty file (and filename) to an HTTPbin form.
Using Flask you're unable to differentiate between the content of a text field in a form and a non-uploaded file from the `request` object

### Example test
Using flask alone;
User @moy helped with this and prompted me to post this bug report
```python
from flask import Flask, flash, request, redirect, url_for, escape

app = Flask(__name__)

@app.route('/', methods=['GET', 'POST'])
def upload_file():
    if request.method == 'POST':
        return '<pre>{}</pre>'.format(escape(str(request.form) + '\n' + str(request.files)))
    return '''
    <!doctype html>
    <title>Upload new Files</title>
    <h1>Upload new Files</h1>
    <form method=post enctype=multipart/form-data>
      <input name="normal_field" value="field_value" />
      <input type=file name=file>
      <input type=file name=secondfile>
      <input type=submit value=Upload>
    </form>
    '''
```
### Expected Behavior
Submitting with only the first file field set in the browser,
one would expect to find :
- the content of both file fields in the same object ;
- the content of normal text input fields in a separate objects ;

So something along the lines of
```
ImmutableMultiDict([('normal_field', 'field_value')])
ImmutableMultiDict([('file', <FileStorage: 'tmp-rg1.xpi' ('application/x-xpinstall')>), 
                    ('secondfile', <FileStorage: '' ('...')>)
                   ])
```

### Actual Behavior
Submitting with only one file (the first field) set in the browser gives:

```
ImmutableMultiDict([('normal_field', 'field_value'), ('secondfile', '')])
ImmutableMultiDict([('file', <FileStorage: 'tmp-rg1.xpi' ('application/x-xpinstall')>)])
```

The first is the form's field, the second the actual files uploaded. I see no way to distinguish between an empty text field and a non-uploaded file from the `request` object.
Is this behavior intended ?

These are unlikely to be copy-pasted by users but it's best practice to avoid it and other examples do.


The code as shown in http://flask.pocoo.org/docs/1.0/testing/#logging-in-and-out should authenticate and log out user but with Werkzeug 0.15 it does not cause log out. Downgrading to 0.14.1 makes the code to work as expected.
---

### Expected Behavior
In my Flask project (Debian 8.10 VM, vagrant and virtualenvs), I use mapnik, and it's installed with apt-get (_with pip, there's a lot of errors_) : 
```shell
$ sudo apt-get install libmapnik2.2 mapnik-utils python-mapnik python-mapnik2    

$ dpkg -l | grep mapnik
ii  libmapnik2.2                         2.2.0+ds1-7+b2                     amd64        C++/Python toolkit for developing GIS applications (libraries)
ii  mapnik-utils                         2.2.0+ds1-7+b2                     amd64        C++/Python toolkit for developing GIS applications (utilities)
ii  python-mapnik                        2.2.0+ds1-7+b2                     amd64        C++/Python toolkit for developing GIS applications (Python)
ii  python-mapnik2                       2.2.0+ds1-7                        all          C++/Python toolkit for developing GIS applications (dummy)

```
I use an apache's virtualhost : 
```apache
<VirtualHost *:80>
        ServerName vm.my_app
        DocumentRoot /var/www/my_app/my_app
        WSGIDaemonProcess flask_my_app user=www-data group=www-data python-path=/var/www/my_app/my_app:/home/vagrant/.virtualenvs/my_app/lib/python2.7/site-packages display-name=%{GROUP}
        WSGIProcessGroup flask_my_app
        WSGIScriptAlias / /var/www/my_app/my_app/flask_my_app/flask_my_app.wsgi
        WSGIApplicationGroup %{GLOBAL}
        WSGIPassAuthorization on
        WSGIScriptReloading On

        Alias /site_media/ /var/www/my_app/my_app/site_media/
        Alias /media/ /var/www/my_app/my_app/media/
        Alias /static/ /var/www/my_app/my_app/static/
        AliasMatch /([/]*\.css) /var/www/my_app/my_app/static/css/$1

        <Directory /var/www/my_app/my_app>
            Order allow,deny
            Allow from all
            Require all granted
        </Directory>

        <Directory /var/www/my_app/my_app/flask_my_app>
            Order allow,deny
            Allow from all
            Require all granted
        </Directory>

</VirtualHost>
```
Ok, it's fine..., except that I must add some characters in the wsgi file when I change my code :(

And, so here the error : 
```
(No module named mapnik --> <type 'exceptions.ImportError'> => 
Traceback (most recent call last): 
File "/var/www/my_app/my_app/flask_my_app/views.py", line 202, in zonesmeteo t = importlib.import_module('cron_dept_treatments.%s' % dept_code) 
File "/usr/lib/python2.7/importlib/__init__.py", line 37, in import_module __import__(name) 
File "/var/www/my_app/my_app/cron_dept_treatments/20.py", line 17, in <module> import mapnik ImportError: No module named mapnik )
```
```pytb
(my_env)    
$ python
Python 2.7.12 (default, Nov 12 2018, 14:36:49)
[GCC 5.4.0 20160609] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import flask
>>> flask.__path__
['/home/vagrant/.virtualenvs/my_app/local/lib/python2.7/site-packages/flask']
>>> import mapnik
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ImportError: No module named mapnik
>>> quit()

(my_env)
$ deactivate

$ python
Python 2.7.9 (default, Sep 25 2018, 20:42:16)
[GCC 4.9.2] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import mapnik
>>> mapnik.__path__
['/usr/lib/python2.7/dist-packages/mapnik']
>>>
```

### Environment

* Python version: 2.7
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

Thanks
F.

pallets/werkzeug#1445 moved Flask's `JSONMixin` to Werkzeug. Flask should now use Werkzeug's version, with some overrides. Will need to bump minimum Werkzeug version.
the documentation of the application object specifies static parameters:

static_url_path – can be used to specify a different path for the static
files on the web. **Defaults to the name of the static_folder folder.**

static_folder – the folder with static files that should be served at
static_url_path. Defaults to the 'static' folder in the root path of the
application.

so by my understanding,

`app=Flask(__name__, static_folder='')`

should allow for arbitrary (absolute) path structure for all static
files. it doesn't. but the following does:

`app=Flask(__name__, static_folder='', static_url_path='')`

given the above doc strings, that appears inconsistent

for this specific case (`static_folder=''`), stepping through the
codebase yielded:

<Rule '//<filename>' (GET, OPTIONS, HEAD) -> static> 
`re.compile('^\\|//(?P<filename>[^/].*?)$')`

which is an expression that can never be satisfied by a valid url

please consider this trivial patch. i hope the tests are appropriate
too, it was difficult to know how much of the mechanism to incorporate
for such a small change

commit message:

-prefix a path delimiter iff there's a path to delimit
-ensures a valid default static route rule is created on application
intialisation for the case 'static_folder=""' and implicit
'static_url_path'

todo
* add a changelog entry if this patch changes code
```python
return Response(
            csv, 
            mimetype="text/csv",
            headers={"Content-disposition":
                    "attachment; filename={{**here i want to dynamic variable**}}"})
```
**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

Tell us what should happen.

```python
Paste a minimal example that causes the problem.
```

### Actual Behavior

Tell us what happens instead.

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version:
* Flask version:
* Werkzeug version:

Dear flask developers,

I'm a new flask user.

After installing flask according to README.md,I got stuck in "A Simple Example section".

I think it is just because I couldn't see any comment in "A Simple Example section".

In order to refine "A Simple Example section", I have just added some comments to "A Simple Example section".
 
you can see the modification below.
https://github.com/pallets/flask/compare/master...50storm:readme_branch

It would be greatful if you accept my requent.

Sincerely yours.
安装虚拟环境的时候，报了如下错误，请问有什么办法解决，pipfile里面的url已经失效了，是否有新的可提供一下？
D:\personal-study\helloflask>pipenv install
Creating a virtualenv for this project...
Pipfile: D:\personal-study\helloflask\Pipfile
Using c:\python27\python.exe (None) to create virtualenv...
Traceback (most recent call last):
  File "c:\python27\lib\runpy.py", line 162, in _run_module_as_main
    "__main__", fname, loader, pkg_name)
  File "c:\python27\lib\runpy.py", line 72, in _run_code
    exec code in run_globals
if i can use the cassandra ,so how to do it?

Changes the snippet in the config documentation to no longer assign a bool as the default value from os.environ.get()
### Expected Behavior

In the docs/config.rst#configuring-from-environment-variables

There is a code snippet that should get the Debug config value from the DEBUG environment variable.


### Actual Behavior
The code snippet for getting the Debug value from an environment variable produces an error.

Here is a minimal example:

```python
import os

ENVIRONMENT_DEBUG = os.environ.get("DEBUG", default=False)
if ENVIRONMENT_DEBUG.lower() in ("f", "false"):
    ENVIRONMENT_DEBUG = False
```

This produces the error:
```
Traceback (most recent call last):
  File "simple_test.py", line 4, in <module>
    if ENVIRONMENT_DEBUG.lower() in ("f", "false"):
AttributeError: 'bool' object has no attribute 'lower'
```

### Environment

* Python version: Python 3.7.0
* Flask version: N/A
* Werkzeug version: N/A

### Analysis

This is due to the default value for the os.environ.get being set to a bool value, which you cannot use the .lower() function on.

I know that problems listed below are solved in both jinja2 and werkzeug repos, but they are not released. Without new releases of both, users will be stuck with python 3.7.

Currently running pytest in my projects produces following warnings:
```
============================== warnings summary ===============================
C:\Program Files\Python37\lib\site-packages\werkzeug\datastructures.py:16
C:\Program Files\Python37\lib\site-packages\werkzeug\datastructures.py:16
C:\Program Files\Python37\lib\site-packages\werkzeug\datastructures.py:16
  C:\Program Files\Python37\lib\site-packages\werkzeug\datastructures.py:16: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working
    from collections import Container, Iterable, MutableSet

C:\Program Files\Python37\lib\site-packages\jinja2\utils.py:485
  C:\Program Files\Python37\lib\site-packages\jinja2\utils.py:485: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working
    from collections import MutableMapping

C:\Program Files\Python37\lib\site-packages\jinja2\runtime.py:318
  C:\Program Files\Python37\lib\site-packages\jinja2\runtime.py:318: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working
    from collections import Mapping
```
---

### Expected Behavior

No warning preventing usage of python 3.8 should be displayed.

### Actual Behavior

Warnings pasted above are displayed ;)

### Environment

* Python version: 3.7
* Flask version: 1.0.2
* Werkzeug version: 0.14.1
* Jinja2 version: 2.10
### Description
If you have python file with wsgi extension (or any other than .py), you can't execute `flask run` command. (When you execute the script with .run() in it, it works fine).

### Example
For example when you create file `app.wsgi` with simple content:
```python
from flask import Flask
app = Flask(__name__)
```
And of course you set the environment variable `FLASK_APP=app.wsgi`
you actually get:
```pytb
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/flask/cli.py", line 325, in __call__
    self._flush_bg_loading_exception()
  File "/usr/local/lib/python2.7/dist-packages/flask/cli.py", line 313, in _flush_bg_loading_exception
    reraise(*exc_info)
  File "/usr/local/lib/python2.7/dist-packages/flask/cli.py", line 302, in _load_app
    self._load_unlocked()
  File "/usr/local/lib/python2.7/dist-packages/flask/cli.py", line 317, in _load_unlocked
    self._app = rv = self.loader()
  File "/usr/local/lib/python2.7/dist-packages/flask/cli.py", line 372, in load_app
    app = locate_app(self, import_name, name)
  File "/usr/local/lib/python2.7/dist-packages/flask/cli.py", line 246, in locate_app
    'Could not import "{name}".'.format(name=module_name)
NoAppException: Could not import "app.wsgi".
```
I think it's essential to run also wsgi files (you can run "default" wsgi.py, but not anything with .wsgi in the end)

### Environment

* Python version: 2.7.15rc1
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

flask01.py
@app.route('/')
def hello_world1():
    client = papirpcclient01.RPCMSG()
    data = {'jsonrpc': '2.0', 'method': 'get_bdevs', 'id': 1}
    time.sleep(15)
    recvdata = json.dumps(client.receivemsg())
    print("route1:", recvdata)
    return Response(recvdata,  mimetype='application/json')

@app.route('/1')
def papihello():
	print("/route1")
    	papirpcclient01.reactor.run()
	#papirpcclient01.reactor.run(installSignalHandlers=0)
        return "reactor.run"+'\n'

papirpcclient01.py

class RPCClient(protocol.Protocol):
  
    def connectionMade(self):
	print("connectionMade:")
    
    def dataReceived(self, data):
        "As soon as any data is received, write it back."
        #print("Server said:", data)
        log.msg("dataReceived=:"+data)
	response = json.loads(data)
	#recvmsg.append(response)
        reactor.callInThread(sendtoqueue,response)
    
    def connectionLost(self, reason):
        print("connection lost")

class RPCClientFactory(protocol.ClientFactory):

	def __init__(self):
		self.deferred=defer.Deferred()
        	self.protocol = None
	
	def startedConnecting(self, connector):
		print('Started to connect.')

	def buildProtocol(self, addr):
        	print('Connected.')
        	self.protocol = RPCClient()
        	return self.protocol
	def clientConnectionFailed(self, connector, reason):
        	print("Connection failed - goodbye!")
		self.deferred.errback(reason)
        #reactor.stop()
    	def clientConnectionLost(self, connector, reason):
        	print("Connection lost - goodbye!")
		self.deferred.errback(reason)
        #reactor.stop()

def Send(sendmsg):
	if factory.protocol and factory.protocol.connected:
		print("send said:", sendmsg)
		if (len(recvmsg)> 0):
			recvmsg.pop()
		factory.protocol.transport.write(sendmsg)

factory= RPCClientFactory ()
reactor.connectTCP(host,port,factory)
pmasterconnet=factory.deferred
pmasterconnet.addCallback(connectSuccess,port)
pmasterconnet.addErrback(connectFailure,port)
---

### Expected Behavior

Tell us what should happen.

run "curl http://127.0.0.1:5000/1" block the flask  process,but  run "curl http://127.0.0.1:5000" still work



pls  tell how to resoule it , thank you



```python
Paste a minimal example that causes the problem.
```

### Actual Behavior

Tell us what happens instead.

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version:2.7.5
* Flask version:1.0.2
* Twisted version:18.9.0
* Werkzeug version:

* improve wording.
* remove unnecessary spaces.

Alternate fix of #3112 
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

This is something I've been experimenting with in Quart and I don't see a downside. I can't find any old issues relating to this (although I've found it hard to search for). This is roughly an issue, but as a pull request (branch) you can take the code and try it out. Obliviously if you consider this a good idea I'll add much more testing and documentation. 

This supports an increasingly common use-case whereby JSON is the primary response (rather than a templated string). Given Flask simplifies returning HTML responses, it seems fitting that it should also do so for JSON responses. In practice it allows,
```python
@app.route("/")
def index():
    return {
        "api_stuff": "values",
    }
```
which is equivalent to
```python
@app.route("/")
def index():
    return jsonify({
        "api_stuff": "values",
    })
```

### Note 

This doesn't support returning anything other than an associate array at the top level in the JSON response. I'm ok with this as in practice APIs are only extensible if the top level is an associate array.
When working with a custom response class the test_client calls the response class constructor, after the make_response already called the response class constructor

This causes a CustomResponse object to be passed to the constructor of the CustomResponse class.
A basic example of the problem
```python
import json
from unittest import TestCase

from flask import Response, Flask
from hamcrest import has_entry
from hamcrest.core import assert_that
from hamcrest.core.core import is_


class TestMediaAppRestResponse(TestCase):

    def setUp(self):
        self.media_app = MyApp(__name__)
        self.client = self.media_app.test_client()

    def _test_client(self):
        return self.media_app.test_client()

    def test_rest_response__dict_register_response_class_before_test_client(self):
        return_value = {'dict_prop': 'dict_value'}
        self.media_app.route('/')(_make_handler_with_response(return_value))
        self.media_app.register_response_class()

        test_client = self._test_client()

        response = test_client.get('/')
        print ('will never get here')

    def test_rest_response__dict_register_response_class_after_test_client(self):
        return_value = {'dict_prop': 'dict_value'}

        test_client = self._test_client()

        self.media_app.register_response_class()
        self.media_app.route('/')(_make_handler_with_response(return_value))

        response = test_client.get('/')
        assert_that(response.get_json(), has_entry('payload', is_(return_value)))


def _make_handler_with_response(response):
    def wrapped_handler():
        return response
    return wrapped_handler


class MyApp(Flask):

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)

    def register_response_class(self):
        self.response_class = MyResponse

    def make_response(self, response_value):
        if isinstance(response_value, self.response_class):
            return response_value
        return self.response_class(response_value, http_status=200, code=0, message='ok')


class MyResponse(Response):
    def __init__(self, payload=None, http_status: int = 200,
                 code: int = None,
                 message: str = '', *args, **kwargs):
        message = message
        code = code if code is not None else http_status
        payload = payload
        body_str = json.dumps({'code': code, 'message': message, 'payload': payload}, separators=(',', ':'))

        super().__init__(body_str, status=http_status, mimetype='application/json', *args, **kwargs)



```

### Expected Behavior

The custom response class constructor should only be called by the make_response method


### Actual Behavior

The constructor was called by the make_response method then by the test_client becuase the custom response class is passed to the client when it is created by the app. 
```pytb
Traceback (most recent call last):
  File "/usr/local/Cellar/python/3.7.1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/usr/local/Cellar/python/3.7.1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/unittest/case.py", line 615, in run
    testMethod()
  File "/Users/elirans/projects/media-framework/tests/media_framework_test/http/flask/test_media_app_rest_response_multiple_calls.py", line 26, in test_rest_response__dict_register_response_class_before_test_client
    response = test_client.get('/')
  File "/Users/elirans/projects/media-framework/run/lib/python3.7/site-packages/werkzeug/test.py", line 830, in get
    return self.open(*args, **kw)
  File "/Users/elirans/projects/media-framework/run/lib/python3.7/site-packages/flask/testing.py", line 200, in open
    follow_redirects=follow_redirects
  File "/Users/elirans/projects/media-framework/run/lib/python3.7/site-packages/werkzeug/test.py", line 822, in open
    response = self.response_wrapper(*response)
  File "/Users/elirans/projects/media-framework/tests/media_framework_test/http/flask/test_media_app_rest_response_multiple_calls.py", line 72, in __init__
    body_str = json.dumps({'code': code, 'message': message, 'payload': payload}, separators=(',', ':'))
  File "/usr/local/Cellar/python/3.7.1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/usr/local/Cellar/python/3.7.1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/usr/local/Cellar/python/3.7.1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
  File "/usr/local/Cellar/python/3.7.1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type Headers is not JSON serializable
```

### Environment

* Python version: 3.7.1
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

This is a minor edit that adds the closing tags for the four `li` tags in the file.
Would it make sense to allow passing a `--config/-c` option to `flask run`, that would then be exposed to users somehow for subsequent passing to e.g. `app.config.from_pyfile()`?

(I'm imagining this done in a reusable way so that a "flask gunicorn" custom command (the likes of which I've already implemented) could accept and expose a `-c` value similarly, so that the app could be configured from this same provided path whether running in development or production.)

This would reduce the dependence on an environment variable to specify this. Reason I ask is that many of the Flask users I'm supporting are allergic to environment variables for the reasons mentioned in #3095, and have been missing some way to pass a CLI option to `flask run` to help configure their apps. Thanks 😊
Hi,

I've post this issue #3090, past days  but, for now, I've some news :). 

So, I've the same error  ```Truncated or oversized response headers received from daemon process 'my_app': /var/www/python/flask/first_app/my_app/my_app.wsgi``` **when I access the database** !.

It's works when I comment the 2 lines of routes.py, and it's work when I use the _flask run --host=0.0.0.0 --port=5000_ command.

```python
def index():
    #d = Departement()
    #query =  d.query.all()
```

Here the tree of my application : 
```shell
$ tree ..
..
└── first_app
    ├── my_app
    │   ├── config.py
    │   ├── __init__.py
    │   ├── models.py
    │   ├── my_app.wsgi
    │   ├── routes.py
    │   └── templates
    │       ├── base.html
    │       └── index.html
    └── my_app.py

```

---

#### __init__.py : 
```python
from flask import Flask
from config import Config
from flask_sqlalchemy import SQLAlchemy
from flask_migrate import Migrate

my_app = Flask(__name__)
my_app.config.from_object(Config)

db = SQLAlchemy(my_app)
migrate = Migrate(my_app, db)

from my_app import routes,models
```
#### routes.py : 
```python
from flask import render_template, flash, redirect, url_for
from my_app import my_app
from my_app.models import Departement

@my_app.route('/')
@my_app.route('/index')
def index():
    d = Departement()
    query =  d.query.all()
    
    return render_template('index.html', title='Home', departements=query)
```
#### my_app.py : 
```python
from my_app import my_app
```
#### models.py : 
```python
from my_app import db

class Departement(db.Model):
    __tablename__ = "departements"
    code_dept = db.Column(db.Integer, primary_key=True)
    nom_dept = db.Column(db.String(50), index=True)
    passwd 	= db.Column(db.String(50))
    
    def __repr__(self):
        return '<Departement(s) : {0}, {1}, {2}>'.format(self.code_dept, self.nom_dept,self.passwd)    
```
#### config.py : 
```python
import os
basedir = os.path.abspath(os.path.dirname(__file__))

class Config(object):
    SECRET_KEY = os.environ.get('SECRET_KEY') or 'you-will-never-guess'
    
    DATABASE_CONFIG = {
        'username':'***',
        'password':'***',
        'host':'localhost',
        'database':'***'
        }

    SQLALCHEMY_DATABASE_URI = 'postgresql+psycopg2://' + DATABASE_CONFIG['username'] + ':' + DATABASE_CONFIG['password'] + '@' + DATABASE_CONFIG['host'] + '/' + DATABASE_CONFIG['database']
    SQLALCHEMY_TRACK_MODIFICATIONS = False
``` 
#### my_app.wsgi : 
```python
from my_app import my_app as application
```
#### The templates (for testing)

#### base.html : 
```html
<html>
    <head>
      {% if title %}
      <title>{{ title }} - My App</title>
      {% else %}
      <title>Welcome to My App!</title>
      {% endif %}
    </head>
    <body>
        <div>App :: 
            <a href="{{ url_for('index') }}">Home</a>
        </div>
        <hr>
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        <ul>
            {% for message in messages %}
            <li>{{ message }}</li>
            {% endfor %}
        </ul>
        {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </body>
</html>
``` 
#### index.html : 
```html
{% extends "base.html" %}

{% block content %}
    {% for d in departements %}
    <div><p>{{ d.code_dept }} => <b>{{ d.nom_dept }}</b></p></div>
    {% endfor %}
{% endblock %}
```

#### the vhost : 

```apache
<VirtualHost *:80>
      ServerName vm.basicflaskapp
      DocumentRoot /var/www/python/flask/first_app
      LogLevel info

       WSGIDaemonProcess my_app user=www-data group=www-data python-path=/var/www/python/flask/first_app:/home/vagrant/.virtualenvs/first_app_flask/lib/python2.7/site-packages
       WSGIScriptAlias / /var/www/python/flask/first_app/my_app/my_app.wsgi

        <Directory /var/www/python/flask/first_app>
            Require all granted
        </Directory>

        <Directory /var/www/python/flask/first_app/my_app>
            WSGIProcessGroup my_app
            WSGIApplicationGroup %{GLOBAL}
            Require all granted
        </Directory>

        ErrorLog ${APACHE_LOG_DIR}/first_app_flask-error.log
        CustomLog ${APACHE_LOG_DIR}/first_app_flask-access.log combined
</VirtualHost>
```

### Actual Behavior

```pytb
[Thu Feb 28 14:34:43.850678 2019] [mpm_worker:notice] [pid 4932:tid 140038462543744] AH00297: SIGUSR1 received.  Doing graceful restart
[Thu Feb 28 14:34:43.908680 2019] [wsgi:warn] [pid 4932:tid 140038462543744] mod_wsgi: Compiled for Python/2.7.11+.
[Thu Feb 28 14:34:43.908700 2019] [wsgi:warn] [pid 4932:tid 140038462543744] mod_wsgi: Runtime using Python/2.7.12.
[Thu Feb 28 14:34:43.909245 2019] [mpm_worker:notice] [pid 4932:tid 140038462543744] AH00292: Apache/2.4.38 (Ubuntu) OpenSSL/1.1.1a mod_wsgi/4.5.2 Python/2.7.12 configured -- resuming normal operations
[Thu Feb 28 14:34:43.909293 2019] [core:notice] [pid 4932:tid 140038462543744] AH00094: Command line: '/usr/sbin/apache2'

==> /var/log/apache2/first_app_flask-error.log <==
[Thu Feb 28 14:34:43.924834 2019] [wsgi:info] [pid 20347:tid 140038462543744] mod_wsgi (pid=20347): Attach interpreter ''.
[Thu Feb 28 14:34:43.925160 2019] [wsgi:info] [pid 20347:tid 140038462543744] mod_wsgi (pid=20347): Adding '/var/www/python/flask/first_app' to path.
[Thu Feb 28 14:34:43.929157 2019] [wsgi:info] [pid 20347:tid 140038462543744] mod_wsgi (pid=20347): Adding '/home/vagrant/.virtualenvs/first_app_flask/lib/python2.7/site-packages' to path.
[Thu Feb 28 14:34:45.846737 2019] [wsgi:info] [pid 20347:tid 140038331447040] [remote 192.168.56.1:0] mod_wsgi (pid=20347, process='my_app', application=''): Loading WSGI script '/var/www/python/flask/first_app/my_app/my_app.wsgi'.
[Thu Feb 28 14:34:46.273215 2019] [wsgi:error] [pid 20347:tid 140038331447040] /home/vagrant/.virtualenvs/first_app_flask/lib/python2.7/site-packages/psycopg2/__init__.py:144: UserWarning: The psycopg2 wheel package will be renamed from release 2.8; in order to keep installing from binary please use "pip install psycopg2-binary" instead. For details see: <http://initd.org/psycopg/docs/install.html#binary-install-from-pypi>.
[Thu Feb 28 14:34:46.273426 2019] [wsgi:error] [pid 20347:tid 140038331447040]   """)
[Thu Feb 28 14:34:46.390437 2019] [wsgi:error] [pid 20350:tid 140038213990144] [client 192.168.56.1:29516] Truncated or oversized response headers received from daemon process 'my_app': /var/www/python/flask/first_app/my_app/my_app.wsgi

==> /var/log/apache2/first_app_flask-access.log <==
192.168.56.1 - - [28/Feb/2019:14:34:45 +0100] "GET / HTTP/1.1" 500 613 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:65.0) Gecko/20100101 Firefox/65.0"

==> /var/log/apache2/error.log <==
[Thu Feb 28 14:34:46.912778 2019] [core:notice] [pid 4932:tid 140038462543744] AH00051: child pid 20347 exit signal Segmentation fault (11), possible coredump in /etc/apache2

==> /var/log/apache2/first_app_flask-error.log <==
[Thu Feb 28 14:34:46.919359 2019] [wsgi:info] [pid 20442:tid 140038462543744] mod_wsgi (pid=20442): Attach interpreter ''.
[Thu Feb 28 14:34:46.919460 2019] [wsgi:info] [pid 20442:tid 140038462543744] mod_wsgi (pid=20442): Adding '/var/www/python/flask/first_app' to path.
[Thu Feb 28 14:34:46.920621 2019] [wsgi:info] [pid 20442:tid 140038462543744] mod_wsgi (pid=20442): Adding '/home/vagrant/.virtualenvs/first_app_flask/lib/python2.7/site-packages' to path
```

### Environment

```
$ pip freeze
alembic==1.0.7
Click==7.0
Flask==1.0.2
Flask-Migrate==2.4.0
Flask-SQLAlchemy==2.3.2
Flask-WTF==0.14.2
itsdangerous==1.1.0
Jinja2==2.10
Mako==1.0.7
MarkupSafe==1.1.1
psycopg2==2.7.7
python-dateutil==2.8.0
python-dotenv==0.10.1
python-editor==1.0.4
six==1.12.0
SQLAlchemy==1.2.18
Werkzeug==0.14.1
WTForms==2.2.1

$ apachectl -v
Server version: Apache/2.4.38 (Ubuntu)
Server built:   2019-02-11T07:27:00

$ uname -a
Linux vm 4.4.0-45-generic #66-Ubuntu SMP Wed Oct 19 14:12:37 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux

$ cat /etc/lsb-release
DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=16.04
DISTRIB_CODENAME=xenial
DISTRIB_DESCRIPTION="Ubuntu 16.04.6 LTS"

```

Have you an idea please ? :)

Thanks
F.
**ReadMe** 

please add ``flask init-db`` right before ``flask run`` section in the tutorial README.  

Currently the only way to pass cert and key to `flask run` is via CLI options. Would you accept a patch to allow passing via FLASK_RUN_CERT / KEY env vars (settable in .flaskenv) as well? This would make these consistent with FLASK_RUN_HOST / PORT.
`match_request` will be called in `RequestContext.push` after `current_app`, `request`, and `session` are already populated.

closes #3088 

Due to a formatting issue in the reStructuredText input, the HTML
output produced a description list (`<dl>`) within the ordered list.

While reading installation section:

```
If you are on Mac OS X or Windows, download `get-pip.py`_, then:
    $ sudo python2 Downloads/get-pip.py
    ....
```
seems that if you are in Mac or Windows you must run ```sudo python2 ... ```

So in this PR i write for Mac run that... Then for Windows run this other command (original)

https://www.freecodecamp.org/forum/t/adding-a-dynamic-reviews-section-to-a-website/259492/3?u=dipperdolphin

Is there a guide to do this? I'd like to add it to a HTML website so people can leave reviews.

Thanks
Happened twice,The requester can receive my return data, but there is nothing printed on my side.
@app.route('/appdata', methods=['POST'])
def appdata():
        logging.info(request)
        import json
        logging.info(request.values.to_dict())
        a = request.values.to_dict()['msg']
        dict1 = json.loads(a)
        from datetime import datetime
        dict1['resivetime'] = datetime.now()
        logging.info(dict1)
        queues.put(dict1)
        return '200'

The requester will have this data, the recipient, as above, did not print any logs, and appeared almost once a week or so.And There is no error message here.
Happed twice,The requester can receive my return data, but there is nothing printed on my side.
@app.route('/appdata', methods=['POST'])
def appdata():
        logging.info(request)
        import json
        logging.info(request.values.to_dict())
        a = request.values.to_dict()['msg']
        dict1 = json.loads(a)
        from datetime import datetime
        dict1['resivetime'] = datetime.now()
        logging.info(dict1)
        queues.put(dict1)
        return '200'

The requester will have this data, but the recipient, as above, did not print any logs, and appeared almost once a week or so.And There is no error message here.

```
ryan@Ryans-Mac-mini ~ 11:59:51 % cat test.py
import flask

app = flask.Flask(__name__)


@app.route("/")
def index():
    return flask.url_for("index", _external=True)


app.run()
ryan@Ryans-Mac-mini ~ 11:59:57 % curl 127.0.0.1:5000
http://127.0.0.1:5000/
ryan@Ryans-Mac-mini ~ 12:00:05 % curl localhost:5000
http://localhost:5000/
ryan@Ryans-Mac-mini ~ 12:00:08 % nc localhost 5000
GET / HTTP/1.1
Host: testsite.com

HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 20
Server: Werkzeug/0.14.1 Python/3.7.1
Date: Tue, 12 Feb 2019 18:00:18 GMT

http://testsite.com/
ryan@Ryans-Mac-mini ~ 12:00:18 % nc localhost 5000
GET / HTTP/1.0

HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 22
Server: Werkzeug/0.14.1 Python/3.7.1
Date: Tue, 12 Feb 2019 18:00:24 GMT

http://127.0.0.1:5000/
ryan@Ryans-Mac-mini ~ 12:00:24 %
```

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Currently, `flask run` can be controlled via one set of environment variables and a *different* set of command line options. In some cases there is overlap (e.g. `FLASK_RUN_PORT` and `--port`), but in other cases there is not.

The most problematic example is the flask app object. The [*only* way to specify this explicitly](http://flask.pocoo.org/docs/1.0/cli/#application-discovery) is via the `FLASK_APP` environment variable; there is no command line option you can pass `flask run` to specify this instead.

(This is especially asymmetrical when using Flask with e.g. gunicorn, where the wsgi app [*must* be passed](https://docs.gunicorn.org/en/stable/run.html#gunicorn) via required positional command line argument.)

Would you accept a patch to allow passing a command line option for FLASK_APP? Being forced to use an environment variable to set this value is less than ideal, as it forces writing this important value out-of-band into a shared mutable global namespace (the environment), rather than being able to pass it directly in-band to `flask run`.
Traceback:

```
Traceback (most recent call last):
  File "/usr/lib/python3.6/site-packages/flask/app.py", line 1982, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/lib/python3.6/site-packages/flask/app.py", line 1614, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/lib/python3.6/site-packages/flask/app.py", line 1517, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/usr/lib/python3.6/site-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "/usr/lib/python3.6/site-packages/flask/app.py", line 1610, in full_dispatch_request
    rv = self.preprocess_request()
  File "/usr/lib/python3.6/site-packages/flask/app.py", line 1831, in preprocess_request
    rv = func()
  File "/usr/lib/python3.6/site-packages/srht/flask.py", line 197, in _csrf_check
    view = "{0}.{1}".format(view.__module__, view.__name__)
AttributeError: 'NoneType' object has no attribute '__module__'
```

Request body:

```
<?xml version="1.0" encoding="UTF-8"?><soap:Envelope xmlns:xsd="http://www.w3.org/2001/XMLSchema"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
xmlns="http://microsoft.com/webservices/"><soap:Body><QueryNodes></QueryNodes></soap:Body></soap:Envelope>
```

Request headers:

```
Host: 127.0.0.1:5001
Connection: close
Content-Length: 313
Accept: */*
User-Agent: git/git-import/0.4.3
Soapaction: "http://microsoft.com/webservices/QueryNodes"
Content-Type: text/xml; charset=UTF-8
```
I have created a custom error_handler function like so:
```python
def http_error_handler(error: HTTPException) -> Response:
    # rest of the code here
```
I then register all default http errors to use the above handler like so:

```python
from werkzeug.exceptions import default_exceptions

for code in default_exceptions:
    app.errorhandler(code)(http_error_handler)
```

I can confirm that my handler function has registered for all http errors in `default_exceptions`:
```python
app.error_handler_spec
{None: {400: {<class 'werkzeug.exceptions.BadRequest'>: <function http_error_handler at 0x7f0d3cd688c8>},
        401: {<class 'werkzeug.exceptions.Unauthorized'>: <function http_error_handler at 0x7f0d3cd688c8>},
        403: {<class 'werkzeug.exceptions.Forbidden'>: <function http_error_handler at 0x7f0d3cd688c8>},
        404: {<class 'werkzeug.exceptions.NotFound'>: <function http_error_handler at 0x7f0d3cd688c8>},
        405: {<class 'werkzeug.exceptions.MethodNotAllowed'>: <function http_error_handler at 0x7f0d3cd688c8>},
        406: {<class 'werkzeug.exceptions.NotAcceptable'>: <function http_error_handler at 0x7f0d3cd688c8>},
        408: {<class 'werkzeug.exceptions.RequestTimeout'>: <function http_error_handler at 0x7f0d3cd688c8>},
        409: {<class 'werkzeug.exceptions.Conflict'>: <function http_error_handler at 0x7f0d3cd688c8>},
        410: {<class 'werkzeug.exceptions.Gone'>: <function http_error_handler at 0x7f0d3cd688c8>},
        411: {<class 'werkzeug.exceptions.LengthRequired'>: <function http_error_handler at 0x7f0d3cd688c8>},
        412: {<class 'werkzeug.exceptions.PreconditionFailed'>: <function http_error_handler at 0x7f0d3cd688c8>},
        413: {<class 'werkzeug.exceptions.RequestEntityTooLarge'>: <function http_error_handler at 0x7f0d3cd688c8>},
        414: {<class 'werkzeug.exceptions.RequestURITooLarge'>: <function http_error_handler at 0x7f0d3cd688c8>},
        415: {<class 'werkzeug.exceptions.UnsupportedMediaType'>: <function http_error_handler at 0x7f0d3cd688c8>},
        416: {<class 'werkzeug.exceptions.RequestedRangeNotSatisfiable'>: <function http_error_handler at 0x7f0d3cd688c8>},
        417: {<class 'werkzeug.exceptions.ExpectationFailed'>: <function http_error_handler at 0x7f0d3cd688c8>},
        418: {<class 'werkzeug.exceptions.ImATeapot'>: <function http_error_handler at 0x7f0d3cd688c8>},
        422: {<class 'werkzeug.exceptions.UnprocessableEntity'>: <function http_error_handler at 0x7f0d3cd688c8>},
        423: {<class 'werkzeug.exceptions.Locked'>: <function http_error_handler at 0x7f0d3cd688c8>},
        428: {<class 'werkzeug.exceptions.PreconditionRequired'>: <function http_error_handler at 0x7f0d3cd688c8>},
        429: {<class 'werkzeug.exceptions.TooManyRequests'>: <function http_error_handler at 0x7f0d3cd688c8>},
        431: {<class 'werkzeug.exceptions.RequestHeaderFieldsTooLarge'>: <function http_error_handler at 0x7f0d3cd688c8>},
        451: {<class 'werkzeug.exceptions.UnavailableForLegalReasons'>: <function http_error_handler at 0x7f0d3cd688c8>},
        500: {<class 'werkzeug.exceptions.InternalServerError'>: <function http_error_handler at 0x7f0d3cd688c8>},
        501: {<class 'werkzeug.exceptions.NotImplemented'>: <function http_error_handler at 0x7f0d3cd688c8>},
        502: {<class 'werkzeug.exceptions.BadGateway'>: <function http_error_handler at 0x7f0d3cd688c8>},
        503: {<class 'werkzeug.exceptions.ServiceUnavailable'>: <function http_error_handler at 0x7f0d3cd688c8>},
        504: {<class 'werkzeug.exceptions.GatewayTimeout'>: <function http_error_handler at 0x7f0d3cd688c8>},
        505: {<class 'werkzeug.exceptions.HTTPVersionNotSupported'>: <function http_error_handler at 0x7f0d3cd688c8>}}}
```
I'm then testing each error using an endpoint that accepts requests like so `/error?code=404` which in tern calls `flask.abort(404)` that then calls `http_error_handler` I created.

I noticed that all http errors are calling my custom error function except for http error 412 even though you can see it has registered above. Any ideas?

Side note, if there is a better way of testing custom error pages then please advise.

Thanks in advance.

### Environment

* Python version: 3.7.2-alpine3.8 docker image
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

Hi team,
For my project, I am using Flask at server side and Angular at the client side. When I call a flask API to upload a CSV file then sometimes the file gets uploaded successfully and sometimes it throws the keyError on the file name.
I am continuously facing this issue and have tried various methods to handle the header while calling the API, but no luck in that. 

```pytb
Traceback (most recent call last):
  File "C:\Users\deepak.saini\AppData\Local\Programs\Python\Python36\lib\site-packages\flask\app.py", line 2309, in __call__
    return self.wsgi_app(environ, start_response)
  File "C:\Users\deepak.saini\AppData\Local\Programs\Python\Python36\lib\site-packages\flask\app.py", line 2295, in wsgi_app
    response = self.handle_exception(e)
  File "C:\Users\deepak.saini\AppData\Local\Programs\Python\Python36\lib\site-packages\flask_cors\extension.py", line 161, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "C:\Users\deepak.saini\AppData\Local\Programs\Python\Python36\lib\site-packages\flask_restful\__init__.py", line 273, in error_router
    return original_handler(e)
  File "C:\Users\deepak.saini\AppData\Local\Programs\Python\Python36\lib\site-packages\flask\app.py", line 1741, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "C:\Users\deepak.saini\AppData\Local\Programs\Python\Python36\lib\site-packages\flask\_compat.py", line 35, in reraise
    raise value
  File "C:\Users\deepak.saini\AppData\Local\Programs\Python\Python36\lib\site-packages\flask\app.py", line 2292, in wsgi_app
    response = self.full_dispatch_request()
  File "C:\Users\deepak.saini\AppData\Local\Programs\Python\Python36\lib\site-packages\flask\app.py", line 1815, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "C:\Users\deepak.saini\AppData\Local\Programs\Python\Python36\lib\site-packages\flask_cors\extension.py", line 161, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "C:\Users\deepak.saini\AppData\Local\Programs\Python\Python36\lib\site-packages\flask_restful\__init__.py", line 273, in error_router
    return original_handler(e)
  File "C:\Users\deepak.saini\AppData\Local\Programs\Python\Python36\lib\site-packages\flask\app.py", line 1718, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "C:\Users\deepak.saini\AppData\Local\Programs\Python\Python36\lib\site-packages\flask\_compat.py", line 35, in reraise
    raise value
  File "C:\Users\deepak.saini\AppData\Local\Programs\Python\Python36\lib\site-packages\flask\app.py", line 1813, in full_dispatch_request
    rv = self.dispatch_request()
  File "C:\Users\deepak.saini\AppData\Local\Programs\Python\Python36\lib\site-packages\flask\app.py", line 1799, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "D:\6-feb\intent-python\src\intent\incident\incidenttraining.py", line 20, in db_insert_training_tickets
    return IncidentTraining.db_insert_training_tickets(customer_id, dataset_name, team_name)
  File "D:\6-feb\intent-python\src\intent\incident\incidenttraining.py", line 41, in db_insert_training_tickets
    file = request.files['trainingData']
  File "C:\Users\deepak.saini\AppData\Local\Programs\Python\Python36\lib\site-packages\werkzeug\datastructures.py", line 431, in __getitem__
    raise exceptions.BadRequestKeyError(key)
werkzeug.exceptions.HTTPException.wrap.<locals>.newcls: 400 Bad Request: KeyError: 'trainingData'
Error in atexit._run_exitfuncs:
```

#### Expected Behavior : 
Submiting a form (using flask_wtf.Form), in WSGI mod (apache 2.4)

#### Tell us what should happen.
The apache2 (2.4) log : 
```
[wsgi:error] [pid 13836:tid 140457635997440] [client 192.168.56.1:19524] Truncated or oversized response headers received from daemon process 'flask_myapp': /var/www/myapp/myapp/flask_myapp/flask_myapp.wsgi, referer: http://vm.myapp/

==> /var/log/apache2/error.log <==
[core:notice] [pid 13820:tid 140457840961408] AH00051: child pid 13927 exit signal Segmentation fault (11), possible coredump in /etc/apache2
```
And my virtualhost : 
```
<VirtualHost *:80>
       ServerName vm.myapp
       #ServerAlias vm.myapp
       DocumentRoot /var/www/myapp/myapp

       WSGIDaemonProcess flask_myapp python-path=/var/www/myapp/myapp:/home/vagrant/.virtualenvs/myapp/lib/python2.7/site-packages
       WSGIProcessGroup flask_myapp
       WSGIScriptAlias / /var/www/myapp/myapp/flask_myapp/flask_myapp.wsgi
       WSGIApplicationGroup %{GLOBAL}

        Alias /favicon.ico /var/www/myapp/myapp/static/favicon.ico
        Alias /site_media/ /var/www/myapp/myapp/site_media/
        Alias /media/ /var/www/myapp/myapp/media/
        Alias /static/ /var/www/myapp/myapp/static/
        AliasMatch /([/]*\.css) /var/www/myapp/myapp/static/css/$1

        <Directory /var/www/myapp/myapp>
            Order allow,deny
            Allow from all
            Require all granted
        </Directory>

        <Directory /var/www/myapp/myapp/flask_myapp>
            Order allow,deny
            Allow from all
            Require all granted
        </Directory>

        ErrorLog ${APACHE_LOG_DIR}/myapp-error.log
        CustomLog ${APACHE_LOG_DIR}/myapp-access.log combined
</VirtualHost>
```
And, **if I'm running the app in console mode** (flask run --host=0.0.0.0) :(, it's fine, but I can't see the static contents (see Alias section in VH) : 
```
INFO - 14:36:24 - _internal.py (88)  : 192.168.56.1 - - [05/Feb/2019 14:36:24] "POST /login?next=%2F HTTP/1.1" 302 -
INFO - 14:36:24 - _internal.py (88)  : 192.168.56.1 - - [05/Feb/2019 14:36:24] "GET / HTTP/1.1" 200 -
INFO - 14:36:24 - _internal.py (88)  : 192.168.56.1 - - [05/Feb/2019 14:36:24] "GET /static/css/main.css HTTP/1.1" 404 -
INFO - 14:57:30 - _internal.py (88)  : 192.168.56.1 - - [05/Feb/2019 14:57:30] "GET /zm?data=1402201904 HTTP/1.1" 200 -
INFO - 14:57:30 - _internal.py (88)  : 192.168.56.1 - - [05/Feb/2019 14:57:30] "GET /static/img/84/zones_meteo.jpg HTTP/1.1" 404 -
INFO - 14:57:30 - _internal.py (88)  : 192.168.56.1 - - [05/Feb/2019 14:57:30] "GET /static/img/84/CorrespZM.png HTTP/1.1" 404 -
INFO - 14:57:30 - _internal.py (88)  : 192.168.56.1 - - [05/Feb/2019 14:57:30] "GET /static/css/main.css HTTP/1.1" 404 -
```
 

### Actual Behavior

Tell us what happens instead.

```pytb
$ python --version
Python 2.7.12
$ cat requirements.txt
click==6.7
Flask==1.0.2
Flask-Caching==1.4.0
Flask-Login==0.4.1
Flask-SQLAlchemy==2.3.2
Flask-WTF==0.14.2
itsdangerous==0.24
Jinja2==2.10
MarkupSafe==1.0
psycopg2==2.7.5
SQLAlchemy==1.2.8
Werkzeug==0.14.1
WTForms==2.2.1
```

### Environment

* Python version: 2.7.12
* Flask version: 1.0.2
* Werkzeug version: 0.14.1


Thanks a lot.
F.
It's possible to [donate](https://palletsprojects.com/blog/donate/) to support Flask, but (despite several Flask *extensions* being [lifted](https://tidelift.com/subscription/pkg/supported-open-source-packages)), neither Flask *itself* nor other Pallets projects are available via Tidelift subscription.

According to current estimates, [Flask](https://tidelift.com/lifter/search?q=flask), [Werkzeug](https://tidelift.com/lifter/search?q=werkzeug), [Jinja2](https://tidelift.com/lifter/search?q=jinja2), [Click](https://tidelift.com/lifter/search?q=click), and [ItsDangerous](https://tidelift.com/lifter/search?q=itsdangerous) could each be earning USD $417/month (a total of over $2K/month).

(I recently lifted an [open source project](https://tidelift.com/subscription/pkg/pypi-bidict?utm_source=pypi-bidict&utm_medium=referral&utm_campaign=flask3089) I've been maintaining for over 10 years – which has been in use at Google, Venmo, Bank of America Merrill Lynch, et al. – and only today got my first cent of financial support thanks to Tidelift.)

Just wanted to make sure you knew about Tidelift in case it's an option for you. ❤️
### Expected Behavior

The following code should create a new URL converter that converts a specific field to a model (or `None`).

```python
class ModelConverter(BaseConverter):

    def to_python(self, value):
        return models.Example.query.filter(models.Example.name == value).first()

    def to_url(self, value):
        if isinstance(value, str):
            return value
        return value.name
```

### Actual Behavior

The converters don't have access to the app context so an error is thrown.


### Bad Solution

```python
class OrganizationConverter(BaseConverter):
    app = None
    def to_python(self, value):
        with self.app.app_context():
            return repositories.Organization.query.filter(repositories.Organization.name == value).first()

    def to_url(self, value):
        if isinstance(value, str):
            return value
        return value.name
```

This solution tries to get around it by creating a new app context. The problem is that the context disappears, killing the database session at the same time. This prevents SQLAlchemy features (such as lazy loading).


### Environment

* Python version: 3.6 and 3.7
* Flask version: 1.0.2
* SQLAlchemy version: 1.2.17
* Flask-SQLAlchemy version: 2.3.2
* Werkzeug version: 0.14.1

### Additional Resources

This issue has also come up on [stack overflow](https://stackoverflow.com/questions/33856007/passing-application-context-to-custom-converter-using-the-application-factory-pa)

The initial banner messages emitted from flask to the console are not routed to the log handler as expected. The only way to work around this is to change all log statements to go to `stderr` and then redirect `stdout` to `/dev/null`. Otherwise, the statements appear in the console with no obvious way to enable suppression or reroute them to a log handler.

I suspect this is intentional, but I think the statements should be able to be suppressed or rerouted in some manner. Something as simple as a flag to show or hide the banner would suffice in `flask/app.py`:
```
938         if self.show_banner:
939             cli.show_server_banner(self.env, self.debug, self.name, False)
```

Console excerpt showing the statements not redirecting to the log handler:
```
[2019-01-30 07:20:02.254] [DBUG] [api.py:35              ] Starting API
 * Serving Flask app "api" (lazy loading)
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: off
[2019-01-30 07:20:02.264] [DBUG] [fps.py:23              ] FPS[0] main loop
```
Instantiation is from a class that is called as part of a larger application, which embeds the API:
```
  def __init__():
    self.app = flask.Flask(__name__)
    self.app.config.from_object("config")
    self.bp  = flask.Blueprint("fpsApi", __name__)
    self.api = flask_restful.Api(self.bp)
    self.api.add_resource(Hello, "/Hello")
    self.app.register_blueprint(self.bp, url_prefix = "/api")
    
  def run(self):
    logging.debug(f"Starting API")
    self.app.run(
      debug = self.dbgMode,
      use_reloader = self.useReloader,
      port = self.cfg["apiPort"],
      host = self.hostIp
    )
```

Version information:
```
$ python --version
Python 3.7.2

$ pip freeze
aniso8601==4.1.0
Click==7.0
Flask==1.0.2
Flask-RESTful==0.3.7
gnureadline==6.3.8
itsdangerous==1.1.0
Jinja2==2.10
MarkupSafe==1.1.0
mysqlclient==1.4.1
pbr==5.1.1
python-dotenv==0.10.1
pytz==2018.9
schema==0.6.8
six==1.12.0
stevedore==1.30.0
virtualenv==16.2.0
virtualenv-clone==0.5.1
virtualenvwrapper==4.8.2
Werkzeug==0.14.1
```
Hey guys,
I am trying to achieve a automatic redirect to the '/' node on either timeout or if a variable is set to a specific value. And this should work from all pages. So it doesnt matter on which site the user is, the automatic logout will trigger.

I thought something like 
while redirect = False:
      do routing and stuff
      at some point redirect = True
redirect(url_for('index'))

Any ideas? If the while thing is posible, how can I wrap the whole application? There has to be a better solution

Hi i am new to the flask environment and i am currently working on a project which involves me hosting a server to run a dashboard for IoT devices (freeboard). I have already copied all the freeboard files to the static folder. But the index page of the freeboard when called through flask doesnt include any css and javascript files that have been mentioned in the index file of freeboard. 

The file structure is a follows
Myproject/static/(freeboard files)

I am expecting the freeboard index-page to load with all the necessary css and javascript files linked as mentioned in the index page.
I would like a know a way to host freeboard through flask without changing any of the original files from freeboard.


### Expected Behavior

Creating an app using dash which is built onto of flask. App worked fine until I had the genius idea to try running it in the background. I'm now in a situation where I cannot use my app in development mode in cygwin, although it does work on main OS and deployed on server, so this isn't an issue w/codebase.


Sorry, this is only reproduceable in my environment


### Actual Behavior

```
 $ python app.py
Running on http://127.0.0.1:8050/
Debugger PIN: 962-843-370
 * Serving Flask app "app" (lazy loading)
 * Environment: development
 * Debug mode: on
      2 [main] python3.6m 37104 child_info_fork::abort: unable to remap _lbfgsb.cpython-36m-x86_64-cygwin.dll to same address as parent (0x48E0000) - try running rebaseall
Traceback (most recent call last):
  File "app.py", line 644, in <module>
    app.run_server(debug=util.DEBUG)
  File "/cygdrive/c/Users/mkupfer/Desktop/my_documents/01_Visualizations/eurostat/venv/lib/python3.6/site-packages/dash/dash.py", line 1293, in run_server
    **flask_run_options)
  File "/cygdrive/c/Users/mkupfer/Desktop/my_documents/01_Visualizations/eurostat/venv/lib/python3.6/site-packages/flask/app.py", line 943, in run
    run_simple(host, port, self, **options)
  File "/cygdrive/c/Users/mkupfer/Desktop/my_documents/01_Visualizations/eurostat/venv/lib/python3.6/site-packages/werkzeug/serving.py", line 812, in run_simple
    reloader_type)
  File "/cygdrive/c/Users/mkupfer/Desktop/my_documents/01_Visualizations/eurostat/venv/lib/python3.6/site-packages/werkzeug/_reloader.py", line 275, in run_with_reloader
    sys.exit(reloader.restart_with_reloader())
  File "/cygdrive/c/Users/mkupfer/Desktop/my_documents/01_Visualizations/eurostat/venv/lib/python3.6/site-packages/werkzeug/_reloader.py", line 132, in restart_with_reloader
    close_fds=False)
  File "/usr/lib/python3.6/subprocess.py", line 267, in call
    with Popen(*popenargs, **kwargs) as p:
  File "/usr/lib/python3.6/subprocess.py", line 709, in __init__
    restore_signals, start_new_session)
  File "/usr/lib/python3.6/subprocess.py", line 1275, in _execute_child
    restore_signals, start_new_session, preexec_fn)
BlockingIOError: [Errno 11] Resource temporarily unavailable
```



### Environment

* Python version: 3.6.4
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

### Things I have already tried:

1. Rebasing
2. Re-installing cygwin

It seems passing argument `allow_nan = False` to `flask.jsonify` will not actually turn `NaN`s into something else like `null` - e.g. `flask.jsonify({“a” : numpy.nan})` will produce `{“a” : NaN}`
Describe what this patch does to fix the issue.

When run on Python 3, linters such as Pylint and Flake8 will correctly flag __unicode__ and __long__ as _undefined names_ because _compat.py does not currently follow the Python porting best practice [___use feature detection instead of version detection___](https://docs.python.org/3/howto/pyporting.html#use-feature-detection-instead-of-version-detection).  This PR allows this codebase to pass those Pylint and Flake8 tests without adding any linter directives.

flake8 testing of https://github.com/pallets/flask on Python 3.7.1

$ __flake8 . --count --select=E901,E999,F821,F822,F823 --show-source --statistics__
```
./flask/_compat.py:41:17: F821 undefined name 'unicode'
    text_type = unicode
                ^
./flask/_compat.py:42:26: F821 undefined name 'unicode'
    string_types = (str, unicode)
                         ^
./flask/_compat.py:43:27: F821 undefined name 'long'
    integer_types = (int, long)
                          ^
3     F821 undefined name 'unicode'
3
```

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

I want to translate latest Flask documentation to Russian language. I searched in the Google, and found this page: https://flask-russian-docs.readthedocs.io/ru/latest/. It is good russian translation, but it is bit outdated. I want to renew it, and continue to maintain.

But then I encountered an issue (https://github.com/pallets/flask/issues/1023) about the Korean language, so I want to ask: 

OK, you can't check translation because you don't have any russian developers, so you can't make it as official translation.
But then, what I (and other translators) can do? Can you give a link to that translation, and say, that this is unofficial? Can I search for russian developers on some other sites and ask them to check translation? What if I translate docs commit-by-commit, so you will always see, is it new or outdated? So, if I want to translate it "right-way", how can I do it?

#3282 changed the name of `app.logger` from `"flask.app"` to the value of `app.name`, which means existing logging configuration for `"flask"` or `"flask.app"` will have no effect. Show a warning if configuration is detected for these names and not for `app.logger`, to ease upgrades.
#2436 greatly simplified how logging is set up in Flask. Part of that removed the `LOGGER_NAME` config and hard-coded `"flask.app"`. However, #2866 points out that due to this it is no longer possible to distinguish logs when dispatching multiple apps.

This partially reverts the logger name behavior change from 1.0. There is still no config, but the logger's name is now the same as `app.name` (basically the value passed to `Flask(import_name)`).

The information that's currently logged does make sense as coming from the user's project rather than Flask itself, although we may introduce the `"flask.app"` logger again in the future for logging things truly internal to Flask and not the user's app.

This may require projects to update their logging config to reference their app's name instead of `"flask.app"`.

Closes #2866 
```python
with open('CHANGES.rst', 'rb') as f:
    contents = f.read().replace(b'\xc1', b'`').replace(b'\xa9', b"'")
with open('CHANGES.rst', 'wb') as f:
    f.write(contents)
with open('CHANGES.rst') as f:
    f.read()  # verify it is now UTF-8
```

Resolves #3279
Fixed assert expression as pytest doc said.

See also:
https://docs.pytest.org/en/latest/assert.html#assertraises
oops, looks like someone wrote this file on windows!  I'll fix it to be UTF-8 (my editor was very unhappy trying to edit it!)
- pytest 5.x drops python2 compatibility and therefore only implements PEP 451
- pytest 5.x made the repr of `ExcInfo` less confusing (fixed tests depending
  on the old format)

Resolves #3275
Resolves #3277
tests/test_db.py#test_get_close_db does not pass.

### Actual Behavior

![image](https://user-images.githubusercontent.com/14356595/60437543-8df99300-9c49-11e9-9bed-7fed49cfcd3d.png)

### Environment

* Python version: 3.7.3
* Flask version: 1.0.3
* Werkzeug version: 0.15.4
* pytest: 5.0.0
In the tutorial, the base.html file does not have closing `</li>` tags. This PR adds the corresponding `</li>` tags to the nav bar.

For more information: https://github.com/pytest-dev/pytest/issues/5532

https://www.python.org/dev/peps/pep-0451/#api-changes

A compliant PEP 451 loader can avoid a lot of the tricky APIs just through implementing `find_spect` -- in this case `is_package` is replaced by `submodule_search_locations` being truthy

I'll see if I can't take a stab at this, it looks like this is a reopen of #487

Here's a minimal example:

```python
import flask

app = flask.Flask(__name__)

def test():
    pass
```

```console
$ pytest t.py
============================= test session starts ==============================
platform linux -- Python 3.6.7, pytest-5.0.0, py-1.8.0, pluggy-0.12.0
rootdir: /tmp/x
collected 0 items / 1 errors                                                   

==================================== ERRORS ====================================
____________________________ ERROR collecting t.py _____________________________
t.py:3: in <module>
    app = flask.Flask(__name__)
venv/lib/python3.6/site-packages/flask/app.py:381: in __init__
    instance_path = self.auto_find_instance_path()
venv/lib/python3.6/site-packages/flask/app.py:678: in auto_find_instance_path
    prefix, package_path = find_package(self.import_name)
venv/lib/python3.6/site-packages/flask/helpers.py:826: in find_package
    loader, root_mod_name):
venv/lib/python3.6/site-packages/flask/helpers.py:789: in _matching_loader_thinks_module_is_package
    loader.__class__.__name__)
E   AttributeError: AssertionRewritingHook.is_package() method is missing but is required by Flask of PEP 302 import hooks.  If you do not use import hooks and you encounter this error please file a bug against Flask.
!!!!!!!!!!!!!!!!!!! Interrupted: 1 errors during collection !!!!!!!!!!!!!!!!!!!!
=========================== 1 error in 0.31 seconds ============================
```

```console
$ pip freeze --all
atomicwrites==1.3.0
attrs==19.1.0
Click==7.0
Flask==1.0.3
importlib-metadata==0.18
itsdangerous==1.1.0
Jinja2==2.10.1
MarkupSafe==1.1.1
more-itertools==7.1.0
packaging==19.0
pip==19.1.1
pluggy==0.12.0
py==1.8.0
pyparsing==2.4.0
pytest==5.0.0
setuptools==41.0.1
six==1.12.0
wcwidth==0.1.7
Werkzeug==0.15.4
wheel==0.33.4
zipp==0.5.1
```


fixes #3074 

Through https://tools.ietf.org/html/rfc8187#section-3.2.1, ":" and "/" are not part of `attr-char` and should be quoted.
Fixes #3249. Sets `BadRequestKeyError.show_exception` to include the exception message in the description, rather than clearing `args` to hide it. The attribute was introduced by pallets/werkzeug#1595, which will be released as Werkzeug 0.15.5. Using Werkzeug >= 0.15.0, <= 0.15.4 will still have the arguments cleared, so users will need to upgrade both libraries to get the fix.
### Expected Behavior
2xx response for an existing working URL


### Actual Behavior
blueprints with url_prefix started to respond with 308 in the latest flask (used pip)


### Environment
* Python version: Python 3.6.7
* Flask version: 1.0.3
* Werkzeug version: 0.15.4

More updates to files based on common Pallets format (based on Werkzeug for now). Removed old build files, updated links in docs, reformatted changelog.
Use dash to separate command name, and explicitly name the command, to be consistent with Click 7 behavior.

closes #2931 
closes #3075

### Actual Behavior

When trying to create new flask object, I get following error:

```python
>>> from flask import Flask
>>> flask_app = Flask(__name__)
python: ../Python-2.7.14/Python/symtable.c:1319: symtable_visit_params: Assertion `arg->v.Name.ctx == Param || (arg->v.Name.ctx == Store && !toplevel)' failed.
Aborted

```

### Environment

* Python version: 2.7.14
* Flask version: 1.0.3
* Werkzeug version: 0.15.4

* Fixing the example given in the doc that only gives you a non-printable ascii output.
* SystemRandom is sure to use for cryptographic purpose (see random module doc)

The one-liner given in the doc provides only a non-printable output not suitable for any use. Fixing that with another one-liner.

https://docs.python.org/3/library/random.html


Due to multiple PRs over the last 5 years, the error handler behavior has slowly changed with the goal of being more consistent. However, after #2314 was merged in 1.0.0, these changes all cascaded together to make some inconsistent behavior finally visible.

After *extensive* discussion in #1281, #1291, and #1429, the goal was to make error handlers trigger for exceptions in MRO order, rather than registration order. It formalized the idea that HTTP exception classes and status codes were aliases. Registering a handler for `401` was the same as `Unauthorized`.

However, it (unintentionally?) preserved some old behavior where user errors would only be looked up against a `500` error handler, not a `InternalServerError` handler, even though the goal was for these to be aliases.

#2314 ensured a more consistent lookup order between blueprints and app error handlers for codes and exception classes. #2362 simplified the code even more, and made it more correct for subclass handling. A side effect of these refactors was that it fixed the preserved behavior, so 500 and `InternalServerError` handlers were equivalent.

All these changes had the goal of making error handler registration and triggering more intuitive, and making maintenance easier.

When an unhandled exception is raised, `handle_exception` is triggered so that a final, generic internal server error is returned. Previously, the behavior was to pass the unhandled exception to the 500 error handler, rather than the generic `InternalServerError`. Now that 500 and `InternalServerError` were the same thing and were both considered as handlers for generic error, users who registered a handler for `InternalServerError` or the `HTTPException` base class were surprised to get other random exceptions passed to the handler, rather than strict subclasses (#2778, #2841).

A fix was proposed in #2983 which continued to preserve the old behavior by making a handler for `500` receive any error, while a handler for `InternalServerError` only received `InternalServerError`. I think this made the code harder to reason about, both for maintainers and for app devs.

Instead, I'm going the opposite direction and ensuring that those handlers only ever receive `InternalServerError` instances. For unhandled errors, the exception has a new `original_exception` attribute that has the original unhandled error. This will be formalized in Werkzeug 1.0.0, until then `getattr` can be used to check if the attribute is set. The upside of this is that it is safe to assume that all codes and classes are aliases, and will only receive matching classes of errors, which seems to have been the intention of previous discussions, and makes the most sense to me.

The downside is that there is no way for this to be 100% backwards compatible for 500 handlers that were written assuming any exception would be passed to them, and I couldn't think of a way to have a useful deprecation warning transition. `e` will always look like `InternalServerError`, possibly making existing generic error pages less useful. However, with the availability of `e.original_exception`, it should be straightforward to get the intended behavior back. Code shouldn't *fail* in the mean time, only be less specific. I think the benefit of more consistent behavior outweighs the drawback.

closes #2778 
closes #2841 
closes #2983 

While fixing this, I noticed that `finalize_request` was only called if a 500 error handler was found. If no custom handler was registered, then an unhandled error would skip `after_request` functions, saving the session, and sending the `request_finished` signal. This is now fixed, so `finalize_request` is always called.

To clear up related confusion about very generic error handlers such as `HTTPException` and `Exception`, more docs have been added to the `errorhandling.rst` page. `handle_exception` has much clearer explanations of what it does too.
Not sure if this is the appropriate place to submit this but seems to either been an issue between flask and escpos so I thought I would start here.

### Expected Behavior
Browsing to route prints receipt immediately despite how many times visited.

```python
from flask import Flask, flash
from escpos import *
import PIL

app = Flask(__name__, template_folder='.')

@app.route('/')
def homepage():
  printerip = "192.168.3.197"
  Epson = printer.Network(printerip)
  Epson.text('CHARGING')
  Epson.cut()
  return 'printed'

if __name__ == '__main__':
  app.run(host='0.0.0.0', debug=True, port=80)
```

### Actual Behavior

Receipt prints once but if visiting route again the receipt prints after a delay of 1+ minutes or until the flask application is killed the "backlog" prints immediately. Sometimes the route can be visited twice in a row and the receipt is printed immediately. I can consistently get this working if I have 2.2.0 of python-escpos installed. However when I install the latest version I start experiencing these delays. I require the latest version to take advantaged of image printing and text formatting.

### Environment

* Python version: 3.6.8
* Flask version: 1.0.2
* Werkzeug version: 3.6.8

I have this route:

```
@app.route('/static/<path:subpath>')
def get_static(subpath):
	return flask.send_from_directory( asset_dir, subpath )
```

But it never matches any paths, such as `/static/index.js`. `"GET /static/index.js HTTP/1.1" 404 -`

If I leave off the `path` converter it does match. `"GET /static/index.js HTTP/1.1" 200 -
`

### Environment

* Python version: 3.6.7
* Flask version: 1.0.2
* Werkzeug version: 0.15.2

### Expected Behavior
When using Flask CLI, I came to the case that we have a group of commands for a big program that uses `click`.
```python
# main group
@click.group()
@click.pass_context
def my_big_cli_group(ctx):
    pass

# sub group
@my_big_cli_group.group()
@click.pass_context
def my_nested_group(ctx):
    pass

# command for sub group
@my_nested_group.command()
@click.pass_context
@click.option('-s', '--start', is_flag=True)
def my_command(ctx, start):
    click.echo(start)
```

The issue comes when nesting my flask app into the bigger group using `cls=FlaskGroup` and passing my `create_app` factory function.

```python
# flask app sub group
@my_big_cli_group.group(cls=FlaskGroup, create_app=create_app)
@click.pass_context
def my_flask_app(ctx):
    pass
```

After running my `setup.py` pointing my entry point to `'my_big_cli = path.to:my_big_cli_group'`, I should expect the app to start once I do:
```bash
$ my_big_cli my_flask_app run
```

### Actual Behavior
Instead, I get a `flask.cli.NoAppException`. It seems that `create_app` does not get passed on to `Group.group` instances on `click`.

```pytb
Traceback (most recent call last):
 File “/Users/the_user/Desktop/venv/lib/python3.7/site-packages/flask/cli.py”, line 540, in list_commands
   rv.update(info.load_app().cli.list_commands(ctx))
 File “/Users/the_user/Desktop/venv/lib/python3.7/site-packages/flask/cli.py”, line 393, in load_app
   ‘Could not locate a Flask application. You did not provide ’
flask.cli.NoAppException: Could not locate a Flask application. You did not provide the “FLASK_APP” environment variable, and a “wsgi.py” or “app.py” module was not found in the current directory.
```

### Work around
If I don't nest the flask app into a group but rather make it a new `click.group`, then after changing my `setup.py` to point to this new entry point as well, everything works as expected.

```python
# flask app group
@click.group(cls=FlaskGroup, create_app=create_app)
@click.pass_context
def my_flask_app(ctx):
    pass
```
Then
```bash
$ my_flask_app run
```
works perfectly fine


### Environment

* Python version: 3.7.3
* Flask version: 1.0.3
* Werkzeug version: 0.15.4
```python
from flask import Flask
import urlparse

app = Flask(__name__)


@app.cli.command()
def hello():
    print("Hello World")


if __name__ == "__main__":
    app.run()
```

---

### Expected Behavior

```bash
ubuntu@bionic:/reproduce# flask hello
Hello World
```

### Actual Behavior

```bash
ubuntu@bionic:/reproduce# flask hello
Usage: flask [OPTIONS] COMMAND [ARGS]...

Error: No such command "hello".
```

### Environment

* Python version: 3.6.7
* Flask version: 1.0.3
* Werkzeug version: 0.15.4

After pallets/werkzeug#1577, mismatched configured and real server names will show a warning in addition to raising 404. This caused tests that did this deliberately to fail.

This patch removes the pytest fixture we were using to fail on warnings, instead using the standard `-Werror` option. This speeds up the tests by ~3x.
Describe what this patch does to fix the issue.

This adds documentation to the error handling page. I was having a hard time finding anything on the proper use of abort with the flask error handler. After settling on a good pattern, I added it here.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

import

```python
from flask.ext.mongoalchemy import MongoAlchemy
```

### Actual Behavior

from flask_mongoalchemy import MongoAlchemy

```pytb
from flask_mongoalchemy import MongoAlchemy
ModuleNotFoundError: No module named 'flask_mongoalchemy'
```

### Environment

* Python version:3.7
* Flask version:1.0
* Werkzeug version:

**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

A barebones Flask app run by coverage.py and hit by `curl` should produce a `.coverage` data file to measure code coverage.

Tell us what should happen.

```python
# hello.py
from flask import Flask
app = Flask(__name__)


@app.route("/")
def hello():
    return "Hello World!"
```

```bash
export FLASK_APP=hello.py
coverage run \
              --parallel-mode \
              -m flask run &> /tmp/flask.log &
curl http://127.0.0.1:5000/
jobs -p | xargs # kill the coverage.py / flask process so report will be written
coverage xml
```

See recent run in CircleCI
https://circleci.com/gh/brycefisher/coveragepy-flask

### Actual Behavior

No .coverage data was produced.

### Environment

* Python version: 3.7.0
* Flask version: 1.0.2
* Werkzeug version: ??? -- will find!

Corresponding issue in coverage.py project:
https://github.com/nedbat/coveragepy/issues/810
Converted filename into string, File upload didn't worked without doing it

The file upload code didn't worked without converting file name to string in the function file.save()
Changed the code so that the code in the documentation will work without any modification.

### Expected Behavior

When using `DispatcherMiddleware` to combine multiple flask apps, I expect to be able to run the app with the following command:

```bash
FLASK_APP=main:app flask run
```

```python
from flask import Flask
from werkzeug.middleware.dispatcher import DispatcherMiddleware


api = Flask("api")
admin = Flask("admin")
app = DispatcherMiddleware(api, {"/admin": admin})
```

### Actual Behavior

The `app` object fails the following typecheck:

https://github.com/pallets/flask/blob/d4b688bd035b9704b3168b28fed39c8fcfe3b997/src/flask/cli.py#L198

```pytb
127.0.0.1 - - [09/Jun/2019 15:16:30] "GET /admin/ HTTP/1.1" 500 -
Traceback (most recent call last):
  File "/Users/nshebanov/.pyenv/versions/3.7.2/lib/python3.7/site-packages/flask/_compat.py", line 36, in reraise
    raise value
  File "/Users/nshebanov/.pyenv/versions/3.7.2/lib/python3.7/site-packages/flask/cli.py", line 199, in find_app_by_string
    module=module.__name__, app_name=app_name
flask.cli.NoAppException: A valid Flask application was not obtained from "main:app".
```

### Environment

* Python version: 3.7.2
* Flask version: 1.0.3
* Werkzeug version: 0.15.4

### Suggestion

Drop the check when FLASK_APP is specified and it is not a factory, or change the check to allow for middlewares (it's hard to imagine such a check though). 

Checking for type `Flask` makes sense within [`find_best_app`](https://github.com/pallets/flask/blob/d4b688bd035b9704b3168b28fed39c8fcfe3b997/src/flask/cli.py#L52) and at the moment of [`call_factory` result evaluation](https://github.com/pallets/flask/blob/master/src/flask/cli.py#L184) within `find_app_by_string`. 



Describe what this patch does to fix the issue.

Before I mentioned about this PR.

I found this method

https://github.com/pallets/flask/blob/d4b688bd035b9704b3168b28fed39c8fcfe3b997/src/flask/debughelpers.py#L124-L169

I'm also using SonarQube to review codes. SonarQube warned me about Cognitive Complexity. There is documentation here;

https://www.sonarsource.com/docs/CognitiveComplexity.pdf

For example,

https://github.com/pallets/flask/blob/d4b688bd035b9704b3168b28fed39c8fcfe3b997/src/flask/debughelpers.py#L130

this part can be changed like that.

```python
if reqctx and reqctx.request.blueprint is not None:
```

The other thing is;

https://github.com/pallets/flask/blob/d4b688bd035b9704b3168b28fed39c8fcfe3b997/src/flask/debughelpers.py#L146-L150

this part can be changed like that.

```python
detail = "no match"
if triple is not None:
   detail = "found (%r)" % (triple[1] or "<string>")
   total_found += 1
```

I think we can say; if the triple variable is **None**, don't run this `total_found += 1` statement.

The last one is;

https://github.com/pallets/flask/blob/d4b688bd035b9704b3168b28fed39c8fcfe3b997/src/flask/debughelpers.py#L154-L159

I think this part can be changed too. Because `total_found` variable initialized with **0** value.

So, there will be two situations always. for **0** or for **> 1**.

When `total_found` is 0 or 1, the `seems_fishy` will be True. So, we may don't need to reassign this variable for each control flow. Instead of that, we can change this code like below;

```python
info_msg = "Error: the template could not be found."
seems_fishy = True
if total_found > 1:
   info_msg = "Warning: multiple loaders returned a match for the template."
```
**518 tests are passed and 14 skipped**.

Link to any relevant issues or pull requests.

#3254
Before starting, I'm so sorry because this issue can be totally ridiculous.

Hi. I've been doing a review of the Flask code base for a while.

I found this method

https://github.com/pallets/flask/blob/d4b688bd035b9704b3168b28fed39c8fcfe3b997/src/flask/debughelpers.py#L124-L169

I'm also using SonarQube to review codes. SonarQube warned me about Cognitive Complexity. There is documentation here;

https://www.sonarsource.com/docs/CognitiveComplexity.pdf

For example,

https://github.com/pallets/flask/blob/d4b688bd035b9704b3168b28fed39c8fcfe3b997/src/flask/debughelpers.py#L130

this part can be changed like that.

```python
if reqctx and reqctx.request.blueprint is not None:
```

The other thing is;

https://github.com/pallets/flask/blob/d4b688bd035b9704b3168b28fed39c8fcfe3b997/src/flask/debughelpers.py#L146-L150

this part can be changed like that.

```python
detail = "no match"
if triple is not None:
   detail = "found (%r)" % (triple[1] or "<string>")
   total_found += 1
```

I think we can say; if the triple variable is **None**, don't run this `total_found += 1` statement.

The last one is;

https://github.com/pallets/flask/blob/d4b688bd035b9704b3168b28fed39c8fcfe3b997/src/flask/debughelpers.py#L154-L159

I think this part can be changed too. Because `total_found` variable initialized with **0** value.

So, there will be two situations always. for **0** or for **> 1**.

When `total_found` is 0 or 1, the `seems_fishy` will be True. So, we may don't need to reassign this variable for each control flow. Instead of that, we can change this code like below;

```python
info_msg = "Error: the template could not be found."
seems_fishy = True
if total_found > 1:
   info_msg = "Warning: multiple loaders returned a match for the template."
```
Describe what this patch does to fix the issue.

Added :param to the _get_exc_class_and_code method docstring

Link to any relevant issues or pull requests.

This fixes #3252

Currently the `_get_exc_class_and_code` method does not have `:param:` entry for `exc_class_or_code`.

If so, I can add `:param:` entry for methods which does not contain `:param:` entry.

https://github.com/pallets/flask/blob/d4b688bd035b9704b3168b28fed39c8fcfe3b997/src/flask/app.py#L1334-L1346
**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

I'm working on a large Flask project. Occasionally, Flask will give me an ImportError, for example the following:

```pytb
NoAppException: While importing "application", an ImportError was raised:

Traceback (most recent call last):
  File "/Users/fintan/anaconda/lib/python2.7/site-packages/flask/cli.py", line 235, in locate_app
    __import__(module_name)
  File "/Users/fintan/Dropbox/LearnerShape/server3/application.py", line 1, in <module>
    from learnershape.app import *
  File "/Users/fintan/Dropbox/LearnerShape/server3/learnershape/app.py", line 4, in <module>
    from learnershape import core
  File "/Users/fintan/Dropbox/LearnerShape/server3/learnershape/core/__init__.py", line 2, in <module>
    from . import views
ImportError: cannot import name views
```

When I restart the server, the error goes away and Flask runs perfectly.

Do you think this could be due to a) a bad import structure, b) Flask not reloading modules correctly, c) .pyc files?


### Expected Behavior

Flask should only show an ImportError when there is a problem with module imports.

This problem occurs at least twice a day, but I haven't been able to get it to occur yet in a minimal version. If anyone has time to look into this, I can add you as a collaborator to our repository.

### Actual Behavior

Flask shows an ImportError which persists until Flask is restarted, then goes away.

```pytb
NoAppException: While importing "application", an ImportError was raised:

Traceback (most recent call last):
  File "/Users/fintan/anaconda/lib/python2.7/site-packages/flask/cli.py", line 235, in locate_app
    __import__(module_name)
  File "/Users/fintan/Dropbox/LearnerShape/server3/application.py", line 1, in <module>
    from learnershape.app import *
  File "/Users/fintan/Dropbox/LearnerShape/server3/learnershape/app.py", line 4, in <module>
    from learnershape import core
  File "/Users/fintan/Dropbox/LearnerShape/server3/learnershape/core/__init__.py", line 2, in <module>
    from . import views
ImportError: cannot import name views
```

### Environment

* Python version: 2.7.11
* Flask version: 1.0.2
* Werkzeug version: 0.15.2

Pls help me.  I can't access localhost Using flask and a message is prompted "get/http 1.1.. I don't understand 
Pls check the image and help me out 



![Screen Shot 2019-06-04 at 9 00 08 pm](https://user-images.githubusercontent.com/50979391/58897542-29b0e580-8716-11e9-8b96-14b24a92c2fd.png)

### Expected Behavior

When `self.form` is indexed with a key that isn't present, `BadRequestKeyError` is raised. Under 1.0.2 and below, the `.args` property of this exception contained the actual missing key -- great for lightweight error presentation.

Minimal demonstration:

```python
from flask import Flask, jsonify, request
from werkzeug.exceptions import BadRequestKeyError

app = Flask('test')

@app.errorhandler(BadRequestKeyError)
def bad_key(e):
    return jsonify({'missing key(s)': e.args})


@app.route('/')
def root():
    return request.form['foo']

app.run()
```

Under 1.0.2 and below we see the following behavior:

```
 % curl localhost:5000
{"missing key(s)":["foo"]}
```

Under 1.0.3:

```
% curl localhost:5000
{"missing key(s)":[]}
```

This occurs independent of `$FLASK_DEBUG`

### Actual Behavior

There appears to be no way to get at the missing key from an error handler.

### Environment

* Python version: 3.6.6
* Flask version: 1.0.3
* Werkzeug version: 0.15.4

Added the params list to the Blueprint documentation. closes #3216



This attempts to clarify the documentation as discussed in #2759 and #3219.
Wrapped request context use with `has_request_context` in logging docs.

Fixes https://github.com/pallets/flask/issues/2838
This addresses #3211 by guarding the ssl import with an except ImportError, and then raising 
 click.BackParameter() if SSL is not present when --cert is passed to the CLI. 

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Updated pre-commit for flake8 config
Change the example in "Testing Flask Applications" to demonstrate using test client with teardown. (by using with statement)

#2949

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Comment on bare except usage in _compat.py

(Fixes pallets/flask#3227)
Removed unnecessary class import.
Closes #3226.
Change python properties to decorator syntax. Does #3218 

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

(Fixes #3224)

Check if the CLI group is empty during Blueprint registration, and exit early if it is.
Before, returning a `bool` from a route caused the error

```
[2019-05-31 10:08:42,216] ERROR in app: Exception on / [GET]
Traceback (most recent call last):
  File "/Users/johnzeringue/Documents/ts-open/flask/flask/app.py", line 2070, in make_response
    rv = self.response_class.force_type(rv, request.environ)
  File "/Users/johnzeringue/Documents/ts-open/flask/env/lib/python3.7/site-packages/werkzeug/wrappers/base_response.py", line 269, in force_type
    response = BaseResponse(*_run_wsgi_app(response, environ))
  File "/Users/johnzeringue/Documents/ts-open/flask/env/lib/python3.7/site-packages/werkzeug/wrappers/base_response.py", line 26, in _run_wsgi_app
    return _run_wsgi_app(*args)
  File "/Users/johnzeringue/Documents/ts-open/flask/env/lib/python3.7/site-packages/werkzeug/test.py", line 1119, in run_wsgi_app
    app_rv = app(environ, start_response)
TypeError: 'bool' object is not callable

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/johnzeringue/Documents/ts-open/flask/flask/app.py", line 2393, in wsgi_app
    response = self.full_dispatch_request()
  File "/Users/johnzeringue/Documents/ts-open/flask/flask/app.py", line 1906, in full_dispatch_request
    return self.finalize_request(rv)
  File "/Users/johnzeringue/Documents/ts-open/flask/flask/app.py", line 1921, in finalize_request
    response = self.make_response(rv)
  File "/Users/johnzeringue/Documents/ts-open/flask/flask/app.py", line 2078, in make_response
    reraise(TypeError, new_error, sys.exc_info()[2])
  File "/Users/johnzeringue/Documents/ts-open/flask/flask/_compat.py", line 39, in reraise
    raise value.with_traceback(tb)
  File "/Users/johnzeringue/Documents/ts-open/flask/flask/app.py", line 2070, in make_response
    rv = self.response_class.force_type(rv, request.environ)
  File "/Users/johnzeringue/Documents/ts-open/flask/env/lib/python3.7/site-packages/werkzeug/wrappers/base_response.py", line 269, in force_type
    response = BaseResponse(*_run_wsgi_app(response, environ))
  File "/Users/johnzeringue/Documents/ts-open/flask/env/lib/python3.7/site-packages/werkzeug/wrappers/base_response.py", line 26, in _run_wsgi_app
    return _run_wsgi_app(*args)
  File "/Users/johnzeringue/Documents/ts-open/flask/env/lib/python3.7/site-packages/werkzeug/test.py", line 1119, in run_wsgi_app
    app_rv = app(environ, start_response)
TypeError: 'bool' object is not callable
The view function did not return a valid response. The return type must be a string, tuple, Response instance, or WSGI callable, but it was a bool.
```

Now, it returns the more readable

```
[2019-05-31 10:36:19,500] ERROR in app: Exception on / [GET]
Traceback (most recent call last):
  File "/Users/johnzeringue/Documents/ts-open/flask/flask/app.py", line 2400, in wsgi_app
    response = self.full_dispatch_request()
  File "/Users/johnzeringue/Documents/ts-open/flask/flask/app.py", line 1907, in full_dispatch_request
    return self.finalize_request(rv)
  File "/Users/johnzeringue/Documents/ts-open/flask/flask/app.py", line 1922, in finalize_request
    response = self.make_response(rv)
  File "/Users/johnzeringue/Documents/ts-open/flask/flask/app.py", line 2085, in make_response
    " {rv.__class__.__name__}.".format(rv=rv))
TypeError: The view function did not return a valid response. The return type must be a string, dict, tuple, Response instance, or WSGI callable, but it was a bool.
```

Fixes #3214

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

closes #3225 
Remove the unused import. Reran the test suit, which all pass successfully:

```
(flask-dev) ryanthielke:~/flask > pytest                                                     [34/672]
======================================== test session starts ========================================
platform darwin -- Python 3.6.7, pytest-4.5.0, py-1.8.0, pluggy-0.12.0
rootdir: /Users/ryanthielke/flask, inifile: setup.cfg, testpaths: tests
collected 528 items

tests/test_appctx.py ..............                                                           [  2%]
tests/test_basic.py ....................................................s.................... [ 16%]
.................................................                                             [ 25%]
tests/test_blueprints.py ................................................                     [ 34%]
tests/test_cli.py ..........................................ss.s....                          [ 44%]
tests/test_config.py ................                                                         [ 47%]
tests/test_helpers.py ....................................................................... [ 60%]
..............................................................................                [ 75%]
tests/test_instance_config.py ...........s                                                    [ 77%]
tests/test_json_tag.py ..............                                                         [ 80%]
tests/test_logging.py ......                                                                  [ 81%]
tests/test_regression.py ...                                                                  [ 82%]
tests/test_reqctx.py .......ss....                                                            [ 84%]
tests/test_signals.py sssssss                                                                 [ 85%]
tests/test_subclassing.py .                                                                   [ 86%]
tests/test_templating.py ...............................                                      [ 92%]
tests/test_testing.py ..................s......                                               [ 96%]
tests/test_user_error_handler.py .....                                                        [ 97%]
tests/test_views.py ............                                                              [100%]

============================== 513 passed, 15 skipped in 10.98 seconds =============================
```
Added a new class `flask.testing.EnvironBuilder` inheriting from `werkzeug.test.EnvironBuilder`. 

Logic from `make_test_environ_builder()` moved to the constructor of that class, and changed to simply instantiate the class, while issuing a `DeprecationWarning`.

I did explore making `json_dumps()` a regular method rather than a static method, to pick up `app`, but if anything was expecting to call `EnvironBuilder.json_dumps()` as a static method then this would break. Requires funky descriptor tricks to work both as a static method and an instance method under Python 2 and so didn't seem worth the code it would take.

closes #3207 
Should have added this in 33379155f613dbdb4fe6d0918a5038a989fc18bf!


In the [contributing guide](https://github.com/pallets/flask/blob/master/CONTRIBUTING.rst) we request people to use Black to autoformat their code via pre-commit.

However, [there is no check for this on Azure Pipelines](https://github.com/pallets/flask/blob/master/.azure-pipelines.yml), meaning it is not checked automatically by GitHub for each pull request. This means style issues can be merged, requiring unrelated style fixes in later commits.

In tox.ini there is a [stylecheck target](https://github.com/pallets/flask/blob/2c68f86336dc8729f58e8e19af0f49c269c1cfaa/tox.ini#L46). We should configure this to run on Azure Pipelines.

The following two lines:
https://github.com/pallets/flask/blob/2c68f86336dc8729f58e8e19af0f49c269c1cfaa/flask/_compat.py#L100
do
```python
except:
    raise
```
which looks like a no-op. Is this actually doing something? If not remove, if so let's add a comment explaining.
The following line contains an unused import:
https://github.com/pallets/flask/blob/2c68f86336dc8729f58e8e19af0f49c269c1cfaa/flask/helpers.py#L26

Specifically, `Range` is unused.
The following line contains a `del <local_variable>` as the last line of the function (inside a `finally` block):
https://github.com/pallets/flask/blob/2c68f86336dc8729f58e8e19af0f49c269c1cfaa/flask/cli.py#L135

This looks suspicious since there is usually no need to `del` a variable that is local to a function in its last line. If this is unintended it should be removed, otherwise there should probably be a comment in the code explaining why this is necessary?
After #1369, each blueprint has a `cli` group that will be registered with the `flask` command. This should not be registered if no commands were registered with the blueprint, otherwise empty groups show up in the CLI help output.
Occasionally, upon logging out of the flask server, this error occurs. Possibly a race condition between flashing a message and not being logged in?

### Expected Behavior

Expect no error, or to exit gracefully.

### Actual Behavior

Get the error: `AttributeError: 'NoneType' object has no attribute 'append'`

```pytb
File /home/venv/lib/python3.7/site-packages/flask/app.py line 1832 in full_dispatch_request
rv = self.dispatch_request()
File /home/venv/lib/python3.7/site-packages/flask/app.py line 1818 in dispatch_request
return self.view_functions[rule.endpoint](**req.view_args)
File /home/venv/lib/python3.7/site-packages/flask_login/utils.py line 260 in decorated_view
return current_app.login_manager.unauthorized()
File /home/venv/lib/python3.7/site-packages/flask_login/login_manager.py line 167 in unauthorized
flash(self.login_message, category=self.login_message_category)
File /home/venv/lib/python3.7/site-packages/flask/helpers.py line 409 in flash
flashes.append((category, message))
AttributeError: 'NoneType' object has no attribute 'append'
```

### Environment

* Python version: 3.7
* Flask version: 1.0.3

**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

Start a Flask server, and received a http post msg, and handle well.

```python
threading.Thread(target=MpPool._handle_results, args=(self,))

def _handle_results(self):
     self._passback.handle(tid, result, ex)

here self._passback is start_serving function, and exception where it is.
```

### Actual Behavior

Start a Flask server, and received a http post msg, and encounter exception.

```pytb
Traceback (most recent call last):
  File "D:\Dev\Anaconda3\envs\jlpy\lib\site-packages\flask\app.py", line 1813, in full_dispatch_request
    rv = self.dispatch_request()
  File "D:\Dev\Anaconda3\envs\jlpy\lib\site-packages\flask\app.py", line 1799, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "D:\Dev\Anaconda3\envs\jlpy\lib\site-packages\flask_restful\__init__.py", line 458, in wrapper
    resp = resource(*args, **kwargs)
  File "D:\Dev\Anaconda3\envs\jlpy\lib\site-packages\flask\views.py", line 88, in view
    return self.dispatch_request(*args, **kwargs)
  File "D:\Dev\Anaconda3\envs\jlpy\lib\site-packages\flask_restful\__init__.py", line 573, in dispatch_request
    resp = meth(*args, **kwargs)
  File "D:\Dev\source\Python\Base\src\main\inference\Server.py", line 75, in post
    return server.submit(tid)
  File "D:\Dev\source\Python\Base\src\main\inference\Server.py", line 35, in submit
    if self._inference.submit(tid, _task_json):
  File "D:\Dev\source\Python\Base\src\main\inference\Inference.py", line 34, in submit
    self._executor_pool.submit(tid, task)
  File "D:\Dev\source\Python\Base\src\main\hwv_concurrent\process.py", line 194, in submit
    worker.start()
  File "D:\Dev\source\Python\Base\src\main\hwv_concurrent\process.py", line 40, in start
    self._process.start()
  File "D:\Dev\Anaconda3\envs\jlpy\lib\multiprocessing\process.py", line 105, in start
    self._popen = self._Popen(self)
  File "D:\Dev\Anaconda3\envs\jlpy\lib\multiprocessing\context.py", line 223, in _Popen
    return _default_context.get_context().Process._Popen(process_obj)
  File "D:\Dev\Anaconda3\envs\jlpy\lib\multiprocessing\context.py", line 322, in _Popen
    return Popen(process_obj)
  File "D:\Dev\Anaconda3\envs\jlpy\lib\multiprocessing\popen_spawn_win32.py", line 65, in __init__
    reduction.dump(process_obj, to_child)
  File "D:\Dev\Anaconda3\envs\jlpy\lib\multiprocessing\reduction.py", line 60, in dump
    ForkingPickler(file, protocol).dump(obj)
AttributeError: Can't pickle local object 'start_serving.<locals>.AIServer'
```

### Environment
Windows10
* Python version:3.6
* Flask version:1.0.2
* Werkzeug version:0.15.4

Updated all of python's (still valid but outdated) property objects to decorators.

This solves the issue #3218 
Since Flask 1.0.3 (more specifically since b92b2e6c743c8b09744c9c9788046c719cc38eab), routing exceptions are no longer handled via application error handlers. This breaks our project, which has been using this feature to change the body and headers of redirections. In short, we want to be able to return HTML responses for web endpoints and JSON responses for API endpoints, including redirections. What is the idiomatic way of doing this in Flask 1.0.3?

### Minimal working example

```python
# test.py
import flask
import werkzeug

class App(flask.Flask):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)

        @self.errorhandler(Exception)
        def handle_exception(e):
            return self._handle_error(e)

    def _handle_error(self, e):
        if isinstance(e, werkzeug.routing.RequestRedirect):
            return 'redirection\n', 308
        return 'error\n', 500

app = App(__name__)

@app.route('/test/')
def test():
    return 'test\n'
```
Run it via `FLASK_APP=test:app flask run`.

### Expected behavior

```
$ curl http://127.0.0.1:5000/test
redirection
```
This is what happens in Flask 1.0.2 and earlier.

### Actual behavior

```
$ curl http://127.0.0.1:5000/test
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<title>Redirecting...</title>
<h1>Redirecting...</h1>
* Closing connection 0
<p>You should be redirected automatically to target URL: <a href="http://127.0.0.1:5000/test/">http://127.0.0.1:5000/test/</a>.  If not click the link.
```
This is what happens in Flask 1.0.3.

### Question

What is the idiomatic way of changing the body and headers of redirections in Flask 1.0.3? We could do the following to get the original behavior, but it feels like a hack:
```python
class App(flask.Flask):
    # ...

    def handle_http_exception(self, e):
        if isinstance(e, werkzeug.routing.RoutingException):
            return self._handle_error(e)

        return super().handle_http_exception(e)
```
Is there a better way?

### Environment

* Python version: 3.7.3 (Linux)
* Flask version: 1.0.2 and 1.0.3 (see above)
* Werkzeug version: 0.15.4

### Expected Behavior

`url_for` should consistently produce urls which are absolute with regard to the server root, i.e., they should start with a `/`.

```python
app = Flask(__name__, static_url_path='')
url_for('static', filename='some_static_file')
```

### Actual Behavior

When running under gnunicorn with `APPLICATION_ROOT='/myapp/'`, the `url_for` call produces the URL `myapp/some_static_file`, while when running under werkzeug with `APPLICATION_ROOT='/'`, the `url_for` call produces the URL `/some_static_file`.

This is a problem, because, combined with [this werkzeug issue](https://github.com/pallets/werkzeug/issues/1132), there's no straightforward way to use `url_for` in templates for both development and production: `{{ url_for('static', filename='some_static_file') }}` produces `myapp/some_static_file` in production, which fails, while `/{{ url_for('static', filename='some_static_file') }}` produces `//some_static_file` in development, which fails.

### Environment

* Python version: 3.6.5
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

A bunch of properties in the codebase are defined using `property` without the decorator syntax, which, while valid, isn't very intuitive anymore.

```python
def _get_some_value(self):
    ...

def _set_some_value(self, value):
    ...

some_value = property(_get_some_value, _set_some_value, doc="...")
del _get_some_value, _set_some_value
```

```python
@property
def some_value(self):
    """..."""
    ...

@some_value.setter
def some_value(self, value):
    ...
```
`Blueprint` does not have reStructuredText markup for the init parameters. Add `:param:` entries for each parameter.
Blueprints are supposed to provide a very similar API to the Flask object itself, the difference being that Blueprints defer registration until later. Currently, blueprints can only be registered on apps, they're not nestable, and apps can't be registered with other apps, but this is something that #593 and #1548 want to change.

`Blueprint` and `Flask` do derive from `helpers._PackageBoundObject`, but this is mostly concerned with managing static files, templates, and other resource files. I think identifying the common API between the two and extracting it to a common base class may be a good step towards understanding how we can support app and blueprint nesting. Hopefully, it may at least make the code cleaner and easier to maintain.
One of the most common errors/questions on Stack Overflow is some variant of "what does 'dict object is not callable' mean, how do I return JSON?" Now that #3111 is merged, returning `dict` from a view produces a JSON response. However, there are still plenty of other types that will produce that error, such as returning a `bool`, or a `User` object, or a list of rows from a database query.

`Flask.make_response` should check whether an otherwise unhandled value is a `BaseResponse` subclass or a `callable` before treating it as such. Then it can raise a more helpful error.
Now that we have a Black pre-commit hook (#3138),
ensure pre-commit gets installed on ``pip install -e .[dev]``
and document use of Black (rather than "try to follow pep8")
in CONTRIBUTING.
Python can be compiled without certain modules, including `ssl`. It's somewhat common for that to happen when users compile Python from source and don't have the `libssl` headers set up. `flask.cli` imports `ssl` unconditionally, but it's only for optional SSL cert support in the dev server, so this can be guarded with `except ImportErrror`. Werkzeug already has such a workaround, although it's a little more complicated than what needs to be done in Flask.

If no `ssl` module is imported, using the cert-related options in the CLI should raise a usage error.
In the code below：

```python
from flask import Flask, jsonify

app = Flask(__name__)

@app.route('/users/kaka')
def update_user():
    return jsonify(a=1)

@app.route('/users/kaka/')
def update_userss():
    return jsonify(a=11)

if __name__ == '__main__':
    app.run(debug=True, port=3000)
```

然后调用:

```sh
qq@zz:~$ curl http://127.0.0.1:3000/users/kaka/
{
  "a": 11
}
qq@zz:~$ curl http://127.0.0.1:3000/users/kaka
{
  "a": 1
}
# 这是因为werkzug中所有的路由都存在一个列表中, 所以涉及到匹配的先后顺序
```

然后将路径`/users/kaka`最后的斜杠顺序换过来:

```python
from flask import Flask, jsonify

app = Flask(__name__)

@app.route('/users/kaka/')
def update_user():
    return jsonify(a=1)

@app.route('/users/kaka')
def update_userss():
    return jsonify(a=11)

if __name__ == '__main__':
    app.run(debug=True, port=3000)
```

返回结果:

```sh
qq@zz:~$ curl http://127.0.0.1:3000/users/kaka/
{
  "a": 1
}
qq@zz:~$ curl http://127.0.0.1:3000/users/kaka
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<title>Redirecting...</title>
<h1>Redirecting...</h1>
<p>You should be redirected automatically to target URL: <a href="http://127.0.0.1:3000/users/kaka/">http://127.0.0.1:3000/users/kaka/</a>.  If not click the link.
```

the diff of two is the order of `/users/haha/` is ahead or behind
### Expected Behavior

I run my flask application from a given folder A, I expect the current working directory to be A.

### Actual Behavior

Instead, the working directory is changed to the directory where a `.env` file is found.

### Environment

* Python version: 3.6.5
* Flask version: 1.03
* Werkzeug version: 0.15.4

### Example

Here is a bash session where we can see the bug:
```
$ pipenv install flask[dotenv]
[ some pipenv output ]
$ cat hello.py 
import os
from flask import Flask


app = Flask(__name__)

@app.route("/")
def hello():
    return os.getcwd() + "\n"
$ pwd  # my current working directory
/tmp/dotenv
$ FLASK_APP=hello.py pipenv run flask run &
[1] 18872
$  * Serving Flask app "hello.py"
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)

$ curl localhost:5000/  # all is good
127.0.0.1 - - [20/May/2019 15:40:46] "GET / HTTP/1.1" 200 -
/tmp/dotenv
$ touch /tmp/.env  # now I introduce a dot env file
$ fg  # let's restart the server
FLASK_APP=hello.py pipenv run flask run
^C
$ FLASK_APP=hello.py pipenv run flask run &
[1] 18920
$  * Serving Flask app "hello.py"
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
Usage: flask run [OPTIONS]

Error: Could not import "hello".

[1]+  Termine 2               FLASK_APP=hello.py pipenv run flask run
$ # We can note Flask itself is not able to load my app anymore!
$ echo -e "\napp.run()" >> hello.py  # let's run the app from the script
$ pipenv run python hello.py &
[1] 19031
$  * Serving Flask app "hello" (lazy loading)
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)

$ curl localhost:5000/
127.0.0.1 - - [20/May/2019 15:42:27] "GET / HTTP/1.1" 200 -
/tmp
$ # My working directory is not the expected value
```

This came from [this exact line](https://github.com/pallets/flask/commit/491d331e6e0a7915c9e6d9b3287688ac7a3f56ca#diff-61bbd5ac9238364564a7315cc6bc2156R555). I can't see why this is useful, as the `.env` is already loaded at this time.
Blinker has a [`connect_via()`](https://pythonhosted.org/blinker/#blinker.base.Signal.connect_via) method. `_FakeSignal` should stub this method, as well as the others.
Werkzeug's `EnvironBuilder` gained a `json_dumps` attribute, but Flask doesn't have an `EnvironBuilder` subclass right now to take advantage of that, and there's no way to configure the `Client` to use a different builder class anyway. Might be good to refactor `flask.testing.make_test_environ_builder` to be an `EnvironBuilder` subclass at some point, rather than a factory wrapper.

_Originally posted by @davidism in https://github.com/pallets/flask/pull/3181#issuecomment-493489553_
Allow passing `app` to `json.dumps` (and `json.loads` for symmetry, though it's not required for this), and use it instead of `current_app` when available. `make_test_environ_builder` can pass the app it was passed, rather than pushing an app context in order to configure the JSON encoder.

closes #2900 
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

backporting from master

includes some tweaks to try to get coverage on build page
No functional changes
testing
### Expected Behavior

On documentation e.g. http://flask.pocoo.org/docs/1.0/config/#ENV when I 
press changelog button will show some information.

### Actual Behavior

When I press changelog button doesn't show any news.  This is working on unstable
documentation, but will be great if that is working on stable documentation too. 

### Environment

* Flask version: 1.0
* Documentation: http://flask.pocoo.org/docs/1.0/config/#ENV

Remove unused reference in blueprints.py of URL_JOIN

From issue:
https://github.com/pallets/flask/issues/3165
This patch fixes a few small spelling errors throughout the documentation. 

I didn't change common programming or Python jargon. For example, I didn't change virtualenv (to "virtual environment"), "runtime", or "auto escaping".

I turned ReST to REST because the latter spelling seems to have taken over.
Closing list tags were missing in 'templates.rst' within the codeblock example on lines 56, 57, 59 and 60.

I noticed while working through the tutorial that the closing tags for the list elements were missing - and this is my first pull request ever! (Hopefully it is correct... and I've actually done it right!)

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

If the selected shell is not installed, it will fall back to the standard Python interactive shell.
All shells got the same banner and context.

The standard shell is left as the default, so this will not break backward compatibilty and doesn't result in behavior change.

It could be argued that this should be in a different package, but these are the most common shells and having them directly in Flask itself is convenient IMO. I really hate the default Python shell, because there is no tab completion and the first thing I do is to install IPython and use that.

Support dataclass to be encoded with jsonify using `dataclasses.as_dict()`.


### Expected  Behavior
Hi folks. I'm not sure if this is a Flask issue or an Atom one. The issue is Flask can't find the app name when the project is added to Atom.

What should happen is Flask should start the app after running `flask run` when the project is added to Atom (under File -> Add Project Folder). Instead, I get this error `Error: Could not import "hello".`

This has happened to me in two other projects.

The immediate and obvious solution is to not add projects to Atom. I'm reporting this because there might be other implications.

### Actual Behavior

I started off clean, then created an app as shown in my terminal dump
```
zak-mbp:git zakariaahmad$ mkdir hello2
zak-mbp:git zakariaahmad$ cd hello2
zak-mbp:hello2 zakariaahmad$ pipenv --python 3.7
Creating a virtualenv for this project…
Pipfile: /Volumes/GoogleDrive/My Drive/git/hello2/Pipfile
Using /usr/local/opt/python/libexec/bin/python (3.7.3) to create virtualenv…
⠧ Creating virtual environment...Using base prefix '/usr/local/Cellar/python/3.7.3/Frameworks/Python.framework/Versions/3.7'
New python executable in /Users/zakariaahmad/.local/share/virtualenvs/hello2-xmwDkloG/bin/python3.7
Also creating executable in /Users/zakariaahmad/.local/share/virtualenvs/hello2-xmwDkloG/bin/python
Installing setuptools, pip, wheel...
done.
Running virtualenv with interpreter /usr/local/opt/python/libexec/bin/python

✔ Successfully created virtual environment!
Virtualenv location: /Users/zakariaahmad/.local/share/virtualenvs/hello2-xmwDkloG
Creating a Pipfile for this project…
zak-mbp:hello2 zakariaahmad$ pipenv install flask
Installing flask…
Adding flask to Pipfile's [packages]…
✔ Installation Succeeded
Pipfile.lock not found, creating…
Locking [dev-packages] dependencies…
Locking [packages] dependencies…
✔ Success!
Updated Pipfile.lock (662286)!
Installing dependencies from Pipfile.lock (662286)…
  🐍   ▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉ 6/6 — 00:00:01
To activate this project's virtualenv, run pipenv shell.
Alternatively, run a command inside the virtualenv with pipenv run.
zak-mbp:hello2 zakariaahmad$ vim hello.py
zak-mbp:hello2 zakariaahmad$ cat hello.py
from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello, World!'
zak-mbp:hello2 zakariaahmad$ pipenv shell
Launching subshell in virtual environment…
bash-3.2$  . /Users/zakariaahmad/.local/share/virtualenvs/hello2-xmwDkloG/bin/activate
(hello2) bash-3.2$ FLASK_APP=hello.py flask run
 * Serving Flask app "hello.py"
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
127.0.0.1 - - [10/May/2019 15:41:17] "GET / HTTP/1.1" 200 -
^C(hello2) bash-3.2$ ls -la
total 48
drwx------  2 zakariaahmad  staff  4096 May 10 15:39 .
drwx------  5 zakariaahmad  staff  4096 May 10 15:38 ..
-rw-------  1 zakariaahmad  staff   150 May 10 15:39 Pipfile
-rw-------  1 zakariaahmad  staff  4566 May 10 15:39 Pipfile.lock
-rw-------  1 zakariaahmad  staff   109 May 10 15:39 hello.py
(hello2) bash-3.2$ FLASK_APP=hello.py flask run
 * Serving Flask app "hello.py"
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
127.0.0.1 - - [10/May/2019 15:41:41] "GET / HTTP/1.1" 200 -
^C(hello2) bash-3.2$ mkdir templates
(hello2) bash-3.2$ vim templates/index.html
(hello2) bash-3.2$ cat templates/index.html
<!doctype html>
<html>
  <head>
    <title>This is the title of the webpage!</title>
  </head>
  <body>
    <p>This is an example paragraph.</p>
  </body>
</html>
(hello2) bash-3.2$ vim hello.py
(hello2) bash-3.2$ cat hello.py
from flask import Flask
from flask import render_template
app = Flask(__name__)

@app.route('/')
def hello_world():
    return render_template('index.html')
(hello2) bash-3.2$ FLASK_APP=hello.py flask run
 * Serving Flask app "hello.py"
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
127.0.0.1 - - [10/May/2019 15:44:54] "GET / HTTP/1.1" 200 -
^C(hello2) bash-3.2$ ls -la
total 56
drwx------  3 zakariaahmad  staff  4096 May 10 15:44 .
drwx------  5 zakariaahmad  staff  4096 May 10 15:38 ..
-rw-------  1 zakariaahmad  staff   150 May 10 15:39 Pipfile
-rw-------  1 zakariaahmad  staff  4566 May 10 15:39 Pipfile.lock
-rw-------  1 zakariaahmad  staff   157 May 10 15:44 hello.py
drwx------  2 zakariaahmad  staff  4096 May 10 15:43 templates
```

Next, I added the hello2 folder project to Atom (from File -> Add Project Folder), and this is the terminal dump after adding it to Atom. As you can see, it's not changing the contents of `hello.py` nor adding any file(s) to the hello2 project that might interfere with `hello.py`. Then I receive the error shown at the end.

```
(hello2) bash-3.2$ cat hello.py
from flask import Flask
from flask import render_template
app = Flask(__name__)

@app.route('/')
def hello_world():
    return render_template('index.html')
(hello2) bash-3.2$ ls -la
total 56
drwx------  3 zakariaahmad  staff  4096 May 10 15:44 .
drwx------  5 zakariaahmad  staff  4096 May 10 15:38 ..
-rw-------  1 zakariaahmad  staff   150 May 10 15:39 Pipfile
-rw-------  1 zakariaahmad  staff  4566 May 10 15:39 Pipfile.lock
-rw-------  1 zakariaahmad  staff   157 May 10 15:44 hello.py
drwx------  2 zakariaahmad  staff  4096 May 10 15:43 templates
(hello2) bash-3.2$ FLASK_APP=hello.py flask run
 * Serving Flask app "hello.py"
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: off
Usage: flask run [OPTIONS]

Error: Could not import "hello".
```
Traceback dump (after enabling debug mode):

```
flask.cli.NoAppException
flask.cli.NoAppException: Could not import "hello".

Traceback (most recent call last)
File "/Users/zakariaahmad/.local/share/virtualenvs/hello2-xmwDkloG/lib/python3.7/site-packages/flask/cli.py", line 235, in locate_app
__import__(module_name)
During handling of the above exception, another exception occurred:
File "/Users/zakariaahmad/.local/share/virtualenvs/hello2-xmwDkloG/lib/python3.7/site-packages/flask/cli.py", line 325, in __call__
self._flush_bg_loading_exception()
File "/Users/zakariaahmad/.local/share/virtualenvs/hello2-xmwDkloG/lib/python3.7/site-packages/flask/cli.py", line 313, in _flush_bg_loading_exception
reraise(*exc_info)
File "/Users/zakariaahmad/.local/share/virtualenvs/hello2-xmwDkloG/lib/python3.7/site-packages/flask/_compat.py", line 35, in reraise
raise value
File "/Users/zakariaahmad/.local/share/virtualenvs/hello2-xmwDkloG/lib/python3.7/site-packages/flask/cli.py", line 302, in _load_app
self._load_unlocked()
File "/Users/zakariaahmad/.local/share/virtualenvs/hello2-xmwDkloG/lib/python3.7/site-packages/flask/cli.py", line 317, in _load_unlocked
self._app = rv = self.loader()
File "/Users/zakariaahmad/.local/share/virtualenvs/hello2-xmwDkloG/lib/python3.7/site-packages/flask/cli.py", line 372, in load_app
app = locate_app(self, import_name, name)
File "/Users/zakariaahmad/.local/share/virtualenvs/hello2-xmwDkloG/lib/python3.7/site-packages/flask/cli.py", line 246, in locate_app
'Could not import "{name}".'.format(name=module_name)
flask.cli.NoAppException: Could not import "hello".
```

### Environment

* Python version: 3.7.3
* Flask version: 1.0.2
* Werkzeug version: 0.15.2
For example of passing via a Queue that does not work. https://github.com/HourGlss/FlaskSSE/blob/master/sse/sse.py

### Expected Behavior
Session is a global variable

### Actual Behavior
When passed via a queue the keys and associated values are dropped. When attempting to access globally, no keys are available even if they had been added by endpoints

### Environment

* Python version: 3.7
* Flask version: Default install
* Werkzeug version: Default install

- Initializes the database properly in the __init__.py

* add a changelog entry if this patch changes code


Issue is awkward english, the above change seems more understandable.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

This allows changing jinja environment options from the flask app:
```python
app.jinja_options['undefined'] = jinja2.ChainableUndefined
```

The above example will be valid when Jinja2 v2.11 will be released (including https://github.com/pallets/jinja/pull/997)
### Expected Behavior

Place the following code into `main.py`.

```python
from flask import Flask


app = Flask(__name__)
app.config['DEBUG'] = True

@app.route('/')
def root():
    return ":)"

app.run()
```

Set the execute bit  on `main.py`:
`chmod +x main.py`
Running the following command should start the server: `python main.py`

### Actual Behavior

```pyb
$ python main.py
 * Serving Flask app "main" (lazy loading)
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: on
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
Traceback (most recent call last):
  File "main.py", line 11, in <module>
    app.run()
  File "/Users/wadegilmer/miniconda3/envs/hello-flask/lib/python3.7/site-packages/flask/app.py", line 943, in run
    run_simple(host, port, self, **options)
  File "/Users/wadegilmer/miniconda3/envs/hello-flask/lib/python3.7/site-packages/werkzeug/serving.py", line 988, in run_simple
    run_with_reloader(inner, extra_files, reloader_interval, reloader_type)
  File "/Users/wadegilmer/miniconda3/envs/hello-flask/lib/python3.7/site-packages/werkzeug/_reloader.py", line 332, in run_with_reloader
    sys.exit(reloader.restart_with_reloader())
  File "/Users/wadegilmer/miniconda3/envs/hello-flask/lib/python3.7/site-packages/werkzeug/_reloader.py", line 176, in restart_with_reloader
    exit_code = subprocess.call(args, env=new_environ, close_fds=False)
  File "/Users/wadegilmer/miniconda3/envs/hello-flask/lib/python3.7/subprocess.py", line 323, in call
    with Popen(*popenargs, **kwargs) as p:
  File "/Users/wadegilmer/miniconda3/envs/hello-flask/lib/python3.7/subprocess.py", line 775, in __init__
    restore_signals, start_new_session)
  File "/Users/wadegilmer/miniconda3/envs/hello-flask/lib/python3.7/subprocess.py", line 1522, in _execute_child
    raise child_exception_type(errno_num, err_msg, err_filename)
OSError: [Errno 8] Exec format error: '/Users/wadegilmer/lc101/flask_error/main.py'
```

### Environment

* osx version: 10.13.6
* Python version: 3.7.3
* Flask version: 1.0.2
* Werkzeug version: 0.15.2

### Commentary

Adding a shabang line to `main.py` resolves the issue but is kind of unexpected. Additionally removing the execute bit also resolves the issue. Is this the expected behavior? 

i've spent a day on this, and can't find any documentation for why this is happening, but it appears Flask does some kind of sanitation of headers if they are used inside `before_request`

whenever i try to extract token from 'Bearer xxxxxx' it makes the entire header disappear. regardless if doing string.split(' ') or substring. 

all of this works just fine in controllers. but i am trying to make it generic for all controller actions. so i don't want to decorate every endpoint. 

the `Authorization` header looks like this `Bearer xxxxxxxxx`. but i also tested this on other custom headers and same thing happens. 

```
bp = Blueprint('default', __name__)  # type: Blueprint

def create_app() -> Flask:
    app = Flask(__name__)
    add_request_authorization(bp)  # i tried this with app and bp
    app.register_blueprint(bp)
    return app

def add_request_authorization(bp):
    """
    register okta verification event
    """
    @bp.before_request
    def verify_okta_for_request(*args, **kwargs):
        auth_header = request.headers.get('Authorization')  # this is ok
        print('auth:', auth_header)   # prints
        token = auth_header.split(' ')[1]  # makes the whole header "None" including on lines above
        token = auth_header[7:]  # makes the whole header 'None" 
```

looks like even if i try to assign the raw header to another variable, it vanishes! 

i also tried before_app_request
I want to set up a handler for all URLs that will handle the OPTIONS preflight requests
Following the "catch-all" example (@app.route("/<path:path>", methods=['OPTIONS']))

I found that if the server gets a route that has a handler with a different method neither of the handlers are called
 
### Expected Behavior
The OPTIONS request should have been routed to the "wildcard" OPTIONS handler

```python
from unittest import TestCase
from flask import Flask
from hamcrest import assert_that, equal_to
class TestSitePreferencesService(TestCase):
    def test(self):
        app = Flask(__name__)

        @app.route("/<path:path>", methods=['OPTIONS'])
        def catch_all(path):
            return "catch_all"

        @app.route("/specific", methods=['GET'])
        def specific():
            return "specific"

        client = app.test_client()
        result = client.options('/some/url')
        assert_that(result.data.decode('utf-8') , equal_to('catch_all'))

        result1 = client.get('some/url')
        assert_that(result1.status_code , equal_to(405)) # this identifies the global handler but the method is wrong this is expected

        result2 = client.options('/specific')
        # looks like this is not going to ether of the handlers
        assert_that(result2.data.decode('utf-8'),equal_to('catch_all')) # fails
```

### Actual Behavior
The request was not routed to the correct handler OPTIONS handler

### Environment

* Python version:3.7
* Flask version:1.0.2
* Werkzeug version:0.15.2


Werkzeug>=0.15's reloader now properly detects `python -m module`.

Fixes #3022

The PR https://github.com/pallets/flask/pull/3181 is the one updating Werkzeug to >=0.15, so it should be merged first.
Passes posargs to tox for pytest to emit JUnit XML.

See: https://dev.azure.com/brcrista/Python/_build/results?buildId=956&view=ms.vss-test-web.build-test-results-tab

Reformat everything with [black](https://github.com/python/black).
Describe what this patch does to fix the issue.

Fixes #3134 where flask fails if `static_url_path` ends with a slash, e.g. `/foo/`

Because the `/<path:filename>` param already starts with a slash, it is imperative the the `static_url_path` prefix does NOT end with a forward slash.
I use @login_required to check whether the user is authorized.But i save the cookie before i logout and then reassigned it in my browser.I can still be authorized.

I found that the content of the cookie is a password,which will contain "_id" and function "_session_protection_failed" in login_manager.py use "_id"  to check whether the user is authroized.I also found function verify_signature in singer.py use cookie and key to verify signature.

So in order to solve this problem.I change the key by use app.config["SECRET_KEY"] when logout.This method has no problem for my business at present.But i don't think it's a good idea.

Is that a question？and do i have any other good ways?


`g` has been stored on `AppContext` since AppContext's introduction in 0.9. We still have a property `g` attached on `RequestContext`. Is there any reason to keep it? Why not switch to `current_app.g`, or just the global `g`?

https://github.com/laggardkernel/flask/commit/a10005bb0d7668d81c64c02051366035ee421367

### Environment

* Python version: 3.8.7
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

I added multi-line imports because it is more pythonic and clean when you want to find some dependency.

Hi the Flask maintainers,

I added docs on deploying Flask on Qovery. We already have more than 100 developers deploying their Flask app on Qovery. - feedback is welcome.

Romaric.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Set `app.jinja_env.policies["json.dumps_function"]` to have Jinja's `|tojson` filter use Flask's `dumps` function, instead of overriding the filter.

Also have `htmlsafe_dumps` use `jinja2.utils.htmlsafe_json_dumps`. I debated deprecating Flask's implementation, especially since it's not documented as part of the public API. Figured it was still good enough to keep in for now, given that it's not entirely obvious that you would have to pass `dumps=flask.json.dumps` in order to get Flask's behavior.

closes #3881
* Werkzeug's `BaseRequest`, `BaseResponse`, and `JSONMixin` are no longer used. Everything was rolled into `Request` and `Response`.
* Werkzeug's `send_file` renamed `add_etags` to `etag`.
* No longer need the workarounds for Werkzeug versions that didn't support `BadRequestKeyError.show_exception` and `InternalServerError.original_exception`.
* Click detects that the program was called with `python -m flask`, Flask doesn't need its own detection.

Bumps [pre-commit](https://github.com/pre-commit/pre-commit) from 2.9.3 to 2.10.0.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/releases">pre-commit's releases</a>.</em></p>
<blockquote>
<h2>pre-commit v2.10.0</h2>
<h3>Features</h3>
<ul>
<li>Allow <code>ci</code> as a top-level map for configuration for <a href="https://pre-commit.ci">https://pre-commit.ci</a>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1735">#1735</a> PR by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
</ul>
</li>
<li>Add warning for mutable <code>rev</code> in configuration
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1715">#1715</a> PR by <a href="https://github.com/paulhfischer"><code>@paulhfischer</code></a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/974">#974</a> issue by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
</ul>
</li>
<li>Add warning for <code>/*</code> in top-level <code>files</code> / <code>exclude</code> regexes
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1750">#1750</a> PR by <a href="https://github.com/paulhfischer"><code>@paulhfischer</code></a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1702">#1702</a> issue by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
</ul>
</li>
<li>Expose <code>PRE_COMMIT_REMOTE_BRANCH</code> environment variable during <code>pre-push</code> hooks
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1770">#1770</a> PR by <a href="https://github.com/surafelabebe"><code>@surafelabebe</code></a>.</li>
</ul>
</li>
<li>Produce error message for <code>language</code> / <code>language_version</code> for non-installable languages
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1771">#1771</a> PR by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
</ul>
</li>
</ul>
<h3>Fixes</h3>
<ul>
<li>Fix execution in worktrees in subdirectories of bare repositories
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1778">#1778</a> PR by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1777">#1777</a> issue by <a href="https://github.com/s0undt3ch"><code>@s0undt3ch</code></a>.</li>
</ul>
</li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/blob/master/CHANGELOG.md">pre-commit's changelog</a>.</em></p>
<blockquote>
<h1>2.10.0 - 2021-01-27</h1>
<h3>Features</h3>
<ul>
<li>Allow <code>ci</code> as a top-level map for configuration for <a href="https://pre-commit.ci">https://pre-commit.ci</a>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1735">#1735</a> PR by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
</ul>
</li>
<li>Add warning for mutable <code>rev</code> in configuration
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1715">#1715</a> PR by <a href="https://github.com/paulhfischer"><code>@paulhfischer</code></a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/974">#974</a> issue by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
</ul>
</li>
<li>Add warning for <code>/*</code> in top-level <code>files</code> / <code>exclude</code> regexes
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1750">#1750</a> PR by <a href="https://github.com/paulhfischer"><code>@paulhfischer</code></a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1702">#1702</a> issue by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
</ul>
</li>
<li>Expose <code>PRE_COMMIT_REMOTE_BRANCH</code> environment variable during <code>pre-push</code>
hooks
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1770">#1770</a> PR by <a href="https://github.com/surafelabebe"><code>@surafelabebe</code></a>.</li>
</ul>
</li>
<li>Produce error message for <code>language</code> / <code>language_version</code> for non-installable
languages
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1771">#1771</a> PR by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
</ul>
</li>
</ul>
<h3>Fixes</h3>
<ul>
<li>Fix execution in worktrees in subdirectories of bare repositories
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1778">#1778</a> PR by <a href="https://github.com/asottile"><code>@asottile</code></a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1777">#1777</a> issue by <a href="https://github.com/s0undt3ch"><code>@s0undt3ch</code></a>.</li>
</ul>
</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pre-commit/pre-commit/commit/c67ba85311be53f4f0f830be22bc153524e07d03"><code>c67ba85</code></a> v2.10.0</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/588b6ed3fcb7e27dcc6c5cb40cdbe3c2e1315a7b"><code>588b6ed</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1778">#1778</a> from pre-commit/bare_worktree</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/f75fc6b2a85a61e50a0270d24a3589a083f1c06c"><code>f75fc6b</code></a> fix execution in worktrees in subdirectories of bare repositories</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/7727f8777aeedafb567da063fc911414b46a6a3b"><code>7727f87</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1773">#1773</a> from pre-commit/pre-commit-ci-update-config</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/d258650ad4a6b0c9845c82e8c74170df337ade41"><code>d258650</code></a> use comparison with sys.platform so mypy understands it</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/74183d91cbd24cac5dfd27dc0f737d40d665e0a8"><code>74183d9</code></a> [pre-commit.ci] pre-commit autoupdate</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/dbd69af90daba11e719e501c4d17ed710c13110d"><code>dbd69af</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1772">#1772</a> from pre-commit/caplog_moar</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/da369be096eba5d48ef5b1d2102872372cae0331"><code>da369be</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1771">#1771</a> from pre-commit/no_install_language_options</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/c7cbb1e6ad9fbb43d3124b20806322df9f3f59ff"><code>c7cbb1e</code></a> replace fake_log_handler with caplog</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/4f39946ea39007d357aa050126e8f877869ff719"><code>4f39946</code></a> produce a more useful error message when non-installable things use language_...</li>
<li>Additional commits viewable in <a href="https://github.com/pre-commit/pre-commit/compare/v2.9.3...v2.10.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pre-commit&package-manager=pip&previous-version=2.9.3&new-version=2.10.0)](https://dependabot.com/compatibility-score/?dependency-name=pre-commit&package-manager=pip&previous-version=2.9.3&new-version=2.10.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [greenlet](https://github.com/python-greenlet/greenlet) from 0.4.17 to 1.0.0.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/python-greenlet/greenlet/blob/master/CHANGES.rst">greenlet's changelog</a>.</em></p>
<blockquote>
<h1>1.0.0 (2021-01-13)</h1>
<ul>
<li>Fix %s and %r formatting of a greenlet on Python 2. Previously it would result in a Unicode string instead of a native string. See <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/218">issue 218</a>.</li>
<li>Move continuous integration from Travis CI to Github Actions.</li>
</ul>
<h1>1.0a1 (2020-11-20)</h1>
<ul>
<li>Add the ability to set a greenlet's PEP 567 contextvars context directly, by assigning to the greenlet's <code>gr_context</code> attribute. This restores support for some patterns of using greenlets atop an async environment that became more challenging in 0.4.17. Thanks to Joshua Oreman, Mike bayer, and Fantix King, among others. See <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/pull/198/">PR 198</a>.</li>
<li>The repr of greenlet objects now includes extra information about its state. This is purely informative and the details are subject to change. See <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/215">issue 215</a>.</li>
<li>The <code>greenlet</code> module is now a package. There are no API changes, so all existing imports, including from C code, should continue to work.</li>
<li>(C API) The undocumented <code>GREENLET_VERSION</code> macro that defined a string giving the greenlet version is now deprecated and will not be updated.</li>
<li>(Documentation) Publish the change log to <a href="https://greenlet.readthedocs.io">https://greenlet.readthedocs.io</a></li>
</ul>
<h2>Supported Platforms</h2>
<ul>
<li>Drop support for Python 2.4, 2.5, 2.6, 3.0, 3.1, 3.2 and 3.4. The project metadata now includes the <code>python_requires</code> data to help installation tools understand supported versions.</li>
<li>Add partial support for AIX ppc64 and IBM i. Thanks to Jesse Gorzinski and Kevin Adler. See <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/pull/197">PR 197</a>.</li>
</ul>
<h2>Packaging Changes</h2>
<ul>
<li>Require setuptools to build from source.</li>
<li>Stop asking setuptools to build both .tar.gz and .zip sdists. PyPI has standardized on .tar.gz for all platforms.</li>
<li>Stop using a custom distutils command to build extensions. distutils is deprecated.</li>
<li>Remove the ability to use the deprecated command <code>python setup.py test</code>. Run greenlet tests with your favorite unittest-compatible test runner, e.g., <code>python -m unittest discover greenlet.tests</code>. See <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/185">issue 185</a>.</li>
<li>The directory layout and resulting sdists have changed. See <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/184">issue 184</a>.</li>
<li>greenlet is now always built with support for tracing and garbage collection, and, on Python 3.7 and above, support for context variables. The internal and undocumented C preprocessor macros that could be used to alter that at compile time have been removed (no combination other than the defaults was ever tested). This helps define a stable ABI.</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/python-greenlet/greenlet/commit/c0e16261293cb401b643290adbb2d824c7200388"><code>c0e1626</code></a> Preparing release 1.0.0</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/951b2076acc757e93c16dbfd465292485b8f116d"><code>951b207</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/228">#228</a> from python-greenlet/github-actions</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/fa764abe680a0a0aee138a75dabfa4e147cc9ce2"><code>fa764ab</code></a> Move to GitHub actions and away from Travis.</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/28802e8e40e5b9aa3b29d5a4c2611d7bb5e0a6e3"><code>28802e8</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/226">#226</a> from guillaumep/patch-1</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/00dc6ebdaa8833d447590ea3b8717fbb4853ce15"><code>00dc6eb</code></a> Fix typo</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/cdd06239a69cd785c4f62c399689056ff806efaf"><code>cdd0623</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/221">#221</a> from skoslowski/patch-1</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/58a990acc27edbc972daa00c1a01d000b1acd7e1"><code>58a990a</code></a> Correct Context Vars PEP citation</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/f005b37e7ac32c617d279e4a692bba768d4ab358"><code>f005b37</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/219">#219</a> from python-greenlet/issue218</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/9ed87d556f2a67c66027dfcf2acde2c690c20e62"><code>9ed87d5</code></a> Use PyString_FromString in tp_repr on Py2.</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/d4bd91852f7062aa0bb92b58b37d4173712f4226"><code>d4bd918</code></a> Tweak CHANGES.rst [skip ci]</li>
<li>Additional commits viewable in <a href="https://github.com/python-greenlet/greenlet/compare/0.4.17...1.0.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=greenlet&package-manager=pip&previous-version=0.4.17&new-version=1.0.0)](https://dependabot.com/compatibility-score/?dependency-name=greenlet&package-manager=pip&previous-version=0.4.17&new-version=1.0.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [sphinx-tabs](https://github.com/executablebooks/sphinx-tabs) from 1.3.0 to 2.0.0.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/executablebooks/sphinx-tabs/releases">sphinx-tabs's releases</a>.</em></p>
<blockquote>
<h2>Version 2.0.0</h2>
<p>See <a href="https://github.com/executablebooks/sphinx-tabs/blob/master/CHANGELOG.md">CHANGELOG.md</a>.</p>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/executablebooks/sphinx-tabs/blob/master/CHANGELOG.md">sphinx-tabs's changelog</a>.</em></p>
<blockquote>
<h2>2.0.0 - 2021-01-24</h2>
<p>♻️ Refactor to reduce JS/CSS payload size and improve accesibility:</p>
<ul>
<li>Removed semantic-ui assets</li>
<li>Removed unused 'sphinx_tabs_nowarn' sphinx option</li>
<li>JS/CSS assets are now copied across by sphinx when builing, rather than being copied by the extension</li>
<li>Changed tab HTML to use tab roles</li>
<li>Changed tab label colour, to increase contrast with background</li>
<li>Added ARIA labels for tabs and panels</li>
<li>Added tabindex atributes to allow users to focus and switch tabs using a keyboard</li>
<li>Added a margin below images inside tab content</li>
</ul>
<p>✨ New features:</p>
<ul>
<li>Selecting an open tab now closes the tabs panel</li>
<li>The last selected group tab persists between pages (if the browser supports session storage)</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/0ce888aec473316fd8068f4940094a6ead63ab4b"><code>0ce888a</code></a> 🚀 RELEASE: v2.0.0 (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/98">#98</a>)</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/a0af17d2e9061008ce12f9c8857a5fbe71662adf"><code>a0af17d</code></a> ♻️ REFACTOR: Reduce JS/CSS size and improve accessibility (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/94">#94</a>)</li>
<li>See full diff in <a href="https://github.com/executablebooks/sphinx-tabs/compare/v1.3.0...v2.0.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=sphinx-tabs&package-manager=pip&previous-version=1.3.0&new-version=2.0.0)](https://dependabot.com/compatibility-score/?dependency-name=sphinx-tabs&package-manager=pip&previous-version=1.3.0&new-version=2.0.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [pytest](https://github.com/pytest-dev/pytest) from 6.2.1 to 6.2.2.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/releases">pytest's releases</a>.</em></p>
<blockquote>
<h2>6.2.2</h2>
<h1>pytest 6.2.2 (2021-01-25)</h1>
<h2>Bug Fixes</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8152">#8152</a>: Fixed &quot;(&lt;Skipped instance&gt;)&quot; being shown as a skip reason in the verbose test summary line when the reason is empty.</li>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8249">#8249</a>: Fix the <code>faulthandler</code> plugin for occasions when running with <code>twisted.logger</code> and using <code>pytest --capture=no</code>.</li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/blob/master/CHANGELOG.rst">pytest's changelog</a>.</em></p>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pytest-dev/pytest/commit/b9c98762f597f624be58d791ea7bdee6cd517967"><code>b9c9876</code></a> Prepare release version 6.2.2</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/8003fd23b910271866d140aa346d144df8c766d4"><code>8003fd2</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8259">#8259</a> from nicoddemus/backport-8250</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/8d605b9b266e412634a654f58a00855402328a89"><code>8d605b9</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8250">#8250</a> from daq-tools/fix-twisted-capture</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/14e0c3e1052b5f5d081d0c8545edfa0222b251a5"><code>14e0c3e</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8225">#8225</a> from The-Compiler/training-update (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8226">#8226</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/45facc16c8d2b11eaa068c8e3e826ff99dc1cfac"><code>45facc1</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8224">#8224</a> from nicoddemus/backport-8220</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/99fe887d7c3c697fdc2a0cef8262b33ba3b35499"><code>99fe887</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8220">#8220</a> from xuhdev/module-doc</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/8dbf9dc1aaa43e1e103a4d005c7fd9cf41212e6e"><code>8dbf9dc</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8167">#8167</a> from nicoddemus/backport-8166</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/baaee2148dcecf8dc5f80c82e28c200b5c19298c"><code>baaee21</code></a> Add Changelog to setup.cfg (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8166">#8166</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/f7d1ab870ffaeffbae457ba85034d9b101e8762f"><code>f7d1ab8</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8163">#8163</a> from bluetech/backport-8152</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/b8201c280e953eda793c5464e41c3622fbbe0379"><code>b8201c2</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8152">#8152</a> from bluetech/empty-skip</li>
<li>Additional commits viewable in <a href="https://github.com/pytest-dev/pytest/compare/6.2.1...6.2.2">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pytest&package-manager=pip&previous-version=6.2.1&new-version=6.2.2)](https://dependabot.com/compatibility-score/?dependency-name=pytest&package-manager=pip&previous-version=6.2.1&new-version=6.2.2)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [sphinx](https://github.com/sphinx-doc/sphinx) from 3.4.1 to 3.4.3.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/sphinx-doc/sphinx/blob/3.x/CHANGES">sphinx's changelog</a>.</em></p>
<blockquote>
<h1>Release 3.4.3 (released Jan 08, 2021)</h1>
<h2>Bugs fixed</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8655">#8655</a>: autodoc: Failed to generate document if target module contains an
object that raises an exception on <code>hasattr()</code></li>
</ul>
<h1>Release 3.4.2 (released Jan 04, 2021)</h1>
<h2>Bugs fixed</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8164">#8164</a>: autodoc: Classes that inherit mocked class are not documented</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8602">#8602</a>: autodoc: The <code>autodoc-process-docstring</code> event is emitted to the
non-datadescriptors unexpectedly</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8616">#8616</a>: autodoc: AttributeError is raised on non-class object is passed to
autoclass directive</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/55cdadf973b89b3181407c478075ac0fc6984b3d"><code>55cdadf</code></a> Bump to 3.4.3 final</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/ac12d8dabe925cf96c1b9e696f9fa0e42999edac"><code>ac12d8d</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8656">#8656</a> from tk0miya/8655_exception_on_hasattr</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/a51c8a565280529e25d1cad879349d7addc1414d"><code>a51c8a5</code></a> Fix <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8655">#8655</a>: autodoc: Crashes when object raises an exception on hasattr()</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/4755557a7df0a335b62c3f6bc062ce1c01c2d45a"><code>4755557</code></a> Bump version</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/83d5a323ef113294bb1c6e93f7752451668ed886"><code>83d5a32</code></a> Bump to 3.4.2 final</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/b59a48d4139801f46272530ca30fe321b1073564"><code>b59a48d</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8650">#8650</a> from tk0miya/update_release_checklist</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/b3f8bd1e3cff91753fa524ee8058b32608e33335"><code>b3f8bd1</code></a> doc: Quote URLs in release checklist</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/1346ddf3175c1a8e84db1be0d262a490f3b16df1"><code>1346ddf</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8635">#8635</a> from tk0miya/update_copyright</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/f9968594206e538f13fa1c27c065027f10d4ea27"><code>f996859</code></a> A happy new year!</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/5383846ced558d592795a162182cb37310ae9577"><code>5383846</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8622">#8622</a> from tk0miya/8616_AttributeError_for_non_class</li>
<li>Additional commits viewable in <a href="https://github.com/sphinx-doc/sphinx/compare/v3.4.1...v3.4.3">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=sphinx&package-manager=pip&previous-version=3.4.1&new-version=3.4.3)](https://dependabot.com/compatibility-score/?dependency-name=sphinx&package-manager=pip&previous-version=3.4.1&new-version=3.4.3)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [packaging](https://github.com/pypa/packaging) from 20.8 to 20.9.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pypa/packaging/releases">packaging's releases</a>.</em></p>
<blockquote>
<h2>Release 20.9</h2>
<ul>
<li>Run <a href="https://pypi.org/project/isort/">isort</a> over the code base (:issue:<code>377</code>)</li>
<li>Add support for the macosx_10_*_universal2 platform tags (:issue:<code>379</code>)</li>
<li>Introduce packaging.utils.parse_wheel_filename() and parse_sdist_filename() (:issue:<code>387</code> and :issue:<code>389</code>)</li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pypa/packaging/blob/main/CHANGELOG.rst">packaging's changelog</a>.</em></p>
<blockquote>
<h1>20.9 - 2021-01-29</h1>
<ul>
<li>Run <a href="https://pypi.org/project/isort/">isort</a> over the code base (377)</li>
<li>Add support for the <code>macosx_10_*_universal2</code> platform tags (379)</li>
<li>Introduce <code>packaging.utils.parse_wheel_filename()</code> and <code>parse_sdist_filename()</code> (387 and 389)</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pypa/packaging/commit/53fd698b1620aca027324001bf53c8ffda0c17d1"><code>53fd698</code></a> Bump for release</li>
<li><a href="https://github.com/pypa/packaging/commit/faf1be88a75b15c299bafb91abdc0aaab762c6f6"><code>faf1be8</code></a> Release from 'main', not 'master' (<a href="https://github-redirect.dependabot.com/pypa/packaging/issues/391">#391</a>)</li>
<li><a href="https://github.com/pypa/packaging/commit/9120541acf0c03d448308daa9f8d0e55e996f92d"><code>9120541</code></a> Change the return type for the build number portion of utils.parse_wheel_file...</li>
<li><a href="https://github.com/pypa/packaging/commit/da68002685b0a7d0027e189129d6bde35303a58b"><code>da68002</code></a> Add functions for parsing wheel and sdist filenames (<a href="https://github-redirect.dependabot.com/pypa/packaging/issues/387">#387</a>)</li>
<li><a href="https://github.com/pypa/packaging/commit/1b26f8455d8c886cbfd37839eafab3373d1809f2"><code>1b26f84</code></a> Support &quot;macosx_10_9_universal2&quot; wheels (<a href="https://github-redirect.dependabot.com/pypa/packaging/issues/380">#380</a>)</li>
<li><a href="https://github.com/pypa/packaging/commit/28d2fa0742747cda4bc4530b2a5bc919b7382039"><code>28d2fa0</code></a> Use isort (<a href="https://github-redirect.dependabot.com/pypa/packaging/issues/377">#377</a>)</li>
<li><a href="https://github.com/pypa/packaging/commit/353f270a4e49283c8e98ed8c801b457665774525"><code>353f270</code></a> Bump for development</li>
<li>See full diff in <a href="https://github.com/pypa/packaging/compare/20.8...20.9">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=packaging&package-manager=pip&previous-version=20.8&new-version=20.9)](https://dependabot.com/compatibility-score/?dependency-name=packaging&package-manager=pip&previous-version=20.8&new-version=20.9)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [jinja2](https://github.com/pallets/jinja) from 2.11.2 to 2.11.3.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pallets/jinja/releases">jinja2's releases</a>.</em></p>
<blockquote>
<h2>2.11.3</h2>
<p>This contains a fix for a speed issue with the <code>urlize</code> filter. <code>urlize</code> is likely to be called on untrusted user input. For certain inputs some of the regular expressions used to parse the text could take a very long time due to backtracking. As part of the fix, the email matching became slightly stricter. The various speedups apply to <code>urlize</code> in general, not just the specific input cases.</p>
<ul>
<li>PyPI: <a href="https://pypi.org/project/Jinja2/2.11.3/">https://pypi.org/project/Jinja2/2.11.3/</a></li>
<li>Changes: <a href="https://jinja.palletsprojects.com/en/2.11.x/changelog/#version-2-11-3">https://jinja.palletsprojects.com/en/2.11.x/changelog/#version-2-11-3</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pallets/jinja/blob/master/CHANGES.rst">jinja2's changelog</a>.</em></p>
<blockquote>
<h1>Version 2.11.3</h1>
<p>Released 2021-01-31</p>
<ul>
<li>Improve the speed of the <code>urlize</code> filter by reducing regex backtracking. Email matching requires a word character at the start of the domain part, and only word characters in the TLD. 1343</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pallets/jinja/commit/cf215390d4a4d6f0a4de27e2687eed176878f13d"><code>cf21539</code></a> release version 2.11.3</li>
<li><a href="https://github.com/pallets/jinja/commit/15ef8f09b659f9100610583938005a7a10472d4d"><code>15ef8f0</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pallets/jinja/issues/1343">#1343</a> from pallets/urlize-speedup</li>
<li><a href="https://github.com/pallets/jinja/commit/ef658dc3b6389b091d608e710a810ce8b87995b3"><code>ef658dc</code></a> speed up urlize matching</li>
<li><a href="https://github.com/pallets/jinja/commit/eeca0fecc3318d43f61bc340ad61db641b861ade"><code>eeca0fe</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pallets/jinja/issues/1207">#1207</a> from mhansen/patch-1</li>
<li><a href="https://github.com/pallets/jinja/commit/2dd769111cbb1a2637f805b3b4c652ec8096d371"><code>2dd7691</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pallets/jinja/issues/1209">#1209</a> from mhansen/patch-3</li>
<li><a href="https://github.com/pallets/jinja/commit/48929401db7228db04dfd8e88115dd5c30dc2d86"><code>4892940</code></a> do_dictsort: update example ready to copy/paste</li>
<li><a href="https://github.com/pallets/jinja/commit/7db7d336ba12574e6205fdd929386fd529e3fad4"><code>7db7d33</code></a> api.rst: bugfix in docs, import PackageLoader</li>
<li><a href="https://github.com/pallets/jinja/commit/9ec465baefe32e305bd4e61da49e6c39360c194e"><code>9ec465b</code></a> fix changelog header</li>
<li>See full diff in <a href="https://github.com/pallets/jinja/compare/2.11.2...2.11.3">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=jinja2&package-manager=pip&previous-version=2.11.2&new-version=2.11.3)](https://dependabot.com/compatibility-score/?dependency-name=jinja2&package-manager=pip&previous-version=2.11.2&new-version=2.11.3)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [tox](https://github.com/tox-dev/tox) from 3.20.1 to 3.21.3.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/tox-dev/tox/blob/master/docs/changelog.rst">tox's changelog</a>.</em></p>
<blockquote>
<h1>v3.21.3 (2021-01-28)</h1>
<h2>Bugfixes</h2>
<ul>
<li>Fix a killed tox (via SIGTERM) leaving the commands subprocesses running by handling it as if it were a KeyboardInterrupt - by dajose <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1772">#1772</a></li>
</ul>
<h1>v3.21.2 (2021-01-19)</h1>
<h2>Bugfixes</h2>
<ul>
<li>Newer coverage tools update the <code>COV_CORE_CONTEXT</code> environment variable, add it to the list of environment variables that can change in our pytest plugin - by gaborbernat. <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1854">#1854</a></li>
</ul>
<h1>v3.21.1 (2021-01-13)</h1>
<h2>Bugfixes</h2>
<ul>
<li>Fix regression that broke using install_command in config replacements - by jayvdb <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1777">#1777</a></li>
<li>Fix regression parsing posargs default containing colon. - by jayvdb <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1785">#1785</a></li>
</ul>
<h2>Features</h2>
<ul>
<li>Prevent .tox in envlist - by jayvdb <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1684">#1684</a></li>
</ul>
<h2>Miscellaneous</h2>
<ul>
<li>Enable building tox with <code>setuptools_scm</code> 4 and 5 by hroncok <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1799">#1799</a></li>
</ul>
<h1>v3.21.0 (2021-01-08)</h1>
<h2>Bugfixes</h2>
<ul>
<li>Fix the false <code>congratulations</code> message that appears when a <code>KeyboardInterrupt</code> occurs during package installation. - by gnikonorov <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1453">#1453</a></li>
<li>Fix <code>platform</code> support for <code>install_command</code>. - by jayvdb <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1464">#1464</a></li>
<li>Fixed regression in v3.20.0 that caused escaped curly braces in setenv to break usage of the variable elsewhere in tox.ini. - by jayvdb <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1690">#1690</a></li>
<li>Prevent <code>{}</code> and require <code>{:</code> is only followed by <code>}</code>. - by jayvdb <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1711">#1711</a></li>
<li>Raise <code>MissingSubstitution</code> on access of broken ini setting. - by jayvdb <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1716">#1716</a></li>
</ul>
<h2>Features</h2>
<!-- raw HTML omitted -->
</blockquote>
<p>... (truncated)</p>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/tox-dev/tox/commit/7dbed25b63a0892bbc9e743f96d118ab237d6d82"><code>7dbed25</code></a> release 3.21.3</li>
<li><a href="https://github.com/tox-dev/tox/commit/15533dd6b1b521174e7d210d1f03b2ec68508502"><code>15533dd</code></a> [pre-commit.ci] pre-commit autoupdate (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1872">#1872</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/8a2bb5642b2442ba4fbe97b7cf36550e38f47ada"><code>8a2bb56</code></a> Format markdown</li>
<li><a href="https://github.com/tox-dev/tox/commit/67258074ee5414a276a3b6c17613cb4ffba2b216"><code>6725807</code></a> tox use discord</li>
<li><a href="https://github.com/tox-dev/tox/commit/833b33f84c02ee7e142d4fad5fc00f1120a3c1e2"><code>833b33f</code></a> Handle sigterm by killing the commands subprocess (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1860">#1860</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/3d80588df8ba2e3a382b4345d2bf6cea44d3f901"><code>3d80588</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1858">#1858</a> from tox-dev/release-3.21.2</li>
<li><a href="https://github.com/tox-dev/tox/commit/4116e90d41e6f4ad024eff7d7a47c3e0442ddabe"><code>4116e90</code></a> release 3.21.2</li>
<li><a href="https://github.com/tox-dev/tox/commit/1d23293485930e28ef1f5e73c4512ebf8de5dc0d"><code>1d23293</code></a> Newer coverage plugin updates env-vars, ignore in pytest plugin (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1854">#1854</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/6624a8ce0b3aa8ebe96e4646314f2e8214bce522"><code>6624a8c</code></a> Add missing backticks to my username (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1851">#1851</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/51cd5fd618cfdc472171a5bfbe68222dbba9e697"><code>51cd5fd</code></a> Update README.md</li>
<li>Additional commits viewable in <a href="https://github.com/tox-dev/tox/compare/3.20.1...3.21.3">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=tox&package-manager=pip&previous-version=3.20.1&new-version=3.21.3)](https://dependabot.com/compatibility-score/?dependency-name=tox&package-manager=pip&previous-version=3.20.1&new-version=3.21.3)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>


run.py:
```
from flask import Flask
app = Flask(__name__, static_url_path='')
app.config['DEBUG'] = True
# Change this line as save, to reload
app.run()
```

**Run in app.py in Visual Studio Code debugger**

### Actual Behavior

<img width="638" alt="Screenshot 2021-01-31 at 14 10 40" src="https://user-images.githubusercontent.com/5372632/106384997-3cd5f600-63ce-11eb-9343-c98202073d55.png">


### Environment

* Python version: 3.8
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

`got_request_exception` documentation did not explain that the signal is only sent for unhandled exceptions, not `HTTPException` or other handled exceptions.

closes #3851

### Description

Hello fellow Flask(ers)! I'm not sure if this kind of issue belongs here, but please point me to the right place to post this if this is not the place to do so. I noticed a discrepancy between Blueprint routing source code and the [Flask pallets documentation](https://flask.palletsprojects.com/en/1.1.x/tutorial/views/) on it. If you follow this link, you'll see that the recommended way of setting up Blueprint and routing is as such:

```python
@bp.route('/register', methods=('GET', 'POST'))
def register():
    if request.method == 'POST':
    .....
```

However, if you actually do write your RESTful methods in a tuple as shown in the example, you'll encounter this error:

```python
TypeError: Allowed methods have to be iterables of strings, for example: @app.route(..., methods=["POST"])
```

I've gone through the [views.py source code](https://github.com/pallets/flask/blob/4e8b0204942d89c7956f4e1a20e97b1a16ba6800/src/flask/views.py) and see that there is an iteration through user inputted `methods`, which makes me wonder why this error occurs?

Much thanks for taking a look at this!

### Environment

* Python version: 3.9.0
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

### Expected Behavior
The `tojson` filter from Jinja2 will be used.

```jinja2
{{ some_object | tojson }}
```

### Actual Behavior
The Flask `tojson` filter overwrites the Jinja2 `tojson` filter. The Flask's filter is not as configurable as the Jinja2 one and when one configures the Jinja2 one and tries to use it in a template this behavior and silent override is hard to debug.

### Environment

* Python version: 3.9.1
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

### Suggested changes
Add a configuration option to choose between overriding the Jinja2 `tojson` filter or not. Make the default to override to keep current behavior. Will make a PR for this if it seems reasonable.

This is a documentation fix. 

There is no `jsonify_error` method in the codebase. The usage here is unclear. Not sure if it is legacy, the user should implement it themselves, it should be imported from another lib, or just a mistype. 

I figured the best fix was to use `jsonify`. This will return a `200` unless otherwise specified, so I also included the error code.

Hope this is helpful.

Hi,
                     i am creating the new routes by having  new entry in the backend table.  here new routes are assigned to blueprint .
the new routes are not reflecting instantly it requires restart the app to get the new blueprint route .

ping me the possibilities based on the requirements.


Thanks 


### Expected Behavior
In the Flask Testing docs: https://flask.palletsprojects.com/en/1.1.x/testing/#faking-resources-and-context

There is an example illustrating how to utilise the @contextmanager to set g early that appears to be misleading. The appcontext_pushed hook isn't correctly invoked following the example given.

In the usage section that uses the test_client, it appears app.app_context() gets the desired results.

Here is how I got it to work:

```python
@contextmanager
def user_set(state, _user):
    def handler(sender, **kwargs):
        g.user = _user

    with appcontext_pushed.connected_to(handler, state):
        yield

# yours is def user_set
with user_set(self.application, user):
    # use app_context() instead of test_client() context manager
    with app.app_context():
        client = app.test_client()
        # then make your request
        ...
```

### Environment

* Python version: 36
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

I have some obsessive-compulsive disorder😁,  I tried to add some comment ending characters.


I have some obsessive-compulsive disorder, I tried to add some comment ending characters.

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

## situation overview
I set up a file upload application and in case the user gives a too large file, I want to send a message that the file is too large. On my own PC, everything works fine, but in my corporate environment, flask doesn't return the message I want. 

## Example code
```python
 """app.py"""

from flask import Flask, request
from werkzeug.exceptions import RequestEntityTooLarge

app = Flask(__name__)
app.config['MAX_CONTENT_LENGTH'] = 1 * 1024 * 1024  # 1 MB


@app.route('/upload')
def upload():
    """Gives a form to upload the file."""

    return '''<!doctype html>
<body>Upload files
    <form method="POST" action="/submit_script" enctype="multipart/form-data">
        <input type="file" name="file" id="content" class="form-control-file">
        <input type="submit" value="Submit" class="form-control-file">
    </form>
</body>

</html>'''


@app.route('/submit_script', methods=['POST'])
def submit():
    """Saves the uploaded file and sends confirmation."""
    message = ""
    try:
        uploaded_file = request.files['file']
        uploaded_file.save(uploaded_file.filename)
    except RequestEntityTooLarge as my_exception:
        message = str(my_exception)
        print(message)    # this goes to the cmd line

    return "I could send a template with the result." + message 


@app.errorhandler(413)
def request_entity_too_large(error):
    """What happens if a file is too large."""

    return str(error) + " I could have sent a HTML template too.", 413

```
## Expected Behavior
I expect flask to return "I could send a template with the result." or without werkzeug, to `return str(error) + " I could have sent an HTML template too.", 413` But none of them happens.

## Actual Behavior

My browser gets an ERR_CONNECTION_ABORTED message.

This is what I get on the terminal:

```
(flask) C:\Users\uname\source\repos\flask_non_we>flask run
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
127.0.0.1 - - [21/Jan/2021 23:21:14] "GET / HTTP/1.1" 200 -
127.0.0.1 - - [21/Jan/2021 23:21:16] "GET /upload HTTP/1.1" 200 -
413 Request Entity Too Large: The data value transmitted exceeds the capacity limit.
127.0.0.1 - - [21/Jan/2021 23:21:23] "POST /submit_script HTTP/1.1" 200 -

(flask) C:\Users\uname\source\repos\flask_non_we>
```

### Environment
* Windows 10
* flask is running in cmd
* Python version: 3.8.5
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

Is there a way to redirect url in flask app and mask the url?


```
@app.route("/test")
def handle_ext_url():
    url = "https://www.google.com"
    return redirect(url)
```

I just want my addressbar to show localhost:8080/test but the page should show google.com.
If you have a `.env` file and are using Docker you don't need to install `python-dotenv`.

But every time you run any `flask` CLI command, Flask will output `* Tip: There are .env or .flaskenv files present. Do "pip install python-dotenv" to use them.` to stdout before any other output.

Perhaps this tip could be removed all together? IMO if you're using env files you likely already know to use `python-dotenv` and if you're using Docker you have access to your environment variables through other means.

### Expected Behavior

No tip output to be present.

### Actual Behavior

It produces this:

![image](https://user-images.githubusercontent.com/813219/104642743-51e62180-5679-11eb-8a2c-c82622461c0c.png)

### Environment

* Python version: 3.9.1
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

The current docs are at: https://flask.palletsprojects.com/en/1.1.x/patterns/celery/

They reference Celery's old configuration options which are the `CELERY_*` options. Since 5.x they've been renamed to be lowercase and there's an official migration guide available on Celery's site at https://docs.celeryproject.org/en/stable/userguide/configuration.html#conf-old-settings-map.

As of Celery 5.x, the old uppercase variants throw a deprecation warning and 6.x will remove them.

The current Flask docs for Celery reference things like:

```py
    celery = Celery(
        app.import_name,
        backend=app.config['CELERY_RESULT_BACKEND'],
        broker=app.config['CELERY_BROKER_URL']
    )
```

```py
flask_app.config.update(
    CELERY_BROKER_URL='redis://localhost:6379',
    CELERY_RESULT_BACKEND='redis://localhost:6379'
)
```

These imply you're using Flask's configuration mechanism which require uppercase variable names to be available, but that conflicts with Celery's new lowercase variables.

I talked with @ThiefMaster a few weeks ago about this on IRC and he came up with a great idea of doing:

```py
# settings.py

CELERY_CONFIG = {
  "broker_url": "redis://localhost:6379/0",
  "result_backend": "redis://localhost:6379/0"
}
```

And then in your Celery factory you can do `celery.conf.update(app.config.get("CELERY_CONFIG", {}))`.

This solves the problem and is working out nicely in practice. I'm doing that in a real project, along with extracting out the duplicate Redis connection string into an environment variable, etc.. A working example of that pattern is at https://github.com/nickjj/docker-flask-example/blob/ca1d48499a4007378bbe363bd5dc117c1a33cc3a/config/settings.py#L21-L28.

I didn't want to open a PR without asking first because I'm not sure which direction you want to go with the docs. To be honest the current docs are a little confusing because you jump straight into using Flask's app configuration values but there's no reference to setting up those config values.

Also with the current docs if you attempt to break things into separate files you'll end up with circular import issues when importing your tasks unless you start importing your tasks directly inside of the function you're using instead of the top of the file, but that's another issue. Although potentially semi-related if you plan to revamp the Celery docs.
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
Leading forward slashes (`/`) in path variable should be preserved when URI encoded

The value returned should be `Hello, World! - /path/to/file`.

```python
from flask import Flask
app = Flask(__name__)

@app.route('/<path:an_absolute_path>')
def hello_world(an_absolute_path):
    return "Hello, World! - %s" % an_absolute_path
```

### Actual Behavior
The value returned is `Hello, World! - path/to/file`.

```bash
> curl http://localhost:5000/%2Fpath%2Fto%2Ffile
Hello, World! - path/to/file
```

### Environment

* Python 3.6.12
* Flask 1.1.2
* Werkzeug 1.0.1
It seems  "Request" object has no attribute "is_xhr" ，Getting warnings here...  How do we fix this?
![6f2ab2c357e4a36213b6ad42b7d9669](https://user-images.githubusercontent.com/70581416/104300976-16751700-5502-11eb-9b61-51f3baa8d083.png)

Update the sample code at `views.rst`, update the methods sample.
I don't know if this change is necessary, I just thought that it will be better to keep the example as simple as possible, and make it OS-compatible (the `env` command not available on Windows CMD or Powershell). The new user will learn the details of how to run the application or how the application discovery works in the documentation.
### Expected Behavior
copy past commands and run it.
tried with:
- [quickstart](https://flask.palletsprojects.com/en/1.1.x/quickstart/) 
- [flask-sqlalchemy-quickstart](https://flask-sqlalchemy.palletsprojects.com/en/2.x/quickstart/)

### Environment
* OS version:
lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 20.04.1 LTS
Release:        20.04
Codename:       focal

* Python version:
$ python --version
Python 2.7.18

* Flask version:
$ flask --version
Python 3.8.5
Flask 1.1.2
Werkzeug 1.0.1

* Werkzeug version:
flask --version
$ flask --version
Python 3.8.5
Flask 1.1.2
Werkzeug 1.0.1
* Werkzeug version:
flask --version
...
Werkzeug 1.0.1

### Hint:
add to documentary: 
- reflect pip3 vs pip usage
- add `pip install -U Flask-SQLAlchemy` 

### explicit example problems:
https://stackoverflow.com/questions/65566823/flask-sqlalchemy-quickstart/65567007?noredirect=1#comment115927729_65567007
I've stumbled upon this bug while trying to bear Cython down with Flask.

Flask namely requires it's endpoint functions to have a `__dict__`, while Cython's def's are created as builtin_methods_or_functions which don't have a `__dict__`.

I've solved the problem in way mentioned [here](https://github.com/flasgger/flasgger/pull/451), but I still think it's a wrong design pattern to demand your endpoints to have a `__dict__`.
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->

```python
# Paste a minimal example that causes the problem.
```

### Actual Behavior
<!-- Tell us what happens instead. -->
[nginx+gunicorn+flask]
shut down accidentally without  an exception.when i check the recv-Q，i found the number is 129.Have you ever encountered this problem?



```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version: 3.7.3
* Flask version:1.1.2
* Werkzeug version:1.0.1

The loads function has the wrong 'kwargs' parameter description.
Fix pytest for #3858.
Bumps [packaging](https://github.com/pypa/packaging) from 20.4 to 20.8.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pypa/packaging/releases">packaging's releases</a>.</em></p>
<blockquote>
<h2>Release 20.8</h2>
<ul>
<li>Revert back to setuptools for compatibility purposes for some Linux distros (:issue:<code>363</code>)</li>
<li>Do not insert an underscore in wheel tags when the interpreter version number
is more than 2 digits (:issue:<code>372</code>)</li>
</ul>
<h2>20.7</h2>
<p>No release notes provided.</p>
<h2>20.6</h2>
<p>No release notes provided.</p>
<h2>20.5</h2>
<p>No release notes provided.</p>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pypa/packaging/blob/master/CHANGELOG.rst">packaging's changelog</a>.</em></p>
<blockquote>
<h1>20.8 - 2020-12-11</h1>
<ul>
<li>Revert back to setuptools for compatibility purposes for some Linux distros (363)</li>
<li>Do not insert an underscore in wheel tags when the interpreter version number is more than 2 digits (372)</li>
</ul>
<h1>20.7 - 2020-11-28</h1>
<p>No unreleased changes.</p>
<h1>20.6 - 2020-11-28</h1>
<!-- raw HTML omitted -->
<p>This release was subsequently yanked, and these changes were included in 20.7.</p>
<!-- raw HTML omitted -->
<ul>
<li>Fix flit configuration, to include LICENSE files (357)</li>
<li>Make intel a recognized CPU architecture for the universal macOS platform tag (361)</li>
<li>Add some missing type hints to packaging.requirements (issue:350)</li>
</ul>
<h1>20.5 - 2020-11-27</h1>
<ul>
<li>Officially support Python 3.9 (343)</li>
<li>Deprecate the <code>LegacyVersion</code> and <code>LegacySpecifier</code> classes (321)</li>
<li>Handle <code>OSError</code> on non-dynamic executables when attempting to resolve the glibc version string.</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pypa/packaging/commit/d93c6eea7d2caa637176426d255895bdf7db4f64"><code>d93c6ee</code></a> Bump for release</li>
<li><a href="https://github.com/pypa/packaging/commit/1534da56169d16a5f6b0ba90f748161c717dca9b"><code>1534da5</code></a> Update noxfile.py for going back to setuptools</li>
<li><a href="https://github.com/pypa/packaging/commit/b299c3ddb38c76e83e09ade2b719a4283a49b1c6"><code>b299c3d</code></a> Add a changelog entry for reverting underscores in wheel tags</li>
<li><a href="https://github.com/pypa/packaging/commit/611982be44d7d91453a97082f58d8ea349f89d00"><code>611982b</code></a> Don't put an underscore in the version portion of Python 3.10 compatibility t...</li>
<li><a href="https://github.com/pypa/packaging/commit/4b9b3f8edaf1feba2bc84ac12172f7d4af47e277"><code>4b9b3f8</code></a> Remove unused test fixture (<a href="https://github-redirect.dependabot.com/pypa/packaging/issues/373">#373</a>)</li>
<li><a href="https://github.com/pypa/packaging/commit/7e47a46880a594f17d1b110d388d22e5ead19fc4"><code>7e47a46</code></a> Fill in some missing changelog entries (<a href="https://github-redirect.dependabot.com/pypa/packaging/issues/370">#370</a>)</li>
<li><a href="https://github.com/pypa/packaging/commit/d1ade532a2bbea33fc0de981ab4d542006cf1066"><code>d1ade53</code></a> Changelog entry for going back to setuptools</li>
<li><a href="https://github.com/pypa/packaging/commit/14ad3520dc866295963c677c6813646b8a59a6a6"><code>14ad352</code></a> move back to setuptools (<a href="https://github-redirect.dependabot.com/pypa/packaging/issues/367">#367</a>)</li>
<li><a href="https://github.com/pypa/packaging/commit/a6407e3a7e19bd979e93f58cfc7f6641a7378c46"><code>a6407e3</code></a> Annotate the public interface (<a href="https://github-redirect.dependabot.com/pypa/packaging/issues/350">#350</a>)</li>
<li><a href="https://github.com/pypa/packaging/commit/fc86d7eeeeb68a224974c30e98d420560c75b0a4"><code>fc86d7e</code></a> Upload to git before uploading to PyPI (<a href="https://github-redirect.dependabot.com/pypa/packaging/issues/359">#359</a>)</li>
<li>Additional commits viewable in <a href="https://github.com/pypa/packaging/compare/20.4...20.8">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=packaging&package-manager=pip&previous-version=20.4&new-version=20.8)](https://dependabot.com/compatibility-score/?dependency-name=packaging&package-manager=pip&previous-version=20.4&new-version=20.8)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [pytest](https://github.com/pytest-dev/pytest) from 6.1.2 to 6.2.1.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/releases">pytest's releases</a>.</em></p>
<blockquote>
<h2>6.2.1</h2>
<h1>pytest 6.2.1 (2020-12-15)</h1>
<h2>Bug Fixes</h2>
<ul>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7678">#7678</a>: Fixed bug where <code>ImportPathMismatchError</code> would be raised for files compiled in
the host and loaded later from an UNC mounted path (Windows).</p>
</li>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8132">#8132</a>: Fixed regression in <code>approx</code>: in 6.2.0 <code>approx</code> no longer raises
<code>TypeError</code> when dealing with non-numeric types, falling back to normal comparison.
Before 6.2.0, array types like tf.DeviceArray fell through to the scalar case,
and happened to compare correctly to a scalar if they had only one element.
After 6.2.0, these types began failing, because they inherited neither from
standard Python number hierarchy nor from <code>numpy.ndarray</code>.</p>
<p><code>approx</code> now converts arguments to <code>numpy.ndarray</code> if they expose the array
protocol and are not scalars. This treats array-like objects like numpy arrays,
regardless of size.</p>
</li>
</ul>
<h2>6.2.0</h2>
<h1>pytest 6.2.0 (2020-12-12)</h1>
<h2>Breaking Changes</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7808">#7808</a>: pytest now supports python3.6+ only.</li>
</ul>
<h2>Deprecations</h2>
<ul>
<li>
<p><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7469">#7469</a>: Directly constructing/calling the following classes/functions is now deprecated:</p>
<ul>
<li><code>_pytest.cacheprovider.Cache</code></li>
<li><code>_pytest.cacheprovider.Cache.for_config()</code></li>
<li><code>_pytest.cacheprovider.Cache.clear_cache()</code></li>
<li><code>_pytest.cacheprovider.Cache.cache_dir_from_config()</code></li>
<li><code>_pytest.capture.CaptureFixture</code></li>
<li><code>_pytest.fixtures.FixtureRequest</code></li>
<li><code>_pytest.fixtures.SubRequest</code></li>
<li><code>_pytest.logging.LogCaptureFixture</code></li>
<li><code>_pytest.pytester.Pytester</code></li>
<li><code>_pytest.pytester.Testdir</code></li>
<li><code>_pytest.recwarn.WarningsRecorder</code></li>
<li><code>_pytest.recwarn.WarningsChecker</code></li>
<li><code>_pytest.tmpdir.TempPathFactory</code></li>
<li><code>_pytest.tmpdir.TempdirFactory</code></li>
</ul>
<p>These have always been considered private, but now issue a deprecation warning, which may become a hard error in pytest 7.0.0.</p>
</li>
</ul>
<!-- raw HTML omitted -->
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/blob/master/CHANGELOG.rst">pytest's changelog</a>.</em></p>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pytest-dev/pytest/commit/d3971c30f4d0f1890a372af3b98de41ee555dcb3"><code>d3971c3</code></a> Prepare release version 6.2.1</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/780044b64a79eb99eb08d86a08d5cf7fa8b047ba"><code>780044b</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8147">#8147</a> from nicoddemus/backport-8137</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/8354995abc4c4f913a8266fb53b7d2a4e93e4050"><code>8354995</code></a> python_api: handle array-like args in approx() (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8137">#8137</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/8b8b1214f4834419a5f45758d6cdc4eddba01359"><code>8b8b121</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8135">#8135</a> from nicoddemus/backport-8123</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/f854cf66f4ad866d27f85e6fcc3b476a835ca3e7"><code>f854cf6</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8123">#8123</a> from nicoddemus/import-mismatch-unc</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/c475106f12ed87fe908544ff383c5205638c086d"><code>c475106</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8130">#8130</a> from pytest-dev/release-6.2.0</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/e7073afe6e2373175130511135020af8b4e3a670"><code>e7073af</code></a> Prepare release version 6.2.0</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/683f29f84df61e9dab92970a57190d20ca58385e"><code>683f29f</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8129">#8129</a> from bluetech/docs-pygments-workaround</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/0feeddf8edb87052402fafe690d019e3eb75dfa4"><code>0feeddf</code></a> doc: temporary workaround for pytest-pygments lexing error</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/b4782757772373a2ea00802606407e9399b98031"><code>b478275</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/8128">#8128</a> from bluetech/skip-reason-empty</li>
<li>Additional commits viewable in <a href="https://github.com/pytest-dev/pytest/compare/6.1.2...6.2.1">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pytest&package-manager=pip&previous-version=6.1.2&new-version=6.2.1)](https://dependabot.com/compatibility-score/?dependency-name=pytest&package-manager=pip&previous-version=6.1.2&new-version=6.2.1)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [pip-tools](https://github.com/jazzband/pip-tools) from 5.3.1 to 5.5.0.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/jazzband/pip-tools/releases">pip-tools's releases</a>.</em></p>
<blockquote>
<h2>5.5.0</h2>
<p>Features:</p>
<ul>
<li>Add Python 3.9 support (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1222">1222</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
<li>Improve formatting of long &quot;via&quot; annotations (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1237">1237</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
<li>Add <code>--verbose</code> and <code>--quiet</code> options to <code>pip-sync</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1241">1241</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
<li>Add <code>--no-allow-unsafe</code> option to <code>pip-compile</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1265">1265</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
</ul>
<p>Bug Fixes:</p>
<ul>
<li>Restore <code>PIP_EXISTS_ACTION</code> environment variable to its previous state when resolve dependencies in <code>pip-compile</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1255">1255</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
</ul>
<p>Dependencies:</p>
<ul>
<li>Remove <code>six</code> dependency in favor <code>pip</code>'s vendored <code>six</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1240">1240</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
</ul>
<p>Improved Documentation:</p>
<ul>
<li>Add <code>pip-requirements.el</code> (for Emacs) to useful tools to <code>README</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1244">#1244</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
<li>Add supported Python versions to <code>README</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1246">#1246</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
</ul>
<h2>5.4.0</h2>
<p>Features:</p>
<ul>
<li>Add <code>pip&gt;=20.3</code> support (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1216">1216</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a> and <a href="https://github.com/AndydeCleyre">@AndydeCleyre</a></li>
<li>Exclude <code>--no-reuse-hashes</code> option from «command to run» header (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1197">1197</a>). Thanks <a href="https://github.com/graingert">@graingert</a></li>
</ul>
<p>Dependencies:</p>
<ul>
<li>Bump <code>pip</code> minimum version to <code>&gt;= 20.1</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1191">1191</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a> and <a href="https://github.com/AndydeCleyre">@AndydeCleyre</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/jazzband/pip-tools/blob/master/CHANGELOG.md">pip-tools's changelog</a>.</em></p>
<blockquote>
<h1>5.5.0 (2020-12-31)</h1>
<p>Features:</p>
<ul>
<li>Add Python 3.9 support
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1222">1222</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
<li>Improve formatting of long &quot;via&quot; annotations
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1237">1237</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
<li>Add <code>--verbose</code> and <code>--quiet</code> options to <code>pip-sync</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1241">1241</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
<li>Add <code>--no-allow-unsafe</code> option to <code>pip-compile</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1265">1265</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
</ul>
<p>Bug Fixes:</p>
<ul>
<li>Restore <code>PIP_EXISTS_ACTION</code> environment variable to its previous state
when resolve dependencies in <code>pip-compile</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1255">1255</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
</ul>
<p>Dependencies:</p>
<ul>
<li>Remove <code>six</code> dependency in favor <code>pip</code>'s vendored <code>six</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1240">1240</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
</ul>
<p>Improved Documentation:</p>
<ul>
<li>Add <code>pip-requirements.el</code> (for Emacs) to useful tools to <code>README</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1244">#1244</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
<li>Add supported Python versions to <code>README</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1246">#1246</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
</ul>
<h1>5.4.0 (2020-11-21)</h1>
<p>Features:</p>
<ul>
<li>Add <code>pip&gt;=20.3</code> support
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1216">1216</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a> and <a href="https://github.com/AndydeCleyre">@AndydeCleyre</a></li>
<li>Exclude <code>--no-reuse-hashes</code> option from «command to run» header
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1197">1197</a>). Thanks <a href="https://github.com/graingert">@graingert</a></li>
</ul>
<p>Dependencies:</p>
<ul>
<li>Bump <code>pip</code> minimum version to <code>&gt;= 20.1</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1191">1191</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a> and <a href="https://github.com/AndydeCleyre">@AndydeCleyre</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/jazzband/pip-tools/commit/25492a23343e1499c73f9c275a6dab4d14b86486"><code>25492a2</code></a> 5.5.0 changelog</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/4ac1490234e753d23cec231bc3f79148b8cac641"><code>4ac1490</code></a> Add --no-allow-unsafe option to compile (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1265">#1265</a>)</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/bc9695c604314e62f6379b50f003dbe0f9878c9d"><code>bc9695c</code></a> Update pre-commit hooks</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/7ab3a565fa9261258f6a37b05ba6b31670bd9d0d"><code>7ab3a56</code></a> Update isort URL in .pre-commit-config.yaml</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/677046626609e888f28b3ec363931edaed4ceea0"><code>6770466</code></a> Add coverage for &quot;if not is_pinned_requirement(…)&quot; in get_hashes()</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/e76ab99d17944963273f31e18b93c5771c12acd8"><code>e76ab99</code></a> Remove unnecessary system calls via os.path.exists()/os.path.isdir()</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/a313398ce21eeabca47ddc67cd19353a3e2116f9"><code>a313398</code></a> Fix typo: unnecessarely → unnecessarily</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/e0b555286e875280f11639d265f6e09893114712"><code>e0b5552</code></a> Remove unnecessary coerce to str</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/30a33cd600d0e96542429683704f3effec945240"><code>30a33cd</code></a> Simplify uses of InstallRequirement</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/d2007dab6b0cd0c33860fcbf14da793fe34705da"><code>d2007da</code></a> Use more descriptive exceptions than AssertionError</li>
<li>Additional commits viewable in <a href="https://github.com/jazzband/pip-tools/compare/5.3.1...5.5.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pip-tools&package-manager=pip&previous-version=5.3.1&new-version=5.5.0)](https://dependabot.com/compatibility-score/?dependency-name=pip-tools&package-manager=pip&previous-version=5.3.1&new-version=5.5.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [pre-commit](https://github.com/pre-commit/pre-commit) from 2.8.2 to 2.9.3.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/releases">pre-commit's releases</a>.</em></p>
<blockquote>
<h2>pre-commit v2.9.3</h2>
<h3>Fixes</h3>
<ul>
<li>Fix crash on cygwin mismatch check outside of a git directory
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1721">#1721</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1720">#1720</a> issue by <a href="https://github.com/chronoB">@chronoB</a>.</li>
</ul>
</li>
<li>Fix cleanup code on docker volumes for go
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1725">#1725</a> PR by <a href="https://github.com/fsouza">@fsouza</a>.</li>
</ul>
</li>
<li>Fix working directory detection on SUBST drives on windows
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1727">#1727</a> PR by <a href="https://github.com/mrogaski">@mrogaski</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1610">#1610</a> issue by <a href="https://github.com/jcameron73">@jcameron73</a>.</li>
</ul>
</li>
</ul>
<h2>pre-commit v2.9.2</h2>
<h3>Fixes</h3>
<ul>
<li>Fix default value for <code>types_or</code> so <code>symlink</code> and <code>directory</code> can be matched
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1716">#1716</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1718">#1718</a> issue by <a href="https://github.com/CodeBleu">@CodeBleu</a>.</li>
</ul>
</li>
</ul>
<h2>pre-commit v2.9.1</h2>
<h3>Fixes</h3>
<ul>
<li>Improve error message for &quot;hook goes missing&quot;
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1709">#1709</a> PR by <a href="https://github.com/paulhfischer">@paulhfischer</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1708">#1708</a> issue by <a href="https://github.com/theod07">@theod07</a>.</li>
</ul>
</li>
<li>Add warning for <code>/*</code> in <code>files</code> / <code>exclude</code> regexes
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1707">#1707</a> PR by <a href="https://github.com/paulhfischer">@paulhfischer</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1702">#1702</a> issue by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Fix <code>healthy()</code> check for <code>language: python</code> on windows when the base executable has non-ascii characters.
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1713">#1713</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1711">#1711</a> issue by <a href="https://github.com/Najiva">@Najiva</a>.</li>
</ul>
</li>
</ul>
<h2>pre-commit v2.9.0</h2>
<h3>Features</h3>
<ul>
<li>Add <code>types_or</code> which allows matching multiple disparate <code>types</code> in a hook
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1677">#1677</a> by <a href="https://github.com/MarcoGorelli">@MarcoGorelli</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/607">#607</a> by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Add Github Sponsors / Open Collective links
<ul>
<li><a href="https://github.com/sponsors/asottile">https://github.com/sponsors/asottile</a></li>
<li><a href="https://opencollective.com/pre-commit">https://opencollective.com/pre-commit</a></li>
</ul>
</li>
</ul>
<h3>Fixes</h3>
<ul>
<li>Improve cleanup for <code>language: dotnet</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1678">#1678</a> by <a href="https://github.com/rkm">@rkm</a>.</li>
</ul>
</li>
<li>Fix &quot;xargs&quot; when running windows batch files
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1686">#1686</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1604">#1604</a> issue by <a href="https://github.com/apietrzak">@apietrzak</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1604">#1604</a> issue by <a href="https://github.com/ufwtlsb">@ufwtlsb</a>.</li>
</ul>
</li>
<li>Fix conflict with external <code>rbenv</code> and <code>language_version: default</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1700">#1700</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1699">#1699</a> issue by <a href="https://github.com/abuxton">@abuxton</a>.</li>
</ul>
</li>
<li>Improve performance of <code>git status</code> / <code>git diff</code> commands by ignoring submodules
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1704">#1704</a> PR by <a href="https://github.com/Vynce">@Vynce</a>.</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/blob/master/CHANGELOG.md">pre-commit's changelog</a>.</em></p>
<blockquote>
<h1>2.9.3 - 2020-12-07</h1>
<h3>Fixes</h3>
<ul>
<li>Fix crash on cygwin mismatch check outside of a git directory
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1721">#1721</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1720">#1720</a> issue by <a href="https://github.com/chronoB">@chronoB</a>.</li>
</ul>
</li>
<li>Fix cleanup code on docker volumes for go
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1725">#1725</a> PR by <a href="https://github.com/fsouza">@fsouza</a>.</li>
</ul>
</li>
<li>Fix working directory detection on SUBST drives on windows
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1727">#1727</a> PR by <a href="https://github.com/mrogaski">@mrogaski</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1610">#1610</a> issue by <a href="https://github.com/jcameron73">@jcameron73</a>.</li>
</ul>
</li>
</ul>
<h1>2.9.2 - 2020-11-25</h1>
<h3>Fixes</h3>
<ul>
<li>Fix default value for <code>types_or</code> so <code>symlink</code> and <code>directory</code> can be matched
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1716">#1716</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1718">#1718</a> issue by <a href="https://github.com/CodeBleu">@CodeBleu</a>.</li>
</ul>
</li>
</ul>
<h1>2.9.1 - 2020-11-25</h1>
<h3>Fixes</h3>
<ul>
<li>Improve error message for &quot;hook goes missing&quot;
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1709">#1709</a> PR by <a href="https://github.com/paulhfischer">@paulhfischer</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1708">#1708</a> issue by <a href="https://github.com/theod07">@theod07</a>.</li>
</ul>
</li>
<li>Add warning for <code>/*</code> in <code>files</code> / <code>exclude</code> regexes
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1707">#1707</a> PR by <a href="https://github.com/paulhfischer">@paulhfischer</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1702">#1702</a> issue by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Fix <code>healthy()</code> check for <code>language: python</code> on windows when the base
executable has non-ascii characters.
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1713">#1713</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1711">#1711</a> issue by <a href="https://github.com/Najiva">@Najiva</a>.</li>
</ul>
</li>
</ul>
<h1>2.9.0 - 2020-11-21</h1>
<h3>Features</h3>
<ul>
<li>Add <code>types_or</code> which allows matching multiple disparate <code>types</code> in a hook
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1677">#1677</a> by <a href="https://github.com/MarcoGorelli">@MarcoGorelli</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/607">#607</a> by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Add Github Sponsors / Open Collective links
<ul>
<li><a href="https://github.com/sponsors/asottile">https://github.com/sponsors/asottile</a></li>
<li><a href="https://opencollective.com/pre-commit">https://opencollective.com/pre-commit</a></li>
</ul>
</li>
</ul>
<h3>Fixes</h3>
<ul>
<li>Improve cleanup for <code>language: dotnet</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1678">#1678</a> by <a href="https://github.com/rkm">@rkm</a>.</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pre-commit/pre-commit/commit/a062cbd439861a8f05b58b9454ba04695de8cda3"><code>a062cbd</code></a> v2.9.3</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/eacf4c886e8afc51d43ef8fc62ee525bc06a38c8"><code>eacf4c8</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1727">#1727</a> from mrogaski/1610_git_toplevel_relpath</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/29d15de38ee0f78f598e8888fd3d6e8789a63bef"><code>29d15de</code></a> git: changed rev-parse option for Git 2.25 changes to --show-toplevel</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/cf604f6b93b8fb7a61ab9ca45e5dedbdb4fd5796"><code>cf604f6</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1725">#1725</a> from fsouza/fix-rmtree</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/c598785b6f7be0fb9371eb54e48fd09668210a96"><code>c598785</code></a> util: use set instead of tuple in errno check</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/bb0d9573a9a87616b65ee4c1cedccb18406d5982"><code>bb0d957</code></a> util: also run chmod on EPERM</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/92ce2dcbc375831bab244507e8072a834b761946"><code>92ce2dc</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1721">#1721</a> from pre-commit/dont_crash_on_cygwin_check</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/8cfe8e590d9568ff8fb9d5deb0c46776ee966162"><code>8cfe8e5</code></a> don't crash on cygwin mismatch check</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/6c6294571afef28e7229520c2beecc41400af60a"><code>6c62945</code></a> Add link to issue by CodeBleu</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/a82a79bf3f2c147fb819f5e14b4883c143568ab6"><code>a82a79b</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1717">#1717</a> from pre-commit/fix_test</li>
<li>Additional commits viewable in <a href="https://github.com/pre-commit/pre-commit/compare/v2.8.2...v2.9.3">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pre-commit&package-manager=pip&previous-version=2.8.2&new-version=2.9.3)](https://dependabot.com/compatibility-score/?dependency-name=pre-commit&package-manager=pip&previous-version=2.8.2&new-version=2.9.3)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [sphinx](https://github.com/sphinx-doc/sphinx) from 3.2.1 to 3.4.1.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/sphinx-doc/sphinx/blob/3.x/CHANGES">sphinx's changelog</a>.</em></p>
<blockquote>
<h1>Release 3.4.1 (released Dec 25, 2020)</h1>
<h2>Bugs fixed</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8559">#8559</a>: autodoc: AttributeError is raised when using forward-reference type
annotations</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8568">#8568</a>: autodoc: TypeError is raised on checking slots attribute</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8567">#8567</a>: autodoc: Instance attributes are incorrectly added to Parent class</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8566">#8566</a>: autodoc: The <code>autodoc-process-docstring</code> event is emitted to the
alias classes unexpectedly</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8583">#8583</a>: autodoc: Unnecessary object comparision via <code>__eq__</code> method</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8565">#8565</a>: linkcheck: Fix PriorityQueue crash when link tuples are not
comparable</li>
</ul>
<h1>Release 3.4.0 (released Dec 20, 2020)</h1>
<h2>Incompatible changes</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8105">#8105</a>: autodoc: the signature of class constructor will be shown for decorated
classes, not a signature of decorator</li>
</ul>
<h2>Deprecated</h2>
<ul>
<li>The <code>follow_wrapped</code> argument of <code>sphinx.util.inspect.signature()</code></li>
<li>The <code>no_docstring</code> argument of
<code>sphinx.ext.autodoc.Documenter.add_content()</code></li>
<li><code>sphinx.ext.autodoc.Documenter.get_object_members()</code></li>
<li><code>sphinx.ext.autodoc.DataDeclarationDocumenter</code></li>
<li><code>sphinx.ext.autodoc.GenericAliasDocumenter</code></li>
<li><code>sphinx.ext.autodoc.InstanceAttributeDocumenter</code></li>
<li><code>sphinx.ext.autodoc.SlotsAttributeDocumenter</code></li>
<li><code>sphinx.ext.autodoc.TypeVarDocumenter</code></li>
<li><code>sphinx.ext.autodoc.importer._getannotations()</code></li>
<li><code>sphinx.ext.autodoc.importer._getmro()</code></li>
<li><code>sphinx.pycode.ModuleAnalyzer.parse()</code></li>
<li><code>sphinx.util.osutil.movefile()</code></li>
<li><code>sphinx.util.requests.is_ssl_error()</code></li>
</ul>
<h2>Features added</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8119">#8119</a>: autodoc: Allow to determine whether a member not included in
<code>__all__</code> attribute of the module should be documented or not via
:event:<code>autodoc-skip-member</code> event</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8219">#8219</a>: autodoc: Parameters for generic class are not shown when super class is</li>
</ul>
<!-- raw HTML omitted -->
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/f5406b918791d9504ca6638330d89dbd86ebcb93"><code>f5406b9</code></a> Bump to 3.4.1 final</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/b94752a293c37d61ee89bc4a9f3e5b937fde525d"><code>b94752a</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8585">#8585</a> from tk0miya/8583_unnecessary_eq</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/5c39d0c0688d011a26b806f9bcc90d194ad292f0"><code>5c39d0c</code></a> Fix <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8583">#8583</a>: autodoc: Unnecessary object comparision via <code>__eq__</code> method</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/043260481b59c922fea042a1e9bbc4ff32fa1069"><code>0432604</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8581">#8581</a> from tk0miya/8566_autodoc_process_docstring_for_alia...</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/df8ab215c0c30da1de6ddadfef957b447510778a"><code>df8ab21</code></a> Fix <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8566">#8566</a>: autodoc-process-docstring is emitted to the alias classes</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/46eaa5db8005492ae2ff28208f95b9ea8dab62b5"><code>46eaa5d</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8579">#8579</a> from francoisfreitag/fix-queue</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/a1b8b1febb6ce0b7423bb78df30b0fc424c12325"><code>a1b8b1f</code></a> Ensure linkcheck items are comparable</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/955d6558ec155dffaef999d890c2cdb224cbfbb9"><code>955d655</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8571">#8571</a> from tk0miya/8567_wrong_ivars_in_parent_class</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/70bb2262d6677e5bcf2c85786b5f410a3a0f68aa"><code>70bb226</code></a> Fix <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8567">#8567</a>: autodoc: Instance attributes are incorrectly added to Parent class</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/31cad2ebe7a205154e1374bfa52338111e515719"><code>31cad2e</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/8570">#8570</a> from tk0miya/8569_getslots_TypeError</li>
<li>Additional commits viewable in <a href="https://github.com/sphinx-doc/sphinx/compare/v3.2.1...v3.4.1">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=sphinx&package-manager=pip&previous-version=3.2.1&new-version=3.4.1)](https://dependabot.com/compatibility-score/?dependency-name=sphinx&package-manager=pip&previous-version=3.2.1&new-version=3.4.1)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>

### Expected Behavior

a simple post api

```
@app.route('/video', methods=['GET', 'POST'])
def upload_image():
    if request.method == 'POST':   
        print(request.form)
        print(request.files)
        ....
    else:
        return 'failed, not post', 400
```

use requests
```
import requests

url = 'http://127.0.0.1:5000/video'
name_v = 'CVN.mp4'
files = {'file': open(name_v, 'rb')}
r = requests.post(url, files=files)
```
  is ok

_ImmutableMultiDict([])
ImmutableMultiDict([('file', <FileStorage: 'CVN.mp4' (None)>)])_

but use postman [postman app](https://www.postman.com/downloads/)
with  Body binarty  (a mp4 file)

 to test post api 

post a jpg is ok,  but when post .mp4 file, 
postman auto set header
Content-Type          video/mp4

both request.form, request.files is empty

_ImmutableMultiDict([])
ImmutableMultiDict([])_


### Environment

* Python version:  3.8.5  x64 anaconda3 
* Flask version:    1.1.2
* Werkzeug version: 1.0.1

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
Flask session cookie secure flag is not getting set. 
One chrome developer tools, i see in the cookie sesction. the cookie name "session" is not have secure colum checked.

```python
app.config.update(
    SESSION_COOKIE_SECURE=True, - -> This one
    DEBUG=True,
    REMEMBER_COOKIE_SECURE=True,
)

```

### Actual Behavior
<!-- Tell us what happens instead. -->

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version: 3.6
* Flask version: 1.x
* Werkzeug version:

Raising a `HTTPException` (for example by calling `abort()`) does not cause registered signal handlers for `got_request_exception` to be called.
https://flask.palletsprojects.com/en/1.1.x/api/#flask.got_request_exception does not state that some Exceptions
are forwarded to the handler and some are not.
Changing this behaviour could potentially break quite a few application, but at least the signal documentation should include this behaviour.

### Expected Behavior
raising a HTTPException in a view function should cause the signal handler to be called.

```python
from flask import Flask, got_request_exception, abort
app = Flask(__name__)

def signal_handler(sender, exception, **extra):
    print("handled %s" % str(type(exception)))

got_request_exception.connect(signal_handler)

@app.route('/1')
def view_1():
    # calling this view prints "handled <class 'RuntimeError'>" to the console
    raise RuntimeError()

@app.route('/2')
def view_2():
    # calling this view prints nothing
    abort(400)
    # raise werkzeug.exception.TooManyRequests
    # e.g. also does nothing
```

### Actual Behavior
the signal handler is not called

### Environment

* Python version: 3.8.6 (also tested with 3.7)
* Flask version: 1.1.2
* Werkzeug version: 1.0.1
Hi there!

My name is Leo, a CS student at Brown building an automated platform for editable codebase documentation.

I generated documentation for this repository and placed a link in the README. Please feel free to try it out and let me know what you think!

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->


After cloning and installing the master branch I was trying to use flask.send_from_directory which is a wrapper to a call to
werkzeug.utils.send_from_directory which incidentally does not exist on a release version of werkzeug.

After following CONTRIBUTING.rst to install flask master in a clean virtualenv and running pytest. Many tests fail, I quickly realized that the version of werkzeug installed is not compatible with flask HEAD. 
```pytb
# Paste a minimal example that causes the problem.
(flask-test) $ pip install -e . -r requirements/dev.txt
(flask-test) $ pytest
...
FAILED tests/test_views.py::test_remove_method_from_parent - TypeError: argument of type 'BaseRequest' is not iterable
====================================== 215 failed, 233 passed, 3 xpassed in 8.90s ======================================
```

After making the following change (sourcing the master branch of werkzeug from github in setup.py),

```
diff --git a/setup.py b/setup.py
index 6218be60..61bb4d4e 100644
--- a/setup.py
+++ b/setup.py
@@ -10,7 +10,7 @@ setup(
     name="Flask",
     version=version,
     install_requires=[
-        "Werkzeug>=0.15",
+        "werkzeug @git+git://github.com/pallets/werkzeug@master#egg=werkzeug",
         "Jinja2>=2.10.1",
         "itsdangerous>=0.24",
         "click>=5.1",
```
```
(flask-test) $ pip uninstall werkzeug
(flask-test) $ pip install -e . -r requirements/dev.txt
(flask-test) $ pytest
================================================= test session starts ==================================================
platform linux -- Python 3.8.5, pytest-6.1.2, py-1.9.0, pluggy-0.13.1
...
============================================ 448 passed, 3 xpassed in 1.92s ============================================
```

I didn't submit a PR because I'm not sure if this is the right way to fix this for building master, I think the real fix is publishing a new release of werkzeug so we can use a version number. 
A small self-explanatory documentation change.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->
- This bug occurs in Flask API server to  image download. I search this error at Google. I find same issue at this repo. it is here.

> https://github.com/boto/botocore/issues/1413

- This issue is specific time. this error occur in Flask API server run after about 1hours. I don't know this issue. Help me please.

- My code is it.
```python

@app.route('/inspection', methods=['GET', 'POST'])
def image_inspection():
    if request.method == "GET":
        check_srl = request.args.get('assetCheckSrl')
        origin_url = request.args.get('origin').replace('"','')
        inspection_url = request.args.get('inspection').replace('"','')
        origin_path = origin_url.split('com/')[1]
        inspection_path = inspection_url.split('com/')[1]

        print("check_srl :" , check_srl)
        print("origin_url :" , origin_url) # https://XXXX.s3.ap-northeast-2.amazonaws.com/XXXX/asset/init/1110_asset_201125173650.jpg
        print("inspection_url :" , inspection_url) # https://XXXX-s3.s3.ap-northeast-2.amazonaws.com/XXXX/asset/init/1110_asset_201125173855.jpg
        print("origin_path :" , origin_path) # XXXX/asset/init/1110_asset_201125173650.jpg
        print("inspection_path :" , inspection_path) # XXXX/asset/init/1110_asset_201125173855.jpg

        origin_image = image_origin_object(origin_path)
        time.sleep(1)
        inspection_image = image_inspection_object(inspection_path)
        ~~~~~~~~~~~~~~~~~~~~~~
        ~~~~~~~~~~~~~~~~~~~~~~
        ~~~~~~~~~~~~~~~~~~~~~~
        compare_url = result_save(result_feature['result']['result_path'], inspection_url, inspection_path)

        return jsonify(result_feature)

def image_origin_object(origin_path):
    
    origin_image = './images/' + origin_path.split('init/')[1]
    s3.Bucket(BUCKET_NAME).download_file(origin_path, origin_image)
    
    return origin_image

def image_inspection_object(inspection_path):

    inspection_image = './images/' + inspection_path.split('init/')[1]
    print('inspection_path >>> : ', inspection_path)
    print('inspection_image >>> : ', inspection_image)
    s3.Bucket(BUCKET_NAME).download_file(inspection_path, inspection_image)

    return inspection_image

def result_save(file_name, inspection_url, inspection_path):

    s3_client = boto3.client('s3')
    inspection_url = inspection_url.replace('init','compare')
    KEY = inspection_path.replace('init','compare')
    response = s3_client.upload_file(file_name, BUCKET_NAME, KEY)

    return inspection_url
```

### Actual Behavior
<!-- Tell us what happens instead. -->

- I make Flask API server for image processing in AWS EC2. AWS S3 Bucket is public setting. AWS EC2 configure already set my KEY, region.
### Environment

* Python version: 
```bash
(venv) ubuntu:~/environment $ python --version
Python 3.6.9
```
* Flask version:
Flask==1.1.2
Jinja2==2.11.2
flask-cors==3.0.8
* Werkzeug version:
Werkzeug==1.0.1

Having a route like `@app.route("/my-put-url/<obj_id>", methods=["PUT"])`. The route only needs access to `obj_id` which is provided in the URI. There's no need for a `body` in this case. To work around it, I need to provide `{}` in the body for it to work.

### Expected Behavior
When making a PUT request __without__ a body, which I _think_ is a valid request under RFC, such request should be handled by Flask.

### Actual Behavior
Flask however returns a 400 BadRequest response. In postman, it renders like this

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<title>400 Bad Request</title>
<h1>Bad Request</h1>
<p>The browser (or proxy) sent a request that this server could not understand.</p>
```

### Environment

* Python version: 3.7
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

I wanted to embed web page to iframe, but got cross-site issue.  The solution was set `SESSION_COOKIE_SAMESITE = None`.  The feature have existed after flask 1.0 [#2607](https://github.com/pallets/flask/pull/2607) [changed log](https://flask.palletsprojects.com/en/1.1.x/changelog/)

But no matter what I set, the `samesite` attribute has never shown up.

I can assure that flask and werkzung both are right version.  [#1549](https://github.com/pallets/werkzeug/issues/1549) and use the right config file.
### Expected Behavior
<!-- Tell us what should happen. -->

```http
Set-Cookie: session=<session>; Expires=Mon, 23-Nov-2020 11:58:00 GMT; Path=/; secure; samesite=<whatever I set>
```

### Actual Behavior
<!-- Tell us what happens instead. -->

```http
Set-Cookie: session=<session>; Expires=Mon, 23-Nov-2020 11:58:00 GMT; Path=/; secure
```

### Example
1. Try to set `samesite=strict` and without secure.

config.py
```python
SESSION_COOKIE_SAMESITE = 'Strict'
SESSION_COOKIE_HTTPONLY = False
SESSION_COOKIE_SECURE = False
```
result
![image](https://user-images.githubusercontent.com/9116623/100204291-ac4ae780-2f3e-11eb-8b1d-03a21006fd45.png)


2. Try to set `samesite=lax` and with secure.

config.py
```python
SESSION_COOKIE_SAMESITE = 'Lax'
SESSION_COOKIE_HTTPONLY = False
SESSION_COOKIE_SECURE = True
```

result
![image](https://user-images.githubusercontent.com/9116623/100205281-dea91480-2f3f-11eb-9561-90bb3a5f76ca.png)

### Environment

* Python version: 3.6
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Could we have a `before_request` handler in `MethodView`? It could be called as part of the `MethodView.dispatch_request` method.

It would be called if any subclass of `MethodView` implements a `before_request` method, for instance:

```py3
from flask.views import MethodView


class BaseView(MethodView):
    """ Base view  """

    def before_request(self):
        print("before_request called")
```

flask/views.py:

```py3
class MethodView(with_metaclass(MethodViewType, View)):
    """A class-based view that ... """

    def before_request(self, *args, **kwargs):
        """ Called before the request is dispatched to the request method handler """
        pass

    def dispatch_request(self, *args, **kwargs):

        meth = getattr(self, request.method.lower(), None)

        self.before_request(*args, **kwargs)

        # or ...

        before_func = getattr(self, "before_request", None)
        if before_func:
            before_func(*args, **kwargs)

        # If the request method is HEAD and we don't have a handler for it
        # retry with GET.
        if meth is None and request.method == "HEAD":
            meth = getattr(self, "get", None)

        assert meth is not None, "Unimplemented method %r" % request.method
        return meth(*args, **kwargs)
```


Hi,When i try to register and click submit button data doesn't save to database and page doesn't redirect to index page,thanks for attention!Sorry for my terrible english.

Python 3.9
Flask 1.1.2
Werkzeug 1.0.1

from flask import Flask,render_template,flash,redirect,url_for,session,logging,request
from flask_mysqldb import MySQL
from wtforms import Form,StringField,TextAreaField,PasswordField,validators
from passlib.hash import sha256_crypt

class RegisterForm(Form):
    name=StringField("Name and Surname",validators=[validators.length(min=5,max=15)])
    username=StringField("Username",validators=[validators.length(min=5,max=15)])
    email=StringField("Email",validators=[validators.Email(message="That is not valid email")])
    password=PasswordField("Password",validators=[
        validators.DataRequired(message="Please enter the password"),
        validators.EqualTo(fieldname="confirm",message="Passwords doesn't match")
    ])
    confirm=PasswordField("Password Confirmation")

app=Flask(__name__)
app.config["MYSQL_HOST"]="localhost"
app.config["MYSQL_USER"]="root"
app.config["MYSQL_PASSWORD"]=""
app.config["MYSQL_DB"]="mysite"
app.config["MYSQL_CURSORCLASS"]="DictCursor"
mysql=MySQL(app)

@app.route("/")
def index():
    return render_template("index.html")

@app.route("/about")
def about():
    return render_template("about.html")

@app.route("/article/<string:id>")
def article(id):
    return "Article  id:"+ id
#register
@app.route("/register",methods=["GET","POST"])
def register():
    form=RegisterForm(request.form)
    if request.form=="POST" and form.validate():
        name=form.name.data
        username=form.username
        email=form.email.data
        password=sha256_crypt.encrypt(form.password.data)
        cursor=mysql.connection.cursor()
        requestt="Insert into users(name,email,username,password) VALUES(%s,%s,%s,%s)"
        cursor.execute(requestt,(name,username,email,password))
        mysql.connection.commit()
        cursor.close()
        return redirect(url_for("index"))
    else:
        return render_template("register.html",form=form)

if __name__=="__main__":
    app.run(debug=True)
I have been trying to verify my flask web app in the google search console using the HTML file upload method but when uploading the file to the root directory, it does not appear and raises a 404 error. I also tried putting it in the templates folder but still, 404 was raised. Is there any way I can prevent this behavior and make it work

```
def allowed_file(filename):
    return '.' in filename and \
           filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS
```
Please explain the above code of lines. For full reference please visit: [https://flask.palletsprojects.com/en/1.1.x/patterns/fileuploads/](url)
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->
I design a simple RESTful server and I would like to use session (just session import from flask) for user login/logout. 
I put username in login interface and want to pop it in logout. 
So next time even same session id come after logout, it would not has any authority to use other apis.

```python
# Paste a minimal example that causes the problem.

@sitemap.route('/login', methods=('POST',))
def login():
    session['userid'] = "user_obj.id"
    session['username'] = "user_obj.nickname"
    session.permanent = True
    return "pass"

@sitemap.route('/logout', methods=('GET', 'POST'))
def logout():
    session.pop('username', None)
    session.pop('userid', None)
    return "pass"

@app.before_request
def before_action():
    uri = request.path
    if uri in {"/login"}:
        return

    if u'username' not in session:
        return "auth fail"
```

### Actual Behavior
<!-- Tell us what happens instead. -->
By using POSTMAN, I put server returned cookie in header, to simulate headless visit RESTful api.
<img width="856" alt="logout" src="https://user-images.githubusercontent.com/3025435/99762979-ac10ad80-2b34-11eb-895c-c2d81862be94.png">
After logout, I could visit other api... Just like session.pop unhappened.
That means, after logout, the code still pass before_action check if I try to use /helloworld, /list etc...


```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version: 3.8.5
* Flask version: 1.1.2
* Werkzeug version: just run in debug mode, like `create_app().run(debug=True)`

As reported in [an older ticket](https://github.com/pallets/werkzeug/issues/1683), [the documentation for abort(status, *args, **kwargs)](https://flask.palletsprojects.com/en/1.1.x/api/#flask.abort) has something wrong. It contains:

> Raises an HTTPException for the given status code or WSGI application.
> 
> If a status code is given, it will be looked up in the list of exceptions and will raise that exception. If passed a WSGI application, it will wrap it in a proxy WSGI exception and raise that:
> 
> abort(404)  # 404 Not Found
> abort(Response('Hello World'))

This is now better thanks to previous work by @cjnickel, but as he pointed out, it looks like the flask.abort() documentation is the same as werkzeug's werkzeug.exceptions.abort and it remains unclear what the author meant to write. We could start by keeping only examples about flask.abort(status, *args, **kwargs) and labelling those as such.
This change fixes the incorrect syntax introduced by #3835. Sorry about the mixup!
It has just come to my attention that I mistakenly committed the incorrect new syntax:
```
run: echo "name=PY::$(python -VV | sha256sum | cut -d' ' -f1)" >> $GITHUB_ENV
```
should become
```
run: echo "PY=$(python -VV | sha256sum | cut -d' ' -f1)" >> $GITHUB_ENV
```
I noticed that recent CI test runs were [failing](https://github.com/pallets/flask/actions/runs/366551315) due to the deprecated `set-env` command. 

These changes update the deprecated command according to [this changelog](https://github.blog/changelog/2020-10-01-github-actions-deprecating-set-env-and-add-path-commands/).

I went to the web site to find out what Flask **is**.  That question is never directly answered, that I can find.
It might be helpful if the front page of the web site and/or the _Introduction_ page in the documentation had 1-3 sentence statement of what the heck Flask is / does.  What's it for?

At present, the documentation on the site gives no indication of why one should read more, of what Flask can do.
Reading through the first bits of the docs, I get the feeling that maybe Flask has something to with writing web services in Python.
Code:
```py
app.run(host=gethost(), port=6969)
```

gethost function:
```py
import socket

def gethost():
	s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
	try:
		s.connect(("1.2.3.4", 1))
		ip = s.getsockname()[0]
	except:
		ip = "127.0.0.1"
	finally:
		s.close()
	return ip
```
Error (at app.run line)
```AttributeError: 'str' object has no attribute 'write'```
At `app.run` line im getting this error
```AttributeError: 'str' object has no attribute 'write'```
Can somebody help?
Added a new feature.


![QQ图片20201106091801](https://user-images.githubusercontent.com/74029736/98314459-ffe9a580-2010-11eb-8361-fae73d0b2735.png)

The implementations were moved to Werkzeug (pallets/werkzeug#1850, pallets/werkzeug#1962). Flask's functions become wrappers around Werkzeug to pass some Flask-specific values.

`cache_timeout` is renamed to `max_age`. `SEND_FILE_MAX_AGE_DEFAULT`, `app.send_file_max_age_default`, and `app.get_send_file_max_age` defaults to `None`. This tells the browser to use conditional requests rather than a 12 hour cache. (pallets/werkzeug#1886)

`attachment_filename` is renamed to `download_name`, and is always sent if a name is known. (pallets/werkzeug#1884)

Deprecate `helpers.safe_join` in favor of `werkzeug.utils.safe_join`.

Removed most of the tests, they're tested in Werkzeug.

In the file upload example, renamed the `uploaded_file` view to `download_file` to avoid a common source of confusion.
Flask's `client.open` mirrors Werkzeug's for processing an existing environ. Fix a test that was passing bytes around incorrectly.

Tox always tests with the latest code of the other Pallets projects. This will be changed back once the new versions are released.
### Expected Behavior
For updates of the code including favicon and index.html to be shown when I hit run in my IDE again (Wingware, but same problem at command line).

```python
# Minimal example is any Flask app
```

### Actual Behavior
Running the app renders the same app I first ran today, namely:
https://github.com/helloflask/calculator

Changing the page title in index.html or the favicon does not get reflected when the app is run.

### Environment

* Python version:  Python 3.8.3
* Flask version:  Version: 1.1.2
* Werkzeug version:  Version: 1.0.1

---

I've made the following script in order to try to both kill the server and delete any .pyc caching that might be causing the problem.  For Windows only:

kill_server.py:
```python
import os
import subprocess
import re

port = 5000
host = '127.0.0.1'
cmd_newlines = r'\r\n'

host_port = host + ':' + str(port)
pid_regex = re.compile(r'[0-9]+$')

netstat = subprocess.run(['netstat', '-n', '-a', '-o'], stdout=subprocess.PIPE)  
# Doesn't return correct PID info without precisely these flags
netstat = str(netstat)
lines = netstat.split(cmd_newlines)

for line in lines:
    if host_port in line:
        pid = pid_regex.findall(line)
        if pid:
            pid = pid[0]
            os.system('taskkill /F /PID ' + str(pid))
        
# And finally delete the .pyc cache
os.system('del /S *.pyc')
```

The problem remains dispite manually doing the above taskkills and deleting .pyc files by hand or running kill_server.py.  Therefore, there's something going on in Flask that is causing the old app to be run (it's cached or something...)

Please help!  I really want to make a calculator in Flask, not CherryPy.

I've tried "Clear Browsing Data > Clear Images & Files / Cookies" in Chrome, on Windows 10.   Same issue.
I am trying to debug Flask running with `gevent` and setting `app.debug = True` is not enough to make code reload work with it (https://github.com/gevent/gevent/issues/1696). It would be nice to get a central page with a table of feature what are available in debug mode for different deploy scenarious.

### Expected Behavior

`app.debug` docs in one place. Information what is available when Flask is run without `flask` utility.

### Actual Behavior

`debug` mode info is scattered over different bits of text. No info what debugging features are absent when deploying with `gevent` (or without `flask run`).

 https://flask.palletsprojects.com/en/master/api/?highlight=app%20debug
When I followed the tutorial I made a silly mistake in my code, and loaded the title for both title and body in the update function.  When saving an update, this meant the title was mirrored in the body, and the body was thrown away.  After I figured out my problem, I added this text to catch it, then fixed it with this code.  It is a small change, but may help the next developer running through the tutorial.

I actually changed `test_update` to the following, but couldn't decide if it made the tutorial easier or harder to understand:

```
def test_update(client, auth, app):
    auth.login()
    assert client.get('/1/update').status_code == 200
    new_values = {'title': 'updated', 'body': ''}
    client.post('/1/update', data=new_values)

    with app.app_context():
        db = get_db()
        post = db.execute('SELECT * FROM post WHERE id = 1').fetchone()

        for field, value in new_values.items():
            assert post[field] == value
```

Bumps [sphinx-tabs](https://github.com/executablebooks/sphinx-tabs) from 1.1.13 to 1.3.0.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/executablebooks/sphinx-tabs/releases">sphinx-tabs's releases</a>.</em></p>
<blockquote>
<h2>v1.3.0</h2>
<p>See <a href="https://github.com/executablebooks/sphinx-tabs/blob/master/CHANGELOG.md">CHANGELOG.md</a></p>
<h2>v1.2.1</h2>
<p>See CHANGELOG.md</p>
<h2>v1.2.0</h2>
<p>See <a href="https://github.com/executablebooks/sphinx-tabs/blob/master/CHANGELOG.md">CHANGELOG.md</a> for details</p>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/executablebooks/sphinx-tabs/blob/master/CHANGELOG.md">sphinx-tabs's changelog</a>.</em></p>
<blockquote>
<h2>1.3.0 - 2020-09-08</h2>
<p>♻️ Major refactor of tabs, group-tabs and code-tabs (thanks to <a href="https://github.com/foster999">@foster999</a>):</p>
<ul>
<li>Removes hard-coded reStructuredText for group and code tabs, so that this works with other parsers (inc <code>MyST Markdown</code>)</li>
<li>group-tab directive now subclasses <code>TabDirective</code> to remove duplicated run code</li>
<li>likewise, <code>code-tab</code> now subclasses <code>group-tab</code></li>
<li><code>TabDirective</code> and <code>TabsDirective</code> now subclass <code>SphinxDirective</code> for easier access to directive <code>env</code></li>
</ul>
<p>🧪 testing infrastructure has now fully moved from unittest to pytest</p>
<p>✨ New features:</p>
<ul>
<li>Can now pass <code>code-tabs</code> with a second argument (allowing whitespace) to provide an alternative tab label</li>
<li><code>code-tabs</code> can now use custom lexers, which are added to the sphinx app in <code>conf.py</code></li>
</ul>
<h2>v1.2.1 - 2020-08-20</h2>
<p>🐛 FIX: Remove <code>app.add_javascript</code> use for sphinx v2</p>
<h2>v1.2.0 - 2020-08-18</h2>
<p><code>sphinx-tabs</code> has now moved to the <a href="https://executablebooks.org">EBP organisation</a> 🎉</p>
<h3>Deprecated 🗑</h3>
<ul>
<li>Python &lt; 3.5 and Sphinx &lt; 2 support dropped</li>
</ul>
<h3>Improved 👌</h3>
<ul>
<li>Lots of code and CI restructuring (see [EBP Migration (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/76">#76</a>)](<a href="https://github.com/executablebooks/sphinx-tabs/commit/6342ed3f1f7d4cb50891001f26d4e3c4c08ee422">https://github.com/executablebooks/sphinx-tabs/commit/6342ed3f1f7d4cb50891001f26d4e3c4c08ee422</a>))</li>
</ul>
<h3>Fixed 🐛</h3>
<ul>
<li>Replace <code>add_javascript</code> by <code>add_js</code> for sphinx&gt;=3 (removes warning!),
thanks to <a href="https://github.com/Daltz333">@Daltz333</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/05ddd2cedeae2c71d1cf529383ca730911162666"><code>05ddd2c</code></a> 🚀 RELEASE: v1.3.0</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/de7e7126198aac5e9598e099f9a2f4cd8e089e55"><code>de7e712</code></a> ♻️ REFACTOR: Make content parsing format agnostic (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/79">#79</a>)</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/384fdf739013fe29285b6f27fd6d51e3845beadd"><code>384fdf7</code></a> 🧪 TESTS: Move from unittest to pytest (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/88">#88</a>)</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/546f52f1b0c76fb0ccc2340381e5ee023406a38b"><code>546f52f</code></a> 🚀 RELEASE: v1.2.1 (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/86">#86</a>)</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/2db3551bde7cac6b527d64c7c1d2296855230776"><code>2db3551</code></a> 🐛 FIX: Remove <code>app.add_javascript</code> use for sphinx v2</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/b0f41a186f21482ff336ea7840cab29b9824d4a6"><code>b0f41a1</code></a> 📚 DOCS: Remove sphinx-tabs version from README (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/83">#83</a>)</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/0dfdba8664b4be4b754b7fabddc988c881813ba5"><code>0dfdba8</code></a> 📚 DOCS: mention sphinx_tabs_valid_builders in README (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/56">#56</a>)</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/9c228e6cc9f5c9e857bd154852acf5ac5e3b3757"><code>9c228e6</code></a> 🚀 RELEASE: v1.2.0 (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/82">#82</a>)</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/464dd36501c8b8f7374850c230f313e8f29ecd96"><code>464dd36</code></a> 🔧 MAINTAIN: Update Manifest</li>
<li><a href="https://github.com/executablebooks/sphinx-tabs/commit/dee9cb30306225de7dd5f5b3de43b6b6d02da524"><code>dee9cb3</code></a> 🐛 FIX: Replace <code>add_javascript</code> by <code>add_js</code> for sphinx&gt;=3 (<a href="https://github-redirect.dependabot.com/executablebooks/sphinx-tabs/issues/77">#77</a>)</li>
<li>Additional commits viewable in <a href="https://github.com/executablebooks/sphinx-tabs/compare/v1.1.13...v1.3.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=sphinx-tabs&package-manager=pip&previous-version=1.1.13&new-version=1.3.0)](https://dependabot.com/compatibility-score/?dependency-name=sphinx-tabs&package-manager=pip&previous-version=1.1.13&new-version=1.3.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [pre-commit](https://github.com/pre-commit/pre-commit) from 2.7.1 to 2.8.2.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/releases">pre-commit's releases</a>.</em></p>
<blockquote>
<h2>pre-commit v2.8.1</h2>
<h3>Fixes</h3>
<ul>
<li>Allow default <code>language_version</code> of <code>system</code> when the homedir is <code>/</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1669">#1669</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
</ul>
<h2>pre-commit v2.8.0</h2>
<h3>Features</h3>
<ul>
<li>Update <code>rbenv</code> / <code>ruby-build</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1612">#1612</a> issue by <a href="https://github.com/tdeo">@tdeo</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1614">#1614</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Update <code>sample-config</code> versions
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1611">#1611</a> PR by <a href="https://github.com/mcsitter">@mcsitter</a>.</li>
</ul>
</li>
<li>Add new language: <code>dotnet</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1598">#1598</a> by <a href="https://github.com/rkm">@rkm</a>.</li>
</ul>
</li>
<li>Add <code>--negate</code> option to <code>language: pygrep</code> hooks
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1643">#1643</a> PR by <a href="https://github.com/MarcoGorelli">@MarcoGorelli</a>.</li>
</ul>
</li>
<li>Add zipapp support
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1616">#1616</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Run pre-commit through <a href="https://pre-commit.ci">https://pre-commit.ci</a>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1662">#1662</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Add new language: <code>coursier</code> (a jvm-based package manager)
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1633">#1633</a> PR by <a href="https://github.com/JosephMoniz">@JosephMoniz</a>.</li>
</ul>
</li>
<li>Exit with distinct codes: 1 (user error), 3 (unexpected error), 130 (^C)
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1601">#1601</a> PR by <a href="https://github.com/int3l">@int3l</a>.</li>
</ul>
</li>
</ul>
<h3>Fixes</h3>
<ul>
<li>Improve <code>healthy()</code> check for <code>language: node</code> + <code>language_version: system</code> hooks when the system executable goes missing.
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/action/issues/45">pre-commit/action#45</a> issue by <a href="https://github.com/KOliver94">@KOliver94</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1589">#1589</a> issue by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1590">#1590</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Fix excess whitespace in error log traceback
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1592">#1592</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Fix posixlike shebang invocations with shim executables of the git hook script on windows.
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1593">#1593</a> issue by <a href="https://github.com/Celeborn2BeAlive">@Celeborn2BeAlive</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1595">#1595</a> PR by <a href="https://github.com/Celeborn2BeAlive">@Celeborn2BeAlive</a>.</li>
</ul>
</li>
<li>Remove hard-coded <code>C:\PythonXX\python.exe</code> path on windows as it caused confusion (and <code>virtualenv</code> can sometimes do better)
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1599">#1599</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Fix <code>language: ruby</code> hooks when <code>--format-executable</code> is present in a gemrc
<ul>
<li>issue by <code>Rainbow Tux</code> (discord).</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1603">#1603</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Move <code>cygwin</code> / <code>win32</code> mismatch error earlier to catch msys2 mismatches
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1605">#1605</a> issue by <a href="https://github.com/danyeaw">@danyeaw</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1606">#1606</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Remove <code>-p</code> workaround for old <code>virtualenv</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1617">#1617</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Fix <code>language: node</code> installations to not symlink outside of the environment
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit-ci/issues/issues/2">pre-commit-ci/issues#2</a> issue by <a href="https://github.com/DanielJSottile">@DanielJSottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1667">#1667</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Don't identify shim executables as valid <code>system</code> for defaulting
<code>language_version</code> for <code>language: node</code> / <code>language: ruby</code></li>
</ul>
<!-- raw HTML omitted -->
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/blob/master/CHANGELOG.md">pre-commit's changelog</a>.</em></p>
<blockquote>
<h1>2.8.2 - 2020-10-30</h1>
<h3>Fixes</h3>
<ul>
<li>Fix installation of ruby hooks with <code>language_version: default</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1671">#1671</a> issue by <a href="https://github.com/aerickson">@aerickson</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1672">#1672</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
</ul>
<h1>2.8.1 - 2020-10-28</h1>
<h3>Fixes</h3>
<ul>
<li>Allow default <code>language_version</code> of <code>system</code> when the homedir is <code>/</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1669">#1669</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
</ul>
<h1>2.8.0 - 2020-10-28</h1>
<h3>Features</h3>
<ul>
<li>Update <code>rbenv</code> / <code>ruby-build</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1612">#1612</a> issue by <a href="https://github.com/tdeo">@tdeo</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1614">#1614</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Update <code>sample-config</code> versions
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1611">#1611</a> PR by <a href="https://github.com/mcsitter">@mcsitter</a>.</li>
</ul>
</li>
<li>Add new language: <code>dotnet</code>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1598">#1598</a> by <a href="https://github.com/rkm">@rkm</a>.</li>
</ul>
</li>
<li>Add <code>--negate</code> option to <code>language: pygrep</code> hooks
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1643">#1643</a> PR by <a href="https://github.com/MarcoGorelli">@MarcoGorelli</a>.</li>
</ul>
</li>
<li>Add zipapp support
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1616">#1616</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Run pre-commit through <a href="https://pre-commit.ci">https://pre-commit.ci</a>
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1662">#1662</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Add new language: <code>coursier</code> (a jvm-based package manager)
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1633">#1633</a> PR by <a href="https://github.com/JosephMoniz">@JosephMoniz</a>.</li>
</ul>
</li>
<li>Exit with distinct codes: 1 (user error), 3 (unexpected error), 130 (^C)
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1601">#1601</a> PR by <a href="https://github.com/int3l">@int3l</a>.</li>
</ul>
</li>
</ul>
<h3>Fixes</h3>
<ul>
<li>Improve <code>healthy()</code> check for <code>language: node</code> + <code>language_version: system</code>
hooks when the system executable goes missing.
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/action/issues/45">pre-commit/action#45</a> issue by <a href="https://github.com/KOliver94">@KOliver94</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1589">#1589</a> issue by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1590">#1590</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Fix excess whitespace in error log traceback
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1592">#1592</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Fix posixlike shebang invocations with shim executables of the git hook
script on windows.
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1593">#1593</a> issue by <a href="https://github.com/Celeborn2BeAlive">@Celeborn2BeAlive</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1595">#1595</a> PR by <a href="https://github.com/Celeborn2BeAlive">@Celeborn2BeAlive</a>.</li>
</ul>
</li>
<li>Remove hard-coded <code>C:\PythonXX\python.exe</code> path on windows as it caused</li>
</ul>
<!-- raw HTML omitted -->
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pre-commit/pre-commit/commit/3112e080883c4973262569d81b6d3307db08b210"><code>3112e08</code></a> v2.8.2</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/4aa249c8a5359dc4164abc5350788dfa259b3a1b"><code>4aa249c</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1672">#1672</a> from pre-commit/ruby_default</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/e05ac1e91fcfa695405df1c18d4432c12e5d7142"><code>e05ac1e</code></a> don't call ruby install for language_version = default</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/b2207e5b044374d90cc349e136279f27e615d0fc"><code>b2207e5</code></a> v2.8.1</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/8fb7365a6142d5ac498ee227536137ae3f6b47dc"><code>8fb7365</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1669">#1669</a> from pre-commit/not_a_shim_when_home_is_slash</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/62b8d0ed825bde729a32ffadf0b45f2ea82315f8"><code>62b8d0e</code></a> allow default language_version of system when homedir is /</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/711248f6785e60d698d915e79841df65de40634a"><code>711248f</code></a> show features first</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/a3c9721d8f4df3de7104f61b336dea3feb5fa52c"><code>a3c9721</code></a> v2.8.0</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/763dbc0ac6b21d06178175aa14165e3beff708b2"><code>763dbc0</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1668">#1668</a> from pre-commit/avoid_shims</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/7f9f66e542395ba743e243bdcd92df4e5500d57d"><code>7f9f66e</code></a> don't use system for ruby/node if it is a shim exe</li>
<li>Additional commits viewable in <a href="https://github.com/pre-commit/pre-commit/compare/v2.7.1...v2.8.2">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pre-commit&package-manager=pip&previous-version=2.7.1&new-version=2.8.2)](https://dependabot.com/compatibility-score/?dependency-name=pre-commit&package-manager=pip&previous-version=2.7.1&new-version=2.8.2)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [python-dotenv](https://github.com/theskumar/python-dotenv) from 0.14.0 to 0.15.0.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/theskumar/python-dotenv/blob/master/CHANGELOG.md">python-dotenv's changelog</a>.</em></p>
<blockquote>
<h2>[0.15.0] - 2020-10-28</h2>
<h3>Added</h3>
<ul>
<li>Add <code>--export</code> option to <code>set</code> to make it prepend the binding with <code>export</code> (<a href="https://github-redirect.dependabot.com/theskumar/python-dotenv/issues/270">#270</a> by
[<a href="https://github.com/jadutter">@jadutter</a>]).</li>
</ul>
<h3>Changed</h3>
<ul>
<li>Make <code>set</code> command create the <code>.env</code> file in the current directory if no <code>.env</code> file was
found (<a href="https://github-redirect.dependabot.com/theskumar/python-dotenv/issues/270">#270</a> by [<a href="https://github.com/jadutter">@jadutter</a>]).</li>
</ul>
<h3>Fixed</h3>
<ul>
<li>Fix potentially empty expanded value for duplicate key (<a href="https://github-redirect.dependabot.com/theskumar/python-dotenv/issues/260">#260</a> by [<a href="https://github.com/bbc2">@bbc2</a>]).</li>
<li>Fix import error on Python 3.5.0 and 3.5.1 (<a href="https://github-redirect.dependabot.com/theskumar/python-dotenv/issues/267">#267</a> by [<a href="https://github.com/gongqingkui">@gongqingkui</a>]).</li>
<li>Fix parsing of unquoted values containing several adjacent space or tab characters
(<a href="https://github-redirect.dependabot.com/theskumar/python-dotenv/issues/277">#277</a> by [<a href="https://github.com/bbc2">@bbc2</a>], review by [<a href="https://github.com/x-yuri">@x-yuri</a>]).</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/theskumar/python-dotenv/commit/e13d957bf48224453c5d9d9a7a83a13b999e0196"><code>e13d957</code></a> Release v0.15.0</li>
<li><a href="https://github.com/theskumar/python-dotenv/commit/fa354ce5d4c4f515e340265bf7c0f7e32fb0e75d"><code>fa354ce</code></a> Migrate from travis-ci.org to .com</li>
<li><a href="https://github.com/theskumar/python-dotenv/commit/6fc345833f148762bb8783896d1b1059b146886f"><code>6fc3458</code></a> Add python 3.9 to CI</li>
<li><a href="https://github.com/theskumar/python-dotenv/commit/7b172fe24830bb8fd8cd943b73570e8cd6515ba1"><code>7b172fe</code></a> Fix parsing of unquoted values with two spaces</li>
<li><a href="https://github.com/theskumar/python-dotenv/commit/6ca2e2ab399c7e41be276bc830f21af3092f5d28"><code>6ca2e2a</code></a> Add --export to <code>set</code> and make it create env file</li>
<li><a href="https://github.com/theskumar/python-dotenv/commit/92ec3b280db6e9f946994a3bf5815d6b6447892c"><code>92ec3b2</code></a> Update README.md</li>
<li><a href="https://github.com/theskumar/python-dotenv/commit/78be0f865d34c34120456ff0b6b9d34a95ac6879"><code>78be0f8</code></a> Fix import error on Python 3.5.0 and 3.5.1</li>
<li><a href="https://github.com/theskumar/python-dotenv/commit/4b434362e1832771fd08c14b8af67a8fd562b854"><code>4b43436</code></a> Fix empty expanded value for duplicate key</li>
<li>See full diff in <a href="https://github.com/theskumar/python-dotenv/compare/v0.14.0...v0.15.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=python-dotenv&package-manager=pip&previous-version=0.14.0&new-version=0.15.0)](https://dependabot.com/compatibility-score/?dependency-name=python-dotenv&package-manager=pip&previous-version=0.14.0&new-version=0.15.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
[//]: # (dependabot-start)
⚠️  **Dependabot is rebasing this PR** ⚠️ 

If you make any changes to it yourself then they will take precedence over the rebase.

---

[//]: # (dependabot-end)

Bumps [tox](https://github.com/tox-dev/tox) from 3.20.0 to 3.20.1.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/tox-dev/tox/blob/master/docs/changelog.rst">tox's changelog</a>.</em></p>
<blockquote>
<h1>v3.20.1 (2020-10-09)</h1>
<h2>Bugfixes</h2>
<ul>
<li>Relax importlib requirement to allow version&lt;3 - by usamasadiq <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1682">#1682</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/tox-dev/tox/commit/e4285063289fd3550427ef47a5e681cb41addbee"><code>e428506</code></a> release 3.20.1</li>
<li><a href="https://github.com/tox-dev/tox/commit/e66fc6d717bfe22c4f34548e5c40f711b27b4b19"><code>e66fc6d</code></a> Fix negated factor condition example for not-a-and-not-b (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1683">#1683</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/cfe38bb853ff8573817c640a158b87eaad5b6e01"><code>cfe38bb</code></a> Update general.rst (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1685">#1685</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/471b39f0edd015b8e873695c3cfb893ede36fae6"><code>471b39f</code></a> Update constraint for importlib-metadata (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1682">#1682</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/9120bc77d94ea7efcc77c13249297e2f4b023b89"><code>9120bc7</code></a> Some headings aren't completely fixed, yet (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1676">#1676</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/c2f6c9cb9a1d70ac79524076845bc32ed25489ad"><code>c2f6c9c</code></a> Make headings consistent (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1675">#1675</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/800b4cc1261b490a8afa34b44dc804a82ecf0b81"><code>800b4cc</code></a> Improve docs grammar and clarity. (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1671">#1671</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/e9071c17f51031dd397f0b716fdb58a4a7df66be"><code>e9071c1</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1669">#1669</a> from tox-dev/release-3.20.0</li>
<li>See full diff in <a href="https://github.com/tox-dev/tox/compare/3.20.0...3.20.1">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=tox&package-manager=pip&previous-version=3.20.0&new-version=3.20.1)](https://dependabot.com/compatibility-score/?dependency-name=tox&package-manager=pip&previous-version=3.20.0&new-version=3.20.1)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [pytest](https://github.com/pytest-dev/pytest) from 6.1.1 to 6.1.2.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/releases">pytest's releases</a>.</em></p>
<blockquote>
<h2>6.1.2</h2>
<h1>pytest 6.1.2 (2020-10-28)</h1>
<h2>Bug Fixes</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7758">#7758</a>: Fixed an issue where some files in packages are getting lost from <code>--lf</code> even though they contain tests that failed. Regressed in pytest 5.4.0.</li>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7911">#7911</a>: Directories created by tmpdir are now considered stale after 3 days without modification (previous value was 3 hours) to avoid deleting directories still in use in long running test suites.</li>
</ul>
<h2>Improved Documentation</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7815">#7815</a>: Improve deprecation warning message for <code>pytest._fillfuncargs()</code>.</li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/blob/master/CHANGELOG.rst">pytest's changelog</a>.</em></p>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pytest-dev/pytest/commit/4e8b50ba01f0d8a6a2abb98440d3421a037eddb7"><code>4e8b50b</code></a> Prepare release version 6.1.2</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/cd221df8e28681e71fbb61e79e0759385c9f229b"><code>cd221df</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7955">#7955</a> from nicoddemus/backport-7914</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/8c1c1ae3107b890e53d8396cfbf79a5a20af09db"><code>8c1c1ae</code></a> Increase temp dir deletion period to 3 days (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7914">#7914</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/a88fe584adc0cc9d94b4e184c20ad23738e4ed32"><code>a88fe58</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7919">#7919</a> from nicoddemus/backport-7917</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/cd57271455e56661f2931bcb6cc05e9f7e87f4b0"><code>cd57271</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7917">#7917</a> from bluetech/ci-timeout</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/46195edc3e540611703444311e25b0fbffc3aae0"><code>46195ed</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7918">#7918</a> from bluetech/backport-7915</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/9237b5f6335af39377a231d26648b48bab3eb871"><code>9237b5f</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7915">#7915</a> from bluetech/fix-lf-package</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/95fd566133d01256fcb136ea444b4b21f8b73bc8"><code>95fd566</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7867">#7867</a> from nicoddemus/backport-7829</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/c93962c49123928650cc1e18d172e10194fecebc"><code>c93962c</code></a> Add alias clarification to deprecation warning (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7829">#7829</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/dc96e485a037f84fe2dfa708ca5724a186705f9d"><code>dc96e48</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7861">#7861</a> from nicoddemus/backport-7860</li>
<li>Additional commits viewable in <a href="https://github.com/pytest-dev/pytest/compare/6.1.1...6.1.2">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pytest&package-manager=pip&previous-version=6.1.1&new-version=6.1.2)](https://dependabot.com/compatibility-score/?dependency-name=pytest&package-manager=pip&previous-version=6.1.1&new-version=6.1.2)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->

```python
from flask import Flask
import time

app = Flask(__name__)


@app.route("/")
def hello():
    time.sleep(10)
    return "<h1 style='color:blue'>Hello There!</h1>"

if __name__ == "__main__":
    app.run()
```


### Actual Behavior
<!-- Tell us what happens instead. -->



I have code as above. When I run two simultaneous requests on 127.0.0.1:5000 I get two answers together.
When I run it under uwsgi with single process I get each result after 10 seconds.

### Environment

* Python version: 3.6.9
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

The external_url_handler in the documentation for `flask.url_for`
example [1] now uses Python 3 compatible `E(V).with_traceback(T)`
instead of the old `raise E, V, T`.

[1]: https://flask.palletsprojects.com/en/1.1.x/api/#flask.url_for

See also
https://docs.python.org/3/library/2to3.html?highlight=raise#2to3fixer-raise
### Expected Behavior
Running a flask app from terminal command line

```python
flask run
```

### Actual Behavior
App doesn't start but instantly throws an error

```pytb
Traceback (most recent call last):
  File "/home/paul/PycharmProjects/APT/venv/bin/flask", line 8, in <module>
    sys.exit(main())
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/flask/cli.py", line 967, in main
    cli.main(args=sys.argv[1:], prog_name="python -m flask" if as_module else None)
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/flask/cli.py", line 586, in main
    return super(FlaskGroup, self).main(*args, **kwargs)
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/click/core.py", line 782, in main
    rv = self.invoke(ctx)
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/click/core.py", line 1254, in invoke
    cmd_name, cmd, args = self.resolve_command(ctx, args)
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/click/core.py", line 1297, in resolve_command
    cmd = self.get_command(ctx, cmd_name)
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/flask/cli.py", line 527, in get_command
    self._load_plugin_commands()
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/flask/cli.py", line 523, in _load_plugin_commands
    self.add_command(ep.load(), ep.name)
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/pkg_resources/__init__.py", line 2446, in load
    self.require(*args, **kwargs)
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/pkg_resources/__init__.py", line 2469, in require
    items = working_set.resolve(reqs, env, installer, extras=self.extras)
  File "/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages/pkg_resources/__init__.py", line 775, in resolve
    raise VersionConflict(dist, req).with_context(dependent_req)
pkg_resources.VersionConflict: (Flask-Login 0.5.0 (/home/paul/PycharmProjects/APT/venv/lib/python3.6/site-packages), Requirement.parse('Flask-Login<0.5,>=0.3'))
```

In line with the error traceback; downgrading to Flask-Login 0.4.1 solves the issue

### Environment

* Python version: 3.6.9
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

Just added a test for the `default` method in JSONEncoder, specifically for objects with `__html__` method.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

The guide shows how to create or migrate a Flask application using
Docker on Divio. It discusses using docker-compose.yml to create
a Dockerised development environment, environment variables for
configuration and a gateway server.
Previously, there was just a single issue template with "bug report" format. This was good for reporting bugs, but not so convenient for feature requests.

However, GitHub allows multiple issue templates and 'config.yml' file for configuring them. So I added new issue template for feature requests and links to Stack Overflow and Discord to issue reporting menu. Template for bug reports is mostly the same as the original template, and template for feature requests is based on default GitHub feature request template but modified a bit to be consistent with the original template. This will also automatically label issues either as 'bug' or as 'enhancement' depending on which template is chosen. Links to Stack Overflow and Discord were added in similar way as in Werkzeug and Jinja repositories.

It seems to me that it was necessary to specify the step of creating the hello.py file, because some newbie may be confused, even if the creation of the file is implicit

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
Flaskform should be imported.

```python
from flask_wtf import Flaskform
```

### Actual Behavior
Program cannot import Flaskform

```pytb
ImportError: cannot import name 'Flaskform' from 'flask_wtf'
```

### Environment

* Python version: 3.9
* Flask version: 1.1.2
* Werkzeug version: 1.0.1


To be consistent with the rest of documents.

In API doc, `route` function docstring states that
`methods is a list of methods this rule should be limited to (GET, POST etc.)`

Using list also avoid confusing when using a tuple of 1 element, when new
user tries to remove a method from ('GET', 'POST')
and removed the `,` would make it no longer a tuple.

In the page, there are mentions of Jinja2 tags (block start/end tag),
clarify here to avoid confusion.
The replacement is done by the library, link to the
python sqlite3 library document instead of a generic document
as different libraries use different placeholders.
cli.load_dotenv showed wrong message, when path to cli.load_dotenv provided,
now it show right message

make small refactor of this func
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

test code
`
#!/usr/bin/env python3

from flask import Flask

app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello, World!'

if __name__ == '__main__':
    print("Test Server\n")
    app.run(host='0.0.0.0', port=8000, debug=True, threaded=True, ssl_context=('server.crt', 'server.key'))
`

### Expected Behavior
<!-- Tell us what should happen. -->
if use the curl -L -k https:// remote address (not local or private address ) , all be fine.
if use the browser like MAC OS chrome safari firefox , or windows 10 ie , visit that link, the server site will stack, no error output, no exception , no traceback , no respons.
and if you use curl to visit again , you can't get any message by that action, looks server dead ?,i test many times . all the same result.

Paste the full traceback if there was an exception.



### Environment
Ubuntu 20.04.1 LTS
Linux 5.4.0-52-generic #57-Ubuntu SMP Thu Oct 15 10:57:00 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
Python 3.8.5
APScheduler==3.6.3
Flask==1.1.2
Flask-APScheduler==1.11.0
itsdangerous==1.1.0
python-dateutil==2.8.1
pytz==2020.1
tzlocal==2.1
Werkzeug==1.0.1

I noticed something about the market share of Internet Explorer and thought "that can't be true". After fixing that I also found out that Mark Pilgrim's book has been published, so I updated that as well.

### Expected Behavior
Normally, the "app.run()" should go back and open the web server with the port number 3000.

```python
from flask import Flask
app = Flask(__name__)

@app.route('/')
def index():
    return 'Hello Flask'

app.run(port=3000)
```

### Actual Behavior
Errors are occurring in "app.run()".
The same error occurs when using the debug tool in the visual studio code or the Python3 console window.


![Visual Studio Code traceback](https://user-images.githubusercontent.com/16767890/96731602-673d0e00-13f2-11eb-8e0f-93aada6e2285.png)
When using the debug tool in Visual Studio Code
![IDLE traceback](https://user-images.githubusercontent.com/16767890/96731788-99e70680-13f2-11eb-8621-4fefce6d519b.png)
When using the debug tool in IDLE

```pytb
Traceback (most recent call last):
  File "D:\Flask\start.py", line 8, in <module>
    app.run(port=3000)
  File "C:\Users\gunyu\AppData\Local\Programs\Python\Python38-32\lib\site-packages\flask\app.py", line 990, in run
    run_simple(host, port, self, **options)
  File "C:\Users\gunyu\AppData\Local\Programs\Python\Python38-32\lib\site-packages\werkzeug\serving.py", line 1052, in run_simple
    inner()
  File "C:\Users\gunyu\AppData\Local\Programs\Python\Python38-32\lib\site-packages\werkzeug\serving.py", line 996, in inner
    srv = make_server(
  File "C:\Users\gunyu\AppData\Local\Programs\Python\Python38-32\lib\site-packages\werkzeug\serving.py", line 847, in make_server
    return ThreadedWSGIServer(
  File "C:\Users\gunyu\AppData\Local\Programs\Python\Python38-32\lib\site-packages\werkzeug\serving.py", line 740, in __init__
    HTTPServer.__init__(self, server_address, handler)
  File "C:\Users\gunyu\AppData\Local\Programs\Python\Python38-32\lib\socketserver.py", line 452, in __init__
    self.server_bind()
  File "C:\Users\gunyu\AppData\Local\Programs\Python\Python38-32\lib\http\server.py", line 140, in server_bind
    self.server_name = socket.getfqdn(host)
  File "C:\Users\gunyu\AppData\Local\Programs\Python\Python38-32\lib\socket.py", line 756, in getfqdn
    hostname, aliases, ipaddrs = gethostbyaddr(name)
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xc0 in position 0: invalid start byte
```

### Environment

* Python version: v3.8.2
* Flask version: v1.1.2
* Werkzeug version: v1.0.1

Unsure whether to submit this issue to werkzeug or flask. This is kind of a long-winded issue. I can create a sample project on GitHub if required to replicated this behavior.

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->
When passing headers to Client.post in werkzeug/test.py, I expect the request.headers object that Flask receives to have the same exact keys that I pass.

`tests.conftest.py`
```
@pytest.fixture(scope='session', autouse=True)
def app():
    """Create and configure a new app instance for each test."""
    app = create_app(config='testing')
    yield app

@pytest.fixture
def client(app):
    """A test client for the app."""
    return app.test_client()
```
`tests/test_api.py`
```
headers = {
    "Content-Type": "application/json",
    "User-Agent": "GitHub-Hookshot/d88a271",
    "X-GitHub-Delivery": "c623de96-03f1-11eb-8e54-189e1c4a92e7",
    "X-GitHub-Enterprise-Host": "github.ibm.com",
    "X-GitHub-Event": "pull_request" ,
}
data = { 'foo': 'bar' }
def test_1(client):
    with patch('flaskr.tasks.process_pull_request.delay') as mock_task:
        rv = client.post('/api/webhooks', json=data, headers=headers)
```
`flaskr/__init__.py`
```

def create_app(config=os.environ.get('FLASK_ENV', 'default')):
    # create and configure the app
    app = Flask(__name__, instance_relative_config=True)
 
    from . import routes
    app.register_blueprint(routes.bp)

    return app
```
`flaskr/routes.py`
```
from flask import Blueprint, request, jsonify

from bulldozer.events import EventFactory
import flaskr.handler as handler

bp = Blueprint('routes', __name__, url_prefix='/')

@bp.route('/api/webhooks', methods=('GET', 'POST'))
def process_webhook():
    if request.method == 'POST':
        # assertion 1 passes
        assert 'X-GitHub-Event' in request.headers

        # assertion 2 fails because the key is 'Github-Event' with a lowercase 'h'
        assert 'X-GitHub-Event' in request.headers.keys
        return jsonify({})
```

### Actual Behavior
<!-- Tell us what happens instead. -->
For some strange reason, the werkzeug/test.py or flask/testing.py code is modifying the headers that are passed from my unit test. Instead of `X-GitHub-Event`, the Flask Request object has a `X-Github-Event` key (note the lowercase 'h').

I passed
```
 headers = {
    "Content-Type": "application/json",
    "User-Agent": "GitHub-Hookshot/d88a271",
    "X-GitHub-Delivery": "c623de96-03f1-11eb-8e54-189e1c4a92e7",
    "X-GitHub-Enterprise-Host": "github.ibm.com",
    "X-GitHub-Event": "pull_request" ,
}
```
but `request.headers` shows
```
headers = {
    "Content-Type": "application/json",
    "User-Agent": "GitHub-Hookshot/d88a271",
    "X-Github-Delivery": "c623de96-03f1-11eb-8e54-189e1c4a92e7",
    "X-Github-Enterprise-Host": "github.ibm.com",
    "X-Github-Event": "pull_request" ,
}
```


Why does the header I pass get displayed differently in the [EnvironHeaders](https://tedboy.github.io/flask/generated/generated/werkzeug.EnvironHeaders.html) object? 
```
$ python3 -m pytest tests/test_api::test1
venv/lib/python3.7/site-packages/flask/app.py:1936: in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    @bp.route('/api/webhooks', methods=('GET', 'POST'))
    def process_webhook():
        if request.method == 'POST':
            # assertion 1 passes
            print(request.headers)
            assert 'X-GitHub-Event' in request.headers
    
            # assertion 2 fails because the key is 'Github-Event' with a lowercase 'h'
            for k in request.headers.keys():
                print(k)
>           assert 'X-GitHub-Event' in request.headers.keys()
E           AssertionError

flaskr/routes.py:18: AssertionError
--------------------------------------------------- Captured stdout call ---------------------------------------------------
User-Agent: GitHub-Hookshot/d88a271
Host: localhost
Content-Type: application/json
Content-Length: 23427
X-Github-Delivery: c623de96-03f1-11eb-8e54-189e1c4a92e7
X-Github-Enterprise-Host: github.ibm.com
X-Github-Event: pull_request


User-Agent
Host
Content-Type
Content-Length
X-Github-Delivery
X-Github-Enterprise-Host
X-Github-Event
```

### Environment

* Python version: 3.7.7
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

Small fixes, noting to add in changes
It would be great to support [RFC 7233 : Hypertext Transfer Protocol (HTTP/1.1): Range Requests](https://tools.ietf.org/html/rfc7233) for next major version, at least for non multipart/byteranges media type.

I'm willing to implement this, so please share your thoughts about this.

What must be done:
- Modify `send_file` method to support Range Requests
  - Use existing `conditionnal` parameter to enable Range Requests support ?

[The docs](http://flask.pocoo.org/docs/0.11/cli/) on the FLASK_APP variable state that

> In that imported file the name of the app needs to be called `app` or optionally be specified after a colon. For instance _mymodule:application_ would tell it to use the _application_ object in the `mymodule.py` file.

However, creating the following script (run.py):

```
from flask import Flask

webapp = Flask(__name__)
```

setting `FLASK_APP=run.py:webapp`, and running `flask run` gives me an ImportError:

```
Traceback (most recent call last):
  File "/Users/me/app/venv/lib/python3.5/site-packages/flask/cli.py", line 156, in __call__
    self._flush_bg_loading_exception()
  File "/Users/me/app/venv/lib/python3.5/site-packages/flask/cli.py", line 144, in _flush_bg_loading_exception
    reraise(*exc_info)
  File "/Users/me/app/venv/lib/python3.5/site-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "/Users/me/app/venv/lib/python3.5/site-packages/flask/cli.py", line 133, in _load_app
    self._load_unlocked()
  File "/Users/me/app/venv/lib/python3.5/site-packages/flask/cli.py", line 148, in _load_unlocked
    self._app = rv = self.loader()
  File "/Users/me/app/venv/lib/python3.5/site-packages/flask/cli.py", line 209, in load_app
    rv = locate_app(self.app_import_path)
  File "/Users/me/app/venv/lib/python3.5/site-packages/flask/cli.py", line 89, in locate_app
    __import__(module)
ImportError: No module named 'run'
```

Interestingly, using `FLASK_APP=run.py` actually works even with the app named "webapp". So while I'm not sure how much of this is error on my part vs. error on flask's, the docs are wrong in saying that the Flask object _needs_ to be named "app".

The following view only generate output **during the execution** on Firefox.
On Chrome the request flush the entire response once, when the `while` ends, at the end.

What are making the it don't work on Chrome?

```
@processes.route('/read_buffer/<int:pid>')
def read_buffer(pid):

    def generate():
        sent = 0
        while not settings.buffers[pid]['finished']:
            for i, row in enumerate(settings.buffers[pid]['lines'][sent:]):
                sent += 1
                yield row

            gevent.sleep(0.5)

    return flask.Response(
        response=generate(),
        status=200,
        mimetype="text/plain"
    )
```

App config:

```
app = flask.Flask(__name__)
app.config['DEBUG'] = False
app.register_blueprint(processes.processes, url_prefix='/processes')
CORS(app)
socketio = SocketIO(app, async_mode='gevent')
socketio.run(
    app=app,
    host=_config.get('server', 'host', fallback='0.0.0.0'),
    port=_config.getint('server', 'port', fallback=5000),
    use_reloader=False
)
```

Thank you

I have been trying to document my project with sphinx, but it seems that when sphinx reads a file that contains `import current_app` it breaks with the following message:

```
[$]>>> make html
sphinx-build -b html -d build/doctrees  -W -v source build/html
Running Sphinx v1.4.5
loading pickled environment... not yet created
building [mo]: targets for 0 po files that are out of date
building [html]: targets for 5 source files that are out of date
updating environment: 5 added, 0 changed, 0 removed
reading sources... [ 20%] index
reading sources... [ 40%] modules
reading sources... [ 60%] quizApp
Traceback (most recent call last):
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/sphinx/ext/viewcode.py", line 28, in _get_full_modname
    return get_full_modname(modname, attribute)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/sphinx/util/__init__.py", line 300, in get_full_modname
    __import__(modname)
TypeError: __import__() argument 1 must be string, not None
viewcode can't import None, failed with error "__import__() argument 1 must be string, not None"
Traceback (most recent call last):
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/sphinx/ext/viewcode.py", line 28, in _get_full_modname
    return get_full_modname(modname, attribute)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/sphinx/util/__init__.py", line 300, in get_full_modname
    __import__(modname)
TypeError: __import__() argument 1 must be string, not None
viewcode can't import None, failed with error "__import__() argument 1 must be string, not None"
Didn't find ParticipantExperiment.activities in quizApp.models
Didn't find Question.explantion in quizApp.models
Didn't find User.name in quizApp.models
Didn't find User.authenticated in quizApp.models
reading sources... [ 80%] quizApp.forms
reading sources... [100%] quizApp.views

Traceback (most recent call last):
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/sphinx/cmdline.py", line 244, in main
    app.build(opts.force_all, filenames)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/sphinx/application.py", line 297, in build
    self.builder.build_update()
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/sphinx/builders/__init__.py", line 251, in build_update
    'out of date' % len(to_build))
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/sphinx/builders/__init__.py", line 265, in build
    self.doctreedir, self.app))
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/sphinx/environment.py", line 569, in update
    self._read_serial(docnames, app)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/sphinx/environment.py", line 589, in _read_serial
    self.read_doc(docname, app)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/sphinx/environment.py", line 742, in read_doc
    pub.publish()
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/core.py", line 217, in publish
    self.settings)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/sphinx/io.py", line 49, in read
    self.parse()
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/readers/__init__.py", line 78, in parse
    self.parser.parse(self.input, document)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/parsers/rst/__init__.py", line 172, in parse
    self.statemachine.run(inputlines, document, inliner=self.inliner)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 170, in run
    input_source=document['source'])
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/statemachine.py", line 239, in run
    context, state, transitions)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/statemachine.py", line 460, in check_line
    return method(match, context, next_state)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 2726, in underline
    self.section(title, source, style, lineno - 1, messages)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 327, in section
    self.new_subsection(title, lineno, messages)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 395, in new_subsection
    node=section_node, match_titles=True)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 282, in nested_parse
    node=node, match_titles=match_titles)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 195, in run
    results = StateMachineWS.run(self, input_lines, input_offset)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/statemachine.py", line 239, in run
    context, state, transitions)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/statemachine.py", line 460, in check_line
    return method(match, context, next_state)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 2726, in underline
    self.section(title, source, style, lineno - 1, messages)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 327, in section
    self.new_subsection(title, lineno, messages)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 395, in new_subsection
    node=section_node, match_titles=True)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 282, in nested_parse
    node=node, match_titles=match_titles)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 195, in run
    results = StateMachineWS.run(self, input_lines, input_offset)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/statemachine.py", line 239, in run
    context, state, transitions)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/statemachine.py", line 460, in check_line
    return method(match, context, next_state)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 2299, in explicit_markup
    nodelist, blank_finish = self.explicit_construct(match)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 2311, in explicit_construct
    return method(self, expmatch)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 2054, in directive
    directive_class, match, type_name, option_presets)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 2103, in run_directive
    result = directive_instance.run()
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/sphinx/ext/autodoc.py", line 1613, in run
    documenter.generate(more_content=self.content)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/sphinx/ext/autodoc.py", line 963, in generate
    self.document_members(all_members)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/sphinx/ext/autodoc.py", line 855, in document_members
    if cls.can_document_member(member, mname, isattr, self)]
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/sphinx/ext/autodoc.py", line 1458, in can_document_member
    isdatadesc = isdescriptor(member) and not \
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/sphinx/util/inspect.py", line 101, in isdescriptor
    if hasattr(safe_getattr(x, item, None), '__call__'):
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/sphinx/util/inspect.py", line 113, in safe_getattr
    if name in obj.__dict__:
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/werkzeug/local.py", line 343, in __getattr__
    return getattr(self._get_current_object(), name)
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/werkzeug/local.py", line 302, in _get_current_object
    return self.__local()
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/flask/globals.py", line 37, in _lookup_req_object
    raise RuntimeError(_request_ctx_err_msg)
RuntimeError: Working outside of request context.

This typically means that you attempted to use functionality that needed
an active HTTP request.  Consult the documentation on testing for
information about how to avoid this problem.

Exception occurred:
  File "/home/alyosha/.virtualenvs/quizApp-new/lib/python2.7/site-packages/flask/globals.py", line 37, in _lookup_req_object
    raise RuntimeError(_request_ctx_err_msg)
RuntimeError: Working outside of request context.

This typically means that you attempted to use functionality that needed
an active HTTP request.  Consult the documentation on testing for
information about how to avoid this problem.
The full traceback has been saved in /tmp/sphinx-err-iI83eY.log, if you want to report the issue to the developers.
Please also report this if it was a user error, so that a better error message can be provided next time.
A bug report can be filed in the tracker at <https://github.com/sphinx-doc/sphinx/issues>. Thanks!
make: *** [Makefile:53: html] Error 1
```

It looks like something weird is going on at import time with `current_app`. I'm not 100% sure if this is a sphinx error or flask error, but I'm leaning towards flask.

I made the following example to reproduce it.

https://github.com/PlasmaSheep/sphinx-error

Instructions for running it are in the `README.md` file.

Dependency was added for the ext migration script in #1342 but now that we've moved the script to its own [repo](https://github.com/pallets/flask-ext-migrate), Redbaron is no longer a dependency for the main repo.

See also https://github.com/pallets/flask/pull/1627

With current newest version (Flask 0.11.1), there is a issue with py2exe (0.6.9).
It may be caused by flask.cli module (click 6.6).
**Flask 0.10.1 has not this issue.**

A simplest flask script named test_flask.py:

```
from flask import Flask
app = Flask(__name__)

@app.route("/")
def hello():
    return "Hello World!"

if __name__ == "__main__":
    app.run()
```

Use this py2exe script to make a test_flask.exe:

```
import sys
import py2exe
from distutils.core import setup

sys.argv.append('py2exe')

setup(
    options={
        'py2exe':
        {
            'bundle_files': 1,
        }
    },
    console=[{'script': 'test_flask.py'}],
)
```

**When execute test_flask.exe, get these:**
Traceback (most recent call last):
  File "test_flask.py", line 1, in <module>
  File "zipextimporter.pyc", line 82, in load_module
  File "flask__init__.pyc", line 21, in <module>
  File "zipextimporter.pyc", line 82, in load_module
  File "flask\app.pyc", line 27, in <module>
  File "zipextimporter.pyc", line 82, in load_module
  File "flask\cli.pyc", line 17, in <module>
  File "zipextimporter.pyc", line 82, in load_module
  File "click__init__.pyc", line 18, in <module>
  File "zipextimporter.pyc", line 82, in load_module
  File "click\core.pyc", line 7, in <module>
  File "zipextimporter.pyc", line 82, in load_module
  File "click\types.pyc", line 4, in <module>
  File "zipextimporter.pyc", line 82, in load_module
  File "click_compat.pyc", line 530, in <module>
  File "zipextimporter.pyc", line 82, in load_module
  File "click_winconsole.pyc", line 23, in <module>
  File "ctypes__init__.pyc", line 378, in **getattr**
  File "ctypes__init__.pyc", line 383, in **getitem**
AttributeError: function 'PyObject_GetBuffer' not found

My **pip list**:
alabaster (0.7.9)
Babel (2.1.1)
beautifulsoup4 (4.4.1)
blinker (1.4)
cffi (1.7.0)
click (6.6)
colorama (0.3.3)
cryptography (1.4)
cx-Oracle (5.2)
cycler (0.10.0)
Cython (0.24)
demjson (2.2.4)
docutils (0.12)
ecdsa (0.13)
enum34 (1.1.6)
erequests (0.4.1)
et-xmlfile (1.0.1)
eventlet (0.19.0)
Fabric (1.11.1)
Flask (0.11.1)
Flask-SocketIO (2.5)
greenlet (0.4.10)
idna (2.1)
ipaddress (1.0.16)
itsdangerous (0.24)
jdcal (1.2)
Jinja2 (2.8)
lxml (3.6.0)
MarkupSafe (0.23)
matplotlib (1.5.1)
meliae (0.4.0.final.0)
MySQL-python (1.2.5)
numpy (1.11.0)
openpyxl (2.3.5)
paramiko (2.0.2)
Pillow (3.2.0)
pip (8.1.2)
psutil (4.3.0)
py2exe (0.6.9)
pyasn1 (0.1.9)
pycparser (2.14)
pycrypto (2.6.1)
Pygments (2.0.2)
pymssql (2.0.1)
pyodbc (3.0.7)
pyparsing (2.1.4)
pyserial (2.5rc2)
python-dateutil (2.5.3)
python-engineio (0.9.2)
python-socketio (1.4.2)
pytz (2016.4)
pywin32 (219)
requests (2.10.0)
setuptools (25.1.0)
six (1.10.0)
snowballstemmer (1.2.0)
Sphinx (1.3.1)
sphinx-rtd-theme (0.1.9)
SQLAlchemy (1.0.8)
Twisted (16.3.0)
virtualenv (15.0.2)
Werkzeug (0.11.10)
XlsxWriter (0.8.7)
xlwt (1.1.2)
zope.interface (4.2.0)


Just noticed Logbook 1.0 was released a month ago, and was reminded of discussion about it on the mailing list (e.g. http://librelist.com/browser/flask/2011/12/28/flask-+-logbook/). Armin mentioned his desire to add Logbook integration to Flask in that 5-year-old thread, but I didn't see any mention of it here in the tracker, so I figured I'd open a ticket. If that's no longer the intention please close, but either way looking forward to finding out the latest plans.

see the test

running py.test on the tests folder, I get a few failures

test_safe_join and test_safe_join_exceptions both fail.
The first one fails with a 'TypeError: safe_join() missing 1 required positional argument: 'filename'
The second fails with a 'TypeError: safe_join() takes 2 positional arguments but 3 were given'

Also

test_send_file_last_modified fails. 
'rv.last_modified' is None. Hence, 'assert rv.last_modified == datetime.datetime(1999,1,1,0,0) fails

I'm somewhat of a amatuer programmer so maybe it's just me :)

# There should be two `__init__.py` files in the layout example, one under the folder "blueprints" and the other one under folder "admin".

like this:

```
yourpackage/
    blueprints/
        admin/
            templates/
                admin/
                    index.html
                __init__.py
            __init__.py
```

However, I think this might confuse people about which folder each `__init__.py` is in.

So, I think put the slash at front can make the example easier to understand.

Updated abort function in api.rst, to document the ability to use
args and kwargs for HTTPException. Forwarding the rest of the arguments to the exception was not documented, even when it is possible by abort (Aborter).

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/1960)

<!-- Reviewable:end -->

Locally(within the cloud instance ) being able to create the server and access from browser using localhost.But when trying to access the flask application outside the instance it fails to connect.The port used was 8217.So I created another server on Nodejs on the same port and then the node application is accessible outside the instance with the public IP. Also to ensure I thought that the problem might be only with my python,so to validate it I tried creating a naked server using HTTPServer and it worked fine. Not sure what is going wrong here.Any  help?

Hi, I'm new to flask, and just wonder if flask could support editing the settings on admin and hot reload as a feature, like the django-constance worked.

Thx.

Hi, I'm new to flask, and just wonder if flask could support editing the settings on admin and hot reload, like the django-constance worked.

Thx.

Update allowed_file function to accept lowercase and uppercase file extensions.

When `app.config["SERVER_NAME"]` contains an explicit port of 80 (i.e. `domain.tld:80`) the flask test client fails to process get urls at subdomains.  There are three test cases:
1. Explicit port 80 in SERVER_NAME: All subdomain requests redirect to 404 in test client.
2. Implicit port 80 in SERVER_NAME: Subdomain requests work.
3. Explicit port that is not 80: Subdomain requests work if the port is provided correctly.

[Example gist located here.](https://gist.github.com/CorneliaXaos/9e4fa46f442f72fc5bff07ffedace397)

More information at [this Stack Overflow post.](http://stackoverflow.com/questions/38363885/)

Python Version: 3.5.1+
Output of `pip3 freeze`:

> click==6.6
> Flask==0.11.1
> itsdangerous==0.24
> Jinja2==2.8
> MarkupSafe==0.23
> Werkzeug==0.11.10

- Related to #1945
- Re-works minitwit to be installed and run as:
  
  pip install --editable .
  export FLASK_APP=minitwit.minitwit
  export FLASK_DEBUG=1
  flask initdb
  flask run
- added flaskr and minitwit to norecursedirs
  - tests not properly run when using pytest standards
  - see: http://stackoverflow.com/questions/38313171/configuring-pytest-with-installable-examples-in-a-project
- Both flaskr and minitwit now follow pytest standards.
- Tests can for them as `py.test` or `python setup.py test`

- Related to #1945
- Re-works minitwit to be installed and run as:
  
  pip install --editable .
  export FLASK_APP=minitwit.minitwit
  export FLASK_DEBUG=1
  flask initdb
  flask run
- added flaskr and minitwit to norecursedirs
  - tests not properly run when using pytest standards
  - see: http://stackoverflow.com/questions/38313171/configuring-pytest-with-installable-examples-in-a-project
- Both flaskr and minitwit now follow pytest standards.
- Tests can for them as `py.test` or `python setup.py test`

I am using Flask-paginate for pagination in my app. The results are fetched from database. The problem is that all results show up on 1st page and when I click on the next page number again all results are displayed on that page. The page number in url changes to 2/3/4 etc. I [this](https://pythonhosted.org/Flask-paginate/) as reference. Here is my code snippet

```
from flask.ext.paginate import Pagination
    @app.route('/users')
    def users_page():

        page_size = 25
        limit = 100

        search = False
        q = request.args.get('q')
        if q:
            search = True
        try:
            page = int(request.args.get('page', 1))
        except ValueError:
            page = 1
        with session_scope() as session:
            users = users_dao.get_users(session, limit=limit)
            pagination = Pagination(page=page, total=len(users), per_page=page_size, search=search, record_name='users')
            return render_template("users.html", users=users, pagination=pagination)
```

The pagination info on html page says `displaying 1-25 results of 100`. When clicked on page 2, it says `displaying 25-50 results of 100`. So somehow the pagination has figured out on the basis of total and per_page how many results should be displayed but somewhere it fails to force that on number of rows to show.

The template looks like 

```
{{ pagination.info }}
    <table class="table">
        <thead>
            <tr>
                <th>User Name</th>
                <th>Phone</th>
                <th>City</th>
                <th>Country</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.user_name }}</td>
                <td>{{ user.phone_number }}</td>
                <td>{{user.city}}</td>
                <td>{{user.country}}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {{ pagination.links }}
```

![screenshot from 2016-07-09 21-51-02](https://cloud.githubusercontent.com/assets/13125847/16709636/47f25eb0-461f-11e6-9fa5-885cba578f6b.png)
i noticed that `<li>` tag haven't closed in lines 15,18 
which is bad practice as if i put `some thing : h1> some text /h1>` in the text-area  all the other articles become h1> so big and color blue

I'll start this off by saying this may be a naive approach to what appears to be a common thread between a few recent issues (#1926, #1902, #1829). I'm attempting to solve the issue of mistyped or improperly defined app paths reaching the **import** call for the flask app server. Given the way `cli.py` is currently structured, I can't find a bulletproof way to ensure only correct paths/module names reach the import. 

If that's the case, I believe the best response is to simply catch the error and return something more descriptive than `ImportError: Import by filename is not supported.` for debugging purposes.

When following the tutorial, I could not run `$ flask initdb`. 

```
Traceback (most recent call last):
  File "/Users/dvf/environments/flaskTutorial/bin/flask", line 11, in <module>
    sys.exit(main())
  File "/Users/dvf/environments/flaskTutorial/lib/python2.7/site-packages/flask_cli/cli.py", line 502, in main
    cli.main(args=args, prog_name=name)
  File "/Users/dvf/environments/flaskTutorial/lib/python2.7/site-packages/flask_cli/cli.py", line 369, in main
    return AppGroup.main(self, *args, **kwargs)
  File "/Users/dvf/environments/flaskTutorial/lib/python2.7/site-packages/click/core.py", line 696, in main
    rv = self.invoke(ctx)
  File "/Users/dvf/environments/flaskTutorial/lib/python2.7/site-packages/click/core.py", line 1055, in invoke
    cmd_name, cmd, args = self.resolve_command(ctx, args)
  File "/Users/dvf/environments/flaskTutorial/lib/python2.7/site-packages/click/core.py", line 1094, in resolve_command
    cmd = self.get_command(ctx, cmd_name)
  File "/Users/dvf/environments/flaskTutorial/lib/python2.7/site-packages/flask_cli/cli.py", line 340, in get_command
    rv = info.load_app().cli.get_command(ctx, name)
  File "/Users/dvf/environments/flaskTutorial/lib/python2.7/site-packages/flask_cli/cli.py", line 226, in load_app
    rv = locate_app(self.app_import_path)
  File "/Users/dvf/environments/flaskTutorial/lib/python2.7/site-packages/flask_cli/cli.py", line 90, in locate_app
    __import__(module)
ImportError: No module named flaskr
```

This was fixed by changing the environment variable to:

```
export FLASK_APP=flaskr.py
```

On OS X 10.11.3 and Python 2.7.12

It says [in the documentation](http://flask.pocoo.org/docs/0.11/deploying/mod_wsgi/) (the last section - "Working with Virtual Environments"):

> For Python 3 add the following lines to the top of your .wsgi file:
> 
> ```
> activate_this = '/path/to/env/bin/activate_this.py'
> with open(activate_this) as file_:
>     exec(file_.read(), dict(__file__=activate_this))
> ```

However `activate_this.py` is no longer present in pyvenv (see http://bugs.python.org/issue21496), thus the above code doesn't work. I found a stackoverflow answer where it said that just copying `activate_this.py` from a 2.7 virtualenv might work, however I didn't go down that route.

How I managed to get it working:

I added `WSGIPythonHome /path/to/env` to the top level of my apache config (ie. outside of VirtualEnv). However that might be a little to big of a hammer if people want to run multiple applications in the same Apache instance. In that case setting `python-path` on `WSGIDaemonProcess` might work (however I didn't try it out).

From the Mozilla site:
["The persona.org service is shutting down. This service will be unavailable after November 30th, 2016"](https://wiki.mozilla.org/Identity/Persona_Shutdown_Guidelines_for_Reliers#Why_is_persona.org_being_shut_down.3F)

Added 127.0.0.0/8 IP range to the expression which checks whether the session cookie domain is 'localhost' in the method `get_cookie_domain`.

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/1946)

<!-- Reviewable:end -->

Updates the flaskr example, as well as the tutorial docs, for consistency. I tested that following the docs linearly works as expected. 


In a forum app I am working on, I have found that this works (in a template):
`{% set lastpost=thread.dataValues.Comments[latest] %}`
`Last post on {{ lastpost.datetime.toLocaleString() }}`

However, if I try to combine it into one line, like so:
`{{ thread.dataValues.Comments[latest].datetime.toLocaleString() }}`
it results in
`TypeError: Method invoked on an object that is not Date.
   at toLocaleString (native)
   at eval (eval at <anonymous> (/home/ubuntu/workspace/node_modules/swig/lib/swig.js:498:13), <anonymous>:79:2009)
   at Object.exports.each (/home/ubuntu/workspace/node_modules/swig/lib/utils.js:45:11)
   at eval (eval at <anonymous> (/home/ubuntu/workspace/node_modules/swig/lib/swig.js:498:13), <anonymous>:50:10)
   at Object.eval [as tpl] (eval at <anonymous> (/home/ubuntu/workspace/node_modules/swig/lib/swig.js:498:13), <anonymous>:95:3)
   at compiled (/home/ubuntu/workspace/node_modules/swig/lib/swig.js:619:18)
   at /home/ubuntu/workspace/node_modules/swig/lib/swig.js:559:20
   at /home/ubuntu/workspace/node_modules/swig/lib/swig.js:690:9
   at FSReqWrap.readFileAfterClose [as oncomplete] (fs.js:380:3)`

Additionally, attempting to do 
`{{ typeof(thread.dataValues.Comments[latest].datetime) }}`
results in
`Error: SyntaxError: Unexpected token !== in file /home/ubuntu/workspace/static/topic.html.
   at Object.exports.throwError (/home/ubuntu/workspace/node_modules/swig/lib/utils.js:183:9)
   at precompile (/home/ubuntu/workspace/node_modules/swig/lib/swig.js:505:13)
   at compile (/home/ubuntu/workspace/node_modules/swig/lib/swig.js:606:16)
   at /home/ubuntu/workspace/node_modules/swig/lib/swig.js:684:27
   at FSReqWrap.readFileAfterClose [as oncomplete] (fs.js:380:3)`

Incorporates @ThiefMaster's response to #1935 in the blueprint documentation.  If this isn't clear enough or is inaccurate I'll be happy to do some research and rewrite.

Also, I'm a first time contributor, if I've failed to follow a protocol somewhere please let me know.

I have the following Flask app running in a Stage server, and I realized that some requests were affecting its operation, causing Tracebacks and with this, the Flask app was still running as a process, but not answering any sort of request, neither giving a kind of Internal Server Error (5xx).

Here is my code:

``` python
#!/usr/bin/python
# -*- coding: utf-8 -*-

from flask import Flask, jsonify
from flask_limiter import Limiter
from flask_limiter.util import get_remote_address

app = Flask(__name__)
app.config['JSON_AS_ASCII'] = False

limiter = Limiter (
    app,
    key_func=get_remote_address,
    global_limits=["180 per day","30 per hour"]
)

@app.after_request
def server_response(response):
    response.headers["Server"] = "WS"
    return response

@app.route('/json')
def f_json():

    d = { "result":[
                {"id":"1","name":"John","email":"john-flask@gmail.com"},
                {"id":"2","name":"NIkolas","email":"nikolas-flask@gmail.com"},
        {"id":"3","name":"Samanta","email":"samanta-flask@gmail.com"}
    ]}
    return jsonify(d)

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=80, debug=True)
```

Here is what I found in the debug, which caused the Traceback (and Flask was still running, but not answering any request).

```
191.96.249.231 - - [30/Jun/2016 19:11:47] "GET /plugins/system/plugin_googlemap2/plugin_googlemap2_proxy.php?url=http://191.96.249.231/shodanhq HTTP/1.0" 404 -
Exception in thread Thread-2:
Traceback (most recent call last):
  File "/usr/lib/python2.7/threading.py", line 810, in __bootstrap_inner
    self.run()
  File "/usr/lib/python2.7/threading.py", line 763, in run
    self.__target(*self.__args, **self.__kwargs)
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 659, in inner
    srv.serve_forever()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 499, in serve_forever
    HTTPServer.serve_forever(self)
  File "/usr/lib/python2.7/SocketServer.py", line 238, in serve_forever
    self._handle_request_noblock()
  File "/usr/lib/python2.7/SocketServer.py", line 297, in _handle_request_noblock
    self.handle_error(request, client_address)
  File "/usr/lib/python2.7/SocketServer.py", line 295, in _handle_request_noblock
    self.process_request(request, client_address)
  File "/usr/lib/python2.7/SocketServer.py", line 321, in process_request
    self.finish_request(request, client_address)
  File "/usr/lib/python2.7/SocketServer.py", line 334, in finish_request
    self.RequestHandlerClass(request, client_address, self)
  File "/usr/lib/python2.7/SocketServer.py", line 649, in __init__
    self.handle()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 216, in handle
    rv = BaseHTTPRequestHandler.handle(self)
  File "/usr/lib/python2.7/BaseHTTPServer.py", line 340, in handle
    self.handle_one_request()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 251, in handle_one_request
    return self.run_wsgi()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 193, in run_wsgi
    execute(self.server.app)
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 184, in execute
    write(data)
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 149, in write
    self.send_response(int(code), msg)
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 260, in send_response
    self.wfile.write(hdr.encode('ascii'))
IOError: [Errno 32] Broken pipe
```

It also happened in this situation, but I believe that "Connection Reset by Peer" was already addressed and fixed, (https://github.com/miguelgrinberg/Flask-SocketIO/issues/184), but I believe it is worth to be mentioned regarding the data which was requested to Flask (it really caught my attention...)

```
169.229.3.91 - - [29/Jun/2016 09:12:37] "0<B0>$e<AE>x<D4>^?<AB><AC>1<E8><CF>Oۚ<9C>^K@<BA><D2><FE><D4>q_^]i=AS%<D7>`I<CA>`<8F><C8>6<E5>E^SX)B<A5>-{^RoK^BT<E4><82>}O'\<BB><8B><E4>a<86>" 400 -
Exception in thread Thread-2:
Traceback (most recent call last):
  File "/usr/lib/python2.7/threading.py", line 810, in __bootstrap_inner
    self.run()
  File "/usr/lib/python2.7/threading.py", line 763, in run
    self.__target(*self.__args, **self.__kwargs)
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 659, in inner
    srv.serve_forever()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 499, in serve_forever
    HTTPServer.serve_forever(self)
  File "/usr/lib/python2.7/SocketServer.py", line 238, in serve_forever
    self._handle_request_noblock()
  File "/usr/lib/python2.7/SocketServer.py", line 297, in _handle_request_noblock
    self.handle_error(request, client_address)
  File "/usr/lib/python2.7/SocketServer.py", line 295, in _handle_request_noblock
    self.process_request(request, client_address)
  File "/usr/lib/python2.7/SocketServer.py", line 321, in process_request
    self.finish_request(request, client_address)
  File "/usr/lib/python2.7/SocketServer.py", line 334, in finish_request
    self.RequestHandlerClass(request, client_address, self)
  File "/usr/lib/python2.7/SocketServer.py", line 649, in __init__
    self.handle()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 216, in handle
    rv = BaseHTTPRequestHandler.handle(self)
  File "/usr/lib/python2.7/BaseHTTPServer.py", line 340, in handle
    self.handle_one_request()
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 247, in handle_one_request
    self.raw_requestline = self.rfile.readline()
IOError: [Errno 104] Connection reset by peer
```

I believe that it would be interesting to have a kind of "recovery" for Flask, or a better way to deal with it, without staying hanged..



In our webapp, we deploy on a unix socket.  We'd like to be able to do the same while debugging (since nginx etc. is already configured to handle that).

Setting FLASK_APP to flaskr/minitwit as instructed in the README will cause an import error.

I just had this bug on my application, let me give you this example:

``` python
class SingleObjectMixin(object):
    def get_object(self):
        # implementation detail

class ShowView(SingleObjectMixin, MethodView):
    def get(self):
        return self.render_response(obj=self.get_object())

class DeleteView(SingleObjectMixin, MethodView):
    def delete(self):
        orm.delete(self.get_object())
        return self.redirect_to_list()

class ShowDeleteView(ShowView, DeleteView):
    pass
```

Because the metaclass for `MethodView` defines a `methods` property on each view, inheriting from two `MethodView` doesn't combine the supported methods.

Right now you have to do:

``` python
class ShowDeleteView(ShowView, DeleteView):
    methods = ['GET', 'DELETE']
```

which is explicit, but which I think is not how `MethodView` was intended to work.

Of course this fix, does allows you to inherit from two `MethodView` and override the supported methods.
follow the guide on doc
http://flask.pocoo.org/docs/0.11/blueprints/

```
@simple_page.errorhandler(404)
def page_not_found(e):
    return jsonify(result=result)
```

flask version is 0.11.1
still render the offcial 404 page.


From flask-restful/flask-restful#163.

This typo got introduced in 5da1fc22153032923b1560a34a0f346d6517a12d,
the original commit for the url_value_preprocessor decorator.


Update from origin

If the `Content-Type` header is "application/json" but the `data` is a _number_ then it raises a TypeError instead of a `BadRequest`

``` python
        from flask.ext.restful import reqparse, inputs
        from flask import request
        import flask
        app = flask.Flask(__name__)
        with app.test_request_context(method="post", data=b"123", content_type="application/json"):
            parser = reqparse.RequestParser()
            parser.parse_args()
```

Change the `data` from `b"123"` to `b"abc"` and you get the expected error

This got dropped during the cli simplification.  Re: #1679

As per issue #1919, documentation for installing **virtualenv** via **easy_install** has been successfully removed from **docs/installation.rst** file.

If the path specified in `FLASK_APP` does not exist (for example it is a typo), then the unhelpful error message is shown:

```
ImportError: Import by filename is not supported.
```

This is even though I have:

```
FLASK_APP=alex/server2.py
```

which is "path-like" and not module like.

Perhaps [this line](https://github.com/pallets/flask/blob/cd1a9b7d545a9566b6d8ab861572f2e80c67916e/flask/cli.py#L106) should be modified to return `True` for file-like objects.

Addresses #1902 

Makes the flaskr app easier to run, ex. workflow:
- pip install --editable .
- export FLASK_APP=flaskr.flaskr
- flask initdb
- flask run

Testing is also easier now:
- python setup.py test

I would like to request adding a **Next/Back** Button at the end of each page within the official documentation. Once you get to the end of the document you have to scroll all the way back up to the very top of the page and go to the next article. I think it would be much nicer to have this feature and the documentation would flow much better. 

I've encountered an issue while migrating one of our Flask apps from Python 2 to Python 3.

Consider the canonical sessions example, with one minor tweak which forces a Python 2 ascii string into the session:

```
from flask import Flask, session, redirect, url_for, escape, request

app = Flask(__name__)

@app.route('/')
def index():
    if 'username' in session:
        return 'Logged in as %s' % escape(session['username'])
    return 'You are not logged in'

@app.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'POST':
        session['username'] = str(request.form['username'])
        return redirect(url_for('index'))
    return '''
        <form action="" method="post">
            <p><input type=text name=username>
            <p><input type=submit value=Login>
        </form>
    '''

@app.route('/logout')
def logout():
    # remove the username from the session if it's there
    session.pop('username', None)
    return redirect(url_for('index'))

# set the secret key.  keep this really secret:
app.secret_key = 'A0Zr98j/3yX R~XHH!jmN]LWX/,?RT'
```

Run that app on Python 2, log in as 'jaraco', then run the app on Python 3 and refresh the `/` resource, and you'll get a response with this text:

```
Logged in as b'jaraco'
```

The value has been typecast into bytes as a result of the TaggedJSONSerializer. This bytes value then wreaks havoc when text strings are expected.

I imagine three possible ways to deal with this issue:
1. Rewrite the applications such that they ensure that all text values are stored as unicode even on Python 2.
2. Rewrite the TaggedJSONSerializer to only b64 encode bytes values on Python 3, but provide a hook so that if Python 2 consumers still want to encode to bytes, they can wrap the values in a special class that indicates bytes (similar to how MongoDB provides bson.Binary) which will be treated the same as bytes on Python 3.
3. Rewrite the applications such that when consuming session values, any binary values found for text strings are decoded.

Option 3 seems like a hack around the symptom, addressing the output and not the underlying issue, so I'm dismissing that out of hand.

Option 1 seems the cleanest, though a lot of work for potentially a lot of applications.

Option 2 seems the most robust, but has backward-compatibility concerns. On the whole, though, I expect it will save users a great deal of time and trouble as they upgrade from Python 2 to 3. I expect that most users of Flask when storing Python 2 `str` values in the session are actually intending to be storing text and not binary bytes, and this option honors that expectation while providing a solution for consumers that might need to intentionally store binary values.

What's your recommendation? Would Flask consider a PR to implement Option 2? Is there another option I'm not considering?

The docs here seem to be out of date
http://flask.pocoo.org/docs/0.10/patterns/methodoverrides/

The example code throws a `TypeError: 'type' object is not iterable` on almost every request since updating to version .11

'be' was omitted

Fix for #1919 

As pointed out in #1915, http://flask.pocoo.org/docs/0.11/installation/ mentions both `pip` and `easy_install`. 

`pip` seems to be the canonical way to manage packages these days, so I vote we drop `easy_install` from the install docs.

Fix for #1915 


Flask (through itsdangerous) prefers simplejson over the built-in json module if it is installed.  The documentation should say that simplejson is an optional dependency and why using it is preferred but not required.
- #1911
- #1602
- https://botbot.me/freenode/pocoo/msg/68108854/

In the upgrade docs, `easy_install` is listed as the example to use to upgrade: 
http://flask.pocoo.org/docs/0.11/upgrading/

But in the installation docs, both `pip` and `easy_install` are listed, though `pip` is used more and is recommended:
http://flask.pocoo.org/docs/0.11/installation/

I would recommend the upgrading section be switched to use `pip`.



Reverts pallets/flask#1811

[This code](https://github.com/pallets/flask/blob/c5900a1adf8e868eca745225f3cf32218cdbbb23/flask/json.py#L23) is always import error.
(`simplejson` is not included in the `itsdangerous`.)
See: https://github.com/pallets/itsdangerous/blob/master/itsdangerous.py

When Flask app debugging is enabled (app.debug==True), and Jinja2
template auto-reloading is not explicitly disbaled, template
auto-reloading should be enabled.

If the app is instantiated, the jinja_env object is accessed (thereby
initialising the Jinja2 environment) and the server is then started with
app.run(debug=True), template auto-reloading is _not_ enabled.

This is because reading the jinja_env object causes the environment
initialisation function to set auto_reload to app.debug (which isn't yet
True). Calling app.run(debug=True) should correct this in order to
remain consistent with Flask code reloading (which is enabled within
app.run() if debug == True).

fix pypy3-3.3 have error

  File "/opt/pypy3/site-packages/flask/**init**.py", line 21, in <module>
    from .app import Flask, Request, Response
  File "/opt/pypy3/site-packages/flask/app.py", line 24, in <module>
    from .helpers import _PackageBoundObject, url_for, get_flashed_messages, \
  File "/opt/pypy3/site-packages/flask/helpers.py", line 42, in <module>
    from ._compat import string_types, text_type
  File "/opt/pypy3/site-packages/flask/_compat.py", line 82, in <module>
    raise AssertionError()
  File "/opt/pypy3/site-packages/flask/_compat.py", line 78, in __exit__
    sys.exc_clear()
AttributeError: 'module' object has no attribute 'exc_clear'

The `TaggedJSONSerializer` used for session serialization is rather smart when it comes to preserving types that usually cannot be JSON-encoded. However, it still has the problem that dict keys are converted to strings.

```
>>> from flask.sessions import TaggedJSONSerializer
>>> tj = TaggedJSONSerializer()
>>> tj.loads(tj.dumps({123: u'blah'}))
{u'123': u'blah'}
```

I think it would make sense to also tag the key here:

```
elif isinstance(value, dict):
    return dict((k, _tag(v)) for k, v in iteritems(value))
```

The one drawback I see is that there could be code relying on the implicit conversion right now..

When enabling debug mode via `app.run(debug=True)`, code changes result in an auto-reload but Jinja templates are cached until the app is manually is restarted.

At https://github.com/pallets/flask/blob/21d595bee73e65a28201709bd1a8b97c42aff5d2/flask/app.py#L695 Flask checks if the `config["TEMPLATE_AUTO_RELOAD"]` is explicitly set. If not, Jinja's `options["auto_reload"]` is set to `app.debug`.

However, if you instantiate your Flask object _then_ call `app.run(debug=True)` without loading a config, template auto reloading is not enabled (`app.debug` was `False` when the Flask app was instantiated).

At https://github.com/pallets/flask/blob/21d595bee73e65a28201709bd1a8b97c42aff5d2/flask/app.py#L839 we enable reloading code and enable the debugger. My proposed fix would be to also enable template reloading (`jinja_env.auto_reload = self.debug`) here.

This would result is less confusion ("Debug is enabled but my templates don't auto reload") and make the template reloading behaviour consistent with the code reloading behaviour ("If no config is set or `debug` is not explicitly set in config, and the site calls `app.run(debug=True)`, then enable the relevant auto reloading features").

The `get_cookie_domain` function specifically fixes issues with webkit browsers by doing this:

``` python
# https://github.com/pallets/flask/blob/0.11.1/flask/sessions.py#L198-222
if rv == '.localhost':
    rv = None
```

The problem is that nowadays many people are using Docker and other techniques (Vagrant, etc.) to create a better development environment so they are no longer running Flask on `localhost`.

In Docker's case, you'd likely end up with an IP address based host name which means you'd set your `SERVER_NAME` to something like `192.168.99.100`.

At this point Chrome and other webkit based browsers will freak out by reject setting the cookie which in turn will make your Flask app throw CSRF token related issues when submitting forms.

Since Flask is already hard coding a fix for this, I think you should allow users to configure which domain name gets skipped with a proper config option.

This could be named something like `SESSION_COOKIE_IGNORE_DOMAIN` (feel free to improve the name :)). It could default to localhost so that it's backwards compatible and nothing changes for most users.

Right now the work around is to modify your `/etc/hosts` file to map an IP address to a FQDN with a TLD if you're stuck using an IP based `SERVER_NAME`. That seems a little lame and preventable at the Flask level.

What do you think?

Hi,

On the **A Minimal Application** under Quickstart, you have code for a minimal Flask implementation, although it should be added the app.run so it can actually run the app, and load the server.
This is the form for applications that are connected to a WSGI server, which I believe beginners won't be doing that as one of their first steps.

Another minor correction, is on **URL Building** also under Quickstart, it has:
print url_for('profile', username='John Doe')
I believe should be : print url_for('user', username='John Doe')

My code is simple copy paste from tutorial:

```
from flask import Flask
app = Flask(__name__)
app.debug = True
app.use_reloader=True

@app.route("/proxy/list/<access_id>")
def proxy(access_id):
    return "Hello World  {}".format(access_id)

if __name__ == "__main__":
    app.run(debug=True)
```

then i made a change:
`return "Hello World  {} something else".format(access_id)`

nothing reloaded!

We are getting below error when building `flask-mongoengine` with `pypy3` on travis-ci:

```
1) ERROR: Failure: AttributeError ('module' object has no attribute 'exc_clear')

 ----------------------------------------------------------------------

 Traceback (most recent call last):

.eggs/nose-1.3.7-py3.2.egg/nose/failure.py line 39 in runTest

  raise self.exc_val.with_traceback(self.tb)

.eggs/nose-1.3.7-py3.2.egg/nose/loader.py line 418 in loadTestsFromName

  addr.filename, addr.module)

.eggs/nose-1.3.7-py3.2.egg/nose/importer.py line 47 in importFromPath

  return self.importFromDir(dir_path, fqname)

.eggs/nose-1.3.7-py3.2.egg/nose/importer.py line 94 in importFromDir

  mod = load_module(part_fqname, fh, filename, desc)

tests/__init__.py line 1 in <module>

  import flask

.tox/pypy3-medev/site-packages/flask/__init__.py line 21 in <module>

  from .app import Flask, Request, Response

.tox/pypy3-medev/site-packages/flask/app.py line 24 in <module>

  from .helpers import _PackageBoundObject, url_for, get_flashed_messages, \

.tox/pypy3-medev/site-packages/flask/helpers.py line 42 in <module>

  from ._compat import string_types, text_type

.tox/pypy3-medev/site-packages/flask/_compat.py line 82 in <module>

  raise AssertionError()

.tox/pypy3-medev/site-packages/flask/_compat.py line 78 in __exit__

  sys.exc_clear()

   AttributeError: 'module' object has no attribute 'exc_clear'
```

Could this be a bug?

I'm trying to run the "flaskr" and "minitwit" examples, but I'm running into an import error issue. I'm trying to follow the instructions from the README file. When running `flask initdb`, I get the following error:

```
Traceback (most recent call last):
  File "/home/nelson/apps/miniconda/bin/flask", line 6, in <module>
    sys.exit(flask.cli.main())
  File "/home/nelson/apps/miniconda/lib/python3.4/site-packages/flask/cli.py", line 478, in main
    cli.main(args=args, prog_name=name)
  File "/home/nelson/apps/miniconda/lib/python3.4/site-packages/flask/cli.py", line 345, in main
    return AppGroup.main(self, *args, **kwargs)
  File "/home/nelson/apps/miniconda/lib/python3.4/site-packages/click/core.py", line 696, in main
    rv = self.invoke(ctx)
  File "/home/nelson/apps/miniconda/lib/python3.4/site-packages/click/core.py", line 1055, in invoke
    cmd_name, cmd, args = self.resolve_command(ctx, args)
  File "/home/nelson/apps/miniconda/lib/python3.4/site-packages/click/core.py", line 1094, in resolve_command
    cmd = self.get_command(ctx, cmd_name)
  File "/home/nelson/apps/miniconda/lib/python3.4/site-packages/flask/cli.py", line 316, in get_command
    rv = info.load_app().cli.get_command(ctx, name)
  File "/home/nelson/apps/miniconda/lib/python3.4/site-packages/flask/cli.py", line 209, in load_app
    rv = locate_app(self.app_import_path)
  File "/home/nelson/apps/miniconda/lib/python3.4/site-packages/flask/cli.py", line 89, in locate_app
    __import__(module)
ImportError: No module named 'flaskr'
```

I'm using an Anaconda Python install on both Windows 10 (Python 3.5) and Linux (Python 3.4) with either the stock flask 0.11 install or an install from the latest git repo.  I'm running this code from appropriate directory and am able to import flaskr or minitwit from a terminal Python session. I can run the other examples that do not require the flask script. 

Because [Click](http://click.pocoo.org/5/) was added to Flask 0.11 for the [New Command Line Interface](http://flask.pocoo.org/docs/0.11/cli/), and Click imports the Windows only module [msvcrt](https://docs.python.org/2/library/msvcrt.html), and the [Google App Engine local development server](https://cloud.google.com/appengine/docs/python/tools/using-local-server) doesn't contain this module, an import error is thrown.

![image](https://cloud.githubusercontent.com/assets/2013388/15935738/36ee00b6-2e1d-11e6-85a7-3b04de953659.png)

I've [created a workaround](https://github.com/gae-init/gae-init/pull/527) for the [gae-init project](https://github.com/gae-init/gae-init) (by modifying the App Engine config file), but it would be best to have a fix come directly from Flask/Click since there are likely many more people who will experience this issue when using Flask 0.11 with Google App Engine.

Researched this during the Pycon dev sprint. I think that this solution is minimally elegant to include in the docs. 

EDIT by @untitaker: Fixes #981

I have the following object: 

```
 dict(username="test",
       repository="http://github.com",
       foo=[dict(name="test", version="1.1.3")])
```

it gives the following json when dumping it: 

```
{"username": "test", "repository": "http://github.com", "foo": [{"name": "test", "version": "1.1.3"}]}
```

When sending it in a post like that:

```
self.app = mainweb.webapp.test_client()
response = self.app.post('/foo/', data=request) # where request is the object mentionned before
```

it gives the following error:

```
Traceback (most recent call last):
  File "C:\cygwin64\home\xyz\devel\foo\test\foo\functional\test_functionnal.py", line 20, in test_given_valid_request_when_post_then_valid_response
    response = self.app.post('/foo/', data=request)
  File "C:\Python3.5.1\lib\site-packages\werkzeug\test.py", line 788, in post
    return self.open(*args, **kw)
  File "C:\Python3.5.1\lib\site-packages\flask\testing.py", line 103, in open
    builder = make_test_environ_builder(self.application, *args, **kwargs)
  File "C:\Python3.5.1\lib\site-packages\flask\testing.py", line 34, in make_test_environ_builder
    return EnvironBuilder(path, base_url, *args, **kwargs)
  File "C:\Python3.5.1\lib\site-packages\werkzeug\test.py", line 338, in __init__
    self._add_file_from_data(key, value)
  File "C:\Python3.5.1\lib\site-packages\werkzeug\test.py", line 355, in _add_file_from_data
    self.files.add_file(key, **value)
TypeError: add_file() got an unexpected keyword argument 'name'
```

Is it really a bug or is the issue on my side?

Thanks!

#1710

This patch adds support for custom `JSONEncoder`, `JSONDecoder` functionality for blueprints, modeled after `Flask.json_encoder`, `Flask.json_decoder` and has minimal amount of changes. 
Still no docs or corner case tests.

```
Traceback found (redacted for relevancy to Flask):
  File "/usr/local/lib/python2.7/dist-packages/flask/__init__.py", line 21, in <module>
    from .app import Flask, Request, Response
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 27, in <module>
    from . import json, cli
  File "/usr/local/lib/python2.7/dist-packages/flask/cli.py", line 17, in <module>
    import click
ImportError: No module named click
```

Just recently upgraded from 0.10 to 0.11. Did not see a requirements.txt for 3rd party dependencies.

The commands to run a coverage report are somewhat clunky, and hard to remember.
1. `make cov` will now generate the report, display it, and save an HTML version.
2. `make test` already ensures that test dependencies are installed. This seemed clever and helpful for beginners, so I did the same for `make tox-test` and `make cov`. (Also, added `tox` and `pytest-cov` to test-requirements.txt)
3. Updated contribution guide to replace the `py.test`, `tox`, and coverage instructions with the `make` versions. Consistent/similar commands should be easier to remember? Also ensures everyone runs the same tests every time.

Apologies if I globbed too much into one PR, happy to edit if needed.

I'm using the latest version of Flask (0.11.1) and the built in dev server, with the following Blueprint:

`blueprint = Blueprint("admin", __name__, url_prefix="/admin", template_folder="templates", static_folder="static")
`
The template folder is working as expected, but any resources inside the static folder throw a **RuntimeError: Attempted implicit sequence conversion but the response object is in direct passthrough mode.**

After searching around for this error, I found the following discussion:
https://github.com/closeio/Flask-gzip/issues/7

The solution used in that third party extension was to put in place the following code on app.after_request:
`response.direct_passthrough = False`

My static content loads fine with the above. 

I was wondering if anyone has run into this issue with Blueprints and if there is a better workaround.


https://travis-ci.org/pallets/flask/jobs/135626173

``` python-traceback
Traceback (most recent call last):
  File "/home/travis/build/pallets/flask/.tox/py-devel/lib/python3.3/site-packages/werkzeug/http.py", line 26, in <module>
    from urllib2 import parse_http_list as _parse_list_header, \
ImportError: No module named 'urllib2'

During handling of the above exception, another exception occurred:
Traceback (most recent call last):
  File "/home/travis/build/pallets/flask/.tox/py-devel/lib/python3.3/site-packages/_pytest/config.py", line 320, in _importconftest
    mod = conftestpath.pyimport()
  File "/home/travis/build/pallets/flask/.tox/py-devel/lib/python3.3/site-packages/py/_path/local.py", line 650, in pyimport
    __import__(modname)
  File "/home/travis/build/pallets/flask/tests/conftest.py", line 9, in <module>
    import flask
  File "/home/travis/build/pallets/flask/.tox/py-devel/lib/python3.3/site-packages/flask/__init__.py", line 17, in <module>
    from werkzeug.exceptions import abort
  File "/home/travis/build/pallets/flask/.tox/py-devel/lib/python3.3/site-packages/werkzeug/__init__.py", line 152, in <module>
    __import__('werkzeug.exceptions')
  File "/home/travis/build/pallets/flask/.tox/py-devel/lib/python3.3/site-packages/werkzeug/exceptions.py", line 71, in <module>
    from werkzeug.wrappers import Response
  File "/home/travis/build/pallets/flask/.tox/py-devel/lib/python3.3/site-packages/werkzeug/wrappers.py", line 26, in <module>
    from werkzeug.http import HTTP_STATUS_CODES, \
  File "/home/travis/build/pallets/flask/.tox/py-devel/lib/python3.3/site-packages/werkzeug/http.py", line 29, in <module>
    from urllib.request import parse_http_list as _parse_list_header, \
ImportError: cannot import name unquote_to_bytes
```

I can't reproduce this locally.  Re-running the job still fails.

Was originally set to github.com/getsentry/sentry, which was a relative link to a page that doesn't exist. I prepended https:// to fix this problem.

Minor spelling fix.

Minor modification to make wording more concise in app context documentation as suggested by feedback from pull #1861.

Function `prepare_exec_for_file` has a side effect where a path is added to
`sys.path` list.
This commit enhances an exisiting test case for `prepare_exec_for_file`
by testing the side effect of the function and adding necessary
comments.

Mention the existence of Flask extentions that handle server-side sessions

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/1888)

<!-- Reviewable:end -->

... and fixes an awkward phrasing.

<!-- Reviewable:start -->

---

This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/pallets/flask/1887)

<!-- Reviewable:end -->

Add basic test for the endpoint decorator for the Blueprint object.

Mentioned on the API [docs](http://flask.pocoo.org/docs/0.11/api/#flask.Blueprint.endpoint): 

> ...If the endpoint is prefixed with a . it will be registered to the current blueprint, otherwise it’s an application independent endpoint.

This commit only added test for the _without-prefixed-dot_ endpoint

- Added tests for `flask.json.dump()` and `flask.json.load()`.
- Added a test to ensure that UUIDs are correctly jsonified.

Added a test for CLI `--version` command.

- README updated with link to CONTRIBUTING.rst
- CONTRIBUTING.rst has instructions on running code coverage

This commit adds a test case for `test_find_best_app` where
Module object does not contain Flask application.
Also cleans the function little bit to provides more meaningful comment.


Make it easier for folks to find our contributing docs. 

Not sure where in the main Flask docs to put this, but it would be good to add somewhere. There's been a few Pycon sprinters who tried searching our docs for the contributing info rather than looking in the source repo.

Running the unit tests against HEAD (e048aa4e19), I'm able to reproduce a single failing unit tests in:

> tests/test_instance_config.py::test_main_module_paths

I'm able to reproduce the bug on Amazon Linux 2016.03.1 and RHEL 7.2.  I'm running on a fresh EC2 instance in both cases, and the steps to reproduce are the same, here is my bash history:

> sudo yum install python-virtualenv
> sudo yum groupinstall 'Development Tools'
> virtualenv flask
> cd flask/
> git clone https://github.com/pallets/flask.git
> cd flask/
> source ../bin/activate
> pip install -e .
> pip install -r test-requirements.txt 
> py.test tests/test_instance_config.py::test_main_module_paths

failing output:

> modules_tmpdir = local('/tmp/pytest-of-ec2-user/pytest-0/test_main_module_paths0/modules_tmpdir'), purge_module = <function inner at 0x170c1b8>
> 
> ```
> def test_main_module_paths(modules_tmpdir, purge_module):
>     app = modules_tmpdir.join('main_app.py')
>     app.write('import flask\n\napp = flask.Flask("__main__")')
>     purge_module('main_app')
> 
>     from main_app import app
>     here = os.path.abspath(os.getcwd())
> ```
> 
> > ```
> >   assert app.instance_path == os.path.join(here, 'instance')
> > ```
> > 
> > E       assert '/home/ec2-us...r/py-instance' == '/home/ec2-use...lask/instance'
> > E         - /home/ec2-user/flask/var/py-instance
> > E         ?                      ^ ^ ---
> > E         + /home/ec2-user/flask/flask/instance
> > E         ?                      ^^ ^^
> 
> tests/test_instance_config.py:33: AssertionError

This test seems to be passing fine on Travis, and on Debian and OSX.  It appears to be a Redhat/Amazon Linux specific issue.  I ran `git bisect` back to commits on May 26th, 2016 and the test still fails all attempts.

...instead of custom fixture. Also assert that no warnings are left over
after the test.

I am not sure if this was an intentional change, as it is only triggered by `jsonify` by passing an iterable to `flask.wrappers.Response`/`werkzeug.wrappers.Response`.

In commit https://github.com/pallets/flask/commit/d9402fc0c03353b6d2659297682e578d695476ce a newline was added to the json response, as per a request from the httpbin project.

When `werkzeug.wrappers.Response` is passed a non text_type iterable, the `self.set_data` codepath, responsible for setting the Content-Length header, is not used anymore.

Ironcially this breaks httpbins "response-headers" route that uses the response object in a somewhat
creative way and breaks while trying to access `response.headers['Content-Length']`

If this considered a backwards incompatible change that might need to be undone, or is this considered new and intended behaviour?

Test if jsonify function raises TypeError when both args and kwargs are
passed in.

Provides a link to [Flask Extension Development](http://flask.pocoo.org/docs/0.11/extensiondev) page from [Flask Extension page](http://flask.pocoo.org/docs/0.11/extensions).
Flask Extension page talks about `finding`, `using` extensions, it might as well talk about `building` one too. Found #532 as the most relevant issue that is open.

Comment out the "versionadded" and "versionchanged" tags by adding # in
the front. The line (or block) would be considered as comments.

This is another attempt at #1856 based on #1704 (comment)

Explaining how to use `setup.cfg` to configure test builds when trying to deploy with fabric, and using `sdist`. Fixes #129 

There was a bad if/elif statement and the elif os.path ... would never get hit. So I swapped the order of those two statements and added testing for the prepare_exec_for_file function.

### Expected Behavior

There are situations in which you may want to implement a custom application runner. Two examples that I can think of are running the application under the Werkzeug profiler, and starting the application in a background thread to perform integration tests against it.

In these situations, most people would want to create a custom CLI command that calls `app.run()` to start the application after applying any necessary changes, such as enabling profiling, etc.

Example `bug.py`:

```python
from flask import Flask

app = Flask(__name__)

@app.cli.command()
def custom_run():
    app.run()
```

What I expect with the above example is that running `flask custom_run` starts the development web server.

### Actual Behavior

```
(venv) $ FLASK_APP=bug.py flask custom_run
/home/miguel/bug.py:7: Warning: Silently ignoring app.run() because the application is run from the flask command line executable.  Consider putting app.run() behind an if __name__ == "__main__" guard to silence this warning.
```

I think this warning should only appear when `app.run()` is called from the global scope of the main module. This can be determined from the number of frames in the call stack. The warning should be issued only if the call stack has two frames, but should not if there are more than two. Thoughts?


<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->


I translated it because I have not found any other translation in Korean yet.
I am sorry to bother you if it already exists.

When 'audit' was removed from setup.py, the corresponding shortcut was
left in the Makefile. This commit removes the audit shortcut from
Makefile.

Closes #2773.
When the `audit` command was removed (https://github.com/pallets/flask/commit/4fca38c078142744922a8c763bc1468e680a830d), the corresponding shortcut in `Makefile` was not deleted. 

    $ make audit
    
    error: invalid command 'audit'
    make: *** [audit] Error 1

The shortcut was never documented, so it is unlikely that anyone will use it, but still...
This code must be placed in the __init__.py as per the documentation: http://flask.pocoo.org/docs/1.0/tutorial/database/    (Section: Register with the Application)

    flaskr/__init__.py
    def create_app():
      app = ...
      # existing code omitted

    from . import db
    db.init_app(app)

    return app

----------------------------------------------

This is the __init__.py code after copying that code

    import os

    from flask import Flask

    def create_app(test_config=None):
    # create and configure the app
    app = Flask(__name__, instance_relative_config=True)
    app.config.from_mapping(
        SECRET_KEY='dev',
        DATABASE=os.path.join(app.instance_path, 'flaskr.sqlite'),
    )

    if test_config is None:
        # load the instance config, if it exists, when not testing
        app.config.from_pyfile('config.py', silent=True)
    else:
        # load the test config if passed in
        app.config.from_mapping(test_config)

    # ensure the instance folder exists
    try:
        os.makedirs(app.instance_path)
    except OSError:
        pass

    # a simple page that says hello
    @app.route('/hello')
    def hello():
        return 'Hello, World!'
   
    #database 
    from . import db
    db.init_app(app)

    return app


Expected output:

Run the init-db command:

flask init-db
Initialized the database.
There will now be a flaskr.sqlite file in the instance folder in your project.

I'm getting an error while executing the above command:
flask init-db
Usage: flask [OPTIONS] COMMAND [ARGS]...

Error: No such command "init-db".

I even tried copying the exact code from the repo https://github.com/pallets/flask/blob/746b91dfced525651c9b71a3bd075a78d2b9262f/examples/tutorial/flaskr/__init__.py
it is not working even though, same error.

Pls help me with this I'm new to flask and i'm stuck here. cannot proceed further in the documentation unless this code executes

after upgrade to flask 1.0.2, it seems not possible to direct run even the simple demo app through direct pressing F5 within idle?

but it can still be run through command "flask run" or in shell with "python demo.py"
is this normal case after upgrade?

the python shell feedback see below:

---



```python
from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello World!'

if __name__ == '__main__':
    app.run(port=80, debug=False, threaded=True)
```

### Actual Behavior

Tell us what happens instead.

```pytb
Traceback (most recent call last):
  File "C:\Users\dell\AppData\Local\Programs\Python\Python36\flasktest.py", line 9, in <module>
    app.run(port=80, debug=False, threaded=True)
  File "C:\Users\dell\AppData\Local\Programs\Python\Python36\lib\site-packages\flask\app.py", line 938, in run
    cli.show_server_banner(self.env, self.debug, self.name, False)
  File "C:\Users\dell\AppData\Local\Programs\Python\Python36\lib\site-packages\flask\cli.py", line 629, in show_server_banner
    click.echo(message)
  File "C:\Users\dell\AppData\Local\Programs\Python\Python36\lib\site-packages\click\utils.py", line 217, in echo
    file = _default_text_stdout()
  File "C:\Users\dell\AppData\Local\Programs\Python\Python36\lib\site-packages\click\_compat.py", line 621, in func
    rv = wrapper_func()
  File "C:\Users\dell\AppData\Local\Programs\Python\Python36\lib\site-packages\click\_compat.py", line 385, in get_text_stdout
    rv = _get_windows_console_stream(sys.stdout, encoding, errors)
  File "C:\Users\dell\AppData\Local\Programs\Python\Python36\lib\site-packages\click\_winconsole.py", line 261, in _get_windows_console_stream
    func = _stream_factories.get(f.fileno())
io.UnsupportedOperation: fileno
```

### Environment

* Python version: python3.6.4
* Flask version: flask1.0.2
* Werkzeug version:

added new

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Test codecov

### Expected Behavior

Only the error message / usage information being printed

### Actual Behavior

A traceback shows up above the usage information.

### Environment

* Python version: 2.7.14
* Flask version: 1.0.2
* Werkzeug version: 0.14.1


---


```
[adrian@blackhole:/tmp]> virtualenv testenv
New python executable in /tmp/testenv/bin/python2.7
Also creating executable in /tmp/testenv/bin/python
Installing setuptools, pip, wheel...done.

[adrian@blackhole:/tmp]> ./testenv/bin/pip install flask
Collecting flask
  Using cached https://files.pythonhosted.org/packages/7f/e7/08578774ed4536d3242b14dacb4696386634607af824ea997202cd0edb4b/Flask-1.0.2-py2.py3-none-any.whl
Collecting Werkzeug>=0.14 (from flask)
  Using cached https://files.pythonhosted.org/packages/20/c4/12e3e56473e52375aa29c4764e70d1b8f3efa6682bef8d0aae04fe335243/Werkzeug-0.14.1-py2.py3-none-any.whl
Collecting click>=5.1 (from flask)
  Using cached https://files.pythonhosted.org/packages/34/c1/8806f99713ddb993c5366c362b2f908f18269f8d792aff1abfd700775a77/click-6.7-py2.py3-none-any.whl
Collecting itsdangerous>=0.24 (from flask)
Collecting Jinja2>=2.10 (from flask)
  Using cached https://files.pythonhosted.org/packages/7f/ff/ae64bacdfc95f27a016a7bed8e8686763ba4d277a78ca76f32659220a731/Jinja2-2.10-py2.py3-none-any.whl
Collecting MarkupSafe>=0.23 (from Jinja2>=2.10->flask)
Installing collected packages: Werkzeug, click, itsdangerous, MarkupSafe, Jinja2, flask
Successfully installed Jinja2-2.10 MarkupSafe-1.0 Werkzeug-0.14.1 click-6.7 flask-1.0.2 itsdangerous-0.24


[adrian@blackhole:/tmp]> ./testenv/bin/flask
Traceback (most recent call last):
  File "/tmp/testenv/lib/python2.7/site-packages/flask/cli.py", line 529, in list_commands
    rv.update(info.load_app().cli.list_commands(ctx))
  File "/tmp/testenv/lib/python2.7/site-packages/flask/cli.py", line 384, in load_app
    'Could not locate a Flask application. You did not provide '
NoAppException: Could not locate a Flask application. You did not provide the "FLASK_APP" environment variable, and a "wsgi.py" or "app.py" module was not found in the current directory.
Usage: flask [OPTIONS] COMMAND [ARGS]...

  A general utility script for Flask applications.

  Provides commands from Flask, extensions, and the application. Loads the
  application defined in the FLASK_APP environment variable, or from a
  wsgi.py file. Setting the FLASK_ENV environment variable to 'development'
  will enable debug mode.

    $ export FLASK_APP=hello.py
    $ export FLASK_ENV=development
    $ flask run

Options:
  --version  Show the flask version
  --help     Show this message and exit.

Commands:
  routes  Show the routes for the app.
  run     Runs a development server.
  shell   Runs a shell in the app context.
```
### Expected Behavior
What used to happen before, i.e. on

```python
raise NotFound()
```

the test client's response.status_code should be `404`.

### Actual Behavior

It's always `500`.

### Environment

See my failing Travis CI builds:
- https://travis-ci.org/poliedro-polimi/Crowdfunding-Backend
- One of the tests that fails because of this issue: [link](https://github.com/poliedro-polimi/Crowdfunding-Backend/blob/master/tests/test_views.py#L157)
- Code that makes it fail: [link](https://github.com/poliedro-polimi/Crowdfunding-Backend/blob/master/poliedro_donate/blueprints/donations.py#L60)

* Python version: >3.5, pypy3 (not tested on other versions)
* Flask version: 1.0.2 from pypi (worked as expected in 0.12.2)
* Werkzeug version: 0.14.1

With the latest release (flask 1.0.0), unicode attachement filenames are allowed by flask.
I was waiting for this change and it seems to work great using the builtin dev server. However, gunicorn on the production server does not support `latin-1` encoding for the headers and only supports `ascii`.

Originaly flask also opted for ASCII encoding, however commit 336d6a48e0104b53302fd8377dd399af43607cf9 changed this and since then `latin-1` is used.

What was the rational to switch to `latin-1`? I know, officially it's allowed, however gunicorn decided to only support ASCII: (see related issue)

 > it's well documented around the web that HTTP headers should be ASCII

Is there a change that flask also switches back to ASCII?

Related Issues: 
- #2223
- benoitc/gunicorn#1353
- benoitc/gunicorn#1778

This is intended for custom CLIs that may load a config file which already sets the debug flag and does not make use of the `FLASK_*` env vars at all.

Filed against 1,0-maintenance since this is functionality that was present before and was lost between 0.12 and 1.0.
At the end of the installation docs we currently
point the reader back into the middle of the
installation doc itself, which is probably not very
helpful to the reader since they just finished
reading that.

Instead, point to the next section in the docs
(Quickstart).
### Expected Behaviour
When the request is over, the incoming files and JSON should be removed from memory

### Actual Behavior
The files and other request data is left in memory with no apparent way to close the objects. i have tried using the python garbage collector but that fails to find the files and other related data.

The memory is silently used up until flask is killed by the host

### Environment

* Python version: 3.6
* Flask version: 1.0.2
* Werkzeug version: 2.10

### The Problem

I have a few routes which are as follows:

```
api.auth -> /api/auth
api.user -> /api/user
         -> /api/user/<user_id>
```

Anytime I do a POST to `api.auth`, the variable rules for my routes break when I call `url_for`.

```python
# Prints `/api/user/1`
print(url_for("api.user", user_id=1))

# Login
client.post(url_for("api.auth"), json={
  "email": "test@test.com",
  "password": "password123"
})

# Prints `/api/user?user_id=1`
print(url_for("api.user", user_id=1))

# Logout
client.delete(url_for("api.auth"))

# Prints `/api/user/1`
print(url_for("api.user", user_id=1))
```

The URL lookups breaking are not a result of something in the `api.auth` views. If I call `url_for` in `post()` or `dispatch_request()` of my AuthAPI view class, it's already broken.

Calling `client.post(url_for("api.auth"), json={...})` multiple times does not undo the problem.

### Relevant Code

- The test that is failing: https://github.com/Kangaroux/Kanban/blob/master/tests/user/test_user.py#L75
- The test app and client: https://github.com/Kangaroux/Kanban/blob/master/tests/conftest.py#L39
- The full app factory: https://github.com/Kangaroux/Kanban/blob/master/config/app.py#L9

### Environment

* Python version: 3.6.5
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

Hello,
this may not be issue but please help me..

I have solved the task getting lang code in URL some weeks ago and may anyone confirm it is relevant and good for any project ? 
https://stackoverflow.com/questions/49496761/two-language-flask-site-with-or-without-blueprints

I have a problem using URLs in HTML

How is it relevant to use Blueprint URLs  in HTML ? 
for example:

    <a href="/{{sess_lang}}/home/hale/">Home</a>

I have to insert lang_code before Blueprint URL to go to the right page
or 
    `<a href="home/hale/">Home</a>`

I have to use URL without  first slash ?!


In general this Blueprint must be main blueprint but I have to develop bigger App than any simple site and need help for such configuration about URLs ..

In addition I will be getting translations from Mongodb collection and need to switch language on any page without redirecting to any other page...

**In addition can I change language without JS only with get request ? need example..**
**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](http://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior
I expect \n escape character every line of my specialized csv file but
Tell us what should happen.
it never include the \n escape character for every line of my csv when I send it to the user
```python
Paste a minimal example that causes the problem.
```
example 
foo bar
spam and egg
### Actual Behavior
foo barspam and egg
Tell us what happens instead.

```pytb
Paste the full traceback if there was an exception.
```
no trackback
### Environment

* Python version: pythonanywhere 3.6
* Flask version: 0.12
* Werkzeug version: 0.11.15

### Expected Behavior

Flask should work on subpath with proper url generation by `url_for`.
So url in example below should be: `/myapp/static/css/bootstrap.min.css`

```python
from flask import Flask
from flask.views import MethodView

class ListConsumer(MethodView):
    def get(self):
        return render_template('list.html')

app = Flask(name)
app.config['APPLICATION_ROOT'] = '/myapp'
app.add_url_rule('/', view_func=ListView.as_view('list_view'))

# list.html
# <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
```

### Actual Behavior

Actual generated URL is `/static/css/bootstrap.min.css` and this should be `/myapp/static/css/bootstrap.min.css`. Although this is when application just work.

If I add env SCRIPT_NAME=/myapp I get error: 
```
  File "/usr/local/lib/python3.6/site-packages/gunicorn/workers/sync.py", line 135, in handle
    self.handle_request(listener, req, client, addr)
  File "/usr/local/lib/python3.6/site-packages/gunicorn/workers/sync.py", line 167, in handle_request
    listener.getsockname(), self.cfg)
  File "/usr/local/lib/python3.6/site-packages/gunicorn/http/wsgi.py", line 193, in create
    path_info = path_info.split(script_name, 1)[1]
IndexError: list index out of range
```

### Environment

* Python version: 3.6.4
* Flask version: 1.0.2
* Werkzeug version: 0.14.1
When i download this project on my computer , I followed the README.rst and executed these instructions ,but i found that there was something wrong , the database wasn't initialized.

So, before you run "flask run", be sure to run "flask init-db" first.
### Expected Behavior
Print in following order:

foo
bar

```python
def foo(response):
    print("foo")
    return response
def bar(response):
    print("bar")
    return response

app = Flask(__name__)
app.after_request(foo)
app.after_request(bar)
```

### Actual Behavior
Print in following order:

bar
foo

### Environment

* Python version: 3.6.5
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

This is very counter intuitive. Is there a reason to execute reversed order? It seems like it is reversed on purpose in `process_response` in `app.py`. The order actually matters. I found out this when I apply gzip and html minifier which gzip is apply first and the minifier is unable to read the data as string.

When jinja was already set up (by having some template filters for
example), modify the jinja_env to it will take the modification into
account.
Otherwise this decorator doesn't do anything in that case

Workaround for #2755, this does not fix the config dict not being taken into account
### Synopsis

If the configuration templates_auto_reload is set up after has set up it's jinja environment (example: after setting up some filters), it is ignored by Flask

### Expected Behavior

Templates should be reloaded when app.config['TEMPLATES_AUTO_RELOAD'] is set to True

```python
# application.py
from flask import Flask, render_template

app = Flask(__name__)

@app.route('/')
def hello(name=None):
    return render_template('hello.html', name=name)

# Templates are reloaded if configuration is set up before the template filter
# app.config.update({'TEMPLATES_AUTO_RELOAD': True})

@app.template_filter('dummy')
def dummy(value):
    return value

# Setting this up here does not do anything
app.config.update({'TEMPLATES_AUTO_RELOAD': True})

# Neither does this:
app.templates_auto_reload = True

app.run()

#% python application.py
```

### Actual Behavior

The option is ignored because the jinja environment was already created

### Environment

* Python version: 3.6.5
* Flask version: 1.0.2
* Werkzeug version: 0.14.1
* debug is set to False in this case
This PR fixes problems with the generation of the PDF documentation from LaTeX files. 

First issue was a problematic emoji character in the documentation, which the LaTeX distribution used in the build process didn't understand. The least invasive fix was to replace it with a space. Alternative fixes would be removal of the character causing errors or adapting the build process.

Second issue was the missing `\ifsphinxpdfoutput` macro. In this case it was only used to check if the output is PDF, which is now handled with an appropriate if statement.

Relevant issues:
https://github.com/pallets/flask/issues/2514
https://github.com/pallets/flask-docs/issues/3
The release is incomplete without a codename so I propose to name the 1.0 release codename "Vodka" 🥂.
Fixed issue #2751.
Flask has a route for static files by default, and I disabled that by setting `static_folder` to `None`.

```python
from flask import Flask

app = Flask(__name__, static_folder=None)
```

### Expected Behavior

With the code above, I expect the output of `flask routes` to be like this:

    Endpoint  Methods  Rule
    --------  -------  -----------------------

or some message saying there is no route available.

### Actual Behavior

But it crashed instead:

```pytb
Traceback (most recent call last):
  File "/Users/timothy/.virtualenvs/sample/bin/flask", line 11, in <module>
    sys.exit(main())
  File "/Users/timothy/.virtualenvs/sample/lib/python3.6/site-packages/flask/cli.py", line 890, in main
    cli.main(args=args, prog_name=name)
  File "/Users/timothy/.virtualenvs/sample/lib/python3.6/site-packages/flask/cli.py", line 557, in main
    return super(FlaskGroup, self).main(*args, **kwargs)
  File "/Users/timothy/.virtualenvs/sample/lib/python3.6/site-packages/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/Users/timothy/.virtualenvs/sample/lib/python3.6/site-packages/click/core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/Users/timothy/.virtualenvs/sample/lib/python3.6/site-packages/click/core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/Users/timothy/.virtualenvs/sample/lib/python3.6/site-packages/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/Users/timothy/.virtualenvs/sample/lib/python3.6/site-packages/click/decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/Users/timothy/.virtualenvs/sample/lib/python3.6/site-packages/flask/cli.py", line 412, in decorator
    return __ctx.invoke(f, *args, **kwargs)
  File "/Users/timothy/.virtualenvs/sample/lib/python3.6/site-packages/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/Users/timothy/.virtualenvs/sample/lib/python3.6/site-packages/flask/cli.py", line 841, in routes_command
    max(len(rule.endpoint) for rule in rules),
ValueError: max() arg is an empty sequence
```

### Environment

* Python version: 3.6.3
* Flask version: 1.0.1
* Werkzeug version: 0.14.1

Hello,
on https://pypi.org/project/Flask/ `issue tracker` and `code` links in the left menu are pointing to `https://github.com/pallets/pallets-sphinx-themes/issues` not `https://github.com/pallets/flask/issues`.

![screenshot from 2018-05-02 09-00-17](https://user-images.githubusercontent.com/943762/39509638-44544f30-4de7-11e8-8a03-c750c072e151.png)

Trivial change

1. url_prefix = '/posts'
2. rule = ''

Expected result `/posts`, instead got `/posts/`.
Describe what this patch does to fix the issue. - It improves the docs by adding the missing port.

Link to any relevant issues or pull requests. - no extra stuff, just used this for my class's material, discovered while live-coding (copying and pasting).


closes #2742

Fix `url_prefx=''` or `url_prefix='/'` when Blueprint routes don't begin with a leading slash. Technically, routes should start with a leading slash, so don't rely on this behavior.
- Fixes the syntax error on the quickstart doc by escaping the single quote.
- Adds request import and removes duplicated word
I have a Flask app to display profiles based on LDAP data. After updating to 1.0 I'm having crashes when loading the data. Running the app with ```threaded=False``` works, but I'd like to have threads.

---

### Expected Behavior

The app would pull an image from the LDAP server and return it to the client. It would be displayed in HTML.

```python
@app.route("/image/<uid>", methods=["GET"])
def image(uid):
    return get_image(uid)
```

```python
def get_image(uid):
    account = ldap_get_member(uid)
    return account.jpegPhoto
```

```html
{% for m in members %}
	<a href="/user/{{ m['uid'] }}" class="card-block clearfix">
		<div class="card user-card">
			<div class="card-profile-pic card-img-top card-img-top-crop" style="background-image: url('/image/{{m['uid']}}');" >
			</div>
		</div>
	</a>
{% endfor %}
```

### Actual Behavior

The application crashes some way through loading the images. It usually loads 1 or 2 before exiting like this.

This behavior is only observed when attempting to load a large amount of images, such as on a page with a group of users. It does not happen on a single profile which only loads a single image.

```pytb
flask_pyoidc.flask_pyoidc
 * Serving Flask app "profiles" (lazy loading)
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: on
 * Running on http://localhost:8080/ (Press CTRL+C to quit)
 * Restarting with stat
flask_pyoidc.flask_pyoidc
 * Debugger is active!
 * Debugger PIN: 252-481-398
/home/nate/.local/lib/python3.6/site-packages/flask/sessions.py:208: UserWarning: "localhost" is not a valid cookie domain, it must contain a ".". Add an entry to your hosts file, for example "localhost.localdomain", and use that instead.
  ' "{rv}.localdomain", and use that instead.'.format(rv=rv)
127.0.0.1 - - [29/Apr/2018 15:55:42] "GET /group/active HTTP/1.1" 302 -
127.0.0.1 - - [29/Apr/2018 15:55:42] "GET /redirect_uri?state=sb25ldwdXoNE6xlu&session_state=3f2de3ad-d4f8-431e-8d9a-09cfb811322b&code=eyJhbGciOiJkaXIiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0..p7LHT5Z6Bzljz08mV4TzeQ.eG0Tnq9LJJ4OZtspH2qBOyYQkPsqp1gKYUATkQ8ANJbSsRmfI7wUgcEEgvNrVWq5ZcchfYeYqpxixCvVv0I53DdRkrS9IfNa4hv0UOFa4i7txNv1kxHBWfDnjULMTsP7exdpVc0fWxvO1S3fIHeuIm0kxaAsPBdt83wEmj147RnMhrHS6MTjAEICsBRehphzmLi1qWDn9aSoMISCTyc7kjqPikLCyMlpcn-7NPGgGVtQ4olCerE3lmNl-UqZFtYH.yZF3w47VEuMs4-hrboYW2w HTTP/1.1" 302 -
INFO:werkzeug:127.0.0.1 - - [29/Apr/2018 15:55:42] "GET /redirect_uri?state=sb25ldwdXoNE6xlu&session_state=3f2de3ad-d4f8-431e-8d9a-09cfb811322b&code=eyJhbGciOiJkaXIiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0..p7LHT5Z6Bzljz08mV4TzeQ.eG0Tnq9LJJ4OZtspH2qBOyYQkPsqp1gKYUATkQ8ANJbSsRmfI7wUgcEEgvNrVWq5ZcchfYeYqpxixCvVv0I53DdRkrS9IfNa4hv0UOFa4i7txNv1kxHBWfDnjULMTsP7exdpVc0fWxvO1S3fIHeuIm0kxaAsPBdt83wEmj147RnMhrHS6MTjAEICsBRehphzmLi1qWDn9aSoMISCTyc7kjqPikLCyMlpcn-7NPGgGVtQ4olCerE3lmNl-UqZFtYH.yZF3w47VEuMs4-hrboYW2w HTTP/1.1" 302 -
127.0.0.1 - - [29/Apr/2018 15:55:43] "GET /group/active HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [29/Apr/2018 15:55:43] "GET /group/active HTTP/1.1" 200 -
127.0.0.1 - - [29/Apr/2018 15:55:43] "GET /image/dooley HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [29/Apr/2018 15:55:43] "GET /image/dooley HTTP/1.1" 200 -
Fatal Python error: saving thread twice?

Thread 0x00007f0263fff700 (most recent call first):
  File "/usr/lib/python3.6/hmac.py", line 93 in update
  File "/usr/lib/python3.6/hmac.py", line 84 in __init__
  File "/usr/lib/python3.6/hmac.py", line 144 in new
  File "/home/nate/.local/lib/python3.6/site-packages/itsdangerous.py", line 268 in get_signature
  File "/home/nate/.local/lib/python3.6/site-packages/itsdangerous.py", line 243 in verify_signature
  File "/home/nate/.local/lib/python3.6/site-packages/itsdangerous.py", line 362 in verify_signature
  File "/home/nate/.local/lib/python3.6/site-packages/itsdangerous.py", line 371 in unsign
  File "/home/nate/.local/lib/python3.6/site-packages/itsdangerous.py", line 422 in unsign
  File "/home/nate/.local/lib/python3.6/site-packages/itsdangerous.py", line 643 in loads
  File "/home/nate/.local/lib/python3.6/site-packages/flask/sessions.py", line 343 in open_session
  File "/home/nate/.local/lib/python3.6/site-packages/flask/ctx.py", line 377 in push
  File "/home/nate/.local/lib/python3.6/site-packages/flask/app.py", line 2283 in wsgi_app
  File "/home/nate/.local/lib/python3.6/site-packages/flask/app.py", line 2301 in __call__
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/debug/__init__.py", line 288 in debug_application
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 260 in execute
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 270 in run_wsgi
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 328 in handle_one_request
  File "/usr/lib/python3.6/http/server.py", line 418 in handle
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 293 in handle
  File "/usr/lib/python3.6/socketserver.py", line 696 in __init__
  File "/usr/lib/python3.6/socketserver.py", line 361 in finish_request
  File "/usr/lib/python3.6/socketserver.py", line 639 in process_request_thread
  File "/usr/lib/python3.6/threading.py", line 864 in run
  File "/usr/lib/python3.6/threading.py", line 916 in _bootstrap_inner
  File "/usr/lib/python3.6/threading.py", line 884 in _bootstrap

Thread 0x00007f0278997700 (most recent call first):
  File "/usr/lib/python3.6/socket.py", line 586 in readinto
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 324 in handle_one_request
  File "/usr/lib/python3.6/http/server.py", line 418 in handle
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 293 in handle
  File "/usr/lib/python3.6/socketserver.py", line 696 in __init__
  File "/usr/lib/python3.6/socketserver.py", line 361 in finish_request
  File "/usr/lib/python3.6/socketserver.py", line 639 in process_request_thread
  File "/usr/lib/python3.6/threading.py", line 864 in run
  File "/usr/lib/python3.6/threading.py", line 916 in _bootstrap_inner
  File "/usr/lib/python3.6/threading.py", line 884 in _bootstrap

Thread 0x00007f0279198700 (most recent call first):
  File "/home/nate/.local/lib/python3.6/site-packages/ldap/ldapobject.py", line 293 in _ldap_call
  File "/home/nate/.local/lib/python3.6/site-packages/ldap/ldapobject.py", line 792 in search_ext
  File "/home/nate/.local/lib/python3.6/site-packages/ldap/ldapobject.py", line 796 in search_ext_s
  File "/home/nate/.local/lib/python3.6/site-packages/ldap/ldapobject.py", line 1148 in _apply_method_s
  File "/home/nate/.local/lib/python3.6/site-packages/ldap/ldapobject.py", line 1210 in search_ext_s
  File "/home/nate/.local/lib/python3.6/site-packages/ldap/ldapobject.py", line 803 in search_s
  File "/home/nate/.local/lib/python3.6/site-packages/csh_ldap/member.py", line 26 in __init__
  File "/home/nate/.local/lib/python3.6/site-packages/csh_ldap/__init__.py", line 43 in get_member
  File "/home/nate/src/profiles/profiles/ldap.py", line 49 in ldap_get_member
  File "/home/nate/src/profiles/profiles/ldap.py", line 312 in get_image
  File "/home/nate/src/profiles/profiles/__init__.py", line 133 in image
  File "/home/nate/.local/lib/python3.6/site-packages/flask/app.py", line 1791 in dispatch_request
  File "/home/nate/.local/lib/python3.6/site-packages/flask/app.py", line 1805 in full_dispatch_request
  File "/home/nate/.local/lib/python3.6/site-packages/flask/app.py", line 2284 in wsgi_app
  File "/home/nate/.local/lib/python3.6/site-packages/flask/app.py", line 2301 in __call__
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/debug/__init__.py", line 288 in debug_application
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 260 in execute
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 270 in run_wsgi
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 328 in handle_one_request
  File "/usr/lib/python3.6/http/server.py", line 418 in handle
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 293 in handle
  File "/usr/lib/python3.6/socketserver.py", line 696 in __init__
  File "/usr/lib/python3.6/socketserver.py", line 361 in finish_request
  File "/usr/lib/python3.6/socketserver.py", line 639 in process_request_thread
  File "/usr/lib/python3.6/threading.py", line 864 in run
  File "/usr/lib/python3.6/threading.py", line 916 in _bootstrap_inner
  File "/usr/lib/python3.6/threading.py", line 884 in _bootstrap

Current thread 0x00007f0279999700 (most recent call first):
  File "/home/nate/.local/lib/python3.6/site-packages/ldap/ldapobject.py", line 293 in _ldap_call
  File "/home/nate/.local/lib/python3.6/site-packages/ldap/ldapobject.py", line 722 in result4
  File "/home/nate/.local/lib/python3.6/site-packages/ldap/ldapobject.py", line 715 in result3
  File "/home/nate/.local/lib/python3.6/site-packages/ldap/ldapobject.py", line 708 in result2
  File "/home/nate/.local/lib/python3.6/site-packages/ldap/ldapobject.py", line 704 in result
  File "/home/nate/.local/lib/python3.6/site-packages/ldap/ldapobject.py", line 797 in search_ext_s
  File "/home/nate/.local/lib/python3.6/site-packages/ldap/ldapobject.py", line 1148 in _apply_method_s
  File "/home/nate/.local/lib/python3.6/site-packages/ldap/ldapobject.py", line 1210 in search_ext_s
  File "/home/nate/.local/lib/python3.6/site-packages/ldap/ldapobject.py", line 803 in search_s
  File "/home/nate/.local/lib/python3.6/site-packages/csh_ldap/member.py", line 26 in __init__
  File "/home/nate/.local/lib/python3.6/site-packages/csh_ldap/__init__.py", line 43 in get_member
  File "/home/nate/src/profiles/profiles/ldap.py", line 49 in ldap_get_member
  File "/home/nate/src/profiles/profiles/ldap.py", line 312 in get_image
  File "/home/nate/src/profiles/profiles/__init__.py", line 133 in image
  File "/home/nate/.local/lib/python3.6/site-packages/flask/app.py", line 1791 in dispatch_request
  File "/home/nate/.local/lib/python3.6/site-packages/flask/app.py", line 1805 in full_dispatch_request
  File "/home/nate/.local/lib/python3.6/site-packages/flask/app.py", line 2284 in wsgi_app
  File "/home/nate/.local/lib/python3.6/site-packages/flask/app.py", line 2301 in __call__
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/debug/__init__.py", line 288 in debug_application
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 260 in execute
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 270 in run_wsgi
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 328 in handle_one_request
  File "/usr/lib/python3.6/http/server.py", line 418 in handle
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 293 in handle
  File "/usr/lib/python3.6/socketserver.py", line 696 in __init__
  File "/usr/lib/python3.6/socketserver.py", line 361 in finish_request
  File "/usr/lib/python3.6/socketserver.py", line 639 in process_request_thread
  File "/usr/lib/python3.6/threading.py", line 864 in run
  File "/usr/lib/python3.6/threading.py", line 916 in _bootstrap_inner
  File "/usr/lib/python3.6/threading.py", line 884 in _bootstrap

Thread 0x00007f027a431700 (most recent call first):
  File "/usr/lib/python3.6/ssl.py", line 689 in do_handshake
  File "/usr/lib/python3.6/ssl.py", line 1068 in do_handshake
  File "/usr/lib/python3.6/ssl.py", line 814 in __init__
  File "/usr/lib/python3.6/ssl.py", line 407 in wrap_socket
  File "/usr/lib/python3.6/http/client.py", line 1400 in connect
  File "/usr/lib/python3.6/http/client.py", line 964 in send
  File "/usr/lib/python3.6/http/client.py", line 1026 in _send_output
  File "/usr/lib/python3.6/http/client.py", line 1234 in endheaders
  File "/usr/lib/python3.6/http/client.py", line 1285 in _send_request
  File "/usr/lib/python3.6/http/client.py", line 1239 in request
  File "/usr/lib/python3.6/urllib/request.py", line 1318 in do_open
  File "/usr/lib/python3.6/urllib/request.py", line 1361 in https_open
  File "/usr/lib/python3.6/urllib/request.py", line 504 in _call_chain
  File "/usr/lib/python3.6/urllib/request.py", line 544 in _open
  File "/usr/lib/python3.6/urllib/request.py", line 526 in open
  File "/usr/lib/python3.6/urllib/request.py", line 223 in urlopen
  File "/home/nate/src/profiles/profiles/ldap.py", line 324 in get_image
  File "/home/nate/src/profiles/profiles/__init__.py", line 133 in image
  File "/home/nate/.local/lib/python3.6/site-packages/flask/app.py", line 1791 in dispatch_request
  File "/home/nate/.local/lib/python3.6/site-packages/flask/app.py", line 1805 in full_dispatch_request
  File "/home/nate/.local/lib/python3.6/site-packages/flask/app.py", line 2284 in wsgi_app
  File "/home/nate/.local/lib/python3.6/site-packages/flask/app.py", line 2301 in __call__
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/debug/__init__.py", line 288 in debug_application
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 260 in execute
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 270 in run_wsgi
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 328 in handle_one_request
  File "/usr/lib/python3.6/http/server.py", line 418 in handle
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 293 in handle
  File "/usr/lib/python3.6/socketserver.py", line 696 in __init__
  File "/usr/lib/python3.6/socketserver.py", line 361 in finish_request
  File "/usr/lib/python3.6/socketserver.py", line 639 in process_request_thread
  File "/usr/lib/python3.6/threading.py", line 864 in run
  File "/usr/lib/python3.6/threading.py", line 916 in _bootstrap_inner
  File "/usr/lib/python3.6/threading.py", line 884 in _bootstrap

Thread 0x00007f027ac32700 (most recent call first):
  File "/usr/lib/python3.6/threading.py", line 295 in wait
  File "/usr/lib/python3.6/threading.py", line 551 in wait
  File "/usr/lib/python3.6/threading.py", line 851 in start
  File "/usr/lib/python3.6/socketserver.py", line 650 in process_request
  File "/usr/lib/python3.6/socketserver.py", line 317 in _handle_request_noblock
  File "/usr/lib/python3.6/socketserver.py", line 238 in serve_forever
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 612 in serve_forever
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 777 in inner
  File "/usr/lib/python3.6/threading.py", line 864 in run
  File "/usr/lib/python3.6/threading.py", line 916 in _bootstrap_inner
  File "/usr/lib/python3.6/threading.py", line 884 in _bootstrap

Thread 0x00007f028a0fd540 (most recent call first):
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/_reloader.py", line 164 in run
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/_reloader.py", line 273 in run_with_reloader
  File "/home/nate/.local/lib/python3.6/site-packages/werkzeug/serving.py", line 812 in run_simple
  File "/home/nate/.local/lib/python3.6/site-packages/flask/app.py", line 941 in run
  File "app.py", line 4 in <module>

```

### Environment

* Python version: 3.6.5
* Flask version: 1.0
* Werkzeug version: 0.14.1

## How to reproduce

1. Try search "request", it goes to this page: `http://flask.pocoo.org/docs/1.0/search/?q=request`
2. Click on the result, it will be 404

---

The urls built on the search page are wrong, for instance:

```
http://flask.pocoo.org/docs/1.0/search/api/?highlight=request#flask.request
```

Should be

```
http://flask.pocoo.org/docs/1.0/api/?highlight=request#flask.request
```

@davidism this should be fixed in the pallets themes.
Some of the recent PRs in blueprint.py seem to make Flask 1.0 not backwards compatible with 0.x versions.  When `url_prefix=''`, `url_prefix='/'`, or `url_prefix` is not specified, a `ValueError('urls must start with a leading slash')` is now raised. 

### Expected Behavior

I would have assumed, given the discussion in #2629, that `''` and maybe `/` would be acceptable url_prefixes to indicate the blueprint is meant for the root.

An example of a broken library is `flask-sitemap` (https://github.com/inveniosoftware/flask-sitemap/blob/master/flask_sitemap/__init__.py#L120) which uses

```
            app.register_blueprint(
                self.blueprint,
                url_prefix=app.config.get('SITEMAP_BLUEPRINT_URL_PREFIX') # default is '/'
            )
```


### Actual Behavior

 In my testing, I continually get 

```  File "/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/flask_sitemap/__init__.py", line 79, in __init__
    self.init_app(app)
  File "/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/flask_sitemap/__init__.py", line 120, in init_app
    url_prefix='' # app.config.get('SITEMAP_BLUEPRINT_URL_PREFIX')
  File "/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/flask/app.py", line 64, in wrapper_func
    return f(self, *args, **kwargs)
  File "/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/flask/app.py", line 1113, in register_blueprint
    blueprint.register(self, options, first_registration)
  File "/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/flask/blueprints.py", line 186, in register
    deferred(state)
  File "/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/flask/blueprints.py", line 207, in <lambda>
    s.add_url_rule(rule, endpoint, view_func, **options))
  File "/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/flask/blueprints.py", line 79, in add_url_rule
    view_func, defaults=defaults, **options)
  File "/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/flask/app.py", line 64, in wrapper_func
    return f(self, *args, **kwargs)
  File "/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/flask/app.py", line 1211, in add_url_rule
    rule = self.url_rule_class(rule, methods=methods, **options)
  File "/home/albertyw/.virtualenvs/baseflask/local/lib/python2.7/site-packages/werkzeug/routing.py", line 603, in __init__
    raise ValueError('urls must start with a leading slash')
ValueError: urls must start with a leading slash
```

unless I set `url_prefix='//'`, in which case the url_prefix is the root.

### Environment

* Python version: python 2.7 and 3.6
* Flask version: 1.0
* Werkzeug version: 0.14.1

### Expected Behavior

As there is the support for `lazy loading` the app, when running `flask` CLI without providing the proper environment variables we must see a better warning instead of raw exception.

Tell us what should happen.

**we should see a better warning or message pointing to the problem**

```pytb
# there is no FLASK_APP env var
$ flask --help
WARNING: You need to define the app e.g: `export FLASK_APP=app.py`
```
### Actual Behavior

Tell us what happens instead.

**we see traceback before the help message**

```pytb
# there is no FLASK_APP env var
$ flask --help                                                               Sat 28 Apr 2018 01:25:50 PM -03
Traceback (most recent call last):
  File "~Projects/personal/flasgger/venv/lib/python3.6/site-packages/flask/cli.py", line 235, in locate_app
    __import__(module_name)
ModuleNotFoundError: No module named 'app'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "~/Projects/personal/flasgger/venv/lib/python3.6/site-packages/flask/cli.py", line 529, in list_commands
    rv.update(info.load_app().cli.list_commands(ctx))
  File "~/Projects/personal/flasgger/venv/lib/python3.6/site-packages/flask/cli.py", line 372, in load_app
    app = locate_app(self, import_name, name)
  File "~/Projects/personal/flasgger/venv/lib/python3.6/site-packages/flask/cli.py", line 246, in locate_app
    'Could not import "{name}".'.format(name=module_name)
flask.cli.NoAppException: Could not import "app".
Usage: flask [OPTIONS] COMMAND [ARGS]...

  A general utility script for Flask applications.

  Provides commands from Flask, extensions, and the application. Loads the
  application defined in the FLASK_APP environment variable, or from a
  wsgi.py file. Setting the FLASK_ENV environment variable to 'development'
  will enable debug mode.

    $ export FLASK_APP=hello.py
    $ export FLASK_ENV=development
    $ flask run

Options:
  --version  Show the flask version
  --help     Show this message and exit.

Commands:
  routes  Show the routes for the app.
  run     Runs a development server.
  shell   Runs a shell in the app context.

```

The same happens to `run`

```pytb
$ flask run                                                          429ms  Sat 28 Apr 2018 01:32:48 PM -03
 * Serving Flask app "app.py"
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: off
Usage: flask run [OPTIONS]

Error: Could not import "app".
```

The `Error: Could not import "app".` could include `WARNING: You need to define the app e.g: export FLASK_APP=app.py`


### Suggestion

We could check the existence of `FLASK_APP` envvar before running any of the commands in the Group Cli, if FLASK_APP does not exist the dispatch of commands never happens.


### Environment

* Python version: 3.6.0
* Flask version: Flask==1.0
* Werkzeug version: Werkzeug==0.14.1
* Click: click==6.7 

Describe what this patch does to fix the issue.
Adding Windows PowerShell specfic docs

closes #2735 

In order to make debugging key errors from `request.form` easier, #2348 trapped `BadRequest` errors by default in debug mode. However, this caught *all* `BadRequest` errors, not just `BadRequestKeyError`. This changes the behavior so `BadRequestKeyError` is caught in debug mode, but `abort(400)` still passes through.
closes #2731 

When registering a blueprint, strip `/` from the right side of the prefix and the left side of each rule, then join to ensure there's only one slash. #2629 only considered the prefix, and only stripped one slash.
This PR addresses an issue introduced in #2256 which breaks a custom response class that supports returning lists from view functions.

A list is not an expected response value and is not intended to be handled by `make_response`. I'm unsure why it made it's way into this instance check, but there are no consequences to removing it, based on what I can see in the tests & related code.
### Expected Behavior

I should be able to return a single value from my view(that is, not a tuple) and have my value passed to my custom response class. In this case I have a response class that detects whether JSON or pickle data was requested by the client and dumps the return value appropriately. This allows me to simply return a list or dict from my view without having to detect and dump the appropriate type.

```python
@mod.route('/')
def return_json_or_pickle():
    return ['foo', 'bar', 'bat']
```

As of Flask 0.12.2 this worked - make_response would pass the list to my custom response class and my client would get what it wanted.

### Actual Behavior

As of 1.0, commit #2256 was merged which added an explicit check to see if the return value was a list; treating a list as a tuple return in that case. I now get a typeerror:

```pytb
TypeError: The view function did not return a valid response tuple. The tuple must have the form (body, status, headers), (body, status), or (body, headers).
```

If I change my view function to return a tuple:

```python
@mod.route('/')
def return_json_or_pickle():
    return ['foo', 'bar', 'bat'], 200
```
the previous functionality is restored! This confirms that tuple handling is of course perfectly fine. I have a [pull request](https://github.com/pallets/flask/pull/2737) prepared which should do a very nice job of resolving the issue - it simply omits `list` from the type check in make_response. Since a list is not a valid response anyway, there's no reason I can see for it to be there.

### Environment

* Python version: 3.6
* Flask version: 1.0
* Werkzeug version: n/a

### Expected Behavior

In flask 1.0, calling flask.abort(400) returns a 500 error in debug mode

```python
import flask
import werkzeug

APP = flask.Flask(__name__)
print(flask.__version__)
print(werkzeug.__version__)

@APP.route('/<arg>')
def index(arg):
    return flask.abort(400)

APP.debug = True
APP.run()
```

### Actual Behavior

When ``App.debug = True`` is set:
````
127.0.0.1 - - [27/Apr/2018 17:39:16] "GET /tes HTTP/1.1" 500 -
Traceback (most recent call last):
  File "/home/pingou/.local/share/virtualenvs/pag/lib/python2.7/site-packages/flask/app.py", line 2301, in __call__
    return self.wsgi_app(environ, start_response)
  File "/home/pingou/.local/share/virtualenvs/pag/lib/python2.7/site-packages/flask/app.py", line 2287, in wsgi_app
    response = self.handle_exception(e)
  File "/home/pingou/.local/share/virtualenvs/pag/lib/python2.7/site-packages/flask/app.py", line 1733, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/home/pingou/.local/share/virtualenvs/pag/lib/python2.7/site-packages/flask/app.py", line 2284, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pingou/.local/share/virtualenvs/pag/lib/python2.7/site-packages/flask/app.py", line 1807, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pingou/.local/share/virtualenvs/pag/lib/python2.7/site-packages/flask/app.py", line 1710, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/home/pingou/.local/share/virtualenvs/pag/lib/python2.7/site-packages/flask/app.py", line 1805, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pingou/.local/share/virtualenvs/pag/lib/python2.7/site-packages/flask/app.py", line 1791, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/home/pingou/reproducer.py", line 12, in index
    return flask.abort(400)
  File "/home/pingou/.local/share/virtualenvs/pag/lib/python2.7/site-packages/werkzeug/exceptions.py", line 707, in abort
    return _aborter(status, *args, **kwargs)
  File "/home/pingou/.local/share/virtualenvs/pag/lib/python2.7/site-packages/werkzeug/exceptions.py", line 687, in __call__
    raise self.mapping[code](*args, **kwargs)
BadRequest: 400 Bad Request: The browser (or proxy) sent a request that this server could not understand.
````

Calling the endpoint via requests show:
```
>>> requests.get('http://127.0.0.1:5000/tes')
<Response [500]>
```

When ``App.debug = True`` is commented out, I get the expected behavior:
```
>>> requests.get('http://127.0.0.1:5000/tes')
<Response [400]>
```

### Environment

* Python version: in this case 2.7.14
* Flask version: 1.0
* Werkzeug version: 0.14.1

### Expected Behavior

When I run pytest on my code it should complete all tests successfully. This does work fine in 0.12.2.

### Actual Behavior

After upgrading to flask 1.0 I get a strange error when running pytest. I was hoping you might have some insight

```pytb
Traceback (most recent call last):
  File "/Volumes/Storage/Users/claygorman/.pyenv/versions/3.6.4/envs/testproj-1/lib/python3.6/site-packages/_pytest/config.py", line 371, in _importconftest
    mod = conftestpath.pyimport()
  File "/Volumes/Storage/Users/claygorman/.pyenv/versions/3.6.4/envs/testproj-1/lib/python3.6/site-packages/py/_path/local.py", line 668, in pyimport
    __import__(modname)
  File "/Volumes/Storage/Users/claygorman/.pyenv/versions/3.6.4/envs/testproj-1/lib/python3.6/site-packages/_pytest/assertion/rewrite.py", line 213, in load_module
    py.builtin.exec_(co, mod.__dict__)
  File "/Volumes/Storage/clay-dev/testproj/tests/conftest.py", line 13, in <module>
    from testproj import create_app
  File "/Volumes/Storage/clay-dev/testproj/testproj/__init__.py", line 8, in <module>
    from flask import Flask
  File "/Volumes/Storage/Users/claygorman/.pyenv/versions/3.6.4/envs/testproj-1/lib/python3.6/site-packages/flask/__init__.py", line 21, in <module>
    from .app import Flask, Request, Response
  File "/Volumes/Storage/Users/claygorman/.pyenv/versions/3.6.4/envs/testproj-1/lib/python3.6/site-packages/_pytest/assertion/rewrite.py", line 213, in load_module
    py.builtin.exec_(co, mod.__dict__)
  File "/Volumes/Storage/Users/claygorman/.pyenv/versions/3.6.4/envs/testproj-1/lib/python3.6/site-packages/flask/app.py", line 34, in <module>
    from .sessions import SecureCookieSessionInterface
  File "/Volumes/Storage/Users/claygorman/.pyenv/versions/3.6.4/envs/testproj-1/lib/python3.6/site-packages/_pytest/assertion/rewrite.py", line 213, in load_module
    py.builtin.exec_(co, mod.__dict__)
  File "/Volumes/Storage/Users/claygorman/.pyenv/versions/3.6.4/envs/testproj-1/lib/python3.6/site-packages/flask/sessions.py", line 21, in <module>
    from flask.json.tag import TaggedJSONSerializer
ModuleNotFoundError: No module named 'flask.json.tag'; 'flask.json' is not a package
ERROR: could not load /Volumes/Storage/clay-dev/testproj/tests/conftest.py

```

### Environment

* Python version: 3.6.4
* Flask version: 1.0
* Werkzeug version: 0.14.1

Fix Debug Default: By default Debug is only True when ENV is 'development' instead of 'production'


Could you add a optional param to flask.url_for ?  :) 
when I call  `url_for('api.book', book_id="${bookId}")`, 
returned value will be  `'/api/book/%{bookId}' `,
instead of `'/api/book/%24%7BbookId%7D' `

> a snippet in index.html
```html
<script>
    let bookId = '123';
    let url = `{{ url_for('api.books', book_id='${bookId}') }}`
	axios.get(url)
	...
	...
</script>
```
> a blueprint
```python
api = Blueprint(xx,xx,xx, url_prefix='api')
@api.route('/book/<str: book_id>')
def books(book_id):
    xxxxxx
    xxxxxx
    return xxx
```



This is a major backwards-compat breaking change, but I suspect not the intended design and hopefully easy to fix.

The issue is related to PR #2629, and this example follows from that:

Given blueprint `bp` and app `app`:

```python
@bp.route('b/')
def tmp():
    return "URI should be '/a/b/"

app.register_blueprint(bp, url_prefix='/a/')
```

In Flask 0.12 the URL is correctly `/a/b`, but in Flask 1.0 it's `/ab`.

Since issue #2629 relates to resolve double-slashes, I imagine this is a bug (and not a design decision) - and the correct solution would be to remove a slash only when there are two.


Addresses issue [#2601](https://github.com/pallets/flask/issues/2601) with a short note about Werkzeug redirect behaviour in the documentation.

closes #2601

https://pypi.org/project/Flask/0.12.3/#files

*Flask-0.12.3-py2.py3-none-any.whl* contains a `flask/json` directory.

It does not correspond to the `0.12.3` tag. Looks like it is a more recent revision.

The .tag.gz looks fine (I just checked it contains `flask/json.py` and no `flask/json` directory).
In file upload example, after file uploaded, it should redirect to uploaded_file page instead of upload_file page.

I had written a simple wrapper to take all the response primitives, and jsonify them before returning to client like so: 


```python
class JSONifyResponseWrapper(Response):
    default_mimetype = 'application/json'

    @classmethod
    def force_type(cls, rv, environ=None):
        try:
            rv = jsonify(rv)
        finally:
            return super(JSONifyResponseWrapper, cls).force_type(rv, environ)
```
Then i set app.response_class to the class above. 

However, in flask 1.0 , the routes are required to return a tuple. 
This means if I have a route like this: 

```python
@base_blueprint.route('', methods=['Post'])
def hello():
    a = {"hello":"world"} 
   return a
```

The client receives a valid json object. 

But if I do this: 

```python
@base_blueprint.route('', methods=['Post'])
def hello():
    a = [i for i in range(100)]
   return a
```
Flask will throw this error: 

> TypeError: The view function did not return a valid response tuple. The tuple must have the form (body, status, headers), (body, status), or (body, headers)`
### Expected Behavior

When I try to upgrade to 1.0, my code is not compatible with 1.0 flask, how should I solve it?

```python
@cli.command("run", help="run server")
@click.option('--mode', help="Application running mode", default="dev")
def runserver(mode, daemon, reload, preload, spew):
    if mode == 'prod':
        """
        do something
        """

    app.run(host=app.config["HOST"], port=app.config["PORT"], use_reloader=True)

if __name__ == '__main__':
    sys.exit(cli.main())
```

### Actual Behavior

```pytb
manage.py:110: Warning: Silently ignoring app.run() because the application is run from the flask command line executable.  Consider putting app.run() behind an if __name__ == "__main__" guard to silence this warning.
  app.run(host=app.config["HOST"], port=app.config["PORT"], use_reloader=True)
```

### Environment

* Python version: 3.6.4
* Flask version: 1.0

Fix issue: https://github.com/pallets/flask/issues/2722
Asking because I'm interested in contributed and would think there are more than 18 issues.

Feel free to close this.
Running Flask CLI with pipenv using the new version(1.0) 

```
pipenv run flask run
```

I always get the tip message about the load_dotenv feature. Since pipenv [already load](https://docs.pipenv.org/advanced/#automatic-loading-of-env) the `.env` file, It might be interesting have some parameter to disable Flask to load `.env` and does not show the tip message.

### Expected Behavior

Disable load dotenv using the Flask CLI. Example:

```
pipenv run flask run --ignore-dotenv
```

Or just remove the tip message and let it only in the documentation.

### Actual Behavior
Showing the dotenv tip message even if the developer doesn't want to use it
`* Tip: There are .env files present. Do "pip install python-dotenv" to use them`

### Environment

* Python version: 3.6.4
* Flask version: 1.0
* Werkzeug version: 0.14.1

Prevents pip from seeing the dist on unsupported Python versions.
Current Flask in PyPI: https://pypi.org/project/Flask/

There is a "GitHub statistics" section, that is because the old homepage in setup.py is set to GitHub repo. But now, homepage url is replaced by pallets project page. When releasing a new version to PyPI, that section will go.

Warehouse can get the package's GitHub info from homepage url and project_urls. Let's add it back.
`static_url` --> `static_url_path`
I saved a sklearn model by joblib.load()。
```
    model = RandomForestClassifier(n_estimators=100)
    model.fit(feature_train, target_train)
    joblib.dump(model, "%s/%s" % (model_path,"RandomForest.pkl"))
```

And I want to load the model through sending a request。
```
@app.route('/getClassification/',methods=['GET','POST'])
def classify():
    load_model = joblib.load( "%s/%s" % (model_path,"RandomForest.pkl"))
    return  "test"
```
```
try:
    reponse = requests.post(monitor_url, data=params, timeout=60)
    print reponse.content
except Exception, e:
    print e
```
But the request never responded  until it Read timed out。

I dont save a sklearn model ，instead I save a string for testing。
```
joblib.dump("111222", "%s/%s" % (model_path,"RandomForest.pkl"))
```
It loaded successfully。

If I load the model alone，no use request for Flask，It can also load successfully.

Why can not load  a sklearn model by the request for Flask

### Environment

* Python version: 2.7.14
* Flask version:0.12.2

**Describe what this patch does to fix the issue.**

This patch doesn't fix any issue.

I added the license in readme to make easier to find it and make clear which license flask uses. 

**Link to any relevant issues or pull requests.**
none
<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Not sure if this is a bug or a system issue.

`(debug=True, port=3000)`

yet my app still runs on `5000` (default port) 
      
Flask is a very well-designed project to build many kinds of small to big websites, but you run into a problem if you want to do e-commerce.

I think you should consider porting this to Flask:
https://github.com/django-oscar/django-oscar

It seems to be the most popular Django e-commerce solution.

I'm not sure how much would have to be changed. Note you would need to port over some of the plugins like for Paypal, which is 1200 lines.

Maybe it is even possible to have some if Django and if Flask lines and keep it all in one codebase.

I realize this is not an easy bug, but maybe if enough people are interested, something could happen one day.
If you go to: http://flask.pocoo.org/

And you try to click on the microblog link or the twitter clone link, neither of them work because the URLs have changed.
It would be great to add support for more environment variables for Flask CLI. For example,
```python
FLASK_PORT=8080 flask run
```
should run the app in port 8080 instead of default. Thus, we can have a single .flaskenv file that sets our environment and just `flask run` without further arguments.
Just a typo here with the fileuploads guide I guess?

http://flask.pocoo.org/docs/0.12/patterns/fileuploads/

### Expected Behavior

When running the code from the quickstart guide for fileuploads the return statement should call 'upload_file' and not 'uploaded_file'

### Actual Behavior

The following error and recommendation is returned:

```pytb
 raise BuildError(endpoint, values, method, self)
werkzeug.routing.BuildError: Could not build url for endpoint 'uploaded_file' with values ['filename']. Did you mean 'upload_file' instead?
```

### Environment

* Python version: 3.5.1
* Flask version: 0.12.2
* Werkzeug version: 0.14.1

A couple of minor fixes for the extensible session serializer added by #2352.

There were two issues observed:

1. The example usage of ``register()`` passes and ``index`` to the ``force`` argument.
2. It is not possible to insert a tag as the penultimate item in the order list.

Regarding the latter, `a.append(x)` is not the same as `a.insert(-1, x)` - it is `a.insert(len(a), x)`.

It would be good to get these out before the release of 1.0.0 so that the index default is correct.

- [x] add tests that fail without the patch
- [x] ensure all tests pass with ``pytest``
- [x] add documentation to the relevant docstrings or pages
- [ ] ~~add ``versionadded`` or ``versionchanged`` directives to relevant docstrings~~
- [ ] ~~add a changelog entry if this patch changes code~~ *Not required as the feature is unreleased?*

backport #2790 for 0.12
[pallets-sphinx-themes](https://github.com/pallets/pallets-sphinx-themes) replaces the flask-docs theme overrides. flask-docs needs to be updated to not override everything for Flask, other projects will transition later.

Replaces `conf.py` and `Makefile` with modern versions. `conf.py` is organized a little more cleanly. No longer modifies `sys.path` or uses local `_themes` directory, it's all provided by pallets-sphinx-themes entry points. All PyPI links now point to Warehouse.
whenever I try using flash, which everything says should display a message, I get nothing. 

```python
@app.route('/')
def home():
      flash('hello')
```
the above does not work. i have been using Flask for a while but never used this feature.

I checked stack exchange for answers already. Sorry to open an issue. 
When running `flask run` having `FLASK_DEBUG=1` the `lazy_loader` options defaults to True and it causes the `app` to be loaded only when first request comes causing errors to be raised only to werkzeug debugger (on browser)

# problem

When starting the command `flask run` you see `Serving Flask app..` message even if the `app` module cannot be located because the error will only raise later. It can cause confusion and the false impression that the `app` module was successfully found.

To be noticed and have it explicitly in logs I added:

` * Serving Flask app "app.py" (lazy loading)` to the messages

```bash
$ flask run                                                                    
 * Serving Flask app "app.py" (lazy loading)
```
Relates to #2706 
The commands `run` and `shell` are behaving differently to locate the `app`, I can send a PR but first I want to confirm if this is a problem or expected behavior.

### Expected Behavior

Assuming the tree

```bash
/topdir
|____/appdir
|_________/app.py 
```
then

```bash
export FLASK_APP=app.py
cd topdir
```

If you run

```bash
flask run
```

The command can find the `app` in the subfolder and run successfully

Expected the same to happen for `shell` 

```bash
cd topdir
flask shell
>>> 
```

### Actual Behavior


```bash
cd topdir
flask shell

# in 0.12.2
Error: The file/path provided (app.py) does not appear to exist.  Please verify the path is correct.  If app is not on PYTHONPATH, ensure the extension is .py

# n 0.13.dev
Error: Could not import "app"."

```

Looks like the `run` command is traversing the subfolders to locate an app while the `shell` command is not doing the same.

and the same applies for the new `routes` on master

```bash
$ cd topdir
$ flask routes                                                          
Usage: flask routes [OPTIONS]

Error: Could not import "app"."
```

### Environment

* Python version: 3.6.0
* Flask version: 0.12.2 & 0.13.dev (master branch)
* Werkzeug version: 0.14.1

I am trying to read contents of files like .txt,.docx,.pdf and so on with textract and flask microframework. I am using POST method to get input file and send it to textract.

```
@app.route('/upload', methods=['POST'])
    def upload():
        request_file = request.files['file']
        r = request_file.read()
        text = textract.process(r)
        return (text)
```
when i uploaded a docx file,

`File "/usr/lib/python2.7/genericpath.py", line 26, in exists os.stat(path) TypeError: stat() argument 1 must be encoded string without null bytes, not str 10.0.2.2 -- [17/Apr/2018 03:56:58] "POST /upload HTTP/1.1" 500 -`

I don't want to save the file. All i need is to send the file into textract and process the file. I don't want to send the contents of the file. I want to send it as it is (.pdf). I haven't got any solution in stackoverflow too and I didn't find anything related to this error. Why does it show path error? 

### Environment

* Python version: 2.7
* Flask version: 0.12.2
* Werkzeug version: 0.14

### Expected Behavior

I am trying to add an extra header to flask logs, code below. I expected that flask will log in the new format that I put in.

```python
from pomegranate.routes import app
import os

from flask import request
from flask.logging import Formatter, StreamHandler, DEBUG

class RequestFormatter(Formatter):
    def format(self, record):
        record.url = request.url
        record.remote_addr = request.remote_addr
        record.request_id = request.headers.get('X-Request-Id', '')
        return super().format(record)

formatter = RequestFormatter(
    '[%(asctime)s] %(request_id)s %(remote_addr)s %(url)s\n'
    '%(levelname)s %(module)s: %(message)s'
)

stream_handler = StreamHandler()
stream_handler.setLevel(DEBUG)
app.logger.addHandler(stream_handler)
for handler in app.logger.handlers:
    handler.setFormatter(formatter)

dev = int(os.getenv('FLASK_DEBUG', 0))

if __name__ == '__main__':
    host = '0.0.0.0' if dev == 1 else '127.0.0.1'
    app.run(host=host, port=8081, debug=True)
```

### Actual Behavior

Flask continues to use the default format.

### Environment

* Python version: `Python 3.6.1 :: Continuum Analytics, Inc.`
* Flask version: `0.12.2`
* Werkzeug version: `0.14.1`

click (6.7)
Flask (0.12.2)
flaskr (1.0.0, f:\python-flask\flask\examples\tutorial)
itsdangerous (0.24)
Jinja2 (2.10)
MarkupSafe (1.0)
pip (9.0.1)
setuptools (28.8.0)
Werkzeug (0.14.1)
(venv) PS F:\python-flask\flask\examples\tutorial> flask run
Usage: flask run [OPTIONS]

Error: Failed to find application in module "flaskr".  Are you sure it contains a Flask application?  Maybe you wrapped
it in a WSGI middleware or you are using a factory function.
(venv) PS F:\python-flask\flask\examples\tutorial>

For things like server sent events, it would be really great to have an easy option to check if the client connection of a streamed request is still open.

Something like this:

```python
from flask import Flask, Response, client, stream_with_context

app = Flask('sse')

@app.route('/stream')
def sse():
    def gen_sse():
        with open('log.txt') as f:
            while client.is_connected(): 
                lines = f.read()
                if lines:
                    yield build_sse(lines)
                time.sleep(1)

    return Response(
        stream_with_context(gen_sse()),
        mimetype='text/event-stream',
    )

def build_sse(message, id_=None):
    sse = ''
    if id_ is not None:
        sse += f'id: {id_}\n'
    sse += 'data: ' + '\ndata:'.join(message.splitlines())
    sse += '\n\n'
    return sse
```
Hello world, I have Python/Flask application with a login screen. My goal is to utilize LDAP authentication in unison with my Python/Flask app. The issue that i am running into is this:

> RuntimeError: The session is unavailable because no secret key was set.  Set the secret_key on the application to something unique and secret."

I have a secret key and i still get the error same error when i comment it out. 
Here is my code:

```python
import token
from flask import Flask, session
from flask.ext.sqlalchemy import SQLAlchemy
from flask.ext.login import LoginManager

app = Flask(__name__)
#app.secret_key = 'welfhwdlhwdlfhwelfhwlehfwlehfelwehflwefwlehflwefhlwefhlewjfhwelfjhweflhweflhwel'
app.config['SESSION_TYPE'] = 'filesystem'
app.config['LDAP_AUTH_SERVER'] = 'LDAPLocation.com'
app.config['LDAP_PORT'] = '636'
app.config['LDAP_TOP_DN'] = 'CN=something here,OU=somethingHere,OU=SomeService Accounts,dc=magic,dc=pumpum,DC=com Xe'
app.config['LDAP_BIND_USER_PASSWORD'] = 'pssword'
app.register_blueprint(token, url_prefix='/auth')


db = SQLAlchemy(app)

login_manager = LoginManager()
login_manager.init_app(app)
login_manager.login_view = 'login'

from app.auth.views import auth

app.register_blueprint(auth)
```

Thank you in advance....

Can anyone help fix this issue?

---

### Expected Behavior

I'm running [cloud-function-python](https://github.com/MartinSahlen/cloud-f…) using flask.

Error is being pointed to a file called `flask-handler.py`

Code of `flask-handler.py` [link](https://github.com/MartinSahlen/cloud-functions-python/blob/master/cloudfn/flask_handler.py)
```python
import json
import sys
from io import StringIO

import six
from six.moves.urllib_parse import urlparse
from werkzeug.datastructures import Headers

# from .wsgi_util import wsgi


def handle_http_event(app):
    req_json = json.loads(sys.stdin.read())
    c = urlparse(req_json['url'])
    path = c.path
    if path == '':
        path = '/'

    body = StringIO(req_json.get('body', u''))

    req_headers = req_json.get('headers', None)
    h = Headers()
    if req_headers is not None:
        for key, value in six.iteritems(req_headers):
            h.add(key, value)

    with app.test_request_context(
            path=path,
            input_stream=body,
            method=req_json.get('method', 'GET'),
            headers=h,
            query_string=c.query):
        resp = app.full_dispatch_request()
        body = resp.get_data()
        try:
            body = json.loads(body)
        except:
            pass

        headers = {}
        for header in resp.headers:
            if header[0] in headers:
                headers[header[0]] += ', ' + header[1]
            else:
                headers[header[0]] = header[1]

        sys.stdout.write(json.dumps({
            'body': body,
            'status_code': resp.status_code,
            'headers': headers,
        }))
```

### Actual Behavior

I'm getting back this error

line 50 this code resides

```
        sys.stdout.write(json.dumps({
            'body': body,
            'status_code': resp.status_code,
            'headers': headers,
        }))
```

I tried `json.dump` instead of `json.dumps` but still I'm getting the same error

```pytb
Failed to execute script function Traceback (most recent call last): 
File "function.py", line 33, in <module> File "site-packages/cloudfn/flask_handler.py", 
line 50, in handle_http_event File "json/__init__.py", 
line 230, in dumps File "json/encoder.py", 
line 198, in encode File "json/encoder.py", 
line 256, in iterencode File "json/encoder.py", 
line 179, in default TypeError: b'{\n "json": {\n "empID": "I123", \n "image": "http://image", \n "refID": "69", \n "refTable": "123456"\n }, \n "message": "Hello world!"\n}\n' is not JSON serializable
```
I even raised an [issue](https://github.com/MartinSahlen/cloud-functions-python/issues/49) in `cloud-function-python` but still haven't received any response.

### Environment

* Python version: 3.5
* Flask version: 0.12.2
* flack-Cors: 3.0.3
* Werkzeug version: 0.12

I removed the jQuery example when rewriting the tutorial. This adds a more general JavaScript example back in, demonstrating the same simple `add` endpoint but with `XMLHttpRequest`, `fetch`, and `jQuery`.
### Expected Behavior

Expecting to get Log messages other than ERROR level into gunicorn error.log file in order to persist my logs.

```
Logging Configuration:
gunicorn_logger = logging.getLogger('gunicorn.error')
app.logger.handlers = gunicorn_logger.handlers
app.logger.setLevel(gunicorn_logger.level)

Command to run Gunicorn:
gunicorn --access-logfile "access.log" --error-logfile "error.log" --log-level info --worker-class gevent --workers=3 --timeout 60 --bind 0.0.0.0:8081 manage:app
```

### Actual Behavior

Sometimes when an error message is logged it keeps on logging the same message for some time and then throws this error mentioned below. It doesn't happen all the time or on a certain log message but will occur randomly. App keeps working fine doesn't stop responding to the requests but adds too much noise in logs. If i use simple StreamHandler then it doesn't through any errors but the INFO or DEBUG messages or not written to Gunicorn error.log file as it doesn't capture stdout may be

```pytb
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'
web_1           | [2018-04-10 04:48:34,793] ERROR in api: AUTH_ERROR: cannot get Auth-Token for user 'amir@wanclouds.net'

web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 70, in write
web_1           |     stream.write(data)
web_1           |   File "/usr/local/lib/python2.7/site-packages/werkzeug/local.py", line 347, in __getattr__
web_1           |     return getattr(self._get_current_object(), name)
web_1           |   File "/usr/local/lib/python2.7/site-packages/werkzeug/local.py", line 306, in _get_current_object
web_1           |     return self.__local()
web_1           |   File "/usr/local/lib/python2.7/site-packages/flask/logging.py", line 37, in _proxy_stream
web_1           |     ctx = _request_ctx_stack.top
web_1           |   File "/usr/local/lib/python2.7/site-packages/werkzeug/local.py", line 166, in top
web_1           |     return self._local.stack[-1]
web_1           | RuntimeError: maximum recursion depth exceeded

```

### Environment

* Python version: 2.7
* Flask version: 0.12.2
* Werkzeug version: 0.12.2

It is more efficient to use the builtin `timedelta.total_seconds()`, and cleaner.
I found the tutorial rather confusing in how it gives the same name to three different things: the top-level directory of the project, the subdirectory containing all project-specific code (the package directory?), and the main .py script. In many spots in the tutorial, we set variables to the value "flaskr" (in setup.py and in environment variables) and we import from .flaskr as well. Maybe this is common practice in making flask applications or python apps in general, but I think for beginners it might help to rename some of these to make it clearer which "flaskr" is being referenced in setup.py, __init__.py, environment variables, etc. Thank you.
See #2691. Closes #2692.
See #2359. Closes #2666.
Allow configuring pallets/werkzeug#1109 in Flask.

Add `MAX_COOKIE_SIZE` config and `Response.max_cookie_size` property to control when Werkzeug warns about large cookies that may be ignored by browsers.
Backport #2691 to 0.12.
`request.get_json` no longer accepts arbitrary encodings. Incoming JSON must be encoded using a UTF-8, -16, or -32 codec. The current JSON spec says UTF-8 is the only valid encoding, although Flask is more forgiving. `json.detect_encoding` is added to automatically detect which UTF encoding was used, including BOM and endianness.
When I send a large payload to the service, the flask config is not respecting the config and let the program continue to run.

This line is not hit ever: https://github.com/pallets/werkzeug/blob/6df9e5bdb9d216fcf2989ce051cd11b763cef4a0/werkzeug/formparser.py#L194

---

### Expected Behavior

I am expecting to get 413 error in response.

```python
from flask import Flask, request, jsonify, abort

app = Flask(__name__)
app.config['MAX_CONTENT_LENGTH'] = 100

...

@app.route('/myendpoint', methods=['POST'])

...

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=12345, debug=True)
```

### Actual Behavior

Tell us what happens instead.

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version:  Both python 2.7 and 3.6
* Flask version: 0.12.2
* Werkzeug version: 0.14.1

### Expected Behavior
I want to use this module in ironpython which provided by Ansys Electronics Desktop as a script languange. So what should I do?


Are there any plans to add type stubs for PEP484-compliant static typing?
I found that flask post not supports json.dumps with unicode. 

```
import request as 
r.post('http://localhost/test', json={'bar':'程序员'})
```
So I suggest that support unicode in `vim modles.py +458`:

`body = complexjson.dumps(json, ensure_ascii=True)`
closes #348 

Documents that blueprint static URL is only accessible if the blueprint has a prefix, otherwise the application static URL takes precedence.
closes #1151 

Mostly keeps the same sections and concepts. References to old version behavior is removed since it's no longer relevant. Added more explanation about what to do about "no app / request context" errors, since it comes up constantly on Stack Overflow. Added more cross references and cleaned up many API docs as well to make them more consistent. Added documentation for `_AppCtxGlobals` rather than recreating it in the `g` docs. Added documentation about the `test_request_context` arguments.

This is an inherently advanced topic, so I don't think there's any way to make it completely clear to all readers. Hopefully it's at least easier to follow to get an idea of how the process works.
Every time we use flask there is some basic code we need to write and some directories we need to create. We can automate that particular cumbersome task by something like `flask init` which will let's say create an app.py file containing the basic imports statements, a basic hello world route, code to start the server on the default port, basic directories like a template, static etc. 
Basically something like Django's `django-admin startproject `. 
update-2018-03-22

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->


//run.py
from flask import Flask, render_template, jsonify, request
from flask_cors import CORS
from src.models.models import Memeber0
from src.models.dbconn3 import db

app = Flask(name)
CORS(app)

@app.route('/json_test', methods=['GET', 'POST'])
def json_test():
  if request.method == "POST":
    index = jsonify(request.json.get('index'))
    agency = jsonify(request.json.get('agency'))
    name = jsonify(request.json.get('name'))
    feature = jsonify(request.json.get('feature'))
    depiction = jsonify(request.json.get('depiction'))
    Memeber0.query.filter(Memeber0.index == index).update(dict(
            agency=agency, name=name, feature=feature, depiction=depiction
        ))
    db.session.commit()
    return index
--------------------------------

I want to send a json from the front end and update it to the postgresql DB with that data. 
But I did this, but I can not do it. What should I do? 
I would like you to give us a simple example.



I've implemented a service in Python3 with Flask, to create the server. My service (MyService) take a query from the user and return a response, like a chatbot. So, i want to return both a text respons modifying the Html template, and a json containing response for using service as command line. At the moment my service only return a render template,how I can do?

My app:

```
app = Flask(__name__)

@app.route("/")
def main():
    return render_template('index.html')

@app.route("/result", methods=['POST', 'GET'])
def result():
   if request.method == 'POST':
       query = request.form['query']
       response = MyService.retrieve_response(query)
       return render_template("index.html", value=response)

if __name__ == "__main__":
    app.run()
```
And my simple index.html:

```
<!DOCTYPE html>
<html lang="en">

<body>

<h2>Wellcome!/h2>

<form action="http://localhost:5000/result" method="POST">
  Make a question:<br>
  <br>
  <input type="text" name="query" id="query">
  <br><br>
  <input type="submit" value="submit"/>
</form>


<br>
<h3>Response is: </h3>
<br>
{{value}}
</body>
</html>
```
HI there!

I'm trying to get session data from table in my custom session interface in Flask and I'm getting the error Connection already open. This exception appears because connection opens automatically when I get a session data from `open_session` method in session interface. And after that Flask runs hooks `before_request` where the method to connect to database [was registered](https://github.com/coleifer/peewee/blob/master/playhouse/flask_utils.py#L148).


```python
import peewee as pw

from flask import Flask, jsonify
from flask.sessions import SessionInterface, SessionMixin
from werkzeug.datastructures import CallbackDict

from playhouse.flask_utils import FlaskDB
from playhouse.sqlite_ext import JSONField

from datetime import datetime


app = Flask(__name__)
db = FlaskDB(app, 'sqlite:///test_db.sqlite')


class Session(CallbackDict, SessionMixin):

    def __init__(self, store={}):
        def on_update(self):
            self.modified = True

        self._store = store
        self.modified = False

        CallbackDict.__init__(self, store.get('data', {}), on_update)

    @classmethod
    def find(cls, sid):
        try:
            store = SessionStore.get(sid=sid)
        except SessionStore.DoesNotExist:
            store = {}
        return cls(store)

    def save(self):
        if hasattr(self._store, 'data') and self.modified:
            self._store.data = self
        self._store.save()


class MySI(SessionInterface):
    null_session_class = Session

    def open_session(self, app, request):
        sid = request.cookies.get('sid')
        # This is a point where request object already exists
        # but hooks before_request are not called
        return Session.find(sid) if sid else None

    def save_session(self, app, session, response):
        if session.modified:
            session.save()


class SessionStore(db.Model):
    sid = pw.CharField(primary_key=True)
    data = JSONField()
    expired = pw.DateTimeField(default=datetime.now)

    class Meta:
        table_name = 'sessions'


app.session_interface = MySI()

@app.route('/')
def main():
    return jsonify(ok=1)

if __name__ == '__main__':
    if not SessionStore.table_exists():
        SessionStore.create_table()
    app.run(debug=True)
```

Traceback:

```bash
127.0.0.1 - - [03/Apr/2018 11:42:35] "GET / HTTP/1.1" 500 -
Traceback (most recent call last):
  File "/home/ak04nv/.virtualenvs/web-app-boilerplate/lib/python3.6/site-packages/flask/app.py", line 1997, in __call__
    return self.wsgi_app(environ, start_response)
  File "/home/ak04nv/.virtualenvs/web-app-boilerplate/lib/python3.6/site-packages/flask/app.py", line 1985, in wsgi_app
    response = self.handle_exception(e)
  File "/home/ak04nv/.virtualenvs/web-app-boilerplate/lib/python3.6/site-packages/flask/app.py", line 1540, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/home/ak04nv/.virtualenvs/web-app-boilerplate/lib/python3.6/site-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "/home/ak04nv/.virtualenvs/web-app-boilerplate/lib/python3.6/site-packages/flask/app.py", line 1982, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/ak04nv/.virtualenvs/web-app-boilerplate/lib/python3.6/site-packages/flask/app.py", line 1614, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/ak04nv/.virtualenvs/web-app-boilerplate/lib/python3.6/site-packages/flask/app.py", line 1517, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/home/ak04nv/.virtualenvs/web-app-boilerplate/lib/python3.6/site-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "/home/ak04nv/.virtualenvs/web-app-boilerplate/lib/python3.6/site-packages/flask/app.py", line 1610, in full_dispatch_request
    rv = self.preprocess_request()
  File "/home/ak04nv/.virtualenvs/web-app-boilerplate/lib/python3.6/site-packages/flask/app.py", line 1831, in preprocess_request
    rv = func()
  File "/home/ak04nv/.virtualenvs/web-app-boilerplate/lib/python3.6/site-packages/playhouse/flask_utils.py", line 174, in connect_db
    self.database.connect()
  File "/home/ak04nv/.virtualenvs/web-app-boilerplate/lib/python3.6/site-packages/peewee.py", line 2463, in connect
    raise OperationalError('Connection already opened.')
peewee.OperationalError: Connection already opened.
```

```bash
$ pip install flask peewee
$ python test.py &
$ curl -b sid=123 localhost:5000
```

Python: 3.6.4
Flask: 0.12.2
Werkzeug: 0.14.1
### Expected Behavior

http://flask.pocoo.org/docs/0.12/patterns/fileuploads/ should have the following code snippet:

``` file.save(os.path.join(app.config['UPLOAD_FOLDER'], filename))
            return redirect(url_for('upload_file',
                                    filename=filename))
```

### Actual Behavior

The doc instead has:

``` file.save(os.path.join(app.config['UPLOAD_FOLDER'], filename))
            return redirect(url_for('uploaded_file',
                                    filename=filename))
```

It's a quick fix. Just need to rename `url_for('uploaded_file', ` to `url_for('upload_file', `

### Environment

* Python version: Any
* Flask version: 0.12
* Werkzeug version: Any

### Expected Behavior

Testing with pytest and using  the context manager `app.test_client().session_transaction()`
to set the session configuration.

```python

@pytest.fixture()
def client():
    app.config['TESTING'] = True

    app.secret_key = 'test_views'
    with app.test_client() as client:
        yield client

def test_phase1(client, mocker):
    with client.session_transaction() as session:
        session['logged_in'] = True
        response = client.get('/phase1')
        print(response)
```
### Actual Behavior

```pytb
    def do_teardown_request(self, exc=_sentinel):
        """Called after the actual request dispatching and will
            call every as :meth:`teardown_request` decorated function.  This is
            not actually called by the :class:`Flask` object itself but is always
            triggered when the request context is popped.  That way we have a
            tighter control over certain resources under testing environments.
    
            .. versionchanged:: 0.9
               Added the `exc` argument.  Previously this was always using the
               current exception information.
            """
        if exc is _sentinel:
            exc = sys.exc_info()[1]
        funcs = reversed(self.teardown_request_funcs.get(None, ()))
>       bp = _request_ctx_stack.top.request.blueprint
E           AssertionError: Popped wrong request context.  (None instead of <RequestContext 'http://localhost/' [GET])


During handling of the above exception, another exception occurred:

    def pop(self, exc=_sentinel):
        """Pops the request context and unbinds it by doing that.  This will
            also trigger the execution of functions registered by the
            :meth:`~flask.Flask.teardown_request` decorator.
    
            .. versionchanged:: 0.9
               Added the `exc` argument.
            """
        app_ctx = self._implicit_app_ctx_stack.pop()
    
        try:
            clear_request = False
            if not self._implicit_app_ctx_stack:
                self.preserved = False
                self._preserved_exc = None
                if exc is _sentinel:
                    exc = sys.exc_info()[1]
                self.app.do_teardown_request(exc)
    
                # If this interpreter supports clearing the exception information
                # we do that now.  This will only go into effect on Python 2.x,
                # on 3.x it disappears automatically at the end of the exception
                # stack.
                if hasattr(sys, 'exc_clear'):
                    sys.exc_clear()
    
                request_close = getattr(self.request, 'close', None)
                if request_close is not None:
                    request_close()
                clear_request = True
        finally:
            rv = _request_ctx_stack.pop()
    
            # get rid of circular dependencies at the end of the request
            # so that we don't require the GC to be active.
            if clear_request:
                rv.request.environ['werkzeug.request'] = None
    
            # Get rid of the app as well if necessary.
            if app_ctx is not None:
                app_ctx.pop(exc)
    
            assert rv is self, 'Popped wrong request context.  ' \
>               '(%r instead of %r)' % (rv, self)
E          AssertionError: Popped wrong request context.  (None instead of <RequestContext 'http://localhost/' [GET])

```
tried with with app.config['PRESERVE_CONTEXT_ON_EXCEPTION'] = False but it doesn't work

### Environment

* Python version: 3.5.3
* Flask version: 0.12.2
* Werkzeug version: 0.14.1

This is a complete rewrite of the tutorial, both the docs and the example code. The goal is to provide a better foundation for new developers to work with. There's  a bit more code, and it's a bit more complex, but I'm hoping it sets up patterns and concepts better so that developers start with better habits.

* Use the application factory and blueprints from the start.
* Use the instance folder for config and the database.
* Multiple users, stored in the database with hashed passwords.
* Delete posts.
* Build a Wheel file, install it in another virtualenv.
* Override `SECRET_KEY` using config in the instance folder.
* Use other WSGI server in production (Waitress, since it works on Windows).
* 100% test coverage using pytest and coverage.
* All described code links to the API docs.
* General reorganization.

I've removed all the other examples. I'm going to add a JavaScript example back in but wanted to rewrite it as well. That will be the next PR. The other examples are all covered by the tutorial now.

Added a `gh` Sphinx role that adds links to GitHub files. It will select the correct tag on GitHub based on the docs version being built. I'll expand this to work with issues and extract it to pallets-sphinx-themes at some point.

You can find the rendered docs here: http://flask-dev.davidism.com/tutorial/. The only change is in the installation instructions, Flask needs to be installed from GitHub since 1.0 isn't released yet. You can find the example project on my branch: https://github.com/davidism/flask/tree/tutorial/examples/tutorial.

closes #2513 
### Expected Behavior

When I `import some_package_that_doesnt_exist` I should get `ImportError: No module named 'some_package_that_doesnt_exist'`, but something is swallowing the `ImportError` and assuming it means I mistyped the filename of my server code.


```python
from flask import Flask
app = Flask(__name__)

import aoeu
```

what happens

```bash
$ export FLASK_APP='flask_error_demonstration.py'
$ flask run
Usage: flask run [OPTIONS]

Error: The file/path provided (flask_error_demonstration) does not appear to exist.  Please verify the path is correct.  If app is not on PYTHONPATH, ensure the extension is .py
```

what should happen

```bash
$ export FLASK_APP='flask_error_demonstration.py'
$ flask run
ImportError: No module named 'aoeu'
```

* Python version: 3.5.3
* Flask version: 0.12.2


Website link to PDF documentation is broken.

http://flask.pocoo.org/docs/0.12/.latex/Flask.pdf
Hey there. I've just optimized all of your images. They are the same dimensions and quality as before, only they take up less space now.

\docs\_static\no.png (18.3%))
\docs\_static\touch-icon.png (64.21%))
\docs\_static\flaskr.png (8.32%))
\docs\_static\pycharm-runconfig.png (14.65%))
\docs\_static\debugger.png (2.79%))
\docs\_static\flask.png (30.15%))
\docs\_static\yes.png (13%))
\docs\_static\logo-full.png (29.33%))

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

In response to a POST, I wanted to construct a URL pointing at a different URL (the home of the created object) which did NOT support POST.

It turns out, this doesn't work with Flask==0.12.2. The rule I want doesn't match, so I end up matching a less specific rule, with the distinguishing name treated as a parameter, not a path.

What appears to be happening is that default method is being pulled out of _request_ctx early in url_for(). In this case, that method will be a POST.

I'm not sure if defaulting to the request's current method is really desirable. How often are you responding to a POST and want url_for to respond with the best match for POST? I think typically most endpoints will respond to a GET, but many endpoints won't respond to a POST.

The workaround is to include the undocumented _method keyword argument. That will work (hopefully permanently), but I'd prefer:

A) for this to be explicitly supported by the API, and
B) I think the default should probably always be GET. My guess is that will be correct far more 

### Expected Behavior
`send_file` closes the file which it opens
https://github.com/pallets/flask/blob/0.12.2/flask/helpers.py#L549

### Actual Behavior

File is not closed.
Tests are yelling:
`tests2.py:14: ResourceWarning: unclosed file <_io.BufferedReader name='path/tests2.py'>`

```
> python3 tests2.py 
tests2.py:14: ResourceWarning: unclosed file <_io.BufferedReader name='path/tests2.py'>
  self.client.get('/')
.
----------------------------------------------------------------------
Ran 1 test in 0.012s

OK

> cat tests2.py 
import unittest
from flask import Flask
from flask import current_app, send_from_directory
app = Flask(__name__)

@app.route("/")
def hello():
    return send_from_directory('.', __file__)

class TestCase(unittest.TestCase):
    def test_x(self):
        self.client = app.test_client()

        self.client.get('/')


if __name__ == '__main__':
    unittest.main()
```

### Environment

* Python version: Python 3.5.3
* Flask version: Flask==0.12.2
* Werkzeug version: Werkzeug==0.12.2

Small doc change because it is not documented anywhere else and may be confusing. 

If a user is making use of the `@errorhandler(405)` decorator, and they wish to include an Allow header (as per HTTP spec), they may be confused to find that url_rule is None (when they were attempting to get the allowed methods). While an experienced Flask user knows why this won't work, it may be unclear to a new user who is attempting to conform to HTTP. 

This doc change aims to clarify that: because the request was never successfully matched, it was never bound to a URL rule.  In order to access the valid methods, they must examine `routing_exception` instead.

Doc change only, no uncommented code is affected. 

I'm Looking to create a similar custom extension to push any javascript code blocks to a designated area on the page or below footer.

My version works using Python 3.6,Flask and Jinja 2.9. However I have a major
issue that occurs after changing the line number or content within the blocks.
The content will appear multiple times on render.

    from jinja2 import nodes
    from jinja2.ext import Extension
    
    class JavascriptBuilderExtension(Extension):
        tags = set(['push'])
    
        def __init__(self, environment):
            super(JavascriptBuilderExtension, self).__init__(environment)
            self._myScope = {}
            environment.extend(
                pull = self._myScope
                )
        def parse(self, parser):
            """Parse tokens """
            tag = parser.stream.__next__()
            args = [parser.parse_expression(), nodes.Const(tag.lineno)]
            body = parser.parse_statements(['name:endpush'], drop_needle=True)
            callback = self.call_method('compiled', args)
            return nodes.CallBlock(callback,[], [], body).set_lineno(tag.lineno)
    
        def compiled(self,tagname,linenum,caller):
            tagname = "{}_{}".format( tagname, linenum)
            self._myScope[tagname] = caller()
            return "<!-- moved {} from line {} -->".format(tagname,linenum)
        

My template code looks like this

    <html> <head></head> <body> <h1>Test template</h1>
    {% push 'js' %} X {% endpush %}
    {% push 'html' %} Z {% endpush %}
    {% push 'js' %} Y {% endpush %}
    {{ pull }}
    </body> </html>

My rendered output is below:

    <html> <head></head> <body> <h1>Test template</h1>
    name = hyper testing jinja
    date = right now
    <!-- moved js_4 from line 4 -->
    <!-- moved html_5 from line 5 -->
    <!-- moved js_6 from line 6 -->
    {'js_4': ' X ', 'html_5': ' Z ', 'js_6': ' Y '}
    </body> </html>

**The Problem happens after I change the template block line number or content.**

**After changing content and line numbers**

    <html> <head></head> <body> <h1>Test template</h1>
    {% push 'js' %} ABC {% endpush %}

    {% push 'html' %} Z {% endpush %}

    {% push 'js' %} 123{% endpush %}
    {{ pull }}
    </body> </html>

**Render changed blocks now has prior content**

    <html> <head></head> <body> <h1>Test template</h1>
    name = hyper testing jinja
    date = right now
    <!-- moved js_4 from line 4 -->

    <!-- moved html_7 from line 7 -->

    <!-- moved js_9 from line 9 -->
    {'js_4': ' X ABC', 'html_5': ' Z ', 'js_6': ' Y ','js_9':'123','html_7':'Z'}
    </body> </html>

This issue causes duplicate content to be added into the response.

Is there a way to call the extension on ever page request to re-parse the template for new changes? or Possible to not cache the enclosed extension blocks?

I have already tried adding the code below to auto reload templates but does not help the issue.

`app.jinja_env.auto_reload = True`


### Environment

* Python version: 3.6
* Flask version:0.10
* Werkzeug version:0.12.2

For people not really comfortable with the flask ecosystem this can be really confusing.

Hi guys.

When I tested the example code(hello world) with debug mode, the flask did NOT respond from web request.
But without debug mode, the code was working very well.

I have tested both of python3 and python2 also a few version of flask.

I cannot imagine what is the root cause..

Somebody experienced this issue?


### Environment
* Python version: 3.6.2, 2.6
* Flask version: 0.12.2, 0.12, 0.11
* Werkzeug version: 0.12

this allows to use application object in a callbacks, resolves #2410

Migrated a project to Python3 and when using the "Flask run" command on the windows cmd it throws me a "missing module" error:

### pytr
(venv1) C:\Users\usrname\projectfolder>flask run
Traceback (most recent call last):
  File "c:\users\usrname\appdata\local\programs\python\python36-32\Lib\runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "c:\users\usrname\appdata\local\programs\python\python36-32\Lib\runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "C:\Users\usrname\Envs\venv1\Scripts\flask.exe\__main__.py", line 5, in <module>
  File "c:\users\usrname\envs\venv1\lib\site-packages\flask\__init__.py", line 19, in <module>
    from jinja2 import Markup, escape
  File "c:\users\usrname\envs\venv1\lib\site-packages\jinja2\__init__.py", line 33, in <module>
    from jinja2.environment import Environment, Template
  File "c:\users\usrname\envs\venv1\lib\site-packages\jinja2\environment.py", line 15, in <module>
    from jinja2 import nodes
  File "c:\users\usrname\envs\venv1\lib\site-packages\jinja2\nodes.py", line 19, in <module>
    from jinja2.utils import Markup
  File "c:\users\usrname\envs\venv1\lib\site-packages\jinja2\utils.py", line 624, in <module>
    from markupsafe import Markup, escape, soft_unicode
  File "c:\users\usrname\envs\venv1\lib\site-packages\markupsafe\__init__.py", line 14, in <module>
    from markupsafe._compat import text_type, string_types, int_types, \
ModuleNotFoundError: No module named 'markupsafe._compat'


However markupsafe is installed in the venv: 

(venv1) >pip show markupsafe
Name: MarkupSafe
Version: 1.0
Summary: Implements a XML/HTML/XHTML Markup safe string for Python
Home-page: http://github.com/pallets/markupsafe
Author: Armin Ronacher
Author-email: armin.ronacher@active-4.com
License: BSD
Location: c:\users\...\lib\site-packages
Requires:

### Environment

* Python version: 3.6
* Flask version: 0.12.2
* Werkzeug version: 0.12.2

### Expected Behavior
In README of the example of flask/examples/flasker has following step to set  FLASK_APP env variable:
**export FLASK_APP=flaskr.factory:create_app()**

Next step is to initialize the DB:
And it should produce output as follows:
**Initialized the database.**

### Actual Behavior

This method to set FLASK_APP env is not compatible with the current released version of flask.
If set this way following error is observed while running next step "flask initdb":
RuntimeError: Failed to find application in module "flaskr.factory".

The issue is resolved in master branch. Still, this being starting example for many people, should be corrected.

```pytb
flask initdb
Traceback (most recent call last):
  File "/Users/prasadghagare/Desktop/projects/repo/.my_env/bin/flask", line 11, in <module>
    sys.exit(main())
  File "/Users/prasadghagare/Desktop/projects/repo/.my_env/lib/python2.7/site-packages/flask/cli.py", line 513, in main
    cli.main(args=args, prog_name=name)
  File "/Users/prasadghagare/Desktop/projects/repo/.my_env/lib/python2.7/site-packages/flask/cli.py", line 380, in main
    return AppGroup.main(self, *args, **kwargs)
  File "/Users/prasadghagare/Desktop/projects/repo/.my_env/lib/python2.7/site-packages/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/Users/prasadghagare/Desktop/projects/repo/.my_env/lib/python2.7/site-packages/click/core.py", line 1061, in invoke
    cmd_name, cmd, args = self.resolve_command(ctx, args)
  File "/Users/prasadghagare/Desktop/projects/repo/.my_env/lib/python2.7/site-packages/click/core.py", line 1100, in resolve_command
    cmd = self.get_command(ctx, cmd_name)
  File "/Users/prasadghagare/Desktop/projects/repo/.my_env/lib/python2.7/site-packages/flask/cli.py", line 351, in get_command
    rv = info.load_app().cli.get_command(ctx, name)
  File "/Users/prasadghagare/Desktop/projects/repo/.my_env/lib/python2.7/site-packages/flask/cli.py", line 237, in load_app
    rv = locate_app(self.app_import_path)
  File "/Users/prasadghagare/Desktop/projects/repo/.my_env/lib/python2.7/site-packages/flask/cli.py", line 109, in locate_app
    % module)
RuntimeError: Failed to find application in module "flaskr.factory"
```

### Environment

* Python version: 2.7.13
* Flask version: 0.12.2
* Werkzeug version: 0.7

### Expected Behavior

Flask apps run in debug mode (importing grequests) should reload when filesystem changes are detected.

### Actual Behavior

Instead, the following app crashes as changes are introduced and an app reload is attempted. Oddly enough, if the app is started with grequests commented out, and then uncommented, reloads process successfully.

```python
import flask              

import grequests          
import sys                

app = flask.Flask(__name__)                          
app.debug = True          

@app.route('/syspath')    
def syspath():            
    return '\n'.join(sys.path) + '\n'       
```

```
$ FLASK_APP=demo.py FLASK_DEBUG=1 flask run --host=0.0.0.0
 * Serving Flask app "demo"                          
 * Forcing debug mode on                             
 * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)                                                 
 * Restarting with stat                              
 * Debugger is active!                               
 * Debugger PIN: 313-109-065                         
 * Detected change in '/home/bpaterni/usr/local/src/python/flask-app-restart-demo/demo.py', reloading     
 * Restarting with stat                              
Traceback (most recent call last):                   
  File "/home/bpaterni/usr/local/src/python/venvs/venv-01/bin/flask", line 11, in <module>                
    sys.exit(main())                                 
  File "/home/bpaterni/usr/local/src/python/venvs/venv-01/lib/python3.5/site-packages/flask/cli.py", line 513, in main                                                                                              
    cli.main(args=args, prog_name=name)              
  File "/home/bpaterni/usr/local/src/python/venvs/venv-01/lib/python3.5/site-packages/flask/cli.py", line 380, in main                                                                                              
    return AppGroup.main(self, *args, **kwargs)      
  File "/home/bpaterni/usr/local/src/python/venvs/venv-01/lib/python3.5/site-packages/click/core.py", line 697, in main                                                                                             
    rv = self.invoke(ctx)                            
  File "/home/bpaterni/usr/local/src/python/venvs/venv-01/lib/python3.5/site-packages/click/core.py", line 1066, in invoke                                                                                          
    return _process_result(sub_ctx.command.invoke(sub_ctx))                                               
  File "/home/bpaterni/usr/local/src/python/venvs/venv-01/lib/python3.5/site-packages/click/core.py", line 895, in invoke                                                                                           
    return ctx.invoke(self.callback, **ctx.params)   
  File "/home/bpaterni/usr/local/src/python/venvs/venv-01/lib/python3.5/site-packages/click/core.py", line 535, in invoke                                                                                           
    return callback(*args, **kwargs)                 
  File "/home/bpaterni/usr/local/src/python/venvs/venv-01/lib/python3.5/site-packages/click/decorators.py", line 64, in new_func                                                                                    
    return ctx.invoke(f, obj, *args[1:], **kwargs)   
  File "/home/bpaterni/usr/local/src/python/venvs/venv-01/lib/python3.5/site-packages/click/core.py", line 535, in invoke                                                                                           
    return callback(*args, **kwargs)                 
  File "/home/bpaterni/usr/local/src/python/venvs/venv-01/lib/python3.5/site-packages/flask/cli.py", line 438, in run_command                                                                                       
    use_debugger=debugger, threaded=with_threads)    
  File "/home/bpaterni/usr/local/src/python/venvs/venv-01/lib/python3.5/site-packages/werkzeug/serving.py", line 737, in run_simple                                                                                 
    reloader_type)                                   
  File "/home/bpaterni/usr/local/src/python/venvs/venv-01/lib/python3.5/site-packages/werkzeug/_reloader.py", line 265, in run_with_reloader                                                                        
    sys.exit(reloader.restart_with_reloader())       
  File "/home/bpaterni/usr/local/src/python/venvs/venv-01/lib/python3.5/site-packages/werkzeug/_reloader.py", line 124, in restart_with_reloader                                                                    
    close_fds=False)                                 
  File "/home/bpaterni/usr/local/src/python/venvs/venv-01/lib/python3.5/site-packages/gevent/subprocess.py", line 234, in call                                                                                      
    with Popen(*popenargs, **kwargs) as p:           
  File "/home/bpaterni/usr/local/src/python/venvs/venv-01/lib/python3.5/site-packages/gevent/subprocess.py", line 554, in __init__                                                                                  
    restore_signals, start_new_session)              
  File "/home/bpaterni/usr/local/src/python/venvs/venv-01/lib/python3.5/site-packages/gevent/subprocess.py", line 1160, in _execute_child                                                                           
    self.pid = fork_and_watch(self._on_child, self._loop, True, fork)                                     
  File "/home/bpaterni/usr/local/src/python/venvs/venv-01/lib/python3.5/site-packages/gevent/os.py", line 375, in fork_and_watch                                                                                    
    watcher = loop.child(pid, ref=ref)               
  File "gevent.libev.corecext.pyx", line 518, in gevent.libev.corecext.loop.child (src/gevent/libev/gevent.corecext.c:7601)                                                                                         
  File "gevent.libev.corecext.pyx", line 1886, in gevent.libev.corecext.child.__init__ (src/gevent/libev/gevent.corecext.c:21676)                                                                                   
TypeError: child watchers are only available on the default loop
```

### Environment

* Python version: 3.5.4
* Flask version: 0.12.2
* Werkzeug version: 0.12.2
* grequests: 0.3.0
* gevent version: 1.2.2
* Click version: 6.7
### Expected Behavior

When given a tz-aware datetime object, I would expect jsonify to either raise an exception (because there is no native representation of a datetime in json) or at least convert it to a string format while keeping the timezone intact

```python
import flask
from datetime import datetime, timezone, timedelta

app = flask.Flask(__name__)

@app.route('/')
def index():
    tz = timezone(timedelta(hours=2))
    t = datetime(2017, 1, 1, 12, 0, 0, tzinfo=tz)
    return flask.jsonify(t)

with app.app_context():
    resp = app.test_client().get('/')
    print(resp.data)
```

### Actual Behavior

The datetime object is converted to a RFC 1123 date string, ignoring the timezone entirely and assuming GMT

```
b'"Sun, 01 Jan 2017 12:00:00 GMT"\n'
```

### Environment

* Python version: 3.6
* Flask version: 0.12.2
* Werkzeug version: 0.12.2

The behavior of the float converter not matching decimal-less values is a poor choice in my opinion.  The problem is that Javascript lacks separate number types, and it will happily produce decimal-less number values from operations on several floating point values (e.g. 0.5 + 0.5).  As a result, some combinations of user input cause a route with a float converter to fail to resolve.

I think better behavior would be for the float converter to match decimal-less values, but at a lower priority than the integer converter.  This would avoid the problem edge case route failures while still letting people define overlapping routes if they really wanted to.

### Environment

* Python version: 3.6.1
* Flask version: 0.12.2
* Werkzeug version: 0.12.2

Point to an authoritative site for Flask on App Engine that is maintained.

Describe what this patch does to fix the issue: updates link.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

### Unexpected Behavior

   I have a simple function to get json data from a website using "POST" method, for convenience, I save it as get_music.py file. Here is the code.
   ```python
import requests
def get_music():
    baseUrl = "http://music.163.com/api/search/get/"
    parameters = {
        's': "acg",
        'limit': 100,
        'type': 1
    }
    response = requests.post(baseUrl, data=parameters)
    answer = response.json()
    return answer
```
and when we call the function, a json data will returned, that's no problems. But when i call it in the views function, things become strange. here is views.py.
```python
from .get_music import get_music
from flask import render_template
from . import main

@main.route('/', methods=['GET', 'POST'])
def index():
    music = get_music()
    return render_template("index.html", music=music)
```
  When I run the flask program, the json data is " {'msg': "Request method 'GET' not supported", 'code': 400}", it's not correct. 
  After debug i found the request method is "GET" when i use flask, but if  run the get_music.py without flask , the request method is "POST". it's any problem in views funtion change the request method?

I have tried to download the documentation in PDF from the official site (http://flask.pocoo.org/) and the link there (http://flask.pocoo.org/docs/0.12/.latex/Flask.pdf) is returning error 404.
Small cosmetic change for the docs. 

The current screenshots in Flask's docs are 8 years old. These new ones have the same info but with a recent UI (the CSS for the debugger and the browser's UI has changed since).

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

The link `http://flask.pocoo.org/login/?provider=google` will not redirect to anywhere for me to input the OpenID from my google account. 

If I paste the OpenID from google into the `http://flask.pocoo.org/login` page, the following error message is always shown.
`Error: The OpenID was invalid`

Is this a bug? How to login with google?

### Expected Behavior

In debug mode, a very helpful call trace page comes up when an exception is thrown. Thanks for that!

A quick improvement would be to highlight the blocks which represent user's code. I believe this would give a decent speed boost when recognizing where errors come from. I think this could be as simple as giving a light red-tint on any code boxes which comes from the file defined in the FLASK_APP variable.

This would be unobtrusive, and would help speed up use for many users.

e.g. we could highlight this line:

![image](https://user-images.githubusercontent.com/328294/29567073-ffdc8b52-8743-11e7-95fd-be26eb6c93be.png)

Alternatively, the call trace could automatically collapse the 'app runner' code which the user is likely uninterested in.

Apologies if this place is for bugs only (not features)

Hi all,

I am building a chatbot. There are few child templates like login.html, messages.html, transaction.html, etc. I want to append these templates in base.html. I am extending base.html in all these templates. My problem is only one template is rendered at a time. Is there any solution for appending these templates one after another? I have used {%include%} but it's a static approach. I need dynamic.

printer.py looks like -

@app.route('/respond', methods=['GET','POST'])
def respond_def():
   message = request.form['message_input']
   if message == "l":
       return render_template('printer/login.html')
   elif message == "t":
       return render_template('printer/transactionID.html')
base.html looks like -

//some code here
<li>
    {% block template %}{% endblock %}
</li>
//some code here

message.html looks like -

{% extends "base.html" %}
{% block template %}
<div> Message template called </div>
{% endblock %}



I want to use `before_request` function to my `blueprint`. here is my usecase:


```
from flask import Flask, Blueprint, request, abort
from flask.views import MethodView


app = Flask(__name__)
system = Blueprint('system', __name__, url_prefix='/system')


@system.before_request
def auth():
    if not request.headers.get('token', None):
        abort(401)


class UserView(MethodView):
    def get(self):
        return 'user list'


class UserProfileView(MethodView):
    def get(self, id):
        return 'hello {}'.format(id)


system.add_url_rule('/user', view_func=UserView.as_view('user'))
system.add_url_rule('/user/<int:id>/profile', view_func=UserProfileView.as_view('user.profile'))

app.register_blueprint(system)

app.run(debug=True)

```

when I test `/system/user`, `auth` function can work, when I test `/system/user/1/profile` it doesn't work.

so I debug my code on shell:

```
In [1]: from test import app

In [2]: app
Out[2]: <Flask 'test'>

In [3]: app.blueprints
Out[3]: {'system': <flask.blueprints.Blueprint at 0x1020bc850>}

In [4]: from flask import request

In [5]: with app.test_request_context('/system/user'):
   ...:     print request.blueprint
   ...:
system

In [6]: with app.test_request_context('/system/user/1/profile'):
   ...:     print request.blueprint
   ...:
system.user
```

it's ridiculous!

so I read the [flask/wrapper.py](https://github.com/pallets/flask/blob/7c510199850957161240f081359e2246d8982be1/flask/wrappers.py#L152)

```
@property
def blueprint(self):
   """The name of the current blueprint"""
   if self.url_rule and '.' in self.url_rule.endpoint:
       return self.url_rule.endpoint.rsplit('.', 1)[0]
```

I know my view function endpoint name is not normative.

I think Blueprint endpoints should not contain dots. view function name can instead endpoint when endpoint is none, so view function name should not contain dots either.


sorry for my bad English. I'm shame it!



Is Flask Python3 compatible ?
### Expected Behavior
Normally, if you want a permanent cookie, you can set
```python
session.permanent = True
app.permanent_session_lifetime = datetime.timedelta(weeks=156)  # 3 years
```
However, if you also change `SESSION_COOKIE_NAME` in app.config to something else, this should only change the name of the cookie, however, it also makes the session cookies invalidate after a browser session, not the `permanent_session_lifetime`.

Demo:
```python
import datetime
from flask import Flask, session

app = Flask(__name__)
app.secret_key = 'super_secret'

@app.before_request
def settings():
    app.config['PERMANENT_SESSION_LIFETIME'] = datetime.timedelta(weeks=156)  # 3 years
    # app.config['SESSION_COOKIE_NAME'] = 'other_name'

@app.route('/')
def index():
    if 'test' in session:
        return 'You have a cookie'
    return 'You do not have a cookie'
    
@app.route('/get_cookie')
def get_cookie():
    session['test'] = 'testcookie'
    return 'Cookie sent'

app.run()
```

### Actual Behavior

If you run the above script, and visit `/get_cookie`, then visit `/`, notice that it works as expected. You can also close and reopen the browser, and the cookie stays, as expected, because of the `permanent_session_lifetime`.

However, if you uncomment the bit that sets the `SESSION_COOKIE_NAME`, then re-run the script, and follow the above steps again (including reopening the browser), you will notice that the session is invalidated upon reopening the browser.

### Environment

* Python version: 3.5.2
* Flask version: 0.12.2
* Werkzeug version: 0.12.2

Simple typos. (First pull request)

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

It's suggested to use pytest.fixture directly, and flask already requires 'pytest>=3'.



<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Adds a warning to the Flaskr tutorial to tell folks looking at a specific version of the docs, to be sure to check out the same tag in the repository, otherwise the tutorial may be different than the example. 

Issues with docs/code version mismatches reported in https://github.com/pallets/flask/issues/2437 and https://github.com/pallets/flask/issues/1902
I have a large response in the order of 2MB. I generate it in my Python code and send it back using jsonify(resp) and the server cut short the response and delivered partial response. - Issue 1

to overcome this issue I streamed the response into a file and exposed a GET api using send_from_directory(absolute_file_path, filename) - it sends back the file but has compressed some items like byte streams inside! 

Please find attached an example of this file.
[train_response.zip](https://github.com/pallets/flask/files/1209855/train_response.zip)


Casting the value received from the Web Server in the request object if it is a string

I'm using apache2 with libapache2-mod-wsgi-py3 When flask tries to convert the permanent_session_lifetime the following error appears.

```
[Mon Aug 07 20:22:54.177034 2017] [wsgi:error] [pid 21324:tid 139774833305344] [remote 172.17.0.1:38058] mod_wsgi (pid=21324): Exception occurred processing WSGI script '/var/www/app/web/run.wsgi'.
[Mon Aug 07 20:22:54.177830 2017] [wsgi:error] [pid 21324:tid 139774833305344] [remote 172.17.0.1:38058] Traceback (most recent call last):
[Mon Aug 07 20:22:54.177881 2017] [wsgi:error] [pid 21324:tid 139774833305344] [remote 172.17.0.1:38058]   File "/var/www/app/instance/venv/lib/python3.5/site-packages/flask/app.py", line 1998, in __call__
[Mon Aug 07 20:22:54.177889 2017] [wsgi:error] [pid 21324:tid 139774833305344] [remote 172.17.0.1:38058]     return self.wsgi_app(environ, start_response)
[Mon Aug 07 20:22:54.177902 2017] [wsgi:error] [pid 21324:tid 139774833305344] [remote 172.17.0.1:38058]   File "/var/www/app/instance/venv/lib/python3.5/site-packages/flask/app.py", line 1979, in wsgi_app
[Mon Aug 07 20:22:54.177908 2017] [wsgi:error] [pid 21324:tid 139774833305344] [remote 172.17.0.1:38058]     ctx.push()
[Mon Aug 07 20:22:54.177919 2017] [wsgi:error] [pid 21324:tid 139774833305344] [remote 172.17.0.1:38058]   File "/var/www/app/instance/venv/lib/python3.5/site-packages/flask/ctx.py", line 332, in push
[Mon Aug 07 20:22:54.177925 2017] [wsgi:error] [pid 21324:tid 139774833305344] [remote 172.17.0.1:38058]     self.session = self.app.open_session(self.request)
[Mon Aug 07 20:22:54.177935 2017] [wsgi:error] [pid 21324:tid 139774833305344] [remote 172.17.0.1:38058]   File "/var/www/app/instance/venv/lib/python3.5/site-packages/flask/app.py", line 913, in open_session
[Mon Aug 07 20:22:54.177941 2017] [wsgi:error] [pid 21324:tid 139774833305344] [remote 172.17.0.1:38058]     return self.session_interface.open_session(self, request)
[Mon Aug 07 20:22:54.177953 2017] [wsgi:error] [pid 21324:tid 139774833305344] [remote 172.17.0.1:38058]   File "/var/www/app/instance/venv/lib/python3.5/site-packages/flask/sessions.py", line 330, in open_session
[Mon Aug 07 20:22:54.177958 2017] [wsgi:error] [pid 21324:tid 139774833305344] [remote 172.17.0.1:38058]     max_age = total_seconds(app.permanent_session_lifetime)
[Mon Aug 07 20:22:54.177970 2017] [wsgi:error] [pid 21324:tid 139774833305344] [remote 172.17.0.1:38058]   File "/var/www/app/instance/venv/lib/python3.5/site-packages/flask/config.py", line 33, in __get__
[Mon Aug 07 20:22:54.177975 2017] [wsgi:error] [pid 21324:tid 139774833305344] [remote 172.17.0.1:38058]     rv = self.get_converter(rv)
[Mon Aug 07 20:22:54.177987 2017] [wsgi:error] [pid 21324:tid 139774833305344] [remote 172.17.0.1:38058]   File "/var/www/app/instance/venv/lib/python3.5/site-packages/flask/app.py", line 47, in _make_timedelta
[Mon Aug 07 20:22:54.177993 2017] [wsgi:error] [pid 21324:tid 139774833305344] [remote 172.17.0.1:38058]     return timedelta(seconds=value)
[Mon Aug 07 20:22:54.178022 2017] [wsgi:error] [pid 21324:tid 139774833305344] [remote 172.17.0.1:38058] TypeError: unsupported type for timedelta seconds component: str
```

With that pull, the permanent_session_lifetime and send_file_max_age_default will be converted correctly from string type value.
corrected wrong indentations in 'And Easy to Setup' section's paragraph.
URL to download documentation in PDF on http://flask.pocoo.org/

http://flask.pocoo.org/docs/0.12/.latex/Flask.pdf

returns

Chapter 404: The Lost Page
A careful and diligent search has been made for the desired page, but it just cannot be found.
And so they returned to familiar waters.
It would be useful to be able to decorate a blueprints or then pass it a function rather than adding decorators to each road.
For an admin module that requires admin privileges for example.

The added command `flask clean` can be used to remove all the `.pyc` and `.pyo` file recursively starting at the path to the root of the application. Similar to Flask-Script's `clean` command.
It's just small fix. 
Which should revert back support DEBUG variable from config instead of OS env.
Even if I followed the instruction sequences in the README file in the project flaskr, I still couldn't correctly run this application. It's so depressing. I have already seen another similar issue #1902, but it is not helpful.

Based on discussion in #2023 and #641, Flask interferes too much with logging. This patch greatly reduces the logging configuration that Flask does.

* Remove `LOGGER_NAME` and `LOGGER_HANDLER_POLICY` configuration.
* `app.logger` is always named `'flask.app'`. Use the `'flask'` namespace to allow other logging from Flask in the future.
* Don't use a `Logger` subclass to override `getEffectiveLevel`. Call `setLevel` when the logger is first accessed, based on `app.debug`, instead of checking `debug` for every message.
* Only one handler with one format is added, instead of different formats for production and development.
* A handler is only added if there are no handlers configured that would handle the logger's `getEffectiveLevel`.
* Handlers are never removed.
* The `default_handler` is accessible so that it can be passed to `removeHandler` in case the user wants to get rid of the default handler after it is configured.
* The proxy stream to `environ['wsgi.errors']` is exposed as `wsgi_errors_stream`, in case the user wants to use it in their own configuration.
* Logging documentation is split from error handling documentation and reorganized to address the key concepts.
* Added documentation for injecting request information into messages.
* Logging tests are split into a separate module.
* Some previously miscategorized tests are correctly organized.
How does one debug flask CLI commands from an IDE?
E.g. if I want to debug the `flask run` command, or even more importantly my custom commands (in my case, `flask initdb`).

Do I have to manually create a separate script file that executes the functions that I want to debug?
My Python Flask application contains a lot of route definitions like

```
@app.route('/')
def index():
```

Then pylint complains

    W: 72, 4: Unused variable 'index' (unused-variable)

which is technically correct.  I can't replace all the function names by `_`, say, because then Flask complains

    AssertionError: View function mapping is overwriting an existing endpoint function: _

I could replace all the handler function names with their underscore-prefixed equivalents, i.e. change `index` to `_index`, etc..  Is there another idiomatic way of dealing with this problem?

([I also asked this question on StackOverflow](https://stackoverflow.com/questions/45214742/idiomatic-way-to-stop-pylint-complaining-about-flask-route-unused-function-names) but got no responses.)

Hi, Where i use jsonify to return JSON response i can't change any http header. It is possible to make jsonify support this feature.

like use double underline param
```python
jsonify(a=1, b=2, __headers={'X-TOKEN': 'token'})
```


I think the documentation for http://flask.pocoo.org/docs/dev/patterns/distribute/ is mis-formatted when discussing `Tagging builds` when it shows:
```
    [egg_info] tag_build = .dev tag_date = 1

    [aliases] release = egg_info -RDb ”
```
Using TCP/5000 as the default port for flask may be a bad choice. I just had to debug a problem where I wasn't able to reach my service from outside of my network because the firewall (and I assume many firewalls do this) blocks incoming requests on port 5000.

This port is used for universal plug-and-play (UPNP) and it's considered a security problem if it's reachable from the internet says [source1](http://www.linklogger.com/TCP5000.htm) and [source2](https://www.grc.com/port_5000.htm).

I therefore suggest to change the default port or mention this possible problem in the [documentation](http://flask.pocoo.org/docs/dev/quickstart/#public-server) so others don't have to search for this problem as long as I did.
When providing https url in path ("https://example.com/")
we hope that we will get https scheme in environment


### Expected Behavior

[Tagging builds docs](http://flask.pocoo.org/docs/0.12/patterns/distribute/#tagging-builds) are unambiguous.

### Actual Behavior

Docs introduced confusion, as shown in [stack overflow question](https://stackoverflow.com/questions/45340747/python3-6-2-install-package-cause-error)

### Environment
None - problem is in docs.

### Suggested solution
- wrapping setup.cfg snippet with markdown, similar to other code snippets.
- making sure that encoding of this snippet is correct (likely an ASCII).
### Expected Behaviour

I register a route to serve avatar image directly on `app`:
```python
@app.route('/avatar/<filename>/<size>')
def avatar(filename, size='m'):
    path = current_app.config['AVATARS_UPLOAD_PATH']
    filename = '%s_%s.png' % (filename, size)
    return send_from_directory(path, filename)
```
Then I use this in template to get avatar:
```jinja
{{ url_for('avatar', filename=user.avatar, size='l') }}
```

### Actual Behaviour

I have four templates use this code, but only one template got the image, others got the error below:
```pytb
BuildError: Could not build url for endpoint 'avatar' with values ['size']. Did you forget to specify values ['filename']?
...
File "C:\Users\Administrator\projects\moments-dev\moments\templates\home\index.html", line 16, in block "page_content"
src="{{ url_for('avatar', filename=photo.author.avatar, size='s') }}">
File "c:\users\administrator\projects\moments-dev\venv\lib\site-packages\flask\helpers.py", line 333, in url_for
return appctx.app.handle_url_build_error(error, endpoint, values)
File "c:\users\administrator\projects\moments-dev\venv\lib\site-packages\flask\app.py", line 1805, in handle_url_build_error
reraise(exc_type, exc_value, tb)
File "c:\users\administrator\projects\moments-dev\venv\lib\site-packages\flask\helpers.py", line 323, in url_for
force_external=external)
File "c:\users\administrator\projects\moments-dev\venv\lib\site-packages\werkzeug\routing.py", line 1768, in build
raise BuildError(endpoint, values, method, self)
```
However, I actually did specify the `filename`, you can see it in error output.

Here is the templates structure:
```
templates/
    home/
        - photo.html ---- error
        - index.html ---- error
    user/
        - index.html ---- ok
    macros.html ---- error
```
 
I tried to request the URL, such as `http://127.0.0.1:5000/avatar/<filename>/<size>`, it works fine on every size.
### Environment

* Python version: 2.7
* Flask version: 0.12.2
* Werkzeug version: 0.12.2 
* OS: Windows 7

Example: 

```python
#min.py
from flask import Flask
app = Flask(__name__)


@app.route('/')
def hello_world():
```

```bash
FLASK_DEBUG=1 FLASK_APP=min.py python -m flask run 
```

### Expected Behavior

```
Traceback (most recent call last):
  File "/home/henniss/envs/min-flask/lib/python3.6/site-packages/flask/cli.py", line 189, in __call__
    rv = self._load_unlocked()
  File "/home/henniss/envs/min-flask/lib/python3.6/site-packages/flask/cli.py", line 176, in _load_unlocked
    self._app = rv = self.loader()
  File "/home/henniss/envs/min-flask/lib/python3.6/site-packages/flask/cli.py", line 237, in load_app
    rv = locate_app(self.app_import_path)
  File "/home/henniss/envs/min-flask/lib/python3.6/site-packages/flask/cli.py", line 90, in locate_app
    __import__(module)
  File "/home/henniss/gitlab/min-flask/min.py", line 6
    def hello_world():
                     ^
SyntaxError: unexpected EOF while parsing
```

### Actual Behavior
```
Traceback (most recent call last):
  File "/home/henniss/envs/min-flask/lib/python3.6/site-packages/flask/cli.py", line 189, in __call__
    rv = self._load_unlocked()
  File "/home/henniss/envs/min-flask/lib/python3.6/site-packages/flask/cli.py", line 176, in _load_unlocked
    self._app = rv = self.loader()
  File "/home/henniss/envs/min-flask/lib/python3.6/site-packages/flask/cli.py", line 237, in load_app
    rv = locate_app(self.app_import_path)
  File "/home/henniss/envs/min-flask/lib/python3.6/site-packages/flask/cli.py", line 90, in locate_app
    __import__(module)
File "/home/henniss/gitlab/min-flask/min.py", line 6
    def hello_world():
                     ^
SyntaxError: unexpected EOF while parsing
```

Note incorrect indentation on the 4th line from the end.

I know this seems super pedantic, but it seems to mean that flask-failsafe won't detect that it needs to reload when `min.py` changes, since it doesn't see that portion of the traceback. 

### Environment

* Python version: 3.6.1
* Flask version: 0.12.2
* Werkzeug version: 0.12.2

The main page [flask.pocoo.org](http://flask.pocoo.org/) points to the PDF, but it's unavailable
I understand the PDF could be also built from source, but it's much more convenient to have that link working.

**UPD:** found pdf [here](https://media.readthedocs.org/pdf/flask/stable/flask.pdf)
Otherwise it's unclear why you should be installing at all (the quickstart describes a hello.py file that doesn't require any installation). Resolves #2421.
### Expected Behavior

The reloader should keep working even on SyntaxError when using a custom cli entry point. Obviously it might be diffcult to make it work as is, so it might require the cli entry point to be written in a certain way for this to work. For example it should be in a separate file that is not modified often during app development and should import the app only from the `create_app` function. This might just require documenting this more clearly.

```python
import click
from flask import Flask
from flask.cli import FlaskGroup

app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello, World!'

@click.group(cls=FlaskGroup, create_app=lambda info: app)
def cli():
    pass

if __name__ == '__main__':
    cli()
```

```cmd
set FLASK_DEBUG=1
python app.py run
```

### Actual Behavior

Introucing a SyntaxError into the file will cause the reloader to exit.

### Environment

* Python version: 2.7.13
* Flask version: 0.12.2
* Werkzeug version: 0.12.2

### Expected Behavior

The reloader should work correctly even for an app in a package's `__init__.py` file.

In `hello/__init__.py`:
```python
from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello, World!'
```

```cmd
set FLASK_APP=hello
set FLASK_DEBUG=1
flask run
```

Than edit `__init__.py` and introduce a syntax error.

### Actual Behavior

I get the SyntaxError the first time I try to browse and afterwards get:

```pytb
Traceback (most recent call last):
  File "flask\cli.py", line 48, in find_best_app
    'using a factory function.' % modules.__name__)
NoAppException: Failed to find application in module "hello". Are you sure it contains a Flask application? Maybe you wrapped it in WSGI middleware or you are using a factory function.
```

### Cause

This is caused by weird CPython behavior which might be a bug:
```py
>>> __import__('syntax_error')
...
SyntaxError: ...
>>> a = __import__('syntax_error')  # woot it works?!
>>> a.__file__
'<path to the directory containing __init__.py>'  # Instead of path to __init__.py
```

After the `SyntaxError` in the app, the Wekzeug reloader won't know about the `__init__.py` file any more since it iterates `sys.modules` and the entry there contains the path to the directory instead of the path to the `__init__.py` file, and Flask will call `__import__` repeatedly but will get the weird empty module and will fail to find an app in it, leading to the described exception.

### Environment

* Python version: 2.7.13
* Flask version: 0.12.2
* Werkzeug version: 0.12.2

Not sure if this happens in Python 3.
I was struggling to identify how to reduce the time possible for a replay attack. I came across [this stackoverflow answer](https://stackoverflow.com/a/25137976/5179470) which provided me the necessary information - hence updating here.
Step 3 of the tutorial ([installing flaskr as a package](http://flask.pocoo.org/docs/0.12/tutorial/packaging/)) needs rationale at the top. As it stands, that section of the tutorial tells the user out of the blue that they should install their webapp as a package, but doesn't say why. The user can already run their webapp via `flask run`, so it's not clear why they should at this point set up and install their package into their venv.

Really simple bug. 
Readme file in flaskr has a typo, there shouldn't be parentheses at the end of this line:
export FLASK_APP=flaskr.factory:create_app()


See #2417. Same thing except for 0.11.x instead of 0.12.x

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

...from 0.12.x documentation. i.e. here: http://flask.pocoo.org/docs/0.12/extensiondev/#ext-import-transition

I noticed that the live documentation for 0.12.x has this paragraph on the current stable version saying that the flask.ext. namespace should be used. This is deprecated since 0.11.x right? The development version has that paragraph removed, so I just did the same for this branch.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

If installed, [python-dotenv](https://github.com/theskumar/python-dotenv#readme) is used to load environment variables from `.env` and `.flaskenv` files. Manual vars override `.env`, which overrides `.flaskenv`. `.flaskenv` is intended for public vars, `.env` is intended for private vars that won't be committed to the repository.

The working directory is set to the location of the files, with the assumption that they are in the top level of the project, to facilitate local package imports (#2383).

The files are only loaded when calling the `flask` command or `app.run`, and can be disabled by passing `load_dotenv=False` to a custom `FlaskGroup` or `app.run`. If a user wants to load dotenv files in production, they can call `flask.cli.load_dotenv` manually from a `wsgi.py` file.

Closes #2375
Based off #2164 

---

Example, assuming python-dotenv is installed:

`flaskr/app.py`:

```python
from flask import Flask

def create_app():
    return Flask('flaskr')
```

`.flaskenv`:

```
FLASK_APP=flaskr.app
```

```
flask run
# no need to set FLASK_APP
# no need for intermediate file to call create_app
```
I created simple script using flask, it run smoothly, but when using `app.run(debug=True)` it returns 404 error
Run with:
`export FLASK_APP=main.py`

`flask run`


```python
from flask import Flask,request
app = Flask(__name__)
app.run(debug=True)
@app.route('/')
def hello_world():
    return 'hellow'
```

It return 404 error

```pytb
127.0.0.1 - - [15/Jul/2017 16:41:56] "GET / HTTP/1.1" 404 -
127.0.0.1 - - [15/Jul/2017 16:43:03] "GET /favicon.ico HTTP/1.1" 404 -

```

### Environment

* Python version: 3.5.3
* Flask version: 0.12.2
* Werkzeug version: 0.12.1

This drops the requirement where `FLASK_APP` had to point to a `.py` file for packages that were not installed in develop mode. If the file is not importable, it will fail later in the loading process.

Also adds some more tests for the loading mechanism and refactors the tests with `pytest.mark.parametrize`.

Closes #2377 
### Expected Behavior

The flaskr example code (in examples/flaskr) should work off-the-shelf. But I was able to reproduce the following issue by forking a clean copy of the repository and following the instructions in the README.md of the flaskr example. Namely, these are the commands I'm executing:

```
$ git clone https://github.com/alexander-jiang/flask.git
$ cd flask/examples/flaskr
$ virtualenv venv
$ venv\Scripts\activate
$ pip install -e .
$ set FLASK_APP=flaskr.factory:create_app()
$ flask initdb
$ flask run
```

### Actual Behavior

The `flask initdb` command fails with a `RuntimeError`:
```pytb
Traceback (most recent call last):
  File "c:\users\xxxxxxxxx\appdata\local\programs\python\python36-32\Lib\runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "c:\users\xxxxxxxxx\appdata\local\programs\python\python36-32\Lib\runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "C:\Users\xxxxxxxxx\flask\examples\flaskr\venv\Scripts\flask.exe\__main__.py", line 9, in <module>
  File "c:\users\xxxxxxxxx\flask\examples\flaskr\venv\lib\site-packages\flask\cli.py", line 513, in main
    cli.main(args=args, prog_name=name)
  File "c:\users\xxxxxxxxx\flask\examples\flaskr\venv\lib\site-packages\flask\cli.py", line 380, in main
    return AppGroup.main(self, *args, **kwargs)
  File "c:\users\xxxxxxxxx\flask\examples\flaskr\venv\lib\site-packages\click\core.py", line 697, in main
    rv = self.invoke(ctx)
  File "c:\users\xxxxxxxxx\flask\examples\flaskr\venv\lib\site-packages\click\core.py", line 1061, in invoke
    cmd_name, cmd, args = self.resolve_command(ctx, args)
  File "c:\users\xxxxxxxxx\flask\examples\flaskr\venv\lib\site-packages\click\core.py", line 1100, in resolve_command
    cmd = self.get_command(ctx, cmd_name)
  File "c:\users\xxxxxxxxx\flask\examples\flaskr\venv\lib\site-packages\flask\cli.py", line 351, in get_command
    rv = info.load_app().cli.get_command(ctx, name)
  File "c:\users\xxxxxxxxx\flask\examples\flaskr\venv\lib\site-packages\flask\cli.py", line 237, in load_app
    rv = locate_app(self.app_import_path)
  File "c:\users\xxxxxxxxx\flask\examples\flaskr\venv\lib\site-packages\flask\cli.py", line 109, in locate_app
    % module)
RuntimeError: Failed to find application in module "flaskr.factory"
```

### Environment

* OS: Windows 10 (64 bit)
* Python version: 3.6.1
* Flask version: 0.12.2
* Werkzeug version: 0.12.2

This allows passing an `EnvironBuilder` or `dict` as the only argument to `flask.testing.FlaskClient.open`, similar to `werkzeug.test.Client.open`. Since `FlaskClient` does some other configuration for the environ, this makes sure that a passed environ is copied and modified appropriately.

closes #2411

In a normal test client from werkzeug you can pass the environment builder in. With Flask that is currently not possible. In some situations people might want to interface with the builder directly.
I recently converted an old managing script to use Flask's built in CLI instead. I have a table for clients that are identified using a shortname/slug. I thought about using Click's argument callback for this. Given a shortname my function would get an instance of the client from my ORM. The problem is that the application context is not active when the callback is run.

### Expected Behavior

Since many scripts will rely on a database connection it makes sense to have the application context be available in arguments.

```python
import click
from flask import current_app, Flask

app = Flask("demo")

def example_callback(ctx, param, value):
    # Access the application context to trigger an exception
    click.echo(current_app.config)
    return {"id": 1, "shortname": value}

@app.cli.command()
@click.argument("arg", callback=example_callback)
def view(arg):
    click.echo(arg)
```

I run this using `flask view foobar`.

### Actual Behavior

```pytb
Traceback (most recent call last):
  File "/dev/flask-cli-demo/venv/bin/flask", line 11, in <module>
    sys.exit(main())
  File "/dev/flask-cli-demo/venv/local/lib/python2.7/site-packages/flask/cli.py", line 513, in main
    cli.main(args=args, prog_name=name)
  File "/dev/flask-cli-demo/venv/local/lib/python2.7/site-packages/flask/cli.py", line 380, in main
    return AppGroup.main(self, *args, **kwargs)
  File "/dev/flask-cli-demo/venv/local/lib/python2.7/site-packages/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/dev/flask-cli-demo/venv/local/lib/python2.7/site-packages/click/core.py", line 1064, in invoke
    sub_ctx = cmd.make_context(cmd_name, args, parent=ctx)
  File "/dev/flask-cli-demo/venv/local/lib/python2.7/site-packages/click/core.py", line 621, in make_context
    self.parse_args(ctx, args)
  File "/dev/flask-cli-demo/venv/local/lib/python2.7/site-packages/click/core.py", line 880, in parse_args
    value, args = param.handle_parse_result(ctx, opts, args)
  File "/dev/flask-cli-demo/venv/local/lib/python2.7/site-packages/click/core.py", line 1404, in handle_parse_result
    self.callback, ctx, self, value)
  File "/dev/flask-cli-demo/venv/local/lib/python2.7/site-packages/click/core.py", line 78, in invoke_param_callback
    return callback(ctx, param, value)
  File "/dev/flask-cli-demo/app.py", line 8, in example_callback
    click.echo(current_app.config)
  File "/dev/flask-cli-demo/venv/local/lib/python2.7/site-packages/werkzeug/local.py", line 347, in __getattr__
    return getattr(self._get_current_object(), name)
  File "/dev/flask-cli-demo/venv/local/lib/python2.7/site-packages/werkzeug/local.py", line 306, in _get_current_object
    return self.__local()
  File "/dev/flask-cli-demo/venv/local/lib/python2.7/site-packages/flask/globals.py", line 51, in _find_app
    raise RuntimeError(_app_ctx_err_msg)
RuntimeError: Working outside of application context.
```

### Environment
```
click==6.7
Flask==0.12.2
itsdangerous==0.24
Jinja2==2.9.6
MarkupSafe==1.0
pkg-resources==0.0.0
Werkzeug==0.12.2
```

### Workaround
The only workaround I've found is doing the same thing `@with_appcontext` does which is:

```python
with ctx.ensure_object(ScriptInfo).load_app().app_context():
```

Using `@with_appcontext` on `example_callback` doesn't work since that gives a warning about using a deprecated function signature (from before Click 2.0).

### Why is this a problem?
This results in two separate instantiations of my ORM. Some ORM's (like the one I'm using) doesn't allow sharing objects across instances (for good reason) which makes the client object I produce unusable anyway.
I had asked to clarify the behavior for in the IRC channel on [2017-07-01](https://botbot.me/freenode/pocoo/2017-07-01/?tz=America/Los_Angeles) and [2017-07-03](https://botbot.me/freenode/pocoo/2017-07-03/?tz=America/Los_Angeles) but did not get a reply.

So I've updated the documentation and regression tests to prove and clarify that [Flask.teardown_appcontext()](http://flask.pocoo.org/docs/0.11/api/#flask.Flask.errorhandler) only receives **unhandled** exceptions.
- [x] Added tests that fail without the patch
- [x] Ensured all tests pass with ``pytest``
- [x] Added documentation to the relevant docstrings or pages

Since the application code was _not_ modified:
* No ``versionadded`` or ``versionchanged`` directives were added
* No changelog entry was added


### Environment

* Python version: 3.5
* Flask version: 0.12

Notes and suggestions from working through the 0.12 Tutorial:

* Step 1

So ... do I run this schema.sql file? Will Flask run it for me?


* Step 2

That "import ... g ..."" looks like a typo. I left it out until I
read step 4.

"The SECRET_KEY is needed..."
What do real systems do? No need to go into details, just mention
something. SHA1? SSH keys?


* Step 3

"Flask is now shipped with built-in support for Click."
That's nice I guess, but what does it have to do with anything else
in this step?

"A useful pattern to manage a Flask application..."
Why? Will it make deployment in my production environment easier? To
other people? What happens if I don't?

It would be better if the text said which directory to use
before the command


* Step 4

"def get_db():"

Looks like an unsafe singleton. Does Flask use threads or processes?

"Hint: Where do I put this code?"

I'd been using Flask for 30 minutes, I had no idea where to put the
code. This should be at the start.


* Step 5

    (flask) /home/hugh/Flask/Tutorial/flaskr/$ flask initdb
    Usage: flask [OPTIONS] COMMAND [ARGS]...

    Error: No such command "initdb".

Hmm, function has to have same name as in decorator?
No

Maybe the command is really flask --initdb?
No

Have I screwed up the environment var?
    $ flask run
That seems to work.

(And yes I worked out shortly afterwards that this is an illusion, trying
to load a page will throw a "does not appear to exist" exception.)

    $ cd flaskr
    $ flask initdb
Aha!

General note: having two identically named dirs is confusing, need
to be clearer about where you should be at each step


Useful exercise that could be added:

If you want the second database attribute, the blog entry HTML, to
be named "body" instead of "text", how many files do you need to edit?


http://jsn-techtips.blogspot.com/2016/02/set-up-logging-with-flask-and-gunicorn.html

I have 2 RHEL 6 unix servers. There are slight differences in between the versioning listed below. One server is already set-up and it is working well following the steps from the above link to configure logging integrated with gunicorn log file. However, when i followed the same approach to configure in a newer versions environment, those app.logger.info() message did not log to the gunicorn log file. I suspect it may be due to the change in 0.12 release. Any idea? 

Version 0.12
Released on December 21st 2016, codename Punsch.
...
**Disable logger propagation by default for the app logger.**
...

### Environment
Working Environment
* Python version: 2.7.12
* Flask version: 0.11.1
* Werkzeug version: 0.11.11

Not Working Environment
* Python version: 2.7.13
* Flask version: 0.12.0
* Werkzeug version: 0.11.15

**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Jinja or issues not related to Jinja.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](http://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

Tell us what should happen.
I open my command line tool  and then run "pip install Flask'
It shows the exception ,I am new here about python.So pls give me some tips to solve it 

```python
Paste a minimal example that causes the problem.
```

### Actual Behavior

Tell us what happens instead.

```pytb
Paste the full traceback if there was an exception.
```
Collecting Flask
  Using cached Flask-0.12.2-py2.py3-none-any.whl
Collecting itsdangerous>=0.21 (from Flask)
  Using cached itsdangerous-0.24.tar.gz
Collecting Werkzeug>=0.7 (from Flask)
  Using cached Werkzeug-0.12.2-py2.py3-none-any.whl
Collecting Jinja2>=2.4 (from Flask)
  Downloading Jinja2-2.9.6-py2.py3-none-any.whl (340kB)
    100% |████████████████████████████████| 348kB 239kB/s
Collecting click>=2.0 (from Flask)
  Downloading click-6.7-py2.py3-none-any.whl (71kB)
    100% |████████████████████████████████| 71kB 207kB/s
Collecting MarkupSafe>=0.23 (from Jinja2>=2.4->Flask)
  Downloading MarkupSafe-1.0.tar.gz
Installing collected packages: itsdangerous, Werkzeug, MarkupSafe, Jinja2, click, Flask
  Running setup.py install for itsdangerous ... error
    Complete output from command /usr/bin/python -u -c "import setuptools, tokenize;__file__='/private/var/folders/fd/g2bjwxln7t12740h9w8pc1p40000gn/T/pip-build-c2g0Ki/itsdangerous/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\r\n', '\n');f.close();exec(compile(code, __file__, 'exec'))" install --record /var/folders/fd/g2bjwxln7t12740h9w8pc1p40000gn/T/pip-aTf7nB-record/install-record.txt --single-version-externally-managed --compile:
    running install
    running build
    running build_py
    creating build
    creating build/lib
    copying itsdangerous.py -> build/lib
    running install_lib
    copying build/lib/itsdangerous.py -> /Library/Python/2.7/site-packages
    error: [Errno 13] Permission denied: '/Library/Python/2.7/site-packages/itsdangerous.py'

    ----------------------------------------
Command "/usr/bin/python -u -c "import setuptools, tokenize;__file__='/private/var/folders/fd/g2bjwxln7t12740h9w8pc1p40000gn/T/pip-build-c2g0Ki/itsdangerous/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\r\n', '\n');f.close();exec(compile(code, __file__, 'exec'))" install --record /var/folders/fd/g2bjwxln7t12740h9w8pc1p40000gn/T/pip-aTf7nB-record/install-record.txt --single-version-externally-managed --compile" failed with error code 1 in /private/var/folders/fd/g2bjwxln7t12740h9w8pc1p40000gn/T/pip-build-c2g0Ki/itsdangerous/
### Environment

* Python version:2.7
* Flask version:
* Werkzeug version:

I have defined a custom json encoder that supports encoding a bson ObjectId() into a string (see below for encoder code).

This works great until I attempt to serialize a dictionary who's key is an ObjectId(). The custom encoder seems to only work for dictionary values.

To reproduce the bug, see the /test_json2 route in the example below :

```python
import bson
@app.route("/test_json", methods=['GET'])
def test_json():
    test = {
        'a': bson.objectid.ObjectId("595d5f4c4588b817c4030277")
    }
    return flask.jsonify(test=test)

@app.route("/test_json2", methods=['GET'])
def test_json2():
    test = {
        bson.objectid.ObjectId("595d5f4c4588b817c4030277"): 'a'
    }
    return flask.jsonify(test=test)
```

Custom json encoder code : 

```python
import bson
from flask.json import JSONEncoder

class CustomJSONEncoder(JSONEncoder):
    '''custom json encoder that supports mongo's ObjectID()
out of the box
    '''
    def default(self, obj):
        if isinstance(obj, bson.objectid.ObjectId):
            return str(obj)
        return JSONEncoder.default(self, obj)

app.json_encoder = CustomJSONEncoder
```

Using 
Werkzeug==0.12.2
Flask==0.12.2
### Expected Behavior

When using Flask json to encode, datetime is encoded to a string and it would be expected that the reverse operation also works.

```python
>>> import datetime
>>> from flask import json
>>> json.dumps({'a': datetime.datetime.utcnow()})
'{"a": "Mon, 03 Jul 2017 09:13:33 GMT"}'
>>> json.loads(json.dumps({'a': datetime.datetime.utcnow()}))
{'a': 'Mon, 03 Jul 2017 09:13:42 GMT'}
```
Expected would be
```python
>>> json.loads(json.dumps({'a': datetime.datetime.utcnow()}))
{'a': datetime.datetime(2017, 7, 3, 9, 13, 42, 564641)}
```

### Environment

* Python version: 3.6.0
* Flask version: 0.12
* Werkzeug version: 0.11.15

Describe what this patch does to fix the issue.
Removed the unused import of `pickle` in `tests/test_basic`.

Link to any relevant issues or pull requests.

Pickle isn't used explicitly in the file, and I ran the tests and they all still pass.

When `flask.render_template_string()` is invoked with the same template string multiple times, it still compiles it on every invocation. This makes it pretty much unusable in any application where performance is of any concern.

As a dirty workaround, I use memoized version.
It only makes sense if template strings are not generated dynamically, but that sounds like a reasonable assumption.

```python
import flask.globals
import flask.templating

_compiled_templates = {}

def memoized_render_template_string(source, **context):
    """Same as flask.render_template_string(), but does not recompile.

    No cache expiration.
    Assumes that Jinja environment configuration does not change at runtime.
    """
    ctx = flask.globals._app_ctx_stack.top
    ctx.app.update_template_context(context)
    jinja_env = ctx.app.jinja_env
    k = jinja_env, source
    if k in _compiled_templates:
        template = _compiled_templates[k]
    else:
        template = _compiled_templates[k] = jinja_env.from_string(source)
    return flask.templating._render(template, context, ctx.app)
```

Perhaps this problem should be addressed in the actual implementation of `render_template_string()`?
I'm not sure what would be the proper way to do it, though.
see https://github.com/pallets/flask/issues/2400

### Expected Behavior

On the "Deploying With Setuptools page", the [setup.cfg code snippet](http://flask.pocoo.org/docs/0.12/patterns/distribute/#tagging-builds) should look like this:
```
[egg_info]
tag_build = .dev
tag_date = 1

[aliases]
release = egg_info -RDb
```



### Actual Behavior

Instead it looks like this:
```
[egg_info] tag_build = .dev tag_date = 1

[aliases] release = egg_info -RDb ”
```
Also note the  erroneous quotation mark at the end.
### Environment

* Python version: N/A
* Flask version: N/A
* Werkzeug version: N/A

consistent key across docs and examples
set test key in conftest
@davidism looks like you've made a small mistake in how the module variable is replaced in the error message when you edited my commit from a few days ago. This should address it.
After much discussion in #1421, I was not convinced there was a direct need to deprecate `Request.json`. It's existence is consistent with other parts of the API and it does not interfere with other properties.

Note that it still may be deprecated in the future if a need arises, but that's not now.
#2385
`flask.ext` was deprecated a year ago when 0.12 was released. We've contacted as many extensions as possible to fix docs and examples, I update Stack Overflow questions as I come across them, and most new questions do not use the old form. It's safe to remove at this point and should not be present in 1.0.

#2385
* `Flask.error_handlers`
* `Flask.static_path`
* `Request.module`

#2385
Refs issue #2385 

- Removed deprecated `init_jinja_globals` method
- Removed deprecated `_get_request_globals_class`and `_set_request_globals_class`


### Expected Behavior
Flask's `jsonify` response incorrectly marks the timezone when stringing the datetime object. It always contains the string `GMT`, regardless of if the datetime object is not naive or has tzinfo set.

I originally suspected it may be something to do with the http_date function, which is called on the datetime object if its detected. However, when I print `http_date(time)` on the object it correctly converts the time zone to GMT.

I believe that this logic is somehow incorrectly identifying the object as a `date` object and not `datetime`, and thusly calling `timetuple()` (which has this affect) and not `utctimetuple()` which maintains the time).

```
   65         if isinstance(o, datetime):
   66             return http_date(o.utctimetuple())
   67         if isinstance(o, date):
   68             return http_date(o.timetuple())
```

### Tell us what should happen.
A `jsonify`'d response should print the correct datetime 3-letter timezone abbreviation according to the datetime's tzinfo response. Or, if forcing a converstion to GMT, should correctly convert the object to GMT time from its localized time zone.

The below jsonify'd/stringed 3-letter time-zone response says `GMT`, but the datetime object is PDT. The time in the response is also in PST and has not been converted to GMT.

```
"Fri, 23 Jun 2017 17:12:18 GMT"
```

```python
#!/usr/bin/env python2.7

from werkzeug.http import http_date
from datetime import datetime
import pytz

from flask import Flask, jsonify

app = Flask(__name__)

@app.route('/')
def root():
    # Localize time
    local_time = pytz.timezone("America/Los_Angeles")
    time = datetime.utcnow().replace(microsecond=0).replace(tzinfo=pytz.utc)
    time = time.astimezone(local_time)

    print("iso format:", time.isoformat())
    print("object:", time.tzinfo)
    print("http date:", http_date(time))

    result = [time]

    print("Test object: %s" % result)

    return jsonify(result)

app.run(host='127.0.0.1', port=8080, debug=False)
```

### Actual Behavior
Webserver returns response with GMT timezone with localized time:

```
[
"Fri, 23 Jun 2017 17:12:18 GMT"
]
```

The logs in the console correctly identify the datetime object as PDT:
```
('iso format:', '2017-06-23T17:28:11-07:00')
('object:', <DstTzInfo 'America/Los_Angeles' PDT-1 day, 17:00:00 DST>)
('http date:', 'Sat, 24 Jun 2017 00:28:11 GMT')
Test object: [datetime.datetime(2017, 6, 23, 17, 28, 11, tzinfo=<DstTzInfo 'America/Los_Angeles' PDT-1 day, 17:00:00 DST>)]
127.0.0.1 - - [23/Jun/2017 17:28:11] "GET / HTTP/1.1" 200 -
```

### Environment

* Python version: 2.7 or 3.6 (affects both in identical way)
* Flask version: Flask==0.12.2
* Werkzeug version: Werkzeug==0.12.2

Running Flask with an SSL context that uses cert files which the process does not have permission to results in a silent fail on the server.

Allowing the process to have access to the files fixes this problem.

Server code used:
```python
from flask import Flask

app = Flask(__name__)

@app.route('/')
def hello:
    return 'hi'

if __name__ == '__main__':
    context = ('/path/to/cert.pem','/path/to/key.pem')
    app.run(debug=True, ssl_context=context)
```

### Expected Behavior
A stack saying the process cannot access the cert files. Ideally this trace would appear during startup before the first request is made.

For example, when using pyopenssl with the same files, the following trace is thrown on startup:

```pytb
Traceback (most recent call last):
  File "server.py", line 20, in <module>
    context.use_privatekey_file('/path/to/private/key.pem')
  File "/home/user/.virtualenvs/dev/local/lib/python2.7/site-packages/OpenSSL/SSL.py", line 798, in use_privatekey_file
    self._raise_passphrase_exception()
  File "/home/user/.virtualenvs/dev/local/lib/python2.7/site-packages/OpenSSL/SSL.py", line 777, in _raise_passphrase_exception
    _raise_current_error()
  File "/home/user/.virtualenvs/dev/local/lib/python2.7/site-packages/OpenSSL/_util.py", line 54, in exception_from_error_queue
    raise exception_type(errors)
OpenSSL.SSL.Error: [('system library', 'fopen', 'Permission denied'), ('BIO routines', 'FILE_CTRL', 'system lib'), ('SSL routines', 'SSL_CTX_use_PrivateKey_file', 'system lib')]
```

### Actual Behavior

After a request, the server returns a 200 response and disconnects the socket:

- `curl` clients receive a 200 and then throw errno 35 (Unknown SSL protocol error in connection to [secure site]:443).

- `nc` clients return a 200 and immediately disconnect.

- Web browsers report the following error:
<img width="645" alt="screenshot 2017-06-24 09 53 44" src="https://user-images.githubusercontent.com/484926/27503820-94e6307c-58c3-11e7-8532-ebf58700fce1.png">


What makes this problem worse is that Flask does not acknowledge that an attempted connection was made. Throughout all three of the above requests this is all that Flask printed in debug mode:

```
 * Running on https://0.0.0.0:5000/ (Press CTRL+C to quit)
 * Restarting with stat
 * Debugger is active!
 * Debugger pin code: 000-000-000
```

### Environment

* Python version: 2.7.6
* Flask version: 0.12.2 (also tested on 0.10.1)
* Werkzeug version: 0.12.2 (also tested on 0.11.5)



### Expected Behavior

I expected to be able to hand flask.request.stream to flask.json.load() in order to get a Python object back. flask.request.stream provides a bytes interface which the built-in python module doesn't like (it wants string) and the flask.json module has a couple of bits of code to work around this, so I expected it to work.

See attached file (reproduced here: https://gist.github.com/flexo/5cf4fde37f7b066fb6c7a77cb7416883 )
[test.py.zip](https://github.com/pallets/flask/files/1098240/test.py.zip)


### Actual Behavior

An exception is raised because LimitedStream has no 'readable' attribute. Possibly this makes it a bug in Werkzeug rather than Flask but since Flask provided the json module I thought it'd be best to report it here first.

```pytb
Traceback (most recent call last):
  File "[...]/venv/lib/python3.5/site-packages/flask/app.py", line 1982, in wsgi_app
    response = self.full_dispatch_request()
  File "[...]/venv/lib/python3.5/site-packages/flask/app.py", line 1614, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "[...]/venv/lib/python3.5/site-packages/flask/app.py", line 1517, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "[...]/venv/lib/python3.5/site-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "[...]/venv/lib/python3.5/site-packages/flask/app.py", line 1612, in full_dispatch_request
    rv = self.dispatch_request()
  File "[...]/venv/lib/python3.5/site-packages/flask/app.py", line 1598, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "[...]/test.py", line 31, in errors
    data = json.load(request.stream)
  File "[...]/venv/lib/python3.5/site-packages/flask/json.py", line 154, in load
    fp = _wrap_reader_for_text(fp, kwargs.pop('encoding', None) or 'utf-8')
  File "[...]/venv/lib/python3.5/site-packages/flask/json.py", line 37, in _wrap_reader_for_text
    fp = io.TextIOWrapper(io.BufferedReader(fp), encoding)
AttributeError: 'LimitedStream' object has no attribute 'readable'
```

### Environment

* Python version: 3.5.3
* Flask version: 0.12.2
* Werkzeug version: 0.12.2



### Expected Behavior

According to this [README](https://github.com/pallets/flask/blob/master/examples/flaskr/README) the Flaskr example application should run after doing following:

`pip install --editable .`
`export FLASK_APP=flaskr.factory:create_app()`
`flask initdb`
`flask run`

### Actual Behavior

Flaskr fails running throwing a NoAppException.

```pytb
NoAppException: The file/path provided (flaskr.factory) does not appear to exist.  Please verify the path is correct.  If app is not on PYTHONPATH, ensure the extension is .py
```

### Environment

* Python version: 2.7
* Flask version: 0.12.2
* Werkzeug version: 0.12.2


### Expected Behavior

Import the Python-Markdown module and run the Flask app

```python
# flask_test.py
from flask import Flask
import markdown

app = Flask(__name__)

@app.route('/')
def index():
    return 'Hello, world!'
```

### Actual Behavior

```shell
export FLASK_APP=flask_test.py
flask run

Usage: flask-script.py run [OPTIONS]

Error: The file/path provided (flask_test) does not appear to exist.  Please verify the path is correct.  If app is not on PYTHONPATH, ensure the extension is .py
```

If I simply comment out the `import markdown` line, the app launches/works just fine.

### Environment

* Python version: 2.7.12
* Flask version: 0.12
* Werkzeug version: 0.11.2
* Python-Markdown version: 2.6.8

I'm running on Windows 10 using Git Bash (mintty), which lets me use `export` instead of `set` for `FLASK_APP`. However I found that `set` doesn't change the outcome.
I wrote command-line utility to generate a secure random string. It can be used, for example, to set Flask's `SECRET_KEY`.
The command is called with `flask generate-secret [--length <length>]` (length defaults to 30).
Remove old code that has deprecation warnings:

- [x] **`Flask.ext`**
- [x] `Flask.init_jinja_globals`
- [x] `Flask.error_handlers`
- [x] `Flask.request_globals_class`
- [x] `Flask.static_path`
- [x] ~`send_file` mimetype guessing~ removed in 0.12 #1849
- [x] `Request.module`
- [x] `scripts/flask-07-upgrade.py`
I found that using send_file() to serve video (mp4) files works fine but the same content is not served using send_from_directory(). Only small parts (hundreds of bytes) are delivered to browser.
On Firefox video embedded through \<video\> tags is playable in most cases but opened directly from address bar not. On Chrome both methods are not working.

With x-sendfile switched off, send_from_directory() works ok.

Tested on:
Debian: python 3.5.3, flask  0.12.2, apache 2.4.25, mod_wsgi 4.5.11
Ubuntu: python 3.5.2, flask 0.12.2, apache 2.4.18, mod_wsgi 4.3.0
Addresses #2377. The simplest way that I found to do this was to just patch the `find_default_import_path` method to check if there's a file with the `.py` extension.

Worked in all of my testing. 🙂 
<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

If you create a file called `site.py` which defines your Flask app, and then set the env var as `FLASK_APP="site.py"`, Flask will find the file but it can't find the application instance. 

```
Traceback (most recent call last):
  File "/asdf/venv/lib/python3.4/site-packages/flask/cli.py", line 48, in find_best_app
    'using a factory function.' % module.__name__)
flask.cli.NoAppException: Failed to find application in module "site".  Are you sure it contains a Flask application?  Maybe you wrapped it in a WSGI middleware or you are using a factory function.
```

This looks like an issue with Flask importing a third party (+system) module instead of a local module. When appending a `.py` extension, it should be treated as a path, not a python import. However, even if I do a full absolute path to the file, it looks like it's still treating it as a third party module.

You can also reproduce this issue by testing out different entrypoint names: os, string, flask.

Folder structure: http://i.imgur.com/CR88kUo.png

requirements.txt

```
Flask==0.12.1
Flask-SQLAlchemy==2.2
Jinja2==2.9.6
MarkupSafe==1.0
SQLAlchemy==1.1.10
Werkzeug==0.12.1
click==6.7
itsdangerous==0.24
```
The in memory uri was bad.
Hi,

Is there any reason the view function name is used as the default endpoint? Taken `view_func.__name__` as the default endpoint name I have to specify endpoints myself if my view functions are all subclassed from a same class and call a same method, or an `View function mapping is overwriting an existing endpoint function` error will be raised, which is not good for reusability.

Take the example below:
```python
class APIBase():
    def call(self, **kwargs):
        # assign url variables to self
        for k, v in kwargs.iteritems():
            self.setattr(k, v)
        m = getattr(self, request.method)
        m()

class DuckAPI(APIBase):
    def post(self):
        pass

class ChickenAPI(APIBase):
    def post(self):
        pass

context.route('/duck/<duck_id>', *args, **kwargs)(DuckAPI().call)
context.route('/chicken/<chicken_id>', *args, **kwargs)(ChickenAPI().call)
```

This will raise `View function mapping is overwriting an existing endpoint function module_name.call`, but actually the `call` function are from different instances.

I understand that typically `context.route` is used as a decorator thus having little possibility that the decorated functions' names in the same module will collide, but there're chances people like me will prefer to use it as a wrapper to define routes dynamically.

Will it be better if we use `str(view_func)` as the default endpoint?

I think we should at least change the error message, since the `call` in the above error message is not bound to the module it self, but described as `endpoint function {module_name}.call`. This took me a long time to trace the problem.

I wrote some code for on-demand thumbnail generation but ran in to some weirdness with `send_from_directory`:

```py

# Just a relative directory called "thumbs" that's supposed to hold a replica directory tree, only with thumbnails
thumbcache = 'thumbs'

# ...

@app.route('/thumb/<path:path>')
def thumbnail(path):
    
    # Simple True/False return for success/failure.
    success = cache_thumbnail(path)
    if not success:
        raise Exception("Thumbnail generation failed!")

    # All thumbnails are jpg so I need to replace the file extension:
    thumbpath, _ = os.path.splitext(path)
    thumbpath += ".jpg"

    ## thumbpath = thumbpath.replace('\\', '/')

    #return send_file(thumbcache + '/' + thumbpath)
    return send_from_directory(thumbcache, thumbpath)
```

The `'/thumb/<path:path>` URL is being generated by: 
```html
<img id="{{loop.index}}" src="{{ url_for('thumbnail', path=file) }}">
```

The requests look like: `"GET /thumb/gw%5Calpha%5C1430f690aa3fcfda5c10beceb9c120ea.jpg HTTP/1.1"`

### Actual Behavior

The code above, as is, results in a 404 - File not found error. No exception.

### Expected Behavior

The file should be served.

If I uncomment the line `return send_file(thumbcache + '/' + thumbpath)` and thereby bypassing any security, it works but that's an undesirable workaround.

If I uncomment the line `thumbpath = thumbpath.replace('\\', '/')` to replace all backslashes with forward slashes, it works fine.  
I don't know why `url_for` generated backslashes in the first place. Maybe an artifact because I am running this code on a Windows machine?


### Environment

* Python version: Python 3.5.2 (v3.5.2:4def2a2901a5, Jun 25 2016, 22:18:55) [MSC v.1900 64 bit (AMD64)] on win32
* Flask version: 0.12.2
* Werkzeug version: 0.12.2

Fixes #2376

This patch adds support for looking for the Flask app instance in `wsgi.py` or `app.py` modules (in that order) when `FLASK_APP` is not defined.
If you don't install your app in the env, you have to append `.py` in the `FLASK_APP` var.

Haven't dug into why it's like this yet, but it might be more straightforward to add the cwd to PYTHONPATH so that `FLASK_APP=app.py` becomes `FLASK_APP=app` even if the app isn't installed in the env.

We can still support paths to set the cwd. `FLASK_APP=/path/to/app` would set the current directory to `/path/to` then try to import `app`.
Even when installed as a package, it can be useful in complex situations to have a `wsgi.py` file for setting the app up to run. The `flask` command should detect this file if no `FLASK_APP` is specified at all.

Additionally, it's common to name quick demo apps `app.py`, so that should be detected too.

From discussion in #2375.
Setting the `FLASK_APP` and `FLASK_DEBUG` for every new terminal session is inconvenient. The CLI could load a `.env` file that contained these values instead. Since Heroku is a popular deployment option, this would also help developers who want the same scheme locally.

Instead of writing our own parser, we should use [python-dotenv](https://github.com/theskumar/python-dotenv). This reduces maintenance burden on us and can be an optional dependency. If it is installed, the CLI will load the `.env`, otherwise it will skip it.

Previously discussed in #2164.

---

@miguelgrinberg raised a good point in the previous thread. `.env` is typically used to store sensitive configuration. The convenience of setting `FLASK_APP=` there could encourage users to commit the file publicly, which would be bad.

A solution would be to load two files, `.flask-env` and `.env`, and prominently document that `.flask-env` can be committed but should not contain secrets.
http_date() requires timetuple in UTC, but JSONEncoder.default() was
passing a local timetuple instead.

This fixes #2372.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

I am writing a little extension [Flask-Profile](https://github.com/fengsp/flask-profile), nothing serious but one tiny tool to do profiling for Flask.

Firstly I use one `middleware`(which is quite obvious for my purpose), middleware is working great on catching the whole thing but with one issue. I can not append the
profiling result to the response which is already sent, and I really do not want to see
the result using another way.

Then I use the `before_request` and `after_request` hook, more issues appear, now I can modify the response to append my profiling result, though, all other extensions have
to be used after `Flask-Profile` so they can be profiled. Also I am not catching the whole 
lifetime, I do not catch the `request_context` pushing and `session` related stuff, session
is opened during the request_context pushing and is saved after `after_request` hooks
were executed.

Try to use the `request-started` and `request-finished` signal. Issues exist, signalling support is available only when blinker library is installed, and I still can not catch the
session opening. The good news is that all extensions can be caught no matter which
one calls `init_app` first.

After all this, What I want is one hook that is called just after request get in and request_context is pushed(however session are not opened) and another hook that is called after `process_response`, both of which Flask does not have.

I can only think of monkeying patching the `Flask.wsgi_app` which is the last thing I want to do. Any better ideas?

## I get an an error during request to a static html file.

serving on http://0.0.0.0:8080
ERROR:**main**:Exception on /static/bloggr-client/index.html [GET]
Traceback (most recent call last):
  File "c:\users\honglei\appdata\local\enthought\canopy\user\lib\site-packages\flask\app.py", line 1898, in wsgi_app
    response = self.full_dispatch_request()
  File "c:\users\honglei\appdata\local\enthought\canopy\user\lib\site-packages\flask\app.py", line 1553, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "c:\users\honglei\appdata\local\enthought\canopy\user\lib\site-packages\flask\app.py", line 1457, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "c:\users\honglei\appdata\local\enthought\canopy\user\lib\site-packages\flask\app.py", line 1551, in full_dispatch_request
    rv = self.dispatch_request()
  File "c:\users\honglei\appdata\local\enthought\canopy\user\lib\site-packages\flask\app.py", line 1537, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "c:\users\honglei\appdata\local\enthought\canopy\user\lib\site-packages\flask\helpers.py", line 872, in send_static_file
    cache_timeout=cache_timeout)
  File "c:\users\honglei\appdata\local\enthought\canopy\user\lib\site-packages\flask\helpers.py", line 623, in send_from_directory
    return send_file(filename, **options)
  File "c:\users\honglei\appdata\local\enthought\canopy\user\lib\site-packages\flask\helpers.py", line 498, in send_file
    mimetype = mimetypes.guess_type(filename or attachment_filename)[0]
  File "C:\Users\honglei\AppData\Local\Enthought\Canopy\App\appdata\canopy-1.3.0.1715.win-x86_64\lib\mimetypes.py", line 297, in guess_type
    init()
  File "C:\Users\honglei\AppData\Local\Enthought\Canopy\App\appdata\canopy-1.3.0.1715.win-x86_64\lib\mimetypes.py", line 358, in init
    db.read_windows_registry()
  File "C:\Users\honglei\AppData\Local\Enthought\Canopy\App\appdata\canopy-1.3.0.1715.win-x86_64\lib\mimetypes.py", line 258, in read_windows_registry
    for subkeyname in enum_types(hkcr):
  File "C:\Users\honglei\AppData\Local\Enthought\Canopy\App\appdata\canopy-1.3.0.1715.win-x86_64\lib\mimetypes.py", line 249, in enum_types
    ctype = ctype.encode(default_encoding) # omit in 3.x!
UnicodeDecodeError: 'ascii' codec can't decode byte 0xb0 in position 1: ordinal not in range(128)

ctype's value
'.\xb0\xa2\xc0\xef\xcd\xfa\xcd\xfa\xbd\xd3\xca\xd5\xb5\xc4\xbf\xc9\xd2\xc9\xce\xc4\xbc\xfe'

I don't think a unkown ctype in Windows's registry should cause Flask give up user's request.

Databases support not just DateTime objects but also Date and Time objects, but Flask's jsonify doesn't:

```
TypeError: datetime.time(0, 0) is not JSON serializable
```

This would be an easy pull request, but I want to check if it's been discussed before. Is there any reason why I should not add support for `datetime.time` and `datetime.date` objects to [JSONEncoder](https://github.com/mitsuhiko/flask/blob/fbda3f94baa6d7dba8f773309121284c6e6c5a6d/flask/json.py#L77)?

The .mobi file of the documentation has gone missing, does anyone know the whereabouts of it?

EDIT: #841 


I have a flask application deployed behind a reversed proxy.
The proxy is configured to use https, the application server running the flask application is using http.

When setting `PREFERRED_URL_SCHEME='https'` in the configuration I expected flask to return a `location` in the headers using `https`. Using curl we could check the location returned and they are using `http`.

I added debugging statement to the application just before the `return flask.redirect(flask.url_for())` is called.
- `print APP.config['PREFERRED_URL_SCHEME']` returns 'https'
- `print flask.current_app.config['PREFERRED_URL_SCHEME']`  returns 'https'
- `print flask.redirect(url)` returns `<BaseResponse 249 bytes [302 FOUND]>`

Using the logic presented at http://flask.pocoo.org/snippets/35/ we could make the location returned use `https` however it was my understanding that setting correctly `PREFERRED_URL_SCHEME` would spare us from having to add more code in our application to support https.

Could you please let me know whether this is indeed the expected behavior or our original expectations were the correct one?

Full disclaimer: the application is still running flask 0.9

I think the doc is supposed to read, "Because of that, Flask has **a** few design choices that some people might find surprising or unorthodox."

Otherwise, it could possibly mean, "Because of that, Flask has few design choices that people would find surprising or unorthodox."

Or perhaps even less ambiguous, "Because of that, Flask has few surprising or unorthodox design choices."

The grammar fixes make it a little easier to read.  The re-wording, especially in the Before/After Requests section, makes the docs much clearer.


see issue #1060, but we need wait jinja2 merge https://github.com/mitsuhiko/jinja2/pull/332

Reproduce:
- clone https://github.com/SteelyWing/flask-blueprint-test.git
- run index.py
- open http://localhost:5000/bp-0/ , display `blueprint 0` (Correct)
- open http://localhost:5000/bp-1/ , display `blueprint 0` (Incorrect)
- close index.py

---
- run index.py
- open http://localhost:5000/bp-1/ , display `blueprint 1` (Correct)
- open http://localhost:5000/bp-0/ , display `blueprint 1` (Incorrect)
- close index.py

---

Is it the cache issue ? I tried if rename `blueprint_0/index.html` to `blueprint_0/bp_0.html`, and  `blueprint_1/index.html` to `blueprint_1/bp_1.html`, all work.
I also add a test of this, please have a see of [THIS](https://github.com/SteelyWing/flask)

Hi,
 I was searching for examples for flask-uploads to see if it is useful at all and discovered there needs to be:
1. disambiguation between examples per version as the flask-uploads API has changed significantly between versions.
2. disambiguation in examples between what is flask and what is the database
3. a database free or at least a database isolated example:
    - I downloaded sqlacademy only to discover the flask-uploads part of the example was out of date, I am now trying how to modify the couchDB example w/o having to install couchDB.
I know you all aren't responsible for other's examples, but if you could provide your own working example, that would help greatly. Basically you are hurting your cause by making flask extensions difficult to use.

Thanks!

Read https://github.com/mitsuhiko/flask/blob/master/flask/app.py#L170

Here it says `flask.g object is not application context scoped.`

Should it not be `flask.g object is now application context scoped.`?

If yes, then the difference between not and now changes the understanding of context scoping of Flask.g object to a good extent.

`python -mflask` is fine as is, but I think `python -m flask` is clearer to the reader.

I'd suggest that the script info paragraph be re-written too - it feels stilted and redundant as is. I'm not comfortable enough with the material to attempt to clear it up without fear of losing meaning/specifics though.

apologies to armin or kenneth if doc fixing PRs are an annoyance, trying to procrastinate exam study! :)

I need this change because I have to override a couple of Jinja2's templating functions.

Better than monkeypatching flask.app.Environment. ;-)




Just fixed a relative import to work on Python 3

There are a couple of typos in cli.rst file.
The command 'python -m flask' appears with no space between the m and the f of flask (I presume this is an error).
In Script Info section, the first reasons is spelt 'rasons' (OK, not so important I know, but ...)


Rationale: Some code might want to distinguish between "DEBUG has not been
set, determine correct value from the environment / other means" and "DEBUG
has been turned off explicitly".

One user of this is the Flask-Script extension, which would like to use a
default of True for the DEBUG setting when its built-in script runner is
used. Rationale: Many people use a special gunicorn-or-whatever runner in
production, but start a quick local "manage.py runscript" when they want to
test something / reproduce a bug. In this case it's helpful to not require
a different set of options that the user has to remember, or to have to use
a second config file which could go out of date.

clone repository flask 
cd PycharmProjects/flask/examples/flaskr/
python flaskr.py

error output:
Traceback (most recent call last):
  File "flaskr.py", line 48, in <module>
    @app.cli.command('initdb')
AttributeError: 'Flask' object has no attribute 'cli'

I checked, did not found attribut 'cli'

with pypy; $ pypy -V
Python 2.7.3 (87aa9de10f9ca71da9ab4a3d53e0ba176b67d086, Apr 09 2014, 00:32:56) [PyPy 2.2.1]

``` python
 * pypy: running distutils-r1_run_phase python_test
............E...............................................................................................................F..........................F.............................F......................................E............
======================================================================
ERROR: test_build_error_handler (flask.testsuite.basic.BasicFunctionalityTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/testsuite/basic.py", line 758, in test_build_error_handler
    flask.url_for('spam')
TypeError: exceptions must be old-style classes or derived from BaseException, not NoneType

======================================================================
ERROR: test_session_transactions_no_null_sessions (flask.testsuite.testing.TestToolsTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/testsuite/testing.py", line 106, in test_session_transactions_no_null_sessions
    with c.session_transaction() as sess:
TypeError: exceptions must be old-style classes or derived from BaseException, not NoneType

======================================================================
FAIL: test_uninstalled_package_paths (flask.testsuite.config.InstanceTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/testsuite/config.py", line 167, in test_uninstalled_package_paths
    self.assert_equal(app.instance_path, os.path.join(here, 'test_apps', 'instance'))
  File "/mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/testsuite/__init__.py", line 139, in assert_equal
    return self.assertEqual(x, y)
AssertionError: '/mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/testsuite/test_apps/config_package_app/instance' != '/mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/testsuite/test_apps/instance'

======================================================================
FAIL: test_json_key_sorting (flask.testsuite.helpers.JSONTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/testsuite/helpers.py", line 200, in test_json_key_sorting
    '}'
  File "/mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/testsuite/__init__.py", line 139, in assert_equal
    return self.assertEqual(x, y)
AssertionError: Lists differ: [u'{', u'"values": {', u'"0": ... != ['{', '"values": {', '"0": "fo...

First differing element 4:
"10": "foo",
"2": "foo",

Diff is 955 characters long. Set self.maxDiff to None to see it.

======================================================================
FAIL: test_appcontext_signals (flask.testsuite.signals.SignalsTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/testsuite/signals.py", line 118, in test_appcontext_signals
    self.assert_equal(recorded, ['push', 'pop'])
  File "/mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/testsuite/__init__.py", line 139, in assert_equal
    return self.assertEqual(x, y)
AssertionError: Lists differ: ['push', 'push'] != ['push', 'pop']

First differing element 1:
push
pop

- ['push', 'push']
?            ^^^

+ ['push', 'pop']
?            ^^


----------------------------------------------------------------------
Ran 233 tests in 5.798s

FAILED (failures=3, errors=2)
```

ditto py2.7 3.3. Not got deps installed under py3.4 at this stage.
To me it appears the tests are simply written for py2 py3 and pypy misses out because of how pypy selects and or uses exception classes in case of the errors triggered by these tests. As for the failures=3, well, 1 is a unicode issue, the others just don't work.

Oh. see 837

I have have an issue with unittest.TestLoader().discover() throwing the error "AssertionError: View function mapping is overwriting an existing endpoint function".

I have an application as a package.
I brake the package up logically into sub-packages (no blueprints).
Each sub-package has a 'tests.py' file, which holds the units tests for that sub-package.
Outside of the application package I have a script called 'run_tests.py', it uses the following code to discover the tests:

``` python
import unittest

suite = unittest.TestLoader().discover('<application package>', pattern='*tests.py')
unittest.TextTestRunner().run(suite)
```

All views are stored in the sub-packages as 'views.py' these are loaded by the applications package '**init**.py' when the application is run. This is also the same file the Flask() application is created.

When I run the script 'run_tests.py' I get the following issue:

```
AssertionError: View function mapping is overwriting an existing endpoint function: <endpint name>
```

If however I point discover at '<application package>.<sub-package' I do not get the issue.

It would appear that 'unittest' loads the modules each time in tries to discover.

I know this is not a good idea for people Googling in future but I have a GH repo branch which replicates the issue: https://github.com/pjuu/pjuu/tree/0.3dev

I am guessing I can fix this issue with an application factory instead of an 'app' variable inside the applications '**init**.py'.

I have fixed the issue by moving all tests to a separate sub package called 'tests' in which no views/endpoints are loaded.

I have asked on IRC and been informed this may be as issue. I will happy to find out it isn't and a pointer to my own mistake/misunderstanding.

Is this a Flask issue, a unittest issue or something else?

I have this weird problem. I am trying to include css files from the static directory, the browser downloads the content of the CSS file but it says the server is sending the css with `mime-type:text/plain`

It's best explained here - http://stackoverflow.com/questions/23452967/jinja2-static-files-mime-type-always-text-plain. I am unable to include any CSS file.

I'm getting the same error whether installing into a blank venv with 2.7 or 3.4, straight from the git repository. It's my first day using flask (trying to initialize my db for the `flaskr` example).

``` python
Traceback (most recent call last):
  File "/Users/roderic/Developer/testflask/bin/flask", line 9, in <module>
    load_entry_point('Flask==0.11-dev-20140504', 'console_scripts', 'flask')()
  File "/Users/roderic/Developer/testflask/lib/python2.7/site-packages/flask/cli.py", line 352, in main
    auto_envvar_prefix='FLASK')
  File "/Users/roderic/Developer/testflask/lib/python2.7/site-packages/click/core.py", line 303, in main
    with self.make_context(prog_name, args, **extra) as ctx:
  File "/Users/roderic/Developer/testflask/lib/python2.7/site-packages/click/core.py", line 261, in make_context
    value, args = param.handle_parse_result(ctx, opts, args)
  File "/Users/roderic/Developer/testflask/lib/python2.7/site-packages/click/core.py", line 575, in handle_parse_result
    value = self.callback(ctx, value)
  File "/Users/roderic/Developer/testflask/lib/python2.7/site-packages/flask/cli.py", line 202, in set_app_id
    ctx.ensure_object(ScriptInfo).app_import_path = value
AttributeError: 'Context' object has no attribute 'ensure_object'
```

I was expecting to be able to run a function right before the application object is destroyed (right after the last request). Just like there's a [`Blueprint.before_app_first_request`](http://flask.pocoo.org/docs/api/#flask.Blueprint.before_app_first_request), why isn't there the equivalent for the last request, along the lines of `after_app_last_request`?

The "as .mobi" link on http://flask.pocoo.org/docs/ cannot be found (404).

http://flask.pocoo.org/docs/flask-docs.mobi

PDF, epub, and zipped HTML are fine, fyi.

A lot of command line tools has the support to override defaults from one (or more) config files (e.g. [coverage](https://bitbucket.org/ned/coveragepy/src/d0812ed8a1cfcb0f9f6a42cfdf1064b76e894956/coverage/control.py?at=default#cl-96)). It would be really great if click supports this out of the box.

Proof of concept (with configobj): https://gist.github.com/schlamar/11400688



It's quite common to use the `app.route` decorator together with other decorators to restrict access like this for example:

``` python
@app.route('/foo')
@auth.admin_required
def foo():
  pass
```

This can easily become a security issue (also described in gae-init/gae-init#149) if you sloppily swap the order of the decorators:

``` python
@auth.admin_required
@app.route('/foo')
def foo():
  pass
```

This will silently register `foo` without any guards and can easily hit developers "off-guard" ;). IMO this is a bit too easy and silent. I'd even bet that quite some people make this mistake.

I can think of a solution based on inspection at decoration time (inside `app.route` above `app.route.decorator`) check that `@app.route` decorators are not decorated with anything else. This doesn't feel nice but might prevent security flaws... thoughts?

Links to jinja website point to this 404 page: http://jinja.pocoo.org/2/documentation/templates

Example:
=Templates
This section only gives a very quick introduction into how Jinja2 is integrated into Flask. If you want information on the template engine’s syntax itself, head over to the official _Jinja2 Template Documentation_...

Website badges are not showing. Images are pointing to: localhost

<div class="badge">
    <p><a href="http://localhost/"><img src="http://localhost/static/badges/flask-powered.png" border="0" alt="Flask powered" title="Flask powered"></a>
    </p><pre>&lt;a href="http://localhost/"&gt;&lt;img
   src="http://localhost/static/badges/flask-powered.png"
   border="0"
   alt="Flask powered"
   title="Flask powered"&gt;&lt;/a&gt;</pre>
  </div>

Extension approval has basically stalled for quite some time and the extension guidelines are in need of an update. I would like both of these things to change, starting with an update of the guidelines.

This pull request presents some changes to the guidelines to provide a basis for discussion.

I noticed that there are no helpers for Etag or Last-Modified based caching.

That way we could use 

``` python
def json():
    etag(some_etag)
    last_modified(some_timestamp)

    some_response = do_expensive_stuff
    return some_response
```

which is _very_ useful when you implement an API with expensive operations which often get requests for the exactly same response. Add a caching proxy and and they are only expensive once. 

[Sinatra (Ruby)](https://github.com/sinatra/sinatra) has those helpers: https://github.com/sinatra/sinatra/blob/v1.4.5/lib/sinatra/base.rb#L439-L554

Hi guys,

Is there some way of sending an email to the admins when the rate limit is reached for certain tasks?

Thanks.

David.


Hi,

I have a blueprint defined as :

auth_login = Blueprint('auth_login', __name__, template_folder='templates', static_folder='static', static_url_path='/static')

I am registering it as :

app.register_blueprint(auth_login, url_prefix='/user')

I have a route:

@auth_login.route('/<username>/')
def profile(username):
    return render_template('profile/user.html',
        username = username)

With this setup, the /user/<username> endpoint never manages to load the static files as I get,

"GET /user/<username>/static/css/lib/bootstrap.min.css HTTP/1.1" 404 -
 "GET /user/<username>/static/css/lib/font-awesome/css/font-awesome.min.css HTTP/1.1" 404 -

What I really want is to look into the static folder of the root application and not the blueprint, so I want it to request

"GET /static/css/lib/bootstrap.min.css HTTP/1.1" 200 -

Is it possible to configure this via static_folder or static_url_path so that the route will look for the static files at root and not relative to where the blueprint is mounted?


Just updated the links that point to Jinja2 and Werkzeug websites. 

Create a `LoggingUndefined` type that logs to stdout on template errors and passes it to the jinja2 environment if the debug flag is set. Fixes #1006

i think flask needs awesome way to implement sessions and authentication

To prevent caching proxies like Varnish from providing multiple users with the same cache, you can set a `Vary: Cookie` header. 

This pull request appends the header to each response when the session is accessed.

I came across this issue while working on Warehouse, PyPi 2.0. @dstufft wanted something that added the header to the response anytime the session was being used.

&mdash; @citruspi + @abadger

server (very basic!):

``` python
from flask import (Flask, request, jsonify)
from werkzeug import secure_filename

app = Flask(__name__)
app.config.from_object(__name__)
app.config['MAX_CONTENT_LENGTH'] = 1024 * 1024 * 1024

@app.route('/files', methods=['POST'])
def post_files():
    r = dict()
    r['directory'] = request.form['directory']
    # yes, there is more code here, but this is the simplest repro!
    return jsonify(r)


if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0')
```

client (with debugging output)

``` python
from itertools import izip_longest
from requests_toolbelt import MultipartEncoder
import requests
import os
import sys
import argparse

URL = "http://localhost:5000/files"


def grouper(n, iterable, fillvalue=None):
    args = [iter(iterable)] * n
    return izip_longest(fillvalue=fillvalue, *args)


def import(source_folder, url):
    for (path, dirs, files) in os.walk(source_folder):
        if '.DS_Store' in files:
            files.remove('.DS_Store')

        if '.git' in dirs:
            dirs.remove('.git')

        # in order to limit the number of files being uploaded at once, keep it to 3 at a time
        for f1, f2, f3 in grouper(3, files):
            fields = dict()
            fields['directory'] = os.path.basename(path)
            if f1 is not None:
                fields['f1'] = (f1, open(os.path.join(path, f1), 'rb'))
            if f2 is not None:
                fields['f2'] = (f2, open(os.path.join(path, f2), 'rb'))
            if f3 is not None:
                fields['f3'] = (f3, open(os.path.join(path, f3), 'rb'))
            print fields
            print
            m = MultipartEncoder(fields=fields)
            r = requests.post(url,
                              data=m,
                              headers={'Content-Type': m.content_type})
            print r.json()
            print r
            print
            print


def main():
    parser = argparse.ArgumentParser(description='importer')
    parser.add_argument('source',
                        help='source folder to import from')
    parser.add_argument('--server',
                        help='server to upload folder to',
                        dest='url',
                        required=False,
                        default=URL)

    args = parser.parse_args()
    import(args.source, args.url)


if __name__ == '__main__':
    status = main()
    sys.exit(status)
```

When I run it with an input directory that has 9 files, the first time through, I get a RESPONSE 200, second time through, I get a RESPONSE 400:
127.0.0.1 - - [14/Apr/2014 22:02:30] "POST /files HTTP/1.1" 200 -
127.0.0.1 - - [14/Apr/2014 22:02:30] "POST /files HTTP/1.1" 400 -

Any idea why this is happening?

I know benchmark is a lie, still, can we do any improvement? I love Flask and really feel bad when flask loses always in these benchmarks. 

So what do you guys think about this issue? Is it really a issue or what? Is any improvement necessary? If no, why?

http://blog.startifact.com/posts/webob-and-werkzeug-compared.html
http://faruk.akgul.org/blog/python-web-frameworks-benchmark/
http://mindref.blogspot.com/2012/09/python-fastest-web-framework.html
......

#756

Hello @kennethreitz , We've created 'flask-docs-kr' project in readthedocs.org. 
(http://flask-docs-kr.readthedocs.org/ko/latest/)
We hope to enable 'flask.readthedocs.org/ko/latest' URL.

Please add our flask-docs-kr project to official flask readthedocs.org project. 
('Admin -> Translations -> Existing Translations')

Thanks.


Currently py.test fails to discover any tests. It'd be nice if Flask's, Werkzeug's and Jinja's testsuites could be modified so that third-party testrunners like py.test and nose are able to run them correctly.

Cloned the latest Flask source from github with the intention of increase flasks test coverage and the first thing I did was run-tests.

Output was, 

```
Ran 240 tests in 1.415s

OK
```

When I ran-tests under coverage however I received this error.

```
coverage run run-tests.py .................................................................................................................................E..............................................................................................................
======================================================================
ERROR: test_main_module_paths (flask.testsuite.config.InstanceTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/happy/opt/lib/python3.4/pkgutil.py", line 481, in find_loader
    spec = importlib.util.find_spec(fullname)
  File "/Users/happy/opt/lib/python3.4/importlib/util.py", line 100, in find_spec
    raise ValueError('{}.__spec__ is None'.format(name))
ValueError: __main__.__spec__ is None

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/happy/flask/flask_source/flask/flask/testsuite/config.py", line 198, in test_main_module_paths
    from main_app import app
  File "/Users/happy/flask/flask_source/flask/flask/testsuite/test_apps/main_app.py", line 4, in <module>
    app = flask.Flask('__main__')
  File "/Users/happy/flask/flask_source/flask/flask/app.py", line 354, in __init__
    instance_path = self.auto_find_instance_path()
  File "/Users/happy/flask/flask_source/flask/flask/app.py", line 645, in auto_find_instance_path
    prefix, package_path = find_package(self.import_name)
  File "/Users/happy/flask/flask_source/flask/flask/helpers.py", line 704, in find_package
    loader = pkgutil.get_loader(root_mod_name)
  File "/Users/happy/opt/lib/python3.4/pkgutil.py", line 467, in get_loader
    return find_loader(fullname)
  File "/Users/happy/opt/lib/python3.4/pkgutil.py", line 487, in find_loader
    raise ImportError(msg.format(fullname, type(ex), ex)) from ex
ImportError: Error while finding loader for '__main__' (<class 'ValueError'>: __main__.__spec__ is None)

----------------------------------------------------------------------
Ran 240 tests in 1.703s

FAILED (errors=1)
```

Environment:
    OS X 10.8.5 (12F45)
    Python3.4

```
    pip freeze produces
        Flask==0.10.1
        Jinja2==2.7.2
        MarkupSafe==0.19
        Werkzeug==0.9.4
        coverage==3.7.1
        itsdangerous==0.24
```

Unsure at this point if this is a coverage.py issue or a flask issue.


Clarified that the code is meant to be saved as a file called hello.py.

Python 3.4 changed the functionality of pkgutil.get_loader.  This should protect against that.

refs #1011 

It would be useful to be able to refer to [flash categories](http://flask.pocoo.org/docs/patterns/flashing/) using constants, for example:

```
FLASH_CATEGORY_MESSAGE = 'message'
FLASH_CATEGORY_DEFAULT = FLASH_CATEGORY_MESSAGE
```

This gives an overview of the **already defined** categories, and an obvious way to avoid duplicating these in every Flask application.

Hi guys:
 I wrote flask-bouncer, a authorization library based on RyanBates' CanCan ruby gem

docs: http://pythonhosted.org/flask-bouncer/ 
github: https://github.com/jtushman/flask-bouncer
pypi: https://pypi.python.org/pypi/flask-bouncer/0.1.11

Would love to have it listed in flask-registry.  I hope it will be useful for the community.

Any feedback will be well received

Thanks!

Also, some fixes for PyFlakes

Original commit by @dongweiming at a05c4038706f3a95776adea376bc664c0714b426

See #842

I think the reason why nobody can reopen this PR is because his fork is gone.

Hello! Subclassing to pass in a few basic args to the jinja environment is something I've done frequently. Making this an explicit part of the API seems to be a better idea.

request tstack -> request context stack

In doing a test upgrade to python 3.4 I encountered the following traceback (snippet)

``` bash
  File "/my/virtualenv/wonderboom34/lib/python3.4/site-packages/flask/app.py", line 319, in __init__
    template_folder=template_folder)
  File "/my/virtualenv/wonderboom34/lib/python3.4/site-packages/flask/helpers.py", line 742, in __init__
    self.root_path = get_root_path(self.import_name)
  File "/my/virtualenv/wonderboom34/lib/python3.4/site-packages/flask/helpers.py", line 631, in get_root_path
    loader = pkgutil.get_loader(import_name)
  File "/usr/local/Cellar/python3/3.4.0/Frameworks/Python.framework/Versions/3.4/lib/python3.4/pkgutil.py", line 467, in get_loader
    return find_loader(fullname)
  File "/usr/local/Cellar/python3/3.4.0/Frameworks/Python.framework/Versions/3.4/lib/python3.4/pkgutil.py", line 488, in find_loader
    return spec.loader
AttributeError: 'NoneType' object has no attribute 'loader'
```

I was able to resolve it with the following:

``` diff

diff --git a/helpers.py b/helpers.py
index 62a64bb..f671c27 100644
--- a/helpers.py
+++ b/helpers.py
@@ -628,7 +628,10 @@ def get_root_path(import_name):
         return os.path.dirname(os.path.abspath(mod.__file__))

     # Next attempt: check the loader.
-    loader = pkgutil.get_loader(import_name)
+    try:
+        loader = pkgutil.get_loader(import_name)
+    except AttributeError:
+        loader = None

     # Loader does not exist or we're referring to an unloaded main module
     # or a main module without path (interactive sessions), go with the
@@ -658,7 +661,10 @@ def find_package(import_name):
     folder structure exists (lib, share etc.).
     """
     root_mod_name = import_name.split('.')[0]
-    loader = pkgutil.get_loader(root_mod_name)
+    try:
+        loader = pkgutil.get_loader(root_mod_name)
+    except AttributeError:
+        loader = None

     if loader is None or import_name == '__main__':
         # import name is not found, or interactive/main module
```

If you want a formal pull request, I'd be happy to provide one, and do it "right", this feels pretty brute-force, I'm sure there's a better way.

Just one change to the example code in the @templated example - render_template was missing. Plus a few commas, missing words and such in the text, hopefully nothing controversial.

Also, my first pull request, so let me know if I've done anything wrong or any conventions I'm not adhering to.

Hi!
flask-admin, mongoengine
I have EmbeddedDocument objects and I want render to page selected EmbeddedDocument. Selected from <select></select>.

How I can render EmbeddedDocument by ID?
Have any standart decision?

The Flask Mailinglist page:
http://flask.pocoo.org/mailinglist/

mentions this page:
http://flask.pocoo.org/mailinglist/archive/
Which shows the latest email from 2012-10-29, giving the impression that the Flask community is no longer active

This page seems to be up to date:
http://librelist.com/browser/flask/

Please update http://flask.pocoo.org/mailinglist/ to reflect this change.
Thank you.

I consistently get the error "TypeError: cannot concatenate 'str' and 'NoneType' objects" whenever I send a multipart form from anywhere that's not an HTML <form>.

For example AndroidQuery's, Apache HttpClient, and the Chrome Postman plugin all give this error.

Trace:
File "C:\Python27\lib\site-packages\werkzeug\formparser.py", line 382, in parse_lines
    next_part = b'--' + boundary

Currently missing attributes of template variables are swallowed by Flask, even
in debug mode:

```
@app.route('/')
def index():
    # template contains:
    # {{ lol.asdf }}
    return flask.render_template('lol.htm', lol=3)
```

I propose we set `app.jinja_env.undefined` to some type that logs warnings to
console when Flask's debug mode is enabled.

The Flask documentation states that Flask assumes the encoding of the response to be UTF-8.

```
the encoding for text on your website is UTF-8

From http://flask.pocoo.org/docs/unicode/
```

Does that mean we are discouraged to use the encodings other than UTF-8 in the Flask response? I was unable to find a way to change the intended encoding of neither `flask.wrappers.Response` nor `werkzeug.wrappers.Response` correctly.
1. I cannot directly pass the text to the constructor, as it calls set_data() with the UTF-8 encoding. That's because the constructor has no `charset` parameter. There is no way to change its behavior. So I should create the response object with no constructor arguments, and then assign 'utf-8' to `response.charset`, and call `response.set_data()`.
2. But still, as `content_type` is determined in the constructor, it will still be "text/html; charset=UTF-8" because the `charset` attribute is always `'utf-8'` during the object creation process. So I'm forced to pass `content_type` to the constructor, which is kinda confusing because my original intention was just changing the encoding, rather than explicitly setting the Content-Type.

Do I understand the process accurately?

If I'm right, I suggest:
1. Allow passing `charset` to the `Response` class.
2. Or, the `content_type` attribute should be updated again when the user manually sets the `charset` attribute.

Just makes it easier on the eyes/brain.


I'm in a project where double-quoted HTML attributes is part of the style guide. We're also using data- attributes to pass data to code and consider it a bad practice to render anything directly within scripts.

Being able to remove `|safe` within `<script>` seems convenient at first glance. But after discovering that it changes the behavior of `|tojson` everywhere else when using double-quoted attributes, it doesn't seem as nice. It's just less intuitive overall. Forcing you to use a particular HTML style or requiring `|forceescape` (as opposed to just `|e`) isn't really a great tradeoff for implying `|safe` within `<script>`.

So the underlying question. Can we allow `|tojson` to work within double-quotes attributes again? Or is there some technical reason why we can't. And if not, why not add another filter to use within `<script>` blocks instead so the principal of least surprise isn't violated?

Flask is great, but it would be nice if you document a quick start with PyCharm


A cStringIO file containing pdf data is uploaded using send_file:

```
# pdf is the cStringIO instance.
return send_file(pdf, mimetype="application/pdf",
                         as_attachment=True,
                         attachment_filename="basicreport.pdf")
```

this works on android when using firefox. On chrome the download fails with an "Untitled" filename.

When manually creating the response manually all works fine..

```
response = make_response(pdf.read())
response.headers['Content-Type'] = 'application/pdf'
response.headers['Content-Disposition'] = 'attachment; filename=basicreport.pdf'
```

When `Flask.config['SERVER_NAME']` is set to a domain (_thedomain.com:8080_) it alters the route matching behavior. Requests on "subdomained" urls (_sub1.thedomain.com:8080/some/route_) then only resolve to subdomained Blueprints (Blueprints with their 'subdomain' attribute set). With `app.config['SERVER_NAME']` set to `None`, subdomained url would also properly resolve to non-subdomained Blueprints.

In other words, the presence of `app.config['SERVER_NAME']` effectively serves as an _implicit_ switch to subdomain matching behaviour for Blueprints.

(1) if this is intentional the documentation is not clear about it.
(2) the naming of that config is not very indicative of this behavior altering property either.
(3) this is not always the desirable behavior. Sometimes one still wants to use subdomains and set `app.config['SERVER_NAME']`, but does not want to map blueprints to subdomains. Such is the case for example, when using the value contained by `app.config['SERVER_NAME']` to extract the subdomain info from the requested url in one's own user-defined function (a `before_request` handler for example). As it stands, the behavior altering property of `app.config['SERVER_NAME']` forces developers in the latter use-case to set another more innocuous config property with the same value (e.g. `app.config['SERVER_DOMAIN']`).

I propose that a new config flag that will explicitly enable subdomain matching behavior be added. The presence of which would make `app.config['SERVER_NAME']` mandatory (can't have subdomain support without it). But the presence of `app.config['SERVER_NAME']` should not impose subdomain matching behavior.

Make it a bit clearer that it's an instance of response_class that is 
expected, not the actual response_class class.

http://flask.pocoo.org/docs/tutorial/views/#tutorial-views

Should be "sessions" not "session"

@app.route('/add', methods=['POST'])
def add_entry():
    if not session.get('logged_in'):

send_file() is assuming a file has a visible filename on the file system thus leading to errors when trying to use a file object returned by tempfile.TemporaryFile() .
This should be mentioned in the docstring along with the suggestion to use NamedTemporaryFile() instead of TemporaryFile() .

Added 'import os' statement so you can use os.path.join() when defining DATABASE location

Can someone please take a look at this issue in Flask-gzip? Just using flask and flask-gzip, but getting this error after upgrading from 0.9 to 0.10.1

https://github.com/elasticsales/Flask-gzip/issues/7

this did, however, make the error go away:

```
@app.after_request
def after_request(response):
    response.direct_passthrough = False
    return response
```

I believe this would be useful for customizing test clients. For example:

``` python
class TestClient(FlaskClient):
    def __init__(self, authenticated=False, *args, **kwargs):
        self._authenticated = authenticated
        FlaskClient.__init__(*args, **kwargs)
```

And then I could say...

``` python
client = app.test_client(authenticated=True)
```

`test_client()` can then act more as a factory.

Python gave an error when copy/pasting this code, and adding os fixed it for me.

Dear Flask Team,

THANK YOU SO MUCH for developing such a delightful platform.
I truly love my work in large part because of Flask!

I have an opportunity to 'give back' to the Flask community. I would like to submit an extension for listing in the Flask Extension Registry, and have it accepted as an Approved Extension.

Warmly,
Ling.

Extension: https://pypi.python.org/pypi/Flask-User
Version: v0.3.6

I have followed your guidelines below:

o. An approved Flask extension requires a maintainer.

   Maintainer: Ling Thio <ling.thio [at] gmail.com>
   Repository: https://github.com/lingthio/flask-user
1. An approved Flask extension must provide exactly one package or module named flask_extensionname.
   
   Module: flask_user
2. It must ship a testing suite that can either be invoked with make test or python setup.py test.
   
   python setup.py test
   Runs automated tests and coverage currently runs at 98%.
3. APIs of approved extensions will be checked
   
   UserManager.**init**(app) sets self.app = app
   UserManager.init_app(app) does NOT set self.app
4. The license must be BSD/MIT/WTFPL licensed.
   
   BSD License
5. The naming scheme for official extensions
   
   Flask-User
6. Approved extensions must define all their dependencies in the setup.py file
   
   mkvirtualenv test  # brand new env
   pip install flask-user
   can run the flask_user/example_apps/basic_app.py
7. The extension must have documentation that uses one of the two Flask themes for Sphinx documentation.
   
   See http://pythonhosted.org//Flask-User/
8. The setup.py description (and thus the PyPI description) has to link to...
   
   The documentation: http://pythonhosted.org//Flask-User/
   Home page: https://github.com/lingthio/flask-user
   Bug track: https://github.com/lingthio/flask-user/issues
   Development version: n/a
9. The zip_safe flag in the setup script must be set to False
   
   setup.py:
       zip_safe=False,
10. An extension currently has to support Python 2.6 as well as Python 2.7
    
    Travis-CI runs Flask-Utils on Python 2.6, 2.7 and 3.3

Second paragraph in 
http://flask.pocoo.org/docs/deploying/fastcgi/
reads

> Please make sure in advance that any app.run() calls you might have in your application file are inside an if __ name __ == '__ main __': block or moved to a separate file. Just make sure it’s not called because this will always start a local **WSGI server** which we do not want if we deploy that application to FastCGI.

Shouldn't this be "start a local **HTTP server**"

If I run a server in debug mode and the kill the parent process the child process is left running. It should be killed along with the parent (as usually happens with parent-child processes).

```
import flask
app = flask.Flask(__name__)
if __name__ == "__main__":
    app.run(debug=True)
```

```
> ps -ef | grep python
edA-qa   18280 16524  4 15:38 pts/7    00:00:00 python min.py
edA-qa   18285 18280  4 15:38 pts/7    00:00:00 /usr/bin/python min.py
> kill 18280
> ps -ef | grep python
edA-qa   18285     1  1 15:38 pts/7    00:00:00 /usr/bin/python min.py
```

This is interfering with my ability to use Flask as a test server in a test suite. I spawn a process with Popen and kill it when I'm done. Unfortunately the server is left and only a wrapper process is killed.


http://flask.pocoo.org/docs/deploying/wsgi-standalone/ talks about Tornado's scaling properties, but does not mention that most of this scalability is lost when the single-threaded asynchronous server is combined with a synchronous WSGI framework like flask.  I see a lot of questions on stackoverflow from people who use Flask on Tornado and are surprised that they are not getting any concurrency.  

I think it would be best to remove Tornado from this page entirely since Tornado is not really focused on being a WSGI container and WSGI apps are nearly always better served by a multi-threaded server like gunicorn or uwsgi.  If you do want to keep a mention of Tornado as a WSGI server, please acknowledge its limitations (single-threaded) and that it really only makes sense when you want to combine a WSGI app with a Tornado-native app in the same process.

`304 Not Modified` is used very often, it's handy to use a short-circuit response like this.

While using Flask-SQLAlchemy's `SQLALCHEMY_COMMIT_ON_TEARDOWN` feature, I noticed certain successful-looking requests didn't have their results committed to the database. After further investigation I discovered some exceptions from Gunicorn end up being passed into the teardown function Flask-SQLAlchemy uses to implement the post-request commit functionality.

I was able to reproduce the issue on a minimal case with the code below (as test.py):

``` python
from flask import Flask, redirect, request, url_for

app = Flask(__name__)
app.debug = True

@app.route("/")
def index():
    return "Hello World!"

@app.teardown_request
def teardown_request(exception=None):
    if exception:
        app.logger.error("Unexpected exception {}".format(exception))

if __name__ == "__main__":
    app.run()
```

With the app run with the following line:

`gunicorn test:app -w 1`

I fairly consistently get the following output:

```
2014-02-19 14:00:34 [4459] [INFO] Starting gunicorn 18.0
2014-02-19 14:00:34 [4459] [INFO] Listening at: http://127.0.0.1:8000 (4459)
2014-02-19 14:00:34 [4459] [INFO] Using worker: sync
2014-02-19 14:00:34 [4462] [INFO] Booting worker with pid: 4462
--------------------------------------------------------------------------------
ERROR in test [/Users/aston/.envs/flask-gunicorn-bug/test.py:12]:
Unexpected exception [Errno 35] Resource temporarily unavailable
--------------------------------------------------------------------------------
```

Errno 35 is EAGAIN.

I'm running on a Mac, but I first noticed this behavior on Heroku (it's Errno 11 there). Also, the behavior isn't consistent, and though I found it more consistently locally with app.debug = True, I noticed the behavior with debugging off (again, on Heroku).

There's been some discussion about this issue in Gunicorn's issues section [here](https://github.com/benoitc/gunicorn/issues/416), but they consider EAGAIN a non-fatal exception (and as you can see from running the example, the requests always successfully return data), so the fact that Flask sees it and thinks it's real is a problem.

I believe Gunicorn could help fix this bug by clearing sys.exc_info() after ignoring the exception (i.e. around here: https://github.com/tilgovi/gunicorn/blob/master/gunicorn/workers/sync.py#L43:L45), but it'd still be racy.

The real fix, I believe is for Flask not to throw arbitrary "if not exc: exc = sys.exc_info()[1]" in areas where no exception is being explicitly caught by the code (e.g. [here](https://github.com/mitsuhiko/flask/blob/master/flask/app.py#L1711:L1712)). Another alternative, if that behavior is generally desirable, would be to ignore any exceptions with a stack trace that doesn't go deep enough to include any Flask or user-provided code.

I have a server set up where there is a front-end web server (i.e. proxy) sitting in front of my Flask application.  Because of this, I need to be able to generate external links that have a different url than the actual requests coming to my Flask application.
e.g. my app is running on http://foo.example.com:1234/, but url_for(..., _external=True) needs to generate things like "https://some.other.com/"

The suggested way of doing this, by changing SERVER_NAME, doesn't work because that is for both url_for() and by the underlying werkzeug routing code so changing it causes 404 errors.

Would it be feasible to add an EXTERNAL_SERVER_NAME setting that is used instead?

Tutorial was missing import os, required for sqlite db configuration.

I was lazily loading views in 0.9, and some views needed to use the same function, e.g.

```
url('/<lang:lang>/blog/', 'blog.views.blog_index', defaults={'page': 1})
url('/<lang:lang>/blog/page/<int:page>', 'blog.views.blog_index')
```

Upon updating Flask to 0.10.1, I now get the following error:

```
AssertionError: View function mapping is overwriting an existing endpoint function
```

The cause is the same as #796, but [your current documentation still says this is a valid way of having a central URL map](http://flask.pocoo.org/docs/patterns/lazyloading/).

Is there a way around this, beyond just storing every single `LazyView` in a dict and looking it up each time `url()` is called? The above documentation needs to be updated to reflect the answer.

Happy belated New Year!

Tutorial requires os module for the path.join function

This works:
{% autoescape false %}
{{ something_without_spaces }}
{% endautoescape %}

This pops with python exception:
{% autoescape false %}
{{ something with spaces }}
{% endautoescape %}

This breaks client side jquery templating with script tags

Python version 2.7
Flask latest-stable

Making allowance for new convenience of `get-pip.py` that automatically installs setuptools and pip together.

Stop recommending distribute, which has now been merged into setuptools.

Very minor issue - on http://flask.pocoo.org/docs/tutorial/setup/#tutorial-setup, "import os" should be added to the first code block.

Update copyright year in license. Looks like it was forgotten in 52098e1e4fc4d9c962e9ecb09dfbbcc6ac80a4d7.

Hi, I would like to know whether this is a bug or a feature.

Example:

```
from flask import Flask, jsonify
from collections import OrderedDict
app = Flask('__name__')

@app.route('/')
def jsonify_test():
    unsorted_dict = {'foo': 1, 'bar': 4, 'baz': 0}
    sorted_dict = OrderedDict(sorted(unsorted_dict.items(), key=lambda x: x[1]))
    return jsonify(sorted_dict)

if __name__ == '__main__':
    app.run(debug = True)
```

Result:

```
{
    "bar": 4, 
    "baz": 0, 
    "foo": 1
}
```

See next example with python 2.7.5, flask=0.10.1, werkzeug==0.9.4:

```
import unittest
from cStringIO import StringIO
from flask import Flask, request


app = Flask(__name__)

@app.route('/', methods=["POST"])
def test_view():
    print(request.values, request.files)
    return "OK"


class UnicodeTestCase(unittest.TestCase):
    def setUp(self):
        self.client = app.test_client(use_cookies=False)

    def test_unicode_file(self):
        file = (StringIO("0" * 1000), "filename.txt")
        self.assertEquals(200, self.client.post('/', data={'file': file}).status_code)

    def test_unicode_string(self):
        string = u"∆_∆"
        self.assertEquals(200, self.client.post('/', data={'string': string}).status_code)

    def test_unicode_file_and_string(self):
        file = (StringIO("0" * 1000), "filename.txt")
        string = u"∆_∆"
        self.assertEquals(200, self.client.post('/', data={'file': file, 'string': string}).status_code)


if __name__ == '__main__':
    app.run('0.0.0.0', 8080, True)
```

When I make request directly all work fine. But with test client have error:

```
Error
Traceback (most recent call last):
  File "/Users/user1/tests/test_uni.py", line 108, in test_unicode
    self.assertEquals(200, client.post('/', data={'file': file, 'string': string}).status_code)
  File "/Users/user1/.virtualenvs/test/lib/python2.7/site-packages/werkzeug/test.py", line 771, in post
    return self.open(*args, **kw)
  File "/Users/user1/.virtualenvs/test/lib/python2.7/site-packages/flask/testing.py", line 108, in open
    follow_redirects=follow_redirects)
  File "/Users/user1/.virtualenvs/test/lib/python2.7/site-packages/werkzeug/test.py", line 725, in open
    environ = args[0].get_environ()
  File "/Users/user1/.virtualenvs/test/lib/python2.7/site-packages/werkzeug/test.py", line 535, in get_environ
    stream_encode_multipart(values, charset=self.charset)
  File "/Users/user1/.virtualenvs/test/lib/python2.7/site-packages/werkzeug/test.py", line 104, in stream_encode_multipart
    write('\r\n\r\n' + value)
  File "/Users/user1/.virtualenvs/test/lib/python2.7/site-packages/werkzeug/test.py", line 71, in write
    write_binary(string.encode(charset))
UnicodeDecodeError: 'ascii' codec can't decode byte 0xe2 in position 4: ordinal not in range(128)
```

See details http://stackoverflow.com/q/21584413/880326.

When starting a Celery worker module, it is assumed that the Celery instance within the module is called `app`. This is not the case in the Celery pattern, where it is called `celery`, and so must be explicitly referenced.

I'm building a website using Flask, and so far I love it. The only thing that constantly bothers me however, is that when I get debug output, it's always so much. And most of it is just internal error messages from Flask, which don't tell me anything. 99.9% of the time, I'm just interested in the line which led to this error which is located in my own scripts. If I know that, I normally can quickly find the solution, but all the other output just confuses me.

So; is there a way that I can just output the lines in my own written scripts that led to the error?

Most of the README was already in markdown, replaced the `~` with`##` headers and the opening section with `#` header. Here is a screenshot or you can checkout the live formatted doc at https://github.com/schneems/flask.

![](http://cl.ly/image/1L241I0E3f0R/content.png)

my template has the following code:

```
{% with messages = get_flashed_messages() %}
  {% if messages %}
  <div class="alert alert-info">
    <a class="close" data-dismiss="alert">&times;</a>
    <ul>
    {% for message in messages %}
      <li>{{ message }}</li>
    {% endfor %}
    </ul>
  </div>
  {% endif %}
{% endwith %}
```

but pybabel can't extract text from this file unless I remove the {% with %} statement. 

is there any mistake I made in this case?

In order to better facilitate generation of URLs that make use of an HTTPS URL
scheme this patch adds a parameter with this specific purpose in mind. To
achieve this we explicitly pass in a param, `_scheme='https'`, and then set the
`url_scheme` attribute of our `MapAdapter` instance appropriately.

Importantly, `_external=True` must be set in order for this to work properly.
As such, failure to do so results in a `ValueError` being raised.


Fix example code in Deferred Callback docs: don't set response upon executing callback

To fix this issue: https://github.com/mitsuhiko/flask/issues/664

I found this issue when trying out the example code the Deferred Callbacks pattern:
http://flask.pocoo.org/docs/patterns/deferredcallbacks/

In the for loop of the call_after_request_callbacks() function, it is setting the response to the return value of callback function.  Then later, under Practical Example, the remember_language() function implicitly returns None.  This will likely cause a problem on the second iteration of the for loop.

This can be fixed by either 1) not setting the response to the callback returned value, or by b) returning the response in the remember_language() function.

This static content includes: JavaScript, CSS &etc.

E.g.: http://flask.pocoo.org/docs/patterns// vs. http://flask.pocoo.org/docs/patterns/

Several people have noted issues when installing/updating Flask extensions that use the new style flask.ext path, specifically in Google AppEngine environments.

Relevant discussion and troubleshooting here:  https://github.com/thadeusb/flask-cache/issues/38

What is happening (my understanding):
1. flask extension (ex: Flask-Cache) imports a module (ex: "from jinja2 import nodes")
2. in the extension's context, ExtensionImporter class has added its own path (flask.ext) to sys.meta_path
3. When ExtensionImporter load_module() is run, it fails to load the external module (with an ImportError?) and thus bombs

Troubleshooting notes:
- this may be caused by AppEngine's dev_appserver_import_hook.py, line 1577, in LoadModuleRestricted
- The application will run normally if you comment out line 86 in flask/exthook.py "raise ImportError('No module named %s' % fullname)" or by reverting to the the old flaskext path

Any assistance is highly appreciated.

UPD: not a bug, see https://github.com/mitsuhiko/flask/issues/661#issuecomment-11975645

```
from flask import Flask

app = Flask('teardown')

@app.teardown_request
def shutdown_session(err):
    print repr(err)

@app.route('/')
def index():
    raise ValueError('test exc')

if __name__ == '__main__':
    app.run()
```

So, when I open index page and see 500 error page, console output is `ValueError('test exc')`. But when I start app in debug mode, eg

```
if __name__ == '__main__':
    app.run(debug=True)
```

Output is `None`, when expected `ValueError('test exc')`.

This is important for me, because I use `teardown_request` for sqlalchemy transaction management like

```
@app.teardown_request
def shutdown_session(exception):
    if exception:
        db.session.rollback()
    else:
        db.session.commit()
```

Mention Python 3.x is not supported

I found two pages on the documentation with a problem on a import explanation

``` python
from flaskext.mail import Mail
```

And the correct should be (with a dot between flask and ext):

``` python
from flask.ext.mail import Mail
```

The pages with this wrong import are: http://packages.python.org/flask-mail/ and http://flask.pocoo.org/snippets/85/

So here is my pain — there are no structure restrictions. Single file is fine until there are more than X lines. And apps do grow. Very fast. No restrictions are good, but structure skeletons are awesome. Let me explain it...

I had big problems w/ re-structuring my app so that everything is not in a single file. I'm just a newbie programmer, not an architect. At least for now. Micro frameworks should improve my productivity, not forcing me to structure things.

I suggest to create skeletons / boilerplate for possible ways to structure app. They could be sorted for estimated size of the product (tiny, small, medium, big & huge) plus used components (ORM, template engine, test framework, form abstraction etc.). What do you think?

Adds a decorator to allow developer to register global functions.

repetitively but show the text once and the tweeters and the retweeters

If you submit a field with an integer and commit to DB as a string, SQLite will cast it to an integer, which can cause problems.

I was making something based on the Flask tutorial and I couldn't figure out why my data was coming back as type "int" when I had inserted to the DB as "string".

The field needs to be something that has text-affinity in SQLite, so I changed it to type "text".

Hope this helps?

Wrote "stdin" instead of "stdout".

Fixes #647


I had sphinx installed system-wide, and I could not build the docs despite running `python setup.py develop` in my virtualenv. 

I eventually figured out that sphinx installed system wide wouldn't place nicely with the Flask package installed in the virtualenv. This wasn't obvious from the provided error message, so I'd like to improve the error message. 

Starting a Flask application in a thread other than the main thread does not work and produces the following:
- Running on http://0.0.0.0:5000/
  Exception in thread flask_application_thread:
  Traceback (most recent call last):
  File "/opt/python2.7/lib/python2.7/threading.py", line 551, in __bootstrap_inner
    self.run()
  File "harness.py", line 23, in run
    self.__application.run(host = '0.0.0.0', debug = True)
  File "/opt/python2.7/lib/python2.7/site-packages/Flask-0.9-py2.7.egg/flask/app.py", line 739, in run
    run_simple(host, port, self, **options)
  File "/opt/python2.7/lib/python2.7/site-packages/Werkzeug-0.8.3-py2.7.egg/werkzeug/serving.py", line 615, in run_simple
    run_with_reloader(inner, extra_files, reloader_interval)
  File "/opt/python2.7/lib/python2.7/site-packages/Werkzeug-0.8.3-py2.7.egg/werkzeug/serving.py", line 529, in run_with_reloader
    signal.signal(signal.SIGTERM, lambda *args: sys.exit(0))
  ValueError: signal only works in main thread

Is there a workaround. I've tried using multiprocessing.Process which is no an option in my application.

Thanks.

I thought this would be a nice skeleton for a beginner, but it's incomplete.
What should go the following?

  /app/users/**init**.py

Perhaps I'm just ignorant about python module system...


Is it a project's decision or a bug?  Please, check it out:

Gist:
https://gist.github.com/4259170

Fix #646

Please mention on web page that when deploying Flask on CGI, you can not have any random "print" in the source code, it will mess up the output.

http://stackoverflow.com/a/13799083/193892

The frontpage example on flask.pocoo.org seems to miss linebreaks?
http://screencast.com/t/akBXxkqJ

for example,

```
flask.abort(400, 'missing parameter username')
```


Hello,

I'm using python (default version 2.7.3) on Ubuntu, I installed flask

and then I'm running the tests of Flaskr and I got 3 errors.

``` bash
Traceback (most recent call last):
  File "flaskr_tests.py", line 12, in <module>
    import flaskr
  File "/home/user/flaskr/flaskr.py", line 14, in <module>
    from flask import Flask, request, session, g, redirect, url_for, abort, \
ImportError: cannot import name _app_ctx_stack
```

I don't really understand how Flask doesn't have an object that Flaskr request, how could I fix it ?

Thanks in advance.

[`flask.logger.create_logger()`](https://github.com/mitsuhiko/flask/blob/master/flask/logging.py#L17) destroys any log handlers that have been added previously. Because the creation of the logger (and the calling of `create_logger()` that this entails) is [deferred until the first time `flask.app.logger` is accessed](https://github.com/mitsuhiko/flask/blob/master/flask/app.py#L548), this can lead to the destruction of log handlers that were purposefully added by the application.

I just tracked down a bug due to this that took me a very long time to debug because I had no idea this went on. To my eyes, it looked like the standard logging module was breaking at a seemingly random moment (it wasn't even my code that was accessing `app.logger`, it was [Flask's internal error handling code](https://github.com/mitsuhiko/flask/blob/master/flask/app.py#L1347)). Therefore, I think one of two courses of action should be taken:
- Because this behavior of `create_logger()` seems very strange, perhaps it should be removed. As in don't delete log handlers that are already in place when `create_logger()` gets called.
- If there is a good reason for this behavior to remain, it should be documented clearly in `app.logger`'s docstring.

I am happy to carry out either (or some other) change and send a pull request.

I noticed stevedore when I updated to latest virtualenvwrapper recently.
I think it's nice to be able to do something like this:

``` python
from setuptools import setup

setup(
    name='Flask-SuperExtension',
    version='0.0.0',
    description='Super Extension',
    py_modules=['super_extension'],
    install_requires=['Flask'],
    entry_points={
        'flask.ext': [
            'super_extension = super_extension',
            ],
        }
)
```

I'm just throwing this out as an idea since it would add an extra dependancy.

Hello

First, sorry for my english.

I have problem. I need HTTP_REFERER, like php to hotlinks protection.

in request.headers i have
Content-Length:
User-Agent: Mozilla/5.0 (Windows NT 5.1; rv:16.0) Gecko/20100101 Firefox/16.0
Connection: keep-alive
Host: dbooks.local:8080
Cache-Control: max-age=0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,_/_;q=0.8
Accept-Language: pl,en-us;q=0.7,en;q=0.3
Content-Type:
Accept-Encoding: gzip, deflate

But i don't have HTTP_REFERER.
What i can do with this?


Here's my view.

``` python
@app.route('/image/<file_id>')
@login_required
def images(file_id):
    file = file_like_object_here
    rv = send_file(file,
            mimetype=file.content_type,
            # as_attachment=True,
            attachment_filename=file.filename,
            add_etags=False,
            conditional=True
        )
    rv.last_modified = file.upload_date
    app.logger.debug(rv.last_modified)    # 2012-11-24 08:51:27
    app.logger.debug(request.if_modified_since)    # 2012-11-24 08:51:27
    app.logger.debug(rv.last_modified<=request.if_modified_since)    # True
    return rv
```

Here is the HTTP:
Request

```
Request URL:http://127.0.0.1:5000/image/50b0855f2c2d291cbe896e56
Request Method:GET
Status Code:200 OK

GET /image/50b0855f2c2d291cbe896e56 HTTP/1.1
Host: 127.0.0.1:5000
Connection: keep-alive
Cache-Control: max-age=0
User-Agent: Mozilla/5.0 (X11; Linux i686) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip,deflate,sdch
Accept-Language: en-US,en;q=0.8
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
Cookie: session="lde2mnK7NSOGS8DqcU5YVgTkVEc=?_expires=STEzNTY1MDE0OTgKLg==&_permanent=STAxCi4=&username=VmFhYWFhCnAxCi4="
If-Modified-Since: Sat, 24 Nov 2012 08:51:27 GMT
```

Response:

```
HTTP/1.0 200 OK
Content-Type: image/png
Cache-Control: public, max-age=43200
Expires: Sun, 25 Nov 2012 18:43:12 GMT
Last-Modified: Sat, 24 Nov 2012 08:51:27 GMT
Connection: close
Server: Werkzeug/0.8.3 Python/2.7.3
Date: Sun, 25 Nov 2012 06:43:12 GMT
```

Ideally it should return `304 Not Modified` but you can see that's not happening.




on my system I am trying to run a flask app with minimum permissions. In this case, it is run as:

```
sudo -u nobody python flask_webapp.py
```

all the files in its directory are readable by everyone, but some parent directories are not. The app fails whenever I try to serve up a file, either indirectly by trying to access http://myapp.com/static/test.html, or directly by the following code:

```
@app.route('/test')
def web_app():
    return send_file("./static/test.html")
```

The problem is, flask converts all relative paths to absolute paths in the send_file function. This breaks if it doesn't have directory read access all the way to the system root.

The problem seems to arise from the following lines, 543 to 545 of helpers.py

```
if filename is not None:
    if not os.path.isabs(filename):
        filename = os.path.join(current_app.root_path, filename)
```

session_transaction() is failing to initialize the request by calling before_request, but is successfully calling the teardown functions, resulting in objects that have never been created to be accessed. This additional test also makes 11 other tests fail because of some stack corruption after the new test fails.

Patch pending.

I think that it would be useful to be able to add configuration items to a blueprint and then have those merged into the app configuration on load. My thinking is simply that there might be configurations specific to your blueprint that should have default values stored as part of the blueprint. I suppose this feature could also lead to use cases where people make blueprint simply to hold different configuration for the application.


The Flask_SQLite3 example used in the Flask Extension Development
documentation cannot use self.app if attached to the application with
init_app. This is fixed by using flask.current_app.

Probably needs some additional note in the text too.

Hi,
I am running a local flask instance on my mac. I thought I would see how flask stood up to apache benchmark (ab). I threw 10 requests with one concurrent user and it fails! 

Is this something thats expected?

ab -n10 -c1 -q http://127.0.0.1:5000/
This is ApacheBench, Version 2.3 <$Revision: 655654 $>
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking 127.0.0.1 (be patient)...apr_socket_recv: Connection reset by peer (54)
Total of 2 requests completed

In my debug console I see three requests:

127.0.0.1 - - [06/Nov/2012 21:41:20] "GET / HTTP/1.0" 200 -
127.0.0.1 - - [06/Nov/2012 21:41:20] "GET / HTTP/1.0" 200 -
127.0.0.1 - - [06/Nov/2012 21:41:20] "GET / HTTP/1.0" 200 -

and my code:

``` python
from flask import Flask
from flask import render_template, send_from_directory
import os

app = Flask(__name__)
app.debug = True

@app.route('/favicon.ico')
def favicon():
    return send_from_directory('.', 'favicon.ico')

@app.route("/")
def index():
  return render_template("index")

if __name__ == "__main__":
  app.run()
```

index:

``` html
<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title></title>

  </head>
  <body>

  </body>
</html>
```

This branch supports Python 2.5 through 3.2, passes all the tests when used with [2to3 port of Werkzeug](https://github.com/mitsuhiko/werkzeug/pull/231) and [itsdangerous](https://github.com/mitsuhiko/itsdangerous/pull/14) (In Python 3.1, it leaks memory for some reason)


As pointed out in issue #588 sqlite3.Row should be used instead of using casting to dict(). Also altered the "Easy Querying" Patterns example to include the more correct way to return rows as dicts. Did not touch Tutorial examples ("Views"), as these are not up to date with the current Flaskr code, and the "Show Entries" section points out the "Easy Querying" section on how to convert to a dict().

Results in SyntaxError: EOL while scanning string literal

In `flask/helpers.py`, near the top of `url_for()` there is this code:

``` python
    appctx = _app_ctx_stack.top
    reqctx = _request_ctx_stack.top
    if appctx is None:
        raise RuntimeError('Attempted to generate a URL with the application '
                           'context being pushed.  This has to be executed ')
```

It looks like that `RuntimeError` message is cut off.  This has to be executed when? :)

Hi, I recently wrote an extension for making it easy to serve all your app's static assets from Amazon S3. It's called [flask-s3](https://github.com/e-dard/flask-s3); the docs are located [here](http://flask-s3.readthedocs.org/en/latest/)

Would be great to have this extension included in the extension registry. I think that it meets all the requirements, but let me know if it's missing anything.

I have a Flask 0.9 project that has all dependencies stored locally beside my app.py file. The intention is to keep everything self-contained within a version control repository so anyone using or contributing to it won't need to make any additional installations.

This being the case, I want to use some Flask extensions and decided try manually installing the Flask-Login extension. I copied the `flask_login.py` file to the `flask/ext` directory and tried to `import flask.ext.login` from my app.py file the same way the example does. I got an `ImportError: No module named login`. I then tried `import flask.ext.flask_login` and that too failed.

The solution I wound up with from Stack Overflow was to comment out the `setup()` function in the `flask/ext/__init__.py` file and `import flask.ext.flask_login` directly in my app.py file.

http://stackoverflow.com/questions/13065682/how-to-manually-install-flask-extensions

I would _really_ like to be able to use an unmodified version of Flask locally and without a virtual environment that can still import extensions the expected way.

Just for the record.
- http://feedback.flask.pocoo.org/message/305
- http://feedback.flask.pocoo.org/message/289

Add back path=None argument into find_module. This fixes #618 and revert #524.

find_module is a method automatically called. Removing the path argument, even if not used, may cause (and causes) error such as: 

> from flask.ext.babel import Babel
> TypeError: find_module() takes exactly 2 arguments (3 given)

- Highlight first input on page load
- Enter sends submit request
- After submit first input refocused, selected
- Fix double quote -> single quote
- Submit is a callback function

![screenie](http://i.imgur.com/GVvPb.png)

http://flask.pocoo.org/docs/patterns/streaming/#streaming-from-templates

It would be nice to have the stream_template method included in Flask, maybe unified with render_template

Looks like Flask is sending simplejson bad arguments? Added a debug statement right before the call to dumps crashes:

```
DEBUG in json [/usr/local/lib/python2.7/dist-packages/flask/json.py:96]:
{'csrftoken': 'd3e5fb185f52567dce2c41ef4ca59959cd2a6a12', '_id': '\x12A\x07^D2>\xa0ct\xaa\r\xf6\xf7\xa5"'}
--------------------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1758, in __call__
    return self.wsgi_app(environ, start_response)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1746, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1744, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1419, in full_dispatch_request
    response = self.process_response(response)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1623, in process_response
    self.save_session(ctx.session, response)
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 818, in save_session
    return self.session_interface.save_session(self, session, response)
  File "/usr/local/lib/python2.7/dist-packages/flask/sessions.py", line 291, in save_session
    val = self.get_signing_serializer(app).dumps(dict(session))
  File "/usr/local/lib/python2.7/dist-packages/itsdangerous.py", line 424, in dumps
    return self.make_signer(salt).sign(self.dump_payload(obj))
  File "/usr/local/lib/python2.7/dist-packages/itsdangerous.py", line 519, in dump_payload
    json = super(URLSafeSerializerMixin, self).dump_payload(obj)
  File "/usr/local/lib/python2.7/dist-packages/itsdangerous.py", line 407, in dump_payload
    return self.serializer.dumps(obj)
  File "/usr/local/lib/python2.7/dist-packages/flask/sessions.py", line 70, in dumps
    return json.dumps(_tag(value), separators=(',', ':'))
  File "/usr/local/lib/python2.7/dist-packages/flask/json.py", line 97, in dumps
    return _json.dumps(obj, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/simplejson/__init__.py", line 334, in dumps
    **kw).encode(obj)
  File "/usr/local/lib/python2.7/dist-packages/simplejson/encoder.py", line 237, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/usr/local/lib/python2.7/dist-packages/simplejson/encoder.py", line 311, in iterencode
    return _iterencode(o, 0)
UnicodeDecodeError: 'utf8' codec can't decode byte 0xa0 in position 7: invalid start byte
```

The builder/ci server for github is using python 2.5, the views.py testsuite uses the with

statement, and thus flask/testsuite/views.py requires

from **future** import with_statement

at the beginning.

Minor but confusing typo in tutorial.

I've written a flask app that uses a blueprint to implement an API. When I create the server, I use register_blueprint to make the api available. I added a url_prefix parameter as a parameter to the call to register_blueprint. Thus, in theory, I could add multiple versions of this api for different instances.

As part of the blueprint, there is a particular method that needs to send a redirect to the requesting browser. This redirect is to another part of the blueprint. The problem is that url_prefix does not seem to be available within the request or current_app objects. At least, not in anyway that I've been able to see. 

Here's some code that illustrates the problem:

```
# server.py
blueprint = flask.Blueprint("mybp", __name__)

@blueprint.before_request
def before_request():
    if not flask.request.url.endswith("/auth/login/"):
        return flask.redirect( "/auth/login/")
```

And here's the part where the app server is created:

```
app = flask.Flask("myapp")
app.register_blueprint(server.blueprint, url_prefix="/instance1")
app.register_blueprint(server.blueprint, url_prefix="/instance2")
```

The correct behaviors would be to go to "/instance1/auth/login" or "/instance2/auth/login." The problem is that the redirect code doesn't have a way (that I can see) of getting the url_prefix that was used to register the blueprint. 

My initial thought was to see if I could get a hold of the Blueprint object that was registered on the app and maybe it would have the url_prefix that I could prepend on the redirect line.  This would look something like:

```
@blueprint.before_request
def before_request():
    if not flask.request.url.endswith("/auth/login/"):
        url_prefix = flask.current_app.blueprints[flask.request.blueprint].url_prefix
        return flask.redirect(url_prefix + "/auth/login/")
```

The problem is that the way blueprint is stored in Flask.register_blueprint (https://github.com/mitsuhiko/flask/blob/master/flask/app.py#L867):

```
self.blueprints[blueprint.name] = blueprint
```

means that each separate registration of blueprint shares the same blueprint object and url_prefix may not be valid between registrations. E.g. it's not enough to simply set url_prefix on the blueprint.

My solution to this was to create a factory method:

```
def make_blueprint(name, url_prefix):
    blueprint = flask.Blueprint(name, __name__, url_prefix=url_prefix)

    #
    # Blueprint @route definitions follow
    #

    return blueprint
```

and in the server creation code:

```
app = flask.Flask("myapp")
app.register_blueprint(server.make_blueprint("instance1", "/instance1"))
app.register_blueprint(server.make_blueprint("instance2", "/instance2"))
```

This works, and I have access to url_prefix in the instances. It wasn't critical for my project, but it was a surprising property of Flask.

It seems awkward, and a violation of the principle-of-least surprise. Why wouldn't the blueprint methods have access to the url_prefix (or any other options passed in during blueprint registration)? Are there any more elegant solutions than the one above?

There is a minor typo in the Tutorial at this page: [dbinit](http://flask.pocoo.org/docs/tutorial/dbinit/#tutorial-dbinit).
The line in question:  

> Just add that function below the connect_db function in flask.py:

Of course the filename should be _flaskr.py_ and not _flask.py_.

app.py
line num:1447
if isinstance(rv, basestring):
                rv = self.response_class(rv, headers=headers, status=status)
                headers = status = None
            else:
                rv = self.response_class.force_type(rv, request.environ)

if rv was JsonObject,application rise a exception
 'JsonObject' object is not callable
flask version:0.9

I've been meaning to do this for quite some time, but I never got around to
it. Hopefully this is neutral and useful enough to be included in the main
docs.

I'm running my app on Google App Engine.
I put an extension (flask-lazyviews) in flask.ext and then import it, then an import error appears "No module named flask.ext.lazy.werkzeug".
Of course it's not the extension's fault, because it just "from werkzeug.xx import xx", nothing's wrong with it.
And if I disable the import hook in flask.ext.**init**.py, everything works, the import works, no problem whatsoever.
I read the code of the import hook (in exthook.py), apparently it's raising an exception because it cannot import the module from some paths.
I think it's not a valid behavior, how could it account for every possible path that the environment provides? It CANNOT! On Google App Engine there's a mysterious import path automatically added by some way (the application folder).
It should not raise an error.
note: the example in PEP 302 doesn't raise an error.

Removed incorrect syntax and simplified remaining sentence.

I'm just curious why the LazyView class - as described in the [Lazily loading views](http://flask.pocoo.org/docs/patterns/lazyloading/) article on Flask docs - isn't get included in the Flask source code for convenience?
I see no application-specific thing in it.

A JSON string in an HTML `<script>` tag may cause the parser to enter the [script data double escaped state](http://www.w3.org/TR/html5/tokenization.html#script-data-double-escaped-state), in which `</script>` would not return the parser to the data state as expected.

sample.html:

``` html
<!doctype html>
<script>alert({{ v|tojson|safe }});</script>
```

sample.py:

``` python
return render_template('sample.html', v='<!--<script>')
```

url_for creates full URL when used for route with subdomain. This is not processed in in make_test_environ_builder, which expects absolute URL without domain.

I've update the code to parse domain with url_parse and change path and base_url correctly.

Here is a test which should pass afterward:

```
from unittest import TestCase
import flask


class SubdomainTestCase(TestCase):
    def setUp(self):
        self.app = flask.Flask(__name__)
        self.app.config['SERVER_NAME'] = 'example.com'
        self.client = self.app.test_client()

        self._ctx = self.app.test_request_context()
        self._ctx.push()

    def tearDown(self):
        if self._ctx is not None:
            self._ctx.pop()


    def test_subdomain(self):
        @self.app.route('/', subdomain='<company_id>')
        def view(company_id):
            return company_id


        url = flask.url_for('view', company_id='xxx')
        response = self.client.get(url)

        self.assertEquals(200, response.status_code)
        self.assertEquals('xxx', response.data)


    def test_nosubdomain(self):
        @self.app.route('/<company_id>')
        def view(company_id):
            return company_id


        url = flask.url_for('view', company_id='xxx')
        response = self.client.get(url)

        self.assertEquals(200, response.status_code)
        self.assertEquals('xxx', response.data)
```

Fixed a typo in the docstring of handle_exception. Was occours, now occurs.

`Default exception handling that kicks in when an exception occours that is not caught. In debug mode the exception will be re-raised immediately, otherwise it is logged and the handler for a 500 internal server error is used. If no such handler exists, a default 500 internal server error message is displayed.`

Occours should be occurs.

I looked around in the project code to see if i could update this, but it looks like the docs subdir is no longer used? I could be wrong, if you let me know where this is at I'll update it and send a PR :)

Ok, this issue have been raised twice, but i got an use-case that i don't know how to handle without the raw POST data.

If you use PubSubHubbub api, you can can give a secret, and any data that you will receive will be signed:
- When you subscribe to a new hub, you can give a "secret"
- When you get a POST request, you get a `X-Hub-Signature` in the format "sha1:xxxx"
- The signature is based on the secret you give at the subscription + the raw request data
- The request data are POSTed, and accessible with request.form

To verify the signature, i think it should be something like:

``` python
from hashlib import sha1
import hmac
signature = 'sha1:' + hmac.new(my_secret, request.data, sha1).hex_digest()
```

I've tried to use `json.dumps(request.form)` to get the initial raw data, but it doesn't work, maybe cause of a space or a line break.

(The real use case here is using the PubSubHubbub hook from Github, to get a CIA.vc like service)

Attempting to run tests of Flask itself fails immediately.

```
(python2.7) C:\Users\peter\repos\mitsuhiko\flask.git>python run-tests.py
Error: 'module' object has no attribute 'samefile'
```

This is due to a call to os.path.samefile (in flask/testsuite/__init__.py) which is only available on Unix.

Matches the entries in `.gitignore`



```
$ ls ./dist
Flask-0.10-devdev-20120918.tar.gz
```

Expected:

```
$ ls ./dist
Flask-0.10-dev-20120918.tar.gz
```


Fixed a typo in the docstring.

I'd like to be able to register "sub-blueprints" using `Blueprint.register_blueprint(*args, **kwargs)`. This would register the nested blueprints with an app when the "parent" is registered with it. All parameters are preserved, other than `url_prefix`, which is handled similarly to in `add_url_rule`. A naíve implementation could look like this:

``` python
class Blueprint(object):
    ...

    def register_blueprint(self, blueprint, **options):
        def deferred(state):
            url_prefix = options.get('url_prefix')
            if url_prefix is None:
                url_prefix = blueprint.url_prefix
            if 'url_prefix' in options:
                del options['url_prefix']

            state.app.register_blueprint(blueprint, url_prefix, **options)
        self.record(deferred)
```

The 'Pluggable Views' documentation includes the line

``` javascript
app.add_url_rule('/users/', ShowUsers.as_view('show_users'))
```

but isn't the second parameter to add_url_rule the 'name', and the third parameter the view_func?


It would also work with:

`con.execute(users.insert().values(name='admin', email='admin@localhost'))`

Seems like this issue:

http://flask.pocoo.org/mailinglist/archive/2011/8/14/pyinstaller/#429b2ac09950c2717cf7506487166a3a

was never fixed.  I still get : Unhandled ImportError: No module named werkzeug.exceptions when I use pyinstaller. Any ideas on how to fix this, or perhaps actually fix this in 0.91 :-)  

There are whole sections based on assumption that sqlite has no built-in DictCursor behavior
http://flask.pocoo.org/docs/tutorial/views/#tutorial-views
http://flask.pocoo.org/docs/patterns/sqlite3/#easy-querying

Besides verbosity, by wrapping result in dict() we block transparent data passing to INSERT which waits for "tupled" format

Here is solution:
db = sqlite3.connect(app.config['DATABASE_NAME'])
db.row_factory = sqlite3.Row # trick!

While "print cur.fetchall()" still looks like tuples are here... don't worry, it supports key access: 

for item in cur.fetchall():
    print item['title'] # works!

So you can easily remove those custom wrappers which i saw copied here and there...

I'm porting Flask (and [Werkzeug](https://github.com/mitsuhiko/werkzeug/issues/212)) to run in Python 3.2:
- master branch: https://github.com/puzzlet/flask/tree/py3-dev
- forked-from-stable(0.9) branch: https://github.com/puzzlet/flask/tree/py3

At this time of writing it passes all the tests, and capable of running simple web applications.

I'm trying to make an HTML5 app which is intended to work everywhere(!!). In iOS when a web app is added to the home screen, the resulting _standalone_ app doesn't allow cookies, nor is there an option for the user to enable them. 

I'm using server-side sessions (on redis), and in this scenario I'm contemplating appending some sort of auth token to every url request (maybe as a header, say, X-MYTOKEN), which will be stored on the client using localStorage after it is generated after a successful login. Later on a logout or a _timeout_ would invalidate this token on the server side, and the localStorage value would get rewritten on the subsequent login. 

Can you weigh in on this approach, or suggest something better? 

I'm dynamically generating a bunch of views in a piece of code that essentially boils down to

``` python
for manager in managers:
    app.add_url_rule('/managers/%s/<parameter>' % manager['identifier'], manager['lambda']
```

where the lambda key in the manager objects is a lambda object using a small set of common functions with varying input parameters based on values in the manager object.

The issue is that when adding multiple url rules pointing to lambdas in the same module, all the routes will point to the lambda that was defined last. Upon further investigation, it seems Flask URL rules only refer to endpoint functions by name in a string, so all the endpoints that point to lambdas in the same scope will end up pointing at the same lambda, referred to as "package.<lambda>".

I realize that keeping names is necessary for reverse lookup of URL rules, but I think that ideally Flask should keep track of the endpoint function object itself by a pointer as well and use that to call.

I am currently developing a new RESTful application in our company, and I want to do my job as properly as possible. And as many more RESTful applications/services will follow, I am currently reading up on the topic as-I-go. Also, out of experience, I know that APIs will evolve over time, and the need to version them is not something new.

At the very beginning of my quest, I came to [an answer on StackOverflow discussing just that](http://stackoverflow.com/a/398564/160665). The answer itself, pointed me to both the [RFC for Media Types](http://tools.ietf.org/html/rfc4288#section-3.2). I am still in the process of reading it in all it's glory, but so far, the "personal" or even "special" sub-type trees seem to fit my needs perfectly. This let's me _explicitly_ define the media type I am communicating with my client.

In parallel, the SO answer pointed me also indirect;ly to [a section about versioning](http://blog.steveklabnik.com/posts/2011-07-03-nobody-understands-rest-or-http#i_want_my_api_to_be_versioned) in the "Nobody Understands REST or HTTP" document.

All in all, I find the solution with the custom sub-type tree and the version parameter _very_ appealing.

Unfortunately, Flask is not yet able to parse this properly. As far as I can see, this could be handled transparently inside [MIMEAccept](http://werkzeug.pocoo.org/docs/datastructures/#werkzeug.datastructures.MIMEAccept) by only relaxing the "accept_json" logic to represent a general "does the client understand JSON" question, and adding a few extra accessors which are more precise.

I am not yet 100% certain how this could look like, but if you want I would be willing to look into it, and make a proposal via pull-request?

remove unused argument

When an incoming request contains the X-HTTP-Method-Override header, the
value of that header is used as the view method to be executed instead
of the original incoming HTTP verb.

This helps support dumb(er) webservers and proxies that don't understand newer HTTP verbs (e.g. PATCH), of which Amazon's Elastic Load Balancer service is a member.

I only added the functionality to `flask.views.MethodView`, because I was unsure about what would be a good way to do it with the standard `dispatch_request`; developers often introspect the HTTP method inside of decorator-based routes when supporting more than one verb in a route, so should the `request.method` value be overridden completely, or should devs be required to check for the X-HTTP-Method-Override header themselves? Neither option seems very appealing to me.


https://gist.github.com/3434633 shows a small application which I send a POST request to - unfortunately this causes the following traceback:

127.0.0.1 - - [23/Aug/2012 19:55:27] "POST /uptime/osiris/ HTTP/1.1" 500 -
Traceback (most recent call last):
File "/usr/share/pyshared/flask/app.py", line 1518, in call
return self.wsgiapp(environ, start_response)
File "/usr/share/pyshared/flask/app.py", line 1506, in wsgi_app
response = self.make_response(self.handle_exception(e))
File "/usr/share/pyshared/flask/app.py", line 1504, in wsgi_app
response = self.full_dispatch_request()
File "/usr/share/pyshared/flask/app.py", line 1265, in full_dispatch_request
response = self.make_response(rv)
File "/usr/share/pyshared/flask/app.py", line 1338, in make_response
return self.response_class(*rv)
File "/usr/share/pyshared/werkzeug/wrappers.py", line 642, in __init_
self.status = status
File "/usr/share/pyshared/werkzeug/wrappers.py", line 748, in _set_status
self._status_code = int(self._status.split(None, 1)[0])
IndexError: list index out of range

This is with the following request - curl -d "" http://localhost:5000/uptime/test/ but supplying any post data will cause the same

The issue is with accidentally returning a tuple in my code - however the error doesn't seem like that at all and it was only due to an eagle-eyed person in the IRC channel that I found this one. Could this be made more explicit? (i.e something in the trace to say that this was supposed to be a (content, status) tuple or a single string.


Updated link to a project

I missed the trailing _ to make a link in my first patch to add the link to extensions. 
Sorry about that.

http://flask.pocoo.org/mailinglist/archive/2012/8/13/import-problem-with-appcontext-tearing-down/

Reported on the mailing-list:
http://flask.pocoo.org/mailinglist/archive/2012/8/13/import-problem-with-appcontext-tearing-down/

I'm new maintainer of the flask-admin extension. Info is here: http://librelist.com/browser//flask/2012/5/3/ann-flask-admin-1-x/

root.py

```
from flask import Flask
from backend import app as backend

frontend = Flask('root')

@frontend ....
...

frontend.wsgi_app = DispatcherMiddleware(frontend.wsgi_app, {
    '/mountpoint': backend
})
```

daemon.py

```
from root import frontend as app

server_debug():
    frontend.debug = True
    frontend.run()
```

debugger is only available in the frontend domain, not within the mountpoint

OS X  19.7.4, python 2.7.1, flask 0.9

as in this example https://gist.github.com/3257877 , in log file there is nothing for level INFO

Recently I had to ask from IRC how to generate proper full url using `url_for()`, so I think that its docs should at least mention `SERVER_NAME`.

Also fixes a formatting error in another docstring.

It is apparently a common mistake to make multiple/distinct view functions sharing the same endpoint, the last overriding the earlier ones in the `app.view_functions` dict.

With a decorator: http://stackoverflow.com/questions/11064263/flask-custom-decorator-breaks-the-routing
With class-based views: http://stackoverflow.com/questions/11700698/flask-route-query-parameter

Is there an use case to using `app.route()` or `app.add_url_rule()` with an existing endpoint and overriding it? I think it is more often a mistake than not. I suggest that such cases issue a warning or even raise an exception, in order to catch the mistake early. In uncommon scenarios where overriding is actually desired, the user can always use `del app.view_functions[endpoint]` before registering the new function.

(I can provide a patch, but I’d like to discuss the idea first.)

Hey, this is the simplest flask ever

@app.route("/")
def landing():
    return render_template('index.html')

@app.route("/path:all_other_urls")
def missing_url(all_other_urls):
    '''
        Redirect and be done with it
    '''
    return redirect('/')

Yes its just set up to redirect everything to index.html.
Some random times flask doesnt render index.html but Hello World, out of the blue, and if i append a slash(or remove it) to the url it serves index.html again.
Any ideas?


Hello, 

I was wondering if there was a specific reason that the ability for Flask to deployed to AWS using Elastic Beanstalk was not something that was captured here in the QuickStart guide. 
http://flask.pocoo.org/docs/quickstart/#deploying-to-a-web-server

...specifically the ability to deploy Flask in Beanstalk is documented in this location in AWS' documentation. 
http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_Python_flask.html

It seems like a nice, more direct help for folks if the Quick Start just had a link to the AWS documentation. I'd be willing to make the change to the QuickStart myself if that would help. 

Small typo fix in the docs (import "secure_filename" from wrong location)

The InstanceTestCase tests fail on OS X when being packaged by an unprivileged user:

```
/sw/bin/python2.7 run-tests.py || exit 2
........................................................................................................................F..FF.....................................................................................................
======================================================================
FAIL: test_main_module_paths (flask.testsuite.config.InstanceTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/flask/testsuite/config.py", line 155, in test_main_module_paths
    self.assert_equal(app.instance_path, os.path.join(here, 'instance'))
  File "/sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/flask/testsuite/__init__.py", line 139, in assert_equal
    return self.assertEqual(x, y)
AssertionError: '/sw/var/run-tests-instance' != '/sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/instance'

======================================================================
FAIL: test_uninstalled_module_paths (flask.testsuite.config.InstanceTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/flask/testsuite/config.py", line 162, in test_uninstalled_module_paths
    self.assert_equal(app.instance_path, os.path.join(here, 'test_apps', 'instance'))
  File "/sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/flask/testsuite/__init__.py", line 139, in assert_equal
    return self.assertEqual(x, y)
AssertionError: '/sw/var/config_module_app-instance' != '/sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/flask/testsuite/test_apps/instance'

======================================================================
FAIL: test_uninstalled_package_paths (flask.testsuite.config.InstanceTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/flask/testsuite/config.py", line 167, in test_uninstalled_package_paths
    self.assert_equal(app.instance_path, os.path.join(here, 'test_apps', 'instance'))
  File "/sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/flask/testsuite/__init__.py", line 139, in assert_equal
    return self.assertEqual(x, y)
AssertionError: '/sw/var/config_package_app-instance' != '/sw/build.build/flask-py27-0.10.1-1/Flask-0.10.1/flask/testsuite/test_apps/instance'

----------------------------------------------------------------------
Ran 226 tests in 1.038s

FAILED (failures=3)
```

I'm packaging flask for use in the Fink project (an OS X package manager).  We use an unprivileged user to build and assemble a package before installation.  The above three tests fail during our build process.  If I build and test flask as a normal user, the tests pass, so it seems that there is some incorrect assumption being made somewhere about what the environment should be.  '/sw' is our prefix. '/sw/build.build' is the sandboxed build root.

Extension approval docs are out of date:
http://flask.pocoo.org/docs/extensiondev/#approved-extensions

Specifically, now that Flask supports Python3 as of its 0.10 release, extensions in the community should follow. Maintained extensions should support the same Python versions as Flask itself. On that note, I personally do not want to write any library that keeps support for Python 2.6. I prefer Python 2.7 and Python 3.2+.

This should not be mutable by default, since it too easily allows users to modify the default `decorators` on any `View` class, for instance by doing something like

```
MyView.decorators.append(my_decorator)
```

Since `list`s are mutable, unless they have explicitly declared `decorators` in the `MyView` class definition as well, this will actually append to `View`s `decorators` list, thus forcing it on all `View`s in their project that don't explicitly define `decorators`. This happened to me when writing some unit-tests for a decorator, and took a while to pin down exactly what was going on.

I haven't updated the documentation to show users supplying their lists of decorators in tuple syntax, since it looks a bit weird given `methods` right above it is a list. Let me know if you do want me to update this as well, though, or add a warning note about this.


1. In `test_no_error_swallowing` the path is hardcoded as `'flask_broken/__init__.py'`, however on Windows `co_filename` will return `'flask_broken\\__init__.py'`, and so the assertion will fail. The fix uses `os.path.join` to generate a path suitable for the current system.
2. In `test_send_file_object` the file is first opened in text mode, which converts newlines to `\n`. However, later on the same file is opened in binary mode using `app.open_resource`, and so newlines are not converted. On Windows this leads to a failing test because Git converts all newlines to `\r\n` on checkout. Basically, when opening in text mode we get `\n` newlines, and when opening in binary mode we get `\r\n` newlines. The fix solves this by opening the file in binary mode the first time, as well.

This is not accurate: https://github.com/mitsuhiko/flask/blob/0.10/flask/app.py#L239-L242

What is the current plan with regards to module support?

app = Flask(**name**)
app.debug = True
app.run()

as well as app.run(debug=True)

cause a SyntaxError: can't assign to operator execption to be raised

Trace:
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 772, in run
    run_simple(host, port, self, **options)
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 708, in run_simple
    run_with_reloader(inner, extra_files, reloader_interval)
  File "/usr/local/lib/python2.7/dist-packages/werkzeug/serving.py", line 617, in run_with_reloader
    sys.exit(restart_with_reloader())

The main application object has a register_error_handler function
which mirrors the decorator's functionality. According to the principle
of least surprise, make sure blueprints also have this convenience function.


I have a very simple app. It runs fine when the module (itself calling `app.run()`) is run.

However, when I try to run the app via CGI on Apache 2 using this `.cgi` script:

``` python
#!/usr/bin/env python

from wsgiref.handlers import CGIHandler
from someapp import app

CGIHandler().run(app)
```

it results in an exception:

``` pytb
Traceback (most recent call last):
  File "/usr/lib/python2.7/wsgiref/handlers.py", line 85, in run
    self.result = application(self.environ, self.start_response)
  File "/home/user/projects/SomeProject/venv/lib/python2.7/site-packages/flask/app.py", line 1836, in __call__
    return self.wsgi_app(environ, start_response)
  File "/home/user/projects/SomeProject/venv/lib/python2.7/site-packages/flask/app.py", line 1812, in wsgi_app
    ctx = self.request_context(environ)
  File "/home/user/projects/SomeProject/venv/lib/python2.7/site-packages/flask/app.py", line 1773, in request_context
    return RequestContext(self, environ)
  File "/home/user/projects/SomeProject/venv/lib/python2.7/site-packages/flask/ctx.py", line 247, in __init__
    self.match_request()
  File "/home/user/projects/SomeProject/venv/lib/python2.7/site-packages/flask/ctx.py", line 286, in match_request
    self.url_adapter.match(return_rule=True)
  File "/home/user/projects/SomeProject/venv/lib/python2.7/site-packages/werkzeug/routing.py", line 1386, in match
    self.subdomain, path_info.lstrip('/'))
AttributeError: 'NoneType' object has no attribute 'lstrip'
```

The setup is Flask 0.10.1 with Werkzeug 0.9.4.

On first sight, the WSGI environment variables seem to be incomplete, or something like that.

in following line:

This behavior allows relative URLs to continue working even if the trailing slash is ommited, consistent with how Apache and other servers work. Also, the URLs will stay unique, which helps search engines avoid indexing the same page twice.

"ommited" should be "omitted"

There is a parenthesis missing at the end of the lighttpd configuration file snippet on this page: http://flask.pocoo.org/docs/deploying/fastcgi/

Also, it may be helpful to show the required module include statements:

```
server.modules += ("mod_fastcgi", "mod_rewrite", "mod_alias")
```

Hello! I have self signed certificate. But there is an error when i try to use it (Python 3.3.2)

```
context_SSL = SSL.Context(SSL.SSLv23_METHOD)
context_SSL.use_privatekey_file(conf.SSLKeyPath)
context_SSL.use_certificate_file(conf.SSLCertPath)
app.run(host=conf.host, port=conf.port, ssl_context=context_SSL)
```

Here the error

> Unhandled exception in thread started by <function run_simple.<locals>.inner at 0x7f8a306d1cb0>
> Traceback (most recent call last):
>   File "/usr/lib/python3.3/site-packages/werkzeug/serving.py", line 692, in inner
>     passthrough_errors, ssl_context).serve_forever()
>   File "/usr/lib/python3.3/site-packages/werkzeug/serving.py", line 486, in make_server
>     passthrough_errors, ssl_context)
>   File "/usr/lib/python3.3/site-packages/werkzeug/serving.py", line 425, in **init**
>     self.socket = tsafe.Connection(ssl_context, self.socket)
>   File "/usr/lib/python3.3/site-packages/OpenSSL/tsafe.py", line 11, in **init**
>     self._ssl_conn = apply(_ssl.Connection, args)
> NameError: global name 'apply' is not defined

Hi,
I've write a simple code for open a sqlite db with flask. 

```
from flask import Flask, render_template, g
import sqlite3 as lite

# configuration
DATABASE = 'card.db'
DEBUG = True

app = Flask(__name__)
app.config.from_object(__name__)

@app.route('/')
def index():
   g.db = lite.connect(app.config['DATABASE'])
   cur = g.db.execute('select * from card')
   cards = [dict(card_name=row[1], low=row[2], medium=row[3], high=row[4]) for  row in cur.fetchall()]
   g.db.close()
   render_template('index.html', cards=cards)

if __name__ == '__main__':
    app.run()
```

but when i launch the app:

```
OperationalError: no such table: card
```

'card.db' is in the main folder with the script and when i open the db with the python console work perfectly

```
>>> import sqlite3 as lite
>>> conn = lite.connect('card.db')
>>> cur = conn.execute('select * from card')
>>> rows = cur.fetchall()
>>> for row in rows:
...     print row
```

I've try to change path but:

```
OperationalError: unable to open database file
```

or remove the quotes from app.config['DATABASE'] but:

```
KeyError: 'card.db'
```

I've tried with another project from 0, another db, other information but flask give me the same error 

```
OperationalError: no such table: film
```

How i can resolve? 

 Installation

Flask depends on two external libraries, Werkzeug and Jinja2. Werkzeug is a toolkit for WSGI, the standard Python interface between web applications and a variety of servers for both development and deployment. Jinja2 renders templates.

So how do you get all that on your computer quickly? There are many ways you could do that, but the most kick-ass method is virtualenv, so let's have a look at that first.

You will need Python 2.6 or higher to get started, so be sure to have an up-to-date Python 2.x installation. For using Flask with Python 3 have a look at :ref:`python3-support`.

:ref:`python3-support` should be :ref:`python3_support`.

I'd like to submit the Flask extension I wrote, [Flask-Misaka](https://github.com/singingwolfboy/flask-misaka), for review for inclusion on the extensions registry page.

I'm deploying my flask website to heroku and they pass 4 headers to flask: `X-Forwarded-For`, `X-Forwarded-Proto`, `X-Forwarded-Port` & `X-Request-Start`.

I want to use all of these headers in flask, however if there are multiple of these headers (except `X-Forwarded-For`) flask will only use the last ones, even when using `request.headers.get_all` or `request.headers.getlist`.

This is problematic as the client can easily fake these headers, which will override those values passed from heroku.

As the `request.headers` object is already the type `werkzeug.datastructures.EnvironHeaders`, which subclasses `werkzeug.datastructures.Headers`, which have support for a key with multiple values, I don't think it will be that hard to implement.

Example code:
`test.py`

```
import requests
from flask import Flask, request
app = Flask(__name__)

@app.route('/')
def test():
    k = 'X-Request-Start'
    h = request.headers
    print h.get(k)
    print h.get_all(k)
    print h.getlist(k)
    return 'Check the logs\n'

if __name__ == '__main__':
    app.run()
```

Testing:

```
python test.py &
curl -H 'X-Request-Start: test1' -H 'X-Request-Start: test2' http://127.0.0.1:5000/
```

Logs:

```
 * Running on http://127.0.0.1:5000/
test2
['test2']
['test2']
127.0.0.1 - - [27/Aug/2013 17:30:45] "GET / HTTP/1.1" 200 -
```

Expected result in logs:

```
 * Running on http://127.0.0.1:5000/
test2
['test1', 'test2']
['test1', 'test2']
127.0.0.1 - - [27/Aug/2013 17:30:45] "GET / HTTP/1.1" 200 -
```

I'm not quite sure whether this is acceptable. 

```
app.config('DEBUG')  == app.config.get('DEBUG')
```

But instead of raise an useless `not callable` exception, this could save some key strokes.

Update

Update

This pull request split `flask.Flask` object into many, specialized, so-called "mixins", getting inspired from `werkzeug.wrappers.Response`.
This has three main goals:
1. make reading a bit easier: you should be able to find faster what you're looking for, instead of digging through the megalithic `flask.Flask`;
2. identify mixins common to application and blueprint objects (see #593);
3. inspire discussion about spitting `flask.Flask` into specialized object, accessible through `Flask.routing`, `Flask.templating`, etc. that could be overridden more easily.
I did my best to find the right mixin for each function/attribute, but I'm really unsure. Please, don't bash me too hard if I'm wrong ;-)

If you create a blueprint with an url_prefix, but then register it with a different url_prefix the url_prefix attribute of the blueprint was wrong, now this attribute is updated to the correct url_prefix.


Minor documentation update to the get_json method.

And The 63 line expected 1 blank line.

When download documentation as mobi format all references are to Flask 0.9. The actually version of Flask is 0.10.1.

I find this issue in Flask documentation download mobi link.

It's already mentioned correctly in the quickstart docs, but this typo was a little bit confusing for a second.

This allows adding error handlers like this:

``` python
@app.errorhandler(werkzeug.exceptions.Forbidden)
```

And subclassing HTTPExceptions:

``` python
class ForbiddenBecauseReason(Forbidden): pass

@app.errorhandler(ForbiddenBecauseReason)
def error1():
    return "Forbidden because reason", 403

@app.errorhandler(403)
def error2():
    return "Forbidden", 403
```

... the idea being, that a flask extension might want to raise an exception, with the default behaviour of creating a HTTP error page, but still allowing the user to add a view/handler specific to that exception (e.g., "Forbidden because you are not in the right group").

get_cookie_path: fix docstring

Pythons 2.7.5, 2.6.8, 3.3.2.

...work/Flask-0.10.1 $ PYTHONPATH=. python2.7 run-tests.py
OR
...work/Flask-0.10.1 $ PYTHONPATH=../Flask-0.10.1-python3_3/lib/ python3.3 run-tests.py 

yield

``` python
======================================================================
FAIL: test_uninstalled_package_paths (flask.testsuite.config.InstanceTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/testsuite/config.py", line 167, in test_uninstalled_package_paths
    self.assert_equal(app.instance_path, os.path.join(here, 'test_apps', 'instance'))
  File "/mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/testsuite/__init__.py", line 139, in assert_equal
    return self.assertEqual(x, y)
AssertionError: '/mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/tes [truncated]... != '/mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/tes [truncated]...
- /mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/testsuite/test_apps/config_package_app/instance
?                                                                                                 -------------------
+ /mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/testsuite/test_apps/instance


======================================================================
FAIL: test_json_key_sorting (flask.testsuite.helpers.JSONTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/testsuite/helpers.py", line 200, in test_json_key_sorting
    '}'
  File "/mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/testsuite/__init__.py", line 139, in assert_equal
    return self.assertEqual(x, y)
AssertionError: Lists differ: ['{', '"values": {', '"0": "fo... != ['{', '"values": {', '"0": "fo...

First differing element 4:
"10": "foo",
"2": "foo",

  ['{',
   '"values": {',
   '"0": "foo",',
   '"1": "foo",',
+  '"2": "foo",',
+  '"3": "foo",',
+  '"4": "foo",',
+  '"5": "foo",',
+  '"6": "foo",',
+  '"7": "foo",',
+  '"8": "foo",',
+  '"9": "foo",',
   '"10": "foo",',
   '"11": "foo",',
   '"12": "foo",',
   '"13": "foo",',
   '"14": "foo",',
   '"15": "foo",',
   '"16": "foo",',
   '"17": "foo",',
   '"18": "foo",',
-  '"19": "foo",',
?              -

+  '"19": "foo"',
-  '"2": "foo",',
-  '"3": "foo",',
-  '"4": "foo",',
-  '"5": "foo",',
-  '"6": "foo",',
-  '"7": "foo",',
-  '"8": "foo",',
-  '"9": "foo"',
   '}',
   '}']

======================================================================
FAIL: test_appcontext_signals (flask.testsuite.signals.SignalsTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/testsuite/signals.py", line 118, in test_appcontext_signals
    self.assert_equal(recorded, ['push', 'pop'])
  File "/mnt/gen2/TmpDir/portage/dev-python/flask-0.10.1-r1/work/Flask-0.10.1/flask/testsuite/__init__.py", line 139, in assert_equal
    return self.assertEqual(x, y)
AssertionError: Lists differ: ['push', 'push'] != ['push', 'pop']

First differing element 1:
push
pop

- ['push', 'push']
?            ^^^

+ ['push', 'pop']
?            ^^


----------------------------------------------------------------------
Ran 233 tests in 4.839s

FAILED (failures=3)
```

http://flask.pocoo.org/docs/tutorial/views/#login-and-logout

Flask should not lead new users astray, and should instead make it as easy and obvious as possible to do the right thing.

Currently getting a TypeError: Decimal('0.10') is not JSON serializable error when, you guessed it, I try to encode a Decimal.

I found an accepted fix here: http://stackoverflow.com/questions/4019856/decimal-to-json, but not sure where I should be implementing that within Flask. I tried it within my main app file, but it doesn't appear to be working. 

In version 0.9 I could simply get the value of the `session` like this: 

```
flask.session.serialize()
```

But after upgrading to 0.10 this is not working anymore.. what's the alternative? How can I get the session value?

(`flask.request.cookies.get('session')` is not good for me, because I would like to get the session right after login, so it's not part of the request yet)

Unfortunately, I have spent almost two hours altogether with tracking down a simple Attribute issue alongside others' time who were trying to kindly help me.

The problem is simply that I could not get the error message to fix a trivial issue. This is because I was trying to use the following these two lines to get debug messages based on the quick start:

if **name** == '**main**':
    application.run(debug=True)

... however this will not work with mod_wsgi, now I know.

Hereby, I suggest to improve the documentation by including this fact, and advise the use of the following instead:

application.debug = True

This will potentially save a lot of time for those users, and it is not an intrusive documentation addition either.

URLSafeTimedSerializer is the default session backend and it seems to match the requirements (mostly it's use of zlib) for this class of attack to work even if protocol level mitigations have already been used. You'd need a user controllable value in the cookie but I suspect this is not entirely uncommon.


"Added information about custom error handlers in Blueprints with example based simple_page.  Includes link to errorpages."

I was looking for a simple explanation of the use Blueprint-specific error handlers.  Couldn't find one in the documentation, but I did figure out how to do it by looking at the actual Blueprint code.  I figured I'd add this to the doc to save others a little time in the future.

This PR adds a `safe_hosts` parameter to `redirect`, which allows defining a safe set of hosts to redirect to and issues a `DeprecationWarning`, if `redirect` is used to redirect to a different host than the one of the application or defined in `safe_hosts`. In the future instead of a `DeprecationWarning` being issued, an exception should be raised.

The purpose of this change is to prevent [unvalidated redirects](https://www.owasp.org/index.php/Top_10_2010-A10-Unvalidated_Redirects_and_Forwards), which is currently listed among the Top 10 of the most common web application vulnerabilities by OWASP and was recently mentioned by [Jacob Kaplan-Moss at a talk at PyCon Australia](https://www.youtube.com/watch?v=sra9x44lXgU). It's also an easy way to improve our results in comparisions like these ;)

The source tarball for itsdangerous 0.22 is missing a LICENSE file.   https://github.com/mitsuhiko/itsdangerous/pull/22   This means that flask 0.10.1 cannot be packaged.

Thought this would be useful for some people. 

My use case stems from the fact that its not trivial to generate a Python file with a deployment tool like Chef. But it is trivial to render a JSON file.

When loading my flask module `python -m project.modules.flaskhandler.py` everything works nicely.  Unfortunately, if I enable debug mode and **use_reloader**, the module is loaded, but when reloader restarts the application, it changes my sys.path.

sys.path's first value changes from **''** to **'project/modules/'** which prevents absolute imports from other modules in my project.

I was able to work around this problem with the following code at the top of my flaskhandler.py file:

```
import sys
import os

# Flask reloader hack
sys.path.append(os.getcwd())
```

I have been having issues for 3-4 days now to get a hello world up and running on the remote server. I figured out that it would be nice if there was a documentation from A-Z how to get that done and working.

http://flask.pocoo.org/docs/deploying/mod_wsgi/

The current documentation does not provide an example what to put into an exact python file, and what url to open up in the web browser to get the desired python module running on the remote server. It is okay to have references to other places if that is more logical, but the idea is to have a self-contained page which I can start reading, and by I reach the end, I will have a working remote hello world.

This would be well appreciated.

When using url_for with _external argument set to "True", the returned url does not contain the port which defaults the url to port 80.

I have read a few posts regarding this and it was because people were not specifying the full "SERVER_NAME" but I didn't set it.

At first, I was creating an app context to use url_for but it told me I had to set my server name but I can't set it as it might be dynamic upon a user configuration.

Anyhow, what I did was to create an app context and create a test_request context to use url_for which gave me the whole URL without the port.

In the Flask Tutorial, the variable DATABASE is defined as a system path for a SQLite3 file, and then is called here by app.config(). However this parameter was written as app.config('DATABASE'), treating the parameter as a string. The quotes needed to be removed to properly reference the variable.

I wish to be able to use regex in url rules. For example 

```
@app.route('/<regex:*regular expression*:var>/')
def page(var):
     return var.Upper()
```

Is it possible to make it real?
P.S. I wish to take part in it, but I need a kind of mentoring.

I have a website with acces by more subdomain like : 
- 'www.mysite.com', 'category1.mysite.com', 'category2.mysite.com', ...
  whose point to one blueprint.

It's interesting to manage more one subdomain by blueprint, for example by a list : 
- landing_bp = Blueprint('landing', **name**, subdomain=['www','category1','category2'], url_prefix='/landing')

Or disable subdomain.

Thank's you.

Verify this works by building the docs and clicking the link in the `test_request_context` function definition.

In addition I noticed sphinx is not mentioned as an optional install in the `setup.py` file, it may be nice to add it there or check for its presence in the docs Makefile

Tests when simplejson was installed were failing because of a change in
how it sorted in v3.0.0. This change first tests it via normal int
sorting for stdlib json then if that fails, it tests against str sorting
for simplejson.

I am new to programming, I tried to run flaskr but could not because the application does not find the directory '/ tmp / flaskr.db' if the path is 'flaskr.db' not to run the application.

Can I do this?

- It was unclear from reading the documentation where the author intened make_dicts to go, so I added that information
- The docs had a bug in the code, referring to `cursor` in the argument list but `cur` in the generator expression


I've seen that people often write `@app.route(..., methods=["POST"])`  as `@app.route(..., methods="POST")`, which won't error immediately, but return a `405` status code later.

Which is very unfortunate, as people might think the methods parameter is a space or comma separated string with methods. Sometimes i write that myself because i still don't memorize that this part of Flask's API is actually that "heavy" on the syntax.

So what i propose is to add the following normalization code in `Flask.add_url_rule`:

``` python
if isinstance(methods, str):
    if ',' in methods:
        methods = methods.split(',')
    elif ' ' in methods:
        methods = methods.split(' ')
    else:
        methods = (methods,)
```

Fix missing `dt` closing tag.


Fedora 14 64bit, using virtualenv

code in views.py
...
def index()
    ...
    flash(message)
    return ...

in Flask 0.9 it works fine.

But when i use 0.10 then it throws me:

Traceback (most recent call last):
  File "/opt/flask/lib/python2.7/site-packages/gevent/pywsgi.py", line 438, in handle_one_response
    self.run_application()
  File "/opt/flask/lib/python2.7/site-packages/gevent/pywsgi.py", line 424, in run_application
    self.result = self.application(self.environ, self.start_response)
  File "/opt/flask/flask-websocket/app/**init**.py", line 52, in my_app
    return app(environ, start_response)
  File "/opt/flask/lib/python2.7/site-packages/flask/app.py", line 1836, in **call**
    return self.wsgi_app(environ, start_response)
  File "/opt/flask/lib/python2.7/site-packages/flask/app.py", line 1820, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/opt/flask/lib/python2.7/site-packages/flask/app.py", line 1403, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/opt/flask/lib/python2.7/site-packages/flask/app.py", line 1817, in wsgi_app
    response = self.full_dispatch_request()
  File "/opt/flask/lib/python2.7/site-packages/flask/app.py", line 1479, in full_dispatch_request
    response = self.process_response(response)
  File "/opt/flask/lib/python2.7/site-packages/flask/app.py", line 1693, in process_response
    self.save_session(ctx.session, response)
  File "/opt/flask/lib/python2.7/site-packages/flask/app.py", line 837, in save_session
    return self.session_interface.save_session(self, session, response)
  File "/opt/flask/lib/python2.7/site-packages/flask/sessions.py", line 326, in save_session
    val = self.get_signing_serializer(app).dumps(dict(session))
  File "/opt/flask/lib/python2.7/site-packages/itsdangerous.py", line 537, in dumps
    payload = want_bytes(self.dump_payload(obj))
  File "/opt/flask/lib/python2.7/site-packages/itsdangerous.py", line 809, in dump_payload
    json = super(URLSafeSerializerMixin, self).dump_payload(obj)
  File "/opt/flask/lib/python2.7/site-packages/itsdangerous.py", line 522, in dump_payload
    return want_bytes(self.serializer.dumps(obj))
  File "/opt/flask/lib/python2.7/site-packages/flask/sessions.py", line 85, in dumps
    return json.dumps(_tag(value), separators=(',', ':'))
  File "/opt/flask/lib/python2.7/site-packages/flask/json.py", line 126, in dumps
    rv = _json.dumps(obj, **kwargs)
  File "/usr/lib64/python2.7/site-packages/simplejson/__init__.py", line 268, in dumps
    use_decimal=use_decimal, **kw).encode(obj)
  File "/usr/lib64/python2.7/site-packages/simplejson/encoder.py", line 216, in encode
    chunks = list(chunks)
  File "/usr/lib64/python2.7/site-packages/simplejson/encoder.py", line 485, in _iterencode
    for chunk in _iterencode_dict(o, _current_indent_level):
  File "/usr/lib64/python2.7/site-packages/simplejson/encoder.py", line 459, in _iterencode_dict
    for chunk in chunks:
  File "/usr/lib64/python2.7/site-packages/simplejson/encoder.py", line 380, in _iterencode_list
    for chunk in chunks:
  File "/usr/lib64/python2.7/site-packages/simplejson/encoder.py", line 459, in _iterencode_dict
    for chunk in chunks:
  File "/usr/lib64/python2.7/site-packages/simplejson/encoder.py", line 380, in _iterencode_list
    for chunk in chunks:
  File "/usr/lib64/python2.7/site-packages/simplejson/encoder.py", line 495, in _iterencode
    o = _default(o)
  File "/opt/flask/lib/python2.7/site-packages/flask/json.py", line 83, in default
    return _json.JSONEncoder.default(self, o)
  File "/usr/lib64/python2.7/site-packages/simplejson/encoder.py", line 190, in default
    raise TypeError(repr(o) + " is not JSON serializable")
TypeError: lu'Transaction <a href="/transaction_view/2" >20</a> of <a href="/user/view/1" >F3535324</a> has been added ' is not JSON serializable

According to the note in the comment, you had to check to make sure that the 
defaults were not an empty dictionary because of a bug in Werkzeug pre-0.7.

Since Flask officially requires 0.7 or greater, we can remove this little 
workaround.

When you run a Flask application with Python's -u parameter and Flask's auto-reloader, the application exits upon reload. Expected action is to reload and continue to run.

Here is the test case for #798.

It should broke in current Flask, and after #798 it won't.



As stated in Issues/804, a simple use of ScriptAlias behaves like plain CGI--a new process is created for each request. Starting up worker processes with Apache or by using an external FCGI server cuts the response time down from 1000ms to ~30ms per request.

Currently, the `run()` method of the Flask object takes as parameters `the host, the port, the debug mode, and some options (like the reloader mode)`.

It would be cool to add a `server` parameter that will be set default to Werkzeug's `run_simple()` function but could be another one like Gunicorn.

To run an application with our choice server, we could do:
`application.run(host=0.0.0.0, port=5000, server='gunicorn')`

This is mostly a «shortcut» than a real feature. If you have any cons (or pros, why not), please tell me :)

The use of ScriptAlias at http://flask.pocoo.org/docs/deploying/fastcgi/
 is not correct because it will spawn one process per request. This is a more useful example derived from http://requesttracker.wikia.com/wiki/FastCGIConfiguration

```
LoadModule fastcgi_module /usr/lib64/httpd/modules/mod_fastcgi.so

FastCgiServer /var/www/html/eventlog/app.fcgi -idle-timeout 300 -processes 5
<VirtualHost *>
    ServerName webapp1.mydomain.com
    DocumentRoot /var/www/html/eventlog

    AddHandler fastcgi-script fcgi
    ScriptAlias / /var/www/html/eventlog/app.fcgi/

    <Location />
        SetHandler fastcgi-script
    </Location>
</VirtualHost>
```

will return 

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<title>400 Bad Request</title>

<h1>Bad Request</h1>

<p>The browser (or proxy) sent a request that this server could not understand.</p>

Dear Flask-Team,

thanks for the good work. I have been using Flask for quite a while now.
In my project I use flask to receive requests from a command line client.
The server is running with an adhoc SSL context. The client sends a SSL client certificate which I need to parse in the request handler.

If I use a web server (e.g. nginx) to dispatch the request to Flask, I can configure the request environment to include the client certificate like so:
  `fastcgi_param CLIENT_CERT $ssl_client_cert;`
  `fastcgi_param CLIENT_RAW_CERT $ssl_client_raw_cert;`

Now, I want the same behavior when I run the development server (or any other mean to get the client cert).
Currently I am starting the app server like so:
  `self._app.run(host=host, port=app_port, ssl_context='adhoc', debug=True)`

Can you help?

The following fails at the assert inside the index subroutine.

``` python
import unittest
from flask import Flask, url_for, request, jsonify

class TestFlask(unittest.TestCase):

    def test_get_with_arguments(self):
        app = Flask(__name__)
        app.debug = True

        @app.route('/echo')
        def index():
            assert 'key' in request.args
            return jsonify( dict(key=request.args['key']) )

        url = None
        with app.test_request_context():
            url = url_for('index', key='test', _external=True)

        assert url == 'http://localhost/echo?key=test'

        rv = app.test_client().get(url)
        assert 'key' in rv.data
```

This attempts to clear up confusion caused in the tutorial using `.from_envvar()`.  I don't think it is perfect but it might be a start.  

The issue presented in  issue #783 was that someone might try to replace the `.from_object()` line instead of just appending the `from_envvar()`.  While, when I first read the tutorial, I didn't interpret it that way, I can see where the confusion could come from.    

How this PR attempts to fix this issue if by taking out the language about removing the `.from_object` method and just mentioning that you could use them alongside one another to create a robust setup. 

Thoughts welcome!


Without this patch, the response will always set cookie, even the session is not changed.

For example:

``` py
@app.route('/')
def home():
    return 'home'


@app.route('/session')
def set_session():
    session['foo'] = 'bar'
    return 'session'
```

If you have visited `/session`, the next time when you visit `/` it will always send the `Set-Cookie` header.

I have next example which work fine with `flask==0.9`, `werkzeug==0.8.3` and fail with `flask==0.10.1`, `werkzeug==0.9.1`:

```
from flask import Flask, request


def create_app():
    class Config(object):
        SECRET_KEY = 'test'

    app = Flask(__name__)
    app.config.from_object(Config)

    @app.route('/', methods=['POST'])
    def home():
        assert request.values['PHONE'] == '+7(910)123-45-67'
        return request.values['PHONE']

    return app


if __name__ == '__main__':
    app = create_app()
    #app.run('0.0.0.0', 8080, True)
    client = app.test_client()
    response = client.post('/', data={'PHONE': '+7(910)123-45-67'})
    assert response.data == '+7(910)123-45-67', response.data
```

When I try `wget --post-data='PHONE=%2B7%28910%29123-45-67' localhost:8080` it also will work with `flask==0.9` and don't with `flask==0.10.1`.

For `flask==0.10.1` I have `request.data=='PHONE=%2B7%28910%29123-45-67'`, but empty `request.values` and `request.form`.

I'm getting the following error in flask 0.10:

AssertionError: View function mapping is overwriting an existing endpoint function: etc

The other members of the project, who have configured their environment earlier, are not getting this error. The requirements.txt file is requesting flask 0.9, but whenever I try to install that version, I end up having 0.10.

So I'm assuming that the difference between their environment and mine is that version number (since that error is related to flask). So are there new features in 0.10 that break apps developed for 0.9? And how can I install 0.9? It looks like the 0.9 branch is missing in the repo.

lets suppose i have this routes:

``` python
app.add_url_rule('/',
                  view_func=index,
                  methods=['GET'])

app.add_url_rule('login',
                  view_func=login,
                  methods=['GET', 'POST'])

@validate_access()
def index():
    #......

@validate_access()
def login():
    #......
```

I have 2 endpoints with same decorator "@validate_access".
When i run this code i got

```
AssertionError: View function mapping is overwriting an existing endpoint function: wrapperAssertionError: View function mapping is overwriting an existing endpoint function: wrapper
```

I don't know if its a bug or not. But please inform me if there is a solution for this.

Thanks :) 

So I'm not sure if this is meant to happen, but when you attempt to use MethodViews as described in the docs http://flask.pocoo.org/docs/views/#method-views-for-apis, I get an Assertion Error generated by the [app.add_url_rule](https://github.com/mitsuhiko/flask/blob/master/flask/app.py#L983) added in 661ee54bc2bc1ea0763. This commit was created to fix #570. 

The MethodView example in the docs calls for registering multiple routes to the same class, which causes an AssertionError to be raised. 

Is there another way to create a method based set of views without causing this error to be raised? Would it be better to switch from an AssertionError to a Warning that could be ignored? 

``` python
bp = Blueprint(__name__, __name__, url_prefix=("/profile", "/personal/profile"), static_folder="static")

@bp.route("/main", methods=["GET"])
def page():
    pass
```

The `url_for` for static files works based on added `static` URL rule, This rule is based on Werkzeug's `path` converter that is designed for URL path, here we need some converter for file path. In URL path, path is '/' delimited, but in file path it can be '\' delimited.

My solution is to define a custom converter class `FilePathConverter` that uses `urllib`'s `pathname2url` function in its `to_url` method.

The test suite is also updated to support the change by adding a `os.path.normpath` conversion in requested static path.

Hello,

I'm new to python and I'm just playing around Flask. 
Please consider following application (I have simplified my application to just show the issue):

``` Python
@app.route('/thread', methods=['GET'])
def thre():

    def run():
        # Execute some external command. 
        # Note: I tried popen, call, etc...
        os.system("sleep 10")
        print "Done"

    # Execute the external command in a own process in order to return quickly
    # Note: I tried Thread, start_thread, etc...
    backProc = Process(target=run, args=())
    backProc.start()        

    # Create a generator/iterator. (Simplified)
    def gen():
        yield "My Result"
        return

    # Return the generator. 
    return Response(gen(),  status = 200, mimetype='text/plain')
```

If I will now call the REST service with curl 

`curl localhost:5000/thread`

then I noticed that curl waits 10 seconds before it returns. It seem like that the "os.system" call blocks Flask of sending the data to the client. 

If I use the same example without generator/iterator everything works as expected. The client receives the "My Result" before the "os.system" call finished.

Modified jsonify to allow passing the same parameters of json.dumps (expecially to support custom encoders). Test suite updated to support the update.

On docs/_sources/testing.txt it states in the section _Faking resources and context_:

> A very common pattern is to store user authorization information and
> database connections on the application context or the :attr:`flask.g`
> object.  The general pattern for this is to put the object on there on
> first usage and then to remove it on a teardown.  Imagine for instance
> this code to get the current user::

This should be adjusted as `fask.g` is now registered on the application context.

Hi,

I was testing out flask today and noticed that the default object type returned from PyMongo specifically (flask.ext.pymongo) could not parse objects with ObjectID and some date types.

There is a library in bson called json_util that can serialize eveything dumps can and everything from a mongodb document.  

So I was wondering if you would consider using that, i am testing it in my code locally now.  I may even try return an array or object depending on the size of the mongo result.

```
from __future__ import absolute_import
from flask import make_response, current_app
<<<from bson import json_util>>>
from json import dumps

# This dictionary contains any kwargs that are to be passed to the json.dumps
# function, used below.
settings = {}


def output_json(data, code, headers=None):
    """Makes a Flask response with a JSON encoded body"""

    # If we're in debug mode, and the indent is not set, we set it to a
    # reasonable value here.  Note that this won't override any existing value
    # that was set.  We also set the "sort_keys" value.
    local_settings = settings.copy()
    if current_app.debug:
        local_settings.setdefault('indent', 4)
        local_settings.setdefault('sort_keys', True)

    # We also add a trailing newline to the dumped JSON if the indent value is
    # set - this makes using `curl` on the command line much nicer.
    dumped = dumps(data, <<<default=json_util.default,>>> **local_settings)
    if 'indent' in local_settings:
        dumped += '\n'

    resp = make_response(dumped, code)
    resp.headers.extend(headers or {})
    return resp
```

changed `werkzeug.serving.run_simple` to `werkzeug.run_simple` in app.run docstring.

"many" refers to more than one revision control system

If I have multilanguage site, for example english version hosted on `example.com` and russian on `example.ru` I can't create url to site with another language with `url_for`.

If I have static files and want put it to CDN for production. I can't set url to it with `url_for`.

So it will be greate add additional variable to `_external`, `_method`, `_achor` like `_server_name` (or make `_external` as string to another host) for `url_for`.
1. If `_server_name` is None (or `_external` is False or not basestring) , then return url like now.
2. If `_server_name` is not None and `_external` is True, then raise exception or ignore `_external`.
3. If `_servet_name` is not None and `_external` is False (or `_external`  is basestring), then return url like application config have `SERVER_NAME` == `_sever_name` and `_external` is True.

Also will be greate make default `_server_name` (or `_external`) for specific endpoints. For example for `static` endpoint add default server name to application config because it allow move current static to CDN with changing just config.

changed "an 200 OK error code" to "a 200 OK status code"

It's my curse to discover documentation ambiguities ( even when they don't exist ) and then trip over them.

When I read, (step 2 of flaskr tutorial)

"Usually, it is a good idea to load a configuration from a configurable file. This is     what from_envvar() can do, replacing the from_object() line above:

```
app.config.from_envvar('FLASKR_SETTINGS', silent=True)
```

That way someone can set an environment variable called FLASKR_SETTINGS to specify a config file to be loaded which will then override the default values. The silent switch just tells Flask to not complain if no such environment key is set." 

I took that to mean, "Replace that 'from_object" instance. Well no. The text does not say that but I did anyway and debugged for a while until I removed the silent option, saw the noise and realized that that line would not work as described in this context.

It is a good point. Configuration files are good. I would box this into a "Note:" That concludes with a, "Do not replace this line now."

Simpler of course would be to omit entirely. Another alternative is to leave as a problem for the reader at the end of the section.

(Documentation is hard - there are too many personally costumized mental OS's out there to ever possibly fully debug docs)

Title says it all.
1..DATABASE='flaskr'            works for windows and linux
2..DATABASE='/tmp/flaskr'    only works for linux and probably OS10 

test_appcontext_signals() fails with blinker installed. I use blinker 1.2. This failure occurs with Python 2.6, 2.7 and 3.3.

```
======================================================================
FAIL: test_appcontext_signals (flask.testsuite.signals.SignalsTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/tmp/flask/flask/testsuite/signals.py", line 118, in test_appcontext_signals
    self.assert_equal(recorded, ['push', 'pop'])
  File "/tmp/flask/flask/testsuite/__init__.py", line 139, in assert_equal
    return self.assertEqual(x, y)
AssertionError: Lists differ: ['push', 'push'] != ['push', 'pop']

First differing element 1:
push
pop

- ['push', 'push']
?            ^^^

+ ['push', 'pop']
?            ^^


```

test_json_key_sorting() fails with simplejson installed. I use simplejson 3.3.0.  This failure occurs with Python 2.6, 2.7 and 3.3.

```
======================================================================
FAIL: test_json_key_sorting (flask.testsuite.helpers.JSONTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/tmp/flask/flask/testsuite/helpers.py", line 200, in test_json_key_sorting
    '}'
  File "/tmp/flask/flask/testsuite/__init__.py", line 139, in assert_equal
    return self.assertEqual(x, y)
AssertionError: Lists differ: ['{', '"values": {', '"0": "fo... != ['{', '"values": {', '"0": "fo...

First differing element 4:
"10": "foo",
"2": "foo",

  ['{',
   '"values": {',
   '"0": "foo",',
   '"1": "foo",',
+  '"2": "foo",',
+  '"3": "foo",',
+  '"4": "foo",',
+  '"5": "foo",',
+  '"6": "foo",',
+  '"7": "foo",',
+  '"8": "foo",',
+  '"9": "foo",',
   '"10": "foo",',
   '"11": "foo",',
   '"12": "foo",',
   '"13": "foo",',
   '"14": "foo",',
   '"15": "foo",',
   '"16": "foo",',
   '"17": "foo",',
   '"18": "foo",',
-  '"19": "foo",',
?              -

+  '"19": "foo"',
-  '"2": "foo",',
-  '"3": "foo",',
-  '"4": "foo",',
-  '"5": "foo",',
-  '"6": "foo",',
-  '"7": "foo",',
-  '"8": "foo",',
-  '"9": "foo"',
   '}',
   '}']

```

Under the URL Building section. I read,
   "Reversing is often more descriptive than hard-coding the URLs."

And I thought, "I have been asleep while reading again". So I did a search on the Quickstart, and this is the first instance of the term "reversing" in the text. I couldn't make any sense of "reversing'". Worse how could it be more descriptive when I have no idea what it is. After searching a bit, I suggest the following minor change to text at the beginning of the section.

Replace:
"If it can match URLs, can Flask also generate them? Of course it can. To build a URL to a specific function you can use the url_for() function." 

With:
"If Flask can match URLs, can it also generate them? Of course it can.  To build a URL for a specific function you can use the url_for() function. This is called reversing the view."

Do I have this right?  Django at least talks about functionality that is similar to what you are talking about here. Terminology is never an exact match across similar tools. So if my suggestion is not correct, then it is demonstration of how I came to the wrong conclusion.

Regards, Flask is definitely cool.
-m

`repr(request)` raises

```
UnicodeEncodeError: 'ascii' codec can't encode character u'\xf6' in position 44: ordinal not in range(128)
```

oddly enough, `request._get_current_object().__repr__()` works 

Apparently `__repr__` **must** return `str` in Python 2: http://stackoverflow.com/questions/3627793/best-output-type-and-encoding-practices-for-repr-functions

I'm building a flask app that would benefit from being able to spawn some subprocesses via python's standard multiprocessing module.

However, spawning just one leads to an endless loop where an infinite number of processes are spawned. Yikes! It only happens when debug=True is passed to app.run. So it's not a problem in production, but it makes debugging hard.

This problem doesn't happen with the threading module, interestingly enough.

Code to reproduce (Python version 2.7.3 on Windows 7 x64) follows:

``` python
import time
from multiprocessing import Process
from flask import Flask

app = Flask(__name__)

def testFun():
    print 'Starting'
    time.sleep(3)
    print '3 Seconds Later'
backProc = Process(target=testFun, args=())
backProc.start()

@app.route('/')
def root():
    return 'Root'

if __name__ == '__main__':
    app.run(debug=True)
```

Fixed a small typo.

Similar to `request_class`, `response_class` and `app_ctx_globals_class`, the `config_class` attribute of `Flask` allows to specify custom class that stores the configuration for the app:

``` python
import flask

class Config(flask.Config):
    def __getitem__(self, key):
        try:
            return super(Config, self).__getitem__(key)
        except KeyError:
            return None

class Flask(flask.Flask):
    config_class = Config
```

The current alternative is to override `make_config` and repeat its logic (such as handling of `instance_relative` argument). This should be more convenient and robust.

http://feedback.flask.pocoo.org/faq

> While we cannot integrate that into Flask in the same way because we do not have any kind of user interface that could accomodate such a button, we however encourage users to send us little messages about their experience with Flask.

There is a way to give users a way to send feedback through Flask -- by making the feedback form part of Flask's API.

My original idea was to create a new module `flask.feedback` that would expose two functions called something like `is_good`/`is_bad` which would be imported from `flask.__init__`.

So the enduser can do the following:

``` python

>>> import flask
>>> flask.is_good("I love me some Python 3 support.")
Thanks!
>>> flask.is_bad("lol it duznt werk")
Noted.
```

During an initial discussion in IRC, @rpicard also brought up the idea of exposing this through a CLI tool `flask-feedback`.

I already looked into a possible implementation of this, by determining whether this could be cleanly implemented via the API that already exists for the form on the website. The form seems to contain some Javascript-based spam-protection though.

While there are the options of 1.) creating a new API just for the integrated tool 2.) removing the protection, i am hesitant to do any more work, as such a feature built into Flask itself could be easily used to send massive amounts of spam, and there is little protection available against this.

I'd just hope nobody brings up the dedication to modify the tool. While i didn't check it, i guess the javascript protection could be easily bypassed as well. Probably the goal of it is just to protect against bots that crawl arbitrary websites and send off forms, not the ones that target Flask's feedback website specifically.

However, before any implementation i'd like some feedback on it.

I am using Flask with SSL.
Testing in dev environment with stunnel and a self-signed certificate.

http://localhost:5000 is Flask
https://localhost:8000 is SSL Flask through stunnel

When using redirect(url_for(...)) in the program below, the browser is redirected to http://localhost:8000/ssl (HTTP protocol instead of HTTPS)

Correct URL should be https://localhost:8000/ssl

Here is a sample program to demonstrate:

```
from flask import Flask, request, url_for, redirect

# Flask Initialization
app = Flask(__name__)

@app.route("/")
def index():
    return "Hello World"

@app.route("/ssl")
def ssl():
    return "Hello SSL World"

@app.route('/redirect/')
def redirectToSSL():
    return redirect(url_for('ssl'))

if __name__ == "__main__":
    app.run(debug=True)
```

My stunnel config is 

```
pid =
foreground = yes

cert = ./stunnel.crt
key = ./stunnel.pem

[https]
accept=8000
connect=5000
```

To test this,
- start your stunnel
- start the application
- connect to https://localhost:8000 - you should see 'Hello World'
- connect to https://localhost:8000/redirect - you should receive an error page as the browser is redirected to http://localhost:8000/ssl (instead of https:// ...)

This appears to be an issue with how Werkzeug is encoding headers, new to the version series 0.9.x:

``` python
>>> from flask import Flask
>>> app = Flask(__name__)
>>> app.test_client().get('/', headers=[('User-Agent', u'中文')])
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/Library/Python/2.7/site-packages/werkzeug/test.py", line 760, in get
    return self.open(*args, **kw)
  File "/Library/Python/2.7/site-packages/flask/testing.py", line 108, in open
    follow_redirects=follow_redirects)
  File "/Library/Python/2.7/site-packages/werkzeug/test.py", line 724, in open
    environ = args[0].get_environ()
  File "/Library/Python/2.7/site-packages/werkzeug/test.py", line 573, in get_environ
    for key, value in self.headers.to_wsgi_list():
  File "/Library/Python/2.7/site-packages/werkzeug/datastructures.py", line 1185, in to_wsgi_list
    return [(k, v.encode('latin1')) for k, v in self]
UnicodeEncodeError: 'latin-1' codec can't encode characters in position 0-1: ordinal not in range(256)
```

This affects https://github.com/maxcountryman/flask-login/issues/78.

When passing params with special characters, url_to does not url encode '+' signs.
Other special characters are correctly encoded.

Tested against 0.10.1

Test Case:

```
from flask import Flask, request, url_for, redirect

# Flask Initialization
app = Flask(__name__)

@app.route("/")
def index():
    param = {'id' : 'aaa:bbb/ccc+ddd:eee'}
    return redirect(url_for("session", **param))

@app.route('/session/')
def session():
    return request.args['id']

if __name__ == "__main__":
    app.run(debug=True) 
```

URL generated is http://127.0.0.1:5000/session/?id=aaa%3Abbb%2Fccc+ddd%3Aeee
Output printed is aaa:bbb/ccc ddd:eee

Notice the '+' not encoded in the URL, resulting is a space in the string output

Hello! Flask logs urls as encoded strings. For example if I have route with cyrillic characters: @app.route('/привет') (https://gist.github.com/dima74/5e025da90ee90a78b65bc3e3c69623ea), than flask will log "GET /%D0%BF%D1%80%D0%B8%D0%B2%D0%B5%D1%82 HTTP/1.1". It would be very nice if there is option to get that Flask logs urls decoded. (Thanks for Flask!)
I created a Sphinx extension, [sphinxcontrib-log-cabinet](https://github.com/davidism/sphinxcontrib-log-cabinet), to handle #1704. It collects each group of changelog directives, sorts them newest to oldest, then collapses all logs older than the current version. Deprecations are never collapsed.

The extension is optional, a warning is printed if it's not installed but the build continues. The flask-docs build script needs to be updated to install this if we want it to actually take effect.

The collapse doesn't work on IE because they don't support `<details>`. A later version can add a polyfill for it, but I'm not too concerned.
`process_response()` calls the `after_request` handlers as soon as a response object is returned.

In the case of streaming responses, it would be more desirable to call after_request handlers at the same time as response.close() is called.
The issue tracker is a tool to address bugs.
Please use the #pocoo IRC channel on freenode or Stack Overflow for questions.

## Versions

Python 3.6.1
Flask 0.12.1
Werkzeug 0.12.1

## Issue

A catch-all error handler (one that catches`Exception`), does not catch `werkzeug.exceptions.BadRequestKeyError`. Here's a very quick illustration of the issue:

https://github.com/sampeka/flask-issue

Steps to repoduce:
1. Clone the repo above, install requirements etc
2. Run `python ./example.py`
3. Navigate to `/good`, see that the error handler is correctly called 
4. Navigate to `/bad`, see that the error handler is not called 

If I define an error handler specifically for `BadRequestKeyError` it will be called, as expected.

Edit: If you downgrade to `Flask==0.10.1`, this example will work.
When Flask finds an error handler for a given exception, it caches it in the handler map.  This can lead to incorrect behavior for subclasses of the exception.

Here is some code demonstrating the problem:
```
from flask import Flask
from werkzeug.exceptions import InternalServerError


class E1(Exception):
    pass


class E2(Exception):
    pass


class E(E1, E2):
    pass


app = Flask(__name__)


@app.errorhandler(E2)
def handle_e2(e):
    return "E2", 500


@app.errorhandler(Exception)
def handle_exception(e):
    return "Exception", 500


@app.route("/<exception>", methods=['POST'])
def raise_exception(exception):
    exc = globals()[exception]
    raise exc


def test_errorhandler_precedence():
    client = app.test_client()

    response1 = client.post('/E1')
    assert response1.data == "Exception"

    response2 = client.post('/E')
    assert response2.data == "E2"
```

In this example, we have two exception classes, `E1` and `E2`, and a third exception `E` that inherits from both.  We register error handlers for `E2` and `Exception`.  When `E` is raised, Flask should invoke the `E2` error handler as `E2` comes before `Exception` in the MRO of `E`.  But if `E1` has been raised in the past, then the `Exception` error handler will be "cached" as the handler for `E1`, so that handler will be invoked instead.
Use `inspect` to check if the factory takes an argument before passing the script info instance to it.

Preferably pass the info as a keyword instead of positional argument, so that the developer could do something like `def create_app(config=None, script_info=None)`. Still check if the function takes a `script_info` argument before passing it.

Alternatively (or additionally), show how to pass arguments to the factory through the info. I *think* this can be done by overriding `run`, adding an option like `--config`, and setting `info.data['config']` before invoking the built-in run command.
`find_best_app` only looks for `app` and `application`. If it can't find those but finds the name `create_app`, it should try to call that with no arguments to get the Flask app.

If we modify `ScriptInfo.load_app` to pass itself to `locate_app` and `find_best_app`, we can make this consistent with #2266.
`FLASK_APP=myproject.app:create_app('dev')`
[
Gunicorn does this with `eval`](https://github.com/benoitc/gunicorn/blob/fbd151e9841e2c87a18512d71475bcff863a5171/gunicorn/util.py#L364), which I'm not super happy with. Instead, we could use `literal_eval` to allow a simple list of arguments. The line should never be so complicated that `eval` would be necessary anyway.

~~~python
# might need to fix this regex
m = re.search(r'(\w+)(\(.*\))', app_obj)

if m:
    app = getattr(mod, m.group(1))(*literal_eval(m.group(2)))
~~~
As I am trying to understand how different apps servers and libraries deal with invalid Cookie inside the "Cookie header" (see https://github.com/dorfsmay/Invalid_cookies_in_Cookie_header ), I realised that Flask is munging the invalid cookie with the next one, together:

`curl -b 'SID=31d4d96e407aad42; muffin ; lang=en-US;' localhost:8080` 

==> `{'SID': '31d4d96e407aad42', 'muffin ; lang': 'en-US'}`

I'm sure this was not the desired behaviour, wouldn't it better to just ignore any string between semi-colons that cannot be translated into a valid cookie (so any string without an equal sign)?
Resolves #2243 

1. Added variable in _config.py to check if system is 3.6+
2. Added logic in json.py to check if system is 3.6+ to simply decode json 

EDIT : 3.6 to 3.6+
I'm doing some work which requires defining some context hooks for our flask app. When reading the documentation for [request contexts*](http://flask.pocoo.org/docs/dev/reqcontext/#callbacks-and-errors) I came across the passage:

>>> In production mode if an exception is not caught, the 500 internal server handler is called. In development mode however...

As a user, I want to know: What is 'development mode?' I _think_ it's debug mode (e.g. `app.run(debug=True)`). I've seen several people use the terms interchangeably when searching for help, but not either the flask developers or the official documentation. The flask docs don't appear to have an index (is it hidden somewhere?), and quick search does not appear to work. Google site search of the dev docs does not immediately turn up an obvious answer.

IMO, this is a bug in the documentation. Assuming for the sake of argument I'm right about dev=debug, that passage should be either:

0. "In development mode (i.e. with `debug=True`) however..." or
1. The text 'development mode' is a link to a list of terms & their definitions
2. Something along those lines.

Maybe if I had carefully read all of the docs from beginning to end, or at least carefully read the tutorial twice, I might not be confused about this. But lots of your users won't do that. That's why I call it a bug (it's sorta like failing to validate input).

*I was in fact reading the docs for the version of flask I'm using, but pointing to dev-version docs b/c I presume they represent the current state of the documentation
The following program demonstrates the effect of defining the same route across blueprints and the app - fetch http://localhost:5678/hello for each run:
```
$ python server.py app app
$ python server.py bp
$ python server.py app
$ python server.py app bp
$ python server.py bp app
$ python server.py bp app bp
```

It surprised me that Flask does not report route collisions.
```
import sys
from flask import Flask, Blueprint


def main():
    bp_num = 1
    app = Flask(__name__)
    for arg in sys.argv:
        if arg == 'bp':
            bp_name = 'bp%d' % bp_num
            bp_num += 1
            bp = Blueprint(bp_name, __name__)

            @bp.route('/hello')
            def hello_bp():
                return 'Hello ' + bp_name
            app.register_blueprint(bp)

        if arg == 'app':
            @app.route('/hello')
            def hello():
                return 'Hello'

    app.run(host='0.0.0.0', port=5678)


if __name__ == '__main__':
    main()
```
Based on #1446, with some ideas from #2092. The whole command is basically reworked, but the most important change is that there is a `match` sort order to show the order Flask will dispatch in (which is really just not sorting).
Continues #1684. Reduce verbosity of previous PR. Move examples and description of functions out of registry docs to decorator docs.
(I'm not sure if I should open this here or at uwsgi, feel free to close if this is not appropriate).

Using a QueueHandler with flask works fine when using the built in flask server, but it fails to log to any of the handlers specified in the QueueHandler when run behind uwsgi (Flask==0.12.1, uWSGI==2.0.15, python==3.5.2). 

Here is an example app to demonstrate this:

```python
import logging
from logging.handlers import SMTPHandler, QueueHandler, QueueListener
from queue import Queue
from flask import jsonify, Flask

app = Flask(__name__)
app.debug = False
app.logger.setLevel(logging.INFO)

# Setup logging formatting
log_fmt = logging.Formatter(
    fmt='%(levelname)s: %(asctime)s - %(name)s - %(message)s',
    datefmt='%m/%d/%Y %H:%M:%S'
)

# Setup file log handler
file_handler = logging.FileHandler('/tmp/test_logger.log')
file_handler.setLevel(logging.INFO)
file_handler.setFormatter(log_fmt)

# Setup email log handler
mail_handler = SMTPHandler(
    'localhost',
    'flask_app_error@domain.tld',
    ['email@domain.tld'],
    'Error in flask app'
)
mail_handler.setLevel(logging.ERROR)
mail_handler.setFormatter(log_fmt)

# Setup a queue handler which will handle logs on a separate thread
log_queue = Queue(-1)
queue_handler = QueueHandler(log_queue)
queue_listener = QueueListener(log_queue, mail_handler, file_handler,
                               respect_handler_level=True)
app.logger.addHandler(queue_handler)
queue_listener.start()

log = logging.getLogger(__name__)

@app.route('/error')
def error_test():
    log.error("Test logging")
    return jsonify({'foo': 'bar})

if __name__ == '__main__':
    app.run()
```

And I run it with:
```bash
uwsgi --http :5000 --mount /=test_logger:app --manage-script-name
```

If instead of using a QueueHandler/QueueListener, I pass the log handlers to the app.logger directly, things work as expected.
```python
app.logger.addHandler(file_handler)
app.logger.addHandler(mail_handler)
```
 However, I would like to be able to utilize QueueHandler and QueueListener to do logging on a separate thread if possible.
* be explicit about how tuples are unpacked
* allow `bytes` for status value
* allow `Headers` for headers value
* use `TypeError` instead of `ValueError`
* errors are more descriptive
* document that view must not return `None`
* update documentation about return values
* test more response types
* test error messages

closes #1676

`TypeError` is more correct by definition (wrong type to function), and I don't think anyone should be catching that error anyway (what would it mean to do that?), so I'm ok if this somehow breaks some code. This is also consistent with what `force_type` returns for bad input.

I had to get a bit creative with displaying the error from `force_type` while injecting a new descriptive message. It would be nice if we could just use `raise new_error from original_error`, but that's Python 3 only.

These error messages will hopefully help avoid a class of questions that are frequently asked on Stack Overflow. In particular, there was no error about incorrect types that made it to `force_type`, so users trying to return JSON with something like `return True` would get a mysterious "bool object is not callable" error.
This is a pattern to generate the url to pass to the test client during testing, instead of writing out the url manually.

~~~python
with app.app_context():
    url = url_for('foo', _external=False)
~~~

This currently fails if no `SERVER_NAME` is set, even though it's not needed for relative urls. `url_for` could be modified to support the case where there's only an app context and `_external=False` was passed. Instead of raising an error, create an adapter with a dummy server name, like `localhost`.

Documenting the pattern in the testing docs might be useful too.

Continued from #801.
Reported in #1528. #1538 provided a solution, but can be simplified by only moving `ctx.push()` into the `try` block. Errors raised by `SessionInterface.open_session` and `.make_null_session` will be handled by the normal app error handling mechanism, and the context will be popped at the end of the request.
No distribution found 

Merge master into #1936. The collection logic is changed to collect all inherited methods, not just ones specified by base class `methods` attrs.
~Deprecate in favor of #2249, #1489, #1488, which adds the arg to `add_url_rule`. We couldn't figure out if there was a reason for doing it with an attribute originally.~
I got a circular import error in my flask app, 
and i launch it using flask run.

it seems to launch but when i go the endpoint with my browser, 
i got a pretty misleading error message : 

>NoAppException: The file/path provided (run) does not appear to exist.  Please verify the path is correct.  If app is not on PYTHONPATH, ensure the extension is .py

but when i run it using the run.py file i got:
>ImportError: cannot import name XXXX

it can be great to have a better exception when there is an import error


Merge master into #1489 and do some cleanup.


Environment (CentOS 7 Vagrant in Virtualbox on Windows 10):
```
[vagrant@localhost flaskr]$ cat /etc/redhat-release
CentOS Linux release 7.3.1611 (Core)
[vagrant@localhost flaskr]$ python --version
Python 2.7.5
[vagrant@localhost flaskr]$ pip freeze | grep -i flask
Flask==0.12
flaskr==0.0.0
```

I was following the flask tutorial and could not get `initdb` to show up.  Upon randomly trying the flaskr.py script I received the following:

```
[vagrant@localhost flaskr]$ python flaskr/flaskr.py
Traceback (most recent call last):
  File "flaskr/flaskr.py", line 3, in <module>
    from flask import Flask, request, session, g, redirect, url_for, abord, \
ImportError: cannot import name abord
```

When `flask` is run with the proper export statements here is the output:

```
[vagrant@localhost flaskr]$ flask
Usage: flask [OPTIONS] COMMAND [ARGS]...

  This shell command acts as general utility script for Flask applications.

  It loads the application configured (through the FLASK_APP environment
  variable) and then provides commands either provided by the application or
  Flask itself.

  The most useful commands are the "run" and "shell" command.

  Example usage:

    $ export FLASK_APP=hello.py
    $ export FLASK_DEBUG=1
    $ flask run

Options:
  --version  Show the flask version
  --help     Show this message and exit.

Commands:
  run    Runs a development server.
  shell  Runs a shell in the app context.
```

I found this out by trying to get the shell to run to see if I could just find the init_db() function through the flask shell.

```
[vagrant@localhost flaskr]$ flask shell
Usage: flask shell [OPTIONS]

Error: The file/path provided (flaskr) does not appear to exist.  Please verify the path is correct.  If app is not on PYTHONPATH
, ensure the extension is .py
```

Immediately upon fixing the spelling error, I was able to access `flask initdb`.

I searched through the open and closed errors and could not find this exact thing.  It simply seems unclear, and might be nice to bubble up errors to the flask CLI like the above.
hello flask,

I just need help regarding request.files['spam'].
why request.files not have filepath attribute?

here my stackflow issue http://stackoverflow.com/questions/41882959/get-path-of-file-uploaded-to-flask
that needed a fullpath attribute.

please kindly support it.

[Python 3.6 added support for loading json from str or bytes.](https://docs.python.org/3.6/library/json.html#json.loads) It handles detection of the three encodings supported by JSON. Would be nice to take advantage of this if the user is using 3.6+ instead of our basic "assume it's UTF-8" approach.

Would have to make sure simplejson also allows this (I think it does).

Then again, I'm not sure there have been any reports of Flask decoding JSON incorrectly. Maybe no real clients are encoding with anything besides UTF-8?
Test `test_helpers.TestSendfile.test_send_file_range_request` was failing on my machine but not on Travis. Turned out it was sending the mtime of the file as local time, but comparing to a UTC time. Local time on Travis was UTC, so it didn't get caught there. Use `utcfromtimestamp` instead of `fromtimestamp`.
From line https://github.com/pallets/flask/blame/master/docs/patterns/packages.rst#L123 to https://github.com/pallets/flask/blame/master/docs/patterns/packages.rst#L133 circular imports are discussed, correctly pointing out that in the example, one has been introduced. However, surely that *could* be avoided if instead the views file ised a `Blueprint`, removing the dependency on the `Flask` object `app` 

(For reference here is the same page: http://flask.pocoo.org/docs/0.21/patterns/packages/)
update send_file cache control
set timeout <= 0 will no-cache no-store
At this time, `Flask.run()` accepts only a `host=` parameter containing a single address. While `::` for the Linux kernel also accepts IPv4-mapped IPv6 addresses from the `::ffff:0.0.0.0/96` range, other dual stack implementations, such as Windows (and OpenBSD I think) do not map IPv4 addresses into the IPv6 address space for (IMHO sound) security rationales.

Please support binding to multiple addresses, thus supporting dual stack deployment, such as `host=('0.0.0.0', '::')`.
* The filename header, being a header, can include Latin-1 characters, not just ASCII.
* Don't normalize the unicode name until we know the UTF-8 version needs to be sent. Otherwise you create situations where the name *could* be sent as just the single field, but the normalized form doesn't encode to Latin-1.

ref #2223
patch contains some spelling fixes ( just in comments ) as found by a bot ( http://www.misfix.org, https://github.com/ka7/misspell_fixer ). Any upcoming License changes (e.g. GPL2 to GPL3+) are hereby granted.
*Note: I don't observe this bug if I run application on a dedicated server (VDS) with Nginx and uWSGI or Gunicorn, only on an shared hosting (Apache2).*

My application structure:

```bash
└─ site.com
     └── public_html
             ├─ venv             <-- virtualenv dir with Python 3.4.3
             ├─ templates        <-- templates dir with `page.html`
             ├─ .htaccess        <-- HTACCESS file
             ├─ app.cgi          <-- CGI script
             └─ app.py           <-- Very basic Flask application
```

Files ```.htaccess``` and ```app.cgi``` I take from [official docs](http://flask.pocoo.org/docs/0.12/deploying/cgi/), but duplicate for comfort.

And this is **.htaccess** file:

```bash
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.*)$ /home/XXXX/site.com/public_html/app.cgi/$1 [L]
```

Yep, it's **app.cgi**:

```cgi
#!/home/XXXX/site.com/public_html/venv/bin/python3.4
# -*- coding: utf-8 -*-

from wsgiref.handlers import CGIHandler
from app import app

CGIHandler().run(app)
```

This is my **app.py** file:

```python
# -*- coding: utf-8 -*-

from flask import Flask, render_template, url_for

app = Flask(__name__)

@app.route('/<slug>')
def page(slug):
    return render_template('page.html', slug=slug)

if __name__ == '__main__':
    app.run(host='0.0.0.0')
```

Template is:

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>{{ slug }}</title>
</head>
<body>
    <a href="{{ url_for('page', slug='about') }}">About page</a>
    <a href="{{ url_for('page', slug='contacts') }}">Contacts page</a>
</body>
</html>
```

All working fine, but if I go to ```http://site.com/about``` and click to ```Contacts page``` link — URL on browser adress is ```http://site.com/app.cgi/contacts``` instead ```http://site.com/contacts``` O_o I delete ```/app.cgi/``` from adress stroke and get the same page!

What is this? Bug in ```url_for()``` functon? Fix it please.
I try this to config my flask application, It returns the import error 

`app.config.from_object('config')`

I try `app.config.from_object('app.config')`
then it works

The issue tracker is a tool to address bugs.
Please use the #pocoo IRC channel on freenode or Stack Overflow for questions.

A similar phenomenon has been described on Win10, however this occurs on a Mac (10.12.5 Beta) after upgrading to Python Version 3.6.1. The Flask application runs fine without DEBUG enabled. 
Before filing this as a dupe please consider that I am using Werkzeug (0.12.1) already.

pip3 list:
appdirs (1.4.0)
argh (0.26.2)
click (6.7)
dominate (2.3.1)
Flask (0.12.1)
Flask-Bootstrap (3.3.7.1)
Flask-Bower (1.2.1)
Flask-WTF (0.14.2)
itsdangerous (0.24)
Jinja2 (2.9.6)
MarkupSafe (1.0)
packaging (16.8)
pathtools (0.1.2)
pbr (1.10.0)
pip (9.0.1)
pyparsing (2.1.10)
PyYAML (3.12)
requests (2.13.0)
setuptools (28.8.0)
six (1.10.0)
stevedore (1.20.0)
virtualenv (15.1.0)
virtualenv-clone (0.2.6)
virtualenvwrapper (4.7.2)
visitor (0.1.3)
Werkzeug (0.12.1)
wheel (0.29.0)
WTForms (2.1)

https://github.com/pallets/flask/pull/2193 changed the conditions for when jsonify pretty prints, but this comment wasn't updated.
The example code uses `flash` but doesn't import it. So the code as written doesn't work.

This simply adds `flash` to the list of imports in the sample code.
## Summary

In basic Flask applications, the body data of chunked uploads appears to go missing: that is, they do not appear in `request.data`. I have reproduced this with two different WSGI servers (gunicorn and twisted), both of which handle chunked data appropriately. Non-chunked data does not suffer this problem. I've reproduced this problem on both Python 2.7 and Python 3.6.

## Reproduction

The following Flask application demonstrates the problem:

```python
from flask import Flask, request
app = Flask(__name__)

@app.route('/', methods=['GET', 'POST'])
def hello_world():
    return request.data
```

when run like this: `gunicorn -w 4 example:app`.

The following test script can be run:

```python
import requests

def gen():
    yield b"hello"
    yield b"world"

print("Making first request")
r = requests.post('http://localhost:8000/', data=b'helloworld')
print("Got: %s" % r.content.decode('utf-8'))
print("Making second request")
r = requests.post('http://localhost:8000/', data=gen())
print("Got: %s" % r.content.decode('utf-8'))
```

### Expected Output

```
Making first request
Got: helloworld
Making second request
Got: helloworld
```

### Actual Output

```
Making first request
Got: helloworld
Making second request
Got: 
```

## Environment

```
% python -VV                                      
Python 3.6.0 (default, Jan 18 2017, 18:08:34) 
[GCC 4.2.1 Compatible Apple LLVM 8.0.0 (clang-800.0.42.1)]
```

```
% pip freeze                                      
appdirs==1.4.3
click==6.7
Flask==0.12.1
gunicorn==19.7.1
itsdangerous==0.24
Jinja2==2.9.6
MarkupSafe==1.0
packaging==16.8
pyparsing==2.2.0
six==1.10.0
Werkzeug==0.12.1
```

## References

This was spotted at httpbin. See kennethreitz/httpbin#340 for more.

I was trying to find out what changed from 0.12 to 0.12.1 and had to come here. Please update the changelog on the website.
Stack Overflow gets a *constant* stream of questions about 400 errors that are caused by missing keys. The fact that accessing `args`, `form`, `files`, `values`, `session`, and `headers` returns an HTTP error instead of a traceback is confusing to a lot of users; they get no feedback about what went wrong and it's easy to miss typos or a missing name attribute. This config should default to the value of `DEBUG` and the behavior should be much more clearly documented.
Hi,

when I start my `Flask` app via `python3 -m flask run` and there is an error in my code, `Flask` only returns with the following message:

    Usage: python -m flask run [OPTIONS]
    
    Error: The file/path provided (server2.run) does not appear to exist.  Please verify the path is correct.  If app is not on PYTHONPATH, ensure the extension is .py

Is there a way to get proper error stack messages or am I not seeing the obvious.. :thinking: 

~ For Frodo
It would be nice having error handlers by blueprint, is this achievable ?

This commit implements https://tools.ietf.org/html/rfc2231#section-4 in
order to support sending unicode characters. Tested on both Firefox and
Chromium under Linux.

~~This adds unidecode as a dependency, which might be relaxed by using
.encode('latin-1', 'ignore') but wouldn't be as useful.~~ This pull request no longer adds any new dependency.

Also, added a test for the correct headers to be added.

Previously, using a filename parameter to send_file with unicode characters, it
failed with the next error since HTTP headers don't allow non latin-1 characters.
Error on request:
Traceback (most recent call last):
  File "/usr/lib/python3.6/site-packages/werkzeug/serving.py", line 193, in run_wsgi
    execute(self.server.app)
  File "/usr/lib/python3.6/site-packages/werkzeug/serving.py", line 186, in execute
    write(b'')
  File "/usr/lib/python3.6/site-packages/werkzeug/serving.py", line 152, in write
    self.send_header(key, value)
  File "/usr/lib64/python3.6/http/server.py", line 509, in send_header
    ("%s: %s\r\n" % (keyword, value)).encode('latin-1', 'strict'))
UnicodeEncodeError: 'latin-1' codec can't encode character '\uff0f' in position 58: ordinal not in range(256)

Fixes #1286
This ensures that `auto_pop` is called with a non-`None` value in the case of a BaseException being thrown.
See here:
https://github.com/pallets/flask/blob/master/flask/app.py#L1991

When combined with a database layer, this completely breaks transaction guarantees, as the request context "pop" handler will see no error and assume the transaction was successful, resulting in it being committed while in an inconsistent state.
Inappropriate  behaviour in app.run function with debug set to True and False

```app.run(port='5000', debug=False)``` runs perfectly 

however when debug=True

```app.run(port='5000', debug=True)``` it throws error 
```python3 hello_world.py 
Traceback (most recent call last):
  File "hello_world.py", line 13, in <module>
    app.run(port='5000', debug=True)
  File "/usr/lib64/python3.5/site-packages/flask/app.py", line 841, in run
    run_simple(host, port, self, **options)
  File "/usr/lib/python3.5/site-packages/werkzeug/serving.py", line 717, in run_simple
    s.bind((hostname, port))
TypeError: an integer is required (got type str)```




[This line in flask.\_\_init\_\_.py](https://github.com/pallets/flask/blob/master/flask/__init__.py#L17) breaks everything now that `werkzeug==0.12.0` was released.

`werkzeug.exceptions.abort` is now a function, so `abort.mapping` throws an error.

[This line in setup.py](https://github.com/pallets/flask/blob/master/setup.py#L74) definitely needs to be updated - preferably with a frozen Werkzeug version so this doesn't happen again.
Improves output for #2214 

Before:
```
C:\dev\tmp>py -2 -m flask run
Traceback (most recent call last):
  File "C:\Python27\lib\runpy.py", line 174, in _run_module_as_main
    "__main__", fname, loader, pkg_name)
  File "C:\Python27\lib\runpy.py", line 72, in _run_code
    exec code in run_globals
  File "c:\dev\sourcetree\flask\flask\__main__.py", line 15, in <module>
    main(as_module=True)
  File "c:\dev\sourcetree\flask\flask\cli.py", line 523, in main
    cli.main(args=args, prog_name=name)
  File "c:\dev\sourcetree\flask\flask\cli.py", line 383, in main
    return AppGroup.main(self, *args, **kwargs)
  File "C:\Python27\lib\site-packages\click\core.py", line 697, in main
    rv = self.invoke(ctx)
  File "C:\Python27\lib\site-packages\click\core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "C:\Python27\lib\site-packages\click\core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "C:\Python27\lib\site-packages\click\core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "C:\Python27\lib\site-packages\click\decorators.py", line 64, in new_func
    return ctx.invoke(f, obj, *args[1:], **kwargs)
  File "C:\Python27\lib\site-packages\click\core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "c:\dev\sourcetree\flask\flask\cli.py", line 433, in run_command
    app = DispatchingApp(info.load_app, use_eager_loading=eager_loading)
  File "c:\dev\sourcetree\flask\flask\cli.py", line 153, in __init__
    self._load_unlocked()
  File "c:\dev\sourcetree\flask\flask\cli.py", line 177, in _load_unlocked
    self._app = rv = self.loader()
  File "c:\dev\sourcetree\flask\flask\cli.py", line 238, in load_app
    rv = locate_app(self.app_import_path)
  File "c:\dev\sourcetree\flask\flask\cli.py", line 91, in locate_app
    __import__(module)
  File "C:\dev\tmp\error.py", line 1, in <module>
    import whatisthisidonteven
ImportError: No module named whatisthisidonteven
```

After:
```
C:\dev\tmp>py -2 -m flask run
Usage: python -m flask run [OPTIONS]

Error: There was an error trying to import the app (error):
Traceback (most recent call last):
  File "c:\dev\sourcetree\flask\flask\cli.py", line 91, in locate_app
    __import__(module)
  File "C:\dev\tmp\error.py", line 1, in <module>
    import whatisthisidonteven
ImportError: No module named whatisthisidonteven
```
I get this error in my logs from time to time and the only solution is to restart the server. I have no idea from where it comes but I assume this is a flask internal issue.

```
2017-03-20 18:42:17,346 ERROR    xposed.xposed_main                            Exception on /serverstats [GET]
Traceback (most recent call last):
  File "/usr/local/lib/python3.4/dist-packages/flask/app.py", line 1817, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/lib/python3.4/dist-packages/flask/app.py", line 1479, in full_dispatch_request
    response = self.process_response(response)
  File "/usr/local/lib/python3.4/dist-packages/flask/app.py", line 1693, in process_response
    self.save_session(ctx.session, response)
  File "/usr/local/lib/python3.4/dist-packages/flask/app.py", line 837, in save_session
    return self.session_interface.save_session(self, session, response)
  File "/usr/local/lib/python3.4/dist-packages/flask_session/sessions.py", line 355, in save_session
    total_seconds(app.permanent_session_lifetime))
  File "/usr/local/lib/python3.4/dist-packages/werkzeug/contrib/cache.py", line 762, in set
    self._prune()
  File "/usr/local/lib/python3.4/dist-packages/werkzeug/contrib/cache.py", line 715, in _prune
    expires = pickle.load(f)
EOFError: Ran out of input

```
Sometimes you need key-value pairs in your query params, and at those times it would be nice to have a built-in support. Here's what I've seen some APIs use, which looks reasonable to me:

    http://example.com/api/search?name=Markus&hobby[football]=1&hobby[basketball]=0

Which would construct `request.args` like so:

    {
        'name': 'Markus',
        'hobby': {
            'football': 1,
            'basketball': 0,
        }
    }
(Observed on Python 2.7; untested on 3.x)

## Steps to reproduce:

```
echo "import thisisnotarealpackage" > error_app.py
export FLASK_APP=error_app.py
flask run
```

## Expected result:

* Some indication that `thisisnotarealpackage` is not a real package

## Observed result:

```
Usage: python -m flask run [OPTIONS]

Error: The file/path provided (error) does not appear to exist.
Please verify the path is correct.
If app is not on PYTHONPATH, ensure the extension is .py
```

(Newlines added)

## Why Bother

This has been causing some confusion on my team because `cx_Oracle` can fail to import (from the bowels of SQLAlchemy) if it can't find certain Oracle support files on the host machine.
Please note that for clarity, I changed for folder name of the created virtual environment from `venv` to `virtenv`, seeing the relevant python3-command uses the argument `venv`.
For installing Flask under a virtual environment with python3, the procedure is somewhat different that what is proposed in the Documentation, under Installation, virtuallenv. See [Answer by _geckon_ to question _Using Python 3 in virtualenv_
](http://stackoverflow.com/a/30233408/3493586)

This is a minor change, just 
`python3 -m venv /path/to/new/virtual/environment`
instead of 
`virtualenv venv`

I would be willing to contribute with this if assigned the task.
Change `Flask.__init__` to accept a new `static_host` keyword argument,
defaulting to None. <s>Passing this results in url_map.host_matching to be
set to True implicitly. This is because host_matching must be set by the
time the static route is added, or else it won't match.</s> (Edit: see updates below.)

Fixes #1559.
Subsumes #1560.
See #1714.
I've been bitten by this a few times and I believe silently swallowing errors without any debug output is a bad thing to do. This at least prints the resulting stacktrace.
I think the changes introduced in https://github.com/pallets/flask/commit/fa6eded6f572dd4bc23b030f025156cdd1e63305 that swallow ALL exceptions if loading a custom CLI command fails are not good for the general development flow. I often do `flask --help` to see whether my custom command comes up fine and when it doesn't I don't get exceptions and I don't really know what I've done wrong.

I think this `try-except` should be removed. I really think the CLI _should_ fail loudly instead of ignoring errors. Let's discuss this and if you guys agree I'll make a PR.
Starting from Werkzeug 0.11, the debugger was protected by a PIN.
Example file uploaded to flask:

```
account_id,account_name,style,graphic,color,size,team,player_name,player_num,upc,sku
12,Cleveland,C1394_ToddlerTrueClassicKnit NFL_S401ACY1,C1394_AZC,,OSFA,Arizona Cardinals,,,'12345',1234
12,Cleveland,C1394_ToddlerTrueClassicKnit NFL_S401ACY1,C1394_BBI,,OSFA,Buffalo Bills,,,'6789',5678
12,Cleveland,C1394_ToddlerTrueClassicKnit NFL_S401ACY1,C1394_CBE,,OSFA,Chicago Bears,,,'10111213',91011
```

The FileStorage object from `request.files` has somehow had the CSV header line (line 1) removed.

Using Python 2.7.
When posting data with an mimetype unknown to flask unless `request.get_data()` is accessed in whatever way the connection is dropped.

```
@app.route('/abc', methods=['POST'])
def get_history():
    # print request.get_data()  # uncommenting this line fixes the bug
    return 'OK', 200
```

Below is a curl stacktrace:
```
> curl -X POST -d 'a:1' "http://127.0.0.1:5000/abc"
curl: (56) Recv failure: Connection was reset
```

The most confusing fact is that the flask server reports as if the connection was successful:

`127.0.0.1 - - [14/Mar/2017 20:03:16] "POST /abc HTTP/1.1" 200 -`

Flask (0.12) & Python 2.7.12
I was going through Quickstart examples and I found syntax error in URL Building section.
Examples uses old Python 2 syntax for printing `url_for` results and crashes if run on Python 3.
This PR updates the Sphinx documentation for the `host` param for the `Flask.run` method per the fix provided by https://github.com/pallets/flask/pull/2152. This provides parity with the `port` param.


```
 * Serving Flask-SocketIO app "app"
 * Forcing debug mode on
 * Restarting with stat
 * Debugger is active!
 * Debugger pin code: 256-225-104
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/usr/lib/python3.5/threading.py", line 914, in _bootstrap_inner
    self.run()
  File "/usr/lib/python3.5/threading.py", line 862, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.5/dist-packages/flask_socketio/cli.py", line 56, in run_server
    return run_command()
  File "/usr/local/lib/python3.5/dist-packages/click/core.py", line 722, in __call__
    return self.main(*args, **kwargs)
  File "/usr/local/lib/python3.5/dist-packages/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/usr/local/lib/python3.5/dist-packages/click/core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/usr/local/lib/python3.5/dist-packages/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/usr/local/lib/python3.5/dist-packages/click/decorators.py", line 64, in new_func
    return ctx.invoke(f, obj, *args[1:], **kwargs)
  File "/usr/local/lib/python3.5/dist-packages/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/usr/local/lib/python3.5/dist-packages/flask/cli.py", line 432, in run_command
    use_debugger=debugger, threaded=with_threads)
  File "/usr/local/lib/python3.5/dist-packages/werkzeug/serving.py", line 706, in run_simple
    reloader_type)
  File "/usr/local/lib/python3.5/dist-packages/werkzeug/_reloader.py", line 257, in run_with_reloader
    signal.signal(signal.SIGTERM, lambda *args: sys.exit(0))
  File "/usr/lib/python3.5/signal.py", line 47, in signal
    handler = _signal.signal(_enum_to_int(signalnum), _enum_to_int(handler))
ValueError: signal only works in main thread

```
Adding a change  in the example code that wasn't added to the docs. https://github.com/pallets/flask/commit/c54d67adee6f99113f525b376da4af27c3001321
With the introduction of the `flask` command, setting up PyCharm is not as straightforward. Some screenshots and instructions would be useful. Similar to the section on how to deploy to common platforms.
I would like to do error handling conditionally, like:

```python
def internal_error(exc: peewee.InternalError) -> Optional[Response]:
    if exc.args[0] == 1213:
        # Deadlock found when trying to get lock; try restarting transaction
        return CustomErrorResponse(...)

def any_exception(exc: Exception) -> Response:
        return CustomErrorResponse(...)

app.register_error_handler(peewee.InternalError, internal_error)
app.register_error_handler(Exception, any_exception)
```

Could it be so that if `None` is returned from an errorhandler, Flask keeps on iterating and calls the next suitable errorhandler?

Lines: https://github.com/pallets/flask/blob/master/flask/app.py#L1521-L1525 Looks like the code has changed somewhat since 0.10.1 that I'm running (in 0.10.1 this would have been 3-line change I think).

Of course I could call `return any_exception(exc)` from `internal_error()` but that kinda adds direct dependency between the two methods and I would like to avoid it (consider the error handlers coming from different modules/classes etc. and maybe there's even third error handler sitting between that would be skipped here).
`app.debug` and `app.config['DEBUG']` are not compatible with the `flask` script. The app's config is not available in `get_debug_flag()` when starting the server, is there a way to fix that?
Hello,

I am using flask for a small web service that my mobile applications use.

I was developing the server on a normal Windows Desktop and port forwarding it through my personal home router. 

I am now at the deployment stage, and I am having trouble with connections on Windows Server 2008.

The flask server runs successfully, and all endpoints are reachable on localhost, but I cannot connect from an external source. I know that the port forwarding is correct, as I have added another test application to Windows IIS to confirm that it wasn't the router's port forwarding, and that test application worked.

Hoping someone has an idea.

Thanks!

Connor

The issue tracker is a tool to address bugs.
Please use the #pocoo IRC channel on freenode or Stack Overflow for questions.

I tried to install the app debugger, to make my webapp run instantly when I change the code, with:
app.run(debug=True)

However, I get the Error message below. Does someone know how to fix this?
Many thanks!

```pythontb
* Restarting with stat
* Debugger is active!
* Debugger pin code: xx
Exception in thread Thread-1:
Traceback (most recent call last):
 File "C:\Users\josep\Anaconda3\lib\threading.py", line 914, in _bootstrap_inner
   self.run()
 File "C:\Users\josep\Anaconda3\lib\threading.py", line 862, in run
   self._target(*self._args, **self._kwargs)
 File "C:\Users\josep\Anaconda3\lib\site-packages\werkzeug\serving.py", line 656, in i
   fd=fd)
 File "C:\Users\josep\Anaconda3\lib\site-packages\werkzeug\serving.py", line 550, in m
   passthrough_errors, ssl_context, fd=fd)
 File "C:\Users\josep\Anaconda3\lib\site-packages\werkzeug\serving.py", line 462, in _
   socket.SOCK_STREAM)
 File "C:\Users\josep\Anaconda3\lib\socket.py", line 450, in fromfd
   nfd = dup(fd)
OSError: [WinError 10038] An operation was attempted on something that is not a socket
```
`X-Requested-With` is not reliable nowadays. We shouldn't rely on it any more.

Related issue: https://github.com/pallets/werkzeug/issues/1077
#2181 

```
#!/use/bin/env python
from flask import Flask, request
from flask import json
app = Flask(__name__)
@app.route('/', methods=["GET", "POST"])
def hello_uncached():
        if request.headers['Content-Type']=='application/json':
                json1 = json.dumps(request.json)
                data={"abc":"123"}
                json2 = json.dumps(data)
                return json1+'/'+json2
if __name__ == "__main__":
      app.run(host='0.0.0.0')
```
You can do it like this request.data will be used only when you are using text/plain in the case of json data use json.dumps(request.json).

`curl -H "Content-Type: application/json" -X POST http://127.0.0.1:5000 -d '{"foo":"bar"}'`
minor change for being able to run tests within the tutorial.
When following the tutorial first test was failing because it does not find init_db()
Searching I found [this question](http://stackoverflow.com/questions/41612996/running-unit-tests-on-the-flaskr-tutorial-micro-blogging-app-in-flask) that fixed it, so the rest should be modified 
from
`import flaskr`
to
`from flaskr import flaskr`
I can not push a branch with the change (I suppose I have no permission)

I'd suggest enhancing the `url_for` function to accept callables as well, i.e. the function name unquoted; as this would help e.g. with code refactoring tools and auto completion.

It can easily be implemented with a few lines; if such a functionality would be desirable, I can prepare a PR with tests, etc.

Best regards, Christian
I'm not sure if this is intended behaviour and maybe I should know better, but I spent ages trying to figure out why I was getting a `code 400, message Bad request syntax` error and it turned out to be because I was not consuming the data associated with a request when raising an `Unauthorized` exception.

This seems to be a massive hole because if you are not expecting data with a request and so don't read anything then that data is left in the input stream (assuming `keep-alive`) and so forms the start of the next request.  In fact I have even tried sending a request with another request in the data and Flask processes that data as if it were the next request and sends that in response to the following request.

I have resolved this issue by copying the body of the `finally` clause in the `wrapper` function inside `exhaust_stream` from `formparser.py` in [pallets/werkzeug](http://github.com/pallets/werkzeug) and having this new function decorated with `@app.teardown_request`.  This ensures that the input stream is always drained after every request and so left over data is not mis-interpreted as the start of the next request.

Anyway, if I am expected to handle this situation manually as I have done can something be added to the documentation (or if it's already there can you point it out to me, somehow I couldn't find it).  Otherwise, I think Flask should drain the input stream so that subsequent requests are always correctly aligned.
I worked through the tutorial today, but ended up with code that wouldn't run.
The provided example code in the repo does run.  
This pull matches the code in the docs to the example code

Hello,

I am deploying a flask app using Apache Web Server in an EC2 instance. My problem is that I can only make a few successful requests per minute, then the service would have a Connection Timed Out error after. I would have to wait for a couple of minutes to make successful requests again.

The application is an SMTP service.

Any thoughts/help is greatly appreciated.
I am new to flask and i am trying to add a link in flask.abort(). There is no way to add a link in flask.abort() function. If there is a way i guess it must be documented :)

The help about `flask.request` http://flask.pocoo.org/docs/0.12/api/#incoming-request-data just includes a simple: _"args: A MultiDict with the parsed contents of the query string. (The part in the URL after the question mark)."_, Thus nothing about how args are generated.

I need to pass a complex string (with spaces and other url characters).

I found from some experiments, ithat I can generate on client side the query string with `urllib.parse.quote(query1, safe='')`, and this query parameter will be unquoted correctly by flask (request.args).

Because there are many quoting convention (e.g. space replaced with '+', it would be nice to have some more info on the documentation about quoting method, and possibly to have the quote and unquote also directly as flask utilities (like the json support), ready to be used client side.

Possibly also the path decoding could have similar problem (in that case with the default 'safe' argument).

Super minor, but threw me for a second.
The behaviour of the following app should be pretty simple but it actually raises an unwanted exception.

```python

# flask_cache.py
from flask import Flask, request
app = Flask(__name__)

@app.route('/', methods=["GET", "POST"])
def hello_uncached():
    json1 = request.get_json(cache=False)
    request.data = '{"abc":123}'

    #  exception here because get_json internally returns an empty string
    #   to json.loads() which raises an BadRequest exception
    json2 = request.get_json(cache=False)
    return json1+'/'+json2

if __name__ == "__main__":
    app.run()
```

```bash
$ mkvirtualenv flask_cache
$ pip install flask
$ python flask_cache.py
$ curl -H "Content-type: application/json" -d '{"foo":"bar"}' localhost:5000
```

As far as I could debug, the problem is located at [wrappers.get_data](https://github.com/pallets/flask/blob/0.12/flask/wrappers.py#L21). The get_data function "fails" silently because request does not has the "get_data" property and thus the returned string is empty.
After that, since I passed cache=False, the json.loads("") fails and everything gets airbourne.

I could not understand this behaviour because if the request.data is suposed to be read-only, it should have been made in a way that `request.data = "some data" should not make any side effects, otherwise, we should be able to successfully run the above example code.


Is this the wanted behaviour ? If no, can I proceed with a PR ?
Also fixed a few outdated links
https://packaging.python.org/distributing/#universal-wheels
When writing local-only apps we want to open the web browser after the flask app starts up.

Currently we do:
```
threading.Timer(1.25, lambda: webbrowser.open(url) ).start()
app.run(port=port)
```

However it would be nice not to have a guessed time like `1.25`, also it would be nice for the opening of the browser to be cancelled incase starting the flask app fails.

Possibly would look like:

`app.run(port=port, onstart=lambda: webbrowser.open(url))`
I found an issue in which Flask incorrectly handels the posted form-data when posted from Postman.

The issue can be seen in this test case:

```
from flask import Flask, request

app = Flask(__name__)

@app.route('/', methods=['POST'])
def hello_world():

    f = request.values
    for key in f.keys():
        for value in f.getlist(key):
            print key.__repr__(),":",value.__repr__()

    return 'Hello'
```


If we execute the Flask app, and attempt to post the following command we will *NOT* encounter an issue in request no. 1
```
$ curl -X POST -F 'username=davidwalsh' -F 'password=something' http://localhost:1234/
127.0.0.1 - - [09/Feb/2017 15:27:06] "POST / HTTP/1.1" 200 -
'username' : u'davidwalsh'
'password' : u'something'
```

This results in the following raw request:

```
$ nc -l 1234
POST / HTTP/1.1
Host: localhost:1234
User-Agent: curl/7.51.0
Accept: */*
Content-Length: 259
Expect: 100-continue
Content-Type: multipart/form-data; boundary=------------------------45f852bd90f5d691

--------------------------45f852bd90f5d691
Content-Disposition: form-data; name="username"

davidwalsh
--------------------------45f852bd90f5d691
Content-Disposition: form-data; name="password"

something
--------------------------45f852bd90f5d691--
```


How ever, if we utilise a tool like Chrome/Postman, flask seems to incorrectly handle the request form-data request [seen here](https://i.imgur.com/bmnnwpb.png) from postman:

```
'------WebKitFormBoundaryZBQ6HpTUMMXKs08S\r\nContent-Disposition: form-data; name' : u'"username"\r\n\r\ndavidwalsh\r\n------WebKitFormBoundaryZBQ6HpTUMMXKs08S\r\nContent-Disposition: form-data; name="password"\r\n\r\nsomething\r\n------WebKitFormBoundaryZBQ6HpTUMMXKs08S--\r\n'

```

And the raw request for the 2nd case:
```
nc -l 1234
POST / HTTP/1.1
Host: localhost:1234
Connection: keep-alive
Content-Length: 253
Postman-Token: bc27dc7d-162c-5684-3c73-b4f5cd409a0d
Cache-Control: no-cache
Origin: chrome-extension://fhbjgbiflinjbdggehcddcbncdddomop
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36
Content-Type: application/x-www-form-urlencoded
Accept: */*
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.8,da;q=0.6

------WebKitFormBoundaryeLtABWI0kqqXwQLL
Content-Disposition: form-data; name="username"

davidwalsh
------WebKitFormBoundaryeLtABWI0kqqXwQLL
Content-Disposition: form-data; name="password"

something
------WebKitFormBoundaryeLtABWI0kqqXwQLL--
```

While I realise the Chrome/Postman formatting is slightly different, it should still be very much valid I believe?
Currently it does not seem possible to run unit-tests on endpoints that accept a nested dictionary as input when using flask with webargs / marshmallow,

Here is a minimal example,
```py
from flask import Flask
from webargs import fields
from webargs.flaskparser import use_args

app = Flask(__name__)

hello_args = { 
    'a': fields.Nested({'name' : fields.Str()})
}

@app.route('/', methods=['POST'])
@use_args(hello_args)
def index(args):
    return 'Hello ' + str(args)


def test_app():
    app.config['TESTING'] = True
    test_app = app.test_client(use_cookies=False)
    test_app.post(data={"a": {"name": "Alice"}})


if __name__ == '__main__':
    app.run()
```
which runs as expected,
```bash
% curl -H "Content-Type: application/json" -X POST \
       -d '{"a":{"name": "Alice"}}' http://localhost:5000  

Hello {'a': {'name': 'Alice'}}%
```
however if I try running tests on it, the argument parsing fails in `werkzeug.test.EnvironBuilder` with the following error,
```
nosetests test.py                                                      
E
======================================================================
ERROR: test.test_app
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/lib64/python3.4/site-packages/nose/case.py", line 198, in runTest
    self.test(*self.arg)
  File "/tmp/test.py", line 26, in test_app
    test_app.post(data={"a": {"name": "Alice"}})
  File "/home/rth/.local/lib64/python3.4/site-packages/werkzeug/test.py", line 788, in post
    return self.open(*args, **kw)
  File "/home/rth/.local/lib64/python3.4/site-packages/flask/testing.py", line 103, in open
    builder = make_test_environ_builder(self.application, *args, **kwargs)
  File "/home/rth/.local/lib64/python3.4/site-packages/flask/testing.py", line 34, in make_test_environ_builder
    return EnvironBuilder(path, base_url, *args, **kwargs)
  File "/home/rth/.local/lib64/python3.4/site-packages/werkzeug/test.py", line 338, in __init__
    self._add_file_from_data(key, value)
  File "/home/rth/.local/lib64/python3.4/site-packages/werkzeug/test.py", line 355, in _add_file_from_data
    self.files.add_file(key, **value)
TypeError: add_file() got multiple values for argument 'name'

----------------------------------------------------------------------
Ran 1 test in 0.011s

FAILED (errors=1)
```
this uses Python 3.5, flask 0.12 and webargs 1.5.2. 
Any suggestions on how to address this issue (or possible workarounds) would be much appreciated.
I just started learning `flask` and following the documentation pdf. When I reached the topic `4.4.3 HTTP Methods`, I encountered this `ValueError: View function did not return a response` even though I followed the tutorial. It made me confused and had to search on [stackoverflow](http://stackoverflow.com/a/18211982).

This might not be a good fix for an example but the previous example did confuse a beginner, me, who followed the documentation.

Cheers,
swan
Not a bug report, per se, but still should be noted. On the [Security Considerations page](http://flask.pocoo.org/docs/0.12/security/), after describing the XSS remediation that Jinja2 provides, it describes the one caveat that unquoted html attributes are still vulnerable. It follows with a "correct" example:
`<a href="{{ href }}">the text</a>`

However that example is also vulnerable to XSS. An attacker could still set `href` to `javascript:alert(1)` to inject javascript into the tag (although it would require a user to click the link).

Perhaps the example should use a different quoted attribute as the example, like a default value for an input field or something of the like.
Really a minor thing, only experienced by a newcomer.
When following the README or CONTRIBUTE  docs, the first test run results in lots of failures.
This is because a simple `py.test` also discovers the tests in examples/

(My plan is to contribute more, this is just to get started ;)

Hi 

I'd like to know how to increase the maximum header size for the GET request. 

The tornado server allows to increase it as shown bellow, so that one can use the GET request with a large request header.  

**tornado.httpserver.HTTPServer(application, max_header_size=1024 ** 3)**

Should I use a werkzeug configuration to do this?

Thank you very much in advance. 


sent curl -u 'me@someaddress.net':'=eers3e^X:7' http://localhost:8080/oauth/token

### Expected Behavior
request.authorization.password should be =eers3e^X:7

```python
curl -u 'me@someaddress.net':'=eers3e^X:7' http://localhost:8080/oauth/token

@app.route('/oauth/token')
#@http_auth_required
def token():
    logger.info(request.authorization.password )
```

### Actual Behavior
request.authorization.password should is =eers3eX:7

Notice the request.authorization.password is missing this character "^" between the e and X.

### Environment

* Python version: 3.6.5 (win x64)
* Flask version:  1.1.1
* Werkzeug version: 0.16.0

I override `Response.force_type` to handle my own custom responses (and some extra builtin types like lists). I recently tried to upgrade to Flask==1.1.x but it no longer calls my handler and throws an exception instead.

### Reproduce
```python
import pytest
from flask import Flask, Response, jsonify


class MyCustomType:
    def to_json(self):
        return {'ok': 1}


class MyResponse(Response):
    @classmethod
    def force_type(cls, response, environ=None):
        if isinstance(response, list):
            return jsonify(response)
        if isinstance(response, MyCustomType):
            return jsonify(response.to_json())
        return super(MyResponse, cls).force_type(response, environ=environ)


class MyApp(Flask):
    response_class = MyResponse


my_app = MyApp(__name__)


@my_app.route('/list')
def get_list():
    return ['my_element']


@my_app.route('/my')
def get_my():
    return MyCustomType()


@pytest.fixture
def client():
    with my_app.test_client() as client:
        yield client


def test_force_type_list(client):
    assert client.get('/list').json == ['my_element']


def test_force_type_my(client):
    assert client.get('/my').json == {'ok': 1}

```

### Exception

```pytb
Traceback (most recent call last):
  File "/home/closeio/venv/lib/python3.6/site-packages/flask/app.py", line 2446, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/closeio/venv/lib/python3.6/site-packages/flask/app.py", line 1952, in full_dispatch_request
    return self.finalize_request(rv)
  File "/home/closeio/venv/lib/python3.6/site-packages/flask/app.py", line 1967, in finalize_request
    response = self.make_response(rv)
  File "/home/closeio/venv/lib/python3.6/site-packages/flask/app.py", line 2130, in make_response
    " {rv.__class__.__name__}.".format(rv=rv)
TypeError: The view function did not return a valid response. The return type must be a string, dict, tuple, Response instance, or WSGI callable, but it was a MyCustomType.
```

### Environment

* Python version: 3.6.9
* Flask version: 1.1.4 (it works on 1.0.4)
* Werkzeug version: 0.15.6

### PR that caused the issue

https://github.com/pallets/flask/pull/3235

App.py:

    import csv
    from flask import make_response, url_for
    from flask import Flask, jsonify,render_template
    from flask_cors import CORS, cross_origin
    from werkzeug.utils import secure_filename
    # from flask_restful import Resource, Api;
    from flask import Flask, render_template, request, redirect
    import matplotlib.pyplot as plt
    from test import test
    app = Flask(__name__)
    #cors = CORS(app, resources={r"/api/http://localhost:4200": {"origins": "http://localhost:4200"}})# api = Api(app)
    CORS(app, supports_credentials=True)
    app.register_blueprint(test,url_prefix="/admin")

    @app.route('/uploader', methods = ['POST','GET'])
    #@cross_origin(["http://localhost:4200"])
    @cross_origin(allow_headers=['http://localhost:4200'])
    def upload_file():
        print(request.files)
        # check if the post request has the file part
        if 'file' not in request.files:
            print('no file in request')
            return"no file in request"
        file = request.files['file']
        if file.filename == '':
            print('no selected file')
            return"no selected file"
        if file and allowed_file(file.filename):
            print("hello")
            filename = secure_filename(file.filename)
            #file.save(os.path.join(app.config['UPLOAD_FOLDER'], filename))
            return "Successful"
        print("end")
        return"Bye"
    @app.route('/')
    def index():
        return  ('This is the main page of Python and calling the index function')

    weather =  {
        "data":[ {
            "day":"1/6/2019",
            "temperature":"23",
            "windspeed":"16",
            "event":"Sunny"
        },  {
            "day":"5/6/2019",
            "temperature":"17",
            "windspeed":"18",
            "event":"Rainy"
        },  {
            "day":"6/6/2019",
            "temperature":"19",
            "windspeed":"21",
            "event":"Rainy"
        },  {
            "day":"7/6/2019",
            "temperature":"28",
            "windspeed":"14",
            "event":"Sunny"
        }
        ]
    }

    @app.route("/weatherReport/", methods = ['GET'])

    def WeatherReport():
        global weather
        return jsonify([weather])
    if __name__ == '__main__':
        app.run(debug = True)
component.ts:

      @ViewChild('fileInput') fileInput;
      ngOnInit() {
        this.todaydate = this.myservice.showTodayDate();
      }
      handleFileInput(files: FileList) {
        console.log('Inside handleFileInput');
        this.receivedFile = files.item(0);
        const isFileupload = true;
        console.log(` Received File: ${this.receivedFile}`);

      }

      uploadFile() {
        console.log('Inside  uploadFile');
        const files: FileList = this.fileInput.nativeElement.files;
        console.log('Inside  uploadFile line 02');
        if (files.length === 0) {
          console.log('Inside  uploadFile 03');
          console.log('no file content here');
          console.log('Inside  uploadFile 04');
          return;
        };
        console.log('Inside  uploadFile 05');

        this.restservice.parseTable(files).subscribe((data: any) => {
          console.log('Inside  uploadFile 06');
          console.log('Data that i am sending: ' + data);
        },  
//at here the error block is executing;
(error) => {
          console.log('Inside  uploadFile 07');
          console.log('No Data Found' + error);
        });
    }
    }
service.ts:

      parseTable(files) {
        const formData: FormData = new FormData();
        formData.append('file', files[0], files[0].name);
        return this.http.post(this.backendAddress, formData);
      }
component.html:

              <input #fileInput name="file" type="file"  (change)="handleFileInput($event.target.files)" >
    <button mat-raised-button class="standard-button" (click)="uploadFile()">Upload file</button>
Error

    *POST http://localhost:5000/uploader 500 (INTERNAL SERVER ERROR)*
Request:

    *Please help me out friends*
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->
While pouring through the documentation to learn the approaches to configuration handling, I spend time trying to replicate the subclass approach (thinking it was elegant):

```
class Config(object):
    DEBUG = False
    TESTING = False
    DATABASE_URI = 'sqlite:///:memory:'

class ProductionConfig(Config):
    DATABASE_URI = 'mysql://user@localhost/foo'

class DevelopmentConfig(Config):
    DEBUG = True

class TestingConfig(Config):
    TESTING = True
```
While it was possible to have the server run in DEBUG mode when I set the environment variable `FLASK_ENV` to development, or set the `DEBUG=1`, as well as when I ran a simple python module that set `app.config['DEBUG']=True` and ran the script with the `python app.py` command (where the name of the simple app script was app.py), it would not run in debug when I simply ran the flask server without explicitly setting the environment variable.

After a day of hunting I was finally able get clarity asking a question in Discord. It seems that the documentation refers back to configuration examples that preceded the flask CLI. 

I just wanted to share this experience and suggest removing the DEBUG configuration setting from the config file documentation examples to help newbies like myself avoid a day of hair loss. 

I am very much enjoying learning the framework and all the documentation otherwise. Thanks.

```python
# Paste a minimal example that causes the problem.
```

### Actual Behavior
<!-- Tell us what happens instead. -->

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version: 3.7.5
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

When running `flask run -i ipython`, drop the user into an IPython shell with
the `app` instance imported and the context active just like in the regular
shell.

This makes magic methods as well as native autocomplete available to the user.

Update the docs to reflect this change

Commit checklist:

* add tests that fail without the patch
The function was untested before, I dont really know a good way to test this.
* ensure all tests pass with ``pytest``
the tests fail on master as well (on my machine).
* add documentation to the relevant docstrings or pages
Done
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
How do I do this when the feature might only be in master at some point? I cant predict the next version number :)
* add a changelog entry if this patch changes code
Done

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.

### error info
```
2020/04/24 03:59:25 [error] 11#11: *1 upstream prematurely closed connection while reading response header from upstream, client: 192.168.192.1, server: , request: "GET /index HTTP/1.1", upstream: "http://127.0.0.1:8080/index", host: "127.0.0.1:3000"
```
### version
```
Flask-SQLAlchemy==2.3.2
mysql-connector-python==8.0.19
Flask==1.0.2
requests==2.19.1
configparser==3.7.4
Flask-API==1.1
python==3.7
```
### this is my test script
```
import configparser
import datetime
import time
from decimal import Decimal

import logging
from flask.json import JSONEncoder
from flask_api import FlaskAPI

from flask_sqlalchemy import SQLAlchemy
from sqlalchemy import Column, Integer

cf = configparser.ConfigParser()
cf.read("./app.ini")
app = FlaskAPI(__name__)

class CustomJSONEncoder(JSONEncoder):
    def default(self, obj):
        try:
            if isinstance(obj, Decimal):
                return float(obj)

            if isinstance(obj, datetime.datetime):
                return time.mktime(obj.timetuple())

            iterable = iter(obj)
        except TypeError:
            pass
        else:
            return list(iterable)
        return JSONEncoder.default(self, obj)

app.json_encoder = CustomJSONEncoder
app.config["SQLALCHEMY_COMMIT_ON_TEARDOWN"] = True
app.config["SQLALCHEMY_TRACK_MODIFICATIONS"] = False
app.config["SQLALCHEMY_DATABASE_URI"] = cf.get("sqlalchemy", "pool")
app.config["SQLALCHEMY_POOL_SIZE"] = 100
app.config["SQLALCHEMY_POOL_RECYCLE"] = 280

app.config["DEFAULT_RENDERERS"] = ["flask_api.renderers.JSONRenderer"]
app.config["TESTING"] = cf.get("env", "is_testing")
app.logger.setLevel(logging.INFO)

@app.teardown_appcontext
def shutdown_session(exception=None):
    db.session.remove()

@app.before_request
def before_request():
    print("进来了")

db = SQLAlchemy(app)

class User(db.Model):
    __tablename__ = "user"
    id = Column(Integer, primary_key=True)

@app.route("/index")
def index():
    User.query.all()
    import time
    time.sleep(100)
    return {"index": "ok"}
```

When I run locally, there is no problem, but when I use dockerfile to run, the interface is called twice in succession, and there will be problems(because i set gunicorn timout 10).
```
进来了
[2020-04-24 03:59:11 +0000] [9] [CRITICAL] WORKER TIMEOUT (pid:15)
[2020-04-24 03:59:11 +0000] [15] [ERROR] Traceback (most recent call last):
  File "/usr/local/lib/python3.7/site-packages/flask/app.py", line 2309, in __call__
    return self.wsgi_app(environ, start_response)
  File "/usr/local/lib/python3.7/site-packages/flask/app.py", line 2292, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/lib/python3.7/site-packages/flask/app.py", line 1813, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/lib/python3.7/site-packages/flask/app.py", line 1799, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/app/app/__init__.py", line 64, in index
    time.sleep(100)
  File "/usr/local/lib/python3.7/site-packages/gunicorn/workers/base.py", line 201, in handle_abort
    sys.exit(1)
SystemExit: 1

进来了
2020/04/24 03:59:25 [error] 11#11: *1 upstream prematurely closed connection while reading response header from upstream, client: 192.168.192.1, server: , request: "GET /index HTTP/1.1", upstream: "http://127.0.0.1:8080/index", host: "127.0.0.1:3000"
[2020-04-24 03:59:25 +0000] [19] [INFO] Booting worker with pid: 19
```
I think this request has been handed over to flask, but flask closed this request, and I don’t know why this problem occurs. If anyone knows, it would be greatly appreciated.
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->


```python
Flask-apscheduler gets the loaded redis configuration information from Flask create_app
```

### Actual Behavior
<!-- Tell us what happens instead. -->

```pytb
RuntimeError: Working outside of application context
```

### Minimum example 
<!-- Tell us what happens instead. -->

```
git@github.com:zxiaozhou/example.git
```

### Environment

* Python version: 3.6
* Flask version:1.1.2
* Werkzeug version:pycharm 2020.1


# Part of the network problem has not been submitted. I want to save it first and then modify it.
# So before I could finish, I was locked up, and the management desk got excited

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->


```python
Flask-apscheduler gets the loaded redis configuration information from Flask create_app
```

### Actual Behavior
<!-- Tell us what happens instead. -->

```pytb
RuntimeError: Working outside of application context
```

### Minimum example 
<!-- Tell us what happens instead. -->

```
git@github.com:zxiaozhou/example.git
```

### Environment

* Python version: 3.6
* Flask version:1.1.2
* Werkzeug version:pycharm 2020.1

### Why is it so difficult for flask_apscheduler to get the flask context??
### Can you provide a better case
### Unlike springboot, you can't get the context content at any time after boot
### Now the way to deal with it feels more tired than giving birth!!
###  I just want to read the configuration file information in flask after the program starts in a timed task. This is a problem for a scheduled task, and I've never seen a flask more tired.
```
Working outside of application context.
```
This PR add support for gzip compression on json outputs for large responses compression. Instead of modify the current method for json outputs `flask.json.jsonify`, I created new method called `flask.json.gzonify` with the simple purpose of optimize the size and time of the response for large json responses.

Note: You can find a demo on: https://repl.it/@danilobrinu/flask-jsonify-support-compresion, just click on `Run` button and access to the respective endpoints.  https://honestweepysoftwareagent.danilobrinu.repl.co/without-compression and https://honestweepysoftwareagent.danilobrinu.repl.co/with-compression . Don't forget open the **devtools** and go to the **Network Tab** to select the **Fast 3G** option.

**Without Compression**
![image](https://user-images.githubusercontent.com/1697714/80048133-ea79b780-84d4-11ea-8ce2-e9d78a2e1f1e.png)

**With Compression**
![image](https://user-images.githubusercontent.com/1697714/80048185-0ed59400-84d5-11ea-97f2-b45fc1d4548e.png)

>  **Network - Fast 3G**: We can optimize the size and time: From 160kb and 1.42s to 540B and 176ms
Describe what this patch does to fix the issue.

Missing another Flask module import and app variable instatiation

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Describe what this patch does to fix the issue.
Flask module is not imported in the example and app of Flask object is not instantiated

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

* No longer causes `AttributeError: 'PosixPath' object has no attribute 'rstrip'`.

* This was broken by e6178fe489b7828acc2bb8fd4b56a70b11ab6c6a which was released in 1.1.2.

* Add a regression test that now passes.

See #3557.

(That issue was repurposed for migrating to pathlib internally, which this PR does not resolve. Merely officially supporting Paths for `static_folder` need not require that.)  

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

I am using python2, using the process pool in flask, resulting in a large number of child processes, how to use multi-process correctly?
I have to upload a File(csv) from frontend(Angular) to the backend(Python) using Middleware(Flask),
I am new to these technologies.
The csv file which would be uploaded by the user will be utilized by the python for processing, so i want it to directly pass the file from frontend to python without using any database and it should also not save into my local drive, i do not want to store it anywhere i just want it to pass to python, and file should be remain in its original form(i.e; csv), it should not be in Json format.
Please guys help me with this!!!
Thanks in Advance, it would be a great pleasure to me...
I'm newbie in python and flask and I find super confusing that if routes are broken/non existent, url_for in templates just makes request stuck forever. Is this is intended?

### Expected Behavior
I expect error should be raised, something like url_for cannot find route blablah

### Actual Behavior
Template function hangs whole server

Minimal example:

```python
import flask
app = flask.Flask(__name__)
@app.route('/')
def index():
  return flask.render_template('example.html');
```

```html
<html>
  {{ url_for('example', filename='doesnt.matter') }}
  this page will never render, RIP
</html>
```
I launch with `FLASK_APP=example.py FLASK_ENV=development flask run`

### Environment

* Python version: 3.6.5
* Flask version: 1.1.1
* Werkzeug version: -
can i write code like this
app.send_static_file(filename,data=123)
because
 render_template(filename,data=123) can work well
but the first can not run,can i overwrite it so i can use jinjia code with send_static_file.
Adding an error message to an assertion that I have experienced on two separate occasions, that all custom exceptions must inherit from the builtin Exception class.

This PR will throw the new message to those who decide to create exceptions that aren't subclasses of Exception, e.g. BaseException
There are many pages in the docs that have different overlapping information about error handlers:

* https://flask.palletsprojects.com/en/1.1.x/errorhandling/#error-handlers
* https://flask.palletsprojects.com/en/1.1.x/blueprints/#error-handlers
* https://flask.palletsprojects.com/en/1.1.x/patterns/errorpages/
* https://flask.palletsprojects.com/en/1.1.x/patterns/apierrors/

These need to be consolidated, probably into the `errorhandling.rst` page, with a link to the blueprints page section for blueprint-specific information.

Also, in #3572 @mikeckennedy brought to our attention that the docs about 404 and 500 handlers for blueprints needs clarification with better examples and explanation of why they don't work in all cases.
## Summary

Trying to register a custom 404 (or any?) error handler using blueprints and the declaritive style seems to have no effect:

```python
# Has no effect
@blueprint.errorhandler(404)
def ...

# Yet this works:
@app.errorhandler(404)
def ...
```

Of course, the blueprint wouldn't work if it wasn't registered, but I have registered it and yet, the custom error page isn't shown. Here are two **files** you can use to reproduce the lack of custom error handling:

```python
# FILE: app.py
import flask
import views

app = flask.Flask(__name__)
app.register_blueprint(views.blueprint)
app.run()
```

```python
# FILE: views.py
import flask
blueprint = flask.Blueprint('views', __name__, template_folder='templates')

@blueprint.route('/')
def index():
    return "Hello world, I might have errors!"

@blueprint.errorhandler(404)
def errors_404(e):
    return "I am a 404!", 404
```

### Expected Behavior
We should see the response "I am a 404!" for http://127.0.0.1:5000/abc

### Actual Behavior

We see Flask's standard error page:

```
Not Found

The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.
```

### Working if changed to app.errorhandler()

It seems like I have the setup correct (I hope I'm not wasting your time!) because with a slight move from `blueprint.errorhandler()` to `app.errorhandler()`, the expected behavior is achieved:

#### This one works

```python
# FILE: app.py
import flask
import views

app = flask.Flask(__name__)
app.register_blueprint(views.blueprint)

# I just moved this from views.py and changed blueprint to app
# Of course, the error report is that this shouldn't be necessary.
@app.errorhandler(404)
def errors_404(e):
    return "I am a 404!", 404

app.run()
```

```python
# FILE: views.py
import flask
blueprint = flask.Blueprint('views', __name__, template_folder='templates')

@blueprint.route('/')
def index():
    return "Hello world, I might have errors!"
```

### Environment

* Python version: 3.8
* Flask version: 1.1.2  
* Werkzeug version: 1.0.1
* OS: macOS Catalina

Unfortunately the original question was closed, so I could not answer or ask again. Sorry for opening the same issue again (https://github.com/pallets/flask/issues/3570).

If I take the example from flask (many others are comparable) :
```
@app.route('/<username>')
def show_user(username):
    pass
```
then **route** and **function** don't match in name. So why I cannot write:
```
@app.route('/cap.mjpg')
def video_feed():
```
I'm really sorry if I don't understand the concept of decorators here, but I didn't find anywhere that the names have to match. 
At least 
```
@app.route('/cap.mjpg')
@app.route('/video_feed')
def video_feed():
```
works with calling `http://myip:5000` (using index,html) as well as `http://myip:5000/cap.mjpg` (as direct access to video stream).

So the basic question is, why changes in `<img src="{{ url_for('video_feed') }}">`  don't work, or work only if I change the decorater **and** the function name.
Hi,

I wanted to provide a video_feed as found in many examples. As long as I use:
```
@app.route('/video_feed')
def video_feed():
```    
and in index.html `<img src="{{ url_for('video_feed') }}">` all works well. If I change the code like this:
```
@app.route('/cap.mjpg')
def video_feed():
```    
and  `<img src="{{ url_for('cap.mjpg') }}">` I get the error:
`werkzeug.routing.BuildError: Could not build url for endpoint 'cap.mjpg'. Did you mean 'static' instead?`

On the other hand  I can directly access the video_feed by `http://myip:5000/cap.mjpg`, so basically it works but the html template has problems.
The release notification on github says that this version is the last version to support py2.7 and py3.5, and it also says that some code has been deprecated which will be removed in 2.0. 

The changelog only mentions the couple of bugfixes, but IMHO should also mention the deprecations and the fact that this is the last version to support 2.7 and 3.5! Currently the changelog makes it seem 1.1.2 is just some patch release but in reality those are some pretty big changes that people should be made aware about, i think.
### Expected Behavior
Flask should execute the "flask run" command.

```python
from flask import Flask
app = Flask(__name__)

@app.route("/")
def hello():
    return "Hello World!"
```

### Actual Behavior
An error appears: "Fatal error in launcher:"

### Environment

* Python version: 3.8.2
* Flask version: 1.1.2
When using git version `1.8.3.1`, users cannot use .git-less remote URLs for cloning on gitlab, which will cause failure on pre-commit tool initialization.

Reproduce environment:
CentOS Linux release 7.6.1810 (Core)
git version 1.8.3.1

Logs while running `pre-commit run --all-file` in a newly cloned flask project:
```
[INFO] Initializing environment for https://gitlab.com/pycqa/flake8.
An unexpected error has occurred: CalledProcessError: command: ('/usr/bin/git', 'fetch', 'origin', '--tags')
return code: 128
expected return code: 0
stdout: (none)
stderr:
    error: RPC failed; result=22, HTTP code = 404
    fatal: The remote end hung up unexpectedly

Check the log at /home/magine/.cache/pre-commit/pre-commit.log
```

See also:
https://gitlab.com/gitlab-org/gitlab/issues/29629
Python 3.8.2
```
+ pytest-3 -v -k 'not test_send_from_directory_bad_request'
========================================================================================= test session starts ==========================================================================================
platform linux -- Python 3.8.2, pytest-4.6.9, py-1.8.0, pluggy-0.13.1 -- /usr/bin/python3
cachedir: .pytest_cache
hypothesis profile 'default' -> database=DirectoryBasedExampleDatabase('/home/tkloczko/rpmbuild/BUILD/Flask-1.1.2/.hypothesis/examples')
rootdir: /home/tkloczko/rpmbuild/BUILD/Flask-1.1.2, inifile: setup.cfg, testpaths: tests
plugins: forked-1.1.1, mock-1.10.4, expect-1.1.0, hypothesis-4.23.8, xdist-1.31.0, httpbin-0.3.0, cov-2.8.1, flaky-3.6.1
collected 542 items

tests/test_appctx.py::test_basic_url_generation PASSED                                                                                                                                           [  0%]
tests/test_appctx.py::test_url_generation_requires_server_name PASSED                                                                                                                            [  0%]
tests/test_appctx.py::test_url_generation_without_context_fails PASSED                                                                                                                           [  0%]
tests/test_appctx.py::test_request_context_means_app_context PASSED                                                                                                                              [  0%]
tests/test_appctx.py::test_app_context_provides_current_app PASSED                                                                                                                               [  0%]
tests/test_appctx.py::test_app_tearing_down PASSED                                                                                                                                               [  1%]
tests/test_appctx.py::test_app_tearing_down_with_previous_exception PASSED                                                                                                                       [  1%]
tests/test_appctx.py::test_app_tearing_down_with_handled_exception_by_except_block PASSED                                                                                                        [  1%]
tests/test_appctx.py::test_app_tearing_down_with_handled_exception_by_app_handler PASSED                                                                                                         [  1%]
tests/test_appctx.py::test_app_tearing_down_with_unhandled_exception PASSED                                                                                                                      [  1%]
tests/test_appctx.py::test_app_ctx_globals_methods PASSED                                                                                                                                        [  2%]
tests/test_appctx.py::test_custom_app_ctx_globals_class PASSED                                                                                                                                   [  2%]
tests/test_appctx.py::test_context_refcounts PASSED                                                                                                                                              [  2%]
tests/test_appctx.py::test_clean_pop PASSED                                                                                                                                                      [  2%]
tests/test_basic.py::test_options_work PASSED                                                                                                                                                    [  2%]
tests/test_basic.py::test_options_on_multiple_rules PASSED                                                                                                                                       [  2%]
tests/test_basic.py::test_provide_automatic_options_attr PASSED                                                                                                                                  [  3%]
tests/test_basic.py::test_provide_automatic_options_kwarg PASSED                                                                                                                                 [  3%]
tests/test_basic.py::test_request_dispatching PASSED                                                                                                                                             [  3%]
tests/test_basic.py::test_disallow_string_for_allowed_methods PASSED                                                                                                                             [  3%]
tests/test_basic.py::test_url_mapping PASSED                                                                                                                                                     [  3%]
tests/test_basic.py::test_werkzeug_routing PASSED                                                                                                                                                [  4%]
tests/test_basic.py::test_endpoint_decorator PASSED                                                                                                                                              [  4%]
tests/test_basic.py::test_session PASSED                                                                                                                                                         [  4%]
tests/test_basic.py::test_session_using_server_name PASSED                                                                                                                                       [  4%]
tests/test_basic.py::test_session_using_server_name_and_port PASSED                                                                                                                              [  4%]
tests/test_basic.py::test_session_using_server_name_port_and_path PASSED                                                                                                                         [  4%]
tests/test_basic.py::test_session_using_application_root PASSED                                                                                                                                  [  5%]
tests/test_basic.py::test_session_using_session_settings PASSED                                                                                                                                  [  5%]
tests/test_basic.py::test_session_using_samesite_attribute PASSED                                                                                                                                [  5%]
tests/test_basic.py::test_session_localhost_warning PASSED                                                                                                                                       [  5%]
tests/test_basic.py::test_session_ip_warning PASSED                                                                                                                                              [  5%]
tests/test_basic.py::test_missing_session PASSED                                                                                                                                                 [  6%]
tests/test_basic.py::test_session_expiration PASSED                                                                                                                                              [  6%]
tests/test_basic.py::test_session_stored_last PASSED                                                                                                                                             [  6%]
tests/test_basic.py::test_session_special_types PASSED                                                                                                                                           [  6%]
tests/test_basic.py::test_session_cookie_setting PASSED                                                                                                                                          [  6%]
tests/test_basic.py::test_session_vary_cookie PASSED                                                                                                                                             [  7%]
tests/test_basic.py::test_flashes PASSED                                                                                                                                                         [  7%]
tests/test_basic.py::test_extended_flashing PASSED                                                                                                                                               [  7%]
tests/test_basic.py::test_request_processing PASSED                                                                                                                                              [  7%]
tests/test_basic.py::test_request_preprocessing_early_return PASSED                                                                                                                              [  7%]
tests/test_basic.py::test_after_request_processing PASSED                                                                                                                                        [  7%]
tests/test_basic.py::test_teardown_request_handler PASSED                                                                                                                                        [  8%]
tests/test_basic.py::test_teardown_request_handler_debug_mode PASSED                                                                                                                             [  8%]
tests/test_basic.py::test_teardown_request_handler_error PASSED                                                                                                                                  [  8%]
tests/test_basic.py::test_before_after_request_order PASSED                                                                                                                                      [  8%]
tests/test_basic.py::test_error_handling PASSED                                                                                                                                                  [  8%]
tests/test_basic.py::test_error_handler_unknown_code PASSED                                                                                                                                      [  9%]
tests/test_basic.py::test_error_handling_processing PASSED                                                                                                                                       [  9%]
tests/test_basic.py::test_baseexception_error_handling PASSED                                                                                                                                    [  9%]
tests/test_basic.py::test_before_request_and_routing_errors PASSED                                                                                                                               [  9%]
tests/test_basic.py::test_user_error_handling PASSED                                                                                                                                             [  9%]
tests/test_basic.py::test_http_error_subclass_handling PASSED                                                                                                                                    [  9%]
tests/test_basic.py::test_errorhandler_precedence PASSED                                                                                                                                         [ 10%]
tests/test_basic.py::test_trapping_of_bad_request_key_errors PASSED                                                                                                                              [ 10%]
tests/test_basic.py::test_trapping_of_all_http_exceptions PASSED                                                                                                                                 [ 10%]
tests/test_basic.py::test_error_handler_after_processor_error PASSED                                                                                                                             [ 10%]
tests/test_basic.py::test_enctype_debug_helper PASSED                                                                                                                                            [ 10%]
tests/test_basic.py::test_response_types PASSED                                                                                                                                                  [ 11%]
tests/test_basic.py::test_response_type_errors PASSED                                                                                                                                            [ 11%]
tests/test_basic.py::test_make_response PASSED                                                                                                                                                   [ 11%]
tests/test_basic.py::test_make_response_with_response_instance PASSED                                                                                                                            [ 11%]
tests/test_basic.py::test_jsonify_no_prettyprint PASSED                                                                                                                                          [ 11%]
tests/test_basic.py::test_jsonify_prettyprint PASSED                                                                                                                                             [ 11%]
tests/test_basic.py::test_jsonify_mimetype PASSED                                                                                                                                                [ 12%]
tests/test_basic.py::test_json_dump_dataclass PASSED                                                                                                                                             [ 12%]
tests/test_basic.py::test_jsonify_args_and_kwargs_check PASSED                                                                                                                                   [ 12%]
tests/test_basic.py::test_url_generation PASSED                                                                                                                                                  [ 12%]
tests/test_basic.py::test_build_error_handler PASSED                                                                                                                                             [ 12%]
tests/test_basic.py::test_build_error_handler_reraise PASSED                                                                                                                                     [ 13%]
tests/test_basic.py::test_url_for_passes_special_values_to_build_error_handler PASSED                                                                                                            [ 13%]
tests/test_basic.py::test_static_files PASSED                                                                                                                                                    [ 13%]
tests/test_basic.py::test_static_url_path PASSED                                                                                                                                                 [ 13%]
tests/test_basic.py::test_static_url_path_with_ending_slash PASSED                                                                                                                               [ 13%]
tests/test_basic.py::test_static_url_empty_path PASSED                                                                                                                                           [ 14%]
tests/test_basic.py::test_static_url_empty_path_default PASSED                                                                                                                                   [ 14%]
tests/test_basic.py::test_static_folder_with_ending_slash PASSED                                                                                                                                 [ 14%]
tests/test_basic.py::test_static_route_with_host_matching PASSED                                                                                                                                 [ 14%]
tests/test_basic.py::test_request_locals PASSED                                                                                                                                                  [ 14%]
tests/test_basic.py::test_server_name_subdomain PASSED                                                                                                                                           [ 14%]
tests/test_basic.py::test_exception_propagation PASSED                                                                                                                                           [ 15%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-True-True] PASSED                                                                                                                [ 15%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-True-False] PASSED                                                                                                               [ 15%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-False-True] PASSED                                                                                                               [ 15%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-True-False-False] PASSED                                                                                                              [ 15%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-True-True] PASSED                                                                                                               [ 16%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-True-False] PASSED                                                                                                              [ 16%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-False-True] PASSED                                                                                                              [ 16%]
tests/test_basic.py::test_werkzeug_passthrough_errors[None-False-False-False] PASSED                                                                                                             [ 16%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-True-True] PASSED                                                                                                                [ 16%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-True-False] PASSED                                                                                                               [ 16%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-False-True] PASSED                                                                                                               [ 17%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-True-False-False] PASSED                                                                                                              [ 17%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-True-True] PASSED                                                                                                               [ 17%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-True-False] PASSED                                                                                                              [ 17%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-False-True] PASSED                                                                                                              [ 17%]
tests/test_basic.py::test_werkzeug_passthrough_errors[True-False-False-False] PASSED                                                                                                             [ 18%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-True-True] PASSED                                                                                                               [ 18%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-True-False] PASSED                                                                                                              [ 18%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-False-True] PASSED                                                                                                              [ 18%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-True-False-False] PASSED                                                                                                             [ 18%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-True-True] PASSED                                                                                                              [ 19%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-True-False] PASSED                                                                                                             [ 19%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-False-True] PASSED                                                                                                             [ 19%]
tests/test_basic.py::test_werkzeug_passthrough_errors[False-False-False-False] PASSED                                                                                                            [ 19%]
tests/test_basic.py::test_max_content_length PASSED                                                                                                                                              [ 19%]
tests/test_basic.py::test_url_processors PASSED                                                                                                                                                  [ 19%]
tests/test_basic.py::test_inject_blueprint_url_defaults PASSED                                                                                                                                   [ 20%]
tests/test_basic.py::test_nonascii_pathinfo PASSED                                                                                                                                               [ 20%]
tests/test_basic.py::test_debug_mode_complains_after_first_request PASSED                                                                                                                        [ 20%]
tests/test_basic.py::test_before_first_request_functions PASSED                                                                                                                                  [ 20%]
tests/test_basic.py::test_before_first_request_functions_concurrent PASSED                                                                                                                       [ 20%]
tests/test_basic.py::test_routing_redirect_debugging PASSED                                                                                                                                      [ 21%]
tests/test_basic.py::test_route_decorator_custom_endpoint PASSED                                                                                                                                 [ 21%]
tests/test_basic.py::test_preserve_only_once PASSED                                                                                                                                              [ 21%]
tests/test_basic.py::test_preserve_remembers_exception PASSED                                                                                                                                    [ 21%]
tests/test_basic.py::test_get_method_on_g PASSED                                                                                                                                                 [ 21%]
tests/test_basic.py::test_g_iteration_protocol PASSED                                                                                                                                            [ 21%]
tests/test_basic.py::test_subdomain_basic_support PASSED                                                                                                                                         [ 22%]
tests/test_basic.py::test_subdomain_matching PASSED                                                                                                                                              [ 22%]
tests/test_basic.py::test_subdomain_matching_with_ports PASSED                                                                                                                                   [ 22%]
tests/test_basic.py::test_subdomain_matching_other_name[False] PASSED                                                                                                                            [ 22%]
tests/test_basic.py::test_subdomain_matching_other_name[True] PASSED                                                                                                                             [ 22%]
tests/test_basic.py::test_multi_route_rules PASSED                                                                                                                                               [ 23%]
tests/test_basic.py::test_multi_route_class_views PASSED                                                                                                                                         [ 23%]
tests/test_basic.py::test_run_defaults PASSED                                                                                                                                                    [ 23%]
tests/test_basic.py::test_run_server_port PASSED                                                                                                                                                 [ 23%]
tests/test_basic.py::test_run_from_config[None-None-pocoo.org:8080-pocoo.org-8080] PASSED                                                                                                        [ 23%]
tests/test_basic.py::test_run_from_config[localhost-None-pocoo.org:8080-localhost-8080] PASSED                                                                                                   [ 23%]
tests/test_basic.py::test_run_from_config[None-80-pocoo.org:8080-pocoo.org-80] PASSED                                                                                                            [ 24%]
tests/test_basic.py::test_run_from_config[localhost-80-pocoo.org:8080-localhost-80] PASSED                                                                                                       [ 24%]
tests/test_basic.py::test_run_from_config[localhost-0-localhost:8080-localhost-0] PASSED                                                                                                         [ 24%]
tests/test_basic.py::test_run_from_config[None-None-localhost:8080-localhost-8080] PASSED                                                                                                        [ 24%]
tests/test_basic.py::test_run_from_config[None-None-localhost:0-localhost-0] PASSED                                                                                                              [ 24%]
tests/test_basic.py::test_max_cookie_size PASSED                                                                                                                                                 [ 25%]
tests/test_blueprints.py::test_blueprint_specific_error_handling PASSED                                                                                                                          [ 25%]
tests/test_blueprints.py::test_blueprint_specific_user_error_handling PASSED                                                                                                                     [ 25%]
tests/test_blueprints.py::test_blueprint_app_error_handling PASSED                                                                                                                               [ 25%]
tests/test_blueprints.py::test_blueprint_prefix_slash[-/-/] PASSED                                                                                                                               [ 25%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/--/] PASSED                                                                                                                               [ 26%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/-/-/] PASSED                                                                                                                              [ 26%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo--/foo] PASSED                                                                                                                         [ 26%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/--/foo/] PASSED                                                                                                                       [ 26%]
tests/test_blueprints.py::test_blueprint_prefix_slash[-/bar-/bar] PASSED                                                                                                                         [ 26%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/-/bar-/foo/bar] PASSED                                                                                                                [ 26%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/-bar-/foo/bar] PASSED                                                                                                                 [ 27%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo-/bar-/foo/bar] PASSED                                                                                                                 [ 27%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo/-//bar-/foo/bar] PASSED                                                                                                               [ 27%]
tests/test_blueprints.py::test_blueprint_prefix_slash[/foo//-/bar-/foo/bar] PASSED                                                                                                               [ 27%]
tests/test_blueprints.py::test_blueprint_url_defaults PASSED                                                                                                                                     [ 27%]
tests/test_blueprints.py::test_blueprint_url_processors PASSED                                                                                                                                   [ 28%]
tests/test_blueprints.py::test_templates_and_static PASSED                                                                                                                                       [ 28%]
tests/test_blueprints.py::test_default_static_cache_timeout PASSED                                                                                                                               [ 28%]
tests/test_blueprints.py::test_templates_list PASSED                                                                                                                                             [ 28%]
tests/test_blueprints.py::test_dotted_names PASSED                                                                                                                                               [ 28%]
tests/test_blueprints.py::test_dotted_names_from_app PASSED                                                                                                                                      [ 28%]
tests/test_blueprints.py::test_empty_url_defaults PASSED                                                                                                                                         [ 29%]
tests/test_blueprints.py::test_route_decorator_custom_endpoint PASSED                                                                                                                            [ 29%]
tests/test_blueprints.py::test_route_decorator_custom_endpoint_with_dots PASSED                                                                                                                  [ 29%]
tests/test_blueprints.py::test_endpoint_decorator PASSED                                                                                                                                         [ 29%]
tests/test_blueprints.py::test_template_filter PASSED                                                                                                                                            [ 29%]
tests/test_blueprints.py::test_add_template_filter PASSED                                                                                                                                        [ 30%]
tests/test_blueprints.py::test_template_filter_with_name PASSED                                                                                                                                  [ 30%]
tests/test_blueprints.py::test_add_template_filter_with_name PASSED                                                                                                                              [ 30%]
tests/test_blueprints.py::test_template_filter_with_template PASSED                                                                                                                              [ 30%]
tests/test_blueprints.py::test_template_filter_after_route_with_template PASSED                                                                                                                  [ 30%]
tests/test_blueprints.py::test_add_template_filter_with_template PASSED                                                                                                                          [ 30%]
tests/test_blueprints.py::test_template_filter_with_name_and_template PASSED                                                                                                                     [ 31%]
tests/test_blueprints.py::test_add_template_filter_with_name_and_template PASSED                                                                                                                 [ 31%]
tests/test_blueprints.py::test_template_test PASSED                                                                                                                                              [ 31%]
tests/test_blueprints.py::test_add_template_test PASSED                                                                                                                                          [ 31%]
tests/test_blueprints.py::test_template_test_with_name PASSED                                                                                                                                    [ 31%]
tests/test_blueprints.py::test_add_template_test_with_name PASSED                                                                                                                                [ 32%]
tests/test_blueprints.py::test_template_test_with_template PASSED                                                                                                                                [ 32%]
tests/test_blueprints.py::test_template_test_after_route_with_template PASSED                                                                                                                    [ 32%]
tests/test_blueprints.py::test_add_template_test_with_template PASSED                                                                                                                            [ 32%]
tests/test_blueprints.py::test_template_test_with_name_and_template PASSED                                                                                                                       [ 32%]
tests/test_blueprints.py::test_add_template_test_with_name_and_template PASSED                                                                                                                   [ 33%]
tests/test_blueprints.py::test_context_processing PASSED                                                                                                                                         [ 33%]
tests/test_blueprints.py::test_template_global PASSED                                                                                                                                            [ 33%]
tests/test_blueprints.py::test_request_processing PASSED                                                                                                                                         [ 33%]
tests/test_blueprints.py::test_app_request_processing PASSED                                                                                                                                     [ 33%]
tests/test_blueprints.py::test_app_url_processors PASSED                                                                                                                                         [ 33%]
tests/test_cli.py::test_cli_name PASSED                                                                                                                                                          [ 34%]
tests/test_cli.py::test_find_best_app PASSED                                                                                                                                                     [ 34%]
tests/test_cli.py::test_prepare_import[test-/home/tkloczko/rpmbuild/BUILD/Flask-1.1.2-test] PASSED                                                                                               [ 34%]
tests/test_cli.py::test_prepare_import[test.py-/home/tkloczko/rpmbuild/BUILD/Flask-1.1.2-test] PASSED                                                                                            [ 34%]
tests/test_cli.py::test_prepare_import[a/test-/home/tkloczko/rpmbuild/BUILD/Flask-1.1.2/a-test] PASSED                                                                                           [ 34%]
tests/test_cli.py::test_prepare_import[test/__init__.py-/home/tkloczko/rpmbuild/BUILD/Flask-1.1.2-test] PASSED                                                                                   [ 35%]
tests/test_cli.py::test_prepare_import[test/__init__-/home/tkloczko/rpmbuild/BUILD/Flask-1.1.2-test] PASSED                                                                                      [ 35%]
tests/test_cli.py::test_prepare_import[/home/tkloczko/rpmbuild/BUILD/Flask-1.1.2/tests/test_apps/cliapp/inner1/__init__-/home/tkloczko/rpmbuild/BUILD/Flask-1.1.2/tests/test_apps-cliapp.inner1] PASSED [ 35%]
tests/test_cli.py::test_prepare_import[/home/tkloczko/rpmbuild/BUILD/Flask-1.1.2/tests/test_apps/cliapp/inner1/inner2-/home/tkloczko/rpmbuild/BUILD/Flask-1.1.2/tests/test_apps-cliapp.inner1.inner2] PASSED [ 35%]
tests/test_cli.py::test_prepare_import[test.a.b-/home/tkloczko/rpmbuild/BUILD/Flask-1.1.2-test.a.b] PASSED                                                                                       [ 35%]
tests/test_cli.py::test_prepare_import[/home/tkloczko/rpmbuild/BUILD/Flask-1.1.2/tests/test_apps/cliapp.app-/home/tkloczko/rpmbuild/BUILD/Flask-1.1.2/tests/test_apps-cliapp.app] PASSED         [ 35%]
tests/test_cli.py::test_prepare_import[/home/tkloczko/rpmbuild/BUILD/Flask-1.1.2/tests/test_apps/cliapp/message.txt-/home/tkloczko/rpmbuild/BUILD/Flask-1.1.2/tests/test_apps-cliapp.message.txt] PASSED [ 36%]
tests/test_cli.py::test_locate_app[cliapp.app-None-testapp] PASSED                                                                                                                               [ 36%]
tests/test_cli.py::test_locate_app[cliapp.app-testapp-testapp] PASSED                                                                                                                            [ 36%]
tests/test_cli.py::test_locate_app[cliapp.factory-None-app] PASSED                                                                                                                               [ 36%]
tests/test_cli.py::test_locate_app[cliapp.factory-create_app-app] PASSED                                                                                                                         [ 36%]
tests/test_cli.py::test_locate_app[cliapp.factory-create_app()-app] PASSED                                                                                                                       [ 37%]
tests/test_cli.py::test_locate_app[cliapp.factory-create_app2("foo", "bar")-app2_foo_bar] PASSED                                                                                                 [ 37%]
tests/test_cli.py::test_locate_app[cliapp.factory-create_app2("foo", "bar", )-app2_foo_bar] PASSED                                                                                               [ 37%]
tests/test_cli.py::test_locate_app[cliapp.factory-create_app3("foo")-app3_foo_spam] PASSED                                                                                                       [ 37%]
tests/test_cli.py::test_locate_app[cliapp.factory- create_app () -app] PASSED                                                                                                                    [ 37%]
tests/test_cli.py::test_locate_app_raises[notanapp.py-None] PASSED                                                                                                                               [ 38%]
tests/test_cli.py::test_locate_app_raises[cliapp/app-None] PASSED                                                                                                                                [ 38%]
tests/test_cli.py::test_locate_app_raises[cliapp.app-notanapp] PASSED                                                                                                                            [ 38%]
tests/test_cli.py::test_locate_app_raises[cliapp.factory-create_app2("foo")] PASSED                                                                                                              [ 38%]
tests/test_cli.py::test_locate_app_raises[cliapp.factory-create_app(] PASSED                                                                                                                     [ 38%]
tests/test_cli.py::test_locate_app_raises[cliapp.factory-no_app] PASSED                                                                                                                          [ 38%]
tests/test_cli.py::test_locate_app_raises[cliapp.importerrorapp-None] PASSED                                                                                                                     [ 39%]
tests/test_cli.py::test_locate_app_raises[cliapp.message.txt-None] PASSED                                                                                                                        [ 39%]
tests/test_cli.py::test_locate_app_suppress_raise PASSED                                                                                                                                         [ 39%]
tests/test_cli.py::test_get_version PASSED                                                                                                                                                       [ 39%]
tests/test_cli.py::test_scriptinfo PASSED                                                                                                                                                        [ 39%]
tests/test_cli.py::test_with_appcontext PASSED                                                                                                                                                   [ 40%]
tests/test_cli.py::test_appgroup PASSED                                                                                                                                                          [ 40%]
tests/test_cli.py::test_flaskgroup PASSED                                                                                                                                                        [ 40%]
tests/test_cli.py::test_flaskgroup_debug[True] PASSED                                                                                                                                            [ 40%]
tests/test_cli.py::test_flaskgroup_debug[False] PASSED                                                                                                                                           [ 40%]
tests/test_cli.py::test_print_exceptions PASSED                                                                                                                                                  [ 40%]
tests/test_cli.py::TestRoutes::test_simple PASSED                                                                                                                                                [ 41%]
tests/test_cli.py::TestRoutes::test_sort PASSED                                                                                                                                                  [ 41%]
tests/test_cli.py::TestRoutes::test_all_methods PASSED                                                                                                                                           [ 41%]
tests/test_cli.py::TestRoutes::test_no_routes PASSED                                                                                                                                             [ 41%]
tests/test_cli.py::test_load_dotenv SKIPPED                                                                                                                                                      [ 41%]
tests/test_cli.py::test_dotenv_path SKIPPED                                                                                                                                                      [ 42%]
tests/test_cli.py::test_dotenv_optional PASSED                                                                                                                                                   [ 42%]
tests/test_cli.py::test_disable_dotenv_from_env SKIPPED                                                                                                                                          [ 42%]
tests/test_cli.py::test_run_cert_path PASSED                                                                                                                                                     [ 42%]
tests/test_cli.py::test_run_cert_adhoc PASSED                                                                                                                                                    [ 42%]
tests/test_cli.py::test_run_cert_import PASSED                                                                                                                                                   [ 42%]
tests/test_cli.py::test_run_cert_no_ssl PASSED                                                                                                                                                   [ 43%]
tests/test_cli.py::test_cli_blueprints PASSED                                                                                                                                                    [ 43%]
tests/test_cli.py::test_cli_empty PASSED                                                                                                                                                         [ 43%]
tests/test_config.py::test_config_from_file PASSED                                                                                                                                               [ 43%]
tests/test_config.py::test_config_from_object PASSED                                                                                                                                             [ 43%]
tests/test_config.py::test_config_from_json PASSED                                                                                                                                               [ 44%]
tests/test_config.py::test_config_from_mapping PASSED                                                                                                                                            [ 44%]
tests/test_config.py::test_config_from_class PASSED                                                                                                                                              [ 44%]
tests/test_config.py::test_config_from_envvar PASSED                                                                                                                                             [ 44%]
tests/test_config.py::test_config_from_envvar_missing PASSED                                                                                                                                     [ 44%]
tests/test_config.py::test_config_missing PASSED                                                                                                                                                 [ 45%]
tests/test_config.py::test_config_missing_json PASSED                                                                                                                                            [ 45%]
tests/test_config.py::test_custom_config_class PASSED                                                                                                                                            [ 45%]
tests/test_config.py::test_session_lifetime PASSED                                                                                                                                               [ 45%]
tests/test_config.py::test_send_file_max_age PASSED                                                                                                                                              [ 45%]
tests/test_config.py::test_get_namespace PASSED                                                                                                                                                  [ 45%]
tests/test_config.py::test_from_pyfile_weird_encoding[utf-8] PASSED                                                                                                                              [ 46%]
tests/test_config.py::test_from_pyfile_weird_encoding[iso-8859-15] PASSED                                                                                                                        [ 46%]
tests/test_config.py::test_from_pyfile_weird_encoding[latin-1] PASSED                                                                                                                            [ 46%]
tests/test_converters.py::test_custom_converters PASSED                                                                                                                                          [ 46%]
tests/test_converters.py::test_context_available PASSED                                                                                                                                          [ 46%]
tests/test_deprecations.py::test_json_available PASSED                                                                                                                                           [ 47%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-8-1] PASSED                                                                                                                            [ 47%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-8-t] PASSED                                                                                                                            [ 47%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-8-True] PASSED                                                                                                                         [ 47%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-8-False] PASSED                                                                                                                        [ 47%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-8-None] PASSED                                                                                                                         [ 47%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-8-value5] PASSED                                                                                                                       [ 48%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-8-value6] PASSED                                                                                                                       [ 48%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-8-value7] PASSED                                                                                                                       [ 48%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-8-value8] PASSED                                                                                                                       [ 48%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-8-sig-1] PASSED                                                                                                                        [ 48%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-8-sig-t] PASSED                                                                                                                        [ 49%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-8-sig-True] PASSED                                                                                                                     [ 49%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-8-sig-False] PASSED                                                                                                                    [ 49%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-8-sig-None] PASSED                                                                                                                     [ 49%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-8-sig-value5] PASSED                                                                                                                   [ 49%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-8-sig-value6] PASSED                                                                                                                   [ 50%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-8-sig-value7] PASSED                                                                                                                   [ 50%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-8-sig-value8] PASSED                                                                                                                   [ 50%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-le-1] PASSED                                                                                                                        [ 50%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-le-t] PASSED                                                                                                                        [ 50%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-le-True] PASSED                                                                                                                     [ 50%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-le-False] PASSED                                                                                                                    [ 51%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-le-None] PASSED                                                                                                                     [ 51%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-le-value5] PASSED                                                                                                                   [ 51%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-le-value6] PASSED                                                                                                                   [ 51%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-le-value7] PASSED                                                                                                                   [ 51%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-le-value8] PASSED                                                                                                                   [ 52%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-be-1] PASSED                                                                                                                        [ 52%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-be-t] PASSED                                                                                                                        [ 52%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-be-True] PASSED                                                                                                                     [ 52%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-be-False] PASSED                                                                                                                    [ 52%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-be-None] PASSED                                                                                                                     [ 52%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-be-value5] PASSED                                                                                                                   [ 53%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-be-value6] PASSED                                                                                                                   [ 53%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-be-value7] PASSED                                                                                                                   [ 53%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-be-value8] PASSED                                                                                                                   [ 53%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-1] PASSED                                                                                                                           [ 53%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-t] PASSED                                                                                                                           [ 54%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-True] PASSED                                                                                                                        [ 54%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-False] PASSED                                                                                                                       [ 54%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-None] PASSED                                                                                                                        [ 54%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-value5] PASSED                                                                                                                      [ 54%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-value6] PASSED                                                                                                                      [ 54%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-value7] PASSED                                                                                                                      [ 55%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-16-value8] PASSED                                                                                                                      [ 55%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-le-1] PASSED                                                                                                                        [ 55%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-le-t] PASSED                                                                                                                        [ 55%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-le-True] PASSED                                                                                                                     [ 55%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-le-False] PASSED                                                                                                                    [ 56%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-le-None] PASSED                                                                                                                     [ 56%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-le-value5] PASSED                                                                                                                   [ 56%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-le-value6] PASSED                                                                                                                   [ 56%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-le-value7] PASSED                                                                                                                   [ 56%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-le-value8] PASSED                                                                                                                   [ 57%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-be-1] PASSED                                                                                                                        [ 57%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-be-t] PASSED                                                                                                                        [ 57%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-be-True] PASSED                                                                                                                     [ 57%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-be-False] PASSED                                                                                                                    [ 57%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-be-None] PASSED                                                                                                                     [ 57%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-be-value5] PASSED                                                                                                                   [ 58%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-be-value6] PASSED                                                                                                                   [ 58%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-be-value7] PASSED                                                                                                                   [ 58%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-be-value8] PASSED                                                                                                                   [ 58%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-1] PASSED                                                                                                                           [ 58%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-t] PASSED                                                                                                                           [ 59%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-True] PASSED                                                                                                                        [ 59%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-False] PASSED                                                                                                                       [ 59%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-None] PASSED                                                                                                                        [ 59%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-value5] PASSED                                                                                                                      [ 59%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-value6] PASSED                                                                                                                      [ 59%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-value7] PASSED                                                                                                                      [ 60%]
tests/test_helpers.py::TestJSON::test_detect_encoding[utf-32-value8] PASSED                                                                                                                      [ 60%]
tests/test_helpers.py::TestJSON::test_bad_request_debug_message[True] PASSED                                                                                                                     [ 60%]
tests/test_helpers.py::TestJSON::test_bad_request_debug_message[False] PASSED                                                                                                                    [ 60%]
tests/test_helpers.py::TestJSON::test_json_bad_requests PASSED                                                                                                                                   [ 60%]
tests/test_helpers.py::TestJSON::test_json_custom_mimetypes PASSED                                                                                                                               [ 61%]
tests/test_helpers.py::TestJSON::test_json_as_unicode[True-"\\u2603"] PASSED                                                                                                                     [ 61%]
tests/test_helpers.py::TestJSON::test_json_as_unicode[False-"\u2603"] PASSED                                                                                                                     [ 61%]
tests/test_helpers.py::TestJSON::test_json_dump_to_file PASSED                                                                                                                                   [ 61%]
tests/test_helpers.py::TestJSON::test_jsonify_basic_types[0] PASSED                                                                                                                              [ 61%]
tests/test_helpers.py::TestJSON::test_jsonify_basic_types[-1] PASSED                                                                                                                             [ 61%]
tests/test_helpers.py::TestJSON::test_jsonify_basic_types[1] PASSED                                                                                                                              [ 62%]
tests/test_helpers.py::TestJSON::test_jsonify_basic_types[23] PASSED                                                                                                                             [ 62%]
tests/test_helpers.py::TestJSON::test_jsonify_basic_types[3.14] PASSED                                                                                                                           [ 62%]
tests/test_helpers.py::TestJSON::test_jsonify_basic_types[s] PASSED                                                                                                                              [ 62%]
tests/test_helpers.py::TestJSON::test_jsonify_basic_types[longer string] PASSED                                                                                                                  [ 62%]
tests/test_helpers.py::TestJSON::test_jsonify_basic_types[True] PASSED                                                                                                                           [ 63%]
tests/test_helpers.py::TestJSON::test_jsonify_basic_types[False] PASSED                                                                                                                          [ 63%]
tests/test_helpers.py::TestJSON::test_jsonify_basic_types[None] PASSED                                                                                                                           [ 63%]
tests/test_helpers.py::TestJSON::test_jsonify_dicts PASSED                                                                                                                                       [ 63%]
tests/test_helpers.py::TestJSON::test_jsonify_arrays PASSED                                                                                                                                      [ 63%]
tests/test_helpers.py::TestJSON::test_jsonify_date_types PASSED                                                                                                                                  [ 64%]
tests/test_helpers.py::TestJSON::test_jsonify_aware_datetimes[tz0] PASSED                                                                                                                        [ 64%]
tests/test_helpers.py::TestJSON::test_jsonify_aware_datetimes[tz1] PASSED                                                                                                                        [ 64%]
tests/test_helpers.py::TestJSON::test_jsonify_aware_datetimes[tz2] PASSED                                                                                                                        [ 64%]
tests/test_helpers.py::TestJSON::test_jsonify_uuid_types PASSED                                                                                                                                  [ 64%]
tests/test_helpers.py::TestJSON::test_json_attr PASSED                                                                                                                                           [ 64%]
tests/test_helpers.py::TestJSON::test_template_escaping PASSED                                                                                                                                   [ 65%]
tests/test_helpers.py::TestJSON::test_json_customization PASSED                                                                                                                                  [ 65%]
tests/test_helpers.py::TestJSON::test_blueprint_json_customization PASSED                                                                                                                        [ 65%]
tests/test_helpers.py::TestJSON::test_modified_url_encoding PASSED                                                                                                                               [ 65%]
tests/test_helpers.py::TestJSON::test_json_key_sorting PASSED                                                                                                                                    [ 65%]
tests/test_helpers.py::TestSendfile::test_send_file_regular PASSED                                                                                                                               [ 66%]
tests/test_helpers.py::TestSendfile::test_send_file_xsendfile PASSED                                                                                                                             [ 66%]
tests/test_helpers.py::TestSendfile::test_send_file_last_modified PASSED                                                                                                                         [ 66%]
tests/test_helpers.py::TestSendfile::test_send_file_object_without_mimetype PASSED                                                                                                               [ 66%]
tests/test_helpers.py::TestSendfile::test_send_file_object PASSED                                                                                                                                [ 66%]
tests/test_helpers.py::TestSendfile::test_send_file_pathlike PASSED                                                                                                                              [ 66%]
tests/test_helpers.py::TestSendfile::test_send_file_range_request PASSED                                                                                                                         [ 67%]
tests/test_helpers.py::TestSendfile::test_send_file_range_request_bytesio PASSED                                                                                                                 [ 67%]
tests/test_helpers.py::TestSendfile::test_send_file_range_request_xsendfile_invalid PASSED                                                                                                       [ 67%]
tests/test_helpers.py::TestSendfile::test_attachment PASSED                                                                                                                                      [ 67%]
tests/test_helpers.py::TestSendfile::test_attachment_filename_encoding[index.html-index.html-False] PASSED                                                                                       [ 67%]
tests/test_helpers.py::TestSendfile::test_attachment_filename_encoding[\xd1and\xfa\uff0fping\xfcino.txt-"Nandu/pinguino.txt"-%C3%91and%C3%BA%EF%BC%8Fping%C3%BCino.txt] PASSED                   [ 68%]
tests/test_helpers.py::TestSendfile::test_attachment_filename_encoding[V\xf6gel.txt-Vogel.txt-V%C3%B6gel.txt] PASSED                                                                             [ 68%]
tests/test_helpers.py::TestSendfile::test_attachment_filename_encoding[t\xe9st.txt-test.txt-t%C3%A9st.txt] PASSED                                                                                [ 68%]
tests/test_helpers.py::TestSendfile::test_attachment_filename_encoding[\u0442\u0435:/\u0441\u0442-":/"-%D1%82%D0%B5%3A%2F%D1%81%D1%82] PASSED                                                    [ 68%]
tests/test_helpers.py::TestSendfile::test_static_file PASSED                                                                                                                                     [ 68%]
tests/test_helpers.py::TestSendfile::test_send_from_directory PASSED                                                                                                                             [ 69%]
tests/test_helpers.py::TestSendfile::test_send_from_directory_pathlike PASSED                                                                                                                    [ 69%]
tests/test_helpers.py::TestSendfile::test_send_from_directory_null_character PASSED                                                                                                              [ 69%]
tests/test_helpers.py::TestUrlFor::test_url_for_with_anchor PASSED                                                                                                                               [ 69%]
tests/test_helpers.py::TestUrlFor::test_url_for_with_scheme PASSED                                                                                                                               [ 69%]
tests/test_helpers.py::TestUrlFor::test_url_for_with_scheme_not_external PASSED                                                                                                                  [ 69%]
tests/test_helpers.py::TestUrlFor::test_url_for_with_alternating_schemes PASSED                                                                                                                  [ 70%]
tests/test_helpers.py::TestUrlFor::test_url_with_method PASSED                                                                                                                                   [ 70%]
tests/test_helpers.py::TestNoImports::test_name_with_import_error PASSED                                                                                                                         [ 70%]
tests/test_helpers.py::TestStreaming::test_streaming_with_context PASSED                                                                                                                         [ 70%]
tests/test_helpers.py::TestStreaming::test_streaming_with_context_as_decorator PASSED                                                                                                            [ 70%]
tests/test_helpers.py::TestStreaming::test_streaming_with_context_and_custom_close PASSED                                                                                                        [ 71%]
tests/test_helpers.py::TestStreaming::test_stream_keeps_session PASSED                                                                                                                           [ 71%]
tests/test_helpers.py::TestSafeJoin::test_safe_join PASSED                                                                                                                                       [ 71%]
tests/test_helpers.py::TestSafeJoin::test_safe_join_exceptions PASSED                                                                                                                            [ 71%]
tests/test_helpers.py::TestHelpers::test_get_debug_flag[-False-False] PASSED                                                                                                                     [ 71%]
tests/test_helpers.py::TestHelpers::test_get_debug_flag[0-False-False] PASSED                                                                                                                    [ 71%]
tests/test_helpers.py::TestHelpers::test_get_debug_flag[False-False-False] PASSED                                                                                                                [ 72%]
tests/test_helpers.py::TestHelpers::test_get_debug_flag[No-False-False] PASSED                                                                                                                   [ 72%]
tests/test_helpers.py::TestHelpers::test_get_debug_flag[True-True-True] PASSED                                                                                                                   [ 72%]
tests/test_helpers.py::TestHelpers::test_get_env[-production-False] PASSED                                                                                                                       [ 72%]
tests/test_helpers.py::TestHelpers::test_get_env[production-production-False] PASSED                                                                                                             [ 72%]
tests/test_helpers.py::TestHelpers::test_get_env[development-development-True] PASSED                                                                                                            [ 73%]
tests/test_helpers.py::TestHelpers::test_get_env[other-other-False] PASSED                                                                                                                       [ 73%]
tests/test_helpers.py::TestHelpers::test_make_response PASSED                                                                                                                                    [ 73%]
tests/test_helpers.py::TestHelpers::test_open_resource[r] PASSED                                                                                                                                 [ 73%]
tests/test_helpers.py::TestHelpers::test_open_resource[rb] PASSED                                                                                                                                [ 73%]
tests/test_helpers.py::TestHelpers::test_open_resource[rt] PASSED                                                                                                                                [ 73%]
tests/test_helpers.py::TestHelpers::test_open_resource_exceptions[w] PASSED                                                                                                                      [ 74%]
tests/test_helpers.py::TestHelpers::test_open_resource_exceptions[x] PASSED                                                                                                                      [ 74%]
tests/test_helpers.py::TestHelpers::test_open_resource_exceptions[a] PASSED                                                                                                                      [ 74%]
tests/test_helpers.py::TestHelpers::test_open_resource_exceptions[r+] PASSED                                                                                                                     [ 74%]
tests/test_instance_config.py::test_explicit_instance_paths PASSED                                                                                                                               [ 74%]
tests/test_instance_config.py::test_main_module_paths XPASS                                                                                                                                      [ 75%]
tests/test_instance_config.py::test_uninstalled_module_paths PASSED                                                                                                                              [ 75%]
tests/test_instance_config.py::test_uninstalled_package_paths PASSED                                                                                                                             [ 75%]
tests/test_instance_config.py::test_installed_module_paths[True] PASSED                                                                                                                          [ 75%]
tests/test_instance_config.py::test_installed_module_paths[False] PASSED                                                                                                                         [ 75%]
tests/test_instance_config.py::test_installed_package_paths[True] PASSED                                                                                                                         [ 76%]
tests/test_instance_config.py::test_installed_package_paths[False] PASSED                                                                                                                        [ 76%]
tests/test_instance_config.py::test_prefix_package_paths[True] PASSED                                                                                                                            [ 76%]
tests/test_instance_config.py::test_prefix_package_paths[False] PASSED                                                                                                                           [ 76%]
tests/test_instance_config.py::test_egg_installed_paths PASSED                                                                                                                                   [ 76%]
tests/test_instance_config.py::test_meta_path_loader_without_is_package SKIPPED                                                                                                                  [ 76%]
tests/test_json_tag.py::test_dump_load_unchanged[data0] PASSED                                                                                                                                   [ 77%]
tests/test_json_tag.py::test_dump_load_unchanged[data1] PASSED                                                                                                                                   [ 77%]
tests/test_json_tag.py::test_dump_load_unchanged[data2] PASSED                                                                                                                                   [ 77%]
tests/test_json_tag.py::test_dump_load_unchanged[data3] PASSED                                                                                                                                   [ 77%]
tests/test_json_tag.py::test_dump_load_unchanged[data4] PASSED                                                                                                                                   [ 77%]
tests/test_json_tag.py::test_dump_load_unchanged[data5] PASSED                                                                                                                                   [ 78%]
tests/test_json_tag.py::test_dump_load_unchanged[\xff] PASSED                                                                                                                                    [ 78%]
tests/test_json_tag.py::test_dump_load_unchanged[<html>] PASSED                                                                                                                                  [ 78%]
tests/test_json_tag.py::test_dump_load_unchanged[data8] PASSED                                                                                                                                   [ 78%]
tests/test_json_tag.py::test_dump_load_unchanged[data9] PASSED                                                                                                                                   [ 78%]
tests/test_json_tag.py::test_duplicate_tag PASSED                                                                                                                                                [ 78%]
tests/test_json_tag.py::test_custom_tag PASSED                                                                                                                                                   [ 79%]
tests/test_json_tag.py::test_tag_interface PASSED                                                                                                                                                [ 79%]
tests/test_json_tag.py::test_tag_order PASSED                                                                                                                                                    [ 79%]
tests/test_logging.py::test_logger PASSED                                                                                                                                                        [ 79%]
tests/test_logging.py::test_logger_debug PASSED                                                                                                                                                  [ 79%]
tests/test_logging.py::test_existing_handler PASSED                                                                                                                                              [ 80%]
tests/test_logging.py::test_wsgi_errors_stream PASSED                                                                                                                                            [ 80%]
tests/test_logging.py::test_has_level_handler PASSED                                                                                                                                             [ 80%]
tests/test_logging.py::test_log_view_exception PASSED                                                                                                                                            [ 80%]
tests/test_logging.py::test_warn_old_config PASSED                                                                                                                                               [ 80%]
tests/test_meta.py::test_changelog_utf8_compatible PASSED                                                                                                                                        [ 80%]
tests/test_regression.py::test_memory_consumption PASSED                                                                                                                                         [ 81%]
tests/test_regression.py::test_safe_join_toplevel_pardir PASSED                                                                                                                                  [ 81%]
tests/test_regression.py::test_aborting FAILED                                                                                                                                                   [ 81%]
tests/test_reqctx.py::test_teardown_on_pop PASSED                                                                                                                                                [ 81%]
tests/test_reqctx.py::test_teardown_with_previous_exception PASSED                                                                                                                               [ 81%]
tests/test_reqctx.py::test_teardown_with_handled_exception PASSED                                                                                                                                [ 82%]
tests/test_reqctx.py::test_proper_test_request_context PASSED                                                                                                                                    [ 82%]
tests/test_reqctx.py::test_context_binding PASSED                                                                                                                                                [ 82%]
tests/test_reqctx.py::test_context_test PASSED                                                                                                                                                   [ 82%]
tests/test_reqctx.py::test_manual_context_binding PASSED                                                                                                                                         [ 82%]
tests/test_reqctx.py::TestGreenletContextCopying::test_greenlet_context_copying SKIPPED                                                                                                          [ 83%]
tests/test_reqctx.py::TestGreenletContextCopying::test_greenlet_context_copying_api SKIPPED                                                                                                      [ 83%]
tests/test_reqctx.py::test_session_error_pops_context PASSED                                                                                                                                     [ 83%]
tests/test_reqctx.py::test_bad_environ_raises_bad_request PASSED                                                                                                                                 [ 83%]
tests/test_reqctx.py::test_environ_for_valid_idna_completes PASSED                                                                                                                               [ 83%]
tests/test_reqctx.py::test_normal_environ_completes PASSED                                                                                                                                       [ 83%]
tests/test_signals.py::test_template_rendered PASSED                                                                                                                                             [ 84%]
tests/test_signals.py::test_before_render_template PASSED                                                                                                                                        [ 84%]
tests/test_signals.py::test_request_signals PASSED                                                                                                                                               [ 84%]
tests/test_signals.py::test_request_exception_signal PASSED                                                                                                                                      [ 84%]
tests/test_signals.py::test_appcontext_signals PASSED                                                                                                                                            [ 84%]
tests/test_signals.py::test_flash_signal PASSED                                                                                                                                                  [ 85%]
tests/test_signals.py::test_appcontext_tearing_down_signal PASSED                                                                                                                                [ 85%]
tests/test_subclassing.py::test_suppressed_exception_logging PASSED                                                                                                                              [ 85%]
tests/test_templating.py::test_context_processing PASSED                                                                                                                                         [ 85%]
tests/test_templating.py::test_original_win PASSED                                                                                                                                               [ 85%]
tests/test_templating.py::test_request_less_rendering PASSED                                                                                                                                     [ 85%]
tests/test_templating.py::test_standard_context PASSED                                                                                                                                           [ 86%]
tests/test_templating.py::test_escaping PASSED                                                                                                                                                   [ 86%]
tests/test_templating.py::test_no_escaping PASSED                                                                                                                                                [ 86%]
tests/test_templating.py::test_escaping_without_template_filename PASSED                                                                                                                         [ 86%]
tests/test_templating.py::test_macros PASSED                                                                                                                                                     [ 86%]
tests/test_templating.py::test_template_filter PASSED                                                                                                                                            [ 87%]
tests/test_templating.py::test_add_template_filter PASSED                                                                                                                                        [ 87%]
tests/test_templating.py::test_template_filter_with_name PASSED                                                                                                                                  [ 87%]
tests/test_templating.py::test_add_template_filter_with_name PASSED                                                                                                                              [ 87%]
tests/test_templating.py::test_template_filter_with_template PASSED                                                                                                                              [ 87%]
tests/test_templating.py::test_add_template_filter_with_template PASSED                                                                                                                          [ 88%]
tests/test_templating.py::test_template_filter_with_name_and_template PASSED                                                                                                                     [ 88%]
tests/test_templating.py::test_add_template_filter_with_name_and_template PASSED                                                                                                                 [ 88%]
tests/test_templating.py::test_template_test PASSED                                                                                                                                              [ 88%]
tests/test_templating.py::test_add_template_test PASSED                                                                                                                                          [ 88%]
tests/test_templating.py::test_template_test_with_name PASSED                                                                                                                                    [ 88%]
tests/test_templating.py::test_add_template_test_with_name PASSED                                                                                                                                [ 89%]
tests/test_templating.py::test_template_test_with_template PASSED                                                                                                                                [ 89%]
tests/test_templating.py::test_add_template_test_with_template PASSED                                                                                                                            [ 89%]
tests/test_templating.py::test_template_test_with_name_and_template PASSED                                                                                                                       [ 89%]
tests/test_templating.py::test_add_template_test_with_name_and_template PASSED                                                                                                                   [ 89%]
tests/test_templating.py::test_add_template_global PASSED                                                                                                                                        [ 90%]
tests/test_templating.py::test_custom_template_loader PASSED                                                                                                                                     [ 90%]
tests/test_templating.py::test_iterable_loader PASSED                                                                                                                                            [ 90%]
tests/test_templating.py::test_templates_auto_reload PASSED                                                                                                                                      [ 90%]
tests/test_templating.py::test_templates_auto_reload_debug_run PASSED                                                                                                                            [ 90%]
tests/test_templating.py::test_template_loader_debugging PASSED                                                                                                                                  [ 90%]
tests/test_templating.py::test_custom_jinja_env PASSED                                                                                                                                           [ 91%]
tests/test_testing.py::test_environ_defaults_from_config PASSED                                                                                                                                  [ 91%]
tests/test_testing.py::test_environ_defaults PASSED                                                                                                                                              [ 91%]
tests/test_testing.py::test_environ_base_default PASSED                                                                                                                                          [ 91%]
tests/test_testing.py::test_environ_base_modified PASSED                                                                                                                                         [ 91%]
tests/test_testing.py::test_client_open_environ PASSED                                                                                                                                           [ 92%]
tests/test_testing.py::test_specify_url_scheme PASSED                                                                                                                                            [ 92%]
tests/test_testing.py::test_path_is_url PASSED                                                                                                                                                   [ 92%]
tests/test_testing.py::test_make_test_environ_builder PASSED                                                                                                                                     [ 92%]
tests/test_testing.py::test_environbuilder_json_dumps PASSED                                                                                                                                     [ 92%]
tests/test_testing.py::test_blueprint_with_subdomain PASSED                                                                                                                                      [ 92%]
tests/test_testing.py::test_redirect_keep_session PASSED                                                                                                                                         [ 93%]
tests/test_testing.py::test_session_transactions PASSED                                                                                                                                          [ 93%]
tests/test_testing.py::test_session_transactions_no_null_sessions PASSED                                                                                                                         [ 93%]
tests/test_testing.py::test_session_transactions_keep_context PASSED                                                                                                                             [ 93%]
tests/test_testing.py::test_session_transaction_needs_cookies PASSED                                                                                                                             [ 93%]
tests/test_testing.py::test_test_client_context_binding PASSED                                                                                                                                   [ 94%]
tests/test_testing.py::test_reuse_client PASSED                                                                                                                                                  [ 94%]
tests/test_testing.py::test_test_client_calls_teardown_handlers PASSED                                                                                                                           [ 94%]
tests/test_testing.py::test_full_url_request PASSED                                                                                                                                              [ 94%]
tests/test_testing.py::test_json_request_and_response PASSED                                                                                                                                     [ 94%]
tests/test_testing.py::test_client_json_no_app_context PASSED                                                                                                                                    [ 95%]
tests/test_testing.py::test_subdomain PASSED                                                                                                                                                     [ 95%]
tests/test_testing.py::test_nosubdomain PASSED                                                                                                                                                   [ 95%]
tests/test_testing.py::test_cli_runner_class PASSED                                                                                                                                              [ 95%]
tests/test_testing.py::test_cli_invoke PASSED                                                                                                                                                    [ 95%]
tests/test_testing.py::test_cli_custom_obj PASSED                                                                                                                                                [ 95%]
tests/test_testing.py::test_client_pop_all_preserved PASSED                                                                                                                                      [ 96%]
tests/test_user_error_handler.py::test_error_handler_no_match PASSED                                                                                                                             [ 96%]
tests/test_user_error_handler.py::test_error_handler_subclass PASSED                                                                                                                             [ 96%]
tests/test_user_error_handler.py::test_error_handler_http_subclass PASSED                                                                                                                        [ 96%]
tests/test_user_error_handler.py::test_error_handler_blueprint PASSED                                                                                                                            [ 96%]
tests/test_user_error_handler.py::test_default_error_handler PASSED                                                                                                                              [ 97%]
tests/test_user_error_handler.py::TestGenericHandlers::test_handle_class_or_code[InternalServerError] PASSED                                                                                     [ 97%]
tests/test_user_error_handler.py::TestGenericHandlers::test_handle_class_or_code[500] PASSED                                                                                                     [ 97%]
tests/test_user_error_handler.py::TestGenericHandlers::test_handle_generic_http PASSED                                                                                                           [ 97%]
tests/test_user_error_handler.py::TestGenericHandlers::test_handle_generic PASSED                                                                                                                [ 97%]
tests/test_views.py::test_basic_view PASSED                                                                                                                                                      [ 97%]
tests/test_views.py::test_method_based_view PASSED                                                                                                                                               [ 98%]
tests/test_views.py::test_view_patching PASSED                                                                                                                                                   [ 98%]
tests/test_views.py::test_view_inheritance PASSED                                                                                                                                                [ 98%]
tests/test_views.py::test_view_decorators PASSED                                                                                                                                                 [ 98%]
tests/test_views.py::test_view_provide_automatic_options_attr PASSED                                                                                                                             [ 98%]
tests/test_views.py::test_implicit_head PASSED                                                                                                                                                   [ 99%]
tests/test_views.py::test_explicit_head PASSED                                                                                                                                                   [ 99%]
tests/test_views.py::test_endpoint_override PASSED                                                                                                                                               [ 99%]
tests/test_views.py::test_methods_var_inheritance PASSED                                                                                                                                         [ 99%]
tests/test_views.py::test_multiple_inheritance PASSED                                                                                                                                            [ 99%]
tests/test_views.py::test_remove_method_from_parent PASSED                                                                                                                                       [100%]

=============================================================================================== FAILURES ===============================================================================================
____________________________________________________________________________________________ test_aborting _____________________________________________________________________________________________

app = <Flask 'flask_test'>

    def test_aborting(app):
        class Foo(Exception):
            whatever = 42

        @app.errorhandler(Foo)
        def handle_foo(e):
            return str(e.whatever)

        @app.route("/")
        def index():
            raise flask.abort(flask.redirect(flask.url_for("test")))

        @app.route("/test")
        def test():
            raise Foo()

        with app.test_client() as c:
            rv = c.get("/")
>           assert rv.headers["Location"] == "http://localhost/test"
E           AssertionError: assert '/test' == 'http://localhost/test'
E             - /test
E             + http://localhost/test

tests/test_regression.py:95: AssertionError
====================================================================== 1 failed, 534 passed, 6 skipped, 1 xpassed in 4.48 seconds ======================================================================
```


Hi,

consider this URL http://abc/e/f. This route perfectly works that is fine.

If the client sends this URL http://abc/e///f as you can see there are multiple slashes
The output is a redirect HTML page when merge_slashes(werkzeug RULE) is True

Since I am using flask for REST APIs I don't want HTML page I want flask to go to that redirect link directly.
Also, I don't want to use curl -L option

How can I solve this issue?

* Python version:2.7
* Flask version:1.1x
* Werkzeug version:latest

This had the nice side effect of parsing keyword arguments too. Refactored `call_factory` to use `inspect.signature`, even though it will go away in 2.1 because it was easier to figure out the args and kwargs checks.

closes #3553
closes #3552 
* Remove simplejson. Remove UTF encoding guessing, which the built-in module handles now. Simplify `htmlsafe_dumps` to use `str.translate` instead of multiple `str.replace`.
* Issue deprecation warning if `encoding` is passed to `dumps`, `dump`, `loads`, or `load`. This was deprecated in the built-in module back in 3.1. The only valid encodings for JSON are UTF-8 (with/without BOM), UTF-16 (BE/LE), and UTF-32 (BE/LE). `json.loads` accepts bytes and `json.loads` accepts binary files in these encodings without any special handling on our part. `dumps` can be encoded after calling, and `dump` can be passed a binary file wrapped with `io.TextIOWrapper`.
* Rewrite docs for consistency.
* Fix imports and references of `Markup` to be from MarkupSafe instead of Flask or Jinja.

See the individual commits for easier diffs.

closes #3555 
### Description

With this minimal application:
```python
# app.py
from flask import Flask

app = Flask(__name__)

@app.route('/')
def hello():
    return 'Hello, Flask!'
```

and this file structure:
```
- project
    - .env
    - hello
        - app.py
```

When executing `flask run` inside the `hello` folder, you will get a `NoAppException` error, although the `app.py` is present in the current work directory. By [the current implementation](https://github.com/pallets/flask/blob/master/src/flask/cli.py#L630), since `.env` is in the top-level directory, Flask will change the current work directory to the directory that contains the `.env` file, so it can't find the `app.py`.

Steps to reproduce:
```bash
$ git clone https://github.com/greyli/flask-env-test
$ cd flask-env-test
$ pip install -r requirements.txt  # or just pip install flask[dotenv]
$ cd hello
$ flask run
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
Usage: flask run [OPTIONS]

Error: Could not locate a Flask application. You did not provide the "FLASK_APP" environment variable, and a "wsgi.py" or "app.py" module was not found in the current directory.
```

I think it will be a bit confused when the user accidentally put a `.env` or `.flaskenv` in the top-level directory. Can we drop this change directory behavior (#3560)?

### Environment

* Python version: 3.6.8
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

By [the current implementation](https://github.com/pallets/flask/blob/master/src/flask/cli.py#L630), if `.env` or `.flaskenv` was found in the top-level directory, Flask will change the current work directory to the directory that contains the `.env` or `.flaskenv` file. 

When the user accidentally put a `.env` or `.flaskenv` in the top-level directory, then executing `flask run` in the current directory (contains `app.py`) will throw out NoAppException.

See more in #3561.
When python logging is configured prior to creating the flask app, then the behavior of app log handler changes based on where I place the pycharm debugger. Not sure if this is a bug, but I thought best to raise so can be reviewed please.

Code:

```python
import logging
from flask import Flask
logging.basicConfig(level=10, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')

app = Flask(__name__)

for log_handler in logging.getLogger().handlers:
    log_handler.setLevel('WARNING')

var_test = 1
```

### Behavior
I place the debugger debug point on the last line, and hit the debug button. When the debugger hits the debug point, the value of app.logger.handlers shows 1 stream handler for the app logger and the value of logging.getLogger().handlers shows 1 stream handler for the python root logger.

Where as if I place the debugger debug point at the for loop, and also on the last line of the code, and hit debug button. Step over to the last debug point, notice that the value of app.logger.handlers shows nothing and the value of logging.getLogger().handlers shows 1 stream handler for the python root logger.

Why is there such a difference in behavior?

### Environment

* Python version: 3.6.5
* Flask version: 1.0.2

I have just build WebServer by Flask Framework. In this project, I create new thread run TCP Server. this TCP server will listen on an port 9999 for a connection to receive data (a temperature value) from an IED. this one is my code by Python
```
app = Flask(__name__)

BUFFER_SIZE = 1024
temp = 20
mutex = Lock()

def dbus_timer():
    print("Now Data Temp " + str(temp))

class WorkerSignals(QObject):
    finished = pyqtSignal(int)
    error = pyqtSignal(tuple)
    result = pyqtSignal(object)
    progress = pyqtSignal(int)

class Worker(QRunnable):
    def __init__(self, fn, *args, **kwargs):
        super(Worker, self).__init__()
        self.fn = fn
        self.args = args
        self.kwargs = kwargs
        self.signals = WorkerSignals()
        self.kwargs['progress_callback'] = self.signals.progress

    @pyqtSlot()
    def run(self):
        try:
            result = self.fn(*self.args, **self.kwargs)
        except:
            traceback.print_exc()
            exctype, value = sys.exc_info()[:2]
            self.signals.error.emit((exctype, value, traceback.format_exc()))
        else:
            self.signals.result.emit(result)  
        finally:
            self.signals.finished.emit(self.args[0])  

class StreamWorker(QtCore.QObject):
    def __init__(self, *args, **kwargs):
        super(StreamWorker, self).__init__()
        self.threadPool = QThreadPool()
        self.threadPool.setMaxThreadCount(1)
        self.TcpServerStart()

    def UpdateTemperatureSensor(self, bTxt):
        global temp
        _temp = int.from_bytes(bTxt, byteorder='big')
        if(_temp != temp):
            with mutex:
                temp = _temp
                print("\n Temperature: " + str(temp))

    def UpdatePotentinmeterSensor(self, txt):
        data = json.loads(txt)
        print(data["previous"])
        print(data["now"])

    def TcpServerListens(self, progress_callback):
        print("Start TcpServer")
        HOST, PORT = "192.168.0.88", 9999
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
        s.bind((HOST, PORT))
        s.listen(1)
        sock, addr = s.accept()
        length = 0
        bReceive = b''

        while True:
            try:
                receiv = sock.recv(BUFFER_SIZE)
                if(receiv == b''):
                    break
                bReceive = bReceive + receiv
                if(len(bReceive) > 6):
                    bReceive = b''

                elif(len(bReceive) == 6):
                    bTxtHead = bReceive[0:2].decode("utf-8")
                    bTxtFooter = bReceive[4:6].decode("utf-8")
                    if (bTxtHead == 'AA' and bTxtFooter == 'FF'):
                        bTxt = bReceive[2:4]
                        self.UpdateTemperatureSensor(bTxt)
                        bReceive = b''
            except (errorCode, message):
                print(message + "aaaaa ")

    def TcpServerStart(self):
        worker = Worker(self.TcpServerListens)
        worker.signals.progress.connect(self.workProgress)
        self.threadPool.start(worker)

    def workProgress(self, n):
        print("done!!!!")

@app.route('/')
def index():
    with mutex:
        return 'Temperature is now ' + str(temp)

if __name__ == '__main__':
    tcpServer = StreamWorker()
    timer = multitimer.MultiTimer(interval=3, function=dbus_timer)
    timer.start()

    app.run(debug=True, host='0.0.0.0')
```

So when I access http://192.168.0.88:5000/ from browser, the temperature value not change (still equal to initial value is 20). I don't know why??? So I try test temperature value by the way I create a timer and read it with interval= 3s (look up) and that's result. So after every 3s, it will print: "Now Data Temp 280, Now Data Temp 20" at the same time

Any help would be appreciated!
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
For the server to start correctly, this code used to work before 1.1.2. 
```python
from pathlib import Path

ui_dist_dir = Path(__file__).parent / "ui" / "public"
app = Flask(__name__, static_folder=ui_dist_dir, static_url_path="/static", template_folder=ui_dist_dir)
```

I'm not sure if it was intended to be used with `pathlib` before but since python2 support is being dropped I think it would make a lot of sense to support. I would even say that instead of manually replacing slashes in strings, it would be a good idea to use pathlib internally and not duplicate that logic in Flask.  

### Actual Behavior
<!-- Tell us what happens instead. -->
```python
Traceback (most recent call last):
  File "/opt/spike/server/envs/default/lib/python3.7/runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "/opt/spike/server/envs/default/lib/python3.7/runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "/opt/spike/server/spike/start.py", line 140, in <module>
    start()
  File "/opt/spike/server/spike/start.py", line 64, in start
    app = Flask(__name__, static_folder=ui_dist_dir, static_url_path="/static", template_folder=ui_dist_dir)
  File "/opt/spike/server/envs/default/lib/python3.7/site-packages/flask/app.py", line 420, in __init__
    self.static_folder = static_folder
  File "/opt/spike/server/envs/default/lib/python3.7/site-packages/flask/helpers.py", line 1004, in static_folder
    value = value.rstrip("/\\")
AttributeError: 'PosixPath' object has no attribute 'rstrip'
```

### Environment

* Python version: 3.7.4
* Flask version: 1.1.2
* Werkzeug version: 0.16.1

I observed that reloader does not work correctly with threads on my system (latest Ubuntu).

```
wieczyk@tortilla:~/Repozytoria/Finanse/utargsystem$ FLASK_ENV=development FLASK_APP=web/main.py flask run
 * Serving Flask app "web/main.py" (lazy loading)
 * Environment: development
 * Debug mode: on
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 135-710-631
127.0.0.1 - - [04/Apr/2020 23:14:59] "GET / HTTP/1.1" 200 -
127.0.0.1 - - [04/Apr/2020 23:15:02] "GET /markets/6 HTTP/1.1" 200 -
127.0.0.1 - - [04/Apr/2020 23:15:06] "GET /markets/7 HTTP/1.1" 200 -
127.0.0.1 - - [04/Apr/2020 23:15:07] "GET /symbols/1350 HTTP/1.1" 200 -
127.0.0.1 - - [04/Apr/2020 23:17:24] "GET /symbols/1350 HTTP/1.1" 200 -
 * Detected change in '/home/wieczyk/Repozytoria/Finanse/utargsystem/web/main.py', reloading
```

After `Detected change` I see that reloading has no effect. Further changes in a file are not detected.

I observed that adding `--eager-loading` to the command line solves problem -- it est reloading has effect and further changes are detected correctly. Hence my conclusion that `lazy-loading` is a problem.

In modern Python it's unlikely to be significantly better than the built-in `json`. The module used by `JSONMixin` is overridable, so users can plug it in again if they want.

See pallets/itsdangerous#146 and pallets/werkzeug#1766.
- Remove `_compat` module and other compat code.
- Run [pyupgrade](https://github.com/asottile/pyupgrade).
- Use f-strings everywhere.
- Remove deprecated code from 1.1.x.
- Remove old docs.

I wrote this for Gunicorn a while ago: https://github.com/benoitc/gunicorn/pull/2178. It would be good to use it for Flask too, it's the same use case. Right now we use some regex and string manipulation to validate and prepare for `ast.literal_eval`, but `ast.parse` is the correct way to do it.
Having a `script_info` argument for the factory function ties it to the use of the `flask` command, which wouldn't be used in production. Removing support for that argument would mean a factory couldn't make assumptions about how it's run, which seems more correct. It would also remove a good chunk of complexity around deciding how to call the factory.

If a project really wanted `script_info` if it was available, they could use `click.get_current_context()`.

```python
ctx = click.get_current_context(silent=True)

if ctx is not None:
    # run with flask command, do extra stuff
    script_info = ctx.obj  # or ctx.find_object(ScriptInfo)
```
When I used flask and found ‘//‘’ in the url, 404 appeared


```python
from flask import Flask, request, render_template,url_for
app = Flask(__name__)
@app.route('//login', methods=["GET"])
def login():
    return 'ok'
print(app.url_map)
app.run()
```

result:
![image](https://user-images.githubusercontent.com/18000060/78228209-f8a16d00-7500-11ea-8b27-a2890910a52b.png)
-------------------
![image](https://user-images.githubusercontent.com/18000060/78228601-80877700-7501-11ea-8be9-1d47133ef847.png)
---------------------------
![image](https://user-images.githubusercontent.com/18000060/78228630-867d5800-7501-11ea-9947-0037331f55ae.png)


### Environment

* Python version:3.6
* Flask version:1.1.1
* Werkzeug version:

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->
When running flask via `flask run --reload`, importing TensorFlow should not cause an error. Leaving out the --reload flag does work.

```python
# Paste a minimal example that causes the problem.
import tensorflow
from flask import Flask
app = Flask(__name__)
```

### Actual Behavior
This error occurs:

```pytb
Traceback (most recent call last):
  File "venv/bin/flask", line 10, in <module>
    sys.exit(main())
  File "venv/lib/python3.7/site-packages/flask/cli.py", line 966, in main
    cli.main(prog_name="python -m flask" if as_module else None)
  File "venv/lib/python3.7/site-packages/flask/cli.py", line 586, in main
    return super(FlaskGroup, self).main(*args, **kwargs)
  File "venv/lib/python3.7/site-packages/click/core.py", line 782, in main
    rv = self.invoke(ctx)
  File "venv/lib/python3.7/site-packages/click/core.py", line 1259, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "venv/lib/python3.7/site-packages/click/core.py", line 1066, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "venv/lib/python3.7/site-packages/click/core.py", line 610, in invoke
    return callback(*args, **kwargs)
  File "venv/lib/python3.7/site-packages/click/decorators.py", line 73, in new_func
    return ctx.invoke(f, obj, *args, **kwargs)
  File "venv/lib/python3.7/site-packages/click/core.py", line 610, in invoke
    return callback(*args, **kwargs)
  File "venv/lib/python3.7/site-packages/flask/cli.py", line 860, in run_command
    extra_files=extra_files,
  File "venv/lib/python3.7/site-packages/werkzeug/serving.py", line 1050, in run_simple
    run_with_reloader(inner, extra_files, reloader_interval, reloader_type)
  File "venv/lib/python3.7/site-packages/werkzeug/_reloader.py", line 337, in run_with_reloader
    reloader.run()
  File "venv/lib/python3.7/site-packages/werkzeug/_reloader.py", line 202, in run
    for filename in chain(_iter_module_files(), self.extra_files):
  File "venv/lib/python3.7/site-packages/werkzeug/_reloader.py", line 24, in _iter_module_files
    filename = getattr(module, "__file__", None)
  File "venv/lib/python3.7/site-packages/tensorflow/__init__.py", line 50, in __getattr__
    module = self._load()
  File "venv/lib/python3.7/site-packages/tensorflow/__init__.py", line 44, in _load
    module = _importlib.import_module(self.__name__)
  File "/Users/mulka/.pyenv/versions/3.7.6/lib/python3.7/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1006, in _gcd_import
  File "<frozen importlib._bootstrap>", line 983, in _find_and_load
  File "<frozen importlib._bootstrap>", line 965, in _find_and_load_unlocked
ModuleNotFoundError: No module named 'tensorflow_core.keras'

```

### Environment

* Python version: 3.7.6
* Flask version: 1.1.1
* Werkzeug version: 1.0.0
* TensorFlow version: 2.1.0

The missing `/` in the `@app.route('/hello')` statement makes the example raise a 404 when accessing the page. To fix it I just added it to the `route`.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
I'm transferring a list of lists from Python to a Javascript page  and the Java script should itterate throuhg the arry. Instead the code crashes.

```python
@app.route("/Paramaters")
def Hist():
    db = pymysql.connect('localhost','username','password','database')
    csr1 = db.cursor()
    sql = """select * from day_hist ORDER BY 'T_Stamp';"""
    #print("trysql")
    try:
        rsql = csr1.execute(sql)
        sql_dat = csr1.fetchall()
        #print(sql_dat)
    except:
        return(-1)
    finally:
        db.close()
        n=0
        sql_out = [[0],[0],[0],[0],[0]]*95
        for jim in sql_dat:
            sql_out[n] = list(jim)
            n +=1
    return render_template('para1.html',**locals())
```

### Java script from template file (para1.html):

```javascript
ctx.fillText(xi, 10, 280);
var yi = 150 - {{sql_out[0][2]}}*1.5;
var yj = 300-({{sql_out[0][1]}}-20)*25; // This works and returns values.

sql_dat.forEach(draw_line_blue);  // This does NOT work

var i;
for (i =0; i<96, i++){
var x = {{sql_dat[i][0]}};
var y = {{sql_dat[i][2]}};
]  // Also does not work.


function draw_line_blue(value){
ctx.moveTo(xi,yj);
// convert time to x
var x2 = value[0]/2.5;
//scale Vbat to value 20 - 32
var y2 = 300 - (value[1]-20)*25

ctx.strokeStyle = "blue";
ctx.lineTo(x2, y2);
ctx.stroke();

xi = x2;
yj = y2;


}
```

### Actual Behavior
Java script crashes and does nothing.
If I make sql_dat a locally declared variable within the Javascript then the code works. 
if `sql_dat` is generated in the python program and transferred to the javascript using flask, 
the data is transferred, it CAN be printed on screen and verified using `<p> {{sql_dat}}</p>`. 
If you try to iterate through the data (to plot it on a graph) then the code locks up. 
The data in sql_dat is a 96 x 4 array, this is obtained from a mysql database, 
and converted from a tuple into a list (of lists). Data values can be obtained from `{{sql_dat}}` 
by EXPLICITLY calling by subscript e.g. `{{sql_dat[0][2]}};` 
to do this for all 384 values would be tedious, and should not be necessary. 
A similar problem was reported on stack overflow 4 years ago, and remains unanswered.

### Environment

* Python version:Python 3.7.3 (default, Dec 20 2019, 18:57:59) [GCC 8.3.0] on linux (raspberry pie)
* Flask version: latest
* Werkzeug version: latest * installed about a week ago.

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->
I am getting very slow access to `request.files['file']`.
Below is a part of the code.
```python
@app.route('/perspective_transform/', methods = ['POST'])
def perspective_transform():
    print(request)
    with Timer(prefix='API Execution'):
        with Timer(prefix='Loading Image File'):
            file = request.files['file']
            
        with Timer(prefix='Read File'):
            img_bytes = file.read()

        with Timer(prefix='Loading Args'):
            vertices = request.form.get('vertices')

        # Some other processing code
    return response
```
I would think that once request reaches the Python function, all data is available at that point.
Surprisingly most of the time is spent at `file = request.files['file']`
Based on my assumption it should be quick. Also the `print(request)` doesn't take any time at all.
The `file` that I am trying to get is generally in the range 1Mb to 2Mb.
On some occassion it takes very very long. 
Is this the expected behavior?
Any way to mitigate it?
```
Loading Image File took 0.423 seconds
Read File took 0.001 seconds
Loading Args took 0.000 seconds
API Execution took 0.736 seconds
```
### Environment

* Python version: 3.7
* Flask version: 1.1.1 
* Werkzeug version: 1.0.0
The **Tutorial** section of the docs refers to to the most recent `Flaskr` application structure however the **Testing Deep Dive** section is still referring to an application structure from at least the `0.12` version of the tutorial which assumes an application structure that doesn't involve the  app factory. This could certainly confuse a new comer... I mean not me.... I certainly wasn't confused by it _shifts eyes around nervously_

Ref: Ref code snippet here

https://flask.palletsprojects.com/en/1.1.x/testing/#the-testing-skeleton
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->



how remove response header server 
how remove 
```
Server: Werkzeug/0.15.6 Python/3.7.3
```

Also hint at `root_path` parameter rather than mentioning in plain text.
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

I'm developing a web server and running Flask in debug mode is giving me a really strange issue.
If I try to send through an XHR a blob with "application/octet-stream" as Content-Type to the Flask server, I successfully receive the file, but RAM memory increase exactly by the same size of the file and never gets released until I press CTRL+C to stop Flask. Even if I close the browser, memory stays there.
In particular this happens if run this .sh script on bash:
```bash
# start_flask.sh
if [[ -n $1 ]]; then
	# I select this option
	if [[ $1 == '-s' ]]; then
		export FLASK_ENV=development
		export FLASK_APP=wsgi/j_wsgi.py
		flask run
	elif [[ $1 == '-l' ]]; then
		git log --oneline --decorate --graph --all
	else
		echo "Invalid arguments"
	fi
else
	echo "No arguments given"
fi
```
Instead, running this simple command doesn't give any issue:

`env FLASK_APP=wsgi/j_wsgi.py flask run`

I think the problem it's not browser related, because I tested it on several clients:

- **Google Chrome** (v80.0.3987.149-1)
- **Chromium** (v80.0.3987.149-1)
- **Firefox** (v73.0.1-1)
- **curl** (v7.68.0-1)

This is the Javascript function running on the browser:

```javascript
function sendBlob(file)
{
    var chunkSize = 500000000; // 500 MB

    var xhr = new XMLHttpRequest();

    var blob = file.slice(0, chunkSize, "application/octet-stream");

    xhr.open("POST", "http://127.0.0.1:5000/api/get_layout/");

    xhr.onreadystatechange = function()
    {
        if (this.readyState == 4 && this.status == 200)
            console.log("blob successfully sent.");
    }

    xhr.setRequestHeader("Content-Type", "application/octet-stream");
    xhr.setRequestHeader("X-Content-Name", "blob");

    xhr.send(blob);
}
```
I tried also with curl:
`curl --data-binary @filename -H 'Content-Type: application/octet-stream' -H 'X-Content-Name: blob' application' http://127.0.0.1:5000/api/get_layout/`

Here is the python running on the server:
```python
# main.py
from flask import Flask, abort, render_template, send_file, request, send_from_directory, abort, Response, jsonify

import json
from flask_restful import Api, Resource, reqparse
from flask_wtf.csrf import CSRFProtect

import socket
import re

from werkzeug.datastructures import FileStorage

import os
import shutil

app = Flask(__name__)
csrf_protect = CSRFProtect(app)
api = Api(app, decorators=[csrf_protect.exempt])

# implementing parser
cmd_parser = reqparse.RequestParser()

# adding parser arguments
cmd_parser.add_argument('file_', type=str, required=False, location='json')
cmd_parser.add_argument('file', type=FileStorage, location='files')

@app.route('/')
def hello_world():
    return render_template("index.html")

class Upload(Resource):

    def post(self):

        filename = request.headers['X-Content-Name']
        content = request.data

        f = open("/home/roberto/upload/" + filename, "ab")
        f.write(content)
        f.close()

        return "OK"
    
    def get(self):
        return "GOOD"

api.add_resource(Upload, "/api/get_layout/")
```


### Environment

* Python version: 3.8.1
* Flask version: 1.1.1
* Werkzeug version: 0.16.0

Description
scrapy code
```
            url='http://192.168.5.9:6010/predict?url={}'.format(response.meta['url'])
            data={'html_url':response.meta['url'],'html_cn_text':cn_result}
            meta['status_404']=True
            meta['response']=response
            meta['proxy']=''
            return scrapy.FormRequest(url,formdata=data,callback=self.parse,dont_filter=True,meta=meta)
```
flask gevent code
```
monkey.patch_all()
app = Flask(__name__)
ctx=app.app_context()
ctx.push()

# 获取本机ip
myaddr = '192.168.5.73'
myport = 6010
decide_404=Decide404()
@app.route('/predict',methods=['POST','GET']) 
def predict():
    try:
        start_time=time.time()
        if request.method == "GET":
            return 'http method need post'
        elif request.method == "POST":
            form = request.form
            data = form.to_dict() #
            html_url=data['html_url'] if 'html_url' in data else ''
            html_text=data['html_cn_text']
            score=decide_404.decide_model(html_text)
            logging.info('url: {} ;text: {} ;predict: {} ;cost: {} ;'.format(html_url,html_text[:20],score,round(time.time()-start_time,2)))
            return str(score)
        else:
            return 'None'
    except Exception as e:
        logging.info('error {} '.format(e),exc_info=True)
        return 'None'
server = WSGIServer(('', 6010), app)
server.start()
def serve_forever():
    server.start_accepting()
    server._stop_event.wait()

if __name__ == "__main__":
        try:
            for i in range(32):
                p = Process(target=serve_forever)
                p.start()
        except Exception as e:
            logging.info('404 webserver false')
            decide_404.send_email('404 webserver false')
```

scrapy is responsible for sending post requests to my service, and the service is responsible for processing post requests and returning calculation results
However, scrapy will soon catch in middlwares when making a request. 

> /Scrapy_spider_9.log:2019-12-20 16:13:50 [root] INFO: get url https://news.10jqka.com.cn/tapp/news/ share / 616126829 / is 404 by error {'url': 'https://news.10jqka.com.cn/tapp/news/share/616126829/', 'retry': 0, 'url_format': 'https: / /news.10jqka.com.cn/tapp/news/share/()/ ',' article_id ': 616126829,' upload_type ':' news', 'download_timeout': 60.0, 'proxy': '', 'download_slot' : 'news.10jqka.com.cn', 'download_latency': 1.4705162048339844, 'status_404': True, 'response': <200 https://news.10jqka.com.cn/tapp/news/share/616126829/> , 'depth': 1, 'status': ResponseNeverReceived ([<twisted.python.failure.Failure twisted.internet.error.ConnectionDone: Connection was closed cleanly.>],)}

[Exception. The server does not have extra anti-crawl processing.
The server has captured the requested address:

> :: ffff: 192.168.5.9--[2019-12-20 16:13:58] "POST /predict?url=https://news.10jqka.com.cn/tapp/news/share/616126829/ HTTP / 1.1 "200 115 3.574375

And the calculation will only return '0', '1', 'None'
The request was recorded in the server's log and the result was obtained

> ./decide_404.log:[2019-12-20 16: 13: 58,449] [decide_404.py:300] [INFO] [url: https://news.10jqka.com.cn/tapp/news/share/616126829 /; text: Jiahua Energy's monthly big order reveals the secret number of mobile straight flush financials; predict: 1; cost: 3.57;)

scrapy setting.py
```
CONCURRENT_REQUESTS =20
DOWNLOAD_TIMEOUT = 60
CONCURRENT_REQUESTS_PER_IP = 0
CONCURRENT_REQUESTS_PER_DOMAIN = 1000
DOWNLOAD_DELAY = 0
REACTOR_THREADPOOL_MAXSIZE = 1000
```

Another phenomenon is that scrapy sends a request, and then quickly returns an error that the connection was cleaned up. However, after 8 seconds, gevent showed that the request was received and then processed it.

So who cleans it up, is scrapy automatically cleaned up because of too many requests, or gevent cleans up because of too many concurrents. Both have mechanisms to delay processing.
For scrapy delayed requests, it should be timeout and the time returned is abnormal. I see stackoverflow that gevent can handle any number of requests, and if gevent cleans up the request, why does it continue to calculate the request?

This is the timeline in the log
```
2019-12-20 16:13:50 scrapy:The request has been sent and returned an exception.
2019-12-20 16:13:58 gevent console :Shows that there is a request coming.
2019-12-20 16:13:58 gevent Calculate the request
```

1.  I sent a request and soon scrapy told me the connection was cleared
2.  8 seconds after(or other times)
3.  Flask console shows that the request has been received
4.  Flask begins to calculate the request
But my scrapy request never came to fruition

Where is the setting wrong? Scrapy flask gevent?

The server did not perform any additional anti-crawling measures on the request, why does scrapy catch exceptions such as Connection was closed cleanly.

scrapy = 1.8.0 falsk =1.1.1 gevent =1.4.0 Werkzeug =0.16.0 python3 =3.6.5

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
Flask is unable to use bound methods when using the `FLASK_APP` environment variable with a module attribute listing

```python
# service.py
import Flask

class AppService:
    def __init__(self):
        pass
    def create_flask_app(self):
        return Flask("demo-app")

service = AppService()
MY_SERVER = service.create_flask_app
```

```console
$ FLASK_APP="service.py:MY_SERVER" flask run
```

Application should boot

### Actual Behavior
An exception is thrown:
```
flask.cli.NoAppException: A valid Flask application was not obtained from "service:MY_SERVER".
```

Issue is here: https://github.com/pallets/flask/blob/master/src/flask/cli.py#L171

`inspect.isfunction` returns false for a bound method.


### Environment

* Python version: 3.6.10
* Flask version: 1.1.1
* Werkzeug version:


Use the documentation for Python 3 instead of Python 2, which is deprecated.
TL;DR: I think it would be helpful to add a `click.secho("Warning the current directory has changed to..")` there: https://github.com/pallets/flask/blob/master/src/flask/cli.py#L656

--

I have spent quite some time trying to understand what was going on in the following situation: suppose I have a project with multiple apps, among which a `toto` Flask app (with `python-dotenv` present in its virtual environment):

```
/project/apps/toto/__init__.py  <-- the `app` object lives there 
```

Because `toto` is part of a more general project, I want to centralize its configuration settings at the root of the project, in order for them to be shared among the different other apps and scripts (not sure that is such a good idea but that is what I've been experimenting with):

```
/project/.env  <-- configuration for `toto` lives there, among other things
```

Now the problem I have been having in this particular setup is that I did what I normally do while developing and testing a Flask app:

```
$ cd /project/apps/
$ FLASK_APP=toto flask run
```

and here the fun begins because Flask will silently `os.chdir` to the directory where the `.env` file was found, and in this particular case won't be able to load the app afterward because it no longer finds itself in the directory where `flask run` was ran, and thus won't be able to find `toto` there.I should add the detail that is happening even though `FLASK_APP` is *not* defined in `/project/.env`: the only place where I want it defined in this development context is on the command-line, at the moment I run it.

Now that I properly understand it, I find this behavior logical and helpful, and I am certainly not proposing to change it. However what would have clearly helped in my particular case was if `flask run` would have informed me about it (a simple console warning), and that is what I'd like to discuss with this issue, if anyone finds that it makes sense.
### Issue
Hello, we found this unexpected behaviour.

Seems that in the route evaluation, the URI is url decoded at first and then the variables are evaluated.

## Example1:
one variable of generic type that contain a slash encoded in %2F

```
curl -v http://172.23.0.2:8080/test/ab%2Fcd
```
```
@app.route('/test/<param>')
def test(param):
    return (
        f"{param}\n{request.path}",
        headers_text
    )
```
got: 404 Not Found
expected: HTTP 200 OK  param = "ab%2Fcd" or param = "ab/cd"

## Example2:
two variables of path type that contains each a slash encoded in %2F
```
curl -v http://172.23.0.2:8080/testp/a%2Fb/c%2Fd
```

```
@app.route('/testp/<path:param1>/<path:param2>')
def testp(param1, param2):
    return (
        f"{param1}\n{param2}\n{request.path}",
        headers_text
    )
```

got:
param1="a"
param2="b/c/d"

expected:
param1="a%2Fb"
param2="c%2Fd"
or
param1="a/b"
param2="c/d"



### Environment

* Python version: 3.7.7
* Flask version: 1.1.1
* Werkzeug version: 1.0.0

## Whole code to test the examples:
```
# -*- coding: utf-8 -*-
​
from flask import Flask, request
​
app = Flask("TestApp")
​
headers_text = {
    "content-type": "text/plain; charset=UTF-8",
}
​​
@app.url_value_preprocessor
def test_url_value_preprocessor(endpoint, values):
    app.logger.info("test_url_value_preprocessor")
    app.logger.info(str(endpoint))
    app.logger.info(str(values))
    app.logger.info(request.url)
    app.logger.info(request.base_url)
    app.logger.info(request.path)
    app.logger.info(request.origin)
​
​
@app.route('/test/<param>')
def test(param):
    return (
        f"{param}\n{request.path}",
        headers_text
    )
​
​
@app.route('/testp/<path:param1>/<path:param2>')
def testp(param1, param2):
    return (
        f"{param1}\n{param2}\n{request.path}",
        headers_text
    )
​
​
app.run(
    host="0.0.0.0",
    port=8080,
    debug=True  # autoreload on code change
)
```

### Expected Behavior
Executing flask.run(debug=True) should start the server (for development purposes at least)
```python
#app.py file
app = Flask(__name__)
app.config["SERVER_NAME"]="localhost:9191"
if __name__=="__main__":
    app.run(debug=True)
```

### Actual Behavior
The server does not start stays ad eternum on " * Restarting with ....":
if **watchdog-0.10.2** is installed (with pip install watchdog)
 * Restarting with windowsapi reloader
if **watchdog-0.10.2** is **not** installed
* Restarting with stat

No Exception is shown on the logs whatsoever just hangs

### Extra information
Server run as expected if
```python
#app.py file
app = Flask(__name__)
app.config["SERVER_NAME"]="localhost:9191"
if __name__=="__main__":
    app.run()
```
or 
```python
#app.py file
app = Flask(__name__)
app.config["SERVER_NAME"]="localhost:9191"
if __name__=="__main__":
    app.run(debug=True, use_reloader=False)
```

### Environment

* Python version: 3.8.2
* Pip version: 20.0.2
* Flask version: 1.1.1
* Werkzeug version: 1.0.0

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->
When 'Content-Type': 'application / json' is set and the request sent by the user does not have json, the request will report an error, then the client will get 400 Bad request.I don't know if it should be.

Through debug I found that `request.json` will deserialize the request json data, and json is None, so it will throw an error.

```python
# a example
# Client code
url = 'http://localhost:5000/api/v1/oauth'
response = self.client.get(url, headers={
    'Content-Type': 'application/json'
})
print(response)
print(response.data)
```

### Actual Behavior
User get 400 bad request
`.400 Bad Request: The browser (or proxy) sent a request that this server could not understand.`
```pytb
# print(response)
.<Response streamed [400 BAD REQUEST]>
# print(response.data)
b'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">\n<title>400 Bad Request</title>\n<h1>Bad Request</h1>\n<p>The browser (or proxy) sent a request that this server could not understand.</p>\n'

```

### Environment

* Python version: 3.7.5
* Flask version: 1.1.1
* Werkzeug version: 1.0.0

docs: testing.rst function def missing colon
Demonstration of markupsafe's escape function was in the Minimal
Application example, but the minimal example does not accept user
input.

closes #3527
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
When happens exeption ValidationError i waiting that be handled function handle_exception

### Actual Behavior
```pytb
  File "/usr/lib/python3.7/site-packages/marshmallow/schema.py", line 892, in _do_load
    raise exc
marshmallow.exceptions.ValidationError: {'active': ['Not a valid boolean.']}
```

### Environment

* Python version: 3.8
* Flask version: 1.1.1
* Werkzeug version: 0.16.1
* Marshmallow: 3.5.0

```
@app.errorhandler(marshmallow.exceptions.ValidationError)
def handle_exception(e):
    return {'message': e.normalized_messages()}, 400
```

I pulled the latest version of flask Flask from the master branch, commit 64ba43411fbfb2e435455b0df2453d7809b7c5a8.

The Quickstart minimal example on the dev version of Flask does not run as intended.  Previous versions of the Quickstart example would display a simple "Hello world" message, but the addition of an undefined "name" variable causes the example to fail with a NameError.

It seems that the intention was to illustrate Werkzeug's HTML escaping functionality early-on, which makes sense, but the example needs to be restructured or augmented so that it still runs.

I'm aware that this is a development version of Flask, so my apologies if this (possibly known?) issue should be reported elsewhere or can be ignored.  Thanks.

### Expected Behavior

The Quickstart doc says that running the example should display a "Hello world" message when navigating to http://127.0.0.1:5000/.

```python
from flask import Flask
from markupsafe import escape

app = Flask(__name__)

@app.route("/")
def hello_world():
    return f"<p>Hello, {escape(name)}!</p>"
```

### Actual Behavior
The browser displays an Internal Server Error response from Flask due to a NameError.

```pytb
Traceback (most recent call last):
  File "/home/pkritikos/work/flask_playground/venv/lib/python3.6/site-packages/flask/app.py", line 2430, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pkritikos/work/flask_playground/venv/lib/python3.6/site-packages/flask/app.py", line 1945, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pkritikos/work/flask_playground/venv/lib/python3.6/site-packages/flask/app.py", line 1814, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/home/pkritikos/work/flask_playground/venv/lib/python3.6/site-packages/flask/_compat.py", line 39, in reraise
    raise value
  File "/home/pkritikos/work/flask_playground/venv/lib/python3.6/site-packages/flask/app.py", line 1943, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pkritikos/work/flask_playground/venv/lib/python3.6/site-packages/flask/app.py", line 1929, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/home/pkritikos/work/flask_playground/tutorial/__init__.py", line 8, in hello_world
    return f"<p>Hello, {escape(name)}!</p>"
```

### Environment

* Python version: Python 3.6.9
* Flask version: Flask 1.2.0.dev0
* Werkzeug version: Werkzeug 1.0.0

I thought that the route argument in `@app.route` is always relative to the root url. However I found myself in a situation where it isn't and is giving me 404 errors.

I have a search function in my website with a view function like this:
`@app.route('/search')`
`@app.route('/search.html')`
`def searchPosts():`

and I'm using `flask_whooshalchemyplus` for searching. Whenever I search something and I'm at a page like this: `host:port/onePage` all is good, as I'm redirected to `host:post/search?searchQuery=whatever` to display the search results.

However, if I am currently at a "deeper" url page, like so: `host:port/onePage/secondPage` then I'm getting 404, since I'm instead redirected to `host:post/onePage/search?searchQuery=whatever`

Why is this? Shouldn't the route always be as in the first case? Why would I be redirected to the second case, if the route was absolute? 
This whooshsqlalchemyplus hasn't been the only case. I have seen this behavior once more, but I can't recall what was it that lead to it exactly.

Am I missing something?

PS. Sorry for the empty post, I must have accidentally pressed enter.
Can we delete this post completely? Sorry, I accidentally pressed enter and now I've created a new post to replace this. Thank you and sorry again for the noise.
Starting with wheel 0.32.0 (2018-09-29), the `license_file` option is
deprecated in favor of `license_files`.

https://wheel.readthedocs.io/en/stable/news.html

The wheel will continue to include `LICENSE`, it is now included
automatically:

https://wheel.readthedocs.io/en/stable/user_guide.html#including-license-files-in-the-generated-wheel-file

See https://github.com/FactoryBoy/factory_boy/pull/696 for inspiration and more discussion.

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

We are forced to use Python 3.6 due to some other dependencies that do not work with newer versions of Python.

Steps to reproduce:

1) Create `hello.py`, as described in the example:

```python
from flask import Flask

app = Flask(__name__)

@app.route("/")
def hello():
    return "Hello, World!"
```

2) Try to run it:

```bash
FLASK_APP=hello.py flask run
```

### Expected Behavior

I see "Hello, World!" in the browser.

### Actual Behavior

```bash
 * Serving Flask app "hello.py"
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
Usage: flask run [OPTIONS]

Error: Could not import "hello".
```

Running the same example in Python 3.7 works fine.

### Environment

* Python version: 3.6.10
* Flask version: 1.1.1
* Werkzeug version: 1.0.0

Hi,

I'm working on a project in which I have to create a realtime working python rest API that does the following: - multiple request receiving, processing them, and responding.

My question is, is it possible to work realtime with python flask APIs? And if there is, is there a way for me to view the realtime responses when a stream of requests are provided?

Thanks!
Previously, the description referred to a property named `original_error`. However, both the code sample that followed it _and_ the Werkzeug documentation refer to it as `original_exception` instead.

In this commit, I change the description to use the same property name as is used in the code sample and the Werkzeug documentation.

Here's a link to the Werkzeug documentation of that property:
- https://werkzeug.palletsprojects.com/en/1.0.x/exceptions/#werkzeug.exceptions.InternalServerError.original_exception

Fixes https://github.com/pallets/flask/issues/3520

Thanks, @davidism, for referring me to the relevant section of the Werkzeug docs. 

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

I read the Flask documentation at https://flask.palletsprojects.com/en/1.1.x/errorhandling/#unhandled-exceptions and noticed the property name used in the description is different from the property name used in the example code.

![image](https://user-images.githubusercontent.com/53710895/75581125-c68e7e00-5a1d-11ea-9f94-fd10e5a34856.png)

### Expected Behavior
<!-- Tell us what should happen. -->

I expected them to be the same as one another.

### Actual Behavior
<!-- Tell us what happens instead. -->

They were different from one another.

### Environment

* Python version: N/A
* Flask version: 1.1.x
* Werkzeug version: N/A

### Expected Behaviour
The test_client should be able to call the flask_restful API without error, as it does when normal running

```    #!flask/bin/python
    import os, sys; sys.path.append(os.path.dirname(os.path.realpath(__file__)))
    from flask_restful import Api
    from flask_cors import CORS
    from flask_jwt_extended import JWTManager
    from werkzeug.serving import WSGIRequestHandler
    import logging
    from flask import Flask, request
    from waitress import serve

    app = Flask(__name__, static_folder='ui', static_url_path='')


    def create_app():
        handler = logging.StreamHandler(sys.stdout)
        logger = logging.getLogger('webapp')
        logger.setLevel(logging.INFO)
        logger.addHandler(handler)

        WSGIRequestHandler.protocol_version = "HTTP/1.1"
        app.config['CORS_HEADERS'] = 'Content-Type'

        CORS(app, origins=['http://127.0.0.1', 'http://localhost:3000', 'http://localhost:3000/api'],
         allow_headers=["Content-Type", "Authorization",
                        "Access-Control-Allow-Credentials",
                        "Access-Control-Allow-Headers",
                        "Access-Control-Allow-Origin"], supports_credentials=True)

        logging.basicConfig(level=logging.DEBUG)

        app.config['SECRET_KEY'] = '...'
        app.config['JWT_ACCESS_LIFESPAN'] = {'hours': 24}
        app.config['JWT_REFRESH_LIFESPAN'] = {'days': 30}

        jwt = JWTManager(app)

        api = Api(app)

        api.add_resource(resources.Login, '/api/login', methods=['POST'])

    if __name__ == '__main__':
        app = create_app()
        serve(app, host='0.0.0.0', port=5000)
        # app.run(host='0.0.0.0', port=5000, use_reloader=False)
```
Test case, webapp referred to here is as above, fails in setUp.
```
    def setUp(self):
        self.client = app.test_client()
        self.client.testing = True
        result = self.client.post('/api/login/', content_type='application/json',
                                  json={'email': 'tester@fairxchange.co.uk', 'password': 'Tyle82654isMid!'})

        json_data = json.loads(result.get_data(as_text=True))
        self.token = json_data['access_token']

        
        self.assertTrue(res.response_status == 200)
```
In resource.py
```
class Login(Resource):
    def post(self):
        logger.info(sys.version)
        parser = reqparse.RequestParser()
        parser.add_argument('email', help='This field cannot be blank', required=True)
        parser.add_argument('password', help='This field cannot be blank', required=True)
        data = parser.parse_args()
        email = data['email']
        password = data['password']
...etc...
```

### Actual Behavior
I receive a 405 error

```
<Response streamed [405 METHOD NOT ALLOWED]>
```

### Environment

* Python version: 3.7.6
* Flask version: 1.1.1
* Werkzeug version: 0.16.1

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

This is a request for a simple addition to expose `JSONDecodeError` in `flask.json`

### Expected Behavior
<!-- Tell us what should happen. -->
The flask documentation states: 

> So for starters instead of doing:
>
>```python
>try:
>    import simplejson as json
>except ImportError:
>    import json
>```
>You can instead just do this:
>```python
>from flask import json
>```

But if I follow that advice, there is no way to catch decoding exceptions:

```python
try:
    json.loads("abcd")
except json.JSONDecodeError:
    abort(400, "Received invalid json data")
```

Since I don't know whether `flask.json` is using `json` or `simplejson`, I have to bring back that try/except statement, or else catch generic `Exception`s.  

### Actual Behavior
<!-- Tell us what happens instead. -->
As written the silly example raises an AttributeError because JSONDecodeError isn't a member of flask.json. 

```pytb
JSONDecodeError                           Traceback (most recent call last)
<ipython-input-43-51448d03474f> in <module>()
      1 try:
----> 2     json.loads("abcd")
      3 except json.JSONDecodeError:

/usr/local/lib/python3.6/site-packages/flask/json/__init__.py in loads(s, app, **kwargs)
    235         s = s.decode(encoding)
--> 236     return _json.loads(s, **kwargs)
    237 

/usr/local/lib64/python3.6/site-packages/simplejson/__init__.py in loads(s, encoding, cls, object_hook, parse_float, parse_int, parse_constant, object_pairs_hook, use_decimal, **kw)
    534         kw['parse_float'] = Decimal
--> 535     return cls(encoding=encoding, **kw).decode(s)
    536 

/usr/local/lib64/python3.6/site-packages/simplejson/decoder.py in decode(self, s, _w, _PY3)
    369             s = str(s, self.encoding)
--> 370         obj, end = self.raw_decode(s)
    371         end = _w(s, end).end()

/usr/local/lib64/python3.6/site-packages/simplejson/decoder.py in raw_decode(self, s, idx, _w, _PY3)
    399                 idx += 3
--> 400         return self.scan_once(s, idx=_w(s, idx).end())

JSONDecodeError: Expecting value: line 1 column 1 (char 0)

During handling of the above exception, another exception occurred:

AttributeError                            Traceback (most recent call last)
<ipython-input-43-51448d03474f> in <module>()
      1 try:
      2     json.loads("abcd")
----> 3 except json.JSONDecodeError:
      4     print("caught")
      5 

AttributeError: module 'flask.json' has no attribute 'JSONDecodeError'
```

### Environment

* Python version: 3.6.8
* Flask version: 1.0.3
* Werkzeug version: 0.14.1

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

i want help i called run() it is running forever. Is there any method to close or stop without using service?

### Expected Behavior
Default date formatting converts dates with a year below 1000 to a non-zero padded string.
See _dump_date: https://github.com/pallets/werkzeug/blob/master/src/werkzeug/http.py

```
datetime.date(year=1, month=1, day=1)

should yield in the JSON: 'Mon, 01 Jan 0001 00:00:00 GMT'

so it can be parsed by:

'%a, %d %b %Y %H:%M:%S %Z'
```

### Actual Behavior
```
datetime.date(year=1, month=1, day=1)

yields in the JSON: 'Mon, 01 Jan 1 00:00:00 GMT'

which can't be parsed by:

'%a, %d %b %Y %H:%M:%S %Z'
```

### Environment

* Python version: 3.6.9
* Flask version: 1.1.1
* Werkzeug version: 0.16.1

### Comment

werkzeug may not want to apply the patch to _dump_date so maybe you want to implement your own safe http_date.

https://github.com/pallets/werkzeug/issues/1739
Describe what this patch does to fix the issue.
When I read the code, I feel something is hard to understand.
So I change it.
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->

I am using docker with python3, I'd like to compress response json uses `jsonify` but not luck.
Refs: https://github.com/colour-science/flask-compress

```python
// Code
...
from flask_compress import Compress
...
app = Flask(__name__)
CORS(app)
Compress(app)
```

Expect:
```python
{ "success": true,  "data": {}}
```

### Actual Behavior

```pytb
{
  "success": true, 
  "data": {}
}
```

### Environment

* Python version: Docker python3.7
* Flask version: 1.1.1
* Werkzeug version: Unknown

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

### Expected Behavior
I have an application that checks if my users log in for the first time and if they are they will be redirected to a page where they need to change the default password they have been provided.
This redirect is happening with `app.before_request`.

```python
@app.before_request
def redirect_to_othersite():
    other_url = url_for("othersite")
    if request.path == other_url:
        return

    return redirect(other_url)

@app.route('/')
def home():
    return render_template("index.html")

@app.route('/othersite/')
def othersite():
    return render_template("othersite.html")
```


### Actual Behavior
After the redirect static files like stylesheets and images are broken on the page. Chrome dev tools show that all files from my static folder are being sent with content type `text/html`, which I suspect is the issue. Caching should be disabled in the Chrome dev tools to see the issue.

When decorating all routes with a function manually then stylesheets are loading fine.

### Environment

* Python version: 3.7.5
* Flask version: 1.1.1
* Werkzeug version: 1.0.0

Hey when launching a thread it does not run as a daemon 
```python
bird66 = Thread(target=stuffs().update())
bird66.daemon = True                                  
bird66.start()                                        
```


How do i run it as a daemon ?

i tried with Thread(target=stuffs().update(), daemon=True), same result, i guess its cuz flask is doing some black magic with the threads, how do i make it run as a daemon(in the background)


Specs:

```
Name: Flask
Version: 1.0.2
Summary: A simple framework for building complex web applications.
Home-page: https://www.palletsprojects.com/p/flask/
Author: Armin Ronacher
Author-email: armin.ronacher@active-4.com
License: BSD
Location: /usr/local/lib/python3.6/site-packages
Requires: itsdangerous, click, Werkzeug, Jinja2
Required-by: flask-paginate, Flask-Excel
```

This was originally added before Pycharm natively supported this.

Pycharm 2018.1 fixed that issue.

So these instructions are now more than two years out of date so they
are a potential source of confusion rather than helpful for n00bs.

Further context:
* https://github.com/pallets/flask/issues/2198
* https://github.com/pallets/flask/pull/2332
* https://youtrack.jetbrains.com/issue/PY-23190
### Expected Behavior
url_for apparently has behavior where it will generate routes that use the current request method. For example in the following example, url_for can return either of the following depending on the method.

GET: `http://localhost:4444/bad/bad`
POST: `http://localhost:4444/bad?data=bad`

I would actually expect it to always return `http://localhost:4444/bad/bad`. 

Secondly during a test, since there is no method it seems like Flask will return the expected value of `http://localhost:4444/bad/bad`. This recently bit me and broke some functionality that was covered by a test that then failed in production because of this. 

```python
from flask import Flask, url_for
app = Flask(__name__)
app.config["SERVER_NAME"] = "localhost:4444"

@app.route('/bad', methods=["POST", "GET"])
@app.route('/bad/<data>', methods=["GET"])
def hello_world(data=None):
    return url_for("hello_world", data="bad", _external=True)

with app.app_context():
    # The value that would probably be generated under a test. 
    print(url_for("hello_world", data="bad"))

if __name__ == '__main__':
    app.run(debug=True, threaded=True, host="127.0.0.1", port=4444)

# curl -X POST http://localhost:4444/bad
# or 
# curl -X GET http://localhost:4444/bad
```

### Environment

* Python version: Python 3.7.6
* Flask version: 1.1.1
* Werkzeug version: 1.0.0

Hello party people,

My understanding was that `@app.teardown_request` function would be called after a request whenever an error occurred or not.

However, it seems that when I set an `@app.errorhandler(Exception)`, the error handler is called but then the `@app.teardown_request` function is not.

Is this the expected behaviour?

Best regards,

Rémy


```
@app.teardown_request
def commit_or_rollback_db_session(ctx):
    try:
        if g.get("rollback_db_session"):
            g.db_session.rollback()
        else:
            g.db_session.commit()
    except Exception:
        g.db_session.rollback()
        raise

@app.errorhandler(Exception)
@app.errorhandler(500)
def handle_internal_server_error(e):
    g.rollback_db_session = True
    return jsonify(error=True, code=500)
```
Relates to https://stackoverflow.com/questions/60131900/weird-is-xhr-error-when-deploying-flask-app-to-heroku (which was viewed > 600 times in a few days)

### Expected Behavior
Flask pulls a compatible version of Werkzeug

```python
# Paste a minimal example that causes the problem.
```

### Actual Behavior
flask currently requires Werkzeug >= 0.15 but we recently noticed that some of our existing flask applications were broken. In fact we were (still) running flask 0.12.4 and as it is now it is pulling Werkzeug 1.0.0 which is incompatible (breaks at runtime).

```pytb
File "/app/server/controller.py", line 24, in get_kws 2020-02-08T22:31:05.893850+00:00 app[web.1]: 'query_results': query_result 2020-02-08T22:31:05.893850+00:00 app[web.1]: File "/app/.heroku/python/lib/python3.6/site-packages/flask/json.py", line 298, in jsonify 2020-02-08T22:31:05.893851+00:00 app[web.1]: if current_app.config['JSONIFY_PRETTYPRINT_REGULAR'] and not request.is_xhr: 2020-02-08T22:31:05.893851+00:00 app[web.1]: File "/app/.heroku/python/lib/python3.6/site-packages/werkzeug/local.py", line 347, in getattr 2020-02-08T22:31:05.893852+00:00 app[web.1]: return getattr(self._get_current_object(), name) 2020-02-08T22:31:05.893858+00:00 app[web.1]: AttributeError: 'Request' object has no attribute 'is_xhr'
```

As described in the SO post, upgrading flask >= 1.0 fixes this but I thought I'd still report this in case you think its worth releasing a 0.12.5, I could do the change in setup.py.

### Environment

* Python version: 3.8
* Flask version: 0.12.4
* Werkzeug version: 1.0

same code:-

```
def long_task(i):
    
   
        # global session
        print "started executing for {}".format(i)
    
        time.sleep(5)
        print "working"
        session['step1'][i]["status"] = 'Completed'


executor.submit(long_task, current_app._get_current_object(), i)
```

I am not sure this is a bug or I am missing something, I see several blogs I don't find anything at all and all these objects being accepted for any size in .net core as well in Node but when I tried with flask it's not accepting large size of the JSON object.  I don't think `MAX_CONTENT_LENGTH` is playing any roles in this.   FYI I am not trying to upload a file, I just want to pass large JSON Object over the server, I tried in both Dev vs Prod mode same behavior. 

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->



### Expected Behavior
<!-- Tell us what should happen. -->
This should accept all the content from the JSON Objects. 

I was using the following JSON as well with larger it's accepting until 1.1MB over it will get truncated and the request was made from the angular application. 
```python

(https://github.com/pallets/flask/files/4183314/accepted.txt) -- successfully received. 
(https://github.com/pallets/flask/files/4183315/rejected.txt)  -- rejected
```

### Actual Behavior

```pytb
 The object being truncated after 1mb size. 
```


### Startup

```pytb
from flask import Flask, render_template, Blueprint

from flask_cors import CORS


def create_app():
    app = Flask(__name__)
    CORS(app, resources={r"/api/*": {"origins": "*"}})
    app.config['SECRET_KEY'] = "secret!"
    app.config['DEBUG'] = False
    app.config['MAX_CONTENT_LENGTH'] = 1600 * 1024 * 1024
    app.register_blueprint(bp)

    return app

obj = create_app()

if __name__ == '__main__':
    obj.run()
```

### Blueprint

```pytb
from flask import Blueprint, request

bp = Blueprint('bp', __name__, url_prefix='/image')

@bp.route('PostImage', methods=['POST'])
def PostImage():
    print(request.data)
    print('text')
    return 'test', 200
```




### Environment

* Python version: 3.6



* Flask version: 1.1.1
* Werkzeug version: 1.0.0

Describe what this patch does to fix the issue.
Adds request.endpoint to the error message. 

Link to any relevant issues or pull requests.
fixes https://github.com/pallets/flask/issues/3445

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Pins Werkzeug to a compatible version.
Adds '.vscode' to .gitignore file.  This will prevent contributors using vscode from accidentally including this directory in their PRs.
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

This issue started after #2866 got merged in. After this change, I believe the limitation is that you cannot use a logger name with the same name as the Flask App. This issue occurs on version 1.1.0 onwards, 1.0.4 doesn't have this issue. It might break any app that use `__name__` as their logger name and flask app name (as long as it's not `__main__`).

### Expected Behavior
<!-- Tell us what should happen. -->
When you navigate to http://localhost:5000/test (or any route that will cause a 404), the logger will simply log `404 Error` in this code and not cause a stack overflow or thread dump.

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import logging

from flask import Flask
from flask.logging import default_handler

# Here for illustrative purposes, __name__ is typically used and is why the main issue occurs, but __main__ doesn't cause the issue
app_name = "foo"

# Logger Configured per Flask Instance, uses __name__ typically
logger = logging.getLogger(app_name)

# Other Business Logic
# ...

# Init Flask App
app = Flask(app_name)
# ...
# app.logger.removeHandler(default_handler)  # Causes Thread Dump if commented out or causes Stack Overflow if left...
app.logger.addHandler(logger)  # e.g. https://flask.palletsprojects.com/en/1.1.x/logging/#email-errors-to-admins (example of adding your own handler)

# Setup Routes
# ...

# Setup Error Handler so we can log something...
@app.errorhandler(404)
def not_found_error(error):
    app.logger.warning("404 Error")
    return "", 404


if __name__ == '__main__':
    app.run(host="127.0.0.1", port=5000, ssl_context=None, debug=False)

```

### Actual Behavior
<!-- Tell us what happens instead. -->
When you navigate to http://localhost:5000/test (or any route that will cause a 404), the issue will manifest itself and cause a thread dump or stack overflow.

```pytb
Current thread 0x000123... (most recent call first):
  File "...python3.6/site-packages/werkzeug/local.py", line 72 in __getattr__
  File "...python3.6/site-packages/werkzeug/local.py", line 169 in top
  File "...python3.6/site-packages/flask/globals.py", line 36 in _lookup_req_object
  File "...python3.6/site-packages/werkzeug/local.py", line 307 in _get_current_object
  File "...python3.6/site-packages/werkzeug/local.py", line 329 in __bool__
  File "...python3.6/site-packages/flask/logging.py", line 30 in wsgi_errors_stream
  File "...python3.6/site-packages/werkzeug/local.py", line 307 in _get_current_object
  File "...python3.6/site-packages/werkzeug/local.py", line 348 in __getattr__
  File ".../python3.6/logging/__init__.py", line 996 in emit
  File ".../python3.6/logging/__init__.py", line 865 in handle
  File ".../python3.6/logging/__init__.py", line 1516 in callHandlers
  ...
Thread 0x000456... (most recent call first):
  ...
Process finished with exit code 134 (interrupted by signal 6: SIGABRT)
```

### Environment

* Python version: 3.6, 3.7, 3.8
* Flask version: >=1.1.0 (issue) and <= 1.0.4 (ok)
* Werkzeug version: 0.16.1?

Apologies if I am misunderstanding this, but there seems to be an oversight with the `session.permanent` property function on `SecureCookieSession` in conjunction with the session interface's `should_set_cookie()`.

The session interface's `should_set_cookie()` function will return true if either of the following conditions is met:
* The session has been modified, or
* The session is permanent _and_ the `SESSION_REFRESH_EACH_REQUEST` is set to True.

However, setting `session.permanent = True` will internally add `_permanent` property on the current session, which in turn (due to the nature of the `SecureCookieSession` class), will set the `session.modified` to True. As such, the `SESSION_REFRESH_EACH_REQUEST` seems pointless as it seems impossible to set a session as permanent without it also getting set as modified each time.

It's certainly not a huge issue, as I don't think there is necessarily a use-case for setting session as permanent without using `SESSION_REFRESH_EACH_REQUEST`, but (in my opinion) it _does_ behave unexpectedly. Have I misunderstood something here?

### Expected Behavior
Setting `session.permanent = True` on a SecureCookieSession (or subclass of) and `app.config['SESSION_REFRESH_EACH_REQUEST'] = False` should make the session interface `should_set_cookie()` return False when the session has not been modified.

### Actual Behavior
The session interface's `should_set_cookie()` function always returns `True`, because the `session.modified` property is `True` (I believe this happens automatically when setting `session.permanent = True`)
This has been raised several times #3490 #3486 etc.

These have been closed due to no stacktrace or the issue being in a third party project.
Here are some reproducible examples just using Flask.

```
> python --version
Python 3.8.0
> pip install flask==0.12.4
Successfully installed Jinja2-2.11.1 MarkupSafe-1.1.1 Werkzeug-1.0.0 click-7.0 flask-0.12.4 itsdangerous-1.1.0
```

```
from flask import Flask, request
app = Flask(__name__)

@app.route('/')
def hello_world():
    return "Is xhr" if request.is_xhr else "Isn't xhr"
```
Using the documented property [is_xhr](https://flask.palletsprojects.com/en/0.12.x/api/#flask.Request.is_xhr) gives

```
  File "/home/mitchell/.virtualenvs/flask/lib/python3.8/site-packages/werkzeug/local.py", line 347, in __getattr__
    return getattr(self._get_current_object(), name)
AttributeError: 'Request' object has no attribute 'is_xhr'
```

Also in `jsonify`

```
from flask import Flask, jsonify
app = Flask(__name__)

@app.route('/')
def hello_world():
    return jsonify({
        "hello": "world",
    })
```
gives
```
  File "/home/mitchell/.virtualenvs/flask/lib/python3.8/site-packages/flask/json.py", line 298, in jsonify
    if current_app.config['JSONIFY_PRETTYPRINT_REGULAR'] and not request.is_xhr:
  File "/home/mitchell/.virtualenvs/flask/lib/python3.8/site-packages/werkzeug/local.py", line 347, in __getattr__
    return getattr(self._get_current_object(), name)
AttributeError: 'Request' object has no attribute 'is_xhr'
```

Hopefully these purely-flask reproducible examples will help this get sorted out.
The check was already happening in Werkzeug, this updates the Flask CLI so it doesn't require PyOpenSS.
Describe what this patch does to fix the issue.
This fixes crash caused by v1.0.0 released by Werkzeug
Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

On February 6th a new version of Werkzeug was released: https://pypi.org/project/Werkzeug/#history
It introduces a breaking API change which results in a crash. This is not directly happening in flask code, but in plugins - in my case it's `flask_session`.

### Expected Behavior
Flask should have a new version that uses werkzeug in version greater than 0.15, but less than 1.0. Other packages depending on flask can use that version and then the code will work as previously. :)

Compare this with https://github.com/phovea/phovea_server/issues/105 - see details about breaking changes in Werkzeug.

### Actual Behavior
Flask application can't be tested.

```pytb
/usr/lib/python3.7/unittest/mock.py:1204: in patched
    return func(*args, **keywargs)
doobar/test_utils/fixtures.py:72: in _stubbed_app
    return create_app('test')
doobar/__init__.py:41: in create_app
    Session(app)
venv/lib/python3.7/site-packages/flask_session/__init__.py:54: in __init__
    self.init_app(app)
venv/lib/python3.7/site-packages/flask_session/__init__.py:61: in init_app
    app.session_interface = self._get_interface(app)
venv/lib/python3.7/site-packages/flask_session/__init__.py:93: in _get_interface
    config['SESSION_USE_SIGNER'], config['SESSION_PERMANENT'])
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <flask_session.sessions.FileSystemSessionInterface object at 0x7f38e4d255c0>, cache_dir = '/tmp/doobar-sessions', threshold = 500, mode = 384, key_prefix = 'session:'
use_signer = False, permanent = True

    def __init__(self, cache_dir, threshold, mode, key_prefix,
                 use_signer=False, permanent=True):
>       from werkzeug.contrib.cache import FileSystemCache
E       ModuleNotFoundError: No module named 'werkzeug.contrib'

venv/lib/python3.7/site-packages/flask_session/sessions.py:313: ModuleNotFoundError
```

### Environment

* Python version: 3.7
* Flask version: 1.1.1
* Werkzeug version: 1.0

Due to depracation of top level imports (https://github.com/pallets/werkzeug/commit/08536c457c7125c05e0947e62487fbc4bcf51717), e.g. `from werkzeug import secure_filename` won't work anymore:

```
File "/usr/local/lib/python3.7/site-packages/flask_admin/model/__init__.py", line 2, in <module>
from .base import BaseModelView
File "/usr/local/lib/python3.7/site-packages/flask_admin/model/base.py", line 8, in <module>
from werkzeug import secure_filename
ImportError: cannot import name 'secure_filename' from 'werkzeug' (/usr/local/lib/python3.7/site-packages/werkzeug/__init__.py)
```

Since werkzeug has just been released, it's safe to pin here until flask has been thoroughly tested with werkzeug 1.0.0.
<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Fixes #3486 

Werkzeug released a new major version. Flasks does not protect the Werkzeug dependency for major releases with breaking changes. This should force to use a version of Werkzeug that does not break Flask before adapting the code of Flask to use the new version of Werkzeug.
### Expected Behavior
The doc mentions to install libapache2-mod-wsgi package on debian/ubuntu but the package is for Python 2.x. For python 3.x the package to be installed is libapache2-mod-wsgi-py3. The document doesn't mention anywhere that the steps are specific to Python 2.x.

### Actual Behavior
Update the doc to Python 3.x specific steps or mention that the doc is specific to Python 2.x

### Environment

* Python version: 3.X
* Flask version: 1.1.2
* Werkzeug version:

### Links

Doc: https://flask.palletsprojects.com/en/1.1.x/deploying/mod_wsgi/#installing-mod-wsgi
Source: https://github.com/pallets/flask/blob/master/docs/deploying/mod_wsgi.rst
Bumps [tox](https://github.com/tox-dev/tox) from 3.17.1 to 3.18.0.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/tox-dev/tox/blob/master/docs/changelog.rst">tox's changelog</a>.</em></p>
<blockquote>
<h1>v3.18.0 (2020-07-23)</h1>
<h2>Deprecations (removal in next major release)</h2>
<ul>
<li>Add allowlist_externals alias to whitelist_externals (whitelist_externals is now deprecated). - by dajose <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1491">#1491</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/tox-dev/tox/commit/513cdc84e61f8a6c75fd54b5e68c02f5e098a2b9"><code>513cdc8</code></a> release 3.18.0</li>
<li><a href="https://github.com/tox-dev/tox/commit/a9ec66182dffd76cf9569d1e8b956d082b26545c"><code>a9ec661</code></a> Add alias &quot;allowlist_externals&quot; to &quot;whitelist_externals&quot; (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1601">#1601</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/c4ef11d3a22a122f76f8443abaeba5ad26652f41"><code>c4ef11d</code></a> Add setup.cfg formatting</li>
<li><a href="https://github.com/tox-dev/tox/commit/f3a063a21f2e751a5e2fa18017238570036b8e3b"><code>f3a063a</code></a> Fix <code>tty</code> substitution to displays as code block (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1622">#1622</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/3c10fd98fa4ea4a0a7acf3d7888d1acce45e17e2"><code>3c10fd9</code></a> Specify the default value of parallel mode (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1620">#1620</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/3de864a0c13642f740c3de178016960da07a8f61"><code>3de864a</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1619">#1619</a> from tox-dev/release-3.17.1</li>
<li>See full diff in <a href="https://github.com/tox-dev/tox/compare/3.17.1...3.18.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=tox&package-manager=pip&previous-version=3.17.1&new-version=3.18.0)](https://dependabot.com/compatibility-score/?dependency-name=tox&package-manager=pip&previous-version=3.17.1&new-version=3.18.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
The next major release will depend on the next major releases of all the other libraries, which is equivalent to devel right now. Remove lowest, to be added back after the release.
Resolves #3215 

**Similar functions between Flask and Blueprint:**
**Chris:**
- [x] route
- [ ] add_url_rule
- [ ] endpoint
- [x] before_request
- [x] after_request
- [ ] teardown_request

**Yanlam:**
- [x] init
- [x] context_processor
- [x] url_value_preprocessor
- [x] url_defaults
- [x] errorhandler
- [x] register_error_handler

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->
I cannot make any changes to my Flask app which I cloned from: .https://github.com/cyrilrbt/canadian-nutrient-file
I tried editing template HTML files, the code in the routing in `views.py` but no changes are reflected.
I edited my `views.py` here: https://github.com/nyck33/canadian-nutrient-file/blob/master/cnf/views.py
to show `index2.html` and `show2.html` rather than the originals `index.html` and `show.html`.
But the routing still goes to the originals.
I used command `bin/buildout` to rebuild the app after making these changes just in case but it still goes to the original templates.

So I also tried editing the original templates as shown here on line 7 to 9 I inserted:
```
<p>hello</p>
```
but it's still not reflected.
![image](https://user-images.githubusercontent.com/25189545/89720629-083a3200-d989-11ea-95f4-7a84acb7322d.png)

I actually have no idea where "Food Standards" is coming from either because `layout.html` only has:
```
{% block content %} {% endblock %}
```
and `index.html` has a heading that does not appear anywhere:
```
<h1>Canadian Nutrient File Food Search</h1>
```


### Expected Behavior
<!-- Tell us what should happen. -->
The rendered page should change to show edits to the template.
```python
# Paste a minimal example that causes the problem.


```
[my question on stackoverflow on this issue](https://stackoverflow.com/questions/63028478/flask-templates-wont-update-with-new-edits)
### Actual Behavior
<!-- Tell us what happens instead. -->
The rendered page stays the same.  
```pytb
Paste the full traceback if there was an exception.
```
No exception.
### Environment

* Python version:  3.7
* Flask version:1.1.2
* Werkzeug version:1.0.1

Basically just trying to update a template which does not happen.  

Replace old invite links with the newly created unique URL.
This PR will make sure the `Content-Type` header is unique. The default `Content-Type` header will be overwritten by user-provided value.

Fix #3628
Related with #3684
I'm currently building a flask web application using Microsoft Azure. The basic idea is just a blog for my school which I'm doing as a project. For this web application, I have two html pages. A home page where people just chat and a calendar page. yes not the best ideas but it's sufficient. What i'm wondering is how i select a database for each html page. Since it's like a forum blog type page, I already have the form and the script for that ready but when I enter something, it shows up for all the pages. I've made two databases, database.db for the home page and calendar.db for the calendar page. So far, everything i've been submitting into the forms is going into database.db and not calendar.db for the calendar.html page. So, i've made the database for the calendar page and made a table for it but can't seem to connect it to calendar.db.



Here is my code:



app.py



``` from flask import Flask, render_template, request

from flask_cors import CORS

from models import create_post, get_posts





app = Flask(__name__)



CORS(app)



u/app.route('/', methods=['GET','POST'])

def index():



if request.method == 'GET':

pass

if request.method == 'POST':

name = request.form.get('name')

post = request.form.get('post')

create_post(name, post)



posts = get_posts()



return render_template('index.html', posts=posts)



u/app.route('/calendar.html', methods=['GET','POST'])

def calendar():



if request.method == 'GET':

pass

if request.method == 'POST':

name = request.form.get('name')

post = request.form.get('post')

create_post(name, post)



posts = get_posts()



return render_template('calendar.html', posts=posts)



if __name__ == '__main__':

app.run(host="0.0.0.0", port=80)





```



and then models.py



```

import sqlite3 as sql

from os import path



ROOT = path.dirname(path.relpath((__file__)))



def create_post(name,content):

con = sql.connect(path.join(ROOT, 'database.db'))

cur = con.cursor()

cur.execute('insert into posts (name, content) values(?, ?)', (name, content))

con.commit()

con.close()



def get_posts():

con = sql.connect(path.join(ROOT, 'database.db'))

cur = con.cursor()

cur.execute('select * from posts')

posts = cur.fetchall()

return posts



```



and finally my html page for the calendar :



```

<!doctype html>

<center>



<head style="color:green; font-family: 'Times New Roman', Times, serif;font-size: 400px;">

<link rel="stylesheet" href="styles.css">



<font size = "+100">Important Events Coming Up</font>

<title>EcoNet</title>

</head>

<br>

<br>

<br>



<br>

<table>

<tr>

<th>

<a href="/">Parent Blog</a>

</th>

<th>

<a href="meeting.html">Teachers to Parents</a>

</th>

</tr>



</table>



<table >

<thead>



<tr>



<td >Mon</td>

<td>Tue</td>

<td>Wed</td>

<td>Thu</td>

<td>Fri</td>

<td>Sat</td>

<td>Sun</td>



</tr>



</thead>



<tbody>



<tr>

<td >29</td>

<td >30</td>

<td >31</td>

<td>1</td>

<td>2</td>

<td>3</td>

<td>4</td>

</tr>



<tr>

<td>5</td>

<td>6</td>

<td>7</td>

<td>8</td>

<td>9</td>

<td>10</td>

<td>11</td>

</tr>



<tr>

<td>12</td>

<td>13</td>

<td>14</td>

<td>15</td>

<td>16</td>

<td>17</td>

<td ></td>

</tr>



<tr>

<td>19</td>

<td>20</td>

<td>21</td>

<td>22</td>

<td>23</td>

<td>24</td>

<td>25</td>

</tr>



<tr>

<td>26</td>

<td>27</td>

<td>28</td>

<td>29</td>

<td>30</td>

<td>31</td>

<td >1</td>

</tr>



</tbody>





<h1 style="color:teal; font-family: 'Times New Roman', Times, serif;"> Type Down Below To Remind Anyone of Where and When the Gathering Will Happen</h1>





<body style = "background-color:lightgreen;">

<form action='/calendar.html' method='post'>

<input placeholder='Name' name='name'>

<input placeholder='Post Content' name='post'>

<input type='submit' value='Submit'>

</form>

{% for post in posts %}

<div>

{{ post[1] + ': ' + post[2] }}

</div>

{% endfor %}

</body>

</center>

</html>

```



my html is not the best.



It would be great if you guys could help me. I've made another models.py with different variables and connected them to calendar.html/calendar.db but that hasn't work. I've done a lot of things and followed the same steps i got database.db to work but I can't figure it out.



Thank you
When I am hitting api code with a single request, the response is coming back in 1 second approximately. Thats fine. As I am using waitress wsgi server , my flask code is handling concurrent request but problem is coming on performance. Whenever more than one concurrent requests are hitting api code, response time is getting increased to 1.5 sec to 2 sec to so on depends upon how many concurrent requests are hitting the api. More the concurrent requests more the response time for all requests. Provided threaded concept is working fine and currently waitress has been configured with 50 threads.

```python
from flask import Flask, request, g, jsonify
from waitress import serve
import json
import time

app = Flask(name)

@app.before_request
def before_request():
    g.start = time.time()

@app.route('/', methods=['POST', 'GET'])
def home():
    data = json.loads(request.data.decode('utf-8'))
    #some statements
    result = es.search() #fetching some data from elasticsearch
    #some statements
    data['New_key'] = 'some value' #updating data
    data['New_key1'] = 'some value' #updating data
    return jsonify(data)

@app.after_request
    def after_request(response):
    diff = time.time() - g.start
    return response

@app.errorhandler(Exception)
def handle_exception(e):
    return response

if name == 'main':
    serve(app, host='0.0.0.0', port=5000)
```

################################################
### Environment

* Python version: 3.7
* Flask version: 1.1.2
* Waitress version: 1.4.4

Bumps [tox](https://github.com/tox-dev/tox) from 3.17.0 to 3.17.1.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/tox-dev/tox/blob/master/docs/changelog.rst">tox's changelog</a>.</em></p>
<blockquote>
<h1>v3.17.1 (2020-07-15)</h1>
<h2>Bugfixes</h2>
<ul>
<li>Fix tests when the <code>HOSTNAME</code> environment variable is set, but empty string - by hroncok <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1616">#1616</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/tox-dev/tox/commit/681a094c623738091be2f39b8175f52b04f9325f"><code>681a094</code></a> release 3.17.1</li>
<li><a href="https://github.com/tox-dev/tox/commit/7a65627e93a1c407f2614f9119b67ca8d42b9d70"><code>7a65627</code></a> Fix tests when HOSTNAME is set, but empty string (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1618">#1618</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/03bc09392fff7ebf99bfb792f02db494f8f0cb96"><code>03bc093</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1617">#1617</a> from tox-dev/release-3.17.0</li>
<li>See full diff in <a href="https://github.com/tox-dev/tox/compare/3.17.0...3.17.1">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=tox&package-manager=pip&previous-version=3.17.0&new-version=3.17.1)](https://dependabot.com/compatibility-score/?dependency-name=tox&package-manager=pip&previous-version=3.17.0&new-version=3.17.1)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [tox](https://github.com/tox-dev/tox) from 3.16.1 to 3.17.0.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/tox-dev/tox/blob/3.17.0/docs/changelog.rst">tox's changelog</a>.</em></p>
<blockquote>
<h1>v3.17.0 (2020-07-14)</h1>
<h2>Features</h2>
<ul>
<li>The long arguments <code>--verbose</code> and <code>--quiet</code> (rather than only their short forms, <code>-v</code> and <code>-q</code>) are now accepted. <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1612">#1612</a></li>
<li>The <code>ResultLog</code> now prefers <code>HOSTNAME</code> environment variable value (if set) over the full qualified domain name of localhost. This makes it possible to disable an undesired DNS lookup, which happened on all <code>tox</code> invocations, including trivial ones - by hroncok <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1615">#1615</a></li>
</ul>
<h2>Documentation</h2>
<ul>
<li>Update packaging information for Flit. <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1613">#1613</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/tox-dev/tox/commit/31e0bc669e949336432735189ea577649e7f457d"><code>31e0bc6</code></a> release 3.17.0</li>
<li><a href="https://github.com/tox-dev/tox/commit/cfe66fd0fe8a81bd65f79f589486b7721632a4cb"><code>cfe66fd</code></a> Use a HOSTNAME environment variable instead of socket.getfqdn() in ResultLog ...</li>
<li><a href="https://github.com/tox-dev/tox/commit/9e61b2d5ed78385c52d584adbe67fbeb44a11f34"><code>9e61b2d</code></a> Update recommended packaging information for Flit (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1613">#1613</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/7cd99dae4074466cef05608e3cd615f58a252962"><code>7cd99da</code></a> Add long --verbose/--quiet cli arguments (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1612">#1612</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/9e2cb4476c33ac93f09157d55a7ccc65e6497de4"><code>9e2cb44</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1610">#1610</a> from tox-dev/release-3.16.1</li>
<li>See full diff in <a href="https://github.com/tox-dev/tox/compare/3.16.1...3.17.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=tox&package-manager=pip&previous-version=3.16.1&new-version=3.17.0)](https://dependabot.com/compatibility-score/?dependency-name=tox&package-manager=pip&previous-version=3.16.1&new-version=3.17.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->
When running another flask project, the styling should be it's own, not the project's that's been run 1 time before.
```python
# Paste a minimal example that causes the problem.
```
I run this repo: https://github.com/delivey/xevis using `flask run`. (repo doesn't matter, but i've only encountered this bug with styling which uses CSS)
I go to the website, do something on it, etc.
I close the website by pressing `CTRL+C` in the terminal.
I close said terminal window.

I open another terminal window on which I run this project: https://github.com/delivey/schoolvid19 (again, repo doesn't matter)
I get some weird styling which is clearly not of this project, but the one I ran before, although images and text are of the current project.

### Actual Behavior
<!-- Tell us what happens instead. -->
I get styling from the project I ran before, but the text and images from the project I'm currently running.
```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version: 3.8.3
* Flask version: 1.1.2
* Werkzeug version: 0.16.0

### How to fix

It is possible to fix this error, simply by hitting CTRL+SHIFT+R, which reloads the browser cache, but getting this bug fixed would be nice

### Images


![expected_styling](https://user-images.githubusercontent.com/35540227/87248179-b1603c00-c460-11ea-85bc-4928823addbf.png)
![old_project_styling](https://user-images.githubusercontent.com/35540227/87248180-b4f3c300-c460-11ea-8823-c35b768f88d9.png)
![weird_styling_got_by_running_the_new_project](https://user-images.githubusercontent.com/35540227/87248181-b58c5980-c460-11ea-9922-40c4409481b2.png)



fixes #3628

Changed `make_response` to use `headers.update` instead of `headers.extend`.
Fixing some simple syntax in flashing patterns.

The examples in https://flask.palletsprojects.com/en/1.1.x/patterns/flashing/ are shown as:
`<ul class=flashes>`
but rather should be:
`<ul class="flashes">`

More examples of this throughout the page. Just fixing it up.

Also touching up some HTML by removing unnecessary p tag and swapping dl tags for input/label tags as they're better for screen readers and improve accessability.
I am having trouble storing dictionaries in `session`. I am setting session.modified to True, which sort of works; it seems to save to the cookie, and when I print session in the console, when I add an object to it, it does print the dict in the console, but when I refresh or go to another route, it will not be there in the python session, but the cookie is still there. (So I suppose the data in the browser's cookie is still there) Here is my code:
```
    if request.method == "POST":
        Quantity = int(request.form["Quantity"])

        if 'Cart' in session:
            session['Cart'][name] = {'name': name, 'quan': Quantity}
            session.modified = True
            print(session)
            print('cart found in python session dict')
        else:
            session['Cart'] = {name: {'name': name, 'quan': Quantity}}
            session.modified = True
            print(session)
```
#3680 
Small text adjustments.
i think adding a way to structure larger flask  apps using the flask cli would be useful.This would reduce the amount of time taken to set this up as currently this is sort of a repetitive task

### sample command
` flask init <app name> `
would create a directory with the app name and common blueprints for the app 
 

See #3579.
Bumps [sphinx](https://github.com/sphinx-doc/sphinx) from 3.1.1 to 3.1.2.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/sphinx-doc/sphinx/blob/3.x/CHANGES">sphinx's changelog</a>.</em></p>
<blockquote>
<h1>Release 3.1.2 (released Jul 05, 2020)</h1>
<h2>Incompatible changes</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7650">#7650</a>: autodoc: the signature of base function will be shown for decorated
functions, not a signature of decorator</li>
</ul>
<h2>Bugs fixed</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7844">#7844</a>: autodoc: Failed to detect module when relative module name given</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7856">#7856</a>: autodoc: AttributeError is raised when non-class object is given to
the autoclass directive</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7850">#7850</a>: autodoc: KeyError is raised for invalid mark up when autodoc_typehints
is 'description'</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7812">#7812</a>: autodoc: crashed if the target name matches to both an attribute and
module that are same name</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7650">#7650</a>: autodoc: function signature becomes <code>(*args, **kwargs)</code> if the
function is decorated by generic decorator</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7812">#7812</a>: autosummary: generates broken stub files if the target code contains
an attribute and module that are same name</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7806">#7806</a>: viewcode: Failed to resolve viewcode references on 3rd party builders</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7838">#7838</a>: html theme: List items have extra vertical space</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7878">#7878</a>: html theme: Undesired interaction between &quot;overflow&quot; and &quot;float&quot;</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/1cb5fa2f6a02ac4425e3db40c8c40bba7d831a9e"><code>1cb5fa2</code></a> Bump to 3.1.2 final</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/d83d5924eb66373e601bd24963ba46d1bfc50a45"><code>d83d592</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7878">#7878</a> from mgeier/float-clearing</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/c40cb79461da8b7b1322fb8ed69c0c16f0191e9f"><code>c40cb79</code></a> Update CHANGES for PR <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7878">#7878</a></li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/3098aba3431eb8c40ea052d6b8fc90328802c389"><code>3098aba</code></a> basic CSS: apply &quot;clearfix&quot; to admonitions etc.</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/045fc6807820ba1a1976799a237cc01cfc8403c8"><code>045fc68</code></a> basic CSS: remove overflow-x from admonition/topic, allow more &quot;floating&quot;</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/3e643735143be400462438fadfde494b8caf014d"><code>3e64373</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7916">#7916</a> from tk0miya/7650_signatures_for_decorator</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/9b74e6cd675937dc53745513167a8c93531374fe"><code>9b74e6c</code></a> autodoc: the signature of base function will be shown for decorated functions</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/cc4534d12fb875bc11d7b26f9a0553d42af4ad53"><code>cc4534d</code></a> Update CHANGES for PR <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7852">#7852</a></li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/2cc6264f2db6ba6c2e498a661ebcf88e820bc525"><code>2cc6264</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7852">#7852</a> from mgeier/basic-css-simple-lists</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/f743df6c20eb7895ff299fc8d8b43353f20d9116"><code>f743df6</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7914">#7914</a> from tk0miya/7812_autodoc_name_conflicts</li>
<li>Additional commits viewable in <a href="https://github.com/sphinx-doc/sphinx/compare/v3.1.1...v3.1.2">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=sphinx&package-manager=pip&previous-version=3.1.1&new-version=3.1.2)](https://dependabot.com/compatibility-score/?dependency-name=sphinx&package-manager=pip&previous-version=3.1.1&new-version=3.1.2)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [python-dotenv](https://github.com/theskumar/python-dotenv) from 0.13.0 to 0.14.0.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/theskumar/python-dotenv/blob/master/CHANGELOG.md">python-dotenv's changelog</a>.</em></p>
<blockquote>
<h2>[0.14.0] - 2020-07-03</h2>
<h3>Changed</h3>
<ul>
<li>Privilege definition in file over the environment in variable expansion (<a href="https://github-redirect.dependabot.com/theskumar/python-dotenv/issues/256">#256</a> by
[<a href="https://github.com/elbehery95">@elbehery95</a>]).</li>
</ul>
<h3>Fixed</h3>
<ul>
<li>Improve error message for when file isn't found (<a href="https://github-redirect.dependabot.com/theskumar/python-dotenv/issues/245">#245</a> by [<a href="https://github.com/snobu">@snobu</a>]).</li>
<li>Use HTTPS URL in package meta data (<a href="https://github-redirect.dependabot.com/theskumar/python-dotenv/issues/251">#251</a> by [<a href="https://github.com/ekohl">@ekohl</a>]).</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/theskumar/python-dotenv/commit/e4bbb8a2aa881409af6fb92933c18e2af6609da8"><code>e4bbb8a</code></a> Release v0.14.0</li>
<li><a href="https://github.com/theskumar/python-dotenv/commit/6712bc8a12db1e8d3f09b7bf7d3c25338992e422"><code>6712bc8</code></a> fix interpolation order</li>
<li><a href="https://github.com/theskumar/python-dotenv/commit/d83c1b65ceab5cf1223c41649a25a142755fe703"><code>d83c1b6</code></a> Refine Python version constraint in readme example</li>
<li><a href="https://github.com/theskumar/python-dotenv/commit/e92ab1f18087c2ca058203f36535c43a0f824d8a"><code>e92ab1f</code></a> Fix file not found message to have some context (<a href="https://github-redirect.dependabot.com/theskumar/python-dotenv/issues/245">#245</a>)</li>
<li><a href="https://github.com/theskumar/python-dotenv/commit/335dedc7d94bd69236c496ebb09e2de2b2da2dd7"><code>335dedc</code></a> Use https in setup.py's URL metadata (<a href="https://github-redirect.dependabot.com/theskumar/python-dotenv/issues/251">#251</a>)</li>
<li>See full diff in <a href="https://github.com/theskumar/python-dotenv/compare/v0.13.0...v0.14.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=python-dotenv&package-manager=pip&previous-version=0.13.0&new-version=0.14.0)](https://dependabot.com/compatibility-score/?dependency-name=python-dotenv&package-manager=pip&previous-version=0.13.0&new-version=0.14.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
A lot of people have confusion about the use case of blueprints in Flask. This is also based on the first-hand experience of introducing flask to a lot of developers. some random examples when you search on :
- [example 1](https://www.reddit.com/r/flask/comments/bp9j23/eli5_the_blueprint_concept_of_flask/)
- [example 2](https://www.reddit.com/r/flask/comments/bamhop/can_someone_better_explain_flask_blueprints_to_me/)
- [example 3](https://www.reddit.com/r/flask/comments/6nf9m1/af_blueprints_eli5/) 
- [example 4](https://www.reddit.com/r/flask/comments/d9rghe/i_dont_entirely_understand_the_purpose_of/)

**NOTE**: _I am happy and willing to do these changes/add examples myself, just wanted to know the views of others on this._

Afaik these confusions are from people who come straight to flask for web app development without having any prior experience. Even for such cases, we should try to be clear about what can/cannot be done by blueprints (including examples where possible)

1. The first point in the official doc tries to make the point of modularity but the wording might be a bit confusing.

>Factor an application into a set of blueprints. This is ideal for larger applications; a project could instantiate an application object, initialize several extensions, and register a collection of blueprints.

If we change this to (or anything else, the idea is just to make it clear):

_Factor an application into a set of related logical components to modularize the code. This is ideal for larger applications; a project could instantiate an application object and instead of stuffing every route/view on the main app object, which makes code hard to maintain/extend,  create and register a collection of blueprints on `app`._


2. Add an example for this:
>Register a blueprint on an application at a URL prefix and/or subdomain. Parameters in the URL prefix/subdomain become common view arguments (with defaults) across all view functions in the blueprint.

3. Make templating behaviour of blueprints(templating is where blueprint really shines) explicit with example. This is mentioned in the official doc but lacks an example so it is not easily understood by many.

>Register a blueprint multiple times on an application with different URL rules.

we may add some example like the one below to make it clear.

An application that is used for the online digital library should also provide access to books, authors, billings. As soon as the library blueprint is registered on the app, the app has access to all the features of the library under  different namespaces but with similar behaviours.
```

from flask import Blueprint

library = Blueprint("library", __name__)

@library.route("/books")
def book():
    return books()

@library.route("/authors")
def author():
    return authors()

@library.route("/payment")
def payment(year=None):
    # some payment  logic .....

app.register_blueprint(library, url_prefix="/space")
app.register_blueprint(library, url_prefix="/animal-kingdoms")
app.register_blueprint(library, url_prefix="/geography")

```
 
Added little bit clarification to quickstart.srt so that it'd be easy to understand for persons who don't have English as native language. 

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

 - the link should point to the flask's Request
 - longer description is unnecessary, as it's all explained above in flask.Request

A bit unsure on `:class:` correct usage here.
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
when I use post method, I want response of  `post method` as the route set,  But  I got an error of 405 method not allowed.

I add `decrators = ["post_requered"]`, It is fine.

But when I use the decorator myself, it goes wrong.

So,what should I  do  if  I want add some parameters in the decorators??

```python
from flask import Flask, request
from flask.views import MethodView

app = Flask(__name__)


def post_required(f):
    def decorator(*args, **kw):
        print(request.method)
        return f(*args, **kw)
    return decorator


class ProjectView(MethodView):

    def get(self):
        return "get method"

    def post(self):
        return "post method"


p_view = post_required(ProjectView.as_view("project"))
app.add_url_rule('/project', view_func=p_view)

if __name__ == '__main__':
    app.run(debug=True)


```

### Actual Behavior
```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<title>405 Method Not Allowed</title>
<h1>Method Not Allowed</h1>
<p>The method is not allowed for the requested URL.</p>
```


Bumps [pre-commit](https://github.com/pre-commit/pre-commit) from 2.5.1 to 2.6.0.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/releases">pre-commit's releases</a>.</em></p>
<blockquote>
<h2>pre-commit v2.6.0</h2>
<h3>Fixes</h3>
<ul>
<li>Fix node hooks when <code>NPM_CONFIG_USERCONFIG</code> is set
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1521">#1521</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1516">#1516</a> issue by <a href="https://github.com/rkm">@rkm</a>.</li>
</ul>
</li>
</ul>
<h3>Features</h3>
<ul>
<li>Skip <code>rbenv</code> / <code>ruby-download</code> if system ruby is available
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1509">#1509</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Partial support for ruby on windows (if system ruby is installed)
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1509">#1509</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/201">#201</a> issue by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/blob/master/CHANGELOG.md">pre-commit's changelog</a>.</em></p>
<blockquote>
<h1>2.6.0 - 2020-07-01</h1>
<h3>Fixes</h3>
<ul>
<li>Fix node hooks when <code>NPM_CONFIG_USERCONFIG</code> is set
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1521">#1521</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1516">#1516</a> issue by <a href="https://github.com/rkm">@rkm</a>.</li>
</ul>
</li>
</ul>
<h3>Features</h3>
<ul>
<li>Skip <code>rbenv</code> / <code>ruby-download</code> if system ruby is available
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1509">#1509</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
<li>Partial support for ruby on windows (if system ruby is installed)
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1509">#1509</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/201">#201</a> issue by <a href="https://github.com/asottile">@asottile</a>.</li>
</ul>
</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pre-commit/pre-commit/commit/6fe1702ee106f4d7f4a8ad73550db2145208ef24"><code>6fe1702</code></a> v2.6.0</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/e2fe94cbe75b79e48baf78660b3b26f4e19e2040"><code>e2fe94c</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1521">#1521</a> from pre-commit/npm_config_userconfig</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/6ec47ea73640190d86186fd50b7a32fa0a9c4b9b"><code>6ec47ea</code></a> fix node hooks when NPM_CONFIG_USERCONFIG is set</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/7d46852aa9fd48e0d1d359b29fb80421016d299b"><code>7d46852</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1518">#1518</a> from pre-commit/xfail_node_windows</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/1392471854f6a2bdf57bafd3b56c9da183fad331"><code>1392471</code></a> xfail a flaky node test on windows</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/a336a6b0b554d5b4335f3d420219154c8ad66c30"><code>a336a6b</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1506">#1506</a> from Pierre-Sassoulas/master</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/ecaf70128a65d30807a783e0917ae2b5063db7c2"><code>ecaf701</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1509">#1509</a> from pre-commit/system_language_version_ruby</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/e1e6a32c512275e4f7bf7a057bc5d4baa27303fa"><code>e1e6a32</code></a> skip rbenv if ruby and gem are installed with default language_version</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/fd53cdea17ed17a1775fc5e23e75d6ecdbdb04b6"><code>fd53cde</code></a> Add foor missing required dependencies in CONTRIBUTING.md</li>
<li>See full diff in <a href="https://github.com/pre-commit/pre-commit/compare/v2.5.1...v2.6.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pre-commit&package-manager=pip&previous-version=2.5.1&new-version=2.6.0)](https://dependabot.com/compatibility-score/?dependency-name=pre-commit&package-manager=pip&previous-version=2.5.1&new-version=2.6.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
This patch is a revision/addition to PR #3594 which addresses issue #3573. I fixed up grammar/spelling issues and organized the information for readability.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

This patch is a revision/addition to PR #3594 which addresses issue #3573. I fixed up grammar/spelling issues and organized the information for readability.
<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Bumps [tox](https://github.com/tox-dev/tox) from 3.16.0 to 3.16.1.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/tox-dev/tox/blob/master/docs/changelog.rst">tox's changelog</a>.</em></p>
<blockquote>
<h1>v3.16.1 (2020-06-29)</h1>
<h2>Bugfixes</h2>
<ul>
<li>Fixed the support for using <code>{temp_dir}</code> in <code>tox.ini</code> - by webknjaz <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1609">#1609</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/tox-dev/tox/commit/7219c0acafc90916e999afa8bf301382f9a65623"><code>7219c0a</code></a> release 3.16.1</li>
<li><a href="https://github.com/tox-dev/tox/commit/1b4c4e5d7f8f9eb22beb81904e3bfd4d5c741476"><code>1b4c4e5</code></a> 🐛 Register <code>{temp_dir}</code> as a valid substitution (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1609">#1609</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/6b742d074c86970c473b813dd38b255b15b63d6b"><code>6b742d0</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1607">#1607</a> from tox-dev/release-3.16.0</li>
<li>See full diff in <a href="https://github.com/tox-dev/tox/compare/3.16.0...3.16.1">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=tox&package-manager=pip&previous-version=3.16.0&new-version=3.16.1)](https://dependabot.com/compatibility-score/?dependency-name=tox&package-manager=pip&previous-version=3.16.0&new-version=3.16.1)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [tox](https://github.com/tox-dev/tox) from 3.15.2 to 3.16.0.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/tox-dev/tox/blob/master/docs/changelog.rst">tox's changelog</a>.</em></p>
<blockquote>
<h1>v3.16.0 (2020-06-26)</h1>
<h2>Features</h2>
<ul>
<li>
<p>Allow skipping the package and installation step when passing the <code>--skip-pkg-install</code>. This should be used in pair with the <code>--notest</code>, so you can separate environment setup and test run:</p>
<blockquote>
<pre lang="{.sourceCode" data-meta=".console}"><code>tox -e py --notest
tox -e py --skip-pkg-install
</code></pre>
</blockquote>
<p>by gaborbernat. <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1605">#1605</a></p>
</li>
</ul>
<h2>Miscellaneous</h2>
<ul>
<li>Improve config parsing performance by precompiling commonly used regular expressions - by brettlangdon <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1603">#1603</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/tox-dev/tox/commit/b86168b0849fd5fb1a9dba8832e73e3c9d976cbf"><code>b86168b</code></a> release 3.16.0</li>
<li><a href="https://github.com/tox-dev/tox/commit/7140ef800e123f69bae468013b34ddb7bfce01ed"><code>7140ef8</code></a> Allow true separation of environment setup and test run (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1606">#1606</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/9f49997a18a6431f359fb9c4d9f1ebe48ffd7bf6"><code>9f49997</code></a> Precompile common regular expressions (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1603">#1603</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/e320b1935149086dd5d02d4b4f09116c6829af8d"><code>e320b19</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1598">#1598</a> from tox-dev/release-3.15.2</li>
<li>See full diff in <a href="https://github.com/tox-dev/tox/compare/3.15.2...3.16.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=tox&package-manager=pip&previous-version=3.15.2&new-version=3.16.0)](https://dependabot.com/compatibility-score/?dependency-name=tox&package-manager=pip&previous-version=3.15.2&new-version=3.16.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
I am developing a **Flask** app on a Linux machine, which does correctly reload itself when I modify a Python source code file (when running in debug mode). Sometimes though I need to develop on a Windows machine, using WSL, but the very same Flask app sources. That basically works fine, however, under WSL the auto-reload feature does not seem to work any more. I can change the Python sources, but nothing happens - I need to manually shutdown and restart the Flask server.

Is this a known bug under WSL? Do I need to start the Flask application in a certain way?  
As reference, here is how I start the application under VS Code:

    "configurations": [
        {
            "name": "Run Server",
            "type": "python",
            "request": "launch",
            "module": "flask",
            "env": {
                "FLASK_APP": "run.py",
                "FLASK_ENV": "development",
            },
            "args": [
                "run"
            ],
        }
    ]

... which starts the the Flask appliacation under WSL with these output:

```
 * Serving Flask app "run.py" (lazy loading)
 * Environment: development
 * Debug mode: on
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with inotify reloader
 * Debugger is active!
 * Debugger PIN: 182-804-918
```

That output looks fine to me, but still no auto-reload.  
Any ideas?

### Environment
* Python version: 3.8.2 64-bit (from Ubuntu on WSL)
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

This pull request consolidates information from multiple error docs into one file so users can find everything in one place. As of right now, the extraneous docs are still there until my solution is approved. The only file significantly modified was errorhandling.rst. I also added a reference to blueprints.rst error handling section.

See #3573 

I plan to update the sections about blueprint error handling with better examples but wanted to submit this PR before tackling that part.
 
<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Hi,

it would be awesome to have the change log entries on PyPi / included in the long description, so one could see at first glance what has changed.

My use case:
When I check dependencies for new versions, I usually first go to pypi and search for the name.
Quite some projects have included the contents of the change log also in the long description, so it is visible at the PyPi page.

For Flask, I went to PyPi, did not find the change log.
Then I clicked on documentation, I did not find the change log.
Then I clicked on Homepage, no change log.
Then I went to the GitHub repo and here we go... 

As a nice example, let's have a look at `attrs`:
I go to PyPi, search for attrs - I get all the info I need (the latest change log), and a link to the full change log.

Thanks!
Describe what this patch does to fix the issue.

The configuragion documentation states that "While it is possible to set :data:`ENV` and :data:`DEBUG` in your config or code, this is strongly discouraged.` So, I believe using the `DEBUG` setting in the examples is misleading, as people are led to believe that that is needed to activate the debug mode. Indeed, basically every tutorial on Flask that you find around has the `DEBUG` variable in the configuration. I propose we get rid of all of them.


**about flask document! The Part Of Request**
_original text_
`Imagine the context being the handling thread. A request comes in and the web server decides to spawn a new thread (or something else, the underlying object is capable of dealing with concurrency systems other than threads). When Flask starts its internal request handling it figures out that the current thread is the active context and binds the current application and the WSGI environments to that context (thread). It does that in an intelligent way so that one application can invoke another application without breaking.`

i cant understand what mean the sentence is:
`It does that in an intelligent way so that one application can invoke another application without breaking.`

who can explain for me? thanks!
**about flask document! The Part Of Request**
_original text_
`Imagine the context being the handling thread. A request comes in and the web server decides to spawn a new thread (or something else, the underlying object is capable of dealing with concurrency systems other than threads). When Flask starts its internal request handling it figures out that the current thread is the active context and binds the current application and the WSGI environments to that context (thread). It does that in an intelligent way so that one application can invoke another application without breaking.`

i cant understand what mean the sentence is:
`It does that in an intelligent way so that one application can invoke another application without breaking.`

who can explain for me? thanks!
Examples should use app.response_class to encourage code that doesn't need to be changed should the response class be customized later on.
if X is not None == if X

if not X == if X is None
if X is not None == if X

if not X == if X is None
if X is not None == if X

if not X == if X is None

```python
   send_file returns part of a file to a client when running with gevent worker.  This is happening with python 2.7.17. Working well with Python 3. When removing gevent working and running with gthreads, there is no issue at all with the send_file.  See details below. 
   Flask stills return 200 regardless the error.

`            return send_file(output_file,
                             mimetype=mimetype,
                             attachment_filename=os.path.basename(output_file),
                             as_attachment=True)
`
```

### Actual Behavior
send_file() is returning a part of actual file content and causing networking error. 
In somehow, content of the file is cut off


```pytb
Server log error recorded 


[2020-06-17 13:37:27 +0000] [256] [ERROR] Socket error processing request.
Traceback (most recent call last):
  File "/opt/miniconda/lib/python2.7/site-packages/gunicorn/workers/base_async.py", line 66, in handle
    six.reraise(*sys.exc_info())
  File "/opt/miniconda/lib/python2.7/site-packages/gunicorn/workers/base_async.py", line 56, in handle
    self.handle_request(listener_name, req, client, addr)
  File "/opt/miniconda/lib/python2.7/site-packages/gunicorn/workers/ggevent.py", line 160, in handle_request
    addr)
  File "/opt/miniconda/lib/python2.7/site-packages/gunicorn/workers/base_async.py", line 129, in handle_request
    six.reraise(*sys.exc_info())
  File "/opt/miniconda/lib/python2.7/site-packages/gunicorn/workers/base_async.py", line 112, in handle_request
    resp.write_file(respiter)
  File "/opt/miniconda/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 403, in write_file
    if not self.sendfile(respiter):
  File "/opt/miniconda/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 393, in sendfile
    sent += sendfile(sockno, fileno, offset + sent, count)
  File "/opt/miniconda/lib/python2.7/site-packages/gunicorn/workers/ggevent.py", line 38, in _gevent_sendfile
    return o_sendfile(fdout, fdin, offset, nbytes)
  File "/opt/miniconda/lib/python2.7/site-packages/gunicorn/http/_sendfile.py", line 66, in sendfile
    raise OSError(e, os.strerror(e))
OSError: [Errno 0] Success
```

### Environment

* Python version: 2.7.17

* Gunicorn version: 19.9.0
* Geven version: 20.6.2
* Flask version: 1.1.1

* Werkzeug version: 1.0.1

Hi,

I'm trying to run scrapy in a Flask app on the Google AppEngine platform, but get a "ValueError: signal only works in main thread" message when setting up the crawler.

The app is set up:

````
@app.route("/")
def main():
     msg = link_checker.main()

if __name__ == "__main__":
    app.run(host="127.0.0.1", port=8080, debug=True, use_reloader=False)
````

In  link_checker.main(), I build a list of urls and pass them to another module::

````
from LinkScraper_script import linkscraper
def main():
    results, requests = linkscraper(urls_df)
````

where I try to set up the crawler:

````
from scrapy import signals
from scrapy.crawler import CrawlerProcess
from scrapy.utils.project import get_project_settings
from scrapy.signalmanager import dispatcher
import urllib.parse

SPIDER = 'linkchecker_spider'

def linkscraper(urls_df):
    settings = get_project_settings()
    crawler = CrawlerProcess(settings)
    
    crawler.crawl(SPIDER, target_urls=urls_df.original_url)
    crawler.start()
    
    return results, requests
````

But I get the error with the following traceback:

Traceback (most recent call last):
  File "/env/lib/python3.7/site-packages/flask/app.py", line 2446, in wsgi_app
    response = self.full_dispatch_request()
  File "/env/lib/python3.7/site-packages/flask/app.py", line 1951, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/env/lib/python3.7/site-packages/flask/app.py", line 1820, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/env/lib/python3.7/site-packages/flask/_compat.py", line 39, in reraise
    raise value
  File "/env/lib/python3.7/site-packages/flask/app.py", line 1949, in full_dispatch_request
    rv = self.dispatch_request()
  File "/env/lib/python3.7/site-packages/flask/app.py", line 1935, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/srv/main.py", line 60, in main
    cloud_run=cloud_run)
  File "/srv/link_checker.py", line 226, in main
    results, requests = linkscraper(urls_df)
  File "/srv/LinkScraper_script.py", line 57, in linkscraper
    crawler = CrawlerProcess(settings)
  File "/env/lib/python3.7/site-packages/scrapy/crawler.py", line 268, in __init__
    install_shutdown_handlers(self._signal_shutdown)
  File "/env/lib/python3.7/site-packages/scrapy/utils/ossignal.py", line 22, in install_shutdown_handlers
    reactor._handleSignals()
  File "/env/lib/python3.7/site-packages/twisted/internet/posixbase.py", line 295, in _handleSignals
    _SignalReactorMixin._handleSignals(self)
  File "/env/lib/python3.7/site-packages/twisted/internet/base.py", line 1244, in _handleSignals
    signal.signal(signal.SIGTERM, self.sigTerm)
  File "/opt/python3.7/lib/python3.7/signal.py", line 47, in signal
    handler = _signal.signal(_enum_to_int(signalnum), _enum_to_int(handler))
ValueError: signal only works in main thread

I was able to get this working running locally by rolling back to Flask version 0.12.5, but it still doesn't work on AppEngine (it didn't work at all running version 1.1.1 or 1.1.2). I'm running in Python version 3.7, with Scrapy version 1.7.3.
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->
I should be able to log out a username with ``session.pop('_usern')`` and display a "goodbye" message with flash.
```python
session.pop('_usern')
flash(u"Goodbye", 'info')
return redirect(url_for("index"))
```

### Actual Behavior
It does display the message, but it does not pop "_usern" from session.

### Environment

* Python version: 3.8
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

Add `html`, `head`, `body` tags.

Bumps [sphinx](https://github.com/sphinx-doc/sphinx) from 3.1.0 to 3.1.1.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/sphinx-doc/sphinx/blob/3.x/CHANGES">sphinx's changelog</a>.</em></p>
<blockquote>
<h1>Release 3.1.1 (released Jun 14, 2020)</h1>
<h2>Incompatible changes</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7808">#7808</a>: napoleon: a type for attribute are represented as typed field</li>
</ul>
<h2>Features added</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7807">#7807</a>: autodoc: Show detailed warning when type_comment is mismatched with its
signature</li>
</ul>
<h2>Bugs fixed</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7808">#7808</a>: autodoc: Warnings raised on variable and attribute type annotations</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7802">#7802</a>: autodoc: EOFError is raised on parallel build</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7821">#7821</a>: autodoc: TypeError is raised for overloaded C-ext function</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7805">#7805</a>: autodoc: an object which descriptors returns is unexpectedly documented</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7807">#7807</a>: autodoc: wrong signature is shown for the function using contextmanager</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7812">#7812</a>: autosummary: generates broken stub files if the target code contains
an attribute and module that are same name</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7808">#7808</a>: napoleon: Warnings raised on variable and attribute type annotations</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7811">#7811</a>: sphinx.util.inspect causes circular import problem</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/e7c2949a872c0654428c6bd1bea29659a65c684e"><code>e7c2949</code></a> Bump to 3.1.1 final</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/d2cec67670e9af139ce189f01e0a32f691ac7c30"><code>d2cec67</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7831">#7831</a> from tk0miya/7807_contextmanager</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/941e34051000d4d9b6623ba536b0987ad1b4dd49"><code>941e340</code></a> Merge branch '3.1.x' into 7807_contextmanager</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/b56772102e138b0a5d83f02e0031eb075c854921"><code>b567721</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7829">#7829</a> from tk0miya/7805_retval_of_descriptors</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/6c3db6d65a3912fd9b21497fdcc63c9630132912"><code>6c3db6d</code></a> Fix <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7805">#7805</a>: autodoc: an object which descriptors returns is documented</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/02acad66f09b5d14078ee17c2568d4d976d59a18"><code>02acad6</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7827">#7827</a> from tk0miya/7808_napoleon_nitpicky_warning</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/6eb43ba13873019aa656a6b2d5efeb5deb32d6fb"><code>6eb43ba</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7823">#7823</a> from tk0miya/7821_overload_builtin_function</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/d77622ba79a0ce8381b484ea4756d1f52b5f7803"><code>d77622b</code></a> Fix <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7807">#7807</a>: autodoc: wrong signature is shown for the function using contextma...</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/b3affa6949d3858312a28ff75a8161bfaf5db8ee"><code>b3affa6</code></a> Fix autodoc: Show detailed warning when type_comment is mismatched (refs: <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7807">#7807</a>)</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/e983189c942848033a52f0b92737f7f07ed6adbc"><code>e983189</code></a> Update CHANGES</li>
<li>Additional commits viewable in <a href="https://github.com/sphinx-doc/sphinx/compare/v3.1.0...v3.1.1">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=sphinx&package-manager=pip&previous-version=3.1.0&new-version=3.1.1)](https://dependabot.com/compatibility-score/?dependency-name=sphinx&package-manager=pip&previous-version=3.1.0&new-version=3.1.1)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
I have the following python flask api route:
```python
@user_api.route("/<int:id>", methods=["GET"])
@Authentication.auth_required
def get_user(id):
    """
    Get a user
    """
    print(f"User id: {id}")
    user = user_schema.dump(UserModel.get_user(id))
    if not user:
        print(f"User id: {id} not found!")
        return custom_response({"error": f"User {id} not found!"}, 400)
    return custom_response(user_schema.dump(user), 200)
```
`GET` from postman at `http://localhost:5555/api/v1/users/5` always ends up with:
```json
{
    "error": "User id not found!"
}
```
And the python console output shows:
```
User id: id
User id: id not found!
```
which means that the route variable ends up in the function as variable name but not value. This happens for both `int` and `string` variable types. This is bizarre.

```pytb
Paste the full traceback if there was an exception.
```

### Environment
Windows 10
```
C:\>flask --version
Python 3.8.3
Flask 1.1.2
Werkzeug 1.0.1
```
Bumps [pre-commit](https://github.com/pre-commit/pre-commit) from 2.5.0 to 2.5.1.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/releases">pre-commit's releases</a>.</em></p>
<blockquote>
<h2>pre-commit v2.5.1</h2>
<h3>Fixes</h3>
<ul>
<li>Prevent infinite recursion of post-checkout on clone
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1497">#1497</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1496">#1496</a> issue by <a href="https://github.com/admorgan">@admorgan</a>.</li>
</ul>
</li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/blob/master/CHANGELOG.md">pre-commit's changelog</a>.</em></p>
<blockquote>
<h1>2.5.1 - 2020-06-09</h1>
<h3>Fixes</h3>
<ul>
<li>Prevent infinite recursion of post-checkout on clone
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1497">#1497</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1496">#1496</a> issue by <a href="https://github.com/admorgan">@admorgan</a>.</li>
</ul>
</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pre-commit/pre-commit/commit/0e5eb199292d44107a591f8bf886874f18f0a304"><code>0e5eb19</code></a> v2.5.1</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/8ffcd386ae8fdfd235534de52697d07a6fb02b61"><code>8ffcd38</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1497">#1497</a> from pre-commit/no_recurse_clone</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/6ee9e13b2686f66c0e796947dfcb775201b1c3d6"><code>6ee9e13</code></a> prevent infinite recursion of post-checkout on clone</li>
<li>See full diff in <a href="https://github.com/pre-commit/pre-commit/compare/v2.5.0...v2.5.1">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pre-commit&package-manager=pip&previous-version=2.5.0&new-version=2.5.1)](https://dependabot.com/compatibility-score/?dependency-name=pre-commit&package-manager=pip&previous-version=2.5.0&new-version=2.5.1)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [pip-tools](https://github.com/jazzband/pip-tools) from 5.2.0 to 5.2.1.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/jazzband/pip-tools/releases">pip-tools's releases</a>.</em></p>
<blockquote>
<h2>5.2.1</h2>
<p>Bug Fixes:</p>
<ul>
<li>Fix a bug where <code>pip-compile</code> would lose some dependencies on update a <code>requirements.txt</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1159">1159</a>). Thanks <a href="https://github.com/richafrank">@richafrank</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/jazzband/pip-tools/blob/master/CHANGELOG.md">pip-tools's changelog</a>.</em></p>
<blockquote>
<h1>5.2.1 (2020-06-09)</h1>
<p>Bug Fixes:</p>
<ul>
<li>Fix a bug where <code>pip-compile</code> would lose some dependencies on update
a <code>requirements.txt</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1159">1159</a>). Thanks <a href="https://github.com/richafrank">@richafrank</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/jazzband/pip-tools/commit/a54027c120c8c13d07bf2c459b1743db80808e19"><code>a54027c</code></a> 5.2.1 changelog</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/0d053140f6fb7c074c6ca6498778ad5e2a05a453"><code>0d05314</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1159">#1159</a> from richafrank/recompile-drops-dependencies</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/1c65e5527c6916b1dc1fc21b5e2958ff4c24c241"><code>1c65e55</code></a> Local repository needs to notify proxied repo of ireq copying</li>
<li>See full diff in <a href="https://github.com/jazzband/pip-tools/compare/5.2.0...5.2.1">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pip-tools&package-manager=pip&previous-version=5.2.0&new-version=5.2.1)](https://dependabot.com/compatibility-score/?dependency-name=pip-tools&package-manager=pip&previous-version=5.2.0&new-version=5.2.1)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [pre-commit](https://github.com/pre-commit/pre-commit) from 2.4.0 to 2.5.0.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/releases">pre-commit's releases</a>.</em></p>
<blockquote>
<h2>pre-commit v2.5.0</h2>
<h3>Features</h3>
<ul>
<li>Expose a <code>PRE_COMMIT=1</code> environment variable when running hooks
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1467">#1467</a> PR by <a href="https://github.com/tech-chad">@tech-chad</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1426">#1426</a> issue by <a href="https://github.com/lorenzwalthert">@lorenzwalthert</a>.</li>
</ul>
</li>
</ul>
<h3>Fixes</h3>
<ul>
<li>Fix <code>UnicodeDecodeError</code> on windows when using the <code>py</code> launcher to detect executables with non-ascii characters in the path
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1474">#1474</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1472">#1472</a> issue by DrFobos.</li>
</ul>
</li>
<li>Fix <code>DeprecationWarning</code> on python3.9 for <code>random.shuffle</code> method
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1480">#1480</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1479">#1479</a> issue by <a href="https://github.com/isidentical">@isidentical</a>.</li>
</ul>
</li>
<li>Normalize slashes earlier such that global <code>files</code> / <code>exclude</code> use forward slashes on windows as well.
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1494">#1494</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1476">#1476</a> issue by <a href="https://github.com/harrybiddle">@harrybiddle</a>.</li>
</ul>
</li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pre-commit/pre-commit/blob/master/CHANGELOG.md">pre-commit's changelog</a>.</em></p>
<blockquote>
<h1>2.5.0 - 2020-06-08</h1>
<h3>Features</h3>
<ul>
<li>Expose a <code>PRE_COMMIT=1</code> environment variable when running hooks
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1467">#1467</a> PR by <a href="https://github.com/tech-chad">@tech-chad</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1426">#1426</a> issue by <a href="https://github.com/lorenzwalthert">@lorenzwalthert</a>.</li>
</ul>
</li>
</ul>
<h3>Fixes</h3>
<ul>
<li>Fix <code>UnicodeDecodeError</code> on windows when using the <code>py</code> launcher to detect
executables with non-ascii characters in the path
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1474">#1474</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1472">#1472</a> issue by DrFobos.</li>
</ul>
</li>
<li>Fix <code>DeprecationWarning</code> on python3.9 for <code>random.shuffle</code> method
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1480">#1480</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1479">#1479</a> issue by <a href="https://github.com/isidentical">@isidentical</a>.</li>
</ul>
</li>
<li>Normalize slashes earlier such that global <code>files</code> / <code>exclude</code> use forward
slashes on windows as well.
<ul>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1494">#1494</a> PR by <a href="https://github.com/asottile">@asottile</a>.</li>
<li><a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1476">#1476</a> issue by <a href="https://github.com/harrybiddle">@harrybiddle</a>.</li>
</ul>
</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pre-commit/pre-commit/commit/2f25085d60bf953fea457a3240c91886145dbcc5"><code>2f25085</code></a> v2.5.0</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/e69e3e04a1bf941c03b92d3eb252168f1ffe78c0"><code>e69e3e0</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1494">#1494</a> from pre-commit/normalize_slashes_more</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/5fb721f7a7415e5ba614710c6538caf30f7aed1c"><code>5fb721f</code></a> normalize slashes even earlier on windows for filenames</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/79359ed4e25370bd093c77e172933c5de6d81be3"><code>79359ed</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1480">#1480</a> from pre-commit/random_meth</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/e12082804220424cf35d8e6b62c26e2692945be8"><code>e120828</code></a> use the shuffle method of Random instead</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/d71699d7cdd02d54568209711934ad35c8e89dd7"><code>d71699d</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1474">#1474</a> from pre-commit/unicode_error_py_launcher</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/0781dac78f87729fbbe0eb830561da57d2183f58"><code>0781dac</code></a> avoid a UnicodeError on windows with non-charmap characters</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/42562a12eddfc164c63a8e986f09856abd930ebe"><code>42562a1</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1471">#1471</a> from pre-commit/all-repos_autofix_faster-tests</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/254c42864b124dc18c7e4f1b5e317a3e10a4f602"><code>254c428</code></a> slightly speed up tests by avoiding pre-commit install</li>
<li><a href="https://github.com/pre-commit/pre-commit/commit/ab63f9393fe841648a28927d4cc1968aa6e06527"><code>ab63f93</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pre-commit/pre-commit/issues/1467">#1467</a> from tech-chad/env_variable_pre-commit</li>
<li>Additional commits viewable in <a href="https://github.com/pre-commit/pre-commit/compare/v2.4.0...v2.5.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pre-commit&package-manager=pip&previous-version=2.4.0&new-version=2.5.0)](https://dependabot.com/compatibility-score/?dependency-name=pre-commit&package-manager=pip&previous-version=2.4.0&new-version=2.5.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Simplify and remove some redundant code from conftest.py from the tutorial.

This is better than what I proposed yesterday because the code is supposedly safer.
Bumps [sphinx](https://github.com/sphinx-doc/sphinx) from 3.0.4 to 3.1.0.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/sphinx-doc/sphinx/blob/3.x/CHANGES">sphinx's changelog</a>.</em></p>
<blockquote>
<h1>Release 3.1.0 (released Jun 08, 2020)</h1>
<h2>Dependencies</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7746">#7746</a>: mathjax: Update to 2.7.5</li>
</ul>
<h2>Incompatible changes</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7477">#7477</a>: imgconverter: Invoke &quot;magick convert&quot; command by default on Windows</li>
</ul>
<h2>Deprecated</h2>
<ul>
<li>The first argument for sphinx.ext.autosummary.generate.AutosummaryRenderer has
been changed to Sphinx object</li>
<li><code>sphinx.ext.autosummary.generate.AutosummaryRenderer</code> takes an object type
as an argument</li>
<li>The <code>ignore</code> argument of <code>sphinx.ext.autodoc.Documenter.get_doc()</code></li>
<li>The <code>template_dir</code> argument of <code>sphinx.ext.autosummary.generate. AutosummaryRenderer</code></li>
<li>The <code>module</code> argument of <code>sphinx.ext.autosummary.generate. find_autosummary_in_docstring()</code></li>
<li>The <code>builder</code> argument of <code>sphinx.ext.autosummary.generate. generate_autosummary_docs()</code></li>
<li>The <code>template_dir</code> argument of <code>sphinx.ext.autosummary.generate. generate_autosummary_docs()</code></li>
<li>The <code>ignore</code> argument of <code>sphinx.util.docstring.prepare_docstring()</code></li>
<li><code>sphinx.ext.autosummary.generate.AutosummaryRenderer.exists()</code></li>
<li><code>sphinx.util.rpartition()</code></li>
</ul>
<h2>Features added</h2>
<ul>
<li>LaTeX: Make the <code>toplevel_sectioning</code> setting optional in LaTeX theme</li>
<li>LaTeX: Allow to override papersize and pointsize from LaTeX themes</li>
<li>LaTeX: Add :confval:<code>latex_theme_options</code> to override theme options</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7410">#7410</a>: Allow to suppress &quot;circular toctree references detected&quot; warnings using
:confval:<code>suppress_warnings</code></li>
<li>C, added scope control directives, :rst:dir:<code>c:namespace</code>,
:rst:dir:<code>c:namespace-push</code>, and :rst:dir:<code>c:namespace-pop</code>.</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/2044">#2044</a>: autodoc: Suppress default value for instance attributes</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7473">#7473</a>: autodoc: consider a member public if docstring contains
<code>:meta public:</code> in info-field-list</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7487">#7487</a>: autodoc: Allow to generate docs for singledispatch functions by
py:autofunction</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7143">#7143</a>: autodoc: Support final classes and methods</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7384">#7384</a>: autodoc: Support signatures defined by <code>__new__()</code>, metaclasses and</li>
</ul>
</tr></table> ... (truncated)
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/62a9b324a2230d0c8dbfde579abd7ce4ec42d4fb"><code>62a9b32</code></a> Bump to 3.1.0 final</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/23a51a3a33f0003854e08424f8bf6dce2bcaf6b7"><code>23a51a3</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7797">#7797</a> from tk0miya/7791_TypeError_for_singledispatchfunction</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/d0cdf073bd36aaa050858df510455b145bc2c4bd"><code>d0cdf07</code></a> Update CHANGES for PR <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7657">#7657</a></li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/2ed20853ed6ab3783aeb1ac4d874e0e9a1357108"><code>2ed2085</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7657">#7657</a> from mgeier/css-margins</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/7fa47e4b1b184ddab8827651548cedd62415fbcb"><code>7fa47e4</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7788">#7788</a> from tk0miya/7722_support_typevar</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/bf89b1d101fd51fb5c7b76a9af016ddbd68ce2d6"><code>bf89b1d</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7794">#7794</a> from tk0miya/7792_setuptools_verbosity</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/588e5bd08c8ccf6c7cf496e93a18c01a704db5a8"><code>588e5bd</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7778">#7778</a> from tk0miya/7723_pdflatex_URL_having_singlequote</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/f98987b24ecff3c5d30ecb34ce0c8515132cde87"><code>f98987b</code></a> Fix <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7791">#7791</a>: autodoc: TypeError is raised on documenting singledispatch function</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/8bd5f8b214b25242487948931f8e9b9d1bcf9f98"><code>8bd5f8b</code></a> autodoc: Support TypeVar (refs: <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7722">#7722</a>)</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/6ccab6c1504cbc8fb29d31bf1900b8bbe9413589"><code>6ccab6c</code></a> Close <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7792">#7792</a>: setuptools: Support <code>--verbosity</code> option</li>
<li>Additional commits viewable in <a href="https://github.com/sphinx-doc/sphinx/compare/v3.0.4...v3.1.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=sphinx&package-manager=pip&previous-version=3.0.4&new-version=3.1.0)](https://dependabot.com/compatibility-score/?dependency-name=sphinx&package-manager=pip&previous-version=3.0.4&new-version=3.1.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
If all status checks pass Dependabot will automatically merge this pull request.

[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Bumps [tox](https://github.com/tox-dev/tox) from 3.15.1 to 3.15.2.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/tox-dev/tox/blob/master/docs/changelog.rst">tox's changelog</a>.</em></p>
<blockquote>
<h1>v3.15.2 (2020-06-06)</h1>
<h2>Bugfixes</h2>
<ul>
<li>Add an option to allow a process to suicide before sending the SIGTERM. - by jhesketh <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1497">#1497</a></li>
<li>PyPy 7.3.1 on Windows uses the <code>Script</code> folder instead of <code>bin</code>. - by gaborbernat <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1597">#1597</a></li>
</ul>
<h2>Miscellaneous</h2>
<ul>
<li>Allow to run the tests with pip 19.3.1 once again while preserving the ability to use pip 20.1 - by hroncok <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1594">#1594</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/tox-dev/tox/commit/d340d89e28ef212fecdbf81f2648fb4f5a4a238d"><code>d340d89</code></a> release 3.15.2</li>
<li><a href="https://github.com/tox-dev/tox/commit/121ef6ba07c0a8e6302e50aabca16c747f036fff"><code>121ef6b</code></a> PyPy 7.3.1 now generates Scripts instead of bin on Windows (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1597">#1597</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/63601760459251b18441c8f5a1887b465ad470c3"><code>6360176</code></a> Add option to delay propegating SIGINT to child process (<a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1588">#1588</a>)</li>
<li><a href="https://github.com/tox-dev/tox/commit/a421aeb75cc019cfc53bb8903d5e442f34bcc632"><code>a421aeb</code></a> Allow both pre- and post- PEP 610 outputs in test_venv_special_chars_issue252...</li>
<li><a href="https://github.com/tox-dev/tox/commit/dd0bb805b54c25be2e7f73f2c06b41aafa29de54"><code>dd0bb80</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/tox-dev/tox/issues/1587">#1587</a> from tox-dev/release-3.15.1</li>
<li>See full diff in <a href="https://github.com/tox-dev/tox/compare/3.15.1...3.15.2">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=tox&package-manager=pip&previous-version=3.15.1&new-version=3.15.2)](https://dependabot.com/compatibility-score/?dependency-name=tox&package-manager=pip&previous-version=3.15.1&new-version=3.15.2)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Describe what this patch does to fix the issue:

Fixes a type that was showing the rst for the code block instead of the actual code as a code block




I enabled Syntax Highlighting in logging.rst.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Bumps [greenlet](https://github.com/python-greenlet/greenlet) from 0.4.15 to 0.4.16.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/python-greenlet/greenlet/blob/master/NEWS">greenlet's changelog</a>.</em></p>
<blockquote>
<h1>0.4.16</h1>
<ul>
<li>Support for DEC Alpha architecture</li>
<li>Support for Python 3.9</li>
<li>Support for Python 3.10a0</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/python-greenlet/greenlet/commit/a389d7153b3aa7d5f7e694f82b4eb18c52559042"><code>a389d71</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/171">#171</a> from python-greenlet/release-0.4.16</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/c677d8860c37f6c418c55aaa8a21f4bdc7dfc377"><code>c677d88</code></a> Prepare to release greenlet 0.4.16</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/e1bc37edc13ba90948f86b9969a870287ec591f4"><code>e1bc37e</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/170">#170</a> from CyberSaxosTiGER/master</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/0ca7987d5ea2208030f6befb58c0aa8e8ac1d8fe"><code>0ca7987</code></a> delete unnecessary assigment</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/ed69827e3993a41c372e29006d6a62f32a2c3caa"><code>ed69827</code></a> supressing c2275 with declaring local variable 'refcnt' at the top</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/6f69cd4744e5d8bcd278b05b7a76b96e18902f4b"><code>6f69cd4</code></a> use macros against the naked fields</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/9b1d890e89b3a35d5aa514cb49932ce1744fd0f3"><code>9b1d890</code></a> fixing the name of defined macros</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/c43a915c3aaea8ba46a4fbf047d4997bc17c3e6d"><code>c43a915</code></a> Resolves <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/169">#169</a></li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/89c55243cca91566f8ff4db7371f93932fe5e976"><code>89c5524</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/python-greenlet/greenlet/issues/162">#162</a> from pkubaj/patch-1</li>
<li><a href="https://github.com/python-greenlet/greenlet/commit/77b74d7f3c00fd6db7f91dbcba57eb6a41b6f186"><code>77b74d7</code></a> Update version in appveyor.yml</li>
<li>Additional commits viewable in <a href="https://github.com/python-greenlet/greenlet/compare/0.4.15...0.4.16">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=greenlet&package-manager=pip&previous-version=0.4.15&new-version=0.4.16)](https://dependabot.com/compatibility-score/?dependency-name=greenlet&package-manager=pip&previous-version=0.4.15&new-version=0.4.16)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
How to solve this? 

```
-----> python3 app.py
<IPython.core.display.HTML object>
 * Serving Flask app "app" (lazy loading)
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: on
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
<IPython.core.display.HTML object>
 * Debugger is active!
 * Debugger PIN: 196-353-876
2020-06-04 22:45:33.659 python3[6943:97426] WARNING: NSWindow drag regions should only be invalidated on the Main Thread! This will throw an exception in the future. Called from (
	0   AppKit                              0x00007fff32a03289 -[NSWindow(NSWindow_Theme) _postWindowNeedsToResetDragMarginsUnlessPostingDisabled] + 371
	1   AppKit                              0x00007fff329eacb2 -[NSWindow _initContent:styleMask:backing:defer:contentView:] + 1416
	2   AppKit                              0x00007fff329ea723 -[NSWindow initWithContentRect:styleMask:backing:defer:] + 42
	3   _macosx.cpython-37m-darwin.so       0x000000011167c6de -[Window initWithContentRect:styleMask:backing:defer:withManager:] + 94
	4   _macosx.cpython-37m-darwin.so       0x000000011167fe25 FigureManager_init + 341
	5   python3                             0x0000000106c825ac wrap_init + 12
	6   python3                             0x0000000106c0c55e wrapperdescr_call + 254
	7   python3                             0x0000000106c00ae3 _PyObject_FastCallKeywords + 179
	8   python3                             0x0000000106d3ded5 call_function + 453
	9   python3                             0x0000000106d3baec _PyEval_EvalFrameDefault + 46092
	10  python3                             0x0000000106c008d5 function_code_fastcall + 117
	11  python3                             0x0000000106c82381 slot_tp_init + 193
	12  python3                             0x0000000106c8c361 type_call + 241
	13  python3                             0x0000000106c00ae3 _PyObject_FastCallKeywords + 179
	14  python3                             0x0000000106d3ded5 call_function + 453
	15  python3                             0x0000000106d3baec _PyEval_EvalFrameDefault + 46092
	16  python3                             0x0000000106c008d5 function_code_fastcall + 117
	17  python3                             0x0000000106d3ddc7 call_function + 183
	18  python3                             0x0000000106d3baec _PyEval_EvalFrameDefault + 46092
	19  python3                             0x0000000106d2f49e _PyEval_EvalCodeWithName + 414
	20  python3                             0x0000000106bffde7 _PyFunction_FastCallDict + 231
	21  python3                             0x0000000106c03ce2 method_call + 130
	22  python3                             0x0000000106c01752 PyObject_Call + 130
	23  python3                             0x0000000106d3bd58 _PyEval_EvalFrameDefault + 46712
	24  python3                             0x0000000106d2f49e _PyEval_EvalCodeWithName + 414
	25  python3                             0x0000000106c00fe3 _PyFunction_FastCallKeywords + 195
	26  python3                             0x0000000106d3ddc7 call_function + 183
	27  python3                             0x0000000106d3bb27 _PyEval_EvalFrameDefault + 46151
	28  python3                             0x0000000106c008d5 function_code_fastcall + 117
	29  python3                             0x0000000106d3ddc7 call_function + 183
	30  python3                             0x0000000106d3baec _PyEval_EvalFrameDefault + 46092
	31  python3                             0x0000000106d2f49e _PyEval_EvalCodeWithName + 414
	32  python3                             0x0000000106c00fe3 _PyFunction_FastCallKeywords + 195
	33  python3                             0x0000000106d3ddc7 call_function + 183
	34  python3                             0x0000000106d3bbe0 _PyEval_EvalFrameDefault + 46336
	35  python3                             0x0000000106c008d5 function_code_fastcall + 117
	36  python3                             0x0000000106d3ddc7 call_function + 183
	37  python3                             0x0000000106d3bb27 _PyEval_EvalFrameDefault + 46151
	38  python3                             0x0000000106c008d5 function_code_fastcall + 117
	39  python3                             0x0000000106d3bd58 _PyEval_EvalFrameDefault + 46712
	40  python3                             0x0000000106c008d5 function_code_fastcall + 117
	41  python3                             0x0000000106d3ddc7 call_function + 183
	42  python3                             0x0000000106d3ba56 _PyEval_EvalFrameDefault + 45942
	43  python3                             0x0000000106c008d5 function_code_fastcall + 117
	44  python3                             0x0000000106d3ddc7 call_function + 183
	45  python3                             0x0000000106d3ba56 _PyEval_EvalFrameDefault + 45942
	46  python3                             0x0000000106c008d5 function_code_fastcall + 117
	47  python3                             0x0000000106d3ddc7 call_function + 183
	48  python3                             0x0000000106d3ba56 _PyEval_EvalFrameDefault + 45942
	49  python3                             0x0000000106c008d5 function_code_fastcall + 117
	50  python3                             0x0000000106c8046d slot_tp_call + 189
	51  python3                             0x0000000106c00ae3 _PyObject_FastCallKeywords + 179
	52  python3                             0x0000000106d3ded5 call_function + 453
	53  python3                             0x0000000106d3baec _PyEval_EvalFrameDefault + 46092
	54  python3                             0x0000000106c19e49 gen_send_ex + 169
	55  python3                             0x0000000106d3ac83 _PyEval_EvalFrameDefault + 42403
	56  python3                             0x0000000106d2f49e _PyEval_EvalCodeWithName + 414
	57  python3                             0x0000000106c00fe3 _PyFunction_FastCallKeywords + 195
	58  python3                             0x0000000106d3ddc7 call_function + 183
	59  python3                             0x0000000106d3bb27 _PyEval_EvalFrameDefault + 46151
	60  python3                             0x0000000106d2f49e _PyEval_EvalCodeWithName + 414
	61  python3                             0x0000000106c00fe3 _PyFunction_FastCallKeywords + 195
	62  python3                             0x0000000106d3ddc7 call_function + 183
	63  python3                             0x0000000106d3ba56 _PyEval_EvalFrameDefault + 45942
	64  python3                             0x0000000106c008d5 function_code_fastcall + 117
	65  python3                             0x0000000106d3ddc7 call_function + 183
	66  python3                             0x0000000106d3ba56 _PyEval_EvalFrameDefault + 45942
	67  python3                             0x0000000106c008d5 function_code_fastcall + 117
	68  python3                             0x0000000106d3ddc7 call_function + 183
	69  python3                             0x0000000106d3baec _PyEval_EvalFrameDefault + 46092
	70  python3                             0x0000000106c008d5 function_code_fastcall + 117
	71  python3                             0x0000000106d3ddc7 call_function + 183
	72  python3                             0x0000000106d3ba56 _PyEval_EvalFrameDefault + 45942
	73  python3                             0x0000000106c008d5 function_code_fastcall + 117
	74  python3                             0x0000000106c82381 slot_tp_init + 193
	75  python3                             0x0000000106c8c361 type_call + 241
	76  python3                             0x0000000106c00ae3 _PyObject_FastCallKeywords + 179
	77  python3                             0x0000000106d3ded5 call_function + 453
	78  python3                             0x0000000106d3baec _PyEval_EvalFrameDefault + 46092
	79  python3                             0x0000000106c008d5 function_code_fastcall + 117
	80  python3                             0x0000000106d3ddc7 call_function + 183
	81  python3                             0x0000000106d3ba56 _PyEval_EvalFrameDefault + 45942
	82  python3                             0x0000000106c008d5 function_code_fastcall + 117
	83  python3                             0x0000000106c03ce2 method_call + 130
	84  python3                             0x0000000106c01752 PyObject_Call + 130
	85  python3                             0x0000000106d3bd58 _PyEval_EvalFrameDefault + 46712
	86  python3                             0x0000000106c008d5 function_code_fastcall + 117
	87  python3                             0x0000000106d3ddc7 call_function + 183
	88  python3                             0x0000000106d3ba56 _PyEval_EvalFrameDefault + 45942
	89  python3                             0x0000000106c008d5 function_code_fastcall + 117
	90  python3                             0x0000000106d3ddc7 call_function + 183
	91  python3                             0x0000000106d3ba56 _PyEval_EvalFrameDefault + 45942
	92  python3                             0x0000000106c008d5 function_code_fastcall + 117
	93  python3                             0x0000000106c03ce2 method_call + 130
	94  python3                             0x0000000106c01752 PyObject_Call + 130
	95  python3                             0x0000000106e1f8cb t_bootstrap + 123
	96  python3                             0x0000000106da6707 pythread_wrapper + 39
	97  libsystem_pthread.dylib             0x00007fff6f8a3109 _pthread_start + 148
	98  libsystem_pthread.dylib             0x00007fff6f89eb8b thread_start + 15
)
    
```
### Issue Description
When uploading a file from Postman, if the file name contains non-ascii characters, a double quote will be appended at the end of it. Such issue doesn't happen if the file is uploaded from a web-form or using a CLI tool.

![image](https://user-images.githubusercontent.com/1902587/83736584-0fd51600-a67c-11ea-90e0-a800a7ced5c9.png)

Ref: https://github.com/postmanlabs/postman-app-support/issues/8537

### Expected Behavior
File name will remain unchanged (red circle) as when I uploaded it from a web-form, or using a CLI tool (cURL, httpie)

### Actual Behavior
A double quote symbol got appended to the file name (blue circle).

### Source code
```python
from flask import Flask, request

app = Flask(__name__)


@app.route("/", methods=["POST"])
def upload_file():
    print("request.files:", request.files)
    return ""


if __name__ == "__main__":
    app.run(host="0.0.0.0", port=4444)
```

### Environment

* Python version: 3.6, 3.7 and 3.8
* Flask version: 1.1.2
* Werkzeug version: 1.0.1
I am unable to patch flask.g in python 3.8.  It works fine in 3.7.7.  The python developers are suggesting this is a flask issue, not a mock.patch issue.  In this sample, I expect the first test to pass and the second to fail. They both fail but with different stacktraces.

```
from unittest.mock import patch

import flask

def some_function():
    flask.g.somevariable = True
    return flask.g.somevariable

@patch('flask.g')
def test_patch(mock_flask_global):
    assert some_function()

def test_no_patch():
    assert some_function()
```


```
$ pytest -vv temp_test.py 
============================================================================================================ test session starts =============================================================================================================
platform linux -- Python 3.8.3, pytest-5.4.3, py-1.8.1, pluggy-0.13.1 -- 
collected 2 items                                                                                                                                                                                                                            

temp_test.py::test_patch FAILED                                                                                                                                                                                                        [ 50%]
temp_test.py::test_no_patch FAILED                                                                                                                                                                                                     [100%]

================================================================================================================== FAILURES ==================================================================================================================
_________________________________________________________________________________________________________________ test_patch _________________________________________________________________________________________________________________

args = (), keywargs = {}

    @wraps(func)
    def patched(*args, **keywargs):
>       with self.decoration_helper(patched,
                                    args,
                                    keywargs) as (newargs, newkeywargs):

../../../.pyenv/versions/3.8.3/lib/python3.8/unittest/mock.py:1322: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../.pyenv/versions/3.8.3/lib/python3.8/contextlib.py:113: in __enter__
    return next(self.gen)
../../../.pyenv/versions/3.8.3/lib/python3.8/unittest/mock.py:1304: in decoration_helper
    arg = exit_stack.enter_context(patching)
../../../.pyenv/versions/3.8.3/lib/python3.8/contextlib.py:425: in enter_context
    result = _cm_type.__enter__(cm)
../../../.pyenv/versions/3.8.3/lib/python3.8/unittest/mock.py:1416: in __enter__
    if spec is None and _is_async_obj(original):
../../../.pyenv/versions/3.8.3/lib/python3.8/unittest/mock.py:51: in _is_async_obj
    if hasattr(obj, '__func__'):
pyvenv/lib/python3.8/site-packages/werkzeug/local.py:347: in __getattr__
    return getattr(self._get_current_object(), name)
pyvenv/lib/python3.8/site-packages/werkzeug/local.py:306: in _get_current_object
    return self.__local()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

name = 'g'

    def _lookup_app_object(name):
        top = _app_ctx_stack.top
        if top is None:
>           raise RuntimeError(_app_ctx_err_msg)
E           RuntimeError: Working outside of application context.
E           
E           This typically means that you attempted to use functionality that needed
E           to interface with the current application object in some way. To solve
E           this, set up an application context with app.app_context().  See the
E           documentation for more information.

pyvenv/lib/python3.8/site-packages/flask/globals.py:45: RuntimeError
_______________________________________________________________________________________________________________ test_no_patch ________________________________________________________________________________________________________________

    def test_no_patch():
>       assert some_function()

temp_test.py:14: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
temp_test.py:6: in some_function
    flask.g.somevariable = True
pyvenv/lib/python3.8/site-packages/werkzeug/local.py:364: in <lambda>
    __setattr__ = lambda x, n, v: setattr(x._get_current_object(), n, v)
pyvenv/lib/python3.8/site-packages/werkzeug/local.py:306: in _get_current_object
    return self.__local()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

name = 'g'

    def _lookup_app_object(name):
        top = _app_ctx_stack.top
        if top is None:
>           raise RuntimeError(_app_ctx_err_msg)
E           RuntimeError: Working outside of application context.
E           
E           This typically means that you attempted to use functionality that needed
E           to interface with the current application object in some way. To solve
E           this, set up an application context with app.app_context().  See the
E           documentation for more information.

pyvenv/lib/python3.8/site-packages/flask/globals.py:45: RuntimeError
```

### Environment

* Python version: 3.8.3
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

Bumps [pytest](https://github.com/pytest-dev/pytest) from 5.4.2 to 5.4.3.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/releases">pytest's releases</a>.</em></p>
<blockquote>
<h2>5.4.3</h2>
<h1>pytest 5.4.3 (2020-06-02)</h1>
<h2>Bug Fixes</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/6428">#6428</a>: Paths appearing in error messages are now correct in case the current working directory has
changed since the start of the session.</li>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/6755">#6755</a>: Support deleting paths longer than 260 characters on windows created inside tmpdir.</li>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/6956">#6956</a>: Prevent pytest from printing ConftestImportFailure traceback to stdout.</li>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7150">#7150</a>: Prevent hiding the underlying exception when <code>ConfTestImportFailure</code> is raised.</li>
<li><a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7215">#7215</a>: Fix regression where running with <code>--pdb</code> would call the <code>tearDown</code> methods of <code>unittest.TestCase</code>
subclasses for skipped tests.</li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/pytest-dev/pytest/blob/master/CHANGELOG.rst">pytest's changelog</a>.</em></p>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/pytest-dev/pytest/commit/b322004047774f4b0992bfc8b9b1123069a6d0f1"><code>b322004</code></a> Preparing release version 5.4.3</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/2d795dc07be8015522133eff2fd7d5603eb29388"><code>2d795dc</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7298">#7298</a> from nicoddemus/backport-6755</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/2d6b846978f4a4c0e903646c2a549d215036608b"><code>2d6b846</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7299">#7299</a> from nicoddemus/backport-7294</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/703d0f50d8bc19e3d52313a28d349a2240c97184"><code>703d0f5</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7294">#7294</a> from nicoddemus/codecov-adjustments</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/56e64824053abea9299b8ecd306ef02fe13a31e9"><code>56e6482</code></a> Fix removal of very long paths on Windows (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/6755">#6755</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/589176e9fededd5976809be934ce770ee99dd2a1"><code>589176e</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7285">#7285</a> from nicoddemus/backport-7220</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/3734a2773379f95ddf04b22a463950acb589b6eb"><code>3734a27</code></a> [5.4] Do not call TestCase.tearDown for skipped tests (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7236">#7236</a>) (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7283">#7283</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/e1a21e46b00959b8831b195c524bbf504e458bec"><code>e1a21e4</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7220">#7220</a> from nicoddemus/issue-6428</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/551400e8d6f20bddde19a29be3545bb8109a4f13"><code>551400e</code></a> Do not call TestCase.tearDown for skipped tests (<a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7236">#7236</a>)</li>
<li><a href="https://github.com/pytest-dev/pytest/commit/b7b729298cb780b3468e3a0580a27ce62b6e818a"><code>b7b7292</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/pytest-dev/pytest/issues/7271">#7271</a> from asottile/backport-7257</li>
<li>Additional commits viewable in <a href="https://github.com/pytest-dev/pytest/compare/5.4.2...5.4.3">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pytest&package-manager=pip&previous-version=5.4.2&new-version=5.4.3)](https://dependabot.com/compatibility-score/?dependency-name=pytest&package-manager=pip&previous-version=5.4.2&new-version=5.4.3)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Automerge options (never/patch/minor, and dev/runtime dependencies)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
Getting the following error when running **flask run** command

```
(venev) C:\Users\eugen\Documents\development\flask_api>flask run

 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
Traceback (most recent call last):
  File "C:\Users\eugen\AppData\Local\Programs\Python\Python38\lib\runpy.py", line 194, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "C:\Users\eugen\AppData\Local\Programs\Python\Python38\lib\runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "C:\Users\eugen\Documents\development\flask_api\venev\Scripts\flask.exe\__main__.py", line 9, in <module>
  File "c:\users\eugen\documents\development\flask_api\venev\lib\site-packages\flask\cli.py", line 967, in main
    cli.main(args=sys.argv[1:], prog_name="python -m flask" if as_module else None)
  File "c:\users\eugen\documents\development\flask_api\venev\lib\site-packages\flask\cli.py", line 586, in main
    return super(FlaskGroup, self).main(*args, **kwargs)
  File "c:\users\eugen\documents\development\flask_api\venev\lib\site-packages\click\core.py", line 782, in main
    rv = self.invoke(ctx)
  File "c:\users\eugen\documents\development\flask_api\venev\lib\site-packages\click\core.py", line 1259, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "c:\users\eugen\documents\development\flask_api\venev\lib\site-packages\click\core.py", line 1066, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "c:\users\eugen\documents\development\flask_api\venev\lib\site-packages\click\core.py", line 610, in invoke
    return callback(*args, **kwargs)
  File "c:\users\eugen\documents\development\flask_api\venev\lib\site-packages\click\decorators.py", line 73, in new_func
    return ctx.invoke(f, obj, *args, **kwargs)
  File "c:\users\eugen\documents\development\flask_api\venev\lib\site-packages\click\core.py", line 610, in invoke
    return callback(*args, **kwargs)
  File "c:\users\eugen\documents\development\flask_api\venev\lib\site-packages\flask\cli.py", line 848, in run_command
    app = DispatchingApp(info.load_app, use_eager_loading=eager_loading)
  File "c:\users\eugen\documents\development\flask_api\venev\lib\site-packages\flask\cli.py", line 305, in __init__
    self._load_unlocked()
  File "c:\users\eugen\documents\development\flask_api\venev\lib\site-packages\flask\cli.py", line 330, in _load_unlocked
    self._app = rv = self.loader()
  File "c:\users\eugen\documents\development\flask_api\venev\lib\site-packages\flask\cli.py", line 392, in load_app
    app = locate_app(self, import_name, None, raise_if_not_found=False)
  File "c:\users\eugen\documents\development\flask_api\venev\lib\site-packages\flask\cli.py", line 240, in locate_app
    __import__(module_name)
ValueError: source code string cannot contain null bytes

```

I have used all the ways to configure this script in the startup of a Raspberry Pi without getting it to run in the background. [All these](https://www.dexterindustries.com/howto/run-a-program-on-your-raspberry-pi-at-startup/)

### Expected Behavior
After startup, the RPi not run the script as a process without showing any log even if I add
">/home/pi/Desktop/log.txt 2>&1" 

```python
from flask import Flask, request
app = Flask(__name__)
#app.run(debug=True)
@app.route('/post', methods = ["POST"])
def post():
    data = request.data
    print('Data Received: "{data}"'.format(data=data))
    return "Request Processed.\n"
app.run(host='0.0.0.0', port= 8090)
```
e.g. using rc.local:

```bash
#!/bin/sh -e
#
# rc.local
#
# Start scanning control program
python /home/pi/m_crowdstreet_sensor.py &
exit 0
```

### Actual Behavior
<!-- Tell us what happens instead. -->

```bash
pi@people-scanner:~ $ ps -ef|grep python
pi         729   658  0 18:38 pts/0    00:00:00 grep --color=auto python
```

### Environment

* Python version: 2.7.16
* Flask version: 1.1.2
* Werkzeug version: ¿?

Closes https://github.com/pallets/flask/issues/3612

Adds a section on copy and pasting security.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
Quoted arguments should be parsed as a single argument. (The reason this is being posted here is because the code sample following works in a plain Python script and in the interactive shell, but fails when run in the context of a Flask application. This is just plain Python code that utilizes a standard library function, but its behavior changes inside of a Flask application.

```python
# Paste a minimal example that causes the problem.
args = shlex.parse('This is "Star Trek"')
```

```sh
['This', 'is', 'Star Trek']
```

### Actual Behavior
Quoted argument is parsed as two (or more) arguments.

```sh
['This', 'is', '"Star', 'Trek"']
```

### Environment

* Python version: 3.8
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

I have the following code snippet in my main.py:
```
import os
from app import create_app
from models import db, bcrypt
if __name__ == '__main__':
    HOST = os.environ.get('SERVER_HOST', 'localhost')
    try:
        PORT = int(os.environ.get('SERVER_PORT', '5555'))
    except ValueError:
        PORT = 5555
    env_name = os.getenv('FLASK_ENV', "Please set FLASK_ENV")
    print("env_name: ", env_name)
    app = create_app(env_name)
```
I run it using `flask run` inside `pipenv shell` and bump into the following error in the line which prints out the `env_name`. I have tried both `set FLASK_ENV=development` (Windows 10) and using `.env` but to no avail. I use python-3.8.3
```
(src-4Nvvrxp5) C:\Projects\Python\PythonFlaskRestAPI\src>flask run
 * Serving Flask app "main.py" (lazy loading)
 * Environment: development
 * Debug mode: on
 * Restarting with stat
env_name: <flask.cli.ScriptInfo object at 0x000002D6BA598940>
 * Debugger is active!
 * Debugger PIN: 269-678-937
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
```
Any advice and insight is appreciated.
### Expected Behavior
```
C:\Projects\Python\PythonFlaskRestAPI\src>python
Python 3.8.2 (tags/v3.8.2:7b3ab59, Feb 25 2020, 22:45:29) [MSC v.1916 32 bit (Intel)] on win32
Type "help", "copyright", "credits" or "license" for more information.
>>> import os
>>> env_name = os.getenv("FLASK_ENV")
>>> print(env_name)
development
>>>

C:\Projects\Python\PythonFlaskRestAPI\src>flask --version
Python 3.8.2
Flask 1.1.2
Werkzeug 1.0.1
```

```python
# Paste a minimal example that causes the problem.
```

### Actual Behavior
<!-- Tell us what happens instead. -->

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version: 3.8.2
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

### Expected Behavior
<!-- Tell us what should happen. -->
Streaming less memory
```python
def download_file():
    r = requests.get("http://127.0.0.1:18080/tar/pycharm-community-2019.3.1.dmg",stream=True)
    return Response(stream_with_context(r.iter_content(1024)), content_type=r.headers.get("content-type"))

```

### Actual Behavior
Use stream_with_context to forward a request for a nginx static resource,
stream_with_context uses the same memory as the file size

### Environment

* Python version: 3.6
* Flask version: 1.0.4
* Werkzeug version:  0.15.5

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior

```
from flask import Flask
app = Flask(__name__)
@app.route('/')
def issue():
    return {'test': 'test'}, {'Content-Type': 'test'}
```
Using `curl -v http://127.0.0.1:5000/` to query the view I expect only one `Content-Type` header > `Content-Type: test`

### Actual Behavior

Duplicate headers are returned

```
< Content-Type: application/json
< Content-Type: test
```

### Environment

* Python version: 3.8.2
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

### Context

This issue also effects responses created with make_response when using a dict or jsonify body + the headers argument with a 'Content-Type':

```
from flask import Flask, make_response
app = Flask(__name__)
@app.route('/')
def issue():
    return make_response({'test': 'test'}, {'Content-Type': 'test'})
```

This issue is caused by jsonify adding a 'Content-Type' header then make_response uses `extent` to add the additional headers, thus leading to the duplicate.

Returning a str/bytes body does not have this problem as no 'Content-Type' is added by flask, if one is missing it is added by werkzeug.

The reason I came across this issue is we have older code which does `return json.dumps(data), 200, {'Content-Type': 'application/json+somecustomtype'}` and I assumed based on the flask docs that just returning the data and letting flask do the jsonify would be better.


Bumps [pip-tools](https://github.com/jazzband/pip-tools) from 5.1.2 to 5.2.0.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/jazzband/pip-tools/releases">pip-tools's releases</a>.</em></p>
<blockquote>
<h2>5.2.0</h2>
<p>Features:</p>
<ul>
<li>Show basename of URLs when <code>pip-compile</code> generates hashes in a verbose mode (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1113">1113</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a></li>
<li>Add <code>--emit-index-url/--no-emit-index-url</code> options to <code>pip-compile</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1130">1130</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a></li>
</ul>
<p>Bug Fixes:</p>
<ul>
<li>Fix a bug where <code>pip-compile</code> would ignore some of package versions when <code>PIP_PREFER_BINARY</code> is set on
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1119">1119</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a></li>
<li>Fix leaked URLs with credentials in the debug output of <code>pip-compile</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1146">1146</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a></li>
<li>Fix a bug where URL requirements would have name collisions (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1149">1149</a>). Thanks <a href="https://github.com/geokala">@geokala</a></li>
</ul>
<p>Deprecations:</p>
<ul>
<li>Deprecate <code>--index/--no-index</code> in favor of <code>--emit-index-url/--no-emit-index-url</code> options in <code>pip-compile</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1130">1130</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a></li>
</ul>
<p>Other Changes:</p>
<ul>
<li>Switch to <code>setuptools</code> declarative syntax through <code>setup.cfg</code> (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1141">1141</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/jazzband/pip-tools/blob/master/CHANGELOG.md">pip-tools's changelog</a>.</em></p>
<blockquote>
<h1>5.2.0 (2020-05-27)</h1>
<p>Features:</p>
<ul>
<li>Show basename of URLs when <code>pip-compile</code> generates hashes in a verbose mode
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1113">1113</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a></li>
<li>Add <code>--emit-index-url/--no-emit-index-url</code> options to <code>pip-compile</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1130">1130</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a></li>
</ul>
<p>Bug Fixes:</p>
<ul>
<li>Fix a bug where <code>pip-compile</code> would ignore some of package versions when
<code>PIP_PREFER_BINARY</code> is set on
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1119">1119</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a></li>
<li>Fix leaked URLs with credentials in the debug output of <code>pip-compile</code>.
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1146">1146</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a></li>
<li>Fix a bug where URL requirements would have name collisions
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1149">1149</a>). Thanks <a href="https://github.com/geokala">@geokala</a></li>
</ul>
<p>Deprecations:</p>
<ul>
<li>Deprecate <code>--index/--no-index</code> in favor of <code>--emit-index-url/--no-emit-index-url</code>
options in <code>pip-compile</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1130">1130</a>). Thanks <a href="https://github.com/atugushev">@atugushev</a></li>
</ul>
<p>Other Changes:</p>
<ul>
<li>Switch to <code>setuptools</code> declarative syntax through <code>setup.cfg</code>
(<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/pull/1141">1141</a>). Thanks <a href="https://github.com/jdufresne">@jdufresne</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/jazzband/pip-tools/commit/7ba96dba6fd5db0ffae0ee313678080ac3cded0f"><code>7ba96db</code></a> 5.2.0 changelog</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/304d7ad56acd921d490950d91c280c2d38e86b5a"><code>304d7ad</code></a> Deprecate --index/--no-index in pip-compile (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1130">#1130</a>)</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/008865ac7607476c0be20b2a3c5fd1bcf3d39c70"><code>008865a</code></a> Avoid URL requirement name collisions (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1149">#1149</a>)</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/0ce999be1de959880b22a2b7b43488289fe6866a"><code>0ce999b</code></a> Fix py27 failing jobs (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1151">#1151</a>)</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/e09f9eeaaaa5732a7be29ddee736b505710ccacf"><code>e09f9ee</code></a> Show basename of hashing URL in debug logs (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1113">#1113</a>)</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/4db0eb0b87130acf917ad32854d8227d089b3f8d"><code>4db0eb0</code></a> Fix leaked URLs with credentials in the output (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1146">#1146</a>)</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/5dd163aa8ce39b8abb671c1fa9aec832c43d5af6"><code>5dd163a</code></a> Fix a bug where pip-compile would ignore some of the versions (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1119">#1119</a>)</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/32deaf3feb496a974fd8479a50d2a44107017235"><code>32deaf3</code></a> Fix broken cron ci (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1147">#1147</a>)</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/b1d73691e9064467326ae915a2753670de643925"><code>b1d7369</code></a> Add CI workflow for GitHub Actions (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1012">#1012</a>)</li>
<li><a href="https://github.com/jazzband/pip-tools/commit/ce3da738d0066622c7c58892ab0838d436c6c7bc"><code>ce3da73</code></a> Update pre-commit hooks (<a href="https://github-redirect.dependabot.com/jazzband/pip-tools/issues/1144">#1144</a>)</li>
<li>Additional commits viewable in <a href="https://github.com/jazzband/pip-tools/compare/5.1.2...5.2.0">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=pip-tools&package-manager=pip&previous-version=5.1.2&new-version=5.2.0)](https://dependabot.com/compatibility-score/?dependency-name=pip-tools&package-manager=pip&previous-version=5.1.2&new-version=5.2.0)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

I'm trying to use `mido` package with `flask`. I noticed a couple issues.

1. `mido.get_input_names()` : doesn't recognize a new ports that opened after the `flask` server started.

2. If a port closed (ex: `VMPK Output`) after it was called by, calling the same function  `mido.get_input_names()` throws the `subject` error (even it is a`browser page refresh` or a `form submit`.

* Thought, this could be an issue with `mido`, I opened a ticket there. 
* But the same code **works fine in `Quart`** framework though]

### Expected Behavior (for #. 1)
<!-- Tell us what should happen. -->

```python
import mido
from flask import Flask, jsonify

app = Flask(__name__)

@app.route('/')
def home():
    return jsonify({'message': mido.get_input_names()})


# Home Page loading for the first time :  
#........ ['IAC Driver Bus 1', 'Network Session 1']

# Open `VMPK` and Refresh the page:  
#....... Expected Output:  ['IAC Driver Bus 1', 'Network Session 1', 'VMPK Output']
```

### Actual Behavior
<!-- Tell us what happens instead. -->

```pytb
['IAC Driver Bus 1', 'Network Session 1']
```


### Expected Behavior (For #. 2)
<!-- Tell us what should happen. -->

```python
# Open `VMPK`; Start the `app`; Home Page loading for the first time :  
#........ ['IAC Driver Bus 1', 'Network Session 1', 'VMPK Output',  'VMPK Output']

# *Close* `VMPK`; Refresh the browser  
#....... Expected Output:  ['IAC Driver Bus 1', 'Network Session 1']
```

### Actual Behavior
<!-- Tell us what happens instead. -->

```pytb
TypeError
TypeError: '<' not supported between instances of 'NoneType' and 'str'

Traceback (most recent call last)
File "/Users/dacodekid/dev/flask-issue/venv/lib/python3.8/site-packages/flask/app.py", line 2464, in __call__
return self.wsgi_app(environ, start_response)
File "/Users/dacodekid/dev/flask-issue/venv/lib/python3.8/site-packages/flask/app.py", line 2450, in wsgi_app
response = self.handle_exception(e)
File "/Users/dacodekid/dev/flask-issue/venv/lib/python3.8/site-packages/flask/app.py", line 1867, in handle_exception
reraise(exc_type, exc_value, tb)
File "/Users/dacodekid/dev/flask-issue/venv/lib/python3.8/site-packages/flask/_compat.py", line 39, in reraise
raise value
File "/Users/dacodekid/dev/flask-issue/venv/lib/python3.8/site-packages/flask/app.py", line 2447, in wsgi_app
response = self.full_dispatch_request()
File "/Users/dacodekid/dev/flask-issue/venv/lib/python3.8/site-packages/flask/app.py", line 1952, in full_dispatch_request
rv = self.handle_user_exception(e)
File "/Users/dacodekid/dev/flask-issue/venv/lib/python3.8/site-packages/flask/app.py", line 1821, in handle_user_exception
reraise(exc_type, exc_value, tb)
File "/Users/dacodekid/dev/flask-issue/venv/lib/python3.8/site-packages/flask/_compat.py", line 39, in reraise
raise value
File "/Users/dacodekid/dev/flask-issue/venv/lib/python3.8/site-packages/flask/app.py", line 1950, in full_dispatch_request
rv = self.dispatch_request()
File "/Users/dacodekid/dev/flask-issue/venv/lib/python3.8/site-packages/flask/app.py", line 1936, in dispatch_request
return self.view_functions[rule.endpoint](**req.view_args)
File "/Users/dacodekid/dev/flask-issue/app.py", line 9, in home
return jsonify({'message': mido.get_input_names()})
File "/Users/dacodekid/dev/flask-issue/venv/lib/python3.8/site-packages/mido/backends/backend.py", line 169, in get_input_names
devices = self._get_devices(**self._add_api(kwargs))
File "/Users/dacodekid/dev/flask-issue/venv/lib/python3.8/site-packages/mido/backends/backend.py", line 163, in _get_devices
return self.module.get_devices(**self._add_api(kwargs))
File "/Users/dacodekid/dev/flask-issue/venv/lib/python3.8/site-packages/mido/backends/rtmidi.py", line 55, in get_devices
for name in sorted(input_names | output_names):
TypeError: '<' not supported between instances of 'NoneType' and 'str'
The debugger caught an exception in your WSGI application. You can now look at the traceback which led to the error.
To switch between the interactive traceback and the plaintext one, you can click on the "Traceback" headline. From the text traceback you can also create a paste of it. For code execution mouse-over the frame you want to debug and click on the console icon on the right side.

You can execute arbitrary Python code in the stack frames and there are some extra helpers available for introspection:

dump() shows all variables in the frame
dump(obj) dumps all that's known about the object
```

### Environment

* Python version: 3.7.3
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

### Pip packages
```
click==7.1.2
Flask==1.1.2
itsdangerous==1.1.0
Jinja2==2.11.2
MarkupSafe==1.1.1
mido==1.2.9
python-rtmidi==1.4.1
Werkzeug==1.0.1
```

Flask
Bumps [sphinx](https://github.com/sphinx-doc/sphinx) from 3.0.3 to 3.0.4.
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a href="https://github.com/sphinx-doc/sphinx/blob/3.x/CHANGES">sphinx's changelog</a>.</em></p>
<blockquote>
<h1>Release 3.0.4 (released May 27, 2020)</h1>
<h2>Bugs fixed</h2>
<ul>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7567">#7567</a>: autodoc: parametrized types are shown twice for generic types</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7637">#7637</a>: autodoc: system defined TypeVars are shown in Python 3.9</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7696">#7696</a>: html: Updated jQuery version from 3.4.1 to 3.5.1 for security reasons</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7611">#7611</a>: md5 fails when OpenSSL FIPS is enabled</li>
<li><a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7626">#7626</a>: release package does not contain <code>CODE_OF_CONDUCT</code></li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/b797f7f75c1611182997b2171882acb11b63c776"><code>b797f7f</code></a> Bump to 3.0.4 final</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/c1ef87a23b9364d371fd4124d918a356305f1de5"><code>c1ef87a</code></a> Fix <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7696">#7696</a>: html: Updated jQuery version from 3.4.1 to 3.5.1</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/f777ad38dfae84b804e86cfa767e57379d2011c8"><code>f777ad3</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7638">#7638</a> from tk0miya/7626_missing_CODE_OF_CONDUCT</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/f73256176f9820351c1f529232b4c0679811e7fc"><code>f732561</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7640">#7640</a> from tk0miya/suppress_system_defined_TypeVars</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/1fbfb7281e6298311fde3403558d6a8a3c03372f"><code>1fbfb72</code></a> Suppress arguments if all system defined TypeVars on py39</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/cf5660cb399e1eddd1c27d0c1380e4fd8a675a0a"><code>cf5660c</code></a> Fix <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7626">#7626</a>: release package does not contain <code>CODE_OF_CONDUCT</code></li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/d670214403eb09372ef5b2e1dd1cf04258b84e56"><code>d670214</code></a> Merge pull request <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7614">#7614</a> from lhupfeldt/3.0.x</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/7d41eddd6ee4b8fb47ffa2d8fa75d69801950815"><code>7d41edd</code></a> Introduce fips safe sha1, see issue <a href="https://github-redirect.dependabot.com/sphinx-doc/sphinx/issues/7611">#7611</a></li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/8bbc7b83c059e099db41dc8774c155cb1723e9aa"><code>8bbc7b8</code></a> Rename fips_safe_md5 to md5</li>
<li><a href="https://github.com/sphinx-doc/sphinx/commit/193d1410acf297a32b9e69b0626901790c7e1647"><code>193d141</code></a> Fix mypy and flake8 checks</li>
<li>Additional commits viewable in <a href="https://github.com/sphinx-doc/sphinx/compare/v3.0.3...v3.0.4">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://api.dependabot.com/badges/compatibility_score?dependency-name=sphinx&package-manager=pip&previous-version=3.0.3&new-version=3.0.4)](https://dependabot.com/compatibility-score/?dependency-name=sphinx&package-manager=pip&previous-version=3.0.3&new-version=3.0.4)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
[//]: # (dependabot-automerge-end)

---

**Note:** This repo was added to Dependabot recently, so you'll receive a maximum of 5 PRs for your first few update runs. Once an update run creates fewer than 5 PRs we'll remove that limit.

You can always request more updates by clicking `Bump now` in your [Dependabot dashboard](https://app.dependabot.com).

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language
- `@dependabot badge me` will comment on this PR with code to add a "Dependabot enabled" badge to your readme

Additionally, you can set the following in your Dependabot [dashboard](https://app.dependabot.com):
- Update frequency (including time of day and day of week)
- Pull request limits (per update run and/or open at any time)
- Out-of-range updates (receive only lockfile updates, if desired)
- Security updates (receive only security updates, if desired)



</details>
<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->

```python
# Paste a minimal example that causes the problem.
```

### Actual Behavior
<!-- Tell us what happens instead. -->

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version:
* Flask version:
* Werkzeug version:

**add function REGEXP for sqlite3 which can support regex search.**

When using such sql 
```sql
SELECT word FROM words WHERE word REGEXP ".*go"
````
the following error will happen
```py
sqlite3.OperationalError: no such function: REGEXP
```
and this PR can fix the error.

References:
https://www.sqlite.org/lang_expr.html#regexp
https://stackoverflow.com/questions/5365451/problem-with-regexp-python-and-sqlite



### Expected Behavior
Flask should have a function, hypothetically called `parse_route`, that works as a reverse `url_for`. That is, given a path it will return the matching endpoint and its arguments. This is useful, at least for my use case, for knowing which endpoint and arguments will be matched by a path (a URL string). Or if I have a view with multiple routes applied to it, I could parse a string and know which route will be matched with which arguments. I've seen other people searching for a similar solution on the web and they came up with weird solutions trying to reverse the behavior of `url_for`.

### Actual Behavior
Flask doesn't not seem to have any such function, but it seems to be possible to get this behavior by using some of the werkzeug internals. In particular using [`class werkzeug.routing.MapAdapter`](https://werkzeug.palletsprojects.com/en/1.0.x/routing/#werkzeug.routing.MapAdapter) like this `app.url_map.bind('').match(path)`, the `match()` function seems to work as expected. The problem is that this is very much buried down into the werkzeug internals and almost impossible to find for flask users like me.

### Environment

* Python version: 3.7.3
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

Hi,

Is there a way to get the socket or socket.fileno() from an incoming flask.request?

I'd like like manipulate the socket to force failures but I'm not able to find any related documentation. 
Any help/direction would be appreciated. Thank you. 
### Expected Behavior
Custom handler exception should execute and leave the console alone

```python
# Instead of always getting "Internal server error" default response, this permits to use our
# own error handlers
app.config['PROPAGATE_EXCEPTIONS'] = True

formatter = logging.Formatter("")
handler = RotatingFileHandler('errors.log', maxBytes=10000, backupCount=1)
handler.setFormatter(formatter) # Tried not setting a formatter as well, same result
handler.setLevel(logging.ERROR)
logging.getLogger('warnings').addHandler(handler)
logging.getLogger().addHandler(handler)

# MySQL connection issues
@app.errorhandler(OperationalError)
def handle_database_error(err):
    # The line below doesn't output anything in the console
    logging.getLogger().error(err)

    # The line below outputs tons of lines of stack trace in the console
    logging.getLogger('errors').error(err)
```

### Actual Behavior
In the code above, if using the built-in handler logging.getLogger().error(err) It will output only 127.0.0.1 - - [14/May/2020 15:56:22] "GET /platforms/8 HTTP/1.1" 500 - which is the desired result when using a bad password for the DB.

However, if using the custom handler logging.getLogger('errors').error(err), the console gets filled with garbage and a long stack trace of exceptions causing other exceptions, with 3 messages like these:

"During handling of the above exception, another exception occurred"
"The above exception was the direct cause of the following exception"

Been on this for almost 2 weeks now, no answer on StackOverflow so I'm starting to think this is a bug, no matter what I do, I can't find what's causing this.

Furthermore, the stack trace is almost always files in site-packages, library files that are outside of my own files scope.

```pytb
--- Logging error ---
Traceback (most recent call last):
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\engine\base.py", line 2345, in _wrap_pool_connect
    return fn()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 364, in connect
    return _ConnectionFairy._checkout(self)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 778, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 495, in checkout
    rec = pool._do_get()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\impl.py", line 140, in _do_get
    self._dec_overflow()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\util\langhelpers.py", line 69, in __exit__
    exc_value, with_traceback=exc_tb,
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\util\compat.py", line 178, in raise_
    raise exception
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\impl.py", line 137, in _do_get
    return self._create_connection()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 309, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 440, in __init__
    self.__connect(first_connect_check=True)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 661, in __connect
    pool.logger.debug("Error on connect(): %s", e)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\util\langhelpers.py", line 69, in __exit__
    exc_value, with_traceback=exc_tb,
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\util\compat.py", line 178, in raise_
    raise exception
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 656, in __connect
    connection = pool._invoke_creator(self)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\engine\strategies.py", line 114, in connect
    return dialect.connect(*cargs, **cparams)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\engine\default.py", line 490, in connect
    return self.dbapi.connect(*cargs, **cparams)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\__init__.py", line 94, in Connect
    return Connection(*args, **kwargs)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\connections.py", line 325, in __init__
    self.connect()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\connections.py", line 599, in connect
    self._request_authentication()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\connections.py", line 861, in _request_authentication
    auth_packet = self._read_packet()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1044, "Access denied for user 'app'@'%' to database 'app_deva'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\flask_restful\__init__.py", line 269, in error_router
    return self.handle_error(e)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\flask\app.py", line 1950, in full_dispatch_request
    rv = self.dispatch_request()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\flask\app.py", line 1936, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\flask_restful\__init__.py", line 468, in wrapper
    resp = resource(*args, **kwargs)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\flask\views.py", line 89, in view
    return self.dispatch_request(*args, **kwargs)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\flask_restful\__init__.py", line 583, in dispatch_request
    resp = meth(*args, **kwargs)
  File "E:\DEV\api\resources\platform.py", line 19, in get
    watch_item = WatchItemModel.find_by_id(watch_item_id)
  File "E:\DEV\api\core\model.py", line 34, in find_by_id
    return cls.query.filter_by(**{cls.__primary_key__: id_}).first()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\orm\query.py", line 3375, in first
    ret = list(self[0:1])
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\orm\query.py", line 3149, in __getitem__
    return list(res)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\orm\query.py", line 3481, in __iter__
    return self._execute_and_instances(context)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\orm\query.py", line 3503, in _execute_and_instances
    querycontext, self._connection_from_session, close_with_result=True
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\orm\query.py", line 3518, in _get_bind_args
    mapper=self._bind_mapper(), clause=querycontext.statement, **kw
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\orm\query.py", line 3496, in _connection_from_session
    conn = self.session.connection(**kw)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\orm\session.py", line 1141, in connection
    execution_options=execution_options,
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\orm\session.py", line 1147, in _connection_for_bind
    engine, execution_options
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\orm\session.py", line 433, in _connection_for_bind
    conn = bind._contextual_connect()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\engine\base.py", line 2311, in _contextual_connect
    self._wrap_pool_connect(self.pool.connect, None),
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _wrap_pool_connect
    e, dialect, self
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\engine\base.py", line 1591, in _handle_dbapi_exception_noconnection
    sqlalchemy_exception, with_traceback=exc_info[2], from_=e
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\util\compat.py", line 178, in raise_
    raise exception
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\engine\base.py", line 2345, in _wrap_pool_connect
    return fn()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 364, in connect
    return _ConnectionFairy._checkout(self)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 778, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 495, in checkout
    rec = pool._do_get()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\impl.py", line 140, in _do_get
    self._dec_overflow()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\util\langhelpers.py", line 69, in __exit__
    exc_value, with_traceback=exc_tb,
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\util\compat.py", line 178, in raise_
    raise exception
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\impl.py", line 137, in _do_get
    return self._create_connection()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 309, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 440, in __init__
    self.__connect(first_connect_check=True)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 661, in __connect
    pool.logger.debug("Error on connect(): %s", e)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\util\langhelpers.py", line 69, in __exit__
    exc_value, with_traceback=exc_tb,
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\util\compat.py", line 178, in raise_
    raise exception
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 656, in __connect
    connection = pool._invoke_creator(self)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\engine\strategies.py", line 114, in connect
    return dialect.connect(*cargs, **cparams)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\engine\default.py", line 490, in connect
    return self.dbapi.connect(*cargs, **cparams)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\__init__.py", line 94, in Connect
    return Connection(*args, **kwargs)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\connections.py", line 325, in __init__
    self.connect()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\connections.py", line 599, in connect
    self._request_authentication()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\connections.py", line 861, in _request_authentication
    auth_packet = self._read_packet()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1044, "Access denied for user 'app'@'%' to database 'app_deva'")
(Background on this error at: http://sqlalche.me/e/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "c:\python37\lib\logging\handlers.py", line 1020, in emit
    smtp.login(self.username, self.password)
  File "c:\python37\lib\smtplib.py", line 697, in login
    "SMTP AUTH extension not supported by server.")
smtplib.SMTPNotSupportedError: SMTP AUTH extension not supported by server.
Call stack:
Traceback (most recent call last):
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\engine\base.py", line 2345, in _wrap_pool_connect
    return fn()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 364, in connect
    return _ConnectionFairy._checkout(self)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 778, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 495, in checkout
    rec = pool._do_get()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\impl.py", line 140, in _do_get
    self._dec_overflow()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\util\langhelpers.py", line 69, in __exit__
    exc_value, with_traceback=exc_tb,
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\util\compat.py", line 178, in raise_
    raise exception
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\impl.py", line 137, in _do_get
    return self._create_connection()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 309, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 440, in __init__
    self.__connect(first_connect_check=True)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 661, in __connect
    pool.logger.debug("Error on connect(): %s", e)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\util\langhelpers.py", line 69, in __exit__
    exc_value, with_traceback=exc_tb,
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\util\compat.py", line 178, in raise_
    raise exception
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 656, in __connect
    connection = pool._invoke_creator(self)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\engine\strategies.py", line 114, in connect
    return dialect.connect(*cargs, **cparams)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\engine\default.py", line 490, in connect
    return self.dbapi.connect(*cargs, **cparams)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\__init__.py", line 94, in Connect
    return Connection(*args, **kwargs)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\connections.py", line 325, in __init__
    self.connect()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\connections.py", line 599, in connect
    self._request_authentication()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\connections.py", line 861, in _request_authentication
    auth_packet = self._read_packet()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1044, "Access denied for user 'app'@'%' to database 'app_deva'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\flask\app.py", line 1950, in full_dispatch_request
    rv = self.dispatch_request()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\flask\app.py", line 1936, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\flask_restful\__init__.py", line 468, in wrapper
    resp = resource(*args, **kwargs)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\flask\views.py", line 89, in view
    return self.dispatch_request(*args, **kwargs)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\flask_restful\__init__.py", line 583, in dispatch_request
    resp = meth(*args, **kwargs)
  File "E:\DEV\api\resources\platform.py", line 19, in get
    watch_item = WatchItemModel.find_by_id(watch_item_id)
  File "E:\DEV\api\core\model.py", line 34, in find_by_id
    return cls.query.filter_by(**{cls.__primary_key__: id_}).first()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\orm\query.py", line 3375, in first
    ret = list(self[0:1])
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\orm\query.py", line 3149, in __getitem__
    return list(res)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\orm\query.py", line 3481, in __iter__
    return self._execute_and_instances(context)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\orm\query.py", line 3503, in _execute_and_instances
    querycontext, self._connection_from_session, close_with_result=True
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\orm\query.py", line 3518, in _get_bind_args
    mapper=self._bind_mapper(), clause=querycontext.statement, **kw
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\orm\query.py", line 3496, in _connection_from_session
    conn = self.session.connection(**kw)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\orm\session.py", line 1141, in connection
    execution_options=execution_options,
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\orm\session.py", line 1147, in _connection_for_bind
    engine, execution_options
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\orm\session.py", line 433, in _connection_for_bind
    conn = bind._contextual_connect()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\engine\base.py", line 2311, in _contextual_connect
    self._wrap_pool_connect(self.pool.connect, None),
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _wrap_pool_connect
    e, dialect, self
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\engine\base.py", line 1591, in _handle_dbapi_exception_noconnection
    sqlalchemy_exception, with_traceback=exc_info[2], from_=e
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\util\compat.py", line 178, in raise_
    raise exception
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\engine\base.py", line 2345, in _wrap_pool_connect
    return fn()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 364, in connect
    return _ConnectionFairy._checkout(self)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 778, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 495, in checkout
    rec = pool._do_get()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\impl.py", line 140, in _do_get
    self._dec_overflow()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\util\langhelpers.py", line 69, in __exit__
    exc_value, with_traceback=exc_tb,
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\util\compat.py", line 178, in raise_
    raise exception
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\impl.py", line 137, in _do_get
    return self._create_connection()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 309, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 440, in __init__
    self.__connect(first_connect_check=True)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 661, in __connect
    pool.logger.debug("Error on connect(): %s", e)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\util\langhelpers.py", line 69, in __exit__
    exc_value, with_traceback=exc_tb,
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\util\compat.py", line 178, in raise_
    raise exception
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\pool\base.py", line 656, in __connect
    connection = pool._invoke_creator(self)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\engine\strategies.py", line 114, in connect
    return dialect.connect(*cargs, **cparams)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\sqlalchemy\engine\default.py", line 490, in connect
    return self.dbapi.connect(*cargs, **cparams)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\__init__.py", line 94, in Connect
    return Connection(*args, **kwargs)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\connections.py", line 325, in __init__
    self.connect()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\connections.py", line 599, in connect
    self._request_authentication()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\connections.py", line 861, in _request_authentication
    auth_packet = self._read_packet()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1044, "Access denied for user 'app'@'%' to database 'app_deva'")
(Background on this error at: http://sqlalche.me/e/e3q8)

  File "c:\python37\lib\threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
  File "c:\python37\lib\threading.py", line 926, in _bootstrap_inner
    self.run()
  File "c:\python37\lib\threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
  File "c:\python37\lib\socketserver.py", line 650, in process_request_thread
    self.finish_request(request, client_address)
  File "c:\python37\lib\socketserver.py", line 360, in finish_request
    self.RequestHandlerClass(request, client_address, self)
  File "c:\python37\lib\socketserver.py", line 720, in __init__
    self.handle()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\werkzeug\serving.py", line 345, in handle
    BaseHTTPRequestHandler.handle(self)
  File "c:\python37\lib\http\server.py", line 426, in handle
    self.handle_one_request()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\werkzeug\serving.py", line 379, in handle_one_request
    return self.run_wsgi()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\werkzeug\serving.py", line 323, in run_wsgi
    execute(self.server.app)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\werkzeug\serving.py", line 314, in execute
    for data in application_iter:
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\werkzeug\debug\__init__.py", line 304, in debug_application
    app_iter = self.app(environ, start_response)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\flask\app.py", line 2464, in __call__
    return self.wsgi_app(environ, start_response)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\flask\app.py", line 2447, in wsgi_app
    response = self.full_dispatch_request()
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\flask\app.py", line 1952, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\flask_restful\__init__.py", line 272, in error_router
    return original_handler(e)
  File "C:\Users\Marco\.virtualenvs\api-kHflOUBu\lib\site-packages\flask\app.py", line 1822, in handle_user_exception
    return handler(e)
  File "E:\DEV\api\components\error_handler.py", line 33, in handle_database_error
    return ErrorHandler.error(errors.DATABASE_ACCESS, err, traceback.format_exc())
  File "E:\DEV\api\components\error_handler.py", line 86, in error
    logging.getLogger('errors').error(err, extra=ErrorHandler.get_details())
Message: OperationalError('(pymysql.err.OperationalError) (1044, "Access denied for user \'app\'@\'%\' to database \'app_deva\'")')
Arguments: ()
127.0.0.1 - - [18/May/2020 20:26:50] "GET /platforms/8 HTTP/1.1" 500 -
```

### Environment

* Python version: 3.7.7
* Flask version: 1.1.2
* Werkzeug version: 1.0.1


As you can see from the application config, I have set
`'ENV': 'development', 'DEBUG': True`.

but flask still says  `Debug mode: off`.

Is that a bug?

<img width="1024" alt="Screenshot 2020-05-18 at 20 43 25" src="https://user-images.githubusercontent.com/37377831/82253234-781bbc00-9948-11ea-874e-6cb3964b5f82.png">

* Python version:3
* Flask version:1.1.2
* Werkzeug version:

CVE-2020-11022
In jQuery versions greater than or equal to 1.2 and before 3.5.0, passing HTML from untrusted sources - even after sanitizing it - to one of jQuery's DOM manipulation methods (i.e. .html(), .append(), and others) may execute untrusted code. This problem is patched in jQuery 3.5.0.

Could you update werkzeug to use latest version of Jquery -3.5.1 or 3.5.0

flask is using Werkzeug library which is using the old version of jquery
I just follow the website learn about flask ,
when reaching to

quick start, variable rules:

I type all the prog and save as .py
try to export but 
404 Not Found

I just wonder that I should create a database called escape

right?
![Screenshot_20200518-002321_Chrome](https://user-images.githubusercontent.com/56774958/82162730-a0e77700-989e-11ea-8f49-c502b5350729.jpg)
![Screenshot_20200518-003023_Chrome](https://user-images.githubusercontent.com/56774958/82162758-d1c7ac00-989e-11ea-86e9-1727aa106064.jpg)








<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->

```python
# Paste a minimal example that causes the problem.
```

### Actual Behavior
<!-- Tell us what happens instead. -->

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version:
* Flask version:
* Werkzeug version:

The [security](https://flask.palletsprojects.com/en/1.1.x/security/) page in the docs discusses various security issues that Flask might not prevent. Add a section discussing things that could happen when copying and pasting code into a terminal. The discussion doesn't need to be exhaustive. Mainly focus on "if you're allowing users to enter code, such as comments on a programming blog, and expect other users to copy it, you might want to apply extra filtering, such as `body.replace("\b", "")`."

See pallets/markupsafe#71, which discussed making `markupsafe.escape` also escape backspace characters. I concluded that it was better for terminals to handle it than for MarkupSafe to expand its scope beyond HTML syntax.

The main issue is the backspace (`\b`, `^H`) character. It is not rendered by browsers, but it does affect text in a terminal. So `import y\bose\bm\bi\bt\be\b ` renders as `import yosemite` but becomes `import os` when pasted in a terminal. Most modern terminals detect invisible control characters and offer to remove them when pasting, but some terminals may still have this issue.

Other issues include newlines causing multi-line blocks to execute automatically, invalid characters being interpreted together as the escape key, commands hidden after other commands with `;`, triggering Vim commands, etc. There are lots of ways to craft commands that look familiar or innocuous and have them cause unexpected behavior.

Another discussion I found was https://security.stackexchange.com/questions/39118/how-can-i-protect-myself-from-this-kind-of-clipboard-abuse.
As title, does Flask work with py3 ?

when it is installed, doule it be typed as : pip3 instead on pip ?

### Expected Behavior
<!-- Tell us what should happen. -->

`.flaskenv` should be read by flask.


### Actual Behavior

```python
# app/__init__.py
from flask import Flask

app = Flask(__name__)

@app.route('/')
def hello():
    return 'Hello, Flask!'
```

```env
# .flaskenv
FLASK_APP=main.py
```

```py
# main.py
from app import app
```

With this file structure
```
project/
     - .flaskenv
     - app/
          - __init__.py
     - main.py
```

with `flask run` I get

```pytb
Error: Could not locate Flask application. You did not provide the FLASK_APP environment variable.
```

A question on [SO](https://stackoverflow.com/q/53725865/8608146)

### Environment

**On Windows 10**

```
Flask 0.12.2
Python 3.8.0 (tags/v3.8.0:fa919fd, Oct 14 2019, 19:37:50) [MSC v.1916 64 bit (AMD64)]**
```

minimal example zip 
[project.zip](https://github.com/pallets/flask/files/4621092/project.zip)

This PR will add a `cli_group_help` parameter for the blueprint. When register blueprint level commands, you can use it to set command group help text.

If not set, the default help text for the blueprint command group will be `A command group for <blueprint's name> blueprint.`.

ref: https://github.com/pallets/flask/issues/3608

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
There should be a way to specify blueprint command group help.
```python
from flask import Blueprint
editUser = Blueprint("editUser",__name__) # cannot add help to this entry (flask --help)

# Will be ignored:
editUser.__doc__ = "maybe this adds help...."

@editUser.cli.command("seed")
def seed():
    """ Seeds user database (will be shown if you type flask editUser --help)"""
    pass
```

### Actual Behavior
Currently flask does not provide a way to display help for blueprint commands.

*`flask --help` Output:*
```
Options:
  --version  Show the flask version
  --help     Show this message and exit.
Commands:
  editUser 
  routes    Show the routes for the app.
  run       Run a development server.
  shell     Run a shell in the app context.
```

### Environment

* Python version: 3.6.9
* Flask version: 1.1.2
* Werkzeug version: 1.0.1

### Suggestion 
Add a cli_group_help keyword to blueprints:
```
editUser = Blueprint("editUser",__name__, cli_group_help="Provides user management commands")
```

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful/related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
`after_request` not being executed

```python
from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello_world():
    raise ValueError("after_request should not run")
    return 'Hello, World!'


@app.after_request
def after_request_func(response):
    print('after request executed')
    return response
```

### Actual Behavior
`after_request_func` is being executed

According to [the documentation](https://flask.palletsprojects.com/en/1.1.x/api/#flask.Flask.after_request), this shouldn't be executed if an unhandled exception is present

This is happening on all versions since 1.1.0 (1.1.0, 1.1.1, 1.1.2, not happening on 1.0.4)

### Environment

* Python version: 3.7.7
* Flask version: >=1.1.0
* Werkzeug version: 1.0.1

# Update the /docs/testing.rst

Update the`/docs/testing.rst`. Remove the incompatible code snippet like this [one](https://flask.palletsprojects.com/en/1.0.x/testing/#the-testing-skeleton) since the `flaskr` application has been rewritten and does not contain a `flaskr` object.

### a. Sections removed from /docs/testing.rst:

1. The Testing Skeleton;
2. The First Test;
3. Logging In and Out;
4. Test Adding Messages;

### b. Replaced with:
1. The Testing Setup and Fixtures;
2. Database;
3. Authentication;
4. Blog;

### c. Added Section:
- Factory; (The previous version referred to 0.12, which does not contain an app factory, could cause confusions)

Most description is directly taken from `/docs/tutorial/tests.rst` since  @davidism  mentioned [here](https://github.com/pallets/flask/issues/2831#issuecomment-399702709) that the tutorial is update to date;

Relevant issues: #2831,  #3545,  and #2833 .
Possible overlaps: #3349 , #3311 .

**NOTE**: updating the testing docs seems like a long-term job and would take some effort to entirely make the testing docs compatible with the current flask version; I will continue study and update more outdated contents; Meanwhile, any suggestions and help are welcome! :)

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

This PR is to answer requests about how to override the default command, on the flask command. seen in issue #2020.

Fixes #2741.
The docs link is out of date.

This updates to point at the correct location.

Alternatively, there are now multiple extensions for managing file uploads, so could change to saying "there are several extensions for managing file uploads" as that way you don't risk recommending specific libs which may at some point get abandoned, as happened for a time with this lib (#1493).
I go into the environment and type in the command flask run, but its not running.

ERROR:
 Could not locate a Flask application. You did not provide the "FLASK_APP" environment variable, and a "wsgi.py" or "app.py" module was not found in the current directory.
The function returned by the decorator should be called "wrapper_view" instead of "wrapped_view" because it wraps the original view. It's not wrapped by it.

The example in Python docs use the same wording: https://docs.python.org/2/library/functools.html#functools.wraps

Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

This PR aims for fixing #3599


<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

<!-- **This issue tracker is a tool to address bugs in Flask itself.
Please use the Pallets Discord or Stack Overflow for general questions
about using Flask or issues not related to Flask.** -->

<!-- If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code. -->

### Expected Behavior
<!-- Tell us what should happen. -->

#### 1. Example Application

- `app.py`

```python
from flask import Flask, render_template

app = Flask(__name__)


@app.route("/")
def hello_world():
    data = {"X": 1,
            "Y": True,
            None: "abc"}

    return render_template("index.html", data=data)


if __name__ == "__main__":
    app.run(debug=True)

```

-  `templates/index.html`

```html
<html>

<script>
 const a = {{ data|tojson }};
</script>

<p>Hi</p>

</html>
```

#### 2. Example Single-Line Code

The same issue will be triggered if you run code below

```python
flask.json.dumps({None: 1, "X": 2})
```

### Actual Behavior
<!-- Tell us what happens instead. -->


```pytb
Traceback (most recent call last):
  File "/Users/XD/Library/Python/3.7/lib/python/site-packages/flask/app.py", line 2464, in __call__
    return self.wsgi_app(environ, start_response)
  File "/Users/XD/Library/Python/3.7/lib/python/site-packages/flask/app.py", line 2450, in wsgi_app
    response = self.handle_exception(e)
  File "/Users/XD/Library/Python/3.7/lib/python/site-packages/flask/app.py", line 1867, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/Users/XD/Library/Python/3.7/lib/python/site-packages/flask/_compat.py", line 39, in reraise
    raise value
  File "/Users/XD/Library/Python/3.7/lib/python/site-packages/flask/app.py", line 2447, in wsgi_app
    response = self.full_dispatch_request()
  File "/Users/XD/Library/Python/3.7/lib/python/site-packages/flask/app.py", line 1952, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/Users/XD/Library/Python/3.7/lib/python/site-packages/flask/app.py", line 1821, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/Users/XD/Library/Python/3.7/lib/python/site-packages/flask/_compat.py", line 39, in reraise
    raise value
  File "/Users/XD/Library/Python/3.7/lib/python/site-packages/flask/app.py", line 1950, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/XD/Library/Python/3.7/lib/python/site-packages/flask/app.py", line 1936, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/Users/XD/Desktop/flask_temp/app.py", line 11, in hello_world
    return render_template("index.html", data=data)
  File "/Users/XD/Library/Python/3.7/lib/python/site-packages/flask/templating.py", line 140, in render_template
    ctx.app,
  File "/Users/XD/Library/Python/3.7/lib/python/site-packages/flask/templating.py", line 120, in _render
    rv = template.render(context)
  File "/Users/XD/Library/Python/3.7/lib/python/site-packages/jinja2/environment.py", line 1090, in render
    self.environment.handle_exception()
  File "/Users/XD/Library/Python/3.7/lib/python/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/Users/XD/Library/Python/3.7/lib/python/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "/Users/XD/Desktop/flask_temp/templates/index.html", line 4, in top-level template code
    const a = {{ data|tojson }};
  File "/Users/XD/Library/Python/3.7/lib/python/site-packages/flask/json/__init__.py", line 376, in tojson_filter
    return Markup(htmlsafe_dumps(obj, **kwargs))
  File "/Users/XD/Library/Python/3.7/lib/python/site-packages/flask/json/__init__.py", line 290, in htmlsafe_dumps
    dumps(obj, **kwargs)
  File "/Users/XD/Library/Python/3.7/lib/python/site-packages/flask/json/__init__.py", line 211, in dumps
    rv = _json.dumps(obj, **kwargs)
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.7/lib/python3.7/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.7/lib/python3.7/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.7/lib/python3.7/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
TypeError: '<' not supported between instances of 'NoneType' and 'str'
```

### Environment

* OS: Darwin 19.3.0 Darwin Kernel Version 19.3.0
* Python: 3.7.3 (this issue is inapplicable for Python 2.7)
* Flask: 1.1.2
* Werkzeug: 1.0.1

### Root Cause

Python 3 would fail to sort keys when it processes `json.dumps(dict, sort_keys=True)` if there are multiple keys in the dict and one key is `None`. E.g., `json.dumps({None: 1, "X": 2}, sort_keys=True)`

(`None` is legal as a key in Python dict.)

Normally this is not an issue because `json.dumps()`'s default value for `sort_keys` is `False`. However, in Flask, default value for `JSON_SORT_KEYS` is alwasy `True` for caching ([reference](https://flask.palletsprojects.com/en/1.1.x/config/#JSON_SORT_KEYS)).

### Expected Behavior

Load the `main.py` module. When running
```python
FLASK_APP=main \
FLASK_DEBUG=1 \
python -m flask run
```
or 
```python
FLASK_APP=main \
FLASK_ENV=development \
python -m flask run
```
Doesn't really matter whats in the `main.py` file. I've used the hello world example and it still no work unless i DON't use `FLASK_ENV=development` or `FLASK_DEBUG=1 

i.e.  **this works**:
```python
FLASK_APP=main \
python -m flask run
```
?

### Actual Behavior
So with 
```pytb
 * Serving Flask app "main.py" (lazy loading)
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: on
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 338-897-245
127.0.0.1 - - [04/May/2020 12:17:28] "GET /api/random HTTP/1.1" 500 -
Traceback (most recent call last):
  File "/home/alex/dev/imagr/drgrouper/backend/__venv__/lib/python3.7/site-packages/flask/cli.py", line 240, in locate_app
    __import__(module_name)
ModuleNotFoundError: No module named 'main'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alex/dev/imagr/drgrouper/backend/__venv__/lib/python3.7/site-packages/flask/cli.py", line 338, in __call__
    self._flush_bg_loading_exception()
  File "/home/alex/dev/imagr/drgrouper/backend/__venv__/lib/python3.7/site-packages/flask/cli.py", line 326, in _flush_bg_loading_exception
    reraise(*exc_info)
  File "/home/alex/dev/imagr/drgrouper/backend/__venv__/lib/python3.7/site-packages/flask/_compat.py", line 39, in reraise
    raise value
  File "/home/alex/dev/imagr/drgrouper/backend/__venv__/lib/python3.7/site-packages/flask/cli.py", line 314, in _load_app
    self._load_unlocked()
  File "/home/alex/dev/imagr/drgrouper/backend/__venv__/lib/python3.7/site-packages/flask/cli.py", line 330, in _load_unlocked
    self._app = rv = self.loader()
  File "/home/alex/dev/imagr/drgrouper/backend/__venv__/lib/python3.7/site-packages/flask/cli.py", line 388, in load_app
    app = locate_app(self, import_name, name)
  File "/home/alex/dev/imagr/drgrouper/backend/__venv__/lib/python3.7/site-packages/flask/cli.py", line 250, in locate_app
    raise NoAppException('Could not import "{name}".'.format(name=module_name))
flask.cli.NoAppException: Could not import "main".
```

Also tried it in Python 3.6.9

### Environment

* Python version: 3.7.7
* Flask version: 1.1.2  
* Werkzeug version: 1.0.1

### Expected Behavior

Load the `main.py` module. When running
```python
FLASK_APP=main \
FLASK_DEBUG=1 \
python -m flask run
```
or 
```python
FLASK_APP=main \
FLASK_ENV=development \
python -m flask run
```
Doesn't really matter whats in the `main.py` file. I've used the hello world example and it still no work unless i DON't use `FLASK_ENV=development` or `FLASK_DEBUG=1`

i.e.  **this works**:
```python
FLASK_APP=main \
python -m flask run
```
?

### Actual Behavior
So with 
```pytb
 * Serving Flask app "main.py" (lazy loading)
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: on
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 338-897-245
127.0.0.1 - - [04/May/2020 12:17:28] "GET /api/random HTTP/1.1" 500 -
Traceback (most recent call last):
  File "/home/alex/dev/imagr/drgrouper/backend/__venv__/lib/python3.7/site-packages/flask/cli.py", line 240, in locate_app
    __import__(module_name)
ModuleNotFoundError: No module named 'main'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alex/dev/imagr/drgrouper/backend/__venv__/lib/python3.7/site-packages/flask/cli.py", line 338, in __call__
    self._flush_bg_loading_exception()
  File "/home/alex/dev/imagr/drgrouper/backend/__venv__/lib/python3.7/site-packages/flask/cli.py", line 326, in _flush_bg_loading_exception
    reraise(*exc_info)
  File "/home/alex/dev/imagr/drgrouper/backend/__venv__/lib/python3.7/site-packages/flask/_compat.py", line 39, in reraise
    raise value
  File "/home/alex/dev/imagr/drgrouper/backend/__venv__/lib/python3.7/site-packages/flask/cli.py", line 314, in _load_app
    self._load_unlocked()
  File "/home/alex/dev/imagr/drgrouper/backend/__venv__/lib/python3.7/site-packages/flask/cli.py", line 330, in _load_unlocked
    self._app = rv = self.loader()
  File "/home/alex/dev/imagr/drgrouper/backend/__venv__/lib/python3.7/site-packages/flask/cli.py", line 388, in load_app
    app = locate_app(self, import_name, name)
  File "/home/alex/dev/imagr/drgrouper/backend/__venv__/lib/python3.7/site-packages/flask/cli.py", line 250, in locate_app
    raise NoAppException('Could not import "{name}".'.format(name=module_name))
flask.cli.NoAppException: Could not import "main".
```

Also tried it in Python 3.6.9

### Environment

* Python version: 3.7.7
* Flask version: 1.1.2  
* Werkzeug version: 1.0.1

import flask or from flask import Flask

both generate the below. Not sure what to make of this also seems to be an issue on 3.8.2 i tried two different machines both end in the same result.

```
Traceback (most recent call last):
  File "C:\Users\user\Desktop\AlexaSkill\testingflask.py", line 1, in <module>
    import flask
  File "C:\Python38\lib\site-packages\flask\__init__.py", line 16, in <module>
    from werkzeug.exceptions import abort
  File "C:\Python38\lib\site-packages\werkzeug\__init__.py", line 15, in <module>
    from .serving import run_simple
  File "C:\Python38\lib\site-packages\werkzeug\serving.py", line 58, in <module>
    from http.server import BaseHTTPRequestHandler
  File "C:\Python38\lib\http\server.py", line 94, in <module>
    import http.client
  File "C:\Python38\lib\http\client.py", line 1352, in <module>
    import ssl
  File "C:\Users\user\Desktop\AlexaSkill\ssl.py", line 16, in <module>
    asyncio.get_event_loop().run_until_complete(hello())
  File "C:\Python38\lib\asyncio\base_events.py", line 616, in run_until_complete
    return future.result()
  File "C:\Users\user\Desktop\AlexaSkill\ssl.py", line 7, in hello
    async with websockets.connect(uri) as websocket:
  File "C:\Python38\lib\site-packages\websockets\client.py", line 517, in __aenter__
    return await self
  File "C:\Python38\lib\site-packages\websockets\client.py", line 535, in __await_impl__
    transport, protocol = await self._create_connection()
  File "C:\Python38\lib\asyncio\base_events.py", line 1030, in create_connection
    raise exceptions[0]
  File "C:\Python38\lib\asyncio\base_events.py", line 1010, in create_connection
    sock = await self._connect_sock(
  File "C:\Python38\lib\asyncio\base_events.py", line 924, in _connect_sock
    await self.sock_connect(sock, address)
  File "C:\Python38\lib\asyncio\proactor_events.py", line 702, in sock_connect
    return await self._proactor.connect(sock, address)
  File "C:\Python38\lib\asyncio\windows_events.py", line 808, in _poll
    value = callback(transferred, key, ov)
  File "C:\Python38\lib\asyncio\windows_events.py", line 595, in finish_connect
    ov.getresult()

ConnectionRefusedError: [WinError 1225] The remote computer refused the network connection
[Finished in 4.7s]
```
Removing apierrors.rst and errorpages.rst from patterns and integrating the content into errorhandling.rst. 

Content has also been added and edited. With a info about blueprint error handling in errorhandling.rst as well a link to blueprints.

NB: I've never edited Sphinx, so feedback is very welcome

Fixes #3573

Fixed a small typo.

Python 2.7.3 returns `False` and Python 3.3.2 throws an exception for the same code:

```
$ python2 -c 'import flask; print(flask.__version__); print(hasattr(flask.g, "xyz"))'
0.10.1
False
```

and Python 3:

```
$ python3 -c 'import flask; print(flask.__version__); print(hasattr(flask.g, "xyz"))'
0.10.1
Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "/usr/local/lib/python3.3/site-packages/werkzeug/local.py", line 338, in __getattr__
    return getattr(self._get_current_object(), name)
  File "/usr/local/lib/python3.3/site-packages/werkzeug/local.py", line 297, in _get_current_object
    return self.__local()
  File "/usr/local/lib/python3.3/site-packages/flask/globals.py", line 27, in _lookup_app_object
    raise RuntimeError('working outside of application context')
RuntimeError: working outside of application context
```


Seeing those apostrophes hurt my eyes... ;)

#570 broke compatibility with bound view methods.

Simplified flask-admin case:

``` python
from flask import Flask, Blueprint

app = Flask(__name__)

class Dummy(object):
    def __init__(self, app, name):
        self.name = name

        bp = Blueprint(name, __name__)
        bp.add_url_rule('/', 'view', self.view)
        bp.add_url_rule('/<test>/', 'view', self.view)

        app.register_blueprint(bp)

    def view(self, test=None):
        return 'hi'

obj1 = Dummy(app, 'test')
app.run(port=8002)
```

In Flask 0.9 it works as expected, but in Flask 0.10 it does not.

Cased by `is` check:

``` python
> obj.view is obj.view
False
```

I would appreciate listing and review for approval of Flask-MakeStatic, [code](https://github.com/DasIch/Flask-MakeStatic) and [documentation](https://flask-makestatic.readthedocs.org/en/latest/) are available. The extension supports 2.6, 2.7 and 3.3 and due to the latter requires Flask 0.10. Tests are included and can be run with `setup.py test` (which installs dependencies) and `make test` (which does not.)


https://github.com/mitsuhiko/flask/blob/master/flask/app.py#L999

The documentation for Flask.route() seems to show options that don't apply to the decorator.

On a clean virtualenv with python 3.3.1 and latest versions of werkzeug/flask from git, then running this:

``` python
from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello_world():
   return 'Hello World!'

if __name__ == '__main__':
    app.run(debug=True)
```

produces this:

```
(newenv) C:\Users\nyctef\testenv>python test.py
 * Running on http://127.0.0.1:5000/
 * Restarting with reloader
Traceback (most recent call last):
  File "test.py", line 9, in <module>
    app.run(debug=True)
  File "C:\Users\nyctef\testenv\newenv\lib\site-packages\flask-0.10_dev_20130605-py3.3.egg\flask\app.py", line 761, in run
    run_simple(host, port, self, **options)
  File "C:\Users\nyctef\testenv\newenv\lib\site-packages\werkzeug-0.9_devdev_20130605-py3.3.egg\werkzeug\serving.py", line 704, in run_simple
    run_with_reloader(inner, extra_files, reloader_interval)
  File "C:\Users\nyctef\testenv\newenv\lib\site-packages\werkzeug-0.9_devdev_20130605-py3.3.egg\werkzeug\serving.py", line 613, in run_with_reloader
    sys.exit(restart_with_reloader())
  File "C:\Users\nyctef\testenv\newenv\lib\site-packages\werkzeug-0.9_devdev_20130605-py3.3.egg\werkzeug\serving.py", line 597, in restart_with_reloader
    exit_code = subprocess.call(args, env=new_environ)
  File "C:\Python33\Lib\subprocess.py", line 520, in call
    with Popen(*popenargs, **kwargs) as p:
  File "C:\Python33\Lib\subprocess.py", line 820, in __init__
    restore_signals, start_new_session)
  File "C:\Python33\Lib\subprocess.py", line 1106, in _execute_child
    startupinfo)
TypeError: environment can only contain strings
```

Removing debug=True makes it work, but having debug mode would be nice :)

I noticed that SERVER_NAME is used but `Flask.run()` doesn't use it. This PR enables run() to use SERVER_NAME if set and will still allow host and port to override whatever is set in SERVER_NAME.

_route_ method takes *_options which catches all keyword arguments and passes it further to *url_rule_class_ which -- in case of typo like 'method' instead of 'methods' -- leads to misleading exception:

``` traceback
[..]
File "/[..]/python2.7/site-packages/flask/app.py", line 943, in add_url_rule
  rule = self.url_rule_class(rule, methods=methods, **options)
TypeError: __init__() got an unexpected keyword argument 'method'
```

Jinja template test `g.nonexistent_var is defined` returns `True` in Flask latest git version and `False` in Flask 0.9. I think commit 09735369 broke this (`__getitem__` returns `None` instead of raising `AttributeError`).

```
from flask import Flask, redirect
app = Flask(__name__)

@app.route('/blah')
def blah():
    return 'blah'

app.add_url_rule('/', view_func=lambda: redirect('/blah'))
```

Run it like this:

```
uwsgi --plugin python27 --http 0.0.0.0:31337 --module app --callable app --virtualenv .
```

Then access it, e.g. using httpie:

```
http get http://myhost:31337
```

uwsgi shows this error:

```
Traceback (most recent call last):
  File "/tmp/werkzeug-uwsgi-unicode-headers/lib/python2.7/site-packages/flask/app.py", line 1829, in __call__
    return self.wsgi_app(environ, start_response)
  File "/tmp/werkzeug-uwsgi-unicode-headers/lib/python2.7/site-packages/flask/app.py", line 1814, in wsgi_app
    return response(environ, start_response)
  File "/tmp/werkzeug-uwsgi-unicode-headers/lib/python2.7/site-packages/werkzeug/wrappers.py", line 1103, in __call__
    start_response(status, headers)
TypeError: http header key must be a string
```

a `print headers` in `__call__` shows this:

```
[('Content-Type', 'text/html; charset=utf-8'), ('Content-Length', '217'), (u'Location', 'http://myhost:31337/blah')]
```

I need client http connection by incoming http request in Flask and looking for best solution with connection pool.

# Flask-doc Korean translation

We translated Flask-Docs User's Guide in to Korean.
## Changes
- move all contents of **flask/docs/** to **flask/docs/en/**
  - however, it is cause some problems in directory structure depth... i know..
- and create a directory **flask/docs/ko/** 
- then we translated all part of User's Guide (English to Korean)
- You can see the HTML build result of document below:
  - http://kswa.codingstar.net:14705/html/

We want to finish this translations, please give me a your comment.

Thank you for flask & flask community!

if the context is preserved for later inspection, it doesn't get popped off the stack immediately, but later, when the next context gets pushed. And when it does eventually get popped, the `teardown_appcontext` handler is called with no exception, instead of the one that was handled by the debugger. this is causing the Flask-SQLAlchemy extension to `commit()` the session even though the `rollback()` method should have been called instead.

(see https://github.com/mitsuhiko/flask-sqlalchemy/issues/131 and https://github.com/mitsuhiko/flask-sqlalchemy/issues/115)

thanks to @mgax for the further investigation of the issue

I believe the issue was fixed on the Werkzeug side, but I think there still may be a bug in Flask.

When I have a url of the form /someurl/<name>, where name is non-ascii (specifically, cyrillic), my app does not fetch the right template/file. It works fine under Python 2.

If I have a top-level URL of the form /тест, and attempt to access it, I get a 404. I believe Werkzeug handles the request correctly, but I don't know at which point it gets mangled into something which doesn't get me to the endpoint (for example, <Request 'http://localhost:1111/ÑÐµÑÑ' [GET]>). That last bit is UTF-8 which is for some reason rendered as ISO-8859-1.

Any suggestions as to where in the framework (either Flask or Werkzeug) this could be happening?

in flask/views.py I find the following code will cause request handle to be less efficient. I think that class_args and class kwargs will not be changed after app started, so bind a instance with view function to handle requests will be safe. However,  programmers should not modify the instance status.

``` python
    @classmethod
    def as_view(cls, name, *class_args, **class_kwargs):
        """Converts the class into an actual view function that can be used
        with the routing system.  Internally this generates a function on the
        fly which will instantiate the :class:`View` on each request and call
        the :meth:`dispatch_request` method on it.

        The arguments passed to :meth:`as_view` are forwarded to the
        constructor of the class.
        """
        def view(*args, **kwargs):
            self = view.view_class(*class_args, **class_kwargs)
            return self.dispatch_request(*args, **kwargs)

        if cls.decorators:
            view.__name__ = name
            view.__module__ = cls.__module__
            for decorator in cls.decorators:
                view = decorator(view)

        # we attach the view class to the view function for two reasons:
        # first of all it allows us to easily figure out what class-based
        # view this thing came from, secondly it's also used for instantiating
        # the view class so you can actually replace it with something else
        # for testing purposes and debugging.
        view.view_class = cls
        view.__name__ = name
        view.__doc__ = cls.__doc__
        view.__module__ = cls.__module__
        view.methods = cls.methods
        return view
```

The sweet web app console built into [Firebug](https://www.getfirebug.com) is easily accessible to JavaScript programmers via `console.log()`. The [FireLogger](http://firelogger.binaryage.com) extension lets server-side languages like PHP and Python write directly to the same console. In Python's case, via the [FirePython](https://pypi.python.org/pypi/FirePython) module. 

<a href="http://static.binaryage.com/c079fa5c_shared_img_firelogger4php-mainshot-full.png" target="_blank"><img src="http://static.binaryage.com/ddfd1510_shared_img_firelogger4php-mainshot.png"></a>

Unfortunately, Python integration is web-framework specific. Django is directly supported; Flask is not. FirePython already supports WSGI, so using it with Flask / Werkzeug should be straightforward. But it's not--at least not for me. The documentation basically says "read the source and figure it out." Given that I'm a complete novice with Flask's WSGI underpinnings, my efforts have flopped around without success.

So this is a request to those in the Flask community who are conversant with WSGI, Werkzeug, and `logging` to have a look and provide a recipe for how to link these individually great, but as yet not-talking-to-one-another, components. Looking at the code, I'd bet there's a <15 lines of code incantation that would do the trick; I just can't see the right permutation. 

FWIW, this is the opposite of a one-off support request; easy Firebug logging would make an awesome app debugging facility for many Flask / webapp developers.


Allow blueprints to have nested blueprints registered on them. This allows scenarios like this:

`/users` -> `users_blueprint with url_prefix = '/users'` registered on the app
`/users/<id>` -> `user_blueprint with url_prefix = '/<id>'` registered on the users_blueprint

see commit 5974ed2 for further documentation.

This implements issue #593 by adding @dontcare4free's solution into the `Blueprint` class.

SetUp  

> VirtualBox | Ubuntu Server 12.04.2  
> (flaskve)vks@UbSrVb:~/flaskve$ python --version  
> Python 2.7.3  
> ifconfig  
> 192.168.1.100  (the bridge interface on which i interact with VirtualBox) 

code I am trying to run.

```
from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello World!'

if __name__ == '__main__':
    app.run(host='192.168.1.100', port=8080, debug=True)
```

When I do 

```
(flaskve)vks@UbSrVb:~/flaskve$ python start.py 
(flaskve)vks@UbSrVb:~/flaskve$
```

It does not run or do anything, it just returns back to command prompt. Although I am running in debug=True mode.  
I then made a new VirtualEnv and install bottle in that. When I tried to run helloworld it shows the same behaviour.  
However I then started the python shell on the same virtualenv, imported bottle modules and ran   

> ```
> >>> from bottle import route, run
> >>> run(host='192.168.1.100', port=8081, debug=True)
> Bottle v0.11.6 server starting up (using WSGIRefServer())...
> Listening on http://192.168.1.100:8081/
> Hit Ctrl-C to quit.  
> ```

What could be problem here ? 
Even debug does not show anything.  
Following link is the output of `python -v start.py`  
http://paste.ubuntu.com/5713138/

http://flask.pocoo.org/extensions/

every http://packages.python.org url needs to be changed to http://pythonhosted.org, because the former will be shut down eventually (and today it faced dns problems, so I noticed it).



TODO: why was that bug not causing / displaying an exception somehow?
      should give a TypeError in py 3.3.



app.open_resource needs to get called with the correct mode param (python3
will read bytes [not str] if the wrong mode is used), add mode param docs.

rv.data is bytes, fix the data type we compare it with to be also bytes



If ensure_clean_request_context found a leak, it would raise an AssertionError
and not clean up the leak, and therefore affect other testcases.

hi, I have thought that if flask use a URLConfig moudule instead of the derecrator of functions as its router, which like Django urls.py,  and built-in regular-expression will help it make big projects. 
yes or no?


still lots of bytes vs unicode stuff to do

also some strange test fails on 2.7, please have a look







Now that Github [supports redirects](https://github.com/blog/1508-repository-redirects-are-here), maybe it's time to consider moving Flask, and core extensions (Flask-SQLAlchemy, Flask-OAuth, etc) into an organization.

Thoughts from the team?


Change Flask.build_error_handler to the correct Flask.url_build_error_handlers.


Hi,

This drove me crazy, until I took a look at the source code of the jsonify method.

In the documentation for jsonify, it should state that it uses the request.is_xhr method to render either compact JSON or pretty print JSON depending on the X-Requested-With header.

Thanks for Flask.



Hi All,

I'm just wondering if anyone has deployed flask restful service on IIS? Is there any guide around this area ?

Thanks,
Ahad

I just realized that the headline "And easy to setup" might trick the user into thinking that's all it takes to setup a Flask app _on the production server_.

Of course the exact opposite is stated in the quickstart, but then we never can expect people to actually read documentation.

Independent of whether this is really an issue anybody else but me sees, i think a large "Get Started" button on the front page might animate people to read the docs from the beginning.

Thoughts on this?

Django includes it. I might be bias, but pretty much everyone needs it :)


The documentation on Celery integration is found in the source code at:
https://github.com/mitsuhiko/flask/blob/master/docs/patterns/celery.rst

However, it does not appear in the online documentation:
http://flask.pocoo.org/docs/

What do you think about adding these helpers to make it a little more pleasant to deal with the situation where you are defining a restful system where each verb is handled explicitly for many endpoints?  Thanks.

Why isn't `request.data` of type `unicode`? The following test application reveals that the type is `str`.

```
from flask import Flask, request
app = Flask(__name__)

@app.route('/', methods=['POST'])
def index():
    return str(type(request.data))

if __name__ == '__main__':
    app.run(debug=True)
```

This is an issue if, for example, I have a Flask application that receives a JSON string as request data, then attempts to insert that data into a database that requires a unicode value.


I've fixed "assigment" to "assignment".

### Rationale

Some `Views` could be created and used only once, for example `MethodViews` instead of "standard" functions with `if request.method == 'POST'`. This kind of use could be made easier.
### Proposal

Instead of writing:

```
class MyFantasticView(View):
    ...
app.add_url_rule('/fantastic/', view_func=MyFantasticView.as_view('fantastic'))
```

we could make it easier and consistent with other parts of the API:

```
@app.route('/fantastic/', endpoint='fantastic')
class MyFantasticView(View):
    ...
```

When I render this template and serve it using the development server, it works correctly in Chrome, Safari and IE:

```
<video id="video" controls>
  <source src="{{ url_for('static', filename='videos/trailer.mp4') }}" type="video/mp4">
  <source src="{{ url_for('static', filename='videos/trailer.webm') }}" type="video/webm">
</video>
```

When I try to load the same page with an iOS device I see the following exception:

```
192.168.0.116 - - [10/Apr/2013 10:42:57] "GET /static/videos/trailer.mp4 HTTP/1.1" 200 -
----------------------------------------
Exception happened during processing of request from ('192.168.0.116', 52979)
Traceback (most recent call last):
  File "/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/SocketServer.py", line 284, in _handle_request_noblock
    self.process_request(request, client_address)
  File "/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/SocketServer.py", line 310, in process_request
    self.finish_request(request, client_address)
  File "/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/SocketServer.py", line 323, in finish_request
    self.RequestHandlerClass(request, client_address, self)
  File "/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/SocketServer.py", line 641, in __init__
    self.finish()
  File "/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/SocketServer.py", line 694, in finish
    self.wfile.flush()
  File "/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/socket.py", line 303, in flush
    self._sock.sendall(view[write_offset:write_offset+buffer_size])
error: [Errno 32] Broken pipe
```

If I replace the template with:

```
<video id='video'
    controls preload='none' 
    poster="http://media.w3.org/2010/05/sintel/poster.png">
    <source id='mp4'
    src="http://media.w3.org/2010/05/sintel/trailer.mp4"
    type='video/mp4'>
    <source id='webm'
    src="http://media.w3.org/2010/05/sintel/trailer.webm"
    type='video/webm'>
    <source id='ogv'
    src="http://media.w3.org/2010/05/sintel/trailer.ogv"
    type='video/ogg'>
    <p>Your user agent does not support the HTML5 Video element.</p>
</video>
```

Taken from, http://www.w3.org/2010/05/video/mediaevents.html

The video plays as expected on all devices I have tried it on (iPad and iPhone)

Warn about issue 348's issue, at least until it is resolved.

The page http://flask.pocoo.org/docs/deploying/others/ is missing from the ToC - this can be seen by clicking "Prev" and noticing it doesn't appear on the previous page's "Next" link.

No need to manually initialize the database with a call to `init_db()` as this call is done before `app.run()` in flaskr.py, when you run the file.

`Flask.process_response` will throw away functions is receives from `ctx._after_request_functions` if there is a Blueprint that has used `@after_request`.

The documentation for errorhandler gives "app.error_handler_spec[None][404] = page_not_found" as an example for adding an error handler without the decorator.  However, register_error_handler appears to be the correct way to do this (added 0.7), and it eliminates the problems with modifying error_handler_spec directly.

Hello.

I want to propose my small extension _flask-mongo-sessions_ to review for approval.
The aim of the extension is to provide your sites with server-side sessions stored in MongoDB.
The project lives [here](https://github.com/ivanyu/flask-mongo-sessions). [Documentation](https://flask-mongo-sessions.readthedocs.org/en/latest/) and [PyPI package](https://pypi.python.org/pypi/flask-mongo-sessions/) are available.

If something is wrong, I'll be glad to receive a feedback.

Regards,
Ivan.

The example didn't work since the html attributes weren't enclosed in quotation marks. It works now!
**update**
This was rather silly of me but well, thanks to @untitaker today I got to know that attributes not enclosed in quotes are allowed as of HTML5.

First, sorry if not Flask-related, but It's the most magical thing we use in our setup, so most suspicious one.

Our setup:

```
Flask==0.9
Jinja2==2.6
Werkzeug==0.8.3
gevent==0.13.8
greenlet==0.4.0
gunicorn==0.17.2
msgpack-python==0.3.0
psycopg2==2.4.6
redis==2.7.2
setproctitle==1.1.7
wsgiref==0.1.2
```

As I can see in gc info, we are leaking threads and Semaphores in it.

The application logic is pretty simple:
- parse data from the user
- store it in postgres and redis
- say user that everything is fine (or not)

And we are running it behind gunicorn. 

I have no idea what could cause such leakage and gc information drives me crazy, because It's too much of it (and most of It are pretty useless).

Guys, if someone faced similar problem or have and idea what's going on, please help or It will drive me crazy.

Thanks in advance,
Vladimir.


Corrected the link to the Google Developer hosted libraries site in the documentation (docs/patterns/jquery.rst). 

Updated the example to point to the current jQuery 1.9.1.

Minor typo fixes and slight rewording.

I am new to flask and it took me half an hour to figure out why jsonify doesn't work for me. So answer has pointed out solution for me: http://stackoverflow.com/questions/10727366/jsonify-is-not-defined-internal-server-error . I thought that this import line in example can help out newcomers, like me, in a future.

This will allow UUID encoding in `jsonify`. UUID is straightforward to convert.

Hope that helps,

Charles

- There's no 'tests/' directory, so that rule is invalid
- *.py[co] is in '.gitignore', so those recursive-exclude rules
    are only throwing warnings.
- The prune rules match against directories that no longer exist.

These changes eliminate the warnings that you see when you
`pip install flask`.

I add a specific header in JavaScript as follows:

``` javascript
var xhr = new XMLHttpRequest();
if (xhr.upload && file.type == "image/jpeg" && file.size <= $id("MAX_FILE_SIZE").value) {
// start upload
xhr.open("POST", $id("upload").action, true);
xhr.setRequestHeader("X-FILENAME", file.name);
xhr.send(file);
```

...and then I get the request as a POST in my Flask application and dump the headers. Therein is the `X-Filename` header.

``` bash
in POST
Header:  ('Cookie', 'csrftoken=gWf8wkaqKjq1szyCbxSzaxxxxxxxxxx; splashShown1.6=1')
Header:  ('Origin', 'http://localhost:5000')
Header:  ('Content-Length', '8355')
Header:  ('User-Agent', 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_3) AppleWebKit/536.28.10 (KHTML, like Gecko) Version/6.0.3 Safari/536.28.10')
Header:  ('Connection', 'keep-alive')
Header:  ('Referer', 'http://localhost:5000/')
Header:  ('X-Filename', 'hamster_jedi.jpg')
Header:  ('Host', 'localhost:5000')
Header:  ('Accept', '*/*')
Header:  ('Accept-Language', 'en-us')
Header:  ('Content-Type', 'application/x-www-form-urlencoded')
Header:  ('Accept-Encoding', 'gzip, deflate')
Header:  ('Referer', 'http://localhost:5000/')
Header:  ('Origin', 'http://localhost:5000')
Header:  ('Content-Length', '294')
Header:  ('User-Agent', 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_3) AppleWebKit/536.28.10 (KHTML, like Gecko) Version/6.0.3 Safari/536.28.10')
Header:  ('Connection', 'keep-alive')
Header:  ('Cookie', 'csrftoken=gWf8wkaqKjq1szyCbxSzaxxxxxxxxxx; splashShown1.6=1')
Header:  ('Host', 'localhost:5000')
Header:  ('Accept', 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8')
Header:  ('Accept-Language', 'en-us')
Header:  ('Content-Type', 'multipart/form-data; boundary=----WebKitFormBoundaryrBnRQT9BcQBT8DPb')
Header:  ('Accept-Encoding', 'gzip, deflate')
```

The X-Filename header is not retrievable using the following code in my simple Flask app.

``` python
        if request.method == 'POST':
        print 'in POST'
        for h in request.headers:
            print "Header: ", h   # dump shown above
        filename = request.headers.get('X-Filename')
        print 'X-Filename:', filename, ':'
```

The output I receive is:

``` bash
X-Filename: None :
```

I don't know if this is a bug, but I've tried sending and retrieving `X_Filename`, `X_FILENAME`, `X-FILENAME`, and `X-Filename` ... all without luck.

Please see issue #686.

Fix #691




Should it send a signal while `register_blueprint` been calling? Sometime we may expect to initialize something while a new blueprint been loading.

filname:
русс_-{}[](),.ss.»’”›⸃!"#%&',:;?.jpg

request.files misses everything after ":":

```
  <FileStorage: u'"\u0440\u0443\u0441\u0441_-{}[](),.ss.\xbb\u2019\u201d\u203a\u2e03!\\"#%&\',:' ('image/jpeg')>
```

Improved consistency: lower cased all hexadecimal descriptions of colors.

This is an extension to help with asset compression/minification.

GitHub Repo:
https://github.com/rehandalal/flask-funnel

If we send a signal when a template is rendered why not when a message
is flashed? One real world use case is in tests, this signal should make
flash messages expectation easier to implement.

I might implement it if you find the idea interesting: what do you think of raising  `JSONBadRequest` when trying to access an item that does not exist in the JSON data?

Just like `request.form["absent"]` will raise `BadRequest`, it seems logical that `request.json["absent"]` raises `JSONBadRequest`.

It is yet unclear to me whether `flask` or `werkzeug` is responsible for it. The `BadRequest` behavior is defined in `werkzeug` but `JSONBadRequest` is defined in `flask`. Also, `flask` already raise `JSONBadRequest` when accessing `request.json` and the JSON parsing failed.

Thanks a lot,

Charles

This is an extension to help with the development of mobile-friendly sites.

GitHub Repo:
https://github.com/rehandalal/flask-mobility

Allows you to directly yield data from the view instead of having to make an inner function whose return value you pass to `flask.Response`.

I've been re-acquainting myself with flask after a number of months and found a couple of things in the docs that I felt could do with a fix.

I won't be offended if you think these are pointless changes and discard - but thought I'd submit a PR anyway...

There are several issues currently with the mailing list on librelist:
1. The website (http://librelist.com/) is currently down. This might be transient, or this might be because the service has been slowly decaying over the last months.
2. The synchro to http://flask.pocoo.org/mailinglist/archive/ is broken since 2012/10/29.
3. I've been unsubscribed a few months ago due to transient a problem with my DNS. I have since tried many times to subscribe again with the same address, with no success. This may be a very specific problem, or this may be a manifestation of more general issues with the mailing list management system.
4. I have also tried registering with gmail adresses created just for the purpose of reading the Flask mailing list. I've had mixed successes, and I've also noticed that some of the emails I could see on the librelist.com archives were not delivered to my account(s).
5. AFAICT, traffic to the mailing list has been going down over approximately the last 2-3 months. This might be because interest in Flask is slowly fading away (if true, bad news for us Flask users), or this might be because of some of the technical issues I've mentioned above (or others), in which case proactive actions should be taken to keep users engaged.

For these reasons, I'm wondering if moving to another mailing list management platform would not be appropriate.

  S.

Couldn't find anything about pull request policies for this project, but I figured I'd pitch in quick documentation fix while I had some free time. Thanks for your work. ;)

I've just upgraded to the newest Flask version - 0.9.
I have to use Flask with CGI and I use .htaccess rule to rewrite the urls:
RewriteRule ^([a-zA-Z0-9-\/\?]*)$ main.py/$1 [L]

In version 0.8 I didn't have any problems but now url_for() doesn't rewrite the rule and urls come with 'main.py' - http://localhost/zaemide/main.py/funding

I am using Flask 0.8 on developing server WAMP.
On production server I have no problem uploading images. But when I send the form to the localhost I get ClientDisconnected: 400: Bad Request.

It is enough just to have the enctype="multipart/form-data" atribute to get the error, doesn't matter if there is a file uploaded or not. Wnen I try to get request.form or request.files I get error.

I tested to upload with PHP on the same server and it works. There must be something between Flask and WAMP.

---

The imports:

from flask import Flask, request, session, g, redirect, url_for, abort, render_template, flash, _request_ctx_stack, current_app, get_flashed_messages
from werkzeug import secure_filename

---

The handler:

@app.route('/upload', methods=['GET', 'POST'])
@requires_admin
def upload():
 if request.method == 'POST':
  id = request.form['id']
  img = request.files['img']
  ...

---

The traceback:

Traceback (most recent call last):
File "C:/wamp/www/zaemide/main.py", line 203, in edit
form = request.form.copy()
File "C:\wamp\www\vedacon\werkzeug\local.py", line 336, in **getattr**
return getattr(self._get_current_object(), name)
File "C:\wamp\www\vedacon\werkzeug\utils.py", line 77, in __get__
value = self.func(obj)
File "C:\wamp\www\vedacon\werkzeug\wrappers.py", line 383, in form
self._load_form_data()
File "C:\wamp\www\vedacon\flask\wrappers.py", line 119, in _load_form_data
RequestBase._load_form_data(self)
File "C:\wamp\www\vedacon\werkzeug\wrappers.py", line 318, in _load_form_data
data = parser.parse_from_environ(self.environ)
File "C:\wamp\www\vedacon\werkzeug\formparser.py", line 164, in parse_from_environ
return self.parse(stream, mimetype, content_length, options)
File "C:\wamp\www\vedacon\werkzeug\formparser.py", line 188, in parse
content_length, options)
File "C:\wamp\www\vedacon\werkzeug\formparser.py", line 100, in wrapper
stream.exhaust()
File "C:\wamp\www\vedacon\werkzeug\wsgi.py", line 782, in exhaust
self.read(chunk)
File "C:\wamp\www\vedacon\werkzeug\wsgi.py", line 800, in read
return self.on_disconnect()
File "C:\wamp\www\vedacon\werkzeug\wsgi.py", line 768, in on_disconnect
raise ClientDisconnected()
ClientDisconnected: 400: Bad Request

Thanks!

Flask only logs in debug mode.

`handle_exception` raises an exception in debug, else returns an `InternalServerError` and logs the exception.

Except that by default, it can't log the exception because it's in debug.

This is mostly just an annoyance as long as you are running with `run_simple`, as the Werkzueg debugger will log the exception that got re-raised in `handle_exception` and provide you with a great debugging interface. However, if you switch to a different WSGI engine, you end up with no way to see a traceback.

In app.py handle_exception:

```
    if self.propagate_exceptions:
        # if we want to repropagate the exception, we can attempt to
        # raise it with the whole traceback in case we can do that
        # (the function was actually called from the except part)
        # otherwise, we just raise the error again
        if exc_value is e:
            raise exc_type, exc_value, tb
        else:
            raise e

    self.log_exception((exc_type, exc_value, tb))
    if handler is None:
        return InternalServerError()
    return handler(e)
```

Go to the quickstart guide:

http://flask.pocoo.org/docs/quickstart

Search for "get the result object". I suspect it should be "get the response object" because the subsequent code fragment is dealing with the response object.

os.unlink(flaskr.DATABASE) causes the actual application database to be
purged; whereas, I reckon, one wants the _test_ database to be removed.
So every time I ran it, the test passed, but ended up crashing the live
app for want of a valid database.

I avoided using the sample code in examples/flaskr thus far, as I chose
to type out code from the turorial docs. The actual example code looks
good - at least to my beginner's eye.

Any attempt to run pylint or pychecker on anything that uses any Flask extension, e.g.:

```
from flask.ext.login import user_logged_in, user_logged_out
```

 produces errors like the following:

```
F:  5,0: Unable to import 'flask.ext.login'
E:  5,0: No name 'login' in module 'flask.ext'
```

Some documentation is needed how to coerce pylint and pychecker into understanding how flask.ext.login is imported.

JSON standard (http://json.org/) say, that any entity can be object or array.
When I try:

```
jsonify(['a','b','c', 'd', 'e', 'f'])
```

I got an error:

```
ValueError: dictionary update sequence element #0 has length 8; 2 is required
```

I think it is not a correct answer from flask. It should returns a JSON-object with array.

I am very curious about logo images in the pages of Flask site, such as:

![](http://flask.pocoo.org/static/snippets.png)
![](http://flask.pocoo.org/static/community.png)

...

This black and white style is very attractive to me, and I wonder how to generate this style image.

Would you give me some tips? Thanks.

I'm using Flask to implement an app that returns JSON for most requests including error responses for bad requests, page not found, etc.

To do this I wrapped the default `handle_http_exception` method of the app similar to how it was handled in the Flask_exceptional module https://github.com/jzempel/flask-exceptional/blob/master/flask_exceptional.py so that I could return the Response as JSON rather than the default generated HTML.

What I found was that any views that used the Flask `redirect` function rendered the redirect as HTML. However, if you add a route which ends with a slash, Werkzeug's routing code will automatically fire off a `RequestRedirect` which would get caught by the `handle_http_exception` and rendered as JSON.

In send_file you can explicitly set the filename using attachment_filename, but when attempting to guess the mimetype previously the code would prefer the real filename, this reverses that preference.

Our use case is that the real filename on disk is just a hash, and so the mime type cant be guessed anyway. You can of course explicitly set the mime type as well, but imo if a filename is explicitly passed in that should take precedence

Hey guys,

I have a problem with the session variable functionality.
I am assigning some variables that contain JSON Objects to session variables. 
Something like

`variable = {'modell': 'Vertrag', 'lagerort': '4-01-N', 'lagerid': 306816, 'p3barcode': 'L18100017', 'devicegroup': 'SIM Karten', 'devicegroupid': 10, 'verliehenan': 'EBP (Bernd Eppinger)', 'lagerbarcode': 'L16050068', 'hersteller': 'T-Mobile', 'status': 'Mitarbeiter zugewiesen'}`
`session['abc'] = variable`

This is working BUT
if the data in varaible gets too big, the session variable is not beeing saved.

I thought it is a issue with the cookie size, however on the https://www.tutorialspoint.com/flask/flask_sessions.htm is metioned, that sessions are stored on the server - so there should not be a limit?
Is there a way how can I store a large variable a session variable?

Thanks in advance
Describe what this patch does to fix the issue.

Link to any relevant issues or pull requests.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->



### Expected Behavior

Running it on a new VPS. setup.py used is:     
https://github.com/Zethson/dark-proteome-visualization/blob/development/setup.py    
with requirements.txt used:    
https://github.com/Zethson/dark-proteome-visualization/blob/development/requirements.txt

 ```python
python setup.py clean --all install
```

Finds flask and installs flask.

### Actual Behavior

Searching for flask
Downloading https://files.pythonhosted.org/packages/05/2f/6a545452040c2556559779db87148d2a85e78a26f90326647b51dc5e81e9/Flask-Mail-0.9.1.tar.gz#sha256=22e5eb9a940bf407bcf30410ecc3708f3c56cc44b29c34e1726fe85006935f41
Best match: Flask Mail-0.9.1
Processing Flask-Mail-0.9.1.tar.gz

I tried pretty much all combinations of capital/lowercase for flask and flask-mail. No success. Interestingly enough, if I run the install script again (same virtual environment), it finds flask.


```pytb
error: The 'flask' distribution was not found and is required by flask-Mail
```

### Environment

* Python version: Python 3.6.7
* Flask version: latest
* Werkzeug version: latest

Fix typo in CHANGES.rst
### Expected Behavior
I created a custom url regular handler, which works in the app.route, but does not take effect in the api.route of the blueprint. The error message is: File "d:\Anaconda3\lib\site-packages\ Werkzeug\routing.py", line 696, in get_converter
     Raise LookupError('the converter %r does not exist' % converter_name)
LookupError: the converter 'regex' does not exist
·

```python
from werkzeug.routing import BaseConverter

class RegexConverter(BaseConverter):
    def __init__(self, map, *args):
        self.map = map
        self.regex = args[0]

app.url_map.converters['regex'] = RegexConverter

manager = Manager(app)

# Printed here has regex
print('\n\n',app.url_map.converters,'<---------------->',manager.app.url_map.converters,'\n\n')

```

But I printed it in routing.Rule.get_converter but there is no regex in self.map.converters

  {'default': <class 'werkzeug.routing.UnicodeConverter'>, 'string': <class 'werkzeug.routing.UnicodeConverter'>, 'any': <class 'werkzeug.routing.AnyConverter'>, 'path': <class 'werkzeug.routing.PathConverter'>, 'int': <class 'werkzeug.routing.IntegerConverter'>, 'float': <class 'werkzeug.routing.FloatConverter'>, 'uuid': <class 'werkzeug. routing.UUIDConverter'>}


### Actual Behavior

The data for app.url_map.converters is not passed to the blueprint

```pytb
Traceback (most recent call last):
  File "devServer.py", line 5, in <module>
    from manage import app
  File "D:\py3\ytt\manage.py", line 30, in <module>
    app = create_app('development')
  File "D:\py3\ytt\app\__init__.py", line 62, in create_app
    app.register_blueprint(api_bp)
  File "d:\Anaconda3\lib\site-packages\flask\app.py", line 66, in wrapper_func
    return f(self, *args, **kwargs)
  File "d:\Anaconda3\lib\site-packages\flask\app.py", line 1115, in register_blueprint
    blueprint.register(self, options, first_registration)
  File "d:\Anaconda3\lib\site-packages\flask\blueprints.py", line 187, in register
    deferred(state)
  File "d:\Anaconda3\lib\site-packages\flask\blueprints.py", line 208, in <lambda>
    s.add_url_rule(rule, endpoint, view_func, **options))
  File "d:\Anaconda3\lib\site-packages\flask\blueprints.py", line 80, in add_url_rule
    view_func, defaults=defaults, **options)
  File "d:\Anaconda3\lib\site-packages\flask\app.py", line 66, in wrapper_func
    return f(self, *args, **kwargs)
  File "d:\Anaconda3\lib\site-packages\flask\app.py", line 1216, in add_url_rule
    self.url_map.add(rule)
  File "d:\Anaconda3\lib\site-packages\werkzeug\routing.py", line 1217, in add
    rule.bind(self)
  File "d:\Anaconda3\lib\site-packages\werkzeug\routing.py", line 687, in bind
    self.compile()
  File "d:\Anaconda3\lib\site-packages\werkzeug\routing.py", line 741, in compile
    _build_regex(self.is_leaf and self.rule or self.rule.rstrip('/'))
  File "d:\Anaconda3\lib\site-packages\werkzeug\routing.py", line 730, in _build_regex
    variable, converter, c_args, c_kwargs)
  File "d:\Anaconda3\lib\site-packages\werkzeug\routing.py", line 696, in get_converter
    raise LookupError('the converter %r does not exist' % converter_name)
LookupError: the converter 'regex' does not exist
```

### Environment

* Python version:3.6
* Flask version:1.02
* Werkzeug version:0.14.1

When you use Flask in combination with Click 7.x, command containing underscores are no longer found, but instead exposed using dashes, so the example in the docs `create_user` only works as `create-user`.

I've extended the docs to mention this, including an example and a workaround.

The issue is mentioned here as well:
https://github.com/pallets/flask/issues/2931
https://github.com/pallets/click/issues/1123

This is the commit in Click that changes the behaviour:
https://github.com/pallets/click/commit/5d1df0e042b2f8b0dee8f6dd9ce74edce331a950

### Expected Behavior

When sending files with unicode filename (with `:` or `/`) they should be downloaded with name from `filename*` field.

```python
# -*- coding: utf-8 -*-
import os
from flask import Flask, send_from_directory
app = Flask(__name__)
@app.route('/test/', methods=['GET'])
def test_route():
    tmp_dir = os.getcwd()
    tmp_filename = __file__
    attachment_filename = u'тест:тест_тест.py'
    return send_from_directory(
        tmp_dir,
        tmp_filename,
        as_attachment=True,
        attachment_filename=attachment_filename
    )
if __name__ == '__main__':
    app.run(host='::', port=5000)
```
### Actual Behavior

Some browsers (Chrome-based/Safari) ignore `filename*` field when it contains colon or slash. For example file `тест:тест_тест.py` gets downloaded in Chrome/Safari as `__.py` but in Firefox as `тест_тест_тест.py` which is acceptable in my opinion.

Flask response:
`Content-Disposition: attachment; filename*="UTF-8''%D1%82%D0%B5%D1%81%D1%82:%D1%82%D0%B5%D1%81%D1%82_%D1%82%D0%B5%D1%81%D1%82.py"; filename=":_.py"`

### Environment

* Python version: 2.7.15
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

Add a link to deployment instructions for [Render](https://render.com). I noticed the Heroku instructions actually link to a Django project. I created a Flask guide [here](https://render.com/docs/deploy-flask/) which is linked in this PR.
just installed flask on python 3.6 using pip3

```
$ pip3 install flask
Requirement already satisfied: flask in /Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages (1.0.2)
Requirement already satisfied: Werkzeug>=0.14 in /Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages (from flask) (0.14.1)
Requirement already satisfied: itsdangerous>=0.24 in /Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages (from flask) (0.24)
Requirement already satisfied: click>=5.1 in /Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages (from flask) (6.7)
Requirement already satisfied: Jinja2>=2.10 in /Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages (from flask) (2.10)
Requirement already satisfied: MarkupSafe>=0.23 in /Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages (from Jinja2>=2.10->flask) (1.0)
You are using pip version 18.0, however version 18.1 is available.
You should consider upgrading via the 'pip install --upgrade pip' command.
```

i followed 20 posts on this issue, and no matter what i do, i can't get around the **_404 Not Found_** issue. 

```
from flask import Flask

app = Flask(__name__)
app.config['SERVER_NAME'] = "127.0.0.1:5000" # attempting to set explicitly, as it defaults to None 

app.route('/')
def home():
    return "home..."

print('server name ', app.config["SERVER_NAME"])

app.run(debug=True)
```

![image](https://user-images.githubusercontent.com/843437/51076213-6bf06200-1663-11e9-900b-c107b6b6024c.png)

tried specifying port, using default, specifying server name, using default.. console prints the url to use but that default url does not work 
Fix the typo `Sqlite3` to  `SQLite3`.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

For speeding up url route matching, I defined a custom rule class and a custom url map class. But  `Flask` currently only allows modifying url rule class, it should support modify url map class too.

```python
    #: The rule object to use for URL rules created.  This is used by
    #: :meth:`add_url_rule`.  Defaults to :class:`werkzeug.routing.Rule`.
    #:
    #: .. versionadded:: 0.7
    url_rule_class = Rule
```
Environ values are already native strings, so calling `encode` is either misleading on Python 2 (because it's already mixed bytes), and incorrect on Python 3 (because it becomes bytes, when it should be a string).

closes #2981 
closes #2967 

On Fedora, `yum install python-virtualenv` installs virtualenv for Python 2, but it doesn't add the `virtualenv` command to the path. Use `python2 -m virutalenv` instead of the `virutalenv` command.

closes #3035 

Werkzeug 0.15 adds the `KeyError` message to `BadRequestKeyError`. Flask was previously adding this manually. Now it should *clear* the message when not in development mode. 1.0.x will keep compatibility with Werkzeug 0.14 and 0.15, 1.1 will bump the version requirement.
If the tutorial is followed, a factory function is created in `__init__.py`. As far as I understand this requires the factory function to be imported and then used to create the application in a `yourapplication.wsgi` file. This pull request adds a comment about this.
IWhen I want to test test_selenium.py in Chapter 15: Unit tests with Selenium (15d),  I failed .This is the traceback
` flask test
test_404 (test_api.APITestCase) ... ok
test_anonymous (test_api.APITestCase) ... ok
test_bad_auth (test_api.APITestCase) ... ok
test_comments (test_api.APITestCase) ... ok
test_no_auth (test_api.APITestCase) ... ok
test_posts (test_api.APITestCase) ... ok
test_token_auth (test_api.APITestCase) ... ok
test_unconfirmed_account (test_api.APITestCase) ... ok
test_users (test_api.APITestCase) ... ok
test_app_exists (test_basics.BasicTestCase) ... ok
test_app_is_testing (test_basics.BasicTestCase) ... ok
test_home_page (test_client.FlaskClientTestCase) ... ok
test_register_and_login (test_client.FlaskClientTestCase) ... ok
/anaconda3/lib/python3.7/threading.py:865: Warning: Silently ignoring app.run() because the application is run from the flask command line executable.  Consider putting app.run() behind an if __name__ == "__main__" guard to silence this warning.
  self._target(*self._args, **self._kwargs)
test_admin_home_page (test_selenium.SeleniumTestCase) ... FAIL
test_administrator_role (test_user_model.UserModelTestCase) ... ok
test_anonymous_user (test_user_model.UserModelTestCase) ... ok
test_duplicate_email_change_token (test_user_model.UserModelTestCase) ... ok
test_expired_confirmation_token (test_user_model.UserModelTestCase) ... ok
test_follows (test_user_model.UserModelTestCase) ... ok
test_gravatar (test_user_model.UserModelTestCase) ... ok
test_invalid_confirmation_token (test_user_model.UserModelTestCase) ... ok
test_invalid_email_change_token (test_user_model.UserModelTestCase) ... ok
test_invalid_reset_token (test_user_model.UserModelTestCase) ... ok
test_moderator_role (test_user_model.UserModelTestCase) ... ok
test_no_password_getter (test_user_model.UserModelTestCase) ... ok
test_password_salts_are_random (test_user_model.UserModelTestCase) ... ok
test_password_setter (test_user_model.UserModelTestCase) ... ok
test_password_verification (test_user_model.UserModelTestCase) ... ok
test_ping (test_user_model.UserModelTestCase) ... ok
test_timestamps (test_user_model.UserModelTestCase) ... ok
test_to_json (test_user_model.UserModelTestCase) ... ok
test_user_role (test_user_model.UserModelTestCase) ... ok
test_valid_confirmation_token (test_user_model.UserModelTestCase) ... ok
test_valid_email_change_token (test_user_model.UserModelTestCase) ... ok
test_valid_reset_token (test_user_model.UserModelTestCase) ... ok

======================================================================
FAIL: test_admin_home_page (test_selenium.SeleniumTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/xueshuaikang/learn_flask/tests/test_selenium.py", line 84, in test_admin_home_page
    self.client.page_source))
AssertionError: None is not true

----------------------------------------------------------------------
Ran 35 tests in 11.375s

FAILED (failures=1)`


I think I failed to run flask app when test_admin_home_page.Counld you help me?
Sorry that I am not good at English!

* Python version:3.7.0
* Flask version:1.0.2
* Werkzeug version:0.14.1
Hello,

In addition to #3056, this is a little patch to fix the last remaining `DeprecationWarning: invalid escape sequence` in `make-release.py`.

Signed-off-by: Mickaël Schoentgen <contact@tiger-222.fr>
See: https://www.python.org/dev/peps/pep-0519/

This is mostly encountered with pathlib in python 3, but this API
suggests any PathLike object can be treated like a filepath with
`__fspath__` function.
It appears that skipping subsets of exceptions in a generic error handler has been a major point of confusion; there are at least three open issues related to this: #2778, #2841, #2984.

This PR documents the workaround without modifying current behavior (whether 3XX should be captured seems to be a point of contention in the aforementioned issues).
Hello,
This is directly related to the SO question:
https://stackoverflow.com/questions/51379705/flask-auto-reload-does-not-refresh-browser

### Expected Behavior

Upon changing an HTML template file while running the Flask development server, I thought the browser view would update to reflect the new HTML.

### Actual Behavior

The browser view does _not_ update upon changing an HTML template file.  To see the HTML changes, the browser must be manually refreshed.  I did not expect this to be the case.  I am unsure if this is a bug or intended behavior of the Flask development server.

If this behavior is intended, I would like to have this considered for a Feature Request for the Flask development server.

### Environment

* Python version:  3.6.3
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

This fixes the `SyntaxWarning` introduced in CPython master. This is similar to https://github.com/pallets/jinja/issues/646 where `DeprecationWarning` is now converted to `SyntaxWarning`. I have added `r` to convert the docstring as raw string that fixes the issue.

Before patch warning : 

```
flask/app.py:1693: SyntaxWarning: invalid escape sequence \s
```

Relevant CPython issue : https://bugs.python.org/issue32912
**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

Tell us what should happen.

```python
Paste a minimal example that causes the problem.
```

### Actual Behavior

Tell us what happens instead.

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version:
* Flask version:
* Werkzeug version:

This fixes #3053 by moving the import to _compat . This can be directly imported since it's the only file but moving it to _compat makes it easier to use it in future for these cases and also goes in line with fixes in jinja2 and werkzeug for similar issues. Let me know if this needs to be changed. 

Thanks for Flask :)
`flask.session` imports `MutableMapping` from collections which is deprecated in Python 3.7 and will be removed in 3.8. For some reason since there are similar warnings in other libraries like werkzeug and jinja that are fixed seems to hide this warning. Importing session directly from flask folder causes this warning

### Expected Behavior

`DeprecationWarning` should not be shown since it causes incompatibility with 3.8

### Actual Behavior

Tell us what happens instead.

```python
Python 3.8.0a0 (heads/master:78de01198b, Dec 29 2018, 11:36:21)
[GCC 5.4.0 20160609] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> import warnings
>>> warnings.filterwarnings("default", category=DeprecationWarning)
>>> import sessions
/home/karthi/flask/flask/sessions.py:14: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working
  from collections import MutableMapping
```

### Environment

* Python version: Python 3.8.0a0
* Flask version: 1.1dev
* Werkzeug version: 0.14

Upstream PR : https://github.com/python/cpython/pull/10596
Reading the App Config class I found a noising way to make a getter and setter for a property in the Config class, so I refactor to what is the most acceptable and reasonable form.

I hope you guys enjoy the contribution.

Thks. 
(See individual commit messages for explanations.)
Exposed the reloader interval as a flask command line argument (with the value defaulting to 1) and passed the value to werkzeug.serving.run_simple() .


Hi, all. I have a feature request that I've been thinking about for a while. Some times I want to look at what is in the session cookie. Obviously one way to do that is by logging the cookie at various points in your server-side code. But some times I want to inspect the cookie outside of the application, directly from the browser. There are various ways of doing this ([1][1], [2][2], [3][3]). But it requires defining a snippet of code each time you want to do it. 

That said this feature request is to add in a utility, perhaps a CLI tool that decode a session cookie, e.g.:

```
$ flask decode <cookie-from-browser>
```

This would prevent users from needing to define this snippet each time, and provide an easy to use interface. I'm curious to hear what others think and if this is indeed a feature that the community thinks will be useful. 

[1]: https://blog.miguelgrinberg.com/post/how-secure-is-the-flask-user-session
[2]: https://gist.github.com/babldev/502364a3f7c9bafaa6db
[3]: https://www.google.com/search?q=flask+session+cookie+decode
Using unicode endpoint name in Python 2 will raise `TypeError: __name__ must be set to a string object`.

Example application:
```py
from __future__ import unicode_literals

from flask import Flask
from flask.views import MethodView

app = Flask(__name__)

class Index(MethodView):
    def get(self):
        return 'GET'

app.add_url_rule('/', view_func=Index.as_view('index'))
```
Full error traceback:
```pytb
Traceback (most recent call last):
  File "...\app.py", line 93, in <module>
    app.add_url_rule('/', view_func=Index.as_view('index'))
  File "python27\lib\site-packages\flask\views.py", line 105, in as_view
    view.__name__ = name
TypeError: __name__ must be set to a string object
```

This PR will force endpoint name to string in Python 2.

Close #3033 
### Expected Behavior

The request shouldn't take 65 seconds to complete.

```python
from flask import Flask
app = Flask(__name__)
@app.route("/")
def index():
    return "anything", 204
```

### Actual Behavior

The request takes 65 seconds to complete. According to the logs, uWSGI processes the request in some milliseconds, but somehow nginx hangs for more than a minute when a response with 204 code is provided.

This happens with any WSGI implementation. I've tried it with 2 different versions of uWSGI and Gunicorn. The result is the same.

### Environment

* Python version: 3.6.7
* Flask version: 1.0.2
* Werkzeug version: 0.14.1


The request hook in Flask, is there a hook that can be executed before the request processing of a view function?

Python 3.7.0 has been released at 2018-06-27. So I think we need to add it to CI.
[flask.tests.test_basic.test_trapping_of_bad_request_key_errors](https://github.com/pallets/flask/blob/master/tests/test_basic.py#L1029-L1040) failed in Travis-CI with enviroment `devel`.

### Source

[`flask.tests.test_basic.test_trapping_of_bad_request_key_errors`](https://github.com/pallets/flask/blob/master/tests/test_basic.py#L1029-L1040)

```py
def test_trapping_of_bad_request_key_errors(app, client):
    @app.route('/key')
    def fail():
        flask.request.form['missing_key']

    @app.route('/abort')
    def allow_abort():
        flask.abort(400)

    rv = client.get('/key')
    assert rv.status_code == 400
    assert b'missing_key' not in rv.data  # unpassed
```

### Traceback

https://travis-ci.org/pallets/flask/builds/471002531

```pytb
devel create: /home/travis/build/pallets/flask/.tox/devel
devel installdeps: pytest>=3, coverage, greenlet, blinker, python-dotenv, 
https://github.com/pallets/werkzeug/archive/master.tar.gz, 
https://github.com/pallets/markupsafe/archive/master.tar.gz, 
https://github.com/pallets/jinja/archive/master.tar.gz, 
https://github.com/pallets/itsdangerous/archive/master.tar.gz, 
https://github.com/pallets/click/archive/master.tar.gz
devel inst: /home/travis/build/pallets/flask/.tox/.tmp/package/1/Flask-1.0.3.dev0.zip
...
___________________ test_trapping_of_bad_request_key_errors ____________________
app = <Flask 'flask_test'>, client = <FlaskClient <Flask 'flask_test'>>
    def test_trapping_of_bad_request_key_errors(app, client):
        @app.route('/key')
        def fail():
            flask.request.form['missing_key']
    
        @app.route('/abort')
        def allow_abort():
            flask.abort(400)
    
        rv = client.get('/key')
        assert rv.status_code == 400
>       assert b'missing_key' not in rv.data
E       assert 'missing_key' not in "<!DOCTYPE HTML PUBL...'</code></pre></p>\n"
E         'missing_key' is contained here:
E           yError: \'missing_key\'</code></pre></p>
E         ?           +++++++++++
```

having fun

The other alternative is to tell to install `virtualenv` system package, then run `virtualenv -p python2.7 venv`, but this is putting exception in 2 places (1. installation and 2. venv creation).

This fixes #3035.
<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

When I go from a web application to a Jupyter application on a new port using the "redirect" function, I need to manually refresh the page to open it. Is there an automatic refresh method?
The following is my server key code：
```
def open_comment(comment_id):
    comment = Comment.query.get_or_404(comment_id)
    docker.from_env().containers.get(comment.body).restart(timeout=10)
    host = request.host.split(':')[0]
    url = "http://" + host + ':' + str(comment.port) + '/lab'
    return redirect(url)
```
The following is my client key code：
```
<form class="inline" method="post" target="_blank"
      action="{{ url_for('.open_comment', comment_id=comment.id) }}">
<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
<button type="submit" class="dropdown-item">
    <span class="oi oi-warning" aria-hidden="true"></span> Open
</button>
</form>
```
Added methods usage in route decorator

**This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC ch
![screenshot from 2018-12-19 20-34-08](https://user-images.githubusercontent.com/31107463/50230005-7eada900-03cd-11e9-94d4-6e72796da6bb.png)
![pro](https://user-images.githubusercontent.com/31107463/50230014-81100300-03cd-11e9-82bf-e1a36a928857.png)

annel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.**

If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us
understand the problem and helps check that it is not caused by something in
your code.

---

### Expected Behavior

Tell us what should happen.

```python
Paste a minimal example that causes the problem.
```

### Actual Behavior

Tell us what happens instead.

```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version:
* Flask version:
* Werkzeug version:

### Expected Behavior

I want create a loop for a list of data and generate a form for every record among a edit button, this to prevent pass in url the id of the record when i use the edit button.

In this form i put a hidden field with the id value and a submit button

When i press submit it make the POST, but in the route that receive the value get nothing.

This is my code source:

```python

{% for worker in workers %}
 <form method="POST" action="{{ url_for('worker.edit_middleware') }}">
                    <td>
                      {{ form.hidden_tag() }}
                      {{ form.worker_id(value=worker.id) }}
                   <input class="btn btn-login"  type="submit" name="editar" value="Editar">
                    </td>               
                 </form>
{% endfor %}
```

When i inspect the page i see this:

```python
<td>
<input id="worker_id" name="worker_id" type="hidden" value="">
<input id="hidden_id" name="hidden_id" type="hidden" value="">
<input id="csrf_token" name="csrf_token" type="hidden" value="SECRET_ABBREV">
<input id="worker_id" name="worker_id" type="hidden" value="453">
<input class="btn btn-login" type="submit" name="editar" value="Editar">
</td>
```

The page get two times the fields for every row, in the first time all of the field in the form class appear created  with no values, although they are not called in the code, later of the crsf_token get the field that i called in my code with the values..

### Actual Behavior

To resolve this i remove the form hidden_tag and implement manual input field

```python
<form method="POST" action="{{ url_for('worker.edit_middleware') }}">
     <td>
       <input type="hidden" name="worker_id" value="{{ worker.id }}">
        <input class="btn btn-login"  type="submit" name="editar" value="Editar">
    </td>               
</form>
```

And this is that i get in inspect:

```python
<td>
    <input type="hidden" name="worker_id" value="453">
    <input class="btn btn-login" type="submit" name="editar" value="Editar">
</td>
```
But is posible to loop the form without getting two times the fields?.
I think this is a bug or maybe bad implementation


### Environment

* Python version: 3.6.4
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

---

### Expected Behavior

`yum install python-virtualenv` in the install instruction doesn't lead to having a `virtualenv` binary on the path, as the problem is exactly described by https://unix.stackexchange.com/questions/27877/install-virtualenv-on-fedora-16 (the question is outdated, but it also applies to Fedora 29 I have been testing).
```shell
sudo yum install python-virtualenv
```

The solution is to do `sudo yum install virtualenv` instead, which is an alias to `python3-virtualenv`. And so an explicit `-p python2.7` is needed to start a python2 env.

### Environment

* Python version: N/A
* Flask version: N/A
* Werkzeug version: N/A

### My Problem
I'm getting 404 for all routes, my flask api is running, and when i run it, the api receive the request and log it, but, it give 404 http status for every request;
``` shell
127.0.0.1 - - [17/Dec/2018 16:49:12] "GET /api/ping/ HTTP/1.1" 404 -
127.0.0.1 - - [17/Dec/2018 16:50:10] "POST /api/blur/ HTTP/1.1" 404 -
```
### My code
I' have a class `Server`, this Server class receive a `Flask app` and run it:
```python 
from jsonmerge import merge

class Server():
    def __init__(self, app):
        self.__app = app
        self.__config = #snip
        #snip

    def start(self, options=None):
        #snip
        
        self.__app.run(debug=self.__config["debug"], port=self.__config["server"]["port"], host=self.__config["server"]["ip"])
```
and i have my run.py that run my aplication:
``` python
if __name__ == '__main__':
    srv = Server(app)
    srv.start(config)
```
when I print my `self.__app` infromations, i get:

``` shell
<Flask 'appfly.app'>

<Config {'ENV': 'production', 'DEBUG': False, 'TESTING': False, 'PROPAGATE_EXCEPTIONS': None, 'PRESERVE_CONTEXT_ON_EXCEPTION': None, 'SECRET_KEY': None, 'PERMANENT_SESSION_LIFETIME': datetime.timedelta(days=31), 'USE_X_SENDFILE': False, 'SERVER_NAME': None, 'APPLICATION_ROOT': '/', 'SESSION_COOKIE_NAME': 'session', 'SESSION_COOKIE_DOMAIN': None, 'SESSION_COOKIE_PATH': None, 'SESSION_COOKIE_HTTPONLY': True, 'SESSION_COOKIE_SECURE': False, 'SESSION_COOKIE_SAMESITE': None, 'SESSION_REFRESH_EACH_REQUEST': True, 'MAX_CONTENT_LENGTH': None, 'SEND_FILE_MAX_AGE_DEFAULT': datetime.timedelta(seconds=43200), 'TRAP_BAD_REQUEST_ERRORS': None, 'TRAP_HTTP_EXCEPTIONS': False, 'EXPLAIN_TEMPLATE_LOADING': False, 'PREFERRED_URL_SCHEME': 'http', 'JSON_AS_ASCII': True, 'JSON_SORT_KEYS':True, 'JSONIFY_PRETTYPRINT_REGULAR': False, 'JSONIFY_MIMETYPE': 'application/json', 'TEMPLATES_AUTO_RELOAD': None, 'MAX_COOKIE_SIZE': 4093}>

Map([<Rule '/api/ping' (GET, HEAD, OPTIONS) -> ping>,
 <Rule '/api/blur' (POST, OPTIONS) -> blur>,
 <Rule '/static/<filename>' (GET, HEAD, OPTIONS) -> static>])
```
look, my `url_map` list all my routes, the `api/ping` route and `api/blur` route is there.

### My faill solutions
many stackover flow responses say to change the config["server_name"] but it doesnt works
I already tried set SERVER_NAME to 0.0.0.0:9000,localhost:9000, 127.0.0.1:9000

I make an flask tutorial to verify the SERVER_NAME and it is None
``` python
from flask import Flask
app = Flask(__name__)

@app.route("/")
def hello():
    return "Hello World!"

if __name__ == '__main__':
print(app.config["SERVER_NAME"])
#app.run(...)
```

``` shell
> None
```

I tried set the to `Flask ENV` to `development` but it doest works to:
``` python
self.__app.config["ENV"]='development'
```

### how it works before
I aways used Flask in this way and aways worked fine:
---> app.py
``` python
from flask import Flask

app = Flask(__name__)

# Routes files
from app.presentation.routes import ping
from app.presentation.routes import rg as rg_scan

# Routes rules
app.add_url_rule('/api/ping', 'Ping', ping.route, methods=['GET'])
app.add_url_rule('/api/rg', 'RG', rg_scan.route, methods=['POST'])
print('API is running...')
```

---> run.py
``` python
from app import app

if __name__ == '__main__':
    app.run(debug=True, port=9000, host='0.0.0.0')
```

but now i wanna do it in a diferent way, i wanna use my Server Class to start my flask api.

### Environment

* Python version: 3.7.0
* Flask version: 1.0.2
* OS Version: Manjaro Linux 18.0.0-rc
### Expected Behavior


I wanna write code capable of python3. So i add "from future import unicode_literals" on the top of file.Meanwhile, i use MethodView to build rest api in the same file. I wish it could work fine.

Here is an example:

```
  # -*- coding: utf-8 -*-

  from __future__ import unicode_literals
  from flask import Flask
  from flask import Blueprint, request, current_app, g, abort
  from flask.views import MethodView

  masterviews = Blueprint('newmasterviews', __name__)


  class TeamAPI(MethodView):

      def get(self):
          pass


  team_view = TeamAPI.as_view('team_api')

  app = Flask(__name__)

  app.register_blueprint(masterviews, url_prefix='/rest/master')
```


### Actual Behavior

However, when i run the web app, it thows the error,

```
"lib/python2.7/site-packages/flask/views.py", line 98, in as_view
view.__name__ = name
TypeError: __name__ must be set to a string object". 
```
I soon realize that because i use the "from future import unicode_literals" in py2 so the function name is unicode type, but the name of a function should be string type.So i wonder is it possible to change the
source code in the views.py and add the if-then workflow to convert name of function from unicode type into string type to handle the situation .

### Environment
python2.7
Flask==1.0.2
Werkzeug==0.14.1

I have an application which can be configured to run under a subdomain/domain or a subdirectory. This is controlled by setting `APPLICATION_ROOT` to a value other than `/`. 

Some of my decorators use `request.path` to determine where to redirect the user after logging in. However, when running under a subdirectory, `request.path` does not include `request.script_root` and the user could get redirected somewhere they shouldn't. Using `request.url` creates full URLs when we should only need relative ones. 

Based on [docs](http://flask.pocoo.org/docs/1.0/api/?highlight=script_root#flask.Request.url_root) it is intentional that `request.path` doesn't include `request.script_root`.

Ultimately because my application has a plugin interface and I don't want to deviate too much from Flask documentation, what is the optimal way to get this behavior to be consistent between deployment strategies? 

 * Using `url_for()` doesn't seem optimal because certain target endpoints could require arguments to be passed in which might not work without parsing `request.path` anyway. 
 * Combining `request.script_root` and `request.path` in every usage seems like an easy way to introduce bugs
 * Creating a `BaseRequest` subclass seems like the smartest solution but should there be a new request property (e.g. `request.script_path`)? Or should I replace the existing `path` and `full_path`? 

The PR I have in preparation to fix this issue uses a BaseRequest subclass but I don't feel great about it: 
https://github.com/CTFd/CTFd/pull/802/files#diff-1dec134679d6639679743763954061d5R28
Fix minor typos in `blog.rst` and `database.rst`.
Added an analogy that illustrates the app factory pattern as a sandwich parlor. It might help understanding the concepts.
Hi guys, I used Flask as a server for my image object detection program, but I found that the execution time of object detection are not stable some times.

The main goal of my program is doing object detection on an image with neural network. Since it takes too much time loading the neural netwrok model every time an input image comes, I used Flask as server and the server loads the neural network model once when the server starts up. Then, when the server is running, another program, the clinet, will send a request to the server with the image directory as the parameter. When received the request, the server will read in the specified image, do object detection (executing some functions) and output the detection results in JSON format.

This process works fine most of the time and finishes within about 500ms. However, in some rare cases, the process of performing object detection took several seconds, even up to a minute . I looked into my log files and found that they halted at different functions when this case happened.

I'm wondering if this has something to do with the Flask.

I'm sorry for this long description and I'm grateful if someone can give any advices.

---

### Expected Behavior

**Execution time should be around 500ms.**

The following are normal cases

case 1
```
2018-12-12 04:00:03,822:fpn_server.py:_clip_boxes:122:2500:11848:DEBUG:start
2018-12-12 04:00:03,822:fpn_server.py:_clip_boxes:131:2500:11848:DEBUG:end
```

case2
```
2018-12-12 17:40:36,674:fpn_server.py:calc_num:225:2500:11848:DEBUG:end
2018-12-12 17:40:36,676:fpn_server.py:detect_and_save:968:2500:11848:INFO:Writing file C:\Windows\system32\config\systemprofile\AppData\Local\detection_results\cls_nums_2.pkl
```

### Actual Behavior

**Sometimes it takes several seconds or even a minute to finish.**

The following are unusual cases.

case 1
```
2018-12-12 04:00:04,834:fpn_server.py:_clip_boxes:122:2500:11848:DEBUG:start
2018-12-12 04:00:08,553:fpn_server.py:_clip_boxes:131:2500:11848:DEBUG:end
```

case 2
```
2018-12-12 17:40:28,677:fpn_server.py:calc_num:225:2500:11848:DEBUG:end
2018-12-12 17:40:31,210:fpn_server.py:detect_and_save:968:2500:11848:INFO:Writing file C:\Windows\system32\config\systemprofile\AppData\Local\detection_results\cls_nums_2.pkl
```
### Environment

* Python version: 2.7.14
* Flask version: 0.12.2
* Werkzeug version: 0.14.1

PS: 
1. The server can receive the request from client quickly, it was the execution after receving request halts sometimes.
2. I was runing `app.run()` to launch the server since the server and client runs on the same machine.
3. Server runs in single thread is not a problem for me, I just need to process the image one at a time.
4. I'm running on Windows 10.

Thank you!

 



### Expected Behavior

view_args are unescaped and passed to view functions as the original strings

```python
@app.route("/testurl/<string:test_arg>)
def test_func(test_arg):
    print(f"test arg is: {test_arg}")
    # args with spaces produce "arg%20with%20spaces"


#------------------------
import requests
requests.get("testurl/arg with spaces")
```

### Actual Behavior
The view args are passed in url percent escape format


### Other Info
I recently changed servers. It was working fine previously. Maybe an encoding issue?

### Environment
* Python version: 3.6.5
* Flask version: 1.02
* Werkzeug version: 0.14.1


### error source code:
https://github.com/wedojava/exloger

---

### Expected Behavior

There is a form with email and ip  at index for search and show response, the response should be paginated.

```python
from flask import render_template, flash, redirect, url_for, request, g, current_app, session
from app.main import bp
from app.main.forms import SearchForm

@bp.before_app_request
def before_request():
    if current_user.is_authenticated:
        current_user.last_seen = datetime.utcnow()
        db.session.commit()
    
    try:
        session['email'] = session['email'] if session['email'] else 'example@example.com'
    except KeyError as ke:
        session['email'] = 'example@example.com'


@bp.route('/', methods=['GET', 'POST'])
@bp.route('/index', methods=['GET', 'POST'])
def index():
    form = SearchForm()
    page = request.args.get('page', 1, type=int)
    if form.validate_on_submit():
        words_email = ["%" + form.email.data + "%"]
        rule_email = and_(*[LogImported.sender_address.like(w) for w in words_email])
        # pay attention these two lines below:
        l = LogImported.query.filter(rule_email)
        pagination = l.paginate(page, per_page=50, error_out=True)
        pageitems = pagination.items
        session['email'] = form.email.data
        return render_template('index.html', title=_('Home'), form=form, loglist = l, \
        pageitems = pageitems, pagination = pagination)
    elif session['email'] is not 'example@example.com':
        words_email = ["%" + form.email.data + "%"]
        rule_email = and_(*[LogImported.sender_address.like(w) for w in words_email])
        # pay attention these two lines below:
        l = LogImported.query.filter(rule_email)
        pagination = l.paginate(page, per_page=50, error_out=True)
        pageitems = pagination.items
        session['email'] = form.email.data
        return render_template('index.html', title=_('Home'), form=form, loglist = l, \
        pageitems = pageitems, pagination = pagination)
    else:
        return render_template('index.html', title=_('Home'), form=form)
```

`main/forms.py`:
```python
class SearchForm(FlaskForm):
    email = StringField(_l('Email'))
    ip = StringField('IP', validators=[Length(min=0, max=140)])
    submit = SubmitField(_l('Submit'))
```

`main/__init__.py`:
```python
from flask import Blueprint

bp = Blueprint('main', __name__)

from app.main import routes
```

`/models.py`:
```python
class LogImported(db.Model):
    id = db.Column(db.Integer, index=True, primary_key=True)
    date = db.Column(db.DateTime, default=datetime.utcnow)
    sender_address = db.Column(db.String(255), index=True)
    recipient_address = db.Column(db.String(255))
    recipient_count = db.Column(db.Integer)
    return_path = db.Column(db.String(255))
    client_hostname = db.Column(db.String(255))
    client_ip = db.Column(db.String(100))
    server_hostname = db.Column(db.String(255))
    server_ip = db.Column(db.String(100))
    original_client_ip = db.Column(db.String(100))
    original_server_ip = db.Column(db.String(100))
    event_id = db.Column(db.String(50))
    total_bytes = db.Column(db.Integer)
    connector_id = db.Column(db.String(50))
    message_subject = db.Column(db.String(255))
    source = db.Column(db.String(50))
```

`templates/index.html`:
```python
{% extends "base.html" %}
{% from 'bootstrap/form.html' import render_form %}
{% from 'bootstrap/pagination.html' import render_pagination %}


...

{{ render_pagination(pagination) }}

...

```

### Actual Behavior

In short, get result from index's form then paginated,but any paginated links cannot work right.


I set email and ip to session as `session['email']` and `session['ip']`.
Then,I click page 2,search these keywords by session to a object and paginate,but `paginate()` cannot work right, link like `http://127.0.0.1:5000/index?page=2`,response an error page:404.

`elif` in routes.py:
```
l = LogImported.query.filter(rule)
pagination = l.paginate(page, per_page=50, error_out=True)
```
Return type of `l = LogImported.query.filter(rule)` is right, but `l.paginate(page, per_page=50, error_out=True)` throw an error.
code blocked by if is work right, by in elif,same code response error.

parameter `rule` is same at these two place. Why these bug raised?

```pytb
127.0.0.1 - - [11/Dec/2018 12:44:51] "GET /index?page=2 HTTP/1.1" 404 -
```

### Environment

* Python version: 3.7.1
* Flask version:1.0.2
* Werkzeug version:0.14.1
I have a Flask app on Google App Engine and my static files are in a Google bucket.

I'm using `static_host` like so:

```python
def create_app(config_name):
    app = Flask(__name__, host_matching=True, static_host='storage.googleapis.com/mybucket')
```
And I'm also using Flask-SSLify for the basic redirect from http to https:

```python
app = create_app(os.getenv('FLASK_CONFIG') or 'default')
sslify = SSLify(app, permanent=True)
```

But when I launch on App Engine my static files won't load because they are being requested with http. In other words, my app is successfully on https but the static file URLs are being built like `http://storage.googleapis.com/mybucket/...` without https.

It seems SSLify is just building a `before_request` to do redirects, so I'm not sure where to tell Flask to request my static host with https. 
### Expected Behavior
Using templates should provide some protection against Cross-Site Scripting, based on the information at http://flask.pocoo.org/docs/1.0/security/

> Flask configures Jinja2 to automatically escape all values unless explicitly told otherwise. This should rule out all XSS problems caused in templates...

### Actual Behavior
I'm able to inject code into the page.

Demo: https://github.com/afd3dea/example1

http://127.0.0.1/?m=<script>alert(1);</script> executes (assuming XSS Auditor / AV doesn't block it)

### Environment

* Python version: Python 3.6.7
* Flask version: Tried on 0.12.1 and 1.0.2
* Werkzeug version: ?
Just merged https://github.com/pallets/werkzeug/pull/1416 so Werkzeug's reloader detects `python -m module` correctly. All of `flask.cli.main()` can be replaced with:

```python
def main(as_module=False):
    cli.main(prog_name="python -m flask" if as_module else None)
```

Need to wait until Werkzeug 0.15 has been out for a bit before we can bump Flask's min version.
add classifiers ：Programming Language 
### Expected Behavior
I put this IF statement in my base.html template:

```html
    {% if "dashboard" in url_for(request.endpoint)  %}
    <script src={{ url_for('static', filename='js/dashboard.js') }}></script>
    {% endif %}
```
I added an endpoint with a value. For example: 
```python
@app.route("/accountmgmt/<int:userid>",methods=["GET","POST"])
@login_required
def accountmgmt(userid):
   ... etc
```

### Actual Behavior
The above code causes a build error, but only when an endpoint has a value (as above). 

When I remove the above IF statement from the template, the code does not error. But when it is included, I get this error (I am using the URL: http://127.0.0.1:5000/accountmgmt/123):

```pytb
Could not build url for endpoint 'accountmgmt'. Did you forget to specify values ['userid']?
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/flask/app.py", line 2309, in __call__
return self.wsgi_app(environ, start_response)
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/flask/app.py", line 2295, in wsgi_app
response = self.handle_exception(e)
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/flask/app.py", line 1741, in handle_exception
reraise(exc_type, exc_value, tb)
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/flask/_compat.py", line 35, in reraise
raise value
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/flask/app.py", line 2292, in wsgi_app
response = self.full_dispatch_request()
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/flask/app.py", line 1815, in full_dispatch_request
rv = self.handle_user_exception(e)
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/flask/app.py", line 1718, in handle_user_exception
reraise(exc_type, exc_value, tb)
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/flask/_compat.py", line 35, in reraise
raise value
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/flask/app.py", line 1813, in full_dispatch_request
rv = self.dispatch_request()
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/flask/app.py", line 1799, in dispatch_request
return self.view_functions[rule.endpoint](**req.view_args)
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/flask_login/utils.py", line 261, in decorated_view
return func(*args, **kwargs)
File "/Users/brendon/dev/nelliedata/nellieapp/routes.py", line 43, in accountmgmt
return render_template("accountmgmt.html",users=userlist, current_user=current_user,title="Nellie Data: Account Management")
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/flask/templating.py", line 135, in render_template
context, ctx.app)
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/flask/templating.py", line 117, in _render
rv = template.render(context)
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/jinja2/asyncsupport.py", line 76, in render
return original_render(self, *args, **kwargs)
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/jinja2/environment.py", line 1008, in render
return self.environment.handle_exception(exc_info, True)
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/jinja2/environment.py", line 780, in handle_exception
reraise(exc_type, exc_value, tb)
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/jinja2/_compat.py", line 37, in reraise
raise value.with_traceback(tb)
File "/Users/brendon/dev/nelliedata/nellieapp/templates/accountmgmt.html", line 1, in top-level template code
{% extends "base.html" %}
File "/Users/brendon/dev/nelliedata/nellieapp/templates/base.html", line 115, in top-level template code
{% if "test" in url_for(request.endpoint)  %}
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/flask/helpers.py", line 356, in url_for
return appctx.app.handle_url_build_error(error, endpoint, values)
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/flask/app.py", line 2061, in handle_url_build_error
reraise(exc_type, exc_value, tb)
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/flask/_compat.py", line 35, in reraise
raise value
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/flask/helpers.py", line 345, in url_for
force_external=external)
File "/Users/brendon/dev/nelliedata/flask/lib/python3.6/site-packages/werkzeug/routing.py", line 1776, in build
raise BuildError(endpoint, values, method, self)
werkzeug.routing.BuildError: Could not build url for endpoint 'accountmgmt'. Did you forget to specify values ['userid']?
```

### Environment

* Python version: 3.6.5
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

Clarify that blueprint endpoint *names* are prefixed by the name of the blueprint, but the url for the endpoint is not automatically prefixed.
Added how to enter debug mode
Implementing redis session by following this example [http://flask.pocoo.org/snippets/75/](url) but getting 
`raise TypeError('Expected bytes')` 

## code I'm using
![image](https://user-images.githubusercontent.com/10434201/49634014-82324f00-fa21-11e8-80ce-27d076590ef0.png)
## Error
![image](https://user-images.githubusercontent.com/10434201/49634129-cf162580-fa21-11e8-904e-90dfd6dfecaf.png)



Hi


I have form(Form) which contains

```
<form method="POST" enctype="multipart/form-data" action="{{ url_for('xxx') }}">
  <input type="file" name="MultipleFileUpload" multiple="">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />     
  <input type="submit" value="add">
</form>
```

It should upload multiple files but it does not.

Python code
```
ob = request.files.getlist("MultipleFileUpload[]")
for x in ob:
     etc..
```
This was my old code which works perfectly

I presume it was caused by update


so I change it code to: 

`ob = request.files.getlist("MultipleFileUpload")`

`ob = request.files.to_dict()`


None of them works

It just upload 1 file or none


* Python version: 2.7.12 64-bit
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

I think lighttpd configuration enters too much into detail without really requiring it. It seems me appropriate to link a command line utility that immediately deploys a dummy app on a given domain. with lighttpd.

I have moved the module requirements up.

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

### Expected Behavior
I had already config the variable "ENV" in the config, which was set as 'development', It seemed that the banner should display "Environment: development",actually,it didn't. What's more, it worked with env development.

```python
# config
class Config:
    # ...
    @staticmethod
    def init_app(app):
        pass
class DevelopmentConfig(Config):
    ENV='development'

def create_app(config_name):
    app = Flask(__name__, static_folder='static', static_url_path='')

    app.config.from_object(config[config_name])
    config[config_name].init_app(app)
    # ...
    print("*Actual Environment: {}".format(app.config['ENV']))
    return app

# wsgi.py
from app import create_app

application = create_app('default')
```

### Actual Behavior
```pyrb
 * Serving Flask app "wsgi.py"
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: off
*Actual Environment:development
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
```
### Environment

* Python version: 3.6.5
* Flask version: 1.0.2
* Werkzeug version: 0.14.1



### Expected Behavior

I want to run my test case but it does not work if there are more than one case
If it's just one case ,everything is ok

class FlaskClientTestCase(unittest.TestCase):
    def setUp(self):
        self.app = create_app("testing")
        self.app_context = self.app.app_context()
        self.app_context.push()
        db.create_all()

        self.client = self.app.test_client(use_cookies=True)

    def tearDown(self):
        db.session.remove()
        db.drop_all()
        self.app_context.pop()

    def test_one(self):
        print("first test")

    def test_two(self):
        print("second test")


```python
Paste a minimal example that causes the problem.
```

### Actual Behavior

first test


Ran 2 tests in 4.127s

FAILED (errors=1)

Error
Traceback (most recent call last):
  File "C:\Python35\lib\unittest\case.py", line 59, in testPartExecutor
    yield
  File "C:\Python35\lib\unittest\case.py", line 597, in run
    self.setUp()
  File "E:\pythonDump\ordermeals\tests\test_client.py", line 13, in setUp
    self.app = create_app("testing")
  File "E:\pythonDump\ordermeals\app\__init__.py", line 30, in create_app
    db.init_app(app)
AttributeError: module 'app.db' has no attribute 'init_app'


Process finished with exit code 1


```pytb
Paste the full traceback if there was an exception.
```

### Environment

* Python version:3.5
* Flask version:1.0.2
* Werkzeug version:0.14.1

### Expected Behavior


```python

def loged_validator(func):
    @wraps(func)
    def decorator(*args, **kwargs):
        print(request.cookies)
        token = request.cookies.get('token')
        return func(*args, **kwargs)

    return decorator
```

### Actual Behavior
I can't get cookies in the decorator. The token is None, but i can get token in the routing。


```pytb

### Environment

* Python version:3.7
* Flask version:1.0.2

Fix #3005
Continue #3009 
### Expected Behavior

Steps to reproducing the problem:
1. Make a request that provides any basic auth
2. Make a request without basic auth
3. Make a request that provides any basic auth (this request is not being processed)

I would expect the server to continue processing requests.

```python
from flask import Flask, request, jsonify

app = Flask(__name__)


@app.route('/')
@app.route('/api')
def api():
    auth = request.authorization
    if not auth:
        return jsonify({'status': 'NO AUTH'})
    return jsonify({'status': 'GOT AUTH'})
```

### Actual Behavior

The server seems to hang on request 3.

### Environment

* Python version: 3.6.6
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

Full environment info:
MacOS 10.13.6
Python 3.6.6 (Anaconda)

All packages:
```text
aniso8601==4.0.1
Click==7.0
Flask==1.0.2
Flask-RESTful==0.3.6
itsdangerous==1.1.0
Jinja2==2.10
MarkupSafe==1.1.0
pytz==2018.7
six==1.11.0
Werkzeug==0.14.1
```

Fix #3005 

I also found some docstring use present tense, for example:
```py
def with_appcontext(f):
    """Wraps a callback so that it's guaranteed to be executed with the
    ...
    """
```
Is it needed to update them?
I found unprintable characters in log file, when flask got requests.

2018-11-29 16:24:44,471 - INFO - _internal.py - _log - 88 - 192.168.241.129 - - [29/Nov/2018 16:24:44] "^[[37mPOST /collection_act HTTP/1.1^[[0m" 200 -$
2018-11-29 16:24:44,481 - INFO - _internal.py - _log - 88 - 192.168.64.54 - - [29/Nov/2018 16:24:44] "^[[37mPOST /classify HTTP/1.1^[[0m" 200 -$
2018-11-29 16:24:44,674 - INFO - _internal.py - _log - 88 - 100.116.37.130 - - [29/Nov/2018 16:24:44] "^[[37mGET / HTTP/1.0^[[0m" 200 -$
2018-11-29 16:24:45,549 - INFO - _internal.py - _log - 88 - 100.116.38.1 - - [29/Nov/2018 16:24:45] "^[[37mGET / HTTP/1.0^[[0m" 200 -$

The strange  "^[[37m" between " and POST.


### Environment

* Python version: 2.7
* Flask version: 1.0.1
* Werkzeug version:0.14.1

Expected Behavior

i hope people visit index, the flask application can create a schedule task and we can see the terminate print "hello,world" immediately.

```
#--coding:utf-8 --*--
import sys
import os 
reload(sys)  
sys.setdefaultencoding('utf-8')
 
from flask import Flask
from flask_apscheduler import APScheduler
 
from apscheduler.jobstores.sqlalchemy import SQLAlchemyJobStore
 
class Config():
    SCHEDULER_JOBSTORES = {
            'default': SQLAlchemyJobStore(url='sqlite:///flask_aps_test.db')
        }
 
    SCHEDULER_API_ENABLED = True
 
    JSON_AS_ASCII = False
 
    ENSURE_ASCII = False
 
    ENCODING = 'utf8'
 
    DEBUG = True
 
    THREADED = True
 
    JSON_AS_ASCII = False
 
app = Flask(__name__)
 
app.config.from_object(Config())
 
scheduler = APScheduler()
 
scheduler.init_app(app)
 
scheduler.start()
 
 
def hello():
 
    print "hello, world."
 
@app.route('/index')
def test_aps():
    print "before,",scheduler.get_jobs()
 
    if scheduler.get_job(id='1001'):
 
        scheduler.remove_job(id = '1001')
 
    else:
        scheduler.add_job( id = '1001',
                        func = hello,
                        trigger = 'interval',
                        seconds = 5,
                        replace_existing = True)
 
    print "after,",scheduler.get_jobs()
 
    return "ok."
 
 
if __name__ == '__main__':
 
    app.run(processes = 2)
```

Actual Behavior

we can't see anything, no error and warning. if i reload the code or set processes = 1 then it work immediately.


Environment

* Python version:2.7.14
* Flask version:0.12.2


### Expected Behavior

How can I achieve this structure?
<img width="249" alt="wx20181128-172947 2x" src="https://user-images.githubusercontent.com/16076835/49143545-37844900-f336-11e8-80b3-4b22f77ad754.png">

### Environment

* Python version:3.7
* Flask version:1.0.3
* Werkzeug version:



### Expected Behavior

Help texts for commands (and options) should consistently use either the imperative or present tense, not a mixture of both. This has no impact on the functional behaviours of the CLI, just a minor UX error.

### Actual Behavior

Executing `flask --help` gives:

```
[... snip ...]

Options:
  --version  Show the flask version
  --help     Show this message and exit.

Commands:
  routes           Show the routes for the app.
  run              Runs a development server.
  shell            Runs a shell in the app context.
```

Note that `run` and `shell` are using present tense whereas `routes`, `--version` and `--help` are using the imperative.

### Environment

* Python version: 3.7.0
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

Small additions to `flask --help` and the docs to make more mention of the `--help`, `--port` and `--host` arguments to `flask run`.

Also adds a mention of the environment variable `FLASK_RUN_HOST` since that works, but was not mentioned anywhere I could find.

I don't know whether this merits a changelog entry - do let me know if that is needed.
https://github.com/pallets/werkzeug/pull/1342 sets the status code for `RequestRedirect` to 308, so the request body (form data) will be preserved. We no longer need to fail with `FormDataRoutingRedirect`. @pgjones 
My code:
```Python
#!/usr/bin/env python
# -*- coding: utf-8 -*-

import copy

from flask import Flask
from flask import request

app = Flask(__name__)


@app.route('/')
def hello_world():
    return 'Hello, World!'


@app.before_request
def before_request():
    request_copy = copy.deepcopy(request)
    print request_copy.path


if __name__ == '__main__':
    app.run(debug=True)

```
As you see, I want copy request and log something. But it is not work.
```
……
  File "……/python2.7/copy.py", line 163, in deepcopy
    y = copier(x, memo)
  File "……/python2.7/copy.py", line 257, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "……/python2.7/copy.py", line 174, in deepcopy
    y = copier(memo)
TypeError: cannot deepcopy this pattern object
```
And `copy.copy()` work well.

### Environment

* Python version: 2.7.15
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

as per @davidism, I am submitting a PR against 1.0 maintenance

**Tiny correction to the documentation on GEvent as a WSGI standalone container.**

http://flask.pocoo.org/docs/1.0/deploying/wsgi-standalone/#gevent

```python
from gevent.wsgi import WSGIServer # incorrect
from gevent.pywsgi import WSGIServer # correct to pywsgi
from yourapplication import app

http_server = WSGIServer(('', 5000), app)
http_server.serve_forever()
```

Thanks for all the hard work!
Jeff
Tiny correction to the documentation on GEvent as a WSGI standalone container.

http://flask.pocoo.org/docs/1.0/deploying/wsgi-standalone/#gevent

```python
from gevent.wsgi import WSGIServer # incorrect
from gevent.pywsgi import WSGIServer # correct
from yourapplication import app

http_server = WSGIServer(('', 5000), app)
http_server.serve_forever()
```

Thanks for all the hard work!
Jeff
### Expected Behavior

Server errors or I see a traceback. I'm trying to run a little flask app as part of a kivy frontend (goal to make a multiplayer card game app). In a later endpoint I typed `njwfnof` to simulate an error and nothing happened when the endpoint was hit. Is this intended?

```python
class FlaskThread(Thread):
    def __init__(self, *args, **kwargs):
        self.root = kwargs.pop('root')
        super().__init__(*args, **kwargs)

    def run(self):
        app.root = self.root
        app.run(
            host='127.0.0.1', port=8888, debug=True, use_debugger=True,
            # setting use_reloader to False because it can't be True if not run in main thread
            use_reloader=False)

```

### Actual Behavior

Server stays up but nothing happens

### Environment

* Python version: 3.6.4
* Flask version: Flask 1.0.2
* Werkzeug version: 0.14.1

On latest PyPI's release (1.0.2), using `logging`'s root logger before running Flask breaks its logging.

For example, with such a `run.py` file:
```python
import logging
import flask

logging.info("it breaks")
flask.Flask(__name__).run()
```

`python run.py` outputs this:
```
 * Serving Flask app "run" (lazy loading)
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: off
```

and then stops any kind of logging.

The application is running and answering, but you don't get the `Running on http://...` line, nor any request logging.

It's worth noting that using the root logger inside a route doesn't break Flask.
fix a bug when judge if methos are string

the condition may be wrong：
"GET" isinstance of (str,)

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

Added instructions on how to serve single page applications as a Flask Pattern in the docs. I tried it out for React Router and everything works as expected.

Thanks to David for helping us get started at the PyCon Canada Sprints!
### Expected Behavior

I tried to write a flask builder for now, and from the exist HTTPServer example https://github.com/liudonghua123/now-builders/blob/master/packages/now-python/now_handler.py, I should get a `handle_request` method executed when a new incoming request arrived.
But after driving into the acturally code, I could not found such a method. Some code may be add into `flask` and `werkzeug` both.


```python
import json
import requests
from __NOW_HANDLER_FILENAME import app
import _thread


def now_handler(event, context):
    _thread.start_new_thread(app.handle_request, ())
    payload = json.loads(event['body'])
    path = payload['path']
    headers = payload['headers']
    method = payload['method']
    
    res = requests.request(method, 'http://0.0.0.0:3000' + path, headers=headers)

    return {
        'statusCode': res.status_code,
        'headers': dict(res.headers),
        'body': res.text
    }


```

The __NOW_HANDLER_FILENAME file contents may like this
```python
from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello, World!'
```

### Actual Behavior

The `handle_request` or like method does not exist.

### Environment

* Python version: 3.7.0
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

If create_url_adapter raises (which it can if werkzeug cannot bind environment, for example on ~non-ASCII~ non-printable Host header), we should handle it as other routing exceptions rather than raising through. This allows us to return a HTTP 400, rather than a 500 from unhandled exception.

This came up in https://github.com/pallets/werkzeug/issues/640

Do we need to add it to any documentation or changelogs?
Update the documentation to point users to use flask-caching instead of the deprecated Werkzeug cache. I have linked to [flask-caching's documentation](https://flask-caching.readthedocs.io/en/latest/) instead of copying flask-caching example code.

### Expected Behavior

When streaming from a generator, if there is an exception thrown then the application's custom exception handler should catch this exception.

```python
from flask import Flask, Response

app = Flask(__name__)

@app.route('/')
def default_route():
    return 'hello world'

@app.route('/error')
def error_route():
    raise Exception('error in error_route')

@app.route('/streamingerror')
def streaming_error_route():
    def inner_gen():
        raise Exception('error from streaming_error_route')
        yield 'hello'
    return Response(inner_gen())

@app.errorhandler(Exception)
def custom_exception_handler(_):
    return 'handled by custom exception handler'
```

### Actual Behavior

```
 $ curl localhost:5000
hello world~
 $ curl localhost:5000/error
handled by custom exception handler~
 $ curl localhost:5000/streamingerror
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<title>500 Internal Server Error</title>
<h1>Internal Server Error</h1>
<p>The server encountered an internal error and was unable to complete your request.  Either the server is overloaded or there is an error in the application.</p>
```

The request to `/streamingerror` should also pass through the custom exception handler.

### Environment

* Python version: 3.6.3
* Flask version: 1.0.2
* Werkzeug version: 0.14.1

### Other notes

I had tried with `stream_with_context` and the same behavior still exists.
Followup to #2990
Updates error handling Sentry documentation examples:

- Update `getsentry.com` URLs to `sentry.io`
- Change examples to use the Sentry Python SDK: `sentry-sdk`
- Removed the app factory pattern example (new sdk uses signals, not app object)
- Added a custom exception handling example

---
Related: #2917 

<!--
Commit checklist:

* add tests that fail without the patch
* ensure all tests pass with ``pytest``
* add documentation to the relevant docstrings or pages
* add ``versionadded`` or ``versionchanged`` directives to relevant docstrings
* add a changelog entry if this patch changes code

Tests, coverage, and docs will be run automatically when you submit the pull
request, but running them yourself can save time.
-->

```
    def select_jinja_autoescape(self, filename):
        """Returns ``True`` if autoescaping should be active for the given
        template name. If no template name is given, returns `True`.

        .. versionadded:: 0.5
        """
        if filename is None:
            return True
        return filename.endswith(('.html', '.htm', '.xml', '.xhtml'))
```

This seems odd. Why not just autoescape all file extensions. Or at least include `.j2` and `.jinja2`?
Hi, I have two classes with one-to-many relation type between them. when I want to retrieve one element on the parent objet, I get the error:
relationship 'recipes' expects a class or a mapper argument (received: <class 'sqlalchemy.sql.schema.Table'>)

this is my classes ;
parent : 

```python
class UserJsonSerializer(JsonSerializer):
    __json_public__ = ['id', 'email']


class User(UserJsonSerializer, db.Model):
    __tablename__ = 'users'

    id = db.Column(db.Integer, primary_key=True, autoincrement=True)
    public_id = db.Column(db.String(36),  primary_key=True,
                          default=str(uuid.uuid4()))
    username = db.Column(db.String(255))
    email = db.Column(db.String(255), unique=True)
    password_hash = db.Column(db.String(128))
    _avatar_url = db.Column(db.String(260), nullable=True)
    reputation = db.Column(db.Integer, default=0)
    email_confirmation_sent_on = db.Column(
        db.DateTime,  default=datetime.datetime.utcnow)
    email_confirmed = db.Column(db.Boolean, nullable=True, default=False)
    email_confirmed_on = db.Column(
        db.DateTime, default=datetime.datetime.utcnow)
    registered_on = db.Column(db.DateTime, default=datetime.datetime.utcnow)
    last_login_at = db.Column(db.DateTime())
    current_login_at = db.Column(db.DateTime())
    last_login_ip = db.Column(db.String(100))
    current_login_ip = db.Column(db.String(100))
    login_count = db.Column(db.Integer)
    roles = db.relationship('Role', secondary=roles_users,
                            backref=db.backref('users', lazy='dynamic'))
    recipes = db.relationship('Recipe', backref='user', lazy='dynamic')

    @property
    def password(self):
        raise AttributeError('password: write-only field')

    @password.setter
    def password(self, password):
        self.password_hash = bcrypt.generate_password_hash(
            password).decode('utf-8')

    def check_password(self, password):
        return bcrypt.check_password_hash(self.password_hash, password)

    @property
    def avatar_url(self):
        if not self._avatar_url:
            return None
        if self._avatar_url.startswith('http'):
            return self._avatar_url
        base = current_app.config['ZERQU_AVATAR_BASE']
        return '%s%s' % (base, self._avatar_url)
child : 
class Recipe(db.Model):
    """Recipe fields to add:
        date last modified
    """
    __tablename__ = "Recipes"

    id = db.Column(db.Integer, autoincrement=True, primary_key=True)
    public_id = db.Column(db.String(100), unique=True,
                          default=str(uuid.uuid4()))
    recipe_title = db.Column(db.String, nullable=True)
    recipe_description = db.Column(db.String, nullable=True)
    is_public = db.Column(db.Boolean, nullable=True)
    image_filename = db.Column(db.String, default=None, nullable=True)
    image_url = db.Column(db.String, default=None, nullable=True)
    recipe_type = db.Column(db.String, default=None,
                            nullable=True)  # TODO:recipe type update
    rating = db.Column(db.Integer, default=None, nullable=True)
    ingredients = db.Column(db.Text, default=None, nullable=True)
    ingredients_html = db.Column(db.Text, default=None, nullable=True)
    recipe_steps = db.Column(db.Text, default=None, nullable=True)
    recipe_steps_html = db.Column(db.Text, default=None, nullable=True)
    inspiration = db.Column(db.String, default=None, nullable=True)
    dairy_free_recipe = db.Column(db.Boolean, nullable=True)
    soy_free_recipe = db.Column(db.Boolean, nullable=True)
    cholesterol_free_recipe = db.Column(db.Boolean, nullable=True)
    created_on = db.Column(db.DateTime, nullable=False,
                           default=datetime.datetime.utcnow)
    updated_on = db.Column(db.DateTime, onupdate=datetime.datetime.utcnow)
    created_by = db.Column(db.Integer, db.ForeignKey('users.id'))
    category_id = db.Column(
        db.Integer, db.ForeignKey('categories.id'))

and this is the query: 
@staticmethod
    def login_user(data):
        try:
            # fetch the user data
            user = User.query.filter_by(email=data.get('email')).first() <-- this is the query
            if user and user.check_password(data.get('password')):
                auth_token = user.encode_auth_token(user.id)
                if auth_token:
                    response_object = {
                        'status': 'success',
                        'message': 'Successfully logged in.',
                        'Authorization': auth_token.decode()
                    }
                    return response_object, 200
            else:
                response_object = {
                    'status': 'fail',
                    'message': 'email or password does not match.'
                }
                return response_object, 401

        except Exception as e:
            print(e)
            response_object = {
                'status': 'fail',
                'message': 'Try again'
            }
            return response_object, 500
```

### Environment

* Python version: 3.7.0
* Flask version: 0.12.2
* Werkzeug version:

### Expected Behavior

At the flask documentation for the request context/object http://flask.pocoo.org/docs/1.0/api/#incoming-request-data many items in the section say "see also **trusted_hosts**". For example http://flask.pocoo.org/docs/1.0/api/#flask.Request.host.

This should be a link, or obvious where to follow to understand what this is.

### Actual Behavior

There isn't a link, and it's not clear what the see also is referring to (perhaps in werkzeug?)

### Environment

http://flask.pocoo.org/docs/1.0/api/#incoming-request-data

Fixes https://github.com/pallets/flask/issues/2984
### Expected Behavior
Flask should be able to read session data

### Actual Behavior
with itsdangerous >= 1.0.0 flask cannot read session data if the session data was written by itsdangerous < 1.0.0

```
Session: <SecureCookieSession {}>
```

`itsdangerous.exc.BadTimeSignature` is being raised and then caught [here](https://github.com/pallets/flask/blob/master/flask/sessions.py#L345)

itsdangerous is [allowed](https://github.com/pallets/flask/blob/master/setup.py#L39) to bump major versions

itsdangerous [recently changed](https://github.com/pallets/itsdangerous/commit/24ff6764b67d1e05ba71bbcdba006119324464fd#diff-e4eb329834da3d36278b1b7d943b3bc9R11)  its digest_method

[This digest method is now wrong](https://github.com/pallets/flask/blob/master/flask/sessions.py#L313)


### Environment

* Python version: Python 2.7.6
* Flask version: 0.10.1
* Werkzeug version: 0.14.1
* itsdangerous version: 1.1.0

This is related to https://github.com/pallets/flask/issues/2841, but the emphasis is different.

### Expected Behavior

Non-error exceptions should not be caught by registered error handlers.

```python
app.register_error_handler(HTTPException, my_error_handler)

@app.route('/path-with-slash/')
def my_route():
    return '', 204
```

Attempting to visit `/path-with-slash` should redirect to `/path-with-slash/`, without invoking `my_error_handler`.

### Actual Behavior

As the `RequestRedirect` raised internally in Werkzeug is a subclass of `HTTPException`, `my_error_handler` will get called. This is unexpected because no error has occurred, and the only appropriate way to handle this case is to add boilerplate to re-raise any Werkzeug `RoutingException`s.

### Environment

* Python version: 3.7.0
* Flask version: 1.0.2
* Werkzeug version: 0.14.1
Fixes https://github.com/pallets/flask/issues/2778

cc @ThiefMaster

This follows my last proposal in https://github.com/pallets/flask/issues/2778#issuecomment-435130792.
I just added one warning to people that is using python3.

#2981
I tried use [Method override pattner](http://flask.pocoo.org/docs/1.0/patterns/methodoverrides/) and it was crashed when method.encode('ascii', 'replace') because the next method needs string value and not byte value.
I am running flask dev server using the `flask` command. If an exception is thrown (such as syntax error) and then fixed. The next reload fails with some sort of issues having to due with attempting to reinitialize extensions. For example I get the following error from flask-admin (though depending on order of imports I get similar errors from other extensions):
```
AssertionError: A name collision occurred between blueprints <flask.blueprints.Blueprint object at 0x1118b96d8> and <flask.blueprints.Blueprint object at 0x1042880b8>. Both share the same name "admin". Blueprints that are created on the fly need unique names.
```
I don't think this is the same issue as https://github.com/pallets/flask/issues/2423 as I can trigger the problem with non syntax error (ie a name error a module scope).

### Environment

* Python version:
`3.7`

* Flask version:
`flask==1.0.2`

* Werkzeug version:
`werkzeug==0.14.1`


### Expected Behavior

The following code should be able to log to stderr, however app.logger.* does nothing

```python
import os                                             
                                                      
from flask import Flask                               
import bitcoinlib # Un/commenting this line will brake flask logger                                 
                                                      
app = Flask(__name__, instance_relative_config=True)  
                                                      
@app.route('/hello')                                  
def hello():                                          
    return 'Hello, World!'                            
                                                      
                                                      
if __name__ == '__main__':                            
    app.debug = True                                  
    app.logger.debug("Launched")                      
    app.run()                                         
```

### Actual Behavior

No log messages on the console when using app.logger.*

### Environment

* Python version: 2.7.15
* Flask version: 1.0.2
* Werkzeug version: 0.14.1
