
- update assert param(expect, actual) position
it's a long time from the latest v1.2 released on Jul 2, 2017, when will be the next version released?
ENV_GIN_MODE -> EnvGinMode

mkdir a test data dir.
the pull request update `return error(err)` to `return err`, and remove `kindOfData`.
I have add gin params in native context when you use Wrap utils.

simple example:
```go
package main

import (
	"fmt"
	"net/http"

	"github.com/gin-gonic/gin"
)

func NewHandler() http.Handler {
	return http.HandlerFunc(func(rw http.ResponseWriter, r *http.Request) {
		params := gin.GetParams(r)
		fmt.Println(params)
	})
}

func main() {
	r := gin.Default()
	r.GET("/hello/:name", gin.WrapH(NewHandler()))
	r.Run(":8080")
}
```
I want to do like bellow nginx conf with gin, so how to do?  thanks somebody can help me.
```
location / {
    try_files $uri $uri/ /index.html;
  }
```
ref #1075 
annotation from go context source.

Issue : I tried to use optional path parameters using a _wildcard(*)_ as mentioned in the documentation but when I parse the parameters  the last parameter also _includes a slash_

**Route :**
v1.DELETE("/userdata/jobs/:requestid/*trackingID",userdata.Request)

**Hitting the api using a REST client :** 
curl -X DELETE   http://127.0.0.1:9001/v1/userdata/jobs/123/555

**In controller:**
	requestid := c.Param("requestid")
	trackingID := c.Param("trackingID")

I get requestid as **123** and trackingID as **/555**

Why is the slash being included and gin is not auto detecting the parameter?


sample code

```go
type A struct {
	b B
	c int
}

type B strcut{}

a := new(A)
c.bind(a)
```

first problem, if the field `b` parse failed, the code will return `errors.New("Unknown type")` (https://github.com/gin-gonic/gin/blob/master/binding/form_mapping.go#L129) and field c is no longer to parse. is it a bug ?

second, can you support custom parse for struct by a  interface. such as 

```go
type B strcut{}

type formParser interface{
	ParseForm([]string)
}

func (b *B) ParseForm(value []string) {
	
}
```
run dep ensure error
Solving failure: No versions of github.com/mattn/go-isatty met constraints:
	v0.0.3: unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
	
looks like  can't find the package 'golang.org/x/sys/unix'
I recently read httprouter code, and find httprouter updated some codes, I want gin should also update `tree.go`.
But this updated whether impact gin performance, I need to test later on.

please @javierprovecho @appleboy @austinheap review the merged from httprouter pull request, thanks!

- [x] performance test compare
- [x] add and update unit test case
from httprouter https://github.com/julienschmidt/httprouter/pull/239

sorry...fixed #1403 
sorry....fixed.
src/github.com/gin-gonic/gin/examples/grpc/gin/main.go:29:31: undefined: g
updated `vendor.json` is ok.
but set `ignore test` in `vendor.json`, `x/net/context` package only use in `context_test.go`, I don't know why vendor still need it.
please @appleboy review the pull request, thanks a lot.
use grpc helloworld example.
And I test them benchmark:

code:

```go
# stringsbench.go
package stringsbench

import "strings"

func index(part string) string {
	if index := strings.IndexByte(part, ';'); index >= 0 {
		if part := strings.TrimSpace(strings.Split(part, ";")[0]); part != "" {
			return part[0:index]
		}
	}
	return ""
}

func split(part string) string {
	return strings.Split(part, ";")[0]
}
```

```go
# stringsbench_test.go
package stringsbench

import (
	"testing"
)

func BenchmarkIndex(b *testing.B) {
	b.RunParallel(func(pb *testing.PB) {
		for pb.Next() {
			index("text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8")
		}
	})
}

func BenchmarkSplit(b *testing.B) {
	b.RunParallel(func(pb *testing.PB) {
		for pb.Next() {
			split("text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8")
		}
	})
}
```

And the result:

```shell
➜  strings go test --bench=.
goos: darwin
goarch: amd64
BenchmarkIndex-8   	30000000	        46.1 ns/op
BenchmarkSplit-8   	50000000	        35.9 ns/op
PASS
ok  	_/Users/tianou/strings	3.271s
➜  strings go test --bench=.
goos: darwin
goarch: amd64
BenchmarkIndex-8   	30000000	        44.2 ns/op
BenchmarkSplit-8   	50000000	        34.7 ns/op
PASS
ok  	_/Users/tianou/strings	3.156s
➜  strings go test --bench=.
goos: darwin
goarch: amd64
BenchmarkIndex-8   	30000000	        45.6 ns/op
BenchmarkSplit-8   	50000000	        35.3 ns/op
PASS
ok  	_/Users/tianou/strings	3.230s
```
My go version 

> go version go1.9.2 darwin/amd64

Go Env

> GOARCH="amd64"
> GOBIN=""
> GOEXE=""
> GOHOSTARCH="amd64"
> GOHOSTOS="darwin"
> GOOS="darwin"
> GOPATH="/usr/local/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/go/bin:/opt/X11/bin:/Applications/Wireshark.app/Contents/MacOS:/usr/local/go/bin"
> GORACE=""
> GOROOT="/usr/local/go"
> GOTOOLDIR="/usr/local/go/pkg/tool/darwin_amd64"
> GCCGO="gccgo"
> CC="clang"
> GOGCCFLAGS="-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/x4/v6pjwfwj3xn08hyt33nx8rz80000gq/T/go-build398879045=/tmp/go-build -gno-record-gcc-switches -fno-common"
> CXX="clang++"
> CGO_ENABLED="1"
> CGO_CFLAGS="-g -O2"
> CGO_CPPFLAGS=""
> CGO_CXXFLAGS="-g -O2"
> CGO_FFLAGS="-g -O2"
> CGO_LDFLAGS="-g -O2"
> PKG_CONFIG="pkg-config"

and i try to send data to server by following way:

`curl -X PUT --data '{"last_name":"new last", "first_name":"new first"}' http://127.0.0.1:3000/person?id=3`

and then the server get it by 

       `first_name := c.PostForm("first_name")
         last_name := c.PostForm("last_name")`
but i got `nil` instead . How can i do ?
Support both http/1.x and h2c over the same plain tcp port. 

It is common to make h2c communication on the server side environment. However,  the standard **net/http** library does not support this feature in box ([more detail](https://github.com/golang/go/issues/14141)). It would be a great convenient for gin to support it.

This patch is extracted from 	[William Chang's work](https://go-review.googlesource.com/c/net/+/112999).


I use TLS connection with GIN
Now I need to implement client certificate authorization.
It's possible?

When I catch 404 I wrote this code 
```Go
func Response404(c *gin.Context, err error) {
	if err != nil {
		c.AbortWithStatusJSON(404, gin.H{"error": err.Error()})
		panic(err)
	}
}
```
But I use panic func seem like server return status 500, not the best option.
How can I jump to middleware ErrorHandler like this when I got 404
```Go
func ErrorHandler(c *gin.Context) {
	c.Next()

	// TODO: Handle it in a better way
	if len(c.Errors) > 0 {
		c.AbortWithStatusJSON(http.StatusBadRequest, gin.H{
			"errors": c.Errors,
		})
		return
	}
}
```
Thank you! 
Hey,

im wondering how a sample code would look like that allows the REST-API user to specify the api version through the path or  query string paramter.

Reference: https://github.com/Microsoft/api-guidelines/blob/vNext/Guidelines.md#121-versioning-formats

Can someone give me an example how it could be done?
ref #1381 

I'm using gin gonic as http framework and I need to group some paths with shared variable by like this:

    ur := r.Group("/")
    ur.Use(package.Prepare)
    {
    	ur.GET("/", package.Home)
    }

Inside the `Prepare` handler, I declare package variable like
`package.tplPath` because I want all sub routes can access to this variable instead of rewrite the code in each http handler.

    var tplPath = ""
    
    func Prepare(c *gin.Context) {
    	_, filename, _, _ := runtime.Caller(0)
    	s := helper.RelativeFilePath(filename)
    	tplPath = s[1:len(s)] + "template/"
    }

I don't know how Go works with each process, and variables for each http request. If a variable was declared in package level, will it be set after each http request?

Is this considered good practice? If not, why not?

I use the `LoginHandler` for my route/controller to handle user login, and the login credentials is POSTed in the form of json. I found this line 350 in auth_jwt.go problematic, as it throws `ErrMissingLoginValues` error.

```go
if c.ShouldBind(&loginVals) != nil
```
After changing it to `c.ShouldBinJSON`, it works for me. Does anyone else have this problem, too?
We get a panic in a loaded project related with use c.Get / c.Set in many middleware routines.
ref: #748 

Get matched route from context to count the number of calls to the interface or to control user permissions.
Hey folks :)

I use Docker's `--add-host dns-name:ip` to redirect internal. But as it seams gin is completely ignoring this and is using the normal dns resolution.

https://github.com/drone/drone/blob/a85f89a3c188ea9eba0991c483bb2a2b9e855377/server/login.go#L51
There resides my problem. At the moment I have multiple IPs for git, nginx and the CI. But I can not redirect it internal thus the login is ending in an timeout with the public ip and not the internal one. 

I hope you can take a look at this.
I'm experimenting with vgo, and it won't recognize the v1.2 release when I list available releases:
    vgo list -t github.com/gin-gonic/gin
    github.com/gin-gonic/gin
        v1.1.1
        v1.1.2
        v1.1.3
        v1.1.4

I'm pretty sure this is because it is expecting semver tags. Would it be possible for you to add a tag for v1.2.0?
Please @javierprovecho @appleboy review the pull request, thanks a lot!

ref: #1362 #398 

Idea: declare one `in map[string]interface{}` (**MUST**), and user inputs `-F 'in={"i":1}'`.

Support map for map form, can use the curl command:

    curl -v http://localhost:8080/loginForm -F 'user={"a":"hello","b":2, "c": 3.14}' -F 'password=123'

and the following golang code:

    package main

	import (
		"github.com/gin-gonic/gin"
		"net/http"
	)

	// Binding from JSON
	type Login struct {
		User     map[string]interface{} `form:"user"`
		Password string                 `form:"password"`
	}

	func main() {
		router := gin.Default()

		router.POST("/loginForm", func(c *gin.Context) {
			var form Login
			// This will infer what binder to use depending on the content-type header.
			if err := c.ShouldBind(&form); err == nil {
				if form.User["a"].(string) == "hello" && form.User["b"].(float64) == 2 && form.User["c"].(float64) == 3.14 && form.Password == "123" {
					c.JSON(http.StatusOK, gin.H{"status": "you are logged in"})
				} else {
					c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
				}
			}
		})

		// Listen and serve on 0.0.0.0:8080
		router.Run(":8080")
	}

it will output the result:

    *   Trying ::1...
	* TCP_NODELAY set
	* Connected to localhost (::1) port 8080 (#0)
	> POST /loginForm HTTP/1.1
	> Host: localhost:8080
	> User-Agent: curl/7.54.0
	> Accept: */*
	> Content-Length: 269
	> Expect: 100-continue
	> Content-Type: multipart/form-data; boundary=------------------------02819574d8de733f
	>
	< HTTP/1.1 100 Continue
	< HTTP/1.1 200 OK
	< Content-Type: application/json; charset=utf-8
	< Date: Sun, 10 Jun 2018 05:05:13 GMT
	< Content-Length: 30
	<
	* Connection #0 to host localhost left intact
	{"status":"you are logged in"}
Hello. I have noticed, that Bind method does not work correctly with [gorm.Model's](http://gorm.io/docs/conventions.html#gorm-Model) DeletedAt pointer field. Binder populates it with a 0001-01-01 00:00:00+00 timestamp, though I don't have it set in the html form. This leads to an unexpected behavior, when newly created record (say User model, embedding gorm.Model struct) has not null DeletedAt timestamp and hence marked as deleted. Of course I can override gorm.Model with my own type and set `binding:"-"` to DeletedAt field, but this looks weird to me :) Thank you.
Ps: Just checked: binding:"-" tag does not help.
So, if I use `c.BindJSON(&mystruct)`, and this fails, and then, I respond with my error message, `c.JSON(406, gin.H{"message", "my message"})`, gin overrides this and still responds with 400...So, I'd rather be able to set my own reponse code, but then, it also changes `Content-Type` to `text/plain`. Is this the undocumented intended behavior, or is this a bug?
Hello, 
I am using gin-gonic for my application. I want to run all my api's on port 8080 with https method.
I am using below structure. Let me know if I need to follow the extra steps for this.
        <pre>r := gin.Default()
	r.GET("/ping", func(c *gin.Context) {
		c.JSON(200, gin.H{
			"message": "pong",
		})
	})
	r.Run()</pre>
ref: #1362 #1106 

please @javierprovecho @appleboy review the idea, thanks!

when use the following curl command:

    curl -X POST 'http://localhost:8888/post?ids\[a\]=1234&ids\[b\]=hello&ids\[c\]=3.14'

and use `c.QueryMap("ids")` will return the following result:

    ids: map[c:3.14 a:1234 b:hello]

- [x] Add query map for post form
- [x] Add unit test
- [x] Add document
- [x] Support post form map for go1.6
does Gin has Internationalization support(i18n)?

where's the Document or Example.
Now golang have released version 1.10, and gin have not use 1.7 or 1.8 `context` feature and so on.
We may point out `require golang 1.7` and `require golang 1.8` period of time.

ref: https://golang.google.cn/doc/devel/release.html#policy
So, my post request looks something like this:

```js
fetch('/endpoint', {method: "POST", body: "my string"})
```

And, I'm trying to bind the body to a string like this:

```golang
var x string
c.Bind(&x)
```

But I'm getting the error `reflect: NumField of non-struct type`.

What is the appropriate way to get the body as a string, or do I need to just use the http Request.Body as a reader?
Looks like `golang.org/x/sys/unix` imported in `github.com/mattn/go-isatty` which imported  in `logger.go`. Can we replace it with other solution?
Hi,

I'm wondering if gin support concurrent process of requests. If I have much more clients than server, does gin have a goroutine for each request or it process every request in sequence? If it does support, is there an example to get high concurency?

Thanks
To increase log-details I want to put into the log the data, that ShouldBind*() read from Request.Body before fail.
I could write everything into a file with #805 post.
Related to this, how could it be possible to write error into a separate log?

--
I assume to use gin.DefaultErrorWriter, but it seems that log.SetOuput is only possible with a single file.

Current output (everything into a single file)
```
[GIN] 2018/05/30 - 19:21:17 | 404 |     114.656µs |             ::1 |  GET     /comment/view/99999
Error #01: th size of input parameter is not 40
[GIN] 2018/05/30 - 19:21:20 | 200 |     1.82468ms |             ::1 |  GET     /comment/view/00001

```

Current code
```
logfile, err := os.OpenFile(c.GinLogPath, os.O_RDWR|os.O_CREATE|os.O_APPEND, 0666)
if err != nil {
    log.Fatalln("Failed to create request log file:", err)                                 
}

errlogfile, err := os.OpenFile(c.GinErrorLogPath, os.O_RDWR|os.O_CREATE|os.O_APPEND, 0666)
if err != nil {
    log.Fatalln("Failed to create request log file:", err)
}

// set request logging
gin.DefaultWriter = io.MultiWriter(logfile)
gin.DefaultErrorWriter = io.MultiWriter(errlogfile)
log.SetFlags(log.Ldate | log.Ltime | log.Lshortfile)
log.SetOutput(gin.DefaultWriter)
```
Can i see urs example plix! My is:
```
type mystruct struct {
    Num int8  `form:"num" binding:"required"`
}
```

```
// part of handler
err := ctx.ShouldBind(&mystruct)
	if err != nil {
               fields := validate.SelectFieldsName(err)
		ctx.JSON(http.StatusOK, gin.H{
			"status":  false,
                        "fields": fields,
		})
		return
	}
```
Is it valid? Or i need to do something like:
```
// part of handler
err := ctx.ShouldBind(&mystruct)
	if err != nil {

		errs, ok := err.(validator.ValidationErrors)
		if !ok {
			return
		}

                fields := validate.SelectFieldsName(errs)
		ctx.JSON(http.StatusOK, gin.H{
			"status":  false,
                        "fields": fields,
		})
		return
	}
```
Because anyone can put big number and the error will be "number out of range", not "validator.ValidationErrors" (parse int8). Do you do frontend validation?
Hi All,
I am newbie for Golang. I have to create the application that capture the audio raw data & post to the service. But I am unable to find the way to get the data server side. 

Please help me to get the data at server end

    `function sendAudio (dataView) {
	    return new Promise((resolve, reject) => {
	      var xhr = new XMLHttpRequest();
	      var url = 'https://localhost/soerest/api/v1/echo';
	      xhr.open('POST', url, true);
	      xhr.responseType = 'arraybuffer';
	      xhr.onload = (event) => {
	        console.log(xhr.response);
	      };

	      xhr.onerror = (error) => {
	          console.error(error);
	      };

	      xhr.onerror = (error) => {
	        this._log(error);
	        reject(error);
	      };
	      var BOUNDARY = 'BOUNDARY1234';
	      var BOUNDARY_DASHES = '--';
	      var NEWLINE = '\r\n';
	      var AUDIO_CONTENT_TYPE = 'Content-Type: audio/L16; rate=16000; channels=1';
	      var AUDIO_CONTENT_DISPOSITION = 'Content-Disposition: form-data; name="audio"';

	      var postDataStart = [
	        NEWLINE, BOUNDARY_DASHES, BOUNDARY, NEWLINE,
	        AUDIO_CONTENT_DISPOSITION, NEWLINE, AUDIO_CONTENT_TYPE, NEWLINE, NEWLINE
	      ].join('');

	      var postDataEnd = [NEWLINE, BOUNDARY_DASHES, BOUNDARY, BOUNDARY_DASHES, NEWLINE].join('');

	      var size = postDataStart.length + dataView.byteLength + postDataEnd.length;
	      var uint8Array = new Uint8Array(size);
	      let i = 0;

	      for (; i < postDataStart.length; i++) {
	        uint8Array[i] = postDataStart.charCodeAt(i) & 0xFF;
	      }

	      for (var j = 0; j < dataView.byteLength; i++, j++) {
	        uint8Array[i] = dataView.getUint8(j);
	      }

	      for (var j = 0; j < postDataEnd.length; i++, j++) {
	        uint8Array[i] = postDataEnd.charCodeAt(j) & 0xFF;
	      }
	      var payload = uint8Array.buffer;
	      
	      xhr.setRequestHeader('Content-Type', 'multipart/form-data; boundary=--' + BOUNDARY);
	      xhr.send(payload);
	    });
	  }
`

My server side code is as

    `func (spr *SpeechHandler) Speeche(c *gin.Context) {

	// curl -i http://localhost:8080/api/v1/echo
	fmt.Println("echo method has been called: ")
	// Multipart form
	multipart, err := c.Request.MultipartReader()//c.MultipartForm()
	if err != nil {
		c.String(http.StatusBadRequest, fmt.Sprintf("get form err: %s", err.Error()))
		return
	}
	for {
		mimePart, err := multipart.NextPart()
		if err == io.EOF {
			break
		}
		if err != nil {
			log.Printf("Error reading multipart section: %v", err)
			break
		}
		disposition, params, err := mime.ParseMediaType(mimePart.Header.Get("Content-Disposition"))
		if err != nil {
			break
		}
	}
    }`

I am getting error
    `multipart: NextPart: EOF`

Please help me where I am doing wrong. I am stuck here :-(

Thanks you to all in advance.

Regards,
Dinesh Gupta
This is weird, I post a simply form, so simply with some fileds, one of them is none-English words like `总问字符串`. The client is Flutter, here is the server codes:
```
func HandleUserRegister(context *gin.Context) {

	userAcc := context.PostForm("user_acc")
	userAvatar := context.PostForm("user_avatar")
// this always becomes null, when it is a `中文字符串` like, change to English just ok
	userNickName := context.PostForm("user_nick_name")
	userPassword := context.PostForm("user_password")
	userPhone := context.PostForm("user_phone")
	userEmail := context.PostForm("user_email")
	userGender := context.PostForm("user_gender")
	userSign := context.PostForm("user_sign")

	userType := context.PostForm("user_type")
	userTypeInt, _ := strconv.Atoi(userType)

	log.Infof("userAcc: %s, userNickName: %s, userPassword: %s", userAcc, userNickName, userPassword)
}
```
And I post an issue on flutter, they claims that it's server side problem, I test this on my another django server, django can receive the Chinese filed correctly.

What this wrong, is that multiformdata or encoding problem?
I've asked a question in [stackoverflow](https://stackoverflow.com/questions/50523102/how-to-return-custom-error-with-gin) but cannot give answer for my question please can anybody look at it.
Reference this issue #1323 

1. There isn't any eg about `HandleContext`  
2. The `c.Request.Path`  of `HandleContext` Comment  is not right   

Based on the above two points, I pull this request.  
If you think it's unnecessary, I will close this.  
Thx. 

Fixes #1331

HTTP logging leaks sensitive request information.

This PR removes HTTP request logging during panics.
Keep the logic of handling errors in render 

### 1. About Render function, methods of handling the error are different

[data.go#L15](https://github.com/gin-gonic/gin/blob/bf7803815b0baa22ff7a10457932882dfbf09925/render/data.go#L15) data return err 
[html.go#L69](https://github.com/gin-gonic/gin/blob/bf7803815b0baa22ff7a10457932882dfbf09925/render/html.go#L69) html return err      
[json.go#L59](https://github.com/gin-gonic/gin/blob/bf7803815b0baa22ff7a10457932882dfbf09925/render/json.go#L59) IndentedJSON return err          
[json.go#L91](https://github.com/gin-gonic/gin/blob/bf7803815b0baa22ff7a10457932882dfbf09925/render/json.go#L91) JsonpJSON return err 
[msgpack.go#L23](https://github.com/gin-gonic/gin/blob/bf7803815b0baa22ff7a10457932882dfbf09925/render/msgpack.go#L23) MsgPack return err
[reader.go#L17](https://github.com/gin-gonic/gin/blob/bf7803815b0baa22ff7a10457932882dfbf09925/render/reader.go#L17) Reader return err
[xml.go#L18](https://github.com/gin-gonic/gin/blob/bf7803815b0baa22ff7a10457932882dfbf09925/render/xml.go#L18) XML return err
[yaml.go#L19](https://github.com/gin-gonic/gin/blob/bf7803815b0baa22ff7a10457932882dfbf09925/render/yaml.go#L19) YAML return err  

[json.go#L38](https://github.com/gin-gonic/gin/blob/bf7803815b0baa22ff7a10457932882dfbf09925/render/json.go#L38) JSON panic   
[text.go#L20](https://github.com/gin-gonic/gin/blob/bf7803815b0baa22ff7a10457932882dfbf09925/render/text.go#L20) Text return nil (Actually，"write" maybe cause error. Please see the second part)   


Actually，there is already a outter place to focus on the error [context.go#L661](https://github.com/gin-gonic/gin/blob/bf7803815b0baa22ff7a10457932882dfbf09925/context.go#L661)
```
func (c *Context) Render(code int, r render.Render) {
	c.Status(code)

	if !bodyAllowedForStatus(code) {
		r.WriteContentType(c.Writer)
		c.Writer.WriteHeaderNow()
		return
	}

	if err := r.Render(c.Writer); err != nil {
		panic(err)
	}
}
```
so I see, it is right if all "function Render" in "render folder"  return err.   
And the outter `context.go` handle this err.


### 2. Some code ignore err in "render", like this 
 [text.go#L29](https://github.com/gin-gonic/gin/blob/bf7803815b0baa22ff7a10457932882dfbf09925/render/text.go#L29) "fmt.Fprintf" and "io.WriteString" ignore the error

[json.go#L59](https://github.com/gin-gonic/gin/blob/bf7803815b0baa22ff7a10457932882dfbf09925/render/json.go#L59)  "write" ignore the error

and so on.


Based on the above two points, I pull this request.
If you think it's unnecessary, I will close this.
Thx.
# crypto/x509
In file included from /System/Library/Frameworks/Security.framework/Headers/AuthSession.h:32,
                 from /System/Library/Frameworks/Security.framework/Headers/Security.h:43,
                 from /usr/local/Cellar/go/1.10.2/libexec/src/crypto/x509/root_cgo_darwin.go:17:
/System/Library/Frameworks/Security.framework/Headers/Authorization.h:192:7: error: variably modified 'bytes' at file scope
  char bytes[kAuthorizationExternalFormLength];
       ^~~~~

I noticed this problem when trying to use Context.Stream on google app engine. This line in response_writer.go is causing a panic:

https://github.com/gin-gonic/gin/blob/master/response_writer.go#L108

The error stack I'm getting looks like this:
```
panic: interface conversion: *appengine_internal.aecontext is not http.CloseNotifier: missing method CloseNotify

goroutine 7 [running]:
panic(0x181be80, 0xc0135467c0)
	go/src/runtime/panic.go:489 +0x2cf
github.com/gin-gonic/gin.(*responseWriter).CloseNotify(0xc016d9da20, 0x1c)
	github.com/gin-gonic/gin/response_writer.go:108 +0x43
github.com/gin-gonic/gin.(*Context).Stream(0xc016d9da20, 0xc008433588)
	github.com/gin-gonic/gin/context.go:769 +0x42
```
Let's say I get this JSON as POST:

```
{
  fields: [
  { id: 1, value: 10 },
  { id: 2, value: true }
  { id: 3, value: 5.5 }
  ]
}
```

`value` is an unknown data type. How can I bind such a schema to use/persist it in Go? Thanks!
I have struct field ``` DeletedAt *time.Time `sql:"index"` ```
After ctx.ShouldBind(&mystruct) the value of DeletedAt field is not `nil`, but must be, becouse gorm(sql) package cant auto generate NULL for that field.

The problem is there:
github.com\gin-gonic\gin\binding\form_mapping.go

```
if inputFieldName == "" {
	inputFieldName = typeField.Name

	// if "form" tag is nil, we inspect if the field is a struct or struct pointer.
	// this would not make sense for JSON parsing but it does for a form
	// since data is flatten
	if structFieldKind == reflect.Ptr {

                //!!!!!!!!!!!!!! here first we need to check if field is not time.Time (pointer to time)
                // if it is - continue
                //something like
                if structField.Type().Elem() == reflect.TypeOf(time.Time{}) {
                          continue
                 }
                //-------------------------------
		if !structField.Elem().IsValid() {

                        //!!!!!!!!!!!! here is the problem, why set default value?????????? I need nil!!!
			structField.Set(reflect.New(structField.Type().Elem()))
		}
		structField = structField.Elem()
		structFieldKind = structField.Kind()
	}
	if structFieldKind == reflect.Struct {
		err := mapForm(structField.Addr().Interface(), form)
		if err != nil {
			return err
		}
		continue
	}
}
```
rt

```
r := gin.Default()
r.GET("/test",handler,middleware())

func middleware() gin.HandlerFunc{
// get response body in here;
...
}
```
How can I get map[string]string filed on PostForm?
I'm using Golang 1.10 with Gin (I'm not sure the version, but I'm using just `go get github.com/gin-gonic/gin`, and I'm getting a runtime error that there is `Undefined validation function on field Username`.

This is my code 

```go
type User struct {
	Username string `json:"username" binding:"required,min=4,max=30,alphanumunicode"`
	Email    string `json:"email" binding:"required,email"`
	Password string `json:"password" binding:"required"`
}
```

And it is failing on `alphanumunicode`, as defined in the [validation documentation](https://godoc.org/gopkg.in/go-playground/validator.v9#hdr-Alphanumeric_Unicode).

It has failed on several other documented validation functions as well. Does gin limit to a subset of these validation functions?

server a single file -> serve a single file
ref #610
add a json render that rendering json as ASCII string
I am retrieving a file from a multipart/form-data upload with `file, header, err := c.Request.FormFile("file")` and after some processing I need to send the file to another micro-service.
I was trying to use a classic POST and BIND with a structure like that
```

type RequestDTOWithFile struct {
	File        *multipart.File `json:"file"`
	PublicId    string         `json:"order_id"`
	Name        string         `json:"name"`
	UserId      uint           `json:"user_id"`
}

// send a RequestDTOWithFile from first micro service
http.NewRequest("POST", url, data) 

...
// recieve a RequestDTOWithFile from an other micro service
c.Bind(&data)

```

But I got stuck with `json: cannot unmarshal object into Go struct field RequestDTOWithFile.file of type multipart.File`

Is there a way to achieve that with gin?

For now, the only solution I found that could work is to recreate a multipart form like this https://stackoverflow.com/questions/20205796/golang-post-data-using-the-content-type-multipart-form-data/20397167 which is not elegant.
Here is the whole program:
```
package main



import (
	"log"
	"fmt"
	_ "github.com/jinzhu/gorm/dialects/postgres"
	"github.com/gin-gonic/gin"
	"net/http"
)


// build all routes here
func BuildRoutes() *gin.Engine{
	r := gin.Default()

	// set the v1 version group
	v1 := r.Group("/api/v1")
	{
		// user register and get
		v1.POST("/users", nil)
		v1.GET("/users", nil)

		// user status and get
		v1.POST("/status", nil)
		v1.GET("/status", nil)
	}

	return r
}

// serve the websocket
func wsServe(){
	// serve the js client

	http.HandleFunc("/a", func(w http.ResponseWriter, r *http.Request) {
		fmt.Println("FUCK!! called a???")
	})

	err := http.ListenAndServe(":9877", nil)
	if err != nil {
		log.Fatal("ListenAndServe: ", err)
	}
}

func main() {
	gin.SetMode(gin.DebugMode)


	// APIs routes part
	route := BuildRoutes()
	route.Run(":8080")

	// websocket services part
	// open websocket...
	go wsServe()
}


```
The http function not work at all... I don't know why, is there any mistake I made?
https://github.com/gin-gonic/gin/blob/bf7803815b0baa22ff7a10457932882dfbf09925/context.go#L129

Why we need writing header on abort? by doing this c.JSON() for writing errors in `ErrorLogger` failed to set Content-Type to `application/json`.

```
# gopkg.in/go-playground/validator.v8
/home/pi/go/src/gopkg.in/go-playground/validator.v8/cache.go:47: undefined: atomic.Value
# github.com/ugorji/go/codec
/home/pi/go/src/github.com/ugorji/go/codec/helper_not_unsafe.go:98: undefined: atomic.Value
```

go version go1.3.3 linux/arm
i want to add new variable in body request, if i log c.Request i can find that new variable, thank you
Also fix the same typo in a comment
Some confusion under high concurrency.

I use [wrk](https://github.com/wg/wrk) to test Gin, there's someting uncertainty. Gin seems doesn't concurrency safe.

```go

package main

import (
  "fmt"
  "sync/atomic"

  "github.com/gin-gonic/gin"
)

var count int64 = 0

func Test(c *gin.Context) {
  atomic.AddInt64(&count, 1)
  fmt.Println(count)
  c.String(200, "success")
}

func main() {
  gin.SetMode(gin.DebugMode)
  router := gin.New()
  router.GET("test", Test)
  router.Run(":8080")
}

```

Test shell code

```shell
wrk -t50 -c50 -d 1s http://localhost:8080/test
```

Gin output duplicate data,
![duplicate data](https://ws1.sinaimg.cn/small/6478deb5ly1fr63jtuav7j20h40i0760.jpg)

even if the print code like this.

```go
  countCopy := count
  go func() {
    fmt.Println(countCopy)
  }()
```
I also use [ab](https://httpd.apache.org/docs/2.4/programs/ab.html) test it, the same problem.
Hello all, I find a bug in gin.

Reproduce this like below:


```
type A struct {
        INum int64 `form:"numvalue"`
}

type B struct {
        IBool bool `form:"boolvalue"`
}

func handleParaNum(c *gin.Context) {
        var a A
        err := c.ShouldBindQuery(&a)
        if err != nil {
                c.String(200, "cause an err=%s", err.Error())
        } else {
                c.String(200, "bind ok")
        }
        return

}

func handleParaBool(c *gin.Context) {
        var b B
        err := c.ShouldBindQuery(&b)
        if err != nil {
                c.String(200, "cause an err=%s", err.Error())
        } else {
                c.String(200, "bind ok")
        }
        return
}

func main() {
        route := gin.Default()
        route.GET("/test_error_num", handleParaNum)
        route.GET("/test_error_bool", handleParaBool)
        route.Run(":8085")
}
```

And tow cmds, 
```
[root@localhost ~]# curl localhost:8085/test_error_num?numvalue=3s   
cause an err=strconv.ParseInt: parsing "3s": invalid syntax
[root@localhost ~]# curl localhost:8085/test_error_bool?boolvalue=fal
bind ok
```
But the second reply is not what we expect, then I review the source code. 

Get the point
[form_mapping.go#L164](https://github.com/gin-gonic/gin/blob/bd4f73af679e7d645f6d0277258fa360eda96f2d/binding/form_mapping.go#L164)

```
func setBoolField(val string, field reflect.Value) error {
	if val == "" {
		val = "false"
	}
	boolVal, err := strconv.ParseBool(val)
	if err == nil {
		field.SetBool(boolVal)
	}
	return nil
}
```
The code ignore the error (return nil), which is not right  



now is 2018,  go1.10 released. May be, it does not necessary for checking the implementation of the x/net/context.Context interface. Just stand lib is enough.
Keeping up with the context.go, move golang.org/x/net/context.Context interface
for instance,
```go
...
router.GET("/",fun)
...
func fun(c *gin.Context){
 //do sth
}
func ginMiddleware(c *gin.Context) gin.HandlerFunc{
  return func(c *gin.Context){
    c.Next()
 }
}
func officialMiddleware(next http.Handler) http.Handler{
return func(w http.ResponseWriter, r *http.Request){
next.ServeHTTP(w, r)
})
}
```
I know how to use a gin middleware like
```go
 router.GET("/",ginMiddleware,fun),
//or
 router.Use(ginMiddleware)
 router.GET("/",fun)
```
but how to use officialMiddleware in a gin framework
I tried below 
```go
 router.Use(officialMiddleware)   //incorrect
//or
router.GET("/",officailMiddleware,fun)  //incorrect
//finally ok
http.ListenAndServer(":addr",officialMidleware(router))  //but this make officialMidleware global
```
I want the officialMiddleware only serves fun rather than serving globally
what can I do?

I'm trying to develop using Gin, and I keep getting this warning

```
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production
```

I don't care, and it is cluttering up my log, so I can't see the real errors. Is there a way to disable this "feature"?
Hello, 

I have been trying to get my application to work with HTTP and HTTPS and for it to have let's encrypt support. I have no idea about how to go around doing this. 

Has anyone here got an example they could provide which incorporates both of this functionality?

I have seen an example over at https://github.com/gin-gonic/gin/issues/643 but I'm not sure how to get this working with let's encrypt. 

Thanks!
thank u . 
In china  ,we can not vist golang.org.
we have GFW..
so please .
ref #551 

support the follow style:

    type T struct {
        I int `form:"i"`
        J int `form:"j"`
    }

    type Login struct {
        Id *T // HERE: have no `form` name
    }

close #216 

## Reported problems

#216 says some formats in requests' body cannot be bound into different structs by calling multiple times.

```go
type modelA struct {
  Foo string `form:"foo" json:"foo" binding:"required"`
  Bar int64  `form:"bar" json:"bar" binding:"required"`
}

type modelB struct {
  Hoge string `form:"hoge" json:"hoge" xml:"hoge" binding:"required"`
  Fuga int64  `form:"fuga" json:"fuga" xml:"fuga" binding:"required"`
}

func main() {
  r := gin.New()
  r.POST("/json", func(c *gin.Context) {
    fa, fb := modelA{}, modelB{}
    if aerr := c.ShouldBindWith(&fa, binding.JSON); aerr == nil {
      c.JSON(http.StatusOK, gin.H{"form": fa})
    } else if berr := c.ShouldBindWith(&fb, binding.JSON); berr == nil {
      c.JSON(http.StatusOK, gin.H{"form": fb})
    } else {
      c.AbortWithStatusJSON(
        http.StatusBadRequest,
        gin.H{
          "errors": gin.H{
            "modelA": aerr.Error(),
            "modelB": berr.Error(),
          },
        },
      )
    }
  })
  r.Run("0:8080")
}
```

```sh
# modelA can be bound successfully
$ curl -X POST -d '{"foo":"AAA","bar":123}' 0:8080/json | jq
{
  "form": {
    "foo": "AAA",
    "bar": 123
  }
}

# but modelB cannot
$ curl -X POST -d '{"hoge":"BBB","fuga":123}' 0:8080/json | jq
{
  "errors": {
    "modelA": "Key: 'modelA.Bar' Error:Field validation for 'Bar' failed on the 'req
ired' tag\nKey: 'modelA.Foo' Error:Field validation for 'Foo' failed on the 'require
' tag",
    "modelB": "EOF"
  }
}
```

## Proposal to solve this

This PR solves this by adding a new interface `binding.BindingBody` & a new method `c.ShouldBindBodyWith`.

```go
...
    // use ShouldBindBodyWith
    if aerr := c.ShouldBindBodyWith(&fa, binding.JSON); aerr == nil {
      c.JSON(http.StatusOK, gin.H{"form": fa})
    } else if berr := c.ShouldBindBodyWith(&fb, binding.JSON); berr == nil {
      c.JSON(http.StatusOK, gin.H{"form": fb})
    } else {
...
```

```sh
# successfully modelB bound
$ curl -X POST -d '{"hoge":"BBB","fuga":123}' 0:8080/json | jq
{
  "form": {
    "hoge": "BBB",
    "fuga": 123
  }
}
```

And you can mix different formats.

```go
...
    if aerr := c.ShouldBindBodyWith(&fa, binding.JSON); aerr == nil {
      c.JSON(http.StatusOK, gin.H{"form": fa})
    } else if berr := c.ShouldBindBodyWith(&fb, binding.XML); berr == nil {
      c.JSON(http.StatusOK, gin.H{"form": fb})
    } else {
...
```

```sh
$ curl -X POST -d '<?xml version="1.0" encoding="UTF-8"?>\n<root>\n<fuga>123</fuga>\n<hoge>BBB</hoge>\n</root>' 0:8080/json | jq
{
  "form": {
    "hoge": "BBB",
    "fuga": 123
  }
}
```

I added implementations for JSON, XML, msgpack and protobuf.  Other formats, query & forms, are already available to be called multiple times, because they uses parsed `req.Form (url.Values)` instead of `req.Body`.

## Question

* If you prefer to this feature, I will add unit tests.
* I'm worrying about cool naming for `bind.BindingBody`, `c.ShouldBindBodyWith`.  I'm happy if you give better names.
**When** Static() exists, Noroute dose not work.
So I use the following way to realize custom 404 route.

	router.NoRoute(func(context *gin.Context) {
		staticFileThatIsBeingRequested := filepath.Join("/static/", context.Request.URL.Path)

		_, err := os.Stat(staticFileThatIsBeingRequested)
		if err != nil { //
			Log.Printf("404 : %s \n", context.Request.URL.Path)
			context.Redirect(404, "/404/404.html")

		} else { //
			Log.Printf("200 : %s \n", context.Request.URL.Path)
			context.File(staticFileThatIsBeingRequested)

		}
	})

When the requested file exists, it works properly.
When the requested file doesn't exist,  panic.


2018/04/29 00:30:17 [Recovery] 2018/04/29 - 00:30:17 panic recovered:
GET /login.html0 HTTP/1.1
Host: 192.168.0.4:9001
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
Accept-Encoding: gzip, deflate
Accept-Language: zh-TW,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-CN;q=0.6
Cache-Control: max-age=0
Connection: keep-alive
Cookie: session_id=36e51344e46279a70853ffc25589054d
If-Modified-Since: Thu, 20 Aug 2015 05:44:37 GMT
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.139 Safari/537.36


Cannot redirect with status code 404
/usr/local/go/src/runtime/panic.go:502 (0x4335b8)
	gopanic: reflectcall(nil, unsafe.Pointer(d.fn), deferArgs(d), uint32(d.siz), uint32(d.siz))
/home/ktv/go/src/github.com/gin-gonic/gin/render/redirect.go:20 (0x985c79)
	Redirect.Render: panic(fmt.Sprintf("Cannot redirect with status code %d", r.Code))
/home/ktv/go/src/github.com/gin-gonic/gin/context.go:645 (0x98b922)
	(*Context).Render: if err := r.Render(c.Writer); err != nil {
/home/ktv/go/src/github.com/gin-gonic/gin/context.go:704 (0x98bedf)
	(*Context).Redirect: c.Render(-1, render.Redirect{
/home/ktv/go/src/github.com/gin-gonic/gin/context.go:704 (0x98bedf)
	(*Context).Redirect: c.Render(-1, render.Redirect{
/home/ktv/workspace/chen_web/src/lib/service.go:130 (0x9a1844)
	setRouters.func1: context.Redirect(404, "/404/404.html")
/home/ktv/go/src/github.com/gin-gonic/gin/context.go:107 (0x988ef2)
	(*Context).Next: c.handlers[c.index](c)
/home/ktv/go/src/github.com/gin-gonic/gin/recovery.go:47 (0x9993a9)
	RecoveryWithWriter.func1: c.Next()
/home/ktv/go/src/github.com/gin-gonic/gin/context.go:107 (0x988ef2)
	(*Context).Next: c.handlers[c.index](c)
/home/ktv/go/src/github.com/gin-gonic/gin/logger.go:83 (0x99865b)
	LoggerWithWriter.func1: c.Next()
/home/ktv/go/src/github.com/gin-gonic/gin/context.go:107 (0x988ef2)
	(*Context).Next: c.handlers[c.index](c)
/home/ktv/go/src/github.com/gin-gonic/gin/gin.go:395 (0x9907f7)
	serveError: c.Next()
/home/ktv/go/src/github.com/gin-gonic/gin/gin.go:388 (0x99060e)
	(*Engine).handleHTTPRequest: serveError(c, 404, default404Body)
/home/ktv/go/src/github.com/gin-gonic/gin/gin.go:326 (0x98ff92)
	(*Engine).ServeHTTP: engine.handleHTTPRequest(c)
/usr/local/go/src/net/http/server.go:2694 (0x67b15b)
	serverHandler.ServeHTTP: handler.ServeHTTP(rw, req)
/usr/local/go/src/net/http/server.go:1830 (0x6772b0)
	(*conn).serve: serverHandler{c.server}.ServeHTTP(w, w.req)
/usr/local/go/src/runtime/asm_amd64.s:2361 (0x463090)
	goexit: BYTE	$0x90	// NOP




When I use "github.com/gin-gonic/gin/json",but no method "Unmarshal",Some inconvenient.
I hava a json from client post to server with string like 
```

type MatSearch struct {
		ID         uint64 `json: "id"`
		Customerid uint64 `json: "customerid"`

}
var matsearch MatSearch
c.Bind(&matsearch)
```

I need to convert string to uint64 by manual or any function to suppport auto convert string to other type data when bind with gin
Hello guys, I am trying to get a field that contain special characteres like tildes, ñ and only I can get the part before the  the first special characteres
How I can retrieve all string

 I am using this "c.PostForm("content")" where "content" contains a large text that include special characters

Useful in case if you need to bind the form to the following structure:

```
type input struct {
	Field *string `form:"field" binding:"omitempty,max=128"`
}
```
can I use goroutione like:
    
   router := gin.Default()
   go router.POST("test", func(c *gin.Context) {
      ......
   })
I see code in https://github.com/gin-gonic/gin/blob/master/binding/form_mapping.go, we can only support value field bind, do not support pointer type.


```
// example
type Params struct {
  Pa string `form:"pa"`  // which can success bind via form_mapping
  Pb *string `form:"pb"`  // which cannot bind via form_mapping
}
```

The reason is fieldKind in "func setWithProperType()" have not pointer type. 

Supporting pointer fields bind is useful we can easy know whether we pass the param. if we not passing it, it will keep nil value.
In Json Unmarshal can process pointer field also.

So do you think supporting pointer field parse in binding/form_mapping.go is a good idea?
Jsonp is common format in json to o request data from servers  in  different domains, 
I added Jsonp's data return format.
Hi, 

I notice that when I upload large image ~ 9MB, it consumption a lot of memory, is this normal ?

It rise from around 3MB to near 30MB. ( MS windows 10)

Is my code correct to code in this way ? or I miss out something ?


```
	form, err := ctx.MultipartForm()

	if err != nil {
		ctx.AbortWithStatusJSON(http.StatusBadRequest, CreateError(err))
		return
	}

	var fileName string
	for k := range form.File {
		fileName = k
	}

	file, err := ctx.FormFile(fileName)

	if err != nil {
		ctx.AbortWithStatusJSON(http.StatusBadRequest, CreateError(err))
		return
	}

	if file.Size > 8<<20 {
		ctx.AbortWithStatusJSON(http.StatusBadRequest, CreateError(errors.New("file size is larger than 8MB")))
		return
	}
```

Regards,
kiwi
Session cookies, API tokens, and authorization headers are all being leaked. The request is dumped if a handler hits a panic when using the recovery middleware: https://github.com/gin-gonic/gin/blob/65a65c2edd4e86f96634a553f07a25c38f2b1c75/recovery.go#L41

This is very insecure default behavior, and there appears to be no way to opt out other than not using the middleware.
I'm trying to start a Golang/Gin project I wrote a while back on the computer I just bought, and I'm getting the following error:

```
[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.

[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

dial tcp [::1]:5432: connect: connection refused
exit status 1
```

I've never seen this before. My project was built using [this](https://github.com/Massad/gin-boilerplate) as boilerplate and worked until now.

What does this error even mean? How do I fix it?
how to get a graceful shutdown of an HTTP server by gin web framework
ref https://github.com/gin-gonic/gin/issues/1316#issuecomment-383348823

* [x] Add note for README
assert.Equal(t, expected, actual)


The App Engine SDK is superseded by the Cloud SDK, so goapp is now deprecated.
To avoid confusion, how about changing the instruction?
Hi, I need to add some objects to my context, and recently I looked at this function but there is no test or sample documentation of how to use it.

`func HandleContext `
https://github.com/gin-gonic/gin/blob/master/gin.go#L331
Hi, I am recieving this error when attempting to install or build on a mac. 

```bash
Donalds-MacBook-Pro:gin dcasson$ go build
# github.com/gin-gonic/gin
./logger.go:60:67: undefined: isatty.IsCygwinTerminal
```

I have looked through the isatty package which and i can see that the isatty_other.go is missing from my system which is where "IsCygwinTerminal" is defined.

```bash
Donalds-MacBook-Pro:gin dcasson$ ls -la ../../mattn/go-isatty/
total 64
drwxr-xr-x  12 dcasson  staff   384 23 Oct  2016 .
drwxr-xr-x   5 dcasson  staff   160 23 Oct  2016 ..
drwxr-xr-x  13 dcasson  staff   416 23 Oct  2016 .git
-rw-r--r--   1 dcasson  staff  1099 23 Oct  2016 LICENSE
-rw-r--r--   1 dcasson  staff   374 23 Oct  2016 README.md
drwxr-xr-x   3 dcasson  staff    96 23 Oct  2016 _example
-rw-r--r--   1 dcasson  staff    64 23 Oct  2016 doc.go
-rw-r--r--   1 dcasson  staff   226 23 Oct  2016 isatty_appengine.go
-rw-r--r--   1 dcasson  staff   425 23 Oct  2016 isatty_bsd.go
-rw-r--r--   1 dcasson  staff   389 23 Oct  2016 isatty_linux.go
-rw-r--r--   1 dcasson  staff   402 23 Oct  2016 isatty_solaris.go
-rw-r--r--   1 dcasson  staff   434 23 Oct  2016 isatty_windows.go
Donalds-MacBook-Pro:gin dcasson$ 
```

https://github.com/mattn/go-isatty/blob/master/isatty_others.go
```go
// +build !windows
// +build !appengine

package isatty

// IsCygwinTerminal return true if the file descriptor is a cygwin or msys2
// terminal. This is also always false on this environment.
func IsCygwinTerminal(fd uintptr) bool {
	return false
}
```

Am not sure why isatty_others.go isnt being pulled down ?



 The `<link>` element is an empty element, it contains attributes only. In HTML5 the `<link>` tag has no end tag. In XHTML the `<link>` tag must be properly closed.

https://www.w3schools.com/tags/tag_link.asp
Missing the right colon

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


The following comments to vars, conts and method were added to pass  `golinter` with 100%.

![captura de pantalla 2018-10-31 a la s 15 23 37](https://user-images.githubusercontent.com/10160626/47819725-faba3780-dd20-11e8-978c-1b3ab7de26ed.png)


This adds binding support for YAML.

Sidenote: `testBodyBinding` uses `JSON.Bind` instead of the `Binding` instance passed as a parameter when testing the `badBody`. Is this intended?

In XHTML, the <input> tag must be properly closed, like this `<input />`.  In HTML5 the `<input>` tag has no ending slash.  https://www.w3schools.com/tags/tag_input.asp



FIX r.LoadHTMLGlob("/path/to/templates")) to FIX r.LoadHTMLGlob("/path/to/templates")
Read more at:
https://golang.org/pkg/net/http/#Cookie
- go version: 1.9
- gin version (or commit ref): master branch
- operating system: 

## Description
![image](https://user-images.githubusercontent.com/24504247/47624659-c1839b00-db59-11e8-9fbf-6a54da08c7f4.png)

this image is my  http post params .
I'm going to use c.GetPostFormMap to parse processes field, but I didn't get the expected results.
So I wrote a solution myself, as follows：
```
// GetPostFormArrayMap returns a map for a given form key, plus a boolean value
// whether at least one value exists for the given key.
func (c *Context) GetPostFormArrayMap(key string) ([]map[string]string, bool) {
	req := c.Request
	req.ParseForm()
	req.ParseMultipartForm(c.engine.MaxMultipartMemory)
	dicts, exist := c.getArrayMap(req.PostForm, key)
	if !exist && req.MultipartForm != nil && req.MultipartForm.File != nil {
		dicts, exist = c.getArrayMap(req.MultipartForm.Value, key)
	}
	return dicts, exist
}

// get is an internal method and returns a map which satisfy conditions.
func (c *Context) getArrayMap(m map[string][]string, key string) ([]map[string]string, bool) {
	dicts := make(map[string]map[string]string)
	exist := false
	for k, v := range m {
		if i := strings.IndexByte(k, '['); i >= 1 && k[0:i] == key { // 确定name[1]key
			num := ``
			if j := strings.IndexByte(k[i+1:], ']'); j >= 1 {
				num = k[i+1:][:j]
			}
			if j := strings.IndexByte(k[i+1:], '['); j >= 1 {
				exist = true
				field := k[i+1:][j+1 : len(k[i+1:])-1]
				if dict, ok := dicts[num]; ok {
					dict[field] = v[0]
					dicts[num] = dict
				} else {
					dicts[num] = map[string]string{field: v[0]}
				}
			}
		}
	}
	arr := make([]map[string]string, 0)
	for _, value := range dicts {
		arr = append(arr, value)
	}
	return arr, exist
}
```
this image is my parse result .
![image](https://user-images.githubusercontent.com/24504247/47624739-93eb2180-db5a-11e8-99b8-6f39422c8df2.png)



## Screenshots


- go version: 1.9
- gin version (or commit ref): master branch
- operating system: 

## Description
![image](https://user-images.githubusercontent.com/24504247/47624659-c1839b00-db59-11e8-9fbf-6a54da08c7f4.png)

this image is my  http post params .
I'm going to use c.GetPostFormMap to parse processes field, but I didn't get the expected results.
So I wrote a solution myself, as follows：
```
// GetPostFormArrayMap returns a map for a given form key, plus a boolean value
// whether at least one value exists for the given key.
func (c *Context) GetPostFormArrayMap(key string) ([]map[string]string, bool) {
	req := c.Request
	req.ParseForm()
	req.ParseMultipartForm(c.engine.MaxMultipartMemory)
	dicts, exist := c.getArrayMap(req.PostForm, key)
	if !exist && req.MultipartForm != nil && req.MultipartForm.File != nil {
		dicts, exist = c.getArrayMap(req.MultipartForm.Value, key)
	}
	return dicts, exist
}

// get is an internal method and returns a map which satisfy conditions.
func (c *Context) getArrayMap(m map[string][]string, key string) ([]map[string]string, bool) {
	dicts := make(map[string]map[string]string)
	exist := false
	for k, v := range m {
		if i := strings.IndexByte(k, '['); i >= 1 && k[0:i] == key { // 确定name[1]key
			num := ``
			if j := strings.IndexByte(k[i+1:], ']'); j >= 1 {
				num = k[i+1:][:j]
			}
			if j := strings.IndexByte(k[i+1:], '['); j >= 1 {
				exist = true
				field := k[i+1:][j+1 : len(k[i+1:])-1]
				if dict, ok := dicts[num]; ok {
					dict[field] = v[0]
					dicts[num] = dict
				} else {
					dicts[num] = map[string]string{field: v[0]}
				}
			}
		}
	}
	arr := make([]map[string]string, 0)
	for _, value := range dicts {
		arr = append(arr, value)
	}
	return arr, exist
}
```
this image is my parse result .
![image](https://user-images.githubusercontent.com/24504247/47624739-93eb2180-db5a-11e8-99b8-6f39422c8df2.png)



## Screenshots


ref #846 

for example:

```go
type Uri struct {
  A string `uri:"name" binding:"required"`
  B float32 `uri:"total" binding:"required"`
  C int `uri:"age" binding:"required"`
}

func() {
  r := gin.Default()
  r.GET("/rest/n/:name/:total/:age/*other", func(c *gin.Context) {
    var uri Uri
    if err:= c.ShouldBindUri(&uri); err != nil {
      c.JSON(400, gin.H{"msg": err})
      return
    }
    ...
  }
}
```
Now you could use `c.ShouldBindUri` instead of `c.Param`

 I have struct User

```
type User struct {
  DeletedAt *time.Time
}
```

bind data from HTML form

```
var user = new(models.User)
c.ShouldBind(user)
```

before bind data field `DeletedAt` is `nil`
and after it is `0001-01-01 00:00:00`

How can I leave value as `nil` ?
Replaces #644 as requested.
Renewed the pr https://github.com/gin-gonic/gin/pull/526.

----
I use gin http.Server under [circus](http://circus.readthedocs.org/en/latest/) which is a socket manager.
I need to run http.Server through a file descriptor, so implemented `RunFd` method.

When using other socket managers (e.g. [einhorn](https://stripe.com/blog/meet-einhorn)), maybe work well.
### Usage

``` go
package main

import (
    "flag"
    "github.com/yyoshiki41/gin"
)

var (
    fd = flag.Int("fd", -1, "")
)

func main() {
    flag.Parse()

    r := gin.Default()
    // Ping test
    r.GET("/ping", func(c *gin.Context) {
        c.String(200, "pong")
    })
    // Method arg is the file descriptor number(int).
    r.RunFd(*fd)
}
```

and, `circus.ini` example is below.

``` ini
[circus]
statsd = 1

[watcher:webapp]
cmd = ./main -fd $(circus.sockets.web)
numprocesses = 1
use_sockets = True

[socket:web]
host = 127.0.0.1
port = 8080
```
### Demo

``` shell
$ circusd circus.ini
2016-02-03 11:07:13 circus[46347] [INFO] Starting master on pid 46347
2016-02-03 11:07:13 circus[46347] [INFO] sockets started
2016-02-03 11:07:13 circus[46347] [INFO] Arbiter now waiting for commands
2016-02-03 11:07:13 circus[46347] [INFO] webapp started
2016-02-03 11:07:13 circus[46347] [INFO] circusd-stats started
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:   export GIN_MODE=release
 - using code:  gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /ping                     --> main.main.func1 (3 handlers)
[GIN-debug] Listening and serving HTTP on fd@5
2016-02-03 11:07:13 circus[46354] [INFO] Starting the stats streamer
```

``` shell
# Ping test
$ curl localhost:8080/ping
pong

# Other terminal
[GIN] 2016/02/03 - 11:08:11 | 200 |    2.571629ms | 127.0.0.1 |   GET     /ping
```

thx :sunny:

<!-- Reviewable:start -->
---
This change is [<img src="https://reviewable.io/review_button.svg" height="34" align="absmiddle" alt="Reviewable"/>](https://reviewable.io/reviews/gin-gonic/gin/1609)
<!-- Reviewable:end -->

		type day_count struct {
			a int    `json:"a"`
			y string `json:"y"`
		}

		type msg struct {
			utotal  int `json:"utotal"`
			bgtotal int `json:"bgtotal"`
			gtotal  int `json:"gtotal"`
			//data    []day_count `json:"data"`
		}

		var toady_data = msg{

			utotal:  720,
			bgtotal: 28,
			gtotal:  70,
			data:    []day_count{{a: 3, y: "2018-10-20"}, {a: 2, y: "2018-10-21"}, {a: 1, y: "2018-10-22"}, {a: 1, y: "2018-10-23"}},
		}

		strdata, err := json.Marshal(toady_data)
		if err != nil {
			log.Fatalf("joson marshal failed: %s", err)
		}
		fmt.Printf("%#v\n %s \n", toady_data, strdata)
		c.String(http.StatusOK, fmt.Sprintf("%s", strdata))



![image](https://user-images.githubusercontent.com/6701694/47480563-699c1a00-d863-11e8-8d26-8d6fbd58b304.png)

Hi

This PR addresses #421

This change increases extensibility and flexibility. This change would facilitate mocking of IRouter.

This replaces old attempt here https://github.com/gin-gonic/gin/pull/725
This PR is an update and fix to https://github.com/gin-gonic/gin/pull/625

If the `Context.Writer` has been replaced (with something that wraps it), the status code should be sent through the new writer.

## Description
When `go get` Gin, it will pull many unnecessary dependences, like `grpc`、`golang.org/x/crypto` 、`golang.org/x/sys`、`golang.org/x/lint` etc.


![1l52ckz689w lnnyuyul q](https://user-images.githubusercontent.com/15419380/47209307-9b743300-d3c2-11e8-8952-6b0567e9cdbb.png)

I want to dynamic insert and delete the ```HandlerFunc``` in a engine. But there is no function to truncate the tree in a engine to invoke.
Asked @lastzero for and got permission to feature this project at https://github.com/photoprism/photoprism

Them API server: https://github.com/photoprism/photoprism/tree/develop/internal
When `gin.Context.FormFile("...")` is called the `engine.MaxMultipartMemory` is never used. This PR makes sure that the `MaxMultipartMemory` is passed and removes 2 calls to `http.Request.ParseForm` since they are called from `http.Request.ParseMultipartForm` 


Add a new example (Set and get a cookie) to README.md.

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: go1.10.1 darwin/amd64
- gin version (or commit ref): v1.2 (revision = "d459835d2b077e44f7c9b453505ee29881d5d12d" )
- operating system: OS X  (10.13.3)

## Description
This is a question related to JSON whose model has uint8[] element.
The following is the code.
Just returning comment objects.

```
c.JSON(http.StatusOK, gin.H{
    "response": comments,
})
// c is *gin.Context
```

which has definition like this.
```
type Comment struct {
    HashKey        []uint8              `json:"hash_key" cql:"hash_key" binding:"required,len=20"` 
    IsComment       bool                 `json:"is_comment" cql:"is_comment"`                         
    CommentID       int64                `json:"comment_id" cql:"comment_id"`                 
...
}        
```


When println(comments) to screen, uint8 array was printed properly ([89 92 60 ... ] part).
`info: 2018/10/16 22:04:09 comment_handler.go:64: [{[89 92 60 206 36 9 165 92 19 7 111 27 172 94 222 229 41 252 46 88] true 50 ... 
`

However, when client got response from server, value is converted to String instead of uint8 array.
```
-> curl -X GET -H "Accept: application/json" http://localhost:8080/comment/view/1
{"response":[{"hash_key":"WVw8ziQJpVwTB28brF7e5Sn8Llg=","is_comment":true,"comment_id":50, ...}]

```
I assume the result (hash_key) should be uint8 array

How can I get uint8 array at client side?
Or is there any rule to convert between uint8 and above string value. (if convertible at client side, it could be another option).

Any advice really appreciated. Thanks!

## Screenshots
n/a

ref https://github.com/gin-gonic/gin/pull/1569#issuecomment-429731722
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: go version go1.9 windows/amd64
- gin version (or commit ref): caf3e35 ("doc: update readme for adding binding about skip validate (#1359)", 2018-05-31)
- operating system: Microsoft Windows [版本 10.0.15063]

## Description
Same as [this issue](https://github.com/labstack/echo/issues/1038#issuecomment-369889841) , I found it maybe a common problem for the  web framework in Go. And I found [this floor](https://github.com/labstack/echo/issues/1038#issuecomment-369946800) and [this floor](https://github.com/labstack/echo/issues/1038#issuecomment-410294904) is useful as I fixed it by add [the line `mime.AddExtensionType(".js", "application/javascript")`](https://github.com/zhengxiaoyao0716/zworld/blob/e6e4a9f272b3e2ecef7917da4448ef14f8a7ad61/server/server.go#L59).


## Screenshots


How to use multiple domains with one  port ?
move content from coverage.sh to Makefile and allow overriding default go program in Makefile.
as title. Just update the golint to new URL.
- go version: go1.11.1 windows/amd64
- gin version (or commit ref): v1.4.0-dev
- operating system: Windows 10 x64

I have a upload operation with more info. I use Should bind but not working. 

```go

// RegisterForm ...
type RegisterForm struct {
	FullName string                `form:"full_name" binding:"required"`
	Email    string                `form:"email" binding:"required"`
	Image    *multipart.FileHeader `form:"image" binding:"required"`
	Password string                `form:"password" binding:"required"`
}

```


and binding here.

```go
        tmpForm := RegisterForm{}
	if err := ctx.ShouldBind(&tmpForm); err == nil {
                // .... 
	} else {
		fmt.Println(err.Error())
	}

```

Output: 

> Key: 'RegisterForm.Image' Error:Field validation for 'Image' failed on the 'required' tag


Request (Postman):
![adsiz](https://user-images.githubusercontent.com/10995965/46904091-ae30c880-cee7-11e8-88f8-51444b5d272a.png)


Now, when my log is written to the file, there is no color.
When using Stream and SSEvent behind Nginx the chunked response is getting buffered by Nginx. What helps is writing header `X-Accel-Buffering: no;` to tell Nginx to not use buffering for this response.

See also https://serverfault.com/questions/801628/for-server-sent-events-sse-what-nginx-proxy-configuration-is-appropriate on this particular topic.

```go
r := gin.Default()

r.GET("/stream", func(c *gin.Context) {
	chanStream := make(chan int, 10)
	go func() {
		defer close(chanStream)
		for i := 0; i < 5; i++ {
			chanStream <- i
			time.Sleep(time.Second * 1)
		}
	}()

	// ensure nginx doesn't buffer this response but sends the chunks rightaway
	c.Writer.Header().Set("X-Accel-Buffering", "no")

	c.Stream(func(w io.Writer) bool {
		if msg, ok := <-chanStream; ok {
			c.SSEvent("message", msg)
			return true
		}
		return false
	})
})

r.Run()
```

Would it be possible to emit this header by default when using the `Stream` method?

- go version: `1.10.3`
- gin version (or commit ref): `1.3`
- operating system: `linux`
add chinese docs for gin


- go version: go1.10.1 linux/amd64
- gin version (or commit ref): 1.2.0
- operating system: linux

## Description
In readme file it states that one must use a read-only copy of gin.Context in goroutines but in this case I cannot set cookie since there is no `ResponseWriter` in read-only copy of gin.Context. 
and it panics: `panic: runtime error: invalid memory address or nil pointer dereference`

If I use original context then it throws `fatal error: concurrent map writes.`

So the question is how to accomplish this properly?
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: 1.11
- gin version (or commit ref): 1.3.0
- operating system: Ubuntu 18.04 & Ubuntu 16.04 & macOS 10.14(Mojave)

## Description
Hi, guys. I use the POST function to handle an uploading request. The router part of my code is like this
```go
Router.MaxMultipartMemory = 8 << 20 // 8 MiB
v1 := Router.Group("/api/v1")
{
	// some other routes
	v1.POST("/default/*contentPath", v1handlers.HandlePost)
}
```

The HandlePost function handles an uploading process. However, when I tried to request with the url `api/v1/default`. The following message showed up in the console: 
```
redirecting request 307: /api/v1/default --> /api/v1/default/
```
 and there was an error: 
```
get form err: multipart: NextPart: bufio: buffer full
```

After that, I tried uploading a super small file. The console said `redirecting request 307: /api/v1/default --> /api/v1/default/` and the request was just **pending there forever...**  I breakpointed the handling function and found out that the function was never called.

By the way, everything works fine if I use the full path `/api/v1/default/` or `/api/v1/default/some/other/path`.

How can I solve this problem? Is it a bug or is it because I didn't use the correct path parameters?

## Screenshots


This pr contains a replacement of deprecated language feature
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: 1.10
- gin version (or commit ref): v1.4.0-dev
- operating system: Mint 18

## Description
The following handler produces the expected JSON output byt the Content-Type is "text/plain":

```
func MyPostHandler(c *gin.Context) {
    req := MyJSONType{}
    c.BindJSON(&req)
    c.JSON(http.StatusOK, res)
}
```
change "hava" to "have"

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


I've written a simple web app using the [single file upload](https://github.com/gin-gonic/gin/tree/master/examples/upload-file/single) feature by calling [func (*Context) FormFile](https://godoc.org/github.com/gin-gonic/gin#Context.FormFile) as shown in the example.

I run the app on post 9001, and when I access `http://localhost:9001` directly, it works as expected.

But when I try putting the app behind [nginx](http://nginx.org), using a simple `proxy_pass` config like this:

```
location / {
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header Host $host;
    proxy_pass https://127.0.0.1:9001;
}
```

Suddenly, calls to `func (*Context) FormFile` result in null pointers:

```
POST /create HTTP/1.0
Host: 127.0.0.1:9001
Connection: close
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.5
Connection: close
Content-Length: 6857971
Content-Type: multipart/form-data; boundary=---------------------------2758032771652005901044345
Cookie: session=MTUzODg0NzQ4NnxEdi1CQkFFQ180SUFBUkFCRUFBQWZ2LUNBQUlHYzNSeWFXNW5EQWtBQjNObGMzTnBiMjRHYzNSeWFXNW5EQ0lBSUdabFpUSXdZVFJtTnpSak5UYzJaVE0xWm1Vek1XUmxaVEl5TVdVek5HUTBCbk4wY21sdVp3d0pBQWRoWTJOdmRXNTBCbk4wY21sdVp3d2lBQ0EzT1RnMk5XVTVORFl6TkRJMVpXSmtZakEyTlROaU5qWmxOV1ppWmpWbE13PT18X7qRG_LnPiRnGgGsdUbEhcyPkM-74XI12azjpnT4B3U=
Dnt: 1
Referer: https://127.0.0.1/create
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:62.0) Gecko/20100101 Firefox/62.0


runtime error: invalid memory address or nil pointer dereference
/usr/local/go/src/runtime/panic.go:513 (0x433c18)
        gopanic: reflectcall(nil, unsafe.Pointer(d.fn), deferArgs(d), uint32(d.siz), uint32(d.siz))
/usr/local/go/src/runtime/panic.go:82 (0x432d6d)
        panicmem: panic(memoryError)
/usr/local/go/src/runtime/signal_unix.go:390 (0x449151)
        sigpanic: panicmem()
/root/go/src/myapp/server/create.go:130 (0x9c5710)
```

Line 130 in the `create.go` file is simply doing this:

```go
file, fileErr := c.FormFile("file")
```

which is [identical to the example](https://github.com/gin-gonic/gin/blob/master/examples/upload-file/single/main.go#L20).

I'm not sure if the problem is with gin or nginx, but I also did try setting [proxy_request_buffering](http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_request_buffering) to `off`, only to get the same result.
I am looking at trying to add one or two additional fields to the standard `LoggerWithWriter()` output.

Example before:

`[GIN] 2018/09/26 - 23:30:55 | 204 |    9.908935ms |   10.10.10.1 | DELETE   /uri/path`

Example of what I'd like to add after:

`[GIN] 2018/09/26 - 23:30:55 | 204 |    9.908935ms |   10.52.161.250 | <username or payload information> | DELETE   /uri/path`

I haven't found a ton of resources in terms of folks overriding this default logger. I see quite a few instances where folks add some middleware to output extra data in addition to this standard logging, but I'd love to see if there's a way to augment the existing log line with additional data.

Thanks in advance for any assistance!
Added atomic operations.  
Fixes #1180 
This method "engine.pool.Put(c)" may put c twice in pool, this is a bug may cause a request with no response and another response with more than one response body.

First put:

```
func (engine *Engine) ServeHTTP(w http.ResponseWriter, req *http.Request) {
	c := engine.pool.Get().(*Context)
	c.writermem.reset(w)
	c.Request = req
	c.reset()
	engine.handleHTTPRequest(c)
	engine.pool.Put(c)
}

```


Second put:

```
func (engine *Engine) HandleContext(c *Context) {
	c.reset()
	engine.handleHTTPRequest(c)
	engine.pool.Put(c)
}
```

It may cause series problem, can return confusion response to use, Next request may take a using Context to response. Request Log:

```
[2018-09-29 19:51:21] method[POST] statusCode[200] remoteIP[----] requestId[8f6bafbe-b9af-43b8-956f-eed0ecfbe1e4] costTime[67.052ms] path[/front/v1/get/execQuery] ReqBody[{"RequestId":"8f6bafbe-b9af-43b8-956f-eed0ecfbe1e4","SubAccountUin":"----","Uin":"----","epoch":"ms","orgId":"-----etjgxtuw","query":"SELECT mean(\"free\") \n    FROM \"disk\"\n    WHERE time \u003e now() - 1h AND \"insId\" = 'IP_----'\n    GROUP BY time(5m)"}] RespBody[]

[2018-09-29 19:51:21] method[POST] statusCode[200] remoteIP[----] requestId[764b89a1-bc0b-4573-b625-40950baace32] costTime[49.432ms] path[/front/v1/get/execQuery] ReqBody[{"epoch":"ms","orgId":"-----etjgxtuw","query":"SELECT mean(\"used\") \n    FROM \"disk\"\n    WHERE time \u003e now() - 1h AND \"insId\" = 'IP_----'\n    GROUP BY time(5m)"}] RespBody[{"Response":{"RequestId":"764b89a1-bc0b-4573-b625-40950baace32","ResponseBody":"{\"results\":[{\"statement_id\":0,\"series\":[{\"name\":\"disk\",\"columns\":[\"time\",\"mean\"],\"values\":[[1538218200000,13094400],[1538218500000,13094400],[1538218800000,13094400],[1538219100000,13094400],[1538219400000,13094400],[1538219700000,13094400],[1538220000000,13094400],[1538220300000,13094400],[1538220600000,13094400],[1538220900000,13094400],[1538221200000,13094400],[1538221500000,13094400],[1538221800000,13094400]]}]}]}\n"}}{"Response":{"RequestId":"764b89a1-bc0b-4573-b625-40950baace32","ResponseBody":"{\"results\":[{\"statement_id\":0,\"series\":[{\"name\":\"disk\",\"columns\":[\"time\",\"mean\"],\"values\":[[1538218200000,196057271734.85715],[1538218500000,196057202688],[1538218800000,196057109435.73334],[1538219100000,196057034296.8889],[1538219400000,196056924433.06668],[1538219700000,196056770833.06668],[1538220000000,196056610816],[1538220300000,196056530807.46667],[1538220600000,196056445424.48486],[1538220900000,196056361398.85715],[1538221200000,196056234448.21335],[1538221500000,196056150971.73334],[1538221800000,196056091891.8095]]}]}]}\n"}}{"Response":{"RequestId":"764b89a1-bc0b-4573-b625-40950baace32","ResponseBody":"{\"results\":[{\"statement_id\":0,\"series\":[{\"name\":\"disk\",\"columns\":[\"time\",\"mean\"],\"values\":[[1538218200000,4435639539.809524],[1538218500000,4435708586.666667],[1538218800000,4435801838.933333],[1538219100000,4435876977.777778],[1538219400000,4435986841.6],[1538219700000,4436140441.6],[1538220000000,4436300458.666667],[1538220300000,4436380467.2],[1538220600000,4436465850.181818],[1538220900000,4436549875.809524],[1538221200000,4436676826.453333],[1538221500000,4436760302.933333],[1538221800000,4436819382.857142]]}]}]}\n"}}]
```

There is two ResponseBody in second resp but empty ResponseBody  in first query. like second req stole from first req.
Is it possible send data/payload with `redirect` request? 
For example after create user I do `redirect`, but I need send message ("User created successfully") to notify user about result.
```
c.Redirect(301, "/")
```
# xxx/vendor/github.com/gin-gonic/gin/binding
vendor/github.com/gin-gonic/gin/binding/default_validator.go:48:14: undefined: validator.Config
vendor/github.com/gin-gonic/gin/binding/default_validator.go:49:29: too many arguments in call to validator.New


Can I use gin with Prisma?

https://github.com/prisma/prisma


travis ci about environment: https://docs.travis-ci.com/user/environment-variables/
Because go1.11 need to set env `GO111MODULE=on` when use `go mod`, so update `.travis.yml` and use matrix.


as title
ref: #1381 
fix #1560 changes are breaking in App Engine.

cc @giulianobr @philippgille
1. Why is this change neccesary?
White text on a yellow background was illegible with most terminal color schemes

2. How does it address the issue?
The white text was replaced with a bash compatible dark gray while keeping the
yellow background colour

3. What side effects does this change have?
Resolves #1552

Before:
![captura de pantalla 2018-09-25 a la s 17 09 01](https://user-images.githubusercontent.com/10160626/46046509-f7f77180-c0e6-11e8-9651-deffb9eacbbc.png)

After:
![captura de pantalla 2018-09-25 a la s 17 08 42](https://user-images.githubusercontent.com/10160626/46046481-da2a0c80-c0e6-11e8-8c38-10a20d90188b.png)
Ensure old version run right and then attempt to support go module.
please @javierprovecho @appleboy help review, thanks!
ref: https://blog.travis-ci.com/2013-11-27-fast-finishing-builds

## Description

When declaring `gin` as a dependency using the latest `master` commit, unnecessary dependencies are declared in your `go.mod/go.sum` due to the `examples/` directory containing executable `go` programs.

Those programs should be removed or moved to another Github repository.

## Steps to reproduce

1. make a sample hello-world application using `go modules` and `gin`.
1. declare `gin@master` as a dependency using `go get github.com/gin-gonic/gin@master`
1. observe that unnecessary dependencies such as `google.golang.org/grpc v1.15.0`, `google.golang.org/appengine` etc are added to your own `go.sum`




As per #1230 there is an issue when using HandleContext where the context of the request is returned to the context sync.Pool before the parent request has finished, causing context to be used in a non-thread safe manner.

I've removed the bug by not entering the context back in the pool and leaving that to ServeHTTP.

There was no test coverage for this function so I've also added the test to cover it. As the bug only happens when there are concurrent requests, the tests issues hundreds of concurrent requests. Without the bug fixed the tests do consistently recreate the error.
- go version: 1.10
- gin version (or commit ref): b869fe1415e4b9eb52f247441830d502aece2d4d
- operating system: Fedora

## Description

As of `v1.3.0`, the recovery middleware is dumping the request header which can leak sensitive information such a login credentials & API key. In turn, these informations can end up in logs or even in the public space, such as:

https://community.getchannels.com/t/recovery-panic-recovered/1091

I'm not sure of the right way to fix this, but a set of nice-to-have knobs would be:
 - obfuscate a set of headers by default
 - allow configuration of this set of headers
 - let API builder turn this off explicitly.

## Screenshots
```
2018/09/20 19:32:07 [Recovery] 2018/09/20 - 19:32:07 panic recovered:
GET /v1/path/7e97cae5-e779-4d1c-6150-971e0a8b6f31 HTTP/1.1        
Accept-Encoding: gzip                                                
Authorization: bearer DUMMY                                          
Connection: close                                                    
Content-Type: application/json                                       
User-Agent: Go-http-client/1.1
```

In my project, API version control like [github API rule](https://developer.github.com/v3/media/#request-specific-version):
```bash
curl https://api.github.com/users/technoweenie -I \
 -H "Accept: application/vnd.github.v3.full+json"
```


So i change `Engine` struct, added `BeforeHandle` function, support like this complex route match.
And i think this function will more usage scenarios.


> Basic usage demo:


```golang
func v1Foo(c *gin.Context) {
	c.String(http.StatusOK, "v1")
}
func v2Foo(c *gin.Context) {
	c.String(http.StatusOK, "v2")
}

func githubVersion(r *gin.Engine) {
	r.BeforeHandle = func(c *gin.Context, httpMethod, path, rawPath *string) {
		accept := c.Request.Header.Get("Accept")
		reg := regexp.MustCompile(`application\/vnd\.github\.v(\d*?)\+json`)
		res := reg.FindStringSubmatch(accept)

		if 2 == len(res) {
			*path = "/v" + res[1] + (*path)
		}
	}
}
func main() {
	r := gin.Default()
	githubVersion(r)

	r.Handle(http.MethodGet, "/v1/foo", v1Foo)
	r.Handle(http.MethodGet, "/v2/foo", v2Foo)
	r.Run()
} 
```

> run
```bash
curl -X GET \
  http://localhost:8080/foo \
  -H 'Accept: application/vnd.github.v2+json' \
```


as title. docs: https://docs.travis-ci.com/user/customizing-the-build/#rows-that-are-allowed-to-fail

fix https://github.com/gin-gonic/gin/issues/829

remove `log.SetFlags(0)`
Digging into the test code base I've found out that some of the tests for `LoadHTML*` methods are not reliable and efficient. They use timeouts to be sure that goroutine with the server has started. And even more, in old implementation, the server started only once – all the new instances silently failed due to the occupied network port.

Here is a short overview of the proposed changes: 
- it's not necessary to rely on timeouts, the server starts listening synchronously and returns control when it is ready
- once the server is run, it's stopped after a test passes
- dry out http server setup
- magic with empty closure return is eliminated 
- preserve router.RunTLS coverage with integration tests

I was wondering if there is any issues reported regarding GIN shutting down with no reason. Runs for 3 days to a week with no service hits. then app shutdowns. I got a start up script that runs if the app is down and restarts it

- go version: go version go1.10.1
- gin version (or commit ref): Gin 1.2
- operating system: Linux

Below shows the log being restarted. Since i only have logging set to WARN and above (production site), i don't have debug logs. If the server is shutting down i should be receiving a PANIC or ERROR log.

```
admin@linuxmachine:/dir $ cat service.log
time="2018-09-10T18:41:42-05:00" level=info Log Compress=true Log Level=warn Log Location=/u/log/ Log Max Backups=15 Log Max size=5 Log enabled=true logFileName=service.log
time="2018-09-16T03:08:42-05:00" level=info Log Compress=true Log Level=warn Log Location=/u/log/  Log Max Backups=15 Log Max size=5 Log enabled=true logFileName=service.log
time="2018-09-16T03:15:42-05:00" level=info Log Compress=true Log Level=warn Log Location=/u/log/  Log Max Backups=15 Log Max size=5 Log enabled=true logFileName=service.log
admin@linuxmachine:/dir $
```


i am a new gopher, and i using gin to start a server toutual. now i meet a question. the server in my local env is woring well. but when i deploy it on my server, only http get method works well. post method not work.
![image](https://user-images.githubusercontent.com/13310359/45624046-bac62a80-babb-11e8-9fdc-705da85b5c6e.png)
![image](https://user-images.githubusercontent.com/13310359/45624057-c154a200-babb-11e8-8a1f-b89c1d6bff54.png)
i dont know where is wrong. can u help me ?


Close #1553


but still no change ci script.

cmd:
`export GO111MODULE=on`: open vgo on go 1.11
`go mod init`: initial project to generate go.mod file
`go mod tidy`: generate go.sum file
Hello,

It will be great to let to user how he want to log information (json, key value, plain text) from gin gonic (e.g `debugPrintRoute`,  access log, panic).

My goal is to see something like this:
```json
{"method": "POST", "path": "/foo/", "handler": "foo.func1", "handlers": 1}
{"method": "GET", "path": "/bar/", "handler": "bar.func1", "handlers": 1}
{"method": "GET", "path": "/status", "handler": "status.func1", "handlers": 1}
```

instead of:
```
[GIN-debug] POST   /foo/                    --> foo.func1 (1 handlers)
[GIN-debug] GET    /bar/                    --> bar.func1 (1 handlers)
[GIN-debug] GET    /status                  --> status.func1 (1 handlers)
```
- go version: go1.11 darwin/amd64
- gin version (or commit ref): v1.3.0
- operating system: macOS High Sierra

## Description
White text on a yellow background is completely illegible... I can think of three different ways to solve this; make the text color darker, keep the text white and make the background darker, or add support for configuring the text and/or background color.

## Screenshots
![screen shot 2018-09-15 at 13 53 03](https://user-images.githubusercontent.com/27306/45590565-94ec2a80-b8ef-11e8-8fee-a28bf2542e8a.png)

Hello,
Are you plan to support Go Modules with go.mod file?

Thx in adv


ref #1075 should all annotations and can close #1075 .
version file includes the current version which will publish.
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:
- gin version (or commit ref):
- operating system:

## Description
```
func main() {
	r := gin.Default()
	r.POST("/login", Login)

	r.Run(":8090")
}

type LoginParam struct {
	User string `form:"user" binding:"required"`
	Age  string `form:"age" binding:"required"`
}

func Login(c *gin.Context) {
	fmt.Println(c.PostForm("user"))
	fmt.Println(c.PostForm("age"))
	var l LoginParam
	err := c.ShouldBind(&l)
	if err != nil {
		panic(err)
	}
}
```
I post the form via curl:
```
curl -v --form user='qishuai' --form age=0 http://127.0.0.1:8090/login
// error:
// Key: 'LoginParam.Age' Error:Field validation for 'Age' failed on the 'required' tag
```
But I want the `age` field is required, and 0 is a valid input. How will I deal with?

## Screenshots


- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: go 1.11
- gin version (or commit ref): master
- operating system: mac

## Description
Here can see go 1.8 1.9 1.10 1.11 print log: https://travis-ci.org/gin-gonic/gin/builds/428455260?utm_source=github_status&utm_medium=notification

when go version is 1.9 it will print log:

![image](https://user-images.githubusercontent.com/4488261/45535407-f4cfcc00-b830-11e8-96a3-b5d516f3e8c2.png)

else print log:

![image](https://user-images.githubusercontent.com/4488261/45535437-0f09aa00-b831-11e8-9d7c-0acd99d7fd41.png)


## Screenshots


```go
func WriteJSON(w http.ResponseWriter, obj interface{}) error {
	writeContentType(w, jsonContentType)
	jsonBytes, err := json.Marshal(obj)
	if err != nil {
		return err
	}
	w.Write(jsonBytes)
	return nil
}

func WriteJSON(w http.ResponseWriter, obj interface{}) error {
	writeContentType(w, jsonContentType)
	encoder := json.NewEncoder(w)
	err := encoder.Encode(&obj)
	if err != nil {
		return err
	}
	return nil
}
```
I want to let request url is compatible with different url style, such as api/v1/test_url and api/v1/testUrl will be direct to the same handler, but i don't want to use Redirect method，is there any other method that can help me?
Now, i use this method ：

```go
func(c *gin.Context) {
		service.RequestInfoLog(c)
		req := c.Request
		path := req.URL.Path
		if fixedPath, ok := fixRequestUrl(path); ok {
			req.URL.Path = fixedPath
			code := 301
			if req.Method != "GET" {
				code = 307
			}
			http.Redirect(c.Writer, req, req.URL.String(), code)
		} else {
			c.Next()
		}
	}
```

but i found that when i use protobuf to transmit data and if the request is redirected, i couldn't decode the protobuf data, is there any mistake in my method?




ref: #1075 
because I am not a native English, maybe have a bit problem.
At the moment when I need to add Cache or Content headers to the `Static` or `StaticFS` routes I need to do something like this:

```
func main() {
	...

	router.Use(headersByRequestURI())
	router.StaticFS("/img", ...)
	router.StaticFS("/static", ...)

	...
}

func headersByRequestURI() gin.HandlerFunc {
	return func(c *gin.Context) {
		if strings.HasPrefix(c.Request.RequestURI, "/static/") {
			c.Header("Cache-Control", "max-age=86400")
			c.Header("Content-Description", "File Transfer")
			c.Header("Content-Type", "application/octet-stream")
			c.Header("Content-Transfer-Encoding", "binary")
		} else if strings.HasPrefix(c.Request.RequestURI, "/img/") {
			c.Header("Cache-Control", "max-age=86400")
		}
	}
}

```

It would be great if there was a better way than this, like a providable `HandlerFunc` for those functions. 
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:
- gin version (or commit ref):1323
- operating system:

## Description

## Screenshots


Found using https://go-critic.github.io/overview#unslice-ref

Found using https://go-critic.github.io/overview#commentedOutCode-ref

add new capability to limit accepted connections

Go v1.11
Gin v1.3.0
Mac OS

can't go get gopkg.in/go-playground/validator.v8 
gopkg.in is error

![image](https://user-images.githubusercontent.com/1219360/45351106-ee9adf00-b5e7-11e8-891e-be927e63bd49.png)

Can you provide direct access url?
Go v1.11
Gin v1.3.0
Mac OS

I assume this is a setting issue, but I don't know what's going on. When I get a nil pointer exception in my server, it stops handling ALL requests. There are no logs and the request hangs. Future requests that would not cause a nil pointer also don't complete/hit breakpoints. I have a simple model that I deserialize the request into:

```
type HelloListWrapper struct {
	Requests []*HelloRequest `json:"data"`
	Errors []validations.ValidationErrors
}
```

I then loop over the nested requests and call things on them. If a client passes null in the json array, obviously I end up with a nil pointer, but I can't figure out what's happening after that. The program is still running, but there are no logs and no other requests make it through, but also appear to still be received (postman doesn't immediately say Could not get any response, and instead is waiting). I've had this happen with other nil pointers while I've been developing as well.


Hi, in most cases, an application needs to release some resources before it shutdown, for instance: close the datasource connection, or release some network connection.

so i think if it would be helpful if the gin framework can provide a "RegisterShutdownHook" function for developers to register their own business logic before application shutdown.

here is an example, i implement in my application:

_**register shutdown functions in database module**_

![image](https://user-images.githubusercontent.com/482266/45285491-db1f4380-b515-11e8-97a8-e1af168499a2.png)

_** call shutdown hooks before application shutdown **_

![image](https://user-images.githubusercontent.com/482266/45285568-0bff7880-b516-11e8-8e67-31672c74cdd4.png)



The existing content-type negotiation doesn't handle wildcard types like */*, text/*, etc. This PR adds that support.
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: go1.11
- gin version (or commit ref): v1.3.0
- operating system: mac

## Description

gin have example about auto-tls, please see: https://github.com/gin-gonic/gin/tree/master/examples/auto-tls

step1: start server, `sudo go run example1.go`

step2: curl it, `curl -v 'https://www.example2.com/ping'`

it will output:

```shell
➜  ~ curl -v 'https://www.example2.com/ping'
*   Trying 104.200.22.130...
* TCP_NODELAY set
* Connected to www.example2.com (104.200.22.130) port 443 (#0)
* ALPN, offering h2
* ALPN, offering http/1.1
* Cipher selection: ALL:!EXPORT:!EXPORT40:!EXPORT56:!aNULL:!LOW:!RC4:@STRENGTH
* successfully set certificate verify locations:
*   CAfile: /etc/ssl/cert.pem
  CApath: none
* TLSv1.2 (OUT), TLS handshake, Client hello (1):
* TLSv1.2 (IN), TLS handshake, Server hello (2):
* TLSv1.2 (IN), TLS handshake, Certificate (11):
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
* TLSv1.2 (IN), TLS handshake, Server finished (14):
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
* TLSv1.2 (OUT), TLS change cipher, Client hello (1):
* TLSv1.2 (OUT), TLS handshake, Finished (20):
* TLSv1.2 (IN), TLS change cipher, Client hello (1):
* TLSv1.2 (IN), TLS handshake, Finished (20):
* SSL connection using TLSv1.2 / ECDHE-RSA-AES256-GCM-SHA384
* ALPN, server did not agree to a protocol
* Server certificate:
*  subject: CN=example2.com
*  start date: Aug 19 13:18:00 2018 GMT
*  expire date: Nov 17 13:18:00 2018 GMT
*  subjectAltName: host "www.example2.com" matched cert's "www.example2.com"
*  issuer: C=US; O=Let's Encrypt; CN=Let's Encrypt Authority X3
*  SSL certificate verify ok.
> GET /ping HTTP/1.1
> Host: www.example2.com
> User-Agent: curl/7.54.0
> Accept: */*
>
< HTTP/1.1 302 Moved Temporarily
< Server: openresty/1.13.6.1
< Date: Thu, 06 Sep 2018 01:52:56 GMT
< Content-Type: text/html
< Content-Length: 167
< Connection: close
< Location: http://www.example2.com/ping
< Set-Cookie: mtmssl=1;Domain=www.example2.com;Path=/;Max-Age=120
<
<html>
<head><title>302 Found</title></head>
<body bgcolor="white">
<center><h1>302 Found</h1></center>
<hr><center>openresty/1.13.6.1</center>
</body>
</html>
* Closing connection 0
* TLSv1.2 (OUT), TLS alert, Client hello (1):
```

why? thanks!

## Screenshots





- remove console image on the top of readme, I think it's not important, but need review.
- add fold button which reduce readme document length, it will fold some less important content.

like this:

![image](https://user-images.githubusercontent.com/4488261/45086254-50190480-b135-11e8-938a-a6a219e5490c.png)

Hello there
First of all thanks for that awesome work!
I think the title speaks itself but for more I've got a user struct like so : 
```golang
type User struct {
	Id        int       `json: "id"`
	Username  string    `json:"username" binding:"required,min=5,max=32"`
	Email     string    `json:"email" binding:"required,email"`
	Password  string    `json:"password" binding:"min=8,max=64"`
	Bio       string    `json:"bio"`
	CreatedAt time.Time `json:"created_at" sql:"type:timestamptz"`
	UpdatedAt time.Time `json:"updated_at" sql:"type:timestamptz"`
}
```
Sometime I would like to update a user without touching password field but I will get ```Password field must be 8 characters at least.```  when parsing bind method!
Is there a way to ignore it?
Thanks!
It's necessary that  catching  ctx.Done()
        
	if err := srv.Shutdown(ctx); err != nil {
		log.Fatal("Server Shutdown:", err)
	}

	// catching ctx.Done(). timeout of 5 seconds.
	select {
	case <-ctx.Done():
	}

	log.Println("Server exiting")


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


sync httprouter patch: https://github.com/julienschmidt/httprouter/pull/182

updated before:

`panic: path segment '/foo' conflicts with existing wildcard '/*you' in path '/who/are/foo'`

updated after:

`panic: '/foo' in new path '/who/are/foo' conflicts with existing wildcard '/*you' in existing prefix '/who/are/*you'`
I'm using NoRoute to catch all requests to the router and parse them by myself.
When getting encoded URL's containing slashes (%2F) gin automatically decodes it. 
I have tried playing with UseRawPath, UnescapePathValues and c.Request.URL.EscapedPath() with no luck.

When a request arrives, I'm using strings.split() to get the different path segments, so getting a "/" instead of "%2F" is problematic. Is it possible to tell gin not to decode the URL when not using params like /:param1/:param2? 

Using specific routes is not possible in my case.
- go version:1.11
- gin version (or commit ref):1.3
- operating system: ubuntu 18.04

## Description
validator.v9 supports validating unicode alphanumerical values etc. 
Could be useful for locale supports, wish to update soon.

https://godoc.org/gopkg.in/go-playground/validator.v9#hdr-Alpha_Unicode






- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:
- gin version (or commit ref):
- operating system:

## Description

## Screenshots





I have form-data like send by using postman. But I don't know how to create struct to bind that data
![screenshot from 2018-08-31 16-38-01](https://user-images.githubusercontent.com/39752625/44905481-5cb7ea00-ad3c-11e8-8cd2-6dd63b4bc722.png)

Anyone can have me please!
Background:
  - Now we have `README.md` document which includes most useful document, but some common question are frequently asked. So we should archive the frequently question and add some architecture document.

Hope everyone can take part in the work, thanks!

example:
  - how to build one effective middleware? #1521 
  - about template
  - and so on.



#1491 adds some lib when upgrade json-iterator but it is not needed, and use `v1.1.5` not `1.1.5` version for json-iterator.
Hi!
May be wrong place to ask, sorry.
I need to handle dynamically named files from the root of my site for testing purpose.
I.e.:
/test_12335664.txt
/test_98765544.txt
Files have dynamic part in name.
How I can do this?
Route "\*" fails with error:
panic: wildcards must be named with a non-empty name in path '/*'
Same error for "\test*":
panic: wildcards must be named with a non-empty name in path '/test*'

I am writing a micro-service & have a simple APIs built using gin. In case of error, response-headers do not have a header `Content-Type` as `application/json` instead it comes as `text/plain`. This does not happen in case of success but only in case of error. 

I am sending an error using `AbortWithStatusJSON`. After which I am printing `Content-Type` header & the value comes out to be `application/json; charset=utf-8`.
```go
c.AbortWithStatusJSON(http.StatusBadRequest, customErrorObj)
fmt.Println(c.Writer.Header().Get("Content-Type")) //prints application/json; charset=utf-8
```
But on client I get the header value as `text/plain`.

The entire flow in an concise way is as follows -
**route --> validator --> controller --> error-handler**

main.go
```go
func main() {
  router := gin.New()
  router.Use(middlewares.HandleErrors)
  router.GET("/labels", middlewares.ValidateQueryParams, controllers.GetLabels)
  // .. other routes
  router.Run(":" + constants.Env.Port)
}
```
middlewares.HandleErrors
```go
func HandleErrors(c *gin.Context) {
  c.Next() // execute all the handlers

  // at this point, all the handlers finished. Let's read the errors!
  if len(c.Errors) == 0 {
    return
  }

  err := c.Errors.Last()
  // .. create customErrorObj using err
  
  c.AbortWithStatusJSON(http.StatusBadRequest, customErrorObj)
  fmt.Println(c.Writer.Header().Get("Content-Type"))
}
```
middlewares.ValidateQueryParams
```go
type labelQuery struct {
  Name     string `form:"name" json:"name,omitempty"`
  Category string `form:"category" json:"category,omitempty"`
}

func ValidateQueryParams(c *gin.Context) {
  var labelQueryParams labelQuery
  if err := c.Bind(&labelQueryParams); err != nil {
    c.AbortWithError(http.StatusBadRequest, err)
    return
  }
  c.Set("labelQueryParams", labelQueryParams)
}
```
controllers.GetLabels 
```go
func GetLabels(c *gin.Context) {
  
  v, ok := c.Get("labelQueryParams")
  if !ok {
    c.AbortWithError(http.StatusBadRequest, errors.New('invalid query params'))
    return
  }

  labelQueryParams, ok := v.(labelQuery)
  if !ok {
    c.AbortWithError(http.StatusBadRequest, errors.New('error in converting query params'))
    return
  }

  labels, err := labelService.GetLabels(labelQueryParams.Name, labelQueryParams.Category)
  if err != nil {
    c.AbortWithError(http.StatusBadRequest, err)
    return
  }

  c.JSON(http.StatusOK, gin.H{"records": labels})
}
```

- gin version (or commit ref): v1.2

What all things I have tried?
- Replacing all `c.Bind` with `c.ShouldBind`
- Replacing `c.AbortWithStatusJSON` with `c.JSON`

Any help would be appreciated.
Hello,

I am looking for a way to update the list of allowed origins after everything is started

```
router := gin.Default()
CORSConfig := cors.DefaultConfig()
CORSConfig.AllowOrigins = []string{"example.com"} // INITIAL DEFINITION
router.Use(cors.New(CORSConfig))
// .. add /api/routes here ..
router.Run()
```

How could I add allowed origins with a call to my API? Is that possible?

Thanks!
- gin version (or commit ref): 1.3.0
- operating system: Linux

## Description
How does the function **BindQuery** bind the array?
type DeleteQueryParam struct {
	UserName int   `form:"name" binding:"required"`
	ttl  string `form:"ttl" binding:"required"`
	Id []int `form:"id" binding:"required"`
}
param `id`  can't bind the array correctly
![image](https://user-images.githubusercontent.com/19261307/44652621-f3c03180-aa1e-11e8-8393-d14fc8b402f4.png)




## Question
May I setup a middleware for certain api?  
- description
For example, I hve 2 apis in the same group, one requires login first, one not.
So can I use middleware for only one api in that group?

- gin version (or commit ref):
1.3.0
as title.
- gin version: 1.3.0
- operating system: arch linux

## Description
For some reason it's impossible to use binding:"required" for query params
```
type LimitOffset struct {
	Offset int `form:"offset" binding:"required"`
	Limit  int `form:"limit" binding:"required"`
}

func CategoryBooks(conn *mgo.Collection, c *gin.Context) {
	var query_params LimitOffset
	if err := c.BindQuery(&query_params); err != nil {
		badRequestResponse(c, err)
		return
	}
        ...
}

```
response:
`{"description":"Key: 'LimitOffset.Offset' Error:Field validation for 'Offset' failed on the 'required' tag","status":"error"}`

url with query params:

> http://localhost:8000/categories/Python?offset=0&limit=2

- gin version (or commit ref): 1.3
- git version:
- operating system: ubuntu 18.04

## Description

https://stackoverflow.com/questions/52008320/go-gin-variable-in-handler-is-not-passing-to-template

@thinkerou @appleboy 
Gin master, the commit is [0da5b0c85ac2539e775a7e63aebf3e0b5808dab4](https://github.com/gin-gonic/gin/tree/0da5b0c85ac2539e775a7e63aebf3e0b5808dab4)

## Description
refercens
#1510  test(not review): add go1.11 
#1383 Support map as query string or post form parameters  
#1362 How can I get map[string]string filed on PostForm?
#1106 Map as query parameter

Build failed in go master but ok in other go version.
![image](https://user-images.githubusercontent.com/7046329/44564093-d88dc180-a793-11e8-9408-17e03e745bd5.png)

## Reason 
This  because this [commit](https://github.com/golang/go/commit/1040626c0ce4a1bc2b312aa0866ffeb2ff53c1ab#diff-6c2d018290e298803c0c9419d8739885R1124) in go master, add this [func validQuery](https://github.com/golang/go/commit/1040626c0ce4a1bc2b312aa0866ffeb2ff53c1ab#diff-6c2d018290e298803c0c9419d8739885R1124)
 ```
// validQuery reports whether s is a valid query string per RFC 3986
// Section 3.4:
//     query       = *( pchar / "/" / "?" )
//     pchar       = unreserved / pct-encoded / sub-delims / ":" / "@"
//     unreserved  = ALPHA / DIGIT / "-" / "." / "_" / "~"
//     sub-delims  = "!" / "$" / "&" / "'" / "(" / ")"
//                   / "*" / "+" / "," / ";" / "="
func validQuery(s string) bool {
	pctEnc := 0
 	for _, r := range s {
		if pctEnc > 0 {
			if uint32(r) > 255 || !ishex(byte(r)) {
				return false
			}
			pctEnc--
			continue
		} else if r == '%' {
			pctEnc = 2
			continue
		}
 		if 'A' <= r && r <= 'Z' {
			continue
		}
		if 'a' <= r && r <= 'z' {
			continue
		}
		if '0' <= r && r <= '9' {
			continue
		}
		switch r {
		case '-', '.', '_', '~', '!', '$', '&', '\'', '(', ')',
			'*', '+', ',', ';', '=', ':', '@', '/', '?':
			continue
		default:
			return false
		}
	}
 	return true
}
```  
Then I copy these into local workspace,  test like below 
```
func main() {
    fmt.Printf("%t\n", validQuery("both=GET&id=main&id=omit&array[]=first&array[]=second&ids[a]=hi&ids[b]=3.14"))
    fmt.Printf("%t\n", validQuery("foo=bar&page=10&id=2"))
}

// build and run, get 
false
true
``` 

## Summarize
In go master, if url include '[' or ']', will be [QueryEscape](https://github.com/golang/go/commit/1040626c0ce4a1bc2b312aa0866ffeb2ff53c1ab#diff-6c2d018290e298803c0c9419d8739885R523) according to `RFC 3986`. So don't parse url.query   


@javierprovecho @appleboy please review the pull request which add `resetQuery` instead of `c.Request.URL.Query` and `resetForm` instead of `req.Form`. Related to go master pull request https://github.com/golang/go/commit/1040626c0ce4a1bc2b312aa0866ffeb2ff53c1ab#diff-9667474d33400190658e4758cf28dbf5

TODO: And I think we should add `internal` package which reduce duplicated code and avoid circular dependencies. also see #1504 

go master branch error, maybe because `url.Values` change, go 1.10.x OK, print `c.Request.URL.Query()` and `c.Request.Form` log:

```go
url.Values{"ids[a]":[]string{"hi"}, "ids[b]":[]string{"3.14"}, "both":[]string{"GET"}, "id":[]string{"main", "omit"}, "array[]":[]string{"first", "second"}}
```

go master error, print `c.Request.URL.Query()` and `c.Request.Form` log:

```go
url.Values{"both=GET&id=main&id=omit&array[]=first&array[]=second&ids[a]=hi&ids[b]=3.14":[]string{""}}
```
change  `ShouldBindXML` to `ShouldBindJSON`
I moved `HandlerFunc` to a separate file, but I need to define the specific template for this action, so I have

main.go

```
func main() {
    router := gin.Default()
    router.Static("/assets", "./assets")
    router.LoadHTMLGlob("templates/*/**")
    routes.Attach(router)

    router.Run(":9000")
}
```

router.go

```
func Attach(router *gin.Engine) {
    router.GET("/", controllers.Root)
}
```
controllers.go

```
func Root(c *gin.Context) {
    // how can I define specific template here???
    // router.SetHTMLTemplate(template.Must(template.ParseFiles("templates/layouts/main.tmpl", "templates/root/root.tmpl")))
    c.HTML(200, "base", gin.H{
        "title": "Root page",
    })
}
```

so is it possible to specify template in the separate function? 



## Description

I am going to package the static file into an executable file. How to use go-bindata in Gin? There are missing examples on the Internet.
Gin version: 1.3.0
Operating system: ubuntu 16.04

I updated the package today by using go get command. Before updating package, the Context.Request.Host was giving value of the form "`example.com:8080`" but after update, it is giving only "`example.com`". So how can I get the previous form using latest package ?

```go
func SetDatabase(c *gin.Context){
	var businessName string
	stringExists := strings.Contains(c.Request.Host, config.BaseUrl)
	if stringExists == false{
		reqDomain := strings.Split(c.Request.Host, ":")
		businessName, _ = models.GetBusinessNameByCustDomain(reqDomain[0])
	}else{
		subdomain := strings.Split(c.Request.Host, ".")
		if len(subdomain) > 0{
			businessName = subdomain[0]
		}
	}
	
	if businessName != "" {
		merchantDatabase := make(map[string]interface{})
		merchantDatabase["merchant_db"] = businessName+"_bk_db"
		merchantDatabase["business_name"] = businessName
		c.Keys = merchantDatabase
	}else{
		controllers.GetErrResponse(c, "Invalid domain in headers.", nil)
		c.Abort()
	}
	c.Next()
}
```

Thanks!
Asked for and got permission to feature this project at https://fnproject.slack.com

They make heavy use of Gin for their API server https://github.com/fnproject/fn/blob/master/api/server/gin_middlewares.go
@appleboy @javierprovecho please review the pull request, otherwise need add one `internal` package. thanks!

json package should internal package which should not external use. ref: #1339 

about `internal` please see https://docs.google.com/document/d/1e8kOo3r51b2BWtTs_1uADIA5djfXhPT36s6eHVRIvaU/edit

```go
An import of a path containing the element “internal” is disallowed if the importing code is outside the tree rooted at the parent of the “internal” directory.
```

so only `github.com/gin-gonic/gin/*` can call on `internal` package.
format readme import code


As[ Effective Go](https://golang.org/doc/effective_go.html?#if) about `if` said, remove else statement instead of return/continue statement.


ref: #1443 
add newencoder to fix compile error for -tags=jsoniter

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


I used beego before, now I use gin, is there a tool for gin similar to bee?
please see msgpack usage: https://github.com/ugorji/go/tree/master/codec#usage



ref #1479 
please @salamer @appleboy help review, thanks!



When I try to execute
`go build -v .
`

I got


github.com/gin-gonic/gin
#github.com/gin-gonic/gin
../../../../mygo/src/github.com/gin-gonic/gin/context.go:575:22: undefined: binding.BindingBody
../../../../mygo/src/github.com/gin-gonic/gin/context.go:759:18: undefined: render.JsonpJSON
../../../../mygo/src/github.com/gin-gonic/gin/context.go:772:17: undefined: render.AsciiJSON
../../../../mygo/src/github.com/gin-gonic/gin/context.go:810:17: undefined: render.Reader

I'm not sure what happened here, it seems like several contexts are missing...
How should I fix this?


A little change in readme, nothing about code.


fix users link
Tiny typo fix in README. Thanks.
upgrade lib version, and upgrade `github.com/json-iterator/go` to add two libs.



How can I get gin*context on Custom Validators
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- gin version (or commit ref): b869fe1415e4b9eb52f247441830d502aece2d4d
- git version: 2.7.4
- operating system: Ubuntu 16.04

## Description
`go get gopkg.in/gin-gonic/gin.v1` is failing.

## Screenshots


To make things working in line with `encoding/json` decoder, I'd suggest to set default time format as `time.RFC3339`.

```
type input struct {
	Field time.Time `form:"field" json:"time"`
}
```

This will make values bound in the same way as if you are using structures as above and different bindings depending on the request type.
This will cover the following scenarios:

```
type input struct {
	Field *time.Time `form:"field" time_format:"2006-01-02" time_utc:"1"`
}
```
Add BindXML AND ShouldBindXML #1484
json reader is  gin.Context.BindJSON


xml is reader ?
ref: https://blog.github.com/2016-02-17-issue-and-pull-request-templates/

Hi, @javierprovecho @appleboy and everyone I commit two files about issue template and pull request template explain, I not setup them template but explain, ant the explain from `CONTRIBUTING.md`. Thanks!

Hi @javierprovecho I add pr address link for every reference pr, I commit the pr to gin-gonic:chore/v1.3.0
"not match neither" means that it will match.
`Gin` now have the `protobufBinding` function to check the request format, but didn't have a protobuf response function like `c.YAML()`.
In our company [ByteDance](http://bytedance.com/), the largest internet company using golang in China, we use `gin` to transfer __Protobuf__  instead of __Json__, we have to write some internal library to make some wrappers to achieve that, and the code is not elegant. So we really want such a feature.

`Gin` now have the `protobufBinding` function to check the request format, but didn't have a protobuf response function like `c.YAML()`.
In our company [ByteDance](http://bytedance.com/), the largest internet company using golang in China, we use `gin` to transfer __Protobuf__  instead of __Json__, we have to write some internal library to make some wrappers to achieve that, and the code is not elegant. So we really want such a feature.

The last [pull request](https://github.com/gin-gonic/gin/pull/1475) was blocked because I forgot to write the unit test. This time I have added the unit test, using the protobuf in the [grpc example](https://github.com/gin-gonic/gin/blob/master/examples/grpc/pb/helloworld.pb.go).
make package lock to a certain version could be safe in case of compatability for people using this package.
but would not know a update.
currently, this newest version tag is v1.2.0. which seems outdated compared to master
`Gin` now have the `protobufBinding` function to check the request format, but didn't have a protobuf response function like `c.YAML()`.
In our company [ByteDance](http://bytedance.com/), the largest internet company using golang in China, we use `gin` to transfer __Protobuf__  instead of __Json__, we have to write some internal library to make some wrappers to achieve that, and the code is not elegant. So we really want such a feature.
all code coverage > 99%

Hi guys,
I was creating my API test when I found this problem.
Assume that the sender can send a null JSON content, like that:
```go
req, _ := http.NewRequest(method, path, **nil**)
```

How can I test this in my service? If I try use the BindJSON a PANIC will be thrown.

Can't get this thing to work

https://github.com/gin-gonic/gin/tree/master/examples/upload-file/single

throws an error **c.FormFile undefined (type *gin.Context has no field or method FormFile)**

And when i run this command to get the latest commit has **git -C $GOPATH/src/github.com/gin-gonic/gin rev-parse HEAD**

i'm getting the latest commit hash which is **8fc8ce047243dbbbc5eb3d01b9fd026fc3b08c82**

My current go version is **1.10.2** should i updated it to **go1.10.3**? 

Thanks.

from httprouter patch: https://github.com/julienschmidt/httprouter/pull/243
Whether there are plans to support regular routing？

Change-Id: I1198254ec71ac38a750e2aacfd33f1111c450e76
i'm trying go mod on go version 1.11beta3, the simplest code like below

```golang
package main
import "github.com/gin-gonic/gin"
func main() {
  r := gin.Default()
  r.GET("/", func(c *gin.Context) {
   //  try c.BindQuery here
  })
  r.Run(":8080")
}
```

when i run `go run .` go installs a gin of version 1.14, and then it faild with c.BindQuery undefined.
i've tried to sepcify the version v1.2 `go get -u github.com/gin-gonic/gin@v1.2` but also failed with version can not be found.

anyone can give me some suggestions?
The example code throws an `error binding.Validator.Engine undefined (type binding.StructValidator has no field or method Engine)`:

```go
if v, ok := binding.Validator.Engine().(*validator.Validate); ok {
	v.RegisterValidation("bookabledate", bookableDate)
}
```

How can I register a custom validator?
#1462
I have a command line app that imports some libraries that also import gin.

There has been a change to a non-test file - test_helpers.go that includes net/http/httptest under this PR. httptest should only be used in a file called _test.go to ensure it is excluded from compilation for non test code.

The PR is:

https://github.com/gin-gonic/gin/pull/1433

This is now causing my app to show httptest.serve as an option in flags:

```
  -httptest.serve string
        if non-empty, httptest.NewServer serves on this address and blocks
```

I also have a naive flag parser that requires all flags to have a value, so this change makes my app fail to run as there is an empty value for that flag.

Please can you revert this PR.

Thank you.

The status of responseWriter will be overwrite if flush was called. This is caused by the Flush of http.response.Flush().
interface implement type check
```

func Middleware() gin.HandlerFunc {
	return func(c *gin.Context) {
		var json Data
		fmt.Println(c)
		fmt.Println("Action", json.Action)
		buf := make([]byte, 1024)
		n, _ := c.Request.Body.Read(buf)
		fmt.Println(string(buf[0:n]))
		cCp := c.Copy()
		if err := c.ShouldBindJSON(&json); err == nil {
			switch json.Action {
			case "goto":
				fmt.Println(json.Action)
				TOGO(cCp)
			}
		} else {
			c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
		}

		c.Next()

	}
}

func main() {
	router := gin.Default()

	//router.POST("/", gin.WrapF(test))
	router.POST("/", Middleware())
	router.Run(":8090")
}

func TOGO(c *gin.Context) {
	fmt.Println("dsdsdsd")
	fmt.Println(c)
	var json Infos
	fmt.Println(json.Instance_id)
	buf := make([]byte, 1024)
	n, _ := c.Request.Body.Read(buf)
	fmt.Println(string(buf[0:n]))
	if err := c.BindJSON(&json); err == nil {
		fmt.Println("Action", json.Instance_id)
	}
	c.JSON(200, gin.H{
		"status":  "posted",
		"message": json.Instance_id,
	})

}

```
outconsole

```
&{{0xc42023c0e0 -1 200} 0xc42024a000 0xc420250000 [] [0x1508b60 0x1509920 0x150ba30] 2 0xc42023e000 map[]  []}

Action goto
&{{0xc42023c0e0 -1 200} 0xc42024a000 0xc420250000 [] [0x1508b60 0x1509920 0x150ba30] 2 0xc42023e000 map[]  []}
[GIN] 2018/08/05 - 17:17:49 | 200 |     332.399µs |       127.0.0.1 | POST     /

```
### Why don't you get Jie g at the address json action ？


go version
```
~ » go env                                                                                                                                                                                                     liberxue@liberxuedeMacBook-Pro
GOARCH="amd64"
GOBIN="/Users/liberxue/golang/bin"
GOCACHE="/Users/liberxue/Library/Caches/go-build"
GOEXE=""
GOHOSTARCH="amd64"
GOHOSTOS="darwin"
GOOS="darwin"
GOPATH="/Users/liberxue/golang"
GORACE=""
GOROOT="/usr/local/Cellar/go/1.10.3/libexec"
GOTMPDIR=""
GOTOOLDIR="/usr/local/Cellar/go/1.10.3/libexec/pkg/tool/darwin_amd64"
GCCGO="gccgo"
CC="clang"
CXX="clang++"
CGO_ENABLED="1"
CGO_CFLAGS="-g -O2"
CGO_CPPFLAGS=""
CGO_CXXFLAGS="-g -O2"
CGO_FFLAGS="-g -O2"
CGO_LDFLAGS="-g -O2"
PKG_CONFIG="pkg-config"
GOGCCFLAGS="-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/1f/1b5_xh8x2sq5q_lfs0p86x640000gn/T/go-build428959401=/tmp/go-build -gno-record-gcc-switches -fno-common"
```
```

```
Hi ,It's a long time for last release version, When to release a new version with http2 push support?

According the code, the validator will run immediately after json decode. But I want to change some value before validator, for example, trim the string.

Is there some ways to arrive the target?

```
func decodeJSON(r io.Reader, obj interface{}) error {
	decoder := json.NewDecoder(r)
	if EnableDecoderUseNumber {
		decoder.UseNumber()
	}
	if err := decoder.Decode(obj); err != nil {
		return err
	}
	return validate(obj)
}
```
The `writermem` privated member inside gin.Context make it hard to wrapper the default http.ResponseWriter instance. 

Can I PR a new function to Wrapper/Replace the default http.ResponseWriter ? 
When I run `go get github.com/gin-gonic/gin` I get the following:
```
# cd .; git clone https://gopkg.in/go-playground/validator.v8 /Users/Mark/go/http-server-demo/src/gopkg.in/go-playground/validator.v8
Cloning into '/Users/Mark/go/http-server-demo/src/gopkg.in/go-playground/validator.v8'...
fatal: unable to access 'https://gopkg.in/go-playground/validator.v8/': Unknown SSL protocol error in connection to gopkg.in:-9838
package gopkg.in/go-playground/validator.v8: exit status 128
# cd .; git clone https://gopkg.in/yaml.v2 /Users/Mark/go/http-server-demo/src/gopkg.in/yaml.v2
Cloning into '/Users/Mark/go/http-server-demo/src/gopkg.in/yaml.v2'...
fatal: unable to access 'https://gopkg.in/yaml.v2/': Unknown SSL protocol error in connection to gopkg.in:-9838
package gopkg.in/yaml.v2: exit status 128
```
I am trying to create middlware for gin-gonic that automatically adds a UUID for tracing purposes as a Header to all incoming requests, if one does not already exist. The code is below. However I'm having an issue where c.Header() does not seem to set the header. I have tried it with c.Writer.Header().Set() as well and it still always displays an empty header. 

Looking at various other examples of similar functionality suggests what I'm trying to do should work perfectly fine.

What stupid thing have I done/missing?

```
func Trace() gin.HandlerFunc {
	return func(c *gin.Context) {
		val := c.GetHeader(RequestHeaderName)
		if val == "" {
			log.Info("Missing Trace ID - start of chain")
			val = uuid.New().String()
			log.Infof("Setting Trace Header: %v", val)
			c.Header(RequestHeaderName, val)
		}
		
		log.Infof("Trace Header: %v", c.GetHeader(RequestHeaderName))

		c.Next()
	}
}
```
I need to determine(in server-side) a request is cancelled from client. In the following code it take 5min even if we cancel the request from client to return `handleFunc`. But same code using the `net/http` package works [properly](https://play.golang.org/p/dbMWLnzUTl-).
```
func handleFunc(c *gin.Context) {
    ch := make(chan error, 1)
    go func() {
        time.Sleep(5 * time.Minute)
        ch <- nil
    }()

    select {
    case err = <-ch:
        fmt.Println(err)
    case <-c.Done():
        err = c.Err()
        fmt.Println(err)
    }

    c.HTML(200, "results", {})
}
```

**PS:** 

1) I used `go version go1.10.1 linux/amd64`

2) And `gin` commit: `a712f77`
README document Chinese translation
When we call the context.Query() function multiple times to get the parameter value, adding a cache can greatly reduce the number of calls for url.ParseQuery, which make a map for each call.
I'm seeing a "concurrent map" crash where a gin.Context.Copy() product in another goroutine is modifying a key while it's being read elsewhere. context.Context (which is the interface being implemented) will not have a problem with this.
I working with gin API, and I want run multi servers for sale and admin by the individual way. That means when I restart server for sale, it's not affect to admin server, just like that. Thank you!
then in gin.HandlerFunc ,we can use c.RelativePath to get the relativePath,such as:
```
engine.GET("/p1/:id/p2/:pc/p3/*path", func(c *gin.Context) {
        //c.RelativePath value is /p1/:id/p2/:pc/p3/*path
        fmt.Println(c.RelativePath)
})

```

I found #641 which is exactly my issue. This issue is from June 2016. Looks like it's still not supported :cry: 

As an alternative I think I can use an optional parameter because my parameter will have at least one slash. Is there any other known more general approach available?
rt

I want use jsoniter as json parser and render
and I want gin can support protobuf
How to ignore a field？ c.JSON
I notice there is a new method called DataFromReader on Context, this method allows us prepare response data from reader, but there is a param called contentLength, this param is not easy to get from reader, so how about using Transfer-Encoding: chunked if we use DataFromReader to return the data.
Hi, nothing wrong with gin. just my installation problem.
https://stackoverflow.com/questions/51488385/golang-can-not-find-package-gin-in-sub-directory
just can't load gin in the subdirectory.
if anything you guys might have this before, please let me know. thanks.
Adding rudimentary route information to the middleware context

```go
func ... gin.HandlerFunc {
	return func(context *gin.Context) {
		path := ""
		for _, route := range context.Routes() {
			if route.Handler == context.HandlerName() {
				path = route.Path
				break
			}
		}

		fmt.Printf("%s", path)

		context.Next()
	}
}
```
Hello!

Please explain how to add custom validators for now?

Example code throws an error `binding.Validator.Engine undefined (type binding.StructValidator has no field or method Engine)`:

```
if v, ok := binding.Validator.Engine().(*validator.Validate); ok {
	v.RegisterValidation("bookabledate", bookableDate)
}
```
If I write this,c is *gin.Context

````
buf := make([]byte, 1024)                                                                                                      
id := c.PostForm("id")
fmt.Println(id)
n, _ := c.Request.Body.Read(buf)
var str string = string(buf[0:n])
````

I can get it id value,But I can't get str value

If I write this,

````
buf := make([]byte, 1024)

n, _ := c.Request.Body.Read(buf)

var str string = string(buf[0:n])
````

I can get str value

Now,I think  get the value of the two variables at the same time,How should I write?

c.PostForm does not get c.Request.Body.Read after execution,Vice versa




return json if jsonp has not callback
can not add packages  from github.com/gin-gonic/gin@v1.2, I wonder if the repository work well?

I am looking to write a route like this
```

type User struct {
	name string
	age int
}

```


```

r.GET("/html", func(c *gin.Context) {

		person := User{ name:"Naren", age : 100}
		
		c.HTML(http.StatusOK, "index.tmpl", gin.H{
			"title": "Main website",
			"content" : "This is the content",
			"person" : person,
		})
	})
```

and use in index.tmpl like this
```

<html>
    <head>
        <title>{{ .title }}</title>
    </head>
    
    <body>
        <div>
            Person: {{ .person.name }}
        </div>
    </body>
</html>
```

When I do this I get this error

*executing "index.tmpl" at <.person.name>: name is an unexported field of struct type interface {}*

Is this possible?
I don't know to organize folder with controllers, services, models. How to make them working well without IMPORT CYCLE because I reuse code so much.
This is my structure project
![screenshot_1](https://user-images.githubusercontent.com/39752625/42885972-9d4722d0-8acc-11e8-9df2-d3a94c4f0864.png)


1.2 has been released one year ago.

Since then, a lot of new stuff came in to Gin Gonic: https://github.com/gin-gonic/gin/compare/v1.2...master.

When using a package management like `glide` which is using semantic versioning, `1.2` is the last version number available, missing a lot of the new stuff.

Could we get a version update soon?

I'm working on a project which uses literal colons in URLs to specify custom methods, as per the [Google API Design Guidelines](https://cloud.google.com/apis/design/custom_methods).  The colons do not come after a slash, as one would expect a variable to, but the engine will detect them as variables anyway because it does a simple search for single colon or asterisk characters in tree.go (in several places).

I'd like to be able to include literal colons (not necessarily asterisks, though I don't see why not) in URLs because they're valid characters, either normally when they're not immediately after a path delimiter (do we really support having paths like `/root/version/something:variable`?) or if they're backslash-escaped.  I can make a PR to do this, but I'd like to get a sense of what's preferred (if not both).
Hello!

Looking through context package and found a little bit complicated switch block. And tried to make it easier.

Thanks!
I tried to use socket.io in gin,but I met a problem,I use it this way
`     router.GET ( "/socket.io/",socketHandler)

	router.POST ( "/socket.io/",socketHandler)

	router.Handle ( "WS", "/socket.io/", socketHandler )

	router.Handle ( "WSS", "/socket.io/",socketHandler )`
and socketHandler
        `       sio.On("/", func() {
  
		log.Println("connect-----------")

	})

	sio.Of("/android").On("connect", func(ns *socketio.NameSpace) {

		KeyMap[ns.Id()]=ns

		log.Println("Pol Connected: ", ns.Id())

	})

	sio.Of("/android").On("disconnect", func(ns *socketio.NameSpace) {

		delete(KeyMap, ns.Id())

		log.Println("Pol Disconnected: ", ns.Id())

	})

       sio.ServeHTTP(c.Writer,c.Request)`

After page access, there is a  socketHandler method,but No output,Then the console prints 404.
The console has a lot of output 
`[GIN] 2018/07/16 - 00:16:38 | 404 |            0s |             ::1 | GET      /socket.io/?EIO=3&transport=polling&t=MIUkiRZ

`
I want when render time by format json, it should be 
```2018-07-12T09:57:04.603Z```
But it auto change render to timezone +7  
```2017-11-10T09:15:07.519+07:00```
How can change timezone all whole project when render 
See:
- https://github.com/gin-gonic/gin/blob/master/context.go#L849
- https://github.com/gin-gonic/gin/blob/master/context.go#L856
- https://github.com/gin-gonic/gin/blob/master/context.go#L866.

The documentation for the `context.Context` endpoints are simply wrong and are copied straight from https://golang.org/pkg/context/ instead of documenting the actual behavior which is to perform a NOP. 

The documentation needs to explicitly state to either not use a `gin.Context` like a regular context and update the documentation for the interface endpoints or the behavior needs to be fixed. 
It would be nice if gin had an example of how to do gopherjs  or buffalo style app construction ... not sure if this is in the feature roadmap or if there is an idiomatic “gin” golang stack that people are using. If so would love to know !  

I’m also happy to contribute to this if someone wants to point me at a library we can integrate and provide out of the box support for ... maybe raw gopherjs with golang templates or something ? 
I'm trying to create a RESTful API for taking requests to upload files on to the server, I know gin can do form/multipart, but I'm unsure if I can send request with header *application/json* for uploading files. 

For example, using a frontend built in react, can I upload files without using forms? any examples or explanation will be very much appreciated.
```go
func MustAdmin() gin.HandlerFunc {
	return func(c *gin.Context) {
		user := User(c)
		switch {
		case user == nil:
			//c.String(401, "User not authorized")
			c.JSON(http.StatusUnauthorized, gin.H{
				"error":             http.StatusUnauthorized,
				"error_description": "User not authorized",
			})
			c.Abort()
		case user.Admin == false:
			//c.String(413, "User not authorized")
			c.JSON(413, gin.H{
				"error":             413,
				"error_description": "User is not admin",
			})
			c.Abort()
		default:
			c.Next()
		}
	}
}
```

router.go

```go
r := gin.New()
r.Use(gin.Recovery())
r.Use(middleware...)
getUser := r.Group("/v1/users")
{
	getUser.Use(session.MustAdmin())
	getUser.GET("show", func(c *gin.Context) {
		user := session.User(c)
		if user != nil {
			c.JSON(http.StatusOK, gin.H{
				"username": user.Name,
				"email":    user.Email,
			})
		} else {
			c.JSON(http.StatusOK, gin.H{
				"error":   413,
				"message": "no user found",
			})
		}
	})
	getUser.POST("show", func(c *gin.Context) {
		user := session.User(c)
		if user != nil {
			c.JSON(http.StatusOK, gin.H{
				"username": user.Name,
				"email":    user.Email,
			})
		} else {
			c.JSON(http.StatusOK, gin.H{
				"error":   413,
				"message": "no user found",
			})
		}
	})
}
```

If no auth info in header, both GET and POST work, will get:
```json
{
    "error": 401,
    "error_description": "User not authorized"
}
```

But if auth info in header, just GET work: 
```json
{
    "email": "test@example.com",
    "username": "test"
}
```
And POST will get code `401` in postman.

How to solve it? Thank you.

I have a url like that 
```
http://somesite.com/blog/1.html
```

code like that : 
```
r.GET("/blog/:id.html", func(ctx *gin.Context){
    id := ctx.Param("id")   // can`t get 
    id2 := ctx.Param("id.html")  // get 1.html  
})
```
I only want Id , how can I do about it ! 





I tried
```go
r.DELETE("/user/:name/:id/delete",f)
```
and in the client I tried these:
```go
req,_:=http.NewRequest("DELETE","host/user/{ft}/{5}/delete",nil)    //success 

req,_:=http.NewRequest("DELETE","host/user/{ft}/delete",nil)    //404

req,_:=http.NewRequest("DELETE","host/user/{5}/delete",nil)    //404 
```

Is it the only way to write its router ranges like:
```go
r.DELETE("/user/:name/:id/delete",f)
r.DELETE("/user/:id/delete",f)
r.DELETE("/user/delete",f)
r.DELETE("/user/:name/delete",f)
```
?
How can i change to fit two types of param filling like:
r.GET("/:mark/:index",f1)
r.GET("/:mark/:query",f2)
- go version: go version go1.11.2 darwin/amd64
- gin version:  v1.3.0
- operating system: darwin/amd64

## Description
I use `DataFromReader`  add extraHeaders to response Header,  but the header not format like httpHeader.Set(),  my test code is:

```golang
package main

import (
	"github.com/gin-gonic/gin"
	"strings"
)

func main() {
	r := gin.Default()
	r.GET("/req1", func(c *gin.Context) {
		c.DataFromReader(200, 5,  gin.MIMEMultipartPOSTForm, strings.NewReader("hello"), map[string]string{
			"x-request-id": "id",
		})
	})

	r.GET("/req2", func(c *gin.Context) {
		c.Writer.Header().Set("x-request-id", "id")
		c.DataFromReader(200, 5,  gin.MIMEMultipartPOSTForm, strings.NewReader("hello"), map[string]string{})
	})
	r.Run()
}

```

## Screenshots
<img width="655" alt="screen shot 2018-12-29 at 3 13 10 pm" src="https://user-images.githubusercontent.com/1459834/50534751-561b7100-0b7c-11e9-8e44-a4cbb8d175a8.png">

As your see `req1` response header key is `x-request-id` but  `req2` is `X-Request-Id` and client use `response.Heaer().Get("x-request-id") `  can only get `req2` value. 

The `DataFromReader`'s extraHeaders setting should have the same behavior as `c.Writer.Header().Set`.
fix #1692



- go version: go1.11.2 darwin/amd64
- gin version (or commit ref): v1.3.0
- operating system: macos/linux

## Description

Gin replace + sign with whitespace (probably) due to url.QueryUnescape. We
need to replace it back to original + sign and then encode to make it back to original value.

The code in question:
https://github.com/gin-gonic/gin/blob/master/context.go#L741

If you look at how `http` package get cookie, it does not unescape the value and return just a string. I would like to know what's the decision to unescape value here.

FYI, it breaks our app, and we need to do a workaround by replacing `" "` (whitespace) back to `+`. 


Fixing #1678

We cannot rewrite `c.handlers` in handler during iterate over it on `c.Next(...)`
- With issues:
  why  donot support  fcgi method to serve?

- go version: 1.11.2
- gin version (or commit ref): 1.30
- operating system: centos

## Description
see the rel issue #673 , the reason is much slower than unix http proxy.

But, in go  1.11.2, unix http is slower than unix fcgi

go:

```go
// fcgi usocket
func (engine *Engine) RunFcgiUnix(file string) (err error) {
	debugPrint("Listening and serving FCGI on unix:%s", file)
	defer func() { debugPrintError(err) }()

	os.Remove(file)
	listener, err := net.Listen("unix", file)
	if err != nil {
		return
	}

	os.Chmod(file, 0777)
	defer listener.Close()
	err = fcgi.Serve(listener, engine)
	return
}
```

nginx conf:
```nginx
# fcgi usocket
location ~ ^/(\S+)/{
        #fastcgi_pass   unix:/data/usock/demo.sock;
        include        fastcgi_params;
}

# http usocket
location ~ ^/(\S+)/{
        proxy_pass  http://unix:/data/usock/demo.sock;
}
```


## Screenshots
fcgi usocket

![image](https://user-images.githubusercontent.com/772787/50421113-f02aa300-0876-11e9-80cf-1cafbf3e4fd4.png)

http usocket

![image](https://user-images.githubusercontent.com/772787/50421203-b73efe00-0877-11e9-91b8-5d1364fc3c52.png)



- With issues:
### router
```go
	apiv1.GET("/videos/:vid-id", ProxyVideoHandler)
	apiv1.POST("/upload/:vid-id", ProxyVideoHandler)
```
### handler
```go
func ProxyVideoHandler(c *gin.Context) {
	u, err := url.Parse(setting.AppSetting.ProxyURL)
	if err != nil {
		logging.Info(err)
		c.String(http.StatusInternalServerError, "internal server error")
		return
	}
	proxy := httputil.NewSingleHostReverseProxy(u)
	c.Request.Host = u.Host
	proxy.ServeHTTP(c.Writer, c.Request)
}
```

- isson is
```shell
[GIN] 2018/12/25 - 12:48:58 | 200 |     15.5698ms |       127.0.0.1 | GET      /static/js/jquery-3.3.1.min.js
[GIN] 2018/12/25 - 12:48:58 | 200 |    20.02673ms |       127.0.0.1 | POST     /api/v1/api
[GIN] 2018/12/25 - 12:48:58 | 200 |   40.379618ms |       127.0.0.1 | POST     /api/v1/api
[GIN] 2018/12/25 - 12:48:58 | 200 |     582.992µs |       127.0.0.1 | GET      /static/img/preloader.jpg


2018/12/25 12:48:58 [Recovery] 2018/12/25 - 12:48:58 panic recovered:
GET /api/v1/videos/973fd869-cba7-4dce-a1c7-8ce2626a1046 HTTP/1.1
Host: 127.0.0.1:8080
Accept: */*
Accept-Encoding: identity;q=1, *;q=0
Accept-Language: zh-CN,zh;q=0.9
Connection: keep-alive
Cookie: session=8a9e75ba-ed79-4c5a-8724-ec3a8e796580; username=hhhhh
Range: bytes=0-
Referer: http://127.0.0.1:8080/api/v1/userhome
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36


net/http: abort Handler
/usr/local/opt/go/libexec/src/runtime/panic.go:513 (0x102bcd8)
	gopanic: reflectcall(nil, unsafe.Pointer(d.fn), deferArgs(d), uint32(d.siz), uint32(d.siz))
/usr/local/opt/go/libexec/src/net/http/httputil/reverseproxy.go:284 (0x155a317)
	(*ReverseProxy).ServeHTTP: panic(http.ErrAbortHandler)
/Users/hx/goprojects/src/github.com/haibeichina/gin_video_server/web/routers/api/v1/webhandles.go:174 (0x16030ff)
	ReverseProxy.func1: proxy.ServeHTTP(c.Writer, c.Request)
/Users/hx/GoLang/src/github.com/gin-gonic/gin/context.go:108 (0x155b802)
	(*Context).Next: c.handlers[c.index](c)
/Users/hx/GoLang/src/github.com/gin-gonic/gin/recovery.go:52 (0x156cd99)
	RecoveryWithWriter.func1: c.Next()
/Users/hx/GoLang/src/github.com/gin-gonic/gin/context.go:108 (0x155b802)
	(*Context).Next: c.handlers[c.index](c)
/Users/hx/GoLang/src/github.com/gin-gonic/gin/logger.go:84 (0x156bf21)
	LoggerWithWriter.func1: c.Next()
/Users/hx/GoLang/src/github.com/gin-gonic/gin/context.go:108 (0x155b802)
	(*Context).Next: c.handlers[c.index](c)
/Users/hx/GoLang/src/github.com/gin-gonic/gin/gin.go:362 (0x156409a)
	(*Engine).handleHTTPRequest: c.Next()
/Users/hx/GoLang/src/github.com/gin-gonic/gin/gin.go:328 (0x15638f1)
	(*Engine).ServeHTTP: engine.handleHTTPRequest(c)
/usr/local/opt/go/libexec/src/net/http/server.go:2741 (0x128fdea)
	serverHandler.ServeHTTP: handler.ServeHTTP(rw, req)
/usr/local/opt/go/libexec/src/net/http/server.go:1847 (0x128c045)
	(*conn).serve: serverHandler{c.server}.ServeHTTP(w, w.req)
/usr/local/opt/go/libexec/src/runtime/asm_amd64.s:1333 (0x1059840)
	goexit: BYTE	$0x90	// NOP

[GIN-debug] [WARNING] Headers were already written. Wanted to override status code 206 with 500[GIN] 2018/12/25 - 12:48:58 | 500 |   16.338862ms |       127.0.0.1 | GET      /api/v1/videos/973fd869-cba7-4dce-a1c7-8ce2626a1046
[GIN] 2018/12/25 - 12:48:58 | 206 |    2.352201ms |       127.0.0.1 | GET      /api/v1/videos/973fd869-cba7-4dce-a1c7-8ce2626a1046
[GIN] 2018/12/25 - 12:48:58 | 200 |    74.00254ms |       127.0.0.1 | POST     /api/v1/api
```


I use custom function to load templates.

Here main code

```
	r := gin.Default()

	r.SetHTMLTemplate(loadTemplates())

	r.Use(static.Serve("/static", static.LocalFile("./static", true)))

	r.Use(gin.Logger())

	// Recovery middleware recovers from any panics and writes a 500 if there was one.
	r.Use(gin.Recovery())

	r.GET("/books", func(c *gin.Context) {

		c.HTML(http.StatusOK, "header", gin.H{"Title": "books"})
		c.HTML(http.StatusOK, "base", gin.H{"books": books})
		c.HTML(http.StatusOK, "footer", gin.H{})
	})

	r.Run() // listen and serve on 0.0.0.0:8080

```
and templates loader function

```
const (
	templatesDir = "views/" // путь к шаблонам
	templatesExt = ".tmpl"  // расширение файлов-шаблонов
)

func loadTemplates() *template.Template {

	abs, err := filepath.Abs(templatesDir)
	if err != nil {
		log.Fatal(err)
	}

	templ := template.New("")

	err = filepath.Walk(abs,
		func(path string, info os.FileInfo, err error) (_ error) {

			if !info.Mode().IsRegular() {
				return
			}

			if filepath.Ext(path) != templatesExt {
				return
			}

			name, err := filepath.Rel(abs, path)
			if err != nil {
				return err
			}
			name = strings.TrimSuffix(name, templatesExt)

			nt := templ.New(name)
			b, err := ioutil.ReadFile(path)
			if err != nil {
				return err
			}
			_, err = nt.Parse(string(b))
			return err

		})

	if err != nil {
		log.Fatal(err)
	}

	return templ

}

```

how to force reload template when i change it without app restart. It in debug mode, but still not reload template.
I'm currently researching how to implement HSTS properly with gin, and I currently found no documentation about this library. I suppose it should be similar to the standard golang http library, and there are some projects that can provide the required headers like [hsts](github.com/a-h/hsts).

Still it's not very clear if this is all it's required to do for securing the protocol, and how exactly the `Handle()` function should be used, as it kinda conflicts with the `GET()` shortcuts.

So the question: is this the correct middleware for making HSTS work? As I understand it, it's only a matter of letting the browser know that the site talks only in HTTPS via a header. Also, is it possible to have a minimal example to study?

Thanks a lot for the support
By https://github.com/gin-gonic/gin/issues/1701, I thought it's necessary.
There is something weird going on regarding the "Copyright" claim in file headers, like that:
https://github.com/gin-gonic/gin/blob/678e09c736505225e28d8c585087b84faaf4bb80/auth.go#L1-L3
If it's protected by the MIT license in the `LICENSE.md` file, then it's not really all rights reserved. Plus, the year is outdated.
I have updated the file to make it easier for beginners to get started, and also fixed some weird things.
I am messing with Gin for a while. I was almost making a website for this project (lol) because the one linked in the repository description is so outdated (https://gin-gonic.github.io/gin/). Only after a while I found your repository for the actual updated website (https://gin-gonic.com/).
closing #1700 
In https://github.com/gin-gonic/gin/pull/1677, I  misspelled LoggerConfig's SkipPaths.

**Note**
This change breaks backward compability, but adding LoggerConfig is not released yet. This change affects only the user which is using master branch.

go.mod was old, all tests appear to pass


Hi
I'm trying to switch to `gin`, but wanted to know it better.
I'm currently using gin's router as explained in examples.

for example, if I need to define the routers in other package, then I pass the `*Engine` to that function to get routes defined.

But I wanted to know If there is an option to pass an already defined `Router` from other packages to the gin. seems complicated :). there is such an option in `ExpressJs`.

```js
...
var router = express.Router()

router.get('/test', (req, res) => res.send('ok') )
...
app.use('/group', router)
```
As you see, there is a 'router' which is passed to the app.

Is it possible in gin?
- go version: 1.11
- gin version (or commit ref): v1.3.0
- operating system: Fedora 29 / linux

## Description

I'm doing some "first time" gin-gonic adventure currently and I'm quite happy with it. Now I came across my first POST route defined like

```golang
	r.POST("/foo", func(c *gin.Context) {
		fmt.Println(c.ContentType())
		a, _ := c.GetRawData()
		fmt.Println(string(a))
		fmt.Println(c.PostForm("id"))
	})
```

and I'm trying to send a form with id=123 using curl

```
curl -X POST --data "id=123" http://localhost:8088/foo
```

which prints

```
application/x-www-form-urlencoded
id=123

```
on the console. From the examples of *README.md*, I'd expect the `c.PostForm("id")` to return something more than an empty string.

So - I'm feeling a bit stupid in the moment... Do I have to do anything else to access the value of "id"?
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: "go version go1.11.2 darwin/amd64"
- gin version (or commit ref): "v1.3.0"
- operating system: "macos mojave 10.14.2"

## Description
I'm trying to use gin-gonic with https://github.com/googollee/go-socket.io . go-socket.io repo is using gorilla's websocket for handling connections etc and it uses hijack inside of it. Problem is, when I pass context (request and responseWriter) into go-socket.io's ServeHTTP method, gin still trying to write headers while upgrading connection. I'm getting "**[GIN-debug] [WARNING] Headers were already written. Wanted to override status code 200 with 400**" on every connection.

Here are the sample code:
```go
var (
	srv *http.Server
	socketSrv *socketio.Server
)
func main() {
    socketSrv, err = socketio.NewServer(nil)
    if err != nil {
	log.Fatalf("failed to create new socketio server instance.")
    }

    gin.SetMode(gin.DebugMode)
    server := gin.New()
    server.Use(gin.Logger())

    root := server.Group("/")
    {
	root.GET("/", homeHandler)
	root.GET("/stats/", statsHandler)
	root.Handle ("GET", "/socket.io/", handler())
	root.Handle ("WS", "/socket.io/", handler())
	root.Handle ("WSS", "/socket.io/", handler())
    }

    go func() {
	if err := srv.ListenAndServe(); err != nil {
		log.Printf("%v", err)
	}
    }()

    Stop()
}

func Stop() {
	quit := make(chan os.Signal, 1)

	signal.Notify(quit, os.Interrupt, syscall.SIGTERM)

	<-quit

	ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)

	defer cancel()

	if err := srv.Shutdown(ctx); err != nil {
		log.Printf("Server shutdown error: %v", err)
		os.Exit(1)
	}

	log.Printf("Server successfuly stopped.")
}
```
```go
func initws(c *gin.Context) {
	if c.IsWebsocket() {
		err := socketSrv.On("connection", func(so socketio.Socket) {
			log.Println("on connection")
			so.On("disconnection", func() {
				log.Println("on disconnect")
			})

		})
		if err != nil {
			log.Printf("error :%e", err)
		}
		err = socketSrv.On("error", func(so socketio.Socket, err error) {
			log.Println("error:", err)
		})
		if err != nil {
			log.Printf("error :%e", err)
		}

		socketSrv.ServeHTTP(c.Writer, c.Request)
		return
	}
}

func handler() gin.HandlerFunc {
	return func(context *gin.Context) {
		initws(context)
		context.Abort()
		return
	}
}
```

**Output:**
[GIN] 2018/12/18 - 17:18:04 | 400 |      117.48µs |             ::1 | GET      /socket.io/?EIO=3&transport=websocket
[GIN-debug] [WARNING] Headers were already written. Wanted to override status code 200 with 400

**PS**
Socket and connection is working fine. Only problem is that log.
## Screenshots


- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: 1.11 
- gin version (or commit ref): latest gin (add_customize_redis_example v1.09)
- operating system: darwin/amd64 on Mac OSX 10.14.1

## Description
I guess:
- **gin.LogFormatterParams.Latency** shows how much time the server cost to process a certain request;
- **gin.LogFormatterParams.TimeStamp** shows the time when the server begin to process a certain request, NOT the time the server receive that request(maybe that request is standing in line and waiting)
Do I make any misunderstanding? Hope someone can give a verification to help out. Thanks in advance:)
## Screenshots


- go version:
go version go1.11.2 windows/amd64
- gin version (or commit ref):
$ go get github.com/gin-gonic/gin
- operating system:
Windows 10
## Description
`godep save` fails due to blank imports packages in `tools.go` not available in GOPATH
## Screenshots
```
mellon@collie MINGW64 /d/testgin/src/testgin
$ go env
set GOARCH=amd64
set GOBIN=
set GOCACHE=C:\Users\mellon\AppData\Local\go-build
set GOEXE=.exe
set GOFLAGS=
set GOHOSTARCH=amd64
set GOHOSTOS=windows
set GOOS=windows
set GOPATH=D:/testgin/
set GOPROXY=
set GORACE=
set GOROOT=C:\Go
set GOTMPDIR=
set GOTOOLDIR=C:\Go\pkg\tool\windows_amd64
set GCCGO=gccgo
set CC=gcc
set CXX=g++
set CGO_ENABLED=1
set GOMOD=
set CGO_CFLAGS=-g -O2
set CGO_CPPFLAGS=
set CGO_CXXFLAGS=-g -O2
set CGO_FFLAGS=-g -O2
set CGO_LDFLAGS=-g -O2
set PKG_CONFIG=pkg-config
set GOGCCFLAGS=-m64 -mthreads -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=C:\Users\mellon\AppData\Local\Temp\go-build602265990=/tmp/go-build -gno-record-gcc-switches

mellon@collie MINGW64 /d/testgin/src/testgin
$ ls
main.go

mellon@collie MINGW64 /d/testgin/src/testgin
$ godep save
godep: Package (github.com/campoy/embedmd) not found

```

I don't know if an example need a test

https://github.com/fishedee/gof

faster than gin , you should try
- go version: go1.11.1 
- operating system: linux/amd64 and macOS 10.13.6

## Description

After terminating my server and restarting it I get the error:
`Cannot acquire directory lock on "/tmp/badger".  Another process is using this Badger database.: resource temporarily unavailable`

I've tried deleting the "/tmp/badger" directory but the error still persists.

I've read reference to a "LOCK" file in previous issues but cannot find it.

i'm sorry ,nothing here!
Like this:

```
FAIL	github.com/gin-gonic/gin [build failed]
```
closes #846 
- go version: 1.11
- operating system: Windows 10 64bit

## Description

https://github.com/gin-gonic/gin/blob/cce49582d617333c72f4d86abd8ef0e62eb778a0/examples/upload-file/single/main.go#L26

```go
file, _ := c.FormFile("file")
c.SaveUploadedFile(file, file.Filename)
```

We must not trust user input `file.Filename`!

## Reproduce

First, start `examples/upload-file/single/main.go` server.

```bash
cd ~/go/src/github.com/gin-gonic/gin/examples/upload-file/single
go run main.go
```

Start a new terminal and upload a file (such as the `main.go` itself) with cURL.

```bash
curl -X POST -F 'file=@main.go; filename=../main.go' http://127.0.0.1:8080/upload
```

Then, you will find the uploaded file is at `~/go/src/github.com/gin-gonic/gin/examples/upload-file/main.go`. Upload a file to parent dir is really dangerous.

I don't know if it's by design. But I think, at least, there should be a warning asking developers to sanitize the input properly.

## Solution

The simplest way may be

```go
import "path/filepath"

file, _ := c.FormFile("file")
filename := filepath.Base(file.Filename)
c.SaveUploadedFile(file, filename)
```

This will restrict the upload file to current directory.
- With issues:

  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: 1.11.2
- gin version (or commit ref):1.3.0
- operating system: mac os

## Description

ShouldBindQuery should be case insensitive

and here is the code

```go
type Query struct {
	Limit    int     `json:"limit"`
	Page     int     `json:"page"`
	Sort     string  `json:"sort"`
	Platform *string `json:"platform"`
}
```

```go
	if err = context.ShouldBindQuery(&query); err != nil {
		return
	}
```

Parse this query `?limit=10&page=1` >>> fail
Parse this query `?Limit=10&Page=1` >>> success

## Screenshots

none
ShouldBindWith support for reading saved body bytes.
use ShouldBindJSON,ShouldBindXML and ShouldBindYAML after ShouldBindBodyWith
*gin.Context implements standard context.Context methods, but always
returns data as context is still valid. Since Go 1.7, http.Request now
contains a context.Context object, which can be controlled by the
http.Server to indicates that the context is now closed, and persue of
request should be canceled.

This implements the propagation of http.Request context methods inside
gin.Context to have HTTP context cancelation information at gin.Context
level.

This is retro-compatible for Golang 1.6, and have no effect if http.Request have no context (as http.Request always provide context.Background is ctx is nil)
- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: 1.11 
- gin version (or commit ref): latest gin (add_customize_redis_example v1.09)
- operating system: darwin/amd64 on Mac OSX 10.14.1

## Description
I created an image and encoded it( below described `capString`) with base64 and get a string as "data:image/png;base64,.....==", try to map to a page as below:
```golang
// get an image and encode it with base64 and get a string
capString := base64Captcha.CaptchaWriteToBase64Encoding(capData)
// map it to front page
router.GET("/login", func(c *gin.Context) {
c.HTML(http.StatusOK, "login.tmpl", gin.H{
			"capId": capId,
			"capString": capString, 
		})
}

```
login.tmpl:
```html
<img id= "{{.capId}}" src="{{.capString}}">
```
The result is `<img id="ms7CdYjYjEBzaHXArrDR" src="#ZgotmplZ">`, and the image shows on page is 
![image](https://user-images.githubusercontent.com/16678624/49684114-1e378580-fb0a-11e8-8ff8-3e5c546a6a4b.png)

## Screenshots
![image](https://user-images.githubusercontent.com/16678624/49684129-6656a800-fb0a-11e8-93d8-4d4a9be03500.png)


- With issues:

Installation error

```
➜  github.com go get -u github.com/gin-gonic/gin
# github.com/gin-gonic/gin
gin-gonic/gin/context.go:34:26: undefined: binding.MIMEYAML
gin-gonic/gin/context.go:530:29: undefined: binding.YAML
gin-gonic/gin/context.go:574:31: undefined: binding.YAML
gin-gonic/gin/context.go:583:9: undefined: binding.Uri
gin-gonic/gin/context.go:597:58: undefined: binding.BindingBody
gin-gonic/gin/context.go:782:17: undefined: render.JsonpJSON
gin-gonic/gin/context.go:794:17: undefined: render.AsciiJSON
gin-gonic/gin/context.go:810:17: undefined: render.ProtoBuf
gin-gonic/gin/context.go:837:17: undefined: render.Reader
gin-gonic/gin/context_17.go:16:17: undefined: render.PureJSON
gin-gonic/gin/context_17.go:16:17: too many errors
```

- go version:
1.11.1
- gin version (or commit ref):
Install the current version

```

go get -u github.com/gin-gonic/gin
```

- operating system:

mac 10.13.16

## Description

Installation ERROR

## Screenshots

<img width="805" alt="2018-12-07 17 24 47" src="https://user-images.githubusercontent.com/5828609/49639096-106bfc80-fa45-11e8-8153-6966fb62da71.png">




problem solved, caused by the firewall.
Could someone delete this issue? 
thanks
Hello guys, 

I'm quite new to Go and have to write unitary tests.

The problem I'm facing is that I need to test func Login(c *gin.Context) and have to pass data to that context.postform(key) from my test in order to complete it. 

I've tried a few things but I don't know how to bind data to the post request from my test so that the context can access it. 

Sorry if the description isn't precise enough, I'm on my phone and will upload the code when I'll be back home on my computer.

Thanks and sorry if its a dumb question. 
`ClientIP()` using `X-Forwarded-For` and `X-Real-Ip` by default without any kind of warning is appalling security-wise.

It is trivial for an attacker to spoof any IP address if the app is listening directly on a public port without a reverse proxy or if the reverse proxy is not properly configured. For example, if the reverse proxy is configured to use `X-Real-Ip`, it will seemingly work correctly, but `X-Forwarded-For` takes precedence so the remote IP address can still be spoofed.
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:
- gin version (or commit ref):
- operating system:

## Description

## Screenshots


fix: 
```
=== RUN   TestRouteStaticNoListing
--- FAIL: TestRouteStaticNoListing (0.00s)
	assertions.go:256: 
			Error Trace:	routes_test.go:298
			Error:      	Not equal: 
			            	expected: 404
			            	actual  : 200
			Test:       	TestRouteStaticNoListing
```
```go
router.GET("/:something/", Blabla)
router.GET("/:something/else", Bleble)
router.GET("/:something/:different/:again", Blibli)
```

`panic: wildcard route ':different' conflicts with existing children in path '/:something/:different/:again'`

Am I doing something wrong or is this simply not allowed?
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: go version go1.11 darwin/amd64
- gin version (or commit ref):b97ccf3a43d2901d295870b5876277bf478a4909
- operating system: ubuntu 16.04

## Description
Route URL error：
source code:

```
outer := Server.Group("/oa/v1")
          {
                  outer.Any("/server", controller.WeChatCallBackServerHandler) //微信被动消息接口
                  outer.Group("/api").Use(filter.WechatLoginFilter)
                  {
                          outer.GET("/we",func(ctx *gin.Context){
                                  ctx.Status(200)
                          })
                          outer.POST("/weApp/bind", controller.WeChatAppBindFromAppHandler) //从>    小程序过来的用户绑定请求
                  }
          }
```


I want  the url will be: 

**/oa/v1/api/we**

but i got:

**/oa/v1/we**


## Screenshots



- go version:1.11.3
- gin version (or commit ref):
- operating system:

## Description
Keep getting 403 errors on the basic example. Code seems fine

```
package main

import (
	"net/http"

	"github.com/gin-gonic/gin"
)

// This function's name is a must. App Engine uses it to drive the requests properly.
func main() {
	// Starts a new Gin instance with no middle-ware
	r := gin.New()

	// Define your handlers
	r.GET("/", func(c *gin.Context) {
		c.String(http.StatusOK, "Hello World!")
	})
	r.GET("/ping", func(c *gin.Context) {
		c.String(http.StatusOK, "pong")
	})

	// Handle all requests using net/http
	http.Handle("/", r)
}
```

After commit b97ccf3a43d2901d295870b5876277bf478a4909 I catch panic that never been before. In my case length of c.handlers equal 1 and c.index equal 1.

![image_2018-12-03_11-55-57](https://user-images.githubusercontent.com/16224266/49366578-4ed68400-f6f2-11e8-9ddf-96a4723c1daf.png)

# Problems
I want to define gin's log format.
Currently, instead of using the default Logger, I can define the log format by defining my own Logger function.

However, my own Logger function must include redundant codes similar to the default Logger.

ref. https://github.com/gin-gonic/gin/issues/1581
# Proposal
This PR solves the problem by adding new methods, `LoggerWithFormatter` and `LoggerWithConfig`.

example code
```
r := gin.New()
r.Use(Recovery())
r.Use(LoggerWithFormatter(func(param gin.LogFormatterParams) string {
	// my own format
	return fmt.Sprintf("[GIN] %v | %3d | %13v | %15s | %-7s  %s | %s\n%s",
		param.TimeStamp.Format("2006/01/02 - 15:04:05"),
		param.StatusCode,
		param.Latency,
		param.ClientIP,
		param.Method,
		param.Path,
		SomeMyOwnParam(param.Request), // username or payload information
		param.ErrorMessage,
	)
}))
```

refs.
gorilla's LogFormatter
http://www.gorillatoolkit.org/pkg/handlers#LogFormatter

echo's LoggerWithConfig
https://echo.labstack.com/middleware/logger
# At end
If you prefers to this proposal, I will add unit tests and documents.

Thanks.
Now the `wercker.yml` have no longer used.
- With issues:
1, I want my API to be more tolerant with param types, like Term value can be string (just number in string format) or int, here is the json decoder "github.com/json-iterator/go".
2, I want the validator to be more powerful, like "github.com/go-playground/validator", it can check the type and value range...

```
	type param struct {
		Term      uint32 `json:"term" validate:"min=1,max=30"`
		TermUnit  uint32 `json:"term_unit" validate:"required"`
 	}

	var p param
	var err error

	if err = c.Bind(&p); err != nil {
		logger.Error(err)
		return
	}

	if err := service.Validate(&p); err != nil {
		logger.Error(err)
		c.AbortWithStatus(http.StatusBadRequest)
		return
	}

```

In the above code, I changed gin-gonic/gin/binding/json.go file to use "github.com/json-iterator/go", and added service.Validate(&p) to support "github.com/go-playground/validator".

I wonder to know how could we easily integrate new json decoder, new validator to gin?

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:
- gin version (or commit ref):
- operating system:

## Description

## Screenshots


- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: 1.11
- gin version (or commit ref): v1.3.1-0.20181126150151-b97ccf3a43d2
- operating system: Mac/Ubuntu

## Description

I found a new feature `ShouldBindUri` in README doc but no any releases contains it. So I install by go mod:

~~~shell
go get github.com/gin-gonic/gin@master
~~~

Then the gin version has been updated to `v1.3.1-0.20181126150151-b97ccf3a43d2` in `go.mod` file.

When I run `go build` I got this error output:

~~~
/go/pkg/mod/github.com/gin-gonic/gin@v1.3.1-0.20181126150151-b97ccf3a43d2/binding/msgpack.go:12:2: unknown import path "github.com/ugorji/go/codec": ambiguous import: found github.com/ugorji/go/codec in multiple modules:
	github.com/ugorji/go v1.1.1 (/go/pkg/mod/github.com/ugorji/go@v1.1.1/codec)
	github.com/ugorji/go/codec v0.0.0-20181012064053-8333dd449516 (/go/pkg/mod/github.com/ugorji/go/codec@v0.0.0-20181012064053-8333dd449516)
~~~

But if I remove the folder `/go/pkg/mod/github.com/ugorji/go@v1.1.1/codec` everything goes right.

Not sure if this caused by the new version of gin or go mod.

Hope you could help!

Thanks.
```
type User struct {
	QueryTime *time.Time `binding:"omitempty"`
}

func main() {
	r := gin.Default()
	r.GET("/user", getUser)
	r.Run(":8085")
}

func getUser(c *gin.Context) {
	var user User
	if err := c.ShouldBindQuery(&user); err == nil {
		log.Infof("%+v", user)
		c.JSON(http.StatusOK, user)
	} else {
		c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
	}
}
```
curl http://localhost:8085/user

the resulst is 
```
{
QueryTime: "0001-01-01T00:00:00Z"
}
```
form_mapping.go:15
![image](https://user-images.githubusercontent.com/5651367/49061636-37a81a00-f24c-11e8-97b8-5db9885228ef.png)
gin version is v1.3.0

closes #1670 #1656 

please @appleboy review the scheme, and fail case have fixed #1669 , please first review and merge it, thanks!
ref #1656 

Now run `make test` script:

```
test:
	echo "mode: count" > coverage.out
	for d in $(TESTFOLDER); do \
		$(GO) test -v -covermode=count -coverprofile=profile.out $$d; \
		if [ -f profile.out ]; then \
			cat profile.out | grep -v "mode:" >> coverage.out; \
			rm profile.out; \
		fi; \
	done
```

If use `$(GO) test -v -covermode=count -coverprofile=profile.out $$d; | grep "^--- FAIL" | exit 1;`, it can output log to console.

So, how should we?
now ci have the following output:

```
[GIN-debug] GET    /recovery                 --> github.com/gin-gonic/gin.TestPanicWithBrokenPipe.func1.1 (2 handlers)
--- FAIL: TestPanicWithBrokenPipe (0.00s)
    --- FAIL: TestPanicWithBrokenPipe/Broken_pipe (0.00s)
        recovery_test.go:111: 
            	Error Trace:	recovery_test.go:111
            	Error:      	"
            	            	
            	            	2018/11/26 03:31:54 : : broken pipe
            	            	GET /recovery HTTP/1.1
            	            	
            	            	
            	            	" does not contain "Broken pipe"
            	Test:       	TestPanicWithBrokenPipe/Broken_pipe
    --- PASS: TestPanicWithBrokenPipe/connection_reset_by_peer (0.00s)
=== RUN   TestResponseWriterReset
```

update after output:

```
=== RUN   TestPanicWithBrokenPipe
=== RUN   TestPanicWithBrokenPipe/broken_pipe
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)
[GIN-debug] GET    /recovery                 --> github.com/gin-gonic/gin.TestPanicWithBrokenPipe.func1.1 (2 handlers)
=== RUN   TestPanicWithBrokenPipe/connection_reset_by_peer
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)
[GIN-debug] GET    /recovery                 --> github.com/gin-gonic/gin.TestPanicWithBrokenPipe.func1.1 (2 handlers)
--- PASS: TestPanicWithBrokenPipe (0.00s)
    --- PASS: TestPanicWithBrokenPipe/broken_pipe (0.00s)
    --- PASS: TestPanicWithBrokenPipe/connection_reset_by_peer (0.00s)
```




Hi @569616226 @yinbaoqiang @weibaohui @cxjava
Chinese document have migrated to https://github.com/gin-gonic/website/tree/master/content/cn and remove it from the project, only maintain one. thanks!
@appleboy please review, thanks!

Fix the redirect in README_ZH
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:
- gin version (or commit ref):
- operating system:

## Description

## Screenshots

Gin can sets up the logger,like this
gin.SetLogger(logger)
- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


Closes #1220 
Closes #1182
agreed with the project's author.
cc @thoas
thanks!

please review.


更新文档描述
have agreed with project's author.
cc @alombarte
thanks!
调整描述语句



fail info: https://travis-ci.org/gin-gonic/gin/jobs/458636581
pull request: #1387 

cc @BanzaiMan  thanks!
修复了全角括号导致超链接不能正常访问的错误。
修复了一些URL中的"/"被改成" / "的错误。
修复了一些包引用中"/"被改成" / "的错误。
修复有超链接被翻译成中文的错误。

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


Please add support of NGINX Unit. It requires to use another `ListenAndServe` function:
https://unit.nginx.org/configuration/#modifying-go-sources

May be it's required to hide the `ListenAndServe` functions behind an interface to permit another implementations.
we need to check w.Write(jsonBytes)  error.

there have an case, i have encountered: 
when i  write wrong number of  response Header  Content-Length
the w.Write(jsonBytes) will throw an err "http: wrote more than the declared Content-Length"

	w.written += int64(lenData) // ignoring errors, for errorKludge        

	if w.contentLength != -1 && w.written > w.contentLength {       

		return 0, ErrContentLength       

	}       

but gin did not throw the error, and response body is empty

When using the gin.IRouter interface, do i have to do a type assertion from `gin.IRouter -> *gin.Engine` to call the Run function?

I dont have that big of a problem doing it, i just wanted to know if that is
typical Go way of doing it. 

- go version: go1.11 darwin/amd64
- gin version (or commit ref): v1.3.0
- operating system: Mac OS V10.10.5

## Description
Request body disappear on controller if  we access it on middleware or two times on general. but this can be fixed if we read the body and then reassign the body again on `GetRawData` method.

## Code
```go
// Copyright 2018 Clivern. All rights reserved.
// Use of this source code is governed by the MIT
// license that can be found in the LICENSE file.

package main

import (
    "log"
    "github.com/gin-gonic/gin"
)

func Logger() gin.HandlerFunc {
    return func(c *gin.Context) {
        rawBody, _ := c.GetRawData()
        log.Println("first", string(rawBody))
    }
}

func main() {
    r := gin.New()
    r.Use(Logger())

    r.POST("/test", func(c *gin.Context) {
        // Body disappear on controller
        NrawBody, _ := c.GetRawData()
        log.Println("second", string(NrawBody))
    })

    // Listen and serve on 0.0.0.0:8080
    r.Run(":8080")
}
```

- **Do a curl request**
```bash
$ curl -X POST -H "Content-Type: application/json" -d '{"key":"app_name","value":"Beaver"}' "http://localhost:8080/test"
```

- **The gin log**
```
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:   export GIN_MODE=release
 - using code:  gin.SetMode(gin.ReleaseMode)

[GIN-debug] POST   /test                     --> main.main.func1 (2 handlers)
[GIN-debug] Listening and serving HTTP on :8080
2018/11/19 10:50:31 first {"key":"app_name","value":"Beaver"}
2018/11/19 10:50:31 second 
```

## Working Code
```go
// Copyright 2018 Clivern. All rights reserved.
// Use of this source code is governed by the MIT
// license that can be found in the LICENSE file.

package main

import (
    "log"
    "io/ioutil"
    "bytes"
    "github.com/gin-gonic/gin"
)

func Logger() gin.HandlerFunc {
    return func(c *gin.Context) {
        var bodyBytes []byte
        if c.Request.Body != nil {
          bodyBytes, _ = ioutil.ReadAll(c.Request.Body)
        }
       c.Request.Body = ioutil.NopCloser(bytes.NewBuffer(bodyBytes))

        log.Println("first", string(bodyBytes))
    }
}

func main() {
    r := gin.New()
    r.Use(Logger())

    r.POST("/test", func(c *gin.Context) {
        // Body disappear on controller
        NrawBody, _ := c.GetRawData()
        log.Println("second", string(NrawBody))
    })

    // Listen and serve on 0.0.0.0:8080
    r.Run(":8080")
}
```
- **Do a curl request**
```bash
$ curl -X POST -H "Content-Type: application/json" -d '{"key":"app_name","value":"Beaver"}' "http://localhost:8080/test"
```

- **The gin log**
```
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

[GIN-debug] POST   /test                     --> main.main.func1 (2 handlers)
[GIN-debug] Listening and serving HTTP on :8080
2018/11/19 11:17:41 first {"key":"app_name","value":"Beaver"}
2018/11/19 11:17:41 second {"key":"app_name","value":"Beaver"}
```

**I am not sure if gin community would like to support that?**


Many debug logs have no line breaks, so fix them here.

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


Currently it is not possible to tell the default JSON binder to use DisallowUnknownFields (supported by jsoniter and default Go json decoder). Use package variable EnableDecoderKnownFieldsOnly as a switch.
tmp fix: #1642 

I have four URLs:
http://127.0.0.1/test?username=aaa
http://127.0.0.1/test?Username=aaa
http://127.0.0.1/test?UsernNme=aaa
http://127.0.0.1/test?usernNme=aaa

Is there a way to get "username" from them in case-insensitive?
c.Query("username") has any option about case-sensitive?

Hello, is there a way to bind ignoring binding tag but don't set global binding false ?
Why I ask this?
In the update and create cases for a model, I want to use the same model. For instance:
```go
type User struct{
Username string `json:"username" binding:"required"`
Field2 string 
Field3 string
}
```
in the case of creating , username is required.However in the case of updating, field username can be ignored. The solution of  designing two almostly the same models  is really bothering.

I wonder can gin add a function BindWithoutBindingTag(interface{}) like:
```go
func (c *gin.Context) BindWithoutBindingTag(interface{}) error{
}
```

This is my case for json:
```
BindWithoutBindingTag(c *gin.Context, in, dest interface{}) error{
	if c.ContentType() != "application/json" {
		return errors.New("'BindWithoutBindingTag' only serves for application/json not for "+ c.ContentType())
	}
	buf,e :=ioutil.ReadAll(c.Request.Body)
	if e!=nil {
		return e
	}
	c.Request.Body = ioutil.NopCloser(bytes.NewReader(buf))
	return json.Unmarshal(buf, dest)
}
```
# What did I do?
Add function:
```go
func (c *Context)  Body() ([]byte,error){
     body,e:= ioutil.ReadAll(c.Request.Body)
     handle(e)
     c.Request.Body = bytes.NewReader(body)
    return body
}
```



## Description

Multiple slashes in path can't be routed!

In stdlib http, the [ServeMux](https://golang.org/src/net/http/server.go?s=40985:41006#L2313) use `cleanPath` on `path`. 

![image](https://user-images.githubusercontent.com/1881126/48471233-65de3080-e82e-11e8-9b52-61f5d58c1292.png)

## Screenshots

![image](https://user-images.githubusercontent.com/1881126/48470955-ca4cc000-e82d-11e8-84f4-fbcd51103e68.png)



- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


error info:

```
15.41s$ make vet
go vet github.com/gin-gonic/gin github.com/gin-gonic/gin/binding github.com/gin-gonic/gin/ginS github.com/gin-gonic/gin/internal/json github.com/gin-gonic/gin/render
# github.com/gin-gonic/gin
./utils.go:56: method MarshalXML(e *encoding/xml.Encoder, start encoding/xml.StartElement) error should have signature MarshalXML(*xml.Encoder, xml.StartElement) error
# github.com/gin-gonic/gin/render
render/render_test.go:221: method MarshalXML(e *encoding/xml.Encoder, start encoding/xml.StartElement) error should have signature MarshalXML(*xml.Encoder, xml.StartElement) error
make: *** [vet] Error 2
The command "make vet" exited with 2.
```

details: https://travis-ci.org/gin-gonic/gin/jobs/454760197



cc @justinfx please help me review, thanks!

ref: https://github.com/golang/go/blob/master/src/syscall/zerrors_linux_amd64.go
- go version: 1.9.7
- gin version (or commit ref): 37854ee10f7161843c338d9a9fa87f9398aacbbe
- operating system: Ubuntu

## Description

Since 37854ee10f7161843c338d9a9fa87f9398aacbbe, Gin started to import `syscall` at `recovery.go`. This made Gin apps not able to be deployed in Google App Engine. Because Google App Engine doesn't allow to import `syscall` for security reason.

> The majority of pure Go packages work on Google App Engine. A package may not work because of one of these reasons:
> 
> - The package imports `syscall` or `unsafe`.
> - The package uses cgo or assembly.
> - The package requires functions in packages that are locked down, such as writing to disk, or direct network access.

In https://cloud.google.com/appengine/kb/, I could find those restrictions.

## Screenshots

![image](https://user-images.githubusercontent.com/19982/48310935-acd3e800-e5da-11e8-9764-22d79f1a003b.png)
- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.

In the real world, it probably shouldn't matter. It just happened when I forgot to pass body to `http.NewRequest` and the function `Bind` panicked under that situation.

If we always assume body will not be nil, please let me know, I will close this PR. Thank you.

- Support for SameSite cookie via bool because Lax or Strict has same result
Source: https://www.netsparker.com/blog/web-security/same-site-cookie-attribute-prevent-cross-site-request-forgery/


![image](https://user-images.githubusercontent.com/14202749/48300829-b0099e00-e51e-11e8-9a3f-be0e8aefaa76.png)

不论是在项目的vendor目录还是gopath/src下都存在gin框架
![image](https://user-images.githubusercontent.com/14202749/48300866-535ab300-e51f-11e8-83b0-e74ab407fce8.png)

希望能指点一下
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: 1.10.3

## Description
front-end post  request body 
{"name":"g","key_id":"221bce6492eba70f","key_secret":"6eb80603e85842542f9736eb13b7e3","header":{"cache_control":"10"},"property":"0"}
back-end throw error in /usr/local/Cellar/go/1.10.3/libexec/src/encoding/json/decode.go:171
error info in Screenshots
## Screenshots
![image](https://user-images.githubusercontent.com/20365012/48257195-cc3d0a80-e44c-11e8-829f-32b3df0caef7.png)


I check for `currentUser` in next way

```
users := router.Group("/users")
	{
		users.Use(checkCurrentUser())
		users.GET("/show", controllers.ShowUser)
	}
```
and it check it correctly, but very often this `currentUser` needed inside handler, for example to get all his associations (doesn't matter). 
```
// ShowUser shows information about user
func ShowUser(c *gin.Context) {
	user := gerCurrentUser(c) // I do additional request to the DB
	c.HTML(200, "showUser", gin.H{
		"currentUser": user,
	})
}
```

And I have to do additional request to the DB, to get this record.

Is It possible to save `currentUser` somewhere and use it inside the handler?

I'm trying to use **gqlgen** (https://github.com/99designs/gqlgen) with gin.

I'm using the code below but I have doubts.

```go
package server

import (
	"myProject/graphql"
	"github.com/99designs/gqlgen/handler"
	"github.com/gin-gonic/gin"
)

func Start() {
	r := gin.Default()

	r.GET("/query", gin.WrapH(handler.Playground("GraphQL playground", "/api")))
	r.GET("/api", gin.WrapH(handler.GraphQL(graphql.NewExecutableSchema(graphql.Config{Resolvers: &graphql.Resolver{}}))))
	r.POST("/api", gin.WrapH(handler.GraphQL(graphql.NewExecutableSchema(graphql.Config{Resolvers: &graphql.Resolver{}}))))

	r.Run()
}
```

As you can see I need to repeat the lines:

```go
r.GET("/api", gin.WrapH(handler.GraphQL(graphql.NewExecutableSchema(graphql.Config{Resolvers: &graphql.Resolver{}}))))
r.POST("/api", gin.WrapH(handler.GraphQL(graphql.NewExecutableSchema(graphql.Config{Resolvers: &graphql.Resolver{}}))))
```

**Is this correct?**

Can I just have `GET` and `POST` both with the same handler function?

(I opened https://github.com/99designs/gqlgen/issues/418 for this problem).
I run a `helloworld` gin in my localhost,code as follow:
```golang
package main

import "github.com/gin-gonic/gin"

func main() {
	r := gin.Default()
	r.GET("/ping", func(c *gin.Context) {
		c.JSON(200, gin.H{
			"message": "pong",
		})
	})
	r.Run() // listen and serve on 0.0.0.0:8080
}

```

Then I do some http request by `curl` like follow:
```shell
>> curl http://localhost:8080/ping
{"message":"pong"}%  
>> curl -d "" http://localhost:8080/ping
404 page not found%
```
The second request shall be 405 ref by [http status code 405](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/405) rather than 404. 
Any plan for support more proper http status code, or I misunderstand something?


closing #1381 
Hello, I'm using a custom middleware that will check if user data is in the session, or not. If not in the session or nil, it will redirect to login URL. But even the user session data is nil, the middleware doesn't redirect, rather go to the next handler and causes errors. here's my code

```
func Authorize() gin.HandlerFunc {
	return func(c *gin.Context) {
		session := sessions.Default(c)
		loginUser := session.Get("user")
		if loginUser == nil {
			c.Redirect(http.StatusMovedPermanently, "/auth/login")
		}
	}
}

```
And here's my middleware position:
`r.GET("/", middleware.Authorize(), indexHandler)`

The loginUser is nil, but the middleware doesn't redirect to "/auth/login" rather goes to the indexHandler. Why this happens?
- go version: 1.9.2
- gin version (or commit ref): 1.3
- operating system: centos6.7

## Description

I wrote a program using gin. 

```
router := gin.Default()
router.Static("/", "./static")
router.Run(":" + strconv.Itoa(cfg.Port))
````

My glide.yaml : 

```
package: .
import:
- package: github.com/gin-gonic/gin
  version: ~1.3.0
```

But when I run go build, to show the following mistakes

```
# github.com/gin-gonic/gin/binding
src/github.com/gin-gonic/gin/binding/default_validator.go:48:14: undefined: validator.Config
src/github.com/gin-gonic/gin/binding/default_validator.go:49:29: too many arguments in call to validator.New
```


## Screenshots

![image](https://user-images.githubusercontent.com/12529092/48070694-73366200-e213-11e8-962e-578f3ebb80ec.png)



![image](https://user-images.githubusercontent.com/9391575/48039357-68e27c80-e1af-11e8-8524-551fa64a40b9.png)
这是我绑定的数据实例
，我期望的结果是如果不传id，默认id是0，不传op，默认op是add自动绑定到结构体上，我postman模拟的时候不传op，不传id，数据绑定不上
带上id那个参数，数据也绑定不了，删除结构体得default=0之后才可以绑定上去，这应该是一个bug吧
![image](https://user-images.githubusercontent.com/9391575/48039469-db535c80-e1af-11e8-809c-7c7b867d175c.png)

gin版本:1.3.0
go版本 1.10



Compatible way to enhance context.Param(), support fetch data from Route:key, _GET, _POST, _COOKIE.

In some nodejs frameworks, such as express koa, we can easily use param to get parameters of different ways(GET POST COOKIE...). Considering Gin's design principles, I feel a little wasteful for param to only get parameters on the route. So we can get the parameters conveniently.

Before I got the int in POST, I thought it was not convenient to have a mandatory conversion or bind to display.

Before:
```
age, err: = strconv.Atoi (ctx.PostForm ("age"))
if err! = nil {
    age = 0
}
```

Now:
```
age: = ctx.ParamInt ("age")
```






…f the code base.

…rest of the codebase.

The `<script>` tag is used to define a client-side script (JavaScript).  The "type" attribute is required in HTML 4, but optional in HTML5.

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:
go version go1.11 darwin/amd64
- gin version (or commit ref):
v1.3.0
- operating system:
MacOS Mojave
## Description
Without gin:
```
func getAppUser() *AppUser {
	// simple code
	return nil
}
func main() {
	user := getAppUser()
	fmt.Println(user.Name)
}
// output: panic: runtime error: invalid memory address or nil pointer dereference
```
In case of using gin:
```
engine := gin.Default()
engine.GET("test", func(context *gin.Context) {
		user := getAppUser()
		fmt.Println(user.Name)
		context.JSON(http.StatusOK, user)
	})
```
// output: nothing, service runs but does not respond

## Screenshots


Improve cookie tests code coverage #871 
I'm looking for a way to use https://github.com/google/jsonapi as a JSON (un)serializer. To be able to have custom bindings would be great but even though I looked for way to manage this, I couldn't guess how.

My idea then was to use a middleware to achieve this.

- set a custom "resource" value (a model) in the context by using a custom middleware
- populate this model by unmarshaling the request body in a common/generic middleware

Here is what my I made to make it working: 

In main.go
```go
	// subscribers routing
	subscriber := resources.Subscriber{}
	subscribers := router.Group(subscriber.BasePath())
	{
		subscribers.Use(middlewares.JsonAPI(&subscriber)).POST("", handlers.CreateSubscriber)
	}
```

The JsonAPI middleware:
```go

const RESOURCE_CONTEXT = "resource"

func JsonAPI(r resources.APIResource) gin.HandlerFunc {
	return func(c *gin.Context) {
		if err := jsonapi.UnmarshalPayload(c.Request.Body, r); err != nil {
			responder.ErrorResponse(c, http.StatusBadRequest, []error{errors.New("Invalid JSON")})
			c.Abort()
			return
		}
		c.Set(RESOURCE_CONTEXT, r)
		c.Next()
	}
}
```

Then in my handler I can get the unmarshaled struct doing that:

```go
subscriber := c.MustGet(middlewares.RESOURCE_CONTEXT).(*resources.Subscriber)
```

I really like this pattern as it makes my deserializing logic reusable but I'm going to add my own logic for validation too and it does not make sense as Gin binding are supposed to be the right way.
Hello, I want add captcha on the signup page, use [dchest/captcha](https://github.com/dchest/captcha), it's server function return a handler, and if reload an image it need a url parameter like `?reload=1495016380274`, so I try is
```go
r.Any("/captcha", gin.WrapH(captcha.Server(captcha.StdWidth, captcha.StdHeight)))

r.GET("/signup", Signup)
```
in `Signup`
```go
c.HTML(http.StatusOK, "signup.html", gin.H{
		"CaptchaId": captcha.New(),
	})
```
in template
```html
<img id=image src="/captcha/{{.CaptchaId}}.png" />
```
but cannot get the image, 
```http
GET http://127.0.0.1:8080/captcha/E7HGPUhjADJkSOBKq3UC.png 404 (Not Found)
```
Hi, I tried looking around existing issues but I could not see anything related. So, I would like to know if there is a way to support optional trailing slash at the end of a route.

For example:

`r.POST("/users/?", ...)`

Right now I have to use two posts:

```
r.POST("/users", ...)
r.POST("/users/", ...)
```
1. some headlines lack the space between sharp and text
2. unify all the examples headlines to H4
Added a space in front of th headings
Code example:
```
router := gin.Default()
router.POST("/test/users", apiv1.CreateUserTestHandle)
router.POST("/login", apiv1.LoginHandle) 
...
router.Run(":8080")
```

my question: Am I need use go func() in handle?
when use `glide install`, gin is vendored as two compies. The same for `go get ./...`.
one is `github.com/gin-gonic/gin`, the other is `gopkg.in/gin-gonic/gin.v1/`.
A panic here provides a more informative stack trace than the panic which would otherwise occur while errors are being collected.
Minor fix for 2 headers.
In order for these to appear correctly after conversion to HTML there
needs to be a space after the #'s.  This PR just adds them to the
README.
e.g.
```
engine.Use(Logger)  //Logger is first registed middleware for gin
func Logger(c *gin.Context) {
       
	c.Next()

	contentLength := c.Writer.Size()

	fmt.Printf("size=%d", contentLength)
       //when 404 The contentLength is -1
}
```
sorry, I only know a little English，I'am Chinese.
context.Bind not support pointer type because  `mapForm` method in `binding module` not support parse pointer type. if parse pointer type will get response of **Unknown type**. 

whether it is necessary to add support for pointer type? if necessary   i will put a pr to add this feature.

it is necessary to my opinion.
del
If a empty string is given(`""`), them time should be zero.
Hi
When I visited Github Gin page, I saw it's broken that is ReadMe file.

I guess README included strange a character but I don't know exact reason.
I can't seem to findout how to use go gin-gonic to perform CRUD or GET, PUT and POST with MongoDB 

Below is my code, please Kindly assist me

package main

import (
    //"encoding/json"
    "fmt"
    "log"
    "net/http"
    "os"

//  "goji.io"
//  "goji.io/pat"
    "gopkg.in/gin-gonic/gin.v1"
    "gopkg.in/mgo.v2"
//  "gopkg.in/mgo.v2/bson"
//  "github.com/rs/cors"

)

func ErrorWithJSON(w http.ResponseWriter, message string, code int) {
    w.Header().Set("Content-Type", "application/json; charset=utf-8")
    w.WriteHeader(code)
        fmt.Fprintf(w, "{message: %q}", message)
}

func ResponseWithJSON(w http.ResponseWriter, json []byte, code int) {
    w.Header().Set("Content-Type", "application/json; charset=utf-8")
    w.WriteHeader(code)
    w.Write(json)
}

type Poll struct {
    ID        string `json:"id,omitempty"`
    Firstname string `json:"firstname,omitempty"`
    Lastname  string `json:"lastname,omitempty"`
    Poll      string `json:"poll,omitempty"`
    //  Address   *Address `json:"address,omitempty"`
}

func main() {
    port := os.Getenv("PORT")

    if port == "" {
        log.Fatal("$PORT must be set")
    }

    session, err := mgo.Dial("localhost")
    if err != nil {
        panic(err)
    }
    defer session.Close()

    session.SetMode(mgo.Monotonic, true)
    ensureIndex(session)


    router := gin.Default()

    router.GET("/polls", func(c * gin.Context) {
        //c.HTML(http.StatusOK, "polls", nil)   
        //var polls []Poll
        //err := c.Find(bson.M{}).All(&polls)


        //  **Help Needed Here**

        })

    router.Run(":" + port)
}

func ensureIndex(s *mgo.Session) {
    session := s.Copy()
    defer session.Close()

    c := session.DB("store").C("polls")

    index := mgo.Index{
        Key:        []string{"id"},
        Unique:     true,
        DropDups:   true,
        Background: true,
        Sparse:     true,
    }
    err := c.EnsureIndex(index)
    if err != nil {
        panic(err)
    }
}](url)
Hi
When I visited Github Gin page, I saw it's broken that is ReadMe file.

I guess README included strange a character but I don't know exact reason.


Hello.

I am using gin with govendor and hope to test using `CreateTestContext`
I found the function in `helper_test.go`.
But when vendoring, all files whose suffix is `_test` are skipped and so I cannot vendor `helper_test.go`.
I found `test_helper.go` in `develop` branch.

Can you tell me when `helper_test.go` in `develop` branch will be merged into `master`?

Best regards

Corrected some markdown in README
I have tried setting `gin.DefaultWriter = logfile` at many different places in my program but gin still prints all the output on the console. Where in the code should I set DefaultWriter to make it print to file instead of `os.stdout`?

Hey guys,

I'm currently trying to render out JSON as a response to a request which contains an `&`  in one of the fields which is a pagination URL. Unfortunately when rendering this out to the clients it seems like this character (and others, this is just an example) are getting escaped by the JSON writer used. I tracked it down to this function in `json.go`:

```go
func WriteJSON(w http.ResponseWriter, obj interface{}) error {
	writeContentType(w, jsonContentType)
	return json.NewEncoder(w).Encode(obj)
}
```

When I change the function to
```go
func WriteJSON(w http.ResponseWriter, obj interface{}) error {
	writeContentType(w, jsonContentType)
	encoder := json.NewEncoder(w)
	encoder.SetEscapeHTML(false)
	return encoder.Encode(obj)
}
```
everything seems to work as expected.

Before I submit a pull-request to set a flag somewhere to configure this behaviour, I wanted to quickly check in if this is wanted behaviour?
complete demo code is 
```go
package main

import (
	"fmt"
	"log"
	"net/http"

	"github.com/gin-gonic/gin/binding"
)

type person struct {
	X *int `json:"x" form:"x" binding:"required"`
}

func contentType(r *http.Request) string {
	return filterFlags(requestHeader(r, "Content-Type"))
}

func filterFlags(content string) string {
	for i, char := range content {
		if char == ' ' || char == ';' {
			return content[:i]
		}
	}
	return content
}

func requestHeader(r *http.Request, key string) string {
	if values, ok := r.Header[key]; ok {
		return values[0]
	}
	return ""
}

func bind(r *http.Request, dst interface{}) error {
	contentType := contentType(r)
	if len(contentType) == 0 {
		// do some thing?
	}
	fmt.Println(contentType)

	b := binding.Default(r.Method, contentType)
	return b.Bind(r, dst)
}

func sayhello(wr http.ResponseWriter, r *http.Request) {
	p := person{}
	err := bind(r, &p)
	fmt.Printf("%#v\n", p)
	fmt.Println(err)
}

func main() {
	http.HandleFunc("/", sayhello)
	err := http.ListenAndServe(":9090", nil)
	if err != nil {
		log.Fatal("ListenAndServe:", err)
	}
}
```

I've already updated the validator to v9.

Is there any plan to support pointer kind binding?
```
curl -v -X HEAD 'http://localhost:9393/test'

< HTTP/1.1 401 Unauthorized
< Date: Thu, 20 Apr 2017 08:10:23 GMT
< Content-Type: text/plain; charset=utf-8
* no chunk, no close, no size. Assume close to signal end
```

Client sends HEAD request.

The server side, using AbortWithStatus(401) or AbortWithError(401), is able to print a 401 error log.

However the client hangs.

GET method is ok.

so like this ;
```
{
path:/user/:userId`,
valid:{
    field:"username,required,leg(10,20)"
    pathParam:"userId,required"
}
}

```
it will look like struct2 validate I think a Complex  business processing needs a lot of  validate in server .

so we can dynamic valid in server ?
just a idea .thinks!

I found mistakes in `README.md` about icons, I fixed it. Please review~ Thx
Minor Update to ReadMe to clarify and correct usage of Gin in develop branch .
Hey guys,

I'm currently struggeling to integrate NewRelic (https://github.com/newrelic/go-agent) with my gin-gonic application. Are there any examples or maybe even a ready-made plugin available I could use?
I noticed the markup on the main Gin github page has been broken for a while.  There's nothing much wrong, adding a little whitespace seems to fix it.
GitHub changed the way Markdown headings are parsed, so this change fixes it.

See [bryant1410/readmesfix](https://github.com/bryant1410/readmesfix) for more information.

Tackles bryant1410/readmesfix#1

I'm trying to send a message back to my server but I'm having a problem with quotes and backslash.
 I need to receive this: 

_**{  "message"  :   {  "data1"  :  "data2"  }  }**_

But I'm getting this: 

_**{  "message"  :  "{  \ "data1\ "  :  \ "data2\ "  }" }**_

(I put spaces in the example, otherwise the correct sentence does not appear)

The software is like this: 

_**message := "{\ "data1\ ":\ "data2\ "}"
c.JSON(200, gin.H{"message": message})**_

(I put spaces in the example, otherwise the correct sentence does not appear)

Can anyone help me? thank you

Juliano
Fixed markdown syntax 😉 
- Fixed markdown syntax
Before
![screen shot 2017-04-13 at 13 41 58](https://cloud.githubusercontent.com/assets/8124374/25005027/0df1bb6a-204f-11e7-8c43-7259a1e06957.png)
After
![screen shot 2017-04-13 at 13 42 10](https://cloud.githubusercontent.com/assets/8124374/25005026/0dee3094-204f-11e7-8182-ac4fb90c8d90.png)

`logFile，err:= os.OpenFile(filename,os.O_WRONLY|os.O_APPEND|os.O_CREATE,os.ModePerm)`
`router.Use(gin.LoggerWithWriter(logFile,""))`
the gin log cant write to logFile,why?and the second param of LoggerWithWriter is what?
Hi all.
I am using angular 2 for frontend and serving it from gin but if I refresh page at angular 2 routes will got 404 error (angular 2 routes work well when run stand alone). I think my problem is at gin router and serving static files but i don't know how to correct it, Please take a look. many thanks 

```
func main() {
	// Create a gin router with default middleware
	// logger and recovery
	router := gin.Default()

	// Use middleware to serve static
	router.Use(static.Serve("/", static.LocalFile("./frontend/dist", true)))
	router.Use(static.Serve("/download", static.LocalFile("./output", true)))

	// Routes
	api := router.Group("/api/v1")
	{
		api.POST("/card", func(c *gin.Context) {
			// Gather data from post form
			var poem Poem
			c.BindJSON(&poem)

			// ... 
			
			// Response json data to client
			c.JSON(200, gin.H{
				"data": poem,
				"fileId": fmt.Sprintf("%s", u4),
			})

		})
	}

	// Run server
	router.Run(":8899")
}```
There will be a error with loading template files as your guidance!
Maybe my error codding.
when I used c.Bind, then redirect from a POST,  the result is 404,
commented out c.Bind, c.Redirect(http.StatusFound, "/admin") it works normal
I know the response header cant be writen again after it has been writen because of the http limit.
So cant write header after c.Next() in a middleware，but sometimes it relly is needed，can gin support the   way to  solve this？
i have a suggest，
`c.Next(func(c *gin.Context){`
      `//some code here will execute before write response in handler`
`})`
i do not know whether it is feasible
There will be a error with loading template files as your guidance!
Maybe my error code.
Hi everyone.
I just set this
```
	router.StaticFS("/", http.Dir("./frontend/dist"))
	router.Static("/download", "./output")
```
but got error `panic: path segment '/download/*filepath' conflicts with existing wildcard '/*filepath' in path '/download/*filepath'
` What wrong with me? Many thanks.
Most probably due to enforcing the new formal Markdown spec [1], the readme wasn't displayed correctly anymore.

[1]: https://github.com/blog/2333-a-formal-spec-for-github-flavored-markdown
Can you upgrade your version of protobuf to the newest version so that it may be compatible with google cloud datastore library at cloud.google.com/go/datastore.

Thanks!

TODO:
- [x] Update Changelog
- [x] Update version constant
- [x] Bump version in `gin.go`
- [x] Switch import in `README` from gopkg.in to GitHub.com
- [x] Fix some tests
  - [x] context.go#L464
  - [x] context.go#L480
  - [x] context.go#L598
- ...
I noticed the README was incorrectly formatted in regards to the first header (needed a space after the #) and the badges weren't showing up correctly on Github. I've fixed it here and it appears to work.


hi:
I did everything  I could to do, How to call function in templates
![image](https://cloud.githubusercontent.com/assets/20694884/24700046/93be24fe-1a28-11e7-9f9f-b3ef31263d07.png)
![image](https://cloud.githubusercontent.com/assets/20694884/24700071/a0ec8116-1a28-11e7-9940-9da466b62f99.png)
![image](https://cloud.githubusercontent.com/assets/20694884/24700088/aa5514b6-1a28-11e7-96eb-dca91a519b4f.png)
see....

![image](https://cloud.githubusercontent.com/assets/20694884/24700196/f974a520-1a28-11e7-98fa-47cfaf9bf5e9.png)
![image](https://cloud.githubusercontent.com/assets/20694884/24700223/0a948ffa-1a29-11e7-8571-58b1674e97e2.png)
![image](https://cloud.githubusercontent.com/assets/20694884/24700233/12d5acda-1a29-11e7-8dca-7336fbfb8c26.png)
see....
```
go get -u gopkg.in/gin-gonic/gin.v1
# gopkg.in/gin-gonic/gin.v1
../../go/src/gopkg.in/gin-gonic/gin.v1/context.go:498: cannot use sse.Event literal (type sse.Event) as type render.Render in argument to c.Render:
	sse.Event does not implement render.Render (missing WriteContentType method)

```
The current [Render interface](https://godoc.org/github.com/gin-gonic/gin/render#Render) accepts only a ``http.ResponseWriter``:

    type Render interface {
        Render(http.ResponseWriter) error
    }

I'm wondering if there's any reason the ``*http.Request`` isn't accepted along with it.

The reason for considering this change is to be able to provide default values to the templates that require access to the users cookie.

Consider flash messages or information about logged in users... It's annoying to have to populate ``gin.H`` with that information each time we call ``context.HTML``. If the ``Render`` interface was updated to accept the ``*http.Request``, we could easily provide our own ``HTMLRender`` to ``Engine`` and have it perform this work automatically for us.
Fix the badges and header in readme.md
Support Let's Encrypt for a Go server application.

cc @tboerger @javierprovecho 

It deserves a well looking layout :)
add custom delims support, for example:

```
...
r := gin.Default()
r.Delims("{[{", "}]}")
r.LoadHTMLGlob("/path/to/templates"))
...
...
```

How can I unescape HTML when using the gin template engine?

`c.HTML(http.StatusOK, "index.tmpl", gin.H{
	"title": "<h1>Title</h1>", //Unescape this
})`
fix https://github.com/gin-gonic/gin/issues/854
fix https://github.com/gin-gonic/gin/issues/438
fix https://github.com/gin-gonic/gin/issues/785

TODO:
* [x] tests

(inspired by https://github.com/spf13/viper/blob/master/viper.go#L645)
fix #662 
how to fetch binary post data?
in official go package, I can fetch the data in the following code, how can do it in gin?


        body := Request.Body
        data, _ := ioutil.ReadAll(body)
i'm trying to write a body parser middleware.  by design, the middleware will return immediately if an `error` occurs when fail to decode json. but the middleware acted like that it ignores the `return` statement and went to next handler.

```go
package middleware

import (
	"github.com/gin-gonic/gin"
	"encoding/json"
	"net/http"
)

func BodyParser() gin.HandlerFunc {
	return func(c *gin.Context) {
		var m map[string]interface{}

		decoder := json.NewDecoder(c.Request.Body)

		defer c.Request.Body.Close()

		if err := decoder.Decode(&m); err != nil {
			c.JSON(http.StatusBadRequest, gin.H{"error": "invalid body"})
			return
		}

		c.Set("body", m)
		c.Next()
	}
}
```
Proof of Concept here: https://gist.github.com/scottmmjackson/c35f4609750d9c6907a464780e55097a

Adding `r.Use(gin.Recovery()` does not change the outcomes below.

Do a `curl https://localhost:8080 -k` (especially with nghttp2 support built in) and CTRL+C (or TERM, or KILL) before the server has a chance to read a response. The result should be something like:

```
http2: panic serving [::1]:54808: http2: stream closed
// stacktrace here
```

Similarly a `curl http://localhost:8181` that's terminated too early:

```
http: panic serving [::1]:54806: write tcp [::1]:8181->[::1]:54806: write: broken pipe
// stacktrace
```

That `Context.JSON` panics when the stream is closed too early means that in larger apps it's much more difficult for the app to gracefully degrade. The recovery handler is thus handling app-created panics (e.g.: the dev messed up) as well as panics that will necessarily occur in real-world use cases (e.g.: the user stopped loading the request, or a proxy reset the connection early).

It also pollutes stderr with stack traces that show that, yes, in fact, a user closed the socket before we could write the response.

- Fixes the broken README.md heading, caused by no new line after image.
FYI
before:

![image](https://cloud.githubusercontent.com/assets/15371677/24328343/2696e892-1222-11e7-896d-f40ef0c07c59.png)

after:

![](https://cloud.githubusercontent.com/assets/15371677/24328341/0ca741de-1222-11e7-8c63-4fe2a94fde8f.png)

The README looked a little janky so I fixed the formatting so that it renders properly on GitHub.

| Before | After |
| ------- | ----- |
| <img width="985" alt="screen shot 2017-03-25 at 16 25 35" src="https://cloud.githubusercontent.com/assets/564113/24325818/b7216bc2-1177-11e7-96dd-54ea5a2a9c7f.png"> | <img width="997" alt="screen shot 2017-03-25 at 16 26 58" src="https://cloud.githubusercontent.com/assets/564113/24325830/e97a730c-1177-11e7-916b-89b7bbde3a54.png"> |

Thanks!



Is there a way to validate URL params?

e.g. 

```go
r.GET("/:foo/*bar", myFunc)
```

How can I validate foo and bar?

It would be nice if c.Bind() method could fall back (query params, form params, url params) - maybe introducing a 'url' tag:

```go
type MyParams struct {
    Foo string `url:"foo"`
    Bar string `url:"bar`
    Download bool `form:"dl"`
}
```

hi,
not sure if this is a isolated issue, but i am trying to use context.Request.Url.String() to build pagination links. using the golang net/url i can build the links perfectly. but when i try to grab the url from context.Request.Url.String all i get back is the path, the entire host (http://www.mysite.com) is missing, even the URL.HostName() is empty. im not sure why gin is not showing this when golang's url package returns the full url in .String().

is there another way to get the complete URL from gin or do i need to rebuild it.
Thanks for the help



make CreateTestContext export
How u do something like this?

```
err := ctx.BindWith(&email, binding.Form)
if err == nil {
	ctx.JSON(http.StatusOK, gin.H{"status": true})
} else {
	ctx.JSON(http.StatusOK, gin.H{
		"status": false,
		"smg": "This is not email",
	})
}
```

I cant get Json if bindWith fails cuz browser get a 400 code bad request
The function is capitalized, which suggests in idiomatic Go that it should be exported. However, the file is named `helpers_test.go` instead of `test_helpers.go`. The former name suggests that it is actually testing some helpers, and since it ends in `_test.go`, it is not exported.

Proposal: renaming the file.
Pretty sure some things in README.md that previously rendered properly but were invalid Markdown syntax were broken when GitHub transitioned from Sundown to `cmark`. [More information is available here](https://githubengineering.com/a-formal-spec-for-github-markdown/).

This PR corrects the syntax errors and ensures that viewing the README.md on GitHub.com now correctly renders everything.
I have post request middleware that looks at presence of errors on the context. And is there are errors, I'm creating specific JSON response that complies with our defined contract.

It mostly works for everything as I use c.Abort() method across my application.

I'm trying to use BingJSON method to parse request body, and when it fails it will write 400 error code onto response and prevents me from changing response header later.

Here is where it is happening:
[https://github.com/gin-gonic/gin/blob/32cab500ecc71d2975f5699c8a65c6debb29cfbe/context.go#L333](https://github.com/gin-gonic/gin/blob/32cab500ecc71d2975f5699c8a65c6debb29cfbe/context.go#L333)

For now I have implemented helper function that does safe bind for me:
```go
func SafeJSONBind(obj interface{},c *gin.Context) error {
	if err := binding.JSON.Bind(c.Request, obj); err != nil {
		return err
	}
	return nil
}
``` 

But it would be nice to have option to perform bind that does c.Abort() instead of c.AbortWithError()

fix #838 
fix #830
GetHeader is a shortcut for c.Request.Header.Get(key)

It gets the header in the request.

If there are no such header, it will just return "".
Signed-off-by: Bo-Yi Wu <appleboy.tw@gmail.com>
Middleware - 
```go
func middleware() gin.HandlerFunc {
	return func(c *gin.Context) {
                //.....
                //.....
                //.....
                //.....
		c.Set("someKey", someValue)
		log.WithFields(log.Fields{
			"someKey": someValue,
		}).Infof("Middleware call")
		c.Next()
	}
}
```

Some handler that uses the middleware - 
```go
func someHandler(c *gin.Context) {
            //.....
           // Panic is being thrown sometimes
            c.MustGet("someKey")
            //.....
}
```

This results (Sometimes) in panic, for no apparent reason as I can clearly see the logging line with the expected values.
``time="2017-03-15T08:08:05Z" level=info msg="Middleware call" someKey=someValue``

cc @tboerger @javierprovecho 

Can use like this?
c.HTML(http.StatusOK, template.ParseFiles("index.tmpl", "layout.tmpl"), gin.H{
    "title": "Users",
})
I have struct bellow 
```
type foos struct { Foo string `json:"foo" binding:"required"`}
```

and I have endPoint bellow, 

```
func sendFoo(c *gin.Context) {
    var json *foos

   if err := c.BinJSON(&json); err != nil {
          c.AbortWithStatus(400)
          return
   }
   
    // DO another about foo
}
```

I post JSON to endpoint bellow 
`{"bar":"bar bar"}`

But the err is always nil. 

But when I do 
```
func sendFoo(c *gin.Context) {
    var json foos

   if err := c.BinJSON(&json); err != nil {
          c.AbortWithStatus(400)
          return
   }
   
    // DO another about foo
}
```

the err is not nil.

Why ? Please explain to me.
Hi Guys,

May I know how to read the request header from gin context ? It seems there is only a write header function in the document.

Thanks in advance.
I am using log.Println() inside the router callback functions to print debug messages. These get printed to console but they don't have timestamps. How do I enable it log timestamps? 
I upgrade by `go get -u` these days.
After that build failed.

```
# gopkg.in/gin-gonic/gin.v1
../../../gopkg.in/gin-gonic/gin.v1/context.go:498: cannot use sse.Event literal (type sse.Event) as type render.Render in argument to c.Render:
	sse.Event does not implement render.Render (missing WriteContentType method)
```

How can I handle it?

Error occur here.
```
// SSEvent writes a Server-Sent Event into the body stream.
func (c *Context) SSEvent(name string, message interface{}) {
	c.Render(-1, sse.Event{
		Event: name,
		Data:  message,
	})
}
```
parameter of c.Render is `render.Render`
```
func (c *Context) Render(code int, r render.Render) {
	c.Status(code)
	if err := r.Render(c.Writer); err != nil {
		panic(err)
	}
}
```

This struct has 2 funcs
```
type Render interface {
	Render(http.ResponseWriter) error
	WriteContentType(w http.ResponseWriter)
}
```

However `sse.Event` doens't have `WriteContentType`

```go
package main

import "gopkg.in/gin-gonic/gin.v1"

func main() {
    r := gin.Default()
    r.Use(func(c *gin.Context) {
        c.Next()
        c.Set("fake-header", "fake")
    })
    r.GET("/ping", func(c *gin.Context) {
        c.JSON(200, gin.H{
            "message": "pong",
        })
        c.String(200, "vdvfgbf")
    })
    r.Run() // listen and serve on 0.0.0.0:8080
}
```

I know this operation ` c.Set("fake-header", "fake")`  will fail, the `fake-header` will store in response's `trailer` if we ` c.Set("trailer", "fake-header")`. 

but now i want to set header after write to response, how can i achieve this? @appleboy 
Anyone know how to add a cache-busting strategy for static assets? For instance js & css asset links would render like `script src="app.1449087601.js"` when output to html, but that file would route to the static file app.js. Static file support in gin does not seem to support regex matching, as in other (lesser!) web frameworks. Thanks!




I wrote a simple reverse proxy with Gin. The code is listed below.
```
func NewMultiHostProxy(target_urls []string) gin.HandlerFunc {
    var urls []*url.URL
    for i := 0; i < len(target_urls); i++ {
        target, err := url.Parse(target_urls[i])
        if err != nil {
            fmt.Errorf("Error parsing url")
            return nil
        }
        urls = append(urls, target)
    }
    return func(c *gin.Context) {
        director := func(req *http.Request) {
            target := urls[rand.Int()%len(urls)]
            req.URL.Scheme = target.Scheme
            req.URL.Host = target.Host
            req.URL.Path = target.Path
            req.Header.Set("X-GoProxy", "GoProxy")
            if target.RawQuery == "" || req.URL.RawQuery == "" {
                req.URL.RawQuery = target.RawQuery + req.URL.RawQuery
            } else {
                req.URL.RawQuery = target.RawQuery + "&" + req.URL.RawQuery
            }
            log.Print(req.URL)
        }
        proxy := &httputil.ReverseProxy{Director: director}
        proxy.ServeHTTP(c.Writer, c.Request)
    }
}
```
1. When I try to send GET request to it, the request is successfully sent over to a remote server. However, although the url is correct, it returns 404 and Nginx in remote server log 404 as well.
2. When I try to send POST request to it, golang complains `http: proxy error: http: ContentLength=452831 with Body length 0`

May I know what may cause this problem?
I'm trying to send file + some other field  and read via c.Bind:
 ```
type MyForm struct {
	Field1	int		`json:"field1" form:"field1" validate:"required"`
}
params := MyForm{}
if err := c.Bind(&params); err != nil {
    return nil, err
}
```
All works fine if send request via curl, but Postman or other similar tools got error:
`invalid URL escape "%\x1f\x1a"`

here is a request body from postman:
```
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW
Cache-Control: no-cache
Postman-Token: 78ac5597-fdcc-1cb8-0e61-9b62ceb68994

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="field1"

1
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="fileupload"; filename=""
Content-Type: 


------WebKitFormBoundary7MA4YWxkTrZu0gW--
```
when test logger middleware, should reset buffer before perform a request, otherwise may have influence on the rest test.

issue discovered by @sgon00 at gitter
@appleboy hi, I have some doubts about your code of "gin/examples/graceful-shutdown/graceful-shutdown/server.go". when i run this code, and send a signal as "kill -2 9604" (note that, 9604 is the pid, 2 is the interrupt signal), but there has no any log information shown on the pc screen. But in your code, when interrupt signal is emit, there would show logs, like log.Println("Shutdown Server ..."), log.Println("Server exist").  So can you help me with this doubt? thanks a lot.

_First of all thanks for this awesome project thats so much useful_
In your example 
```
 // Binding from JSON 
  type Login struct {
	User     string `form:"user" json:"user" binding:"required"`
	Password string `form:"password" json:"password" binding:"required"`
  }
```
 we can see a field `binding:"required"` but it seems like not documented. Could you please update the doc to include what are the _other_ supported options.

Also I 'am new to Go, so don't know if this is stupid, but why does the elements of the Login struct must start with a _capital_ letter?
Right-justified benchmarks data for reading.
#1010 
fix #1008
A change that was made on July 8th (commit 12508320c2834204677e29be58fec8103facdaf8) where you replaced json lib with jsoniter is now resulting in a panic being thrown (already in capture mode).

```
/home/dev1/Projects/Go/src/github.com/json-iterator/go/feature_iter_skip.go:47
/home/dev1/Projects/Go/src/github.com/json-iterator/go/feature_iter_skip.go:35
/home/dev1/Projects/Go/src/github.com/json-iterator/go/feature_reflect_native.go:626
/home/dev1/Projects/Go/src/github.com/json-iterator/go/feature_reflect_struct_decoder.go:909
/home/dev1/Projects/Go/src/github.com/json-iterator/go/feature_reflect_struct_decoder.go:765
/home/dev1/Projects/Go/src/github.com/json-iterator/go/feature_reflect.go:86
/home/dev1/Projects/Go/src/github.com/json-iterator/go/feature_reflect_slice.go:101
/home/dev1/Projects/Go/src/github.com/json-iterator/go/feature_reflect_slice.go:82
/home/dev1/Projects/Go/src/github.com/json-iterator/go/feature_reflect_struct_decoder.go:909
/home/dev1/Projects/Go/src/github.com/json-iterator/go/feature_reflect_struct_decoder.go:444
/home/dev1/Projects/Go/src/github.com/json-iterator/go/feature_reflect.go:216
/home/dev1/Projects/Go/src/github.com/json-iterator/go/feature_adapter.go:74
/home/dev1/Projects/Go/src/github.com/gin-gonic/gin/binding/json.go:29
autogenerated:5
/home/dev1/Projects/Go/src/github.com/gin-gonic/gin/context.go:467
/home/dev1/Projects/Go/src/github.com/gin-gonic/gin/context.go:456
/home/dev1/Projects/Go/src/github.com/gin-gonic/gin/context.go:449
```

Rolling back to the commit before has the code working with no panic. Below is an example JSON payload that results in the panic:
```json
{
	"agency": null,
	"candidateId": 0,
	"candidate": "Blah Blah",
	"bookingId": 0,
	"shiftId": 1,
	"shiftTypeId": 0,
	"shift": "Standard",
	"bonus": 0,
	"bonusNI": 0,
	"days": [],
	"totalHours": 27,
	"expenses": [],
	"weekEndingDateSystem": "2016-10-09",
	"weekEndingDateClient": "2016-10-09",
	"submittedAt": null,
	"submittedById": null,
	"approvedAt": "2016-10-10T18:38:04Z",
	"approvedById": 0,
	"authorisedAt": "2016-10-10T18:38:04Z",
	"authorisedById": 0,
	"invoicedAt": "2016-10-10T20:00:00Z",
	"revokedAt": null,
	"revokedById": null,
	"revokeReason": null,
	"rejectedAt": null,
	"rejectedById": null,
	"rejectReasonCode": null,
	"rejectReason": null,
	"createdAt": "2016-10-03T00:00:00Z",
	"updatedAt": "2016-11-09T10:26:13Z",
	"updatedById": null,
	"overrides": [],
	"bookingApproverId": null,
	"bookingApprover": null,
	"status": "approved"
}
```

So much for being a "100% compatible drop in replacement" - surely the fact the next few commits had to go and change tests to make them work should've been a clue that something wasn't right?
Fix #1000 discuss.
i have occurred an error in using json-iterator
https://github.com/json-iterator/go/issues/129
```go
var server *gin.Engine = gin.Default()
server.Use(func(c *gin.Context) {
		if true { // if error
                        // ioutil.ReadAll (c.Request.Body)
			c.String(401, "Insufficient permissions")
			c.Abort()
		} else {
			c.Next()
		}
	})
// When the client to upload files (test size more than >1M),
// middleware cannot normal response
// When I use ioutil.ReadAll (c.Request.Body), everything was normal
```

does gin have filters ?  like Java Web
i didn't found any answer for this issue .
I am trying to call simple API, but it `redirecting request 307` . and the request fail on client side .
as you see in the first screen shot there is 3 requests . first one is option with `Status Code:200 OK` .
the next 2 requests with `Status Code:307 Temporary Redirect`
port 3030 is server
port 8100 is client 
CORS middleware is [gin-cors](https://github.com/itsjamie/gin-cors)

![image](https://user-images.githubusercontent.com/7817756/28049448-c65bc4be-65f7-11e7-8711-c2f6f7ac00a0.png)

![image](https://user-images.githubusercontent.com/7817756/28049470-ec6c8db4-65f7-11e7-9d94-40801228bed6.png)

![image](https://user-images.githubusercontent.com/7817756/28049481-f928298c-65f7-11e7-9029-95a1d59b79fa.png)



and this is the code 
```go
// Creates a gin router with default middleware:
	router := gin.Default()
	// Apply the middleware to the router (works with groups too)
	router.Use(cors.Middleware(cors.Config{
		Origins:        "*",
		Methods:        "GET, PUT, POST, DELETE",
		RequestHeaders: "Origin, Authorization, Content-Type",
		ExposedHeaders: "",
		MaxAge: 300 * time.Second,
		Credentials: false,
		ValidateHeaders: false,
	}))

       router.POST("/api/v1/login", usersController.Login)
```
client side error 
```
XMLHttpRequest cannot load http://localhost:3030/api/v1/login/. Redirect from
 'http://localhost:3030/api/v1/login/' to 'http://localhost:3030/api/v1/login' has been blocked by CORS 
policy: No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 
'http://localhost:8100' is therefore not allowed access.

```

it works fine on postman 
 test failed, see https://github.com/json-iterator/go/issues/126

- [TestRenderIndentedJSON](https://github.com/gin-gonic/gin/blob/master/render/render_test.go#L55)
<img width="629" alt="2017-07-11 8 43 22" src="https://user-images.githubusercontent.com/8943871/28048499-e98dc1c2-6623-11e7-8b7b-9aa5c03fbc7f.png">

Hi,

Why do you use 64 Encryption and not 256?
For authentication

Thanks.


fix #988

Signed-off-by: Bo-Yi Wu <appleboy.tw@gmail.com>

resolve #368  
I added an option EnableJsonDecoderUseNumber, so that you can choose whether or not to enable UseNumber in the JSON decoder.
Please review. 

I post below json to server, but I do not know how to parse it to struct.
```json
{
	"11": {"timestamp": 1499540917481, "heart_strength": 417},
	"10": {"timestamp": 1499540917471, "heart_strength": 424}
}
```

I try below code:
```go
type HeartStrength struct {
	ID            int64 `json:"id"`
	Timestamp     int64 `json:"timestamp"`
	HeartStrength int16 `json:"heart_strength"`
}

type HeartStrengthArray struct {
	Array map[string]HeartStrength
}

r := gin.Default()
r.POST("/data/heartstrength", postHeartStrengthData)
func postHeartStrengthData(c *gin.Context) {
	var heartSA HeartStrengthArray
	if err := c.BindJSON(&heartSA); err != nil {
		logrus.Warnf("parse heartstrength map from http post request error: %v", err)
		c.JSON(http.StatusBadRequest, gin.H{
			"message": "parse heartbeat from http post request error",
		})
		return
	}

	logrus.Info(heartSA)

	c.JSON(http.StatusOK, gin.H{
		"message": "ok",
	})
}
```
printed heartSA is 
```
INFO[0216] {map[]} 
```
So may somebody help me, thanks very much!
#129 

#991 
Copying my comment on commit https://github.com/gin-gonic/gin/commit/ad087650e9881c93a19fd8db75a86968aa998cac

It broke compatibility with rendering some structs to JSON

We have a struct with non-exportable field tagged as `json:"-"`

All works on last commit c4249f923fc7b0
but after merging this it broke. 
```
2017/07/08 14:52:46 [Recovery] panic recovered:
GET /user?id=106848 HTTP/1.1
Host: 127.0.0.1:41184
Accept-Encoding: gzip
User-Agent: Go-http-client/1.1
User-Token: 106848V2Z1akVxa1NsMVdZUUFIRzNSSlNudGZiaGkyV01nc09sMlltQTlUeW9sWG


[optional]: [user.User]: [optional]: [gorm.DB]: [optional]: [gorm.search]: [optional]: [gorm.DB]: [optional]: [gorm.Callback]: [slice]: [optional]: unsupported type: func(*gorm.Scope)
/usr/local/go/src/runtime/panic.go:443 (0x42db99)
	gopanic: reflectcall(nil, unsafe.Pointer(d.fn), deferArgs(d), uint32(d.siz), uint32(d.siz))
/home/felian/go_code/src/github.com/gin-gonic/gin/render/json.go:33 (0x82fa57)
	JSON.Render: panic(err)
<autogenerated>:10 (0x83191a)
/home/felian/go_code/src/github.com/gin-gonic/gin/context.go:598 (0x66c46a)
	(*Context).Render: if err := r.Render(c.Writer); err != nil {
/home/felian/go_code/src/github.com/gin-gonic/gin/context.go:629 (0x66c7f2)
	(*Context).JSON: c.Render(code, render.JSON{Data: obj})
/home/felian/go_code/src/bitbucket.org/betscase/user-service/api.go:386 (0x4828fe)
	apiGetUser: c.JSON(http.StatusOK, user)
/home/felian/go_code/src/github.com/gin-gonic/gin/context.go:110 (0x66951a)
	(*Context).Next: c.handlers[c.index](c)
/home/felian/go_code/src/github.com/gin-gonic/gin/recovery.go:45 (0x67f491)
	RecoveryWithWriter.func1: c.Next()
/home/felian/go_code/src/github.com/gin-gonic/gin/context.go:110 (0x66951a)
	(*Context).Next: c.handlers[c.index](c)
/home/felian/go_code/src/github.com/gin-gonic/gin/logger.go:82 (0x67e702)
	LoggerWithWriter.func1: c.Next()
/home/felian/go_code/src/github.com/gin-gonic/gin/context.go:110 (0x66951a)
	(*Context).Next: c.handlers[c.index](c)
/home/felian/go_code/src/github.com/gin-gonic/gin/gin.go:337 (0x6735cd)
	(*Engine).handleHTTPRequest: context.Next()
/home/felian/go_code/src/github.com/gin-gonic/gin/gin.go:301 (0x673017)
	(*Engine).ServeHTTP: engine.handleHTTPRequest(c)
/usr/local/go/src/net/http/server.go:2081 (0x621bee)
	serverHandler.ServeHTTP: handler.ServeHTTP(rw, req)
/usr/local/go/src/net/http/server.go:1472 (0x61e43e)
	(*conn).serve: serverHandler{c.server}.ServeHTTP(w, w.req)
/usr/local/go/src/runtime/asm_amd64.s:1998 (0x460b61)
	goexit: BYTE	$0x90	// NOP
```
A high-performance 100% compatible drop-in replacement of "encoding/json"

https://github.com/json-iterator/go

cc @javierprovecho @tboerger 

Signed-off-by: Bo-Yi Wu <appleboy.tw@gmail.com>

Hi,
I'm using `gin.Default()` and when I'm sending request,
`curl http://localhost:3002/api/v1/someresource?first_name=firstName&last_name=LastName`

then I'm getting next logger's output:
`[GIN] 2017/07/08 - 09:12:22 | 500 |    1.259747ms | 127.0.0.1 |   GET     /api/v1/someresource`
But logger not shows query string parameters, if they exists in request
will be better to log query completely, instead of overriding Default logger, right?
`[GIN] 2017/07/08 - 09:12:22 | 500 |    1.259747ms | 127.0.0.1 |   GET     /api/v1/someresource?first_name=firstName&last_name=LastName`

Implement https://github.com/gin-gonic/gin/issues/433, `SecureJSON` default prepends "while(1)," to response body if the given struct is array values. Examples are shown below:

```go
package main

import (
	"github.com/gin-gonic/gin"
	"net/http"

)
func main() {
	r := gin.Default()
	// r.SecureJsonPrefix(")]}',\n")  // Default "while(1);"

	r.GET("/someJSON", func(c *gin.Context) {
		fruit := []string{"apple", "peach", "pear"}

		// Will output  :   while(1);["apple","peach","pear"]
		c.SecureJSON(http.StatusOK, fruit)
	})
	
	r.Run(":8080")
}
```
Please review and advise, thanks.

I'd like to print up stickers of the logos of popular Go projects for GopherCon. Is it ok if I print up Gin stickers? I didn't see any guidelines or licensing for the logo. 
Thanks!


same as #975


ref: https://codecov.io/gh/gin-gonic/gin/src/master/gin.go#L349
This snippet have already passed by test coverage.



I have read some source codes of official go, I not found it use nesting `type` to define `struct` or `interface`, so commit this pr, thanks!
And it's better to avoid unnecessary indentation.

 Sometimes travis will build error because `TestDebugPrintLoadTemplate` templates print-order not guaranteed.

travis ref:
- https://travis-ci.org/gin-gonic/gin/jobs/249505506
- https://travis-ci.org/gin-gonic/gin/jobs/249296346
- https://travis-ci.org/gin-gonic/gin/jobs/249505506
fix https://github.com/gin-gonic/gin/issues/971
https://github.com/gin-gonic/gin/blob/master/examples/upload-file/single/main.go

Is missing error handling IIUC.

Here is an example with error handling: https://github.com/kaihendry/go-upload/blob/master/main.go


One reqeust, one goroutine?
Error : github.com\gin-gonic\gin\logger.go:61: undefined: isatty.IsCygwinTerminal

System:windows amd64

run code:
```
package main

import "github.com/gin-gonic/gin"

func main() {
	r := gin.Default()
	r.GET("/ping", func(c *gin.Context) {
		c.JSON(200, gin.H{
			"message": "pong",
		})
	})
	r.Run() // listen and serve on 0.0.0.0:8080
}
```
The following code fails with an `invalid memory address or nil pointer dereference error`. The use case is I need to send all requests through a queue, to ensure file operations occur in the right order. However, I cannot send the copy of the `gin.Context` to the channel. I have also tried sending a callback function (that invokes the `gin.Context`) with the same results.

```go
package main

import "net/http"
import "github.com/gin-gonic/gin"

func main() {
  router := gin.Default()
  queue := make(chan *gin.Context)
  go func() {
    for {
      c := <-queue
      c.String(http.StatusOK, "")
    }
  }()

  router.GET("/", func(c *gin.Context) {
    queue <- c.Copy()
  })

  router.Run(":8080")
}

```
https://github.com/gin-gonic/autotls/pull/1
fix travis build error.
https://github.com/gin-gonic/gin/pull/871
Now templates (function maps for helpers) can be better configured and we can keep the reload on request of the templates.
for debugging my program, I need to logging request body so write the below middleware
but it's wasn't called by gin

gin version f931d1ea80ae95a6fc739213cdd9399bd2967fb6

```go
type MyReadCloser struct {
	rc io.ReadCloser
	w  io.Writer
}

func (rc *MyReadCloser) Read(p []byte) (n int, err error) {
	n, err = rc.rc.Read(p)
	log.Println("run here", n, err)
	if n > 0 {
		if n, err := rc.w.Write(p[:n]); err != nil {
			return n, err
		}
	}
	return n, err
}

func (rc *MyReadCloser) Close() error {
	return rc.rc.Close()
}

func DebugLogger() gin.HandlerFunc {
	return func(c *gin.Context) {
		log.Println(c.Request.RequestURI)
		if c.Request.Method == http.MethodPost {
			var buf bytes.Buffer
			newBody := &MyReadCloser{c.Request.Body, &buf}
			c.Request.Body = newBody
			c.Next()
			log.Println(buf.String())
		} else {
			c.Next()
		}
	}
}

r := gin.New()
if cfg.Debug {
    r.Use(middleware.DebugLogger())
}
```
go git go get gopkg.in/gin-gonic/gin.v1 ?

When i do like this ,one error happen , operate in china

$ go get gopkg.in/gin-gonic/gin.v1
# cd .; git clone https://go.googlesource.com/net E:\Go\src\golang.org\x\net
Cloning into 'E:\Go\src\golang.org\x\net'...
fatal: unable to access 'https://go.googlesource.com/net/': Failed to connect to go.googlesource.com port 443: Timed out
package golang.org/x/net/context: exit status 128

Hi, I would like to build up with gin a REST-service, where the version of the API will be included in the "Content-Type" of the requests. 
Like: 
# Request
GET http://api.example.com/users/12345
Accept: application/json; version=1
# Response
HTTP/1.1 200 OK
Content-Type: application/json; version=1
{“id”:”12345”, “name”:”Joe DiMaggio”}

What is the best (performance) way, to look for the version in the request with gin?
Is something like v1 := r.Group("/rest/v1") possible?

Thanks
Juergen
I am having a difficult time figuring out how I would implement another library's non-gin middlware. The function in question takes an `http.Handler` input parameter similar to:`func Something(handler http.Handler) http.Handler{...}`

Thanks!


I have this routes:
```go
r.GET("/drivers/price", ctrl.GetDriversPrice)
r.GET("/drivers/:id", ctrl.GetDriver)
```

So when I call http://.../drivers/price, I'm routed to ctrl.GetDriver. How can I make to get routed to ctrl.GetDriversPrice?
#go version
go version go1.8.3 linux/amd64

#go env
GOARCH="amd64"
GOBIN=""
GOEXE=""
GOHOSTARCH="amd64"
GOHOSTOS="linux"
GOOS="linux"
GOPATH="/home/mars/golang"
GORACE=""
GOROOT="/usr/local/go"
GOTOOLDIR="/usr/local/go/pkg/tool/linux_amd64"
GCCGO="gccgo"
CC="gcc"
GOGCCFLAGS="-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build425550925=/tmp/go-build -gno-record-gcc-switches"
CXX="g++"
CGO_ENABLED="1"
PKG_CONFIG="pkg-config"
CGO_CFLAGS="-g -O2"
CGO_CPPFLAGS=""
CGO_CXXFLAGS="-g -O2"
CGO_FFLAGS="-g -O2"
CGO_LDFLAGS="-g -O2"

the panic (copy the console):

2017/06/17 06:43:46 [Recovery] panic recovered:
GET /product/id/11 HTTP/1.1
Host: 192.168.110.236
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,/;q=0.8
Accept-Encoding: gzip, deflate, sdch
Accept-Language: zh-CN,zh;q=0.8
Connection: keep-alive
Cookie: mysession=MTQ5NzY1MzAxMdfdfdsjkdjkKkjJKJKNsSkKKSJKJSjkJSWFJsVmFVak5YVVU5TlFWazNTVFpNTlZaWFdsZEpVVXBhU1RNMFZGWXpWRVJSU0VwVVdGRldOVkU9fOijIk3QpNWNVqZdB-nEMgXnCaaX0wh9BR3_7FfFnDfm; user_sess=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE0OTc3Mzk0MTgsInkkjkJLKhhjHJHKKhkLjkjbSIsGFGFGVvbvvgInR5cGUiOiJzZXNzIn0.zF3jAfaqnHX0TyrbohxpKtpQ5LbDL9k97qF3QjhGRbQ
Referer: http://192.168.110.236/user/workspace
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.221 Safari/537.36 SE 2.X MetaSr 1.0

html/template:product.html: "<" in attribute name: " <#if(j==statuses[i].Value_type)"
/usr/local/go/src/runtime/panic.go:489 (0x42bd9f)
gopanic: reflectcall(nil, unsafe.Pointer(d.fn), deferArgs(d), uint32(d.siz), uint32(d.siz))
/home/mars/golang/src/github.com/gin-gonic/gin/context.go:428 (0xa06c8f)
(*Context).Render: panic(err)
/home/mars/golang/src/github.com/gin-gonic/gin/context.go:437 (0xa06d30)
(*Context).HTML: c.Render(code, instance)
/home/mars/golang/src/github.com/PandoCloud/pando-cloud/services/wwwhost/actions.go:259 (0xa4023f)
GetProductById: r.HTML(http.StatusOK, "product.html", prod)
/home/mars/golang/src/github.com/gin-gonic/gin/context.go:97 (0xa052ea)
(*Context).Next: c.handlersc.index
/home/mars/golang/src/github.com/PandoCloud/pando-cloud/services/wwwhost/middleware.go:112 (0xa4f8f9)
ValidateProductBelong.func1: r.Next()
/home/mars/golang/src/github.com/gin-gonic/gin/context.go:97 (0xa052ea)
(*Context).Next: c.handlersc.index
/home/mars/golang/src/github.com/PandoCloud/pando-cloud/services/wwwhost/middleware.go:253 (0xa50cf2)
MustUser.func1: c.Next()
/home/mars/golang/src/github.com/gin-gonic/gin/context.go:97 (0xa052ea)
(*Context).Next: c.handlersc.index
/home/mars/golang/src/github.com/PandoCloud/pando-cloud/services/wwwhost/middleware.go:205 (0xa50a65)
SetUser.func1: c.Next()
/home/mars/golang/src/github.com/gin-gonic/gin/context.go:97 (0xa052ea)
(*Context).Next: c.handlersc.index
/home/mars/golang/src/github.com/gin-contrib/sessions/sessions.go:65 (0xa175a4)
Sessions.func1: c.Next()
/home/mars/golang/src/github.com/gin-gonic/gin/context.go:97 (0xa052ea)
(*Context).Next: c.handlersc.index
/home/mars/golang/src/github.com/gin-gonic/gin/recovery.go:45 (0xa1468a)
RecoveryWithWriter.func1: c.Next()
/home/mars/golang/src/github.com/gin-gonic/gin/context.go:97 (0xa052ea)
(*Context).Next: c.handlersc.index
/home/mars/golang/src/github.com/gin-gonic/gin/logger.go:72 (0xa1395f)
LoggerWithWriter.func1: c.Next()
/home/mars/golang/src/github.com/gin-gonic/gin/context.go:97 (0xa052ea)
(*Context).Next: c.handlersc.index
/home/mars/golang/src/github.com/gin-gonic/gin/gin.go:284 (0xa0b480)
(*Engine).handleHTTPRequest: context.Next()
/home/mars/golang/src/github.com/gin-gonic/gin/gin.go:265 (0xa0ad9b)
(*Engine).ServeHTTP: engine.handleHTTPRequest(c)
/usr/local/go/src/net/http/server.go:2568 (0x68ca62)
serverHandler.ServeHTTP: handler.ServeHTTP(rw, req)
/usr/local/go/src/net/http/server.go:1825 (0x688c62)
(*conn).serve: serverHandler{c.server}.ServeHTTP(w, w.req)
/usr/local/go/src/runtime/asm_amd64.s:2197 (0x45a791)
goexit: BYTE	$0x90	// NOP

the go code:
func GetProductById(r *gin.Context) {
authUser := GetCUser(r)
authProdouct := GetCProduct(r)
prod := &ProductResponse{}
prod.Navi.Workspace = true
prod.Navi.Username = authUser.Username
prod.Navi.UserAvatar = authUser.Avatar
prod.Product = *authProdouct
prod.Csrf, _ = token.New(token.CsrfToken, authUser.Username).Sign(authUser.AppKey)
//fmt.Println(prod.Product)
r.HTML(http.StatusOK, "product.html", prod)
return
}

I'm not sure that this is not related to gin, but certainly with the template rendering or symbol filtering has a relationship, I do not know the template rendering the underlying code is in gin or in the go itself. The same gin project I did not change any data, but in the 1.7rc6 version of the very good work.



For example, I allow up to 2000 current  connections and reject excess requests.
I looks like there has been tons and tons of work done since the last release. Great job everybody!

Would it be possible to get a new version released? There is a lot of incompatibility with 1.14 and it would be great to not have to always use the develop branch.

Thanks!
Hi, I made a few changes to this code to make it work with gin-gonic, do you know what's going on?

https://stackoverflow.com/questions/44641773/gin-gonic-and-gorilla-websocket-does-not-propagate-message

https://github.com/utiq/go-in-5-minutes/tree/master/episode4
Fix for #852 - removes panics from closed streams and returns errors.

Currently a single broken pipe can bring down an entire server serving thousands of requests. The panic is too aggressive, and requires attempting to recover on every single request/response pair.

Mostly open for discussion, but I'd like to see the panics removed at this level. Thanks!


When I run this service on OS X, output is as expected, but in Windows there are characters that are unable to be displayed. 

Windows 10

```
[GIN-debug] Listening and serving HTTP on 127.0.0.1:6969
[GIN] 2017/06/13 - 13:42:26 |[97;43m 404 [0m|            0s | 127.0.0.1 |[97;44m  [0m GET     /c
[GIN] 2017/06/13 - 13:42:30 |[97;43m 404 [0m|       501.3µs | 127.0.0.1 |[97;44m  [0m GET     /favicon.ico
[GIN] 2017/06/13 - 13:43:26 |[97;42m 200 [0m|            0s | 127.0.0.1 |[97;44m  [0m GET     /api/v1/c
```
![image](https://user-images.githubusercontent.com/4325375/27096287-952a6450-503e-11e7-92ba-4d1e534e4607.png)



* vet check
* fmt check
* embedmd check
* misspell check

fix #946 

Signed-off-by: Bo-Yi Wu <appleboy.tw@gmail.com>
use go fmt cmd

#871 

Unify license to MIT license, but I am not sure, please review, thanks.
Unify license to MIT license, but I am not sure, please review.


### Here is the src code:
github.com/gin-gonic/gin/binding/form_mapping.go
![This code for binding string is maybe too simple.](https://user-images.githubusercontent.com/18651103/27008722-fbe0b62e-4eac-11e7-9f49-7365727694d8.jpeg)
Hope to make this code more stronger.
For example,
If I register a router method:

    r.GET("/users/:user_id", user_get)

at runtime I can retrieve string "/users/:user_id" ?

Thanks in advance
Franco
fix https://github.com/gin-gonic/gin/issues/873
On https://github.com/gin-gonic/gin/blob/master/gin.go#L272, handleHTTPRequest uses URL.Path to determine the route. 
```
func (engine *Engine) handleHTTPRequest(context *Context) {
	httpMethod := context.Request.Method
	path := context.Request.URL.Path
```
 This means that visiting `/route/encoded%2Fpath/another/route` will attempt to route with `/route/encoded/path/another/route`, which will break routing if it expected to have a route of the form `/route/:path/another/route`. I suppose it's possible that this is intended behavior, but I believe there are real use cases where passing an encoded path as a path parameter is useful. Using `URL.EscapedPath()` instead of `URL.Path` would allow encoded paths to be used as parameters.
Hello, someone could show me what the best way to simulate httputil.DumpResponse?
T.i.a
Franco

I'm opening the sqlite database in the main function
```
db, err := sql.Open("sqlite3", "./libreread.db")
CheckError(err)
defer db.Close()
```

And I have these router handlers
```
r.GET("/", GetHomePage)
r.GET("/signin", GetSignIn)
r.POST("/signin", PostSignIn)
...
```

How to pass that db value through the router handler `func PostSignin(c *gin.Context)` ?

So that I could avoid opening and closing the database each time in the functions.

Thanks!
When I use JSON.stringify in JS to send form values via fetch which makes the body like so 
```json
{"email": "vivagorgonzola@yahoo.com", "pass": "ezioCalzone1994" }
```

I cant read it via ctx.PostForm("pass")

only If i did it like this
```
pass=ezioCalzone1994&email=vivagorgonzola%40yahoo.com
```
Fix #928 Method to get main handler is desired
Fix #928 Method to get main handler is desired
It's convenient to get request handler name by gin.Context.HandlerName, but it not always work well. In case that handler is installed with decorator wrapped, HanderName will return func1, which is meaningless.
`
r.GET("/foo", Decorator(Foo))
`
Since there's no way to get function name of wrapped func, it can resort to user passing this value explicitly. Something like r.GETEX("/foo", Decorator(Foo), "Foo")

Then I can save function point to name map on handler register and get handler name in middleware, 
as long as I can get FuncHandler with ctx.

So it's desired to add a method to return main handler.
This PR is about feat #856 to add tests.
I'm redirecting signin to home page when the user is already signed in. It shows this html element on the home page.

```html
<a href="/signin">Found</a> "."
```

How to disable that element from the app?

This is my app code.
```go
func GetSignIn(c *gin.Context) {
    // Get session from cookie. Check if email exists
    // redirect to Home page else show signin page.
    session := sessions.Default(c)
    if session.Get("email") != nil {
        fmt.Println(session.Get("email"))
        c.Redirect(302, "/")
    }
    c.HTML(200, "signin.html", "")
}
```
This PR is to solve: https://github.com/gin-gonic/gin/issues/922

I read the few posted issues regarding the use of context.Context with *gin.Context.  Maybe I'm missing something, but it seems the advice is to derive an AppEngine context from the gin.Context.  This generally works, but there seems to be no way to get the gin.Context back from the derived context.  I ended up changing the Value() method to the following:

```
func (c *Context) Value(key interface{}) interface{} {
	switch key {
	case -1:
		return c
	case 0:
		return c.Request
	}

	if keyAsString, ok := key.(string); ok {
		val, _ := c.Get(keyAsString)
		return val
	}
	return nil
}

```
Passing -1 to Value returns the gin.Context, which allows calling the various methods on the gin.Context (e.g., PostForm, Param, etc.)

Basically, my question is whether there is already to retrieve the *gin.Context from the AppEngine context derived from *gin.Context, without changing the existing code.
Hi, I'm the author of [Casbin](https://github.com/casbin/casbin). It is a Go authorization library that supports access control models like ACL, RBAC, ABAC.

Related to the most popular RBAC model, Casbin has several advantages:
1. roles can be cascaded, aka roles can have roles.
2. support resource roles, so users have their roles and resource have their roles too. role = group here.
3. the permission assignments (or policy in casbin's language) can be persisted in files or database.

The model in Casbin is very flexible and can easily adapt to certain scenarios by modifying the model file. Other features about Casbin please refer to: https://github.com/casbin/casbin

I found Gin has a middleware named ``BasicAuth``, but it is mainly authentication (AuthN) instead of authorization (AuthZ). I'd like to contribute to make an authorization middleware for Gin. But I don't know the correct process to do it. Also I want to hear your opinions first, please let me know if you have any questions or suggestions. Thanks!
Add content negotiation tests code coverage #871 
Hello,
I have created 2 functions in main function.
1) For my routing
2) For run cron
But my issue is: when cron is working then routing stop works.
If I commented the RunCron()	 function then NewRouter() function works perfectly.
If I put NewRouter() function  on top then RunCron()  stop working.
Please help me to figure what is the issue of routing with crons.
My code is below:
```
func main(){
     RunCron()	
     NewRouter()
} 
func RunCron(){
	c := cron.New()
	c.AddFunc("0 * * * * *", func() { fmt.Println("Run every minute") })
    go c.Start()
    sig := make(chan os.Signal)
    signal.Notify(sig, os.Interrupt, os.Kill)
    <-sig
}
func NewRouter(){
	router := gin.Default()
    router.GET("/ping", func(c *gin.Context) {
		c.JSON(200, gin.H{
			"message": "pong",
		})
	})
    router.Run(":8080")
    
}
```


I want to have an API that responds to this path: /admin/sipa/loadallstockinfo

For that I'm nesting a group into a group. My attempt fails with 404 though. [GIN] 2017/05/25 - 16:56:39 | 404 |         832ns | ::1 |   GET     /admin/sipa/loadallstockinfo

The url is registered:
[GIN-debug] POST   /admin/sipa/loadallstockinfo --> _/path/sipa.(*API).LoadAllStockInfoEndpoint-fm (4 handlers)

What can I do to properly accept these requests?

```
func HandleAPI() {
	sipaAPI := sipa.InitAPI()

	r := gin.Default()

	r.GET("/", func(c *gin.Context) {
		http.ServeFile(c.Writer, c.Request, "static/index.html")
	})

	r.Static("/assets", "static/assets")

	r.POST("/register", registerEndpoint)

	s := r.Group("sipa")

	s.Use(authHandler())
	{
		s.GET("/stock/:name", sipaAPI.StockEndpoint)
		s.GET("/gpi", sipaAPI.GPIEndpoint)
		s.GET("/active", sipaAPI.ActiveEndpoint)
	}

	a := r.Group("admin")

	a.Use(authHandler())
	{
		a.GET("/", func(c *gin.Context) {
			c.JSON(http.StatusOK, gin.H{"status": http.StatusOK})
		})
		as := a.Group("sipa")
		as.POST("/update", sipaAPI.UpdateEndpoint)
		as.POST("/loadallstockinfo", sipaAPI.LoadAllStockInfoEndpoint)
	}

	r.Run(config.Config.APIUrl)
}
```


## Description

I would like to bind a query parameter into a custom type (uuid.UUID).
Is there an interface to implement on custom type to support this ?

It works with json binding for example, as custom type implements Unmarshaler interface.

## How to reproduce

```
package main

import (
	"github.com/gin-gonic/gin"
	"github.com/google/uuid"
)

type ID uuid.UUID

type QueryStruct struct {
	MyID ID `form:"id"`
}

func main() {
	g := gin.Default()
	g.GET("/test", func(c *gin.Context) {
		var query QueryStruct
		if err := c.BindQuery(&query); err != nil {
			c.AbortWithError(400, err)
			return
		}
		c.String(200, "OK")
	})
	g.Run(":9000")
}
```

## Expectations

```
$ curl http://localhost:9000/test?id=46697e30-349e-4d21-b586-a18674e50385
OK
```

## Actual result

```
$ curl http://localhost:9000/test?id=46697e30-349e-4d21-b586-a18674e50385
["46697e30-349e-4d21-b586-a18674e50385"] is not valid value for main.ID
```

## Environment

- go version: 1.15.7
- gin version (or commit ref): 1.6.3
- operating system: darwin/amd64

package common

import (
	"ehiv/app/service"
	"ehiv/lib/response"
	"github.com/gin-gonic/gin"
	"github.com/small-ek/antgo/os/config"
	"log"
	"path/filepath"
)

//UploadFile 
func UploadFile(c *gin.Context) {
	var key = config.Decode().Get("file").Get("upload_file_Key").String()
	var path = config.Decode().Get("file").Get("path").String()
	// Source
	file, err := c.FormFile(key)
	if err != nil {
		response.Fail(c, "failed", err)
		return
	}
	log.Println(file.content)
	filepath.Base(file.Filename)
	//hash.Sha1(file.Filename)
	if err := c.SaveUploadedFile(file, path+file.Filename); err != nil {
		response.Fail(c, "failed", err)
		return
	}
	response.Success(c, "success", map[string]interface{}{
		"file_name": file.Filename,
	})
}
## Description

Per route middleware cannot abort even with 

```go
c.Abort()
return
```

## How to reproduce

```go
package middleware

func Login() gin.HandlerFunc {
	return func(c *gin.Context) {
		if err := CheckToken(...); err != nil {
			c.Abort()
			return
		}
		c.Next()
	}
}
```

```go
router.POST("/avatar", controller.UploadAvatar, middleware.Login())
```

## Expectations

should abort if login check failed

## Actual result

the request still went through the controller

## Environment

- go version: go1.14.14 
- gin version (or commit ref): 1.6.3
- operating system: darwin/amd64

## Description

Can you validate data inside a middleware handler? I'd like to do something like this:

``` go
func Binder(t reflect.Type) gin.HandlerFunc {
    return func(c *gin.Context) {
        obj := reflect.New(t).Elem().Interface()
        if err := c.BindQuery(&obj); err != nil {
            c.AbortWithStatus(http.StatusBadRequest)
            return
        }

        c.Set(t.Name(), obj)
    }
}
```

So that later on I could access, let's say, the query data validated to a struct named "Subject" (with gin bindings) by doing:

```go
sub := c.MustGet("Subject").(Subject)
```

Here what's happening is that `obj` is empty. Is this possible? If not by passing `reflect.Type`, could it be done using an interface object? (Maybe one that all types that require validation implement)
When the response has been written, the status code saved in `responseWriter`
should no longer be changed by subsequent calls to `WriteHeader()`.

This fixes for example the logging possibly showing the wrong status code, or
any other middleware function checking the status code.


## Description

Current versions of gin are affected by CVE-2020-28483.
https://nvd.nist.gov/vuln/detail/CVE-2020-28483

## How to reproduce

N/A

## Expectations

Looking for a new release of gin that resolves the identified vulnerability.

## Actual result

N/A

## Environment

- go version: 1.14.4 and higher
- gin version (or commit ref):
- operating system:


go get -u github.com/gin-gonic/gin 
above command doesn't work I decide change above to below in readme.md:
go get -v github.com/gin-gonic/gin
Hi, i wanna ask why is fiber framework faster than gin or beego ?  according to the info in this page: https://github.com/the-benchmarker/web-frameworks

Is it cuz the size of the framework ?

Will gin become as fast as fiber ?

Thank you for help and support.
Deleted redundant spaces
I want to use some original http server methods like func (s *Server) Shutdown(ctx context.Context),so i put the http server in the engine.





Your Bind Json, Should Bind, ShouldBindJSON etc etc things is waste of time, 

trying to get simple json body, it was simply done with net/http:

```
		var payload user
		err := json.NewDecoder(r.Body).Decode(&payload)
		if err != nil {
			log.Println(err)
			http.Error(w, err.Error(), http.StatusBadRequest)
			return
		}
```

but I HAVE TO SPEND ABOUT 1HOURS+ JUST FOR FINDING WHY MY GIN GOT 400 WITHOUT ANY MESSAGE ON SERVER SIDE
Current version of `decodeJSON()` is not checking the existence of foreign characters after the single JSON payload while decoding. On the other hand, `Unmarshal()` from the standard library has this functionality and returns error `invalid character 'h' after top-level value map[]`.

This PR will fix this problem, and `decodeJSON()` will return error **"invalid character after the JSON data"**. Important note - symbols `}` and `]` are ignored by this check.

Also, `TestJSONBindingBindBody()` was modified to provide testing of foreign symbols.


There are duplicate `assert.Equal(t, name, c.Param("name"))` lines in `TestRouteParamsByName` and `TestRouteParamsByNameWithExtraSlash` in `routes_test.go`, so I remove them.
The gin.Content.ShouldBindJSON not recognized the 'false' bool value. **Please see detail below:** 

## How to reproduce: 
```
package handler

import (
    "github.com/gin-gonic/gin"
    "net/http"
)

type prod struct {
    Disable bool `json:"disable" binding:"required"`
}

// New product
func NewProduct(c *gin.Context) {
    var p prod

    // Read request body
    if err := c.ShouldBindJSON(&p); err != nil {
        h := gin.H{"error":err.Error()}
        c.JSON(http.StatusOK, h)
        return
    }

    c.JSON(http.StatusOK, gin.H{"msg":"ok!"})
}
```

## Actual result
```
$ curl http://127.0.0.1:8080/v1/auth/products -X POST -d '{"disable": false}'
{"error":"Key: 'prod.Disable' Error:Field validation for 'Disable' failed on the 'required' tag"}

$ curl http://127.0.0.1:8080/v1/auth/products -X POST -d '{"disable": true}'
{"msg":"ok!"}
```
But the 1st reply is not what we expect.

## Environment

- go version: 1.14.13
- gin version (or commit ref): v1.6.3 using go mod
- operating system: macOS Mojave 10.14.6

After do
```
go get -u github.com/gin-gonic/gin
```
I use `gin.CustomRecovery`. But there are some errors here: CustomRecovery not declared by package gin.

Then I checked the local code, the version of gin is 1.6.3, same with here. But there is no `CustomRecovery` method in the recover.go file.

What can I do for this?
```
gin.H{"a":"a"}
+
gin.H{"b":"b"}
=
gin.H{"a":"a","b":"b"}
```

---

how to easy realization ??

```
func html(c *gin.Context, s string, o interface{}) {
        //   o + gin.H{"b":"b"}

       //o...........
	c.HTML(http.StatusOK, s, o)
}

// return {"a":"a","b":"b"} in html
func CIndexView(c *gin.Context) {
	html(c, "index_index.html", gin.H{
		"a":       "a",
	})
}

```
## Question
If there any bug on multipart form data file receiving? Browser on windows 10 cannot receive response correctly when use auth middleware to reject the request before execute any operational function.

## Description
- Env
Windows 10
Edge browser (Chromium)

- Process to error:
1. Big size file, over 2 MB
2. Uploading file with multipart form with any browser supported js function such as xhr, fetch or others
3. If server code do not process the received form data in handler, but return response directly such as when auth fails.
4. You will get connection_reset error on browser.

- Process to success:
Just change the place of return statement on server code to be after any codes that have processed the received data.

By the way, no problem if use curl to send request directly or use postman to help construct the request.

```
// c.ShouldBind(&obj)  -- before return, browser received 401 correctly
c.JSON(401, gin.H{"test": "test"})
return
// c.ShouldBind(&obj)  -- after return, which means server does not do anything about the post data, browser will get connection_reset error
```

## How to reproduce

- Server Side
<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
        "github.com/gin-contrib/cors"
        "mime/multipart"
	"net/http"
	"strings"
)

type ProfileForm struct {
	Files []*multipart.FileHeader `form:"files" binding:"required"`
	Json string                            `form:"json" binding:"required"`
}

func main() {
	router := gin.Default()
	router.Use(cors.New(cors.Config{
		AllowMethods:     []string{"PUT", "PATCH", "POST", "OPTIONS"},
		AllowHeaders:     []string{"Origin"},
		ExposeHeaders:    []string{"Content-Length"},
		AllowCredentials: true,
		AllowOriginFunc: func(origin string) bool {
			return true
		},
		MaxAge: 12 * time.Hour,
	}))

	// Set a lower memory limit for multipart forms (default is 32 MiB)
	router.MaxMultipartMemory = 8 << 20 // 8 MiB
	router.POST("/upload", func(c *gin.Context) {
		obj := ProfileForm{}

		if strings.Contains(c.GetHeader("content-type"), "multipart") {
			c.JSON(401, gin.H{"test": "test"})
			return
		}

		// Multipart form
		if err := c.ShouldBind(&obj); err != nil {
			c.JSON(406, gin.H{"error": err.Error()})
			return
		}

		form, _ := c.MultipartForm()
		files := form.File["upload[]"]

		for _, file := range files {
			log.Println(file.Filename)

			// Upload the file to specific dst.
			c.SaveUploadedFile(file, "./files")
		}
		c.String(http.StatusOK, fmt.Sprintf("%d files uploaded!", len(files)))
	})
	router.Run(":8080")

}
```

- Client Side
```
<!DOCTYPE html>
<body>
    <input type="file" id="file_upload">
    <button id="btn">send</button>
    <script>
        document.getElementById("btn").addEventListener("click", sendRequest);
        function sendRequest(){
            var data = new FormData()
            data.append("json", JSON.stringify(
                {"data": "test"}
            ))
            var file = document.getElementById("file_upload").files[0]
            data.append("files", file)
            var xhr = new XMLHttpRequest()
            xhr.onreadystatechange = function(){
                if (xhr.status === 200 && xhr.readyState === 4) {
                    console.log(xhr.responseText)
                } else{
                    console.log(xhr.responseText)
                }
            }
            xhr.open("post", "http://127.0.0.1:8080/upload")
            xhr.send(data)
        }
    </script>
</body>
```
Hi, I'm having a problem trying to define different middleware for different routes, please let me know if my understanding is correct and whether this behaviour is supported by the framework

Here it's mentioned that to use a middleware, application need to call `Engine.Use(middleware)`, which in turns call `engine.RouterGroup.Use(middleware)`
https://pkg.go.dev/github.com/gin-gonic/gin#Engine.Use

Here it's mentioned that application can define a *group of routes* that shares common middleware - which is what I want
https://pkg.go.dev/github.com/gin-gonic/gin#RouterGroup.Group

However the engine is only attached to one `RouterGroup`, so not sure how to define multiple `RouterGroup`s for an engine (and whether it's actually supported)
https://pkg.go.dev/github.com/gin-gonic/gin#Engine

Here it's mentioned that once `Run`, the engine will block the goroutine, so not sure if it's possible to define multiple engine, one per router group (and whether it's recommended to do so)
https://pkg.go.dev/github.com/gin-gonic/gin#Engine.Run
```
go version
go version go1.14.5 linux/amd64
```
gin version 1.6.3
// Version is the current gin framework's version.
const Version = "v1.6.3"

```
func Upload(ctx *gin.Context)  {
	// 单文件
	file, err := ctx.FormFile("file")
	fmt.Println(file, err)
}
```

file: test.yaml
```
{{- $app_name := .Values.application.name -}}

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cm-{{$app_name}}-config
data:
  components.php: |
    <?php

    $db = require(__DIR__ . '/db.php');

    $components = [

        'request' => [
            // !!! insert a secret key in the following (if it is empty) - this is required by cookie validation
            'cookieValidationKey' => '3zX3FVJW7jtWMyNc8mHOIiZPzjwh-XIu1',
        ],

        'cache' => [
            'class' => 'yii\caching\FileCache',
        ],

        'user' => [
            'identityClass'   => 'app\models\User',
            'enableAutoLogin' => true,
        ],

        'errorHandler' => [
            'errorAction' => 'touch/errors/error',
        ],

        /*
        'log' => [
            'traceLevel' => YII_DEBUG ? 3 : 0,
            'targets' => [
                [
                    'class'  => 'yii\log\FileTarget',
                    'levels' => ['error', 'warning'],
                ],
            ],
        ],
        */

        'log' =>[
            'traceLevel' => YII_DEBUG ? 3 : 0,
            'targets' => [
                'db' =>[
                    'class'   => 'yii\log\DbTarget',
                    'enabled' => true,
                    'prefix'  => function () {
                        return Yii::$app->user->id;
                    },
                    'categories' => ['admin', 'author'],
                    'levels'     => ['info'],
                    {{ $logTable := "{{%ts_log}}" }}
                    'logTable' => '{{$logTable}}',
                    'logVars'    => [],
                ],
            ],
        ],

        'mailer' => [
            // send all mails to a file by default. You have to set
            // 'useFileTransport' to false and configure a transport
            // for the mailer to send real emails.
            //'useFileTransport' => true,
            'class'            => 'yii\swiftmailer\Mailer',
            'viewPath'         => 'mail',
            'useFileTransport' => false,
            'transport' => [
                'class'      => 'fdsfsf',
                'host'       => 'gsdgsg',
                'port'       => 'gds',
                'encryption' => 'gsdgsd',
                'username'   => 'gdsgsd@gdsgsg.cn',
                'password'   => "dgsgsgsdgs",
            ],
        ],

        'urlManager' => [
            'enablePrettyUrl' => true,
            'showScriptName'  => false,
            'rules'           => [],
        ],

        'redis' => [
            'class'    => 'yii\redis\Connection',
            'hostname' => '{{.Values.redis.session.host}}',
            'port' => {{.Values.redis.session.port}},
            'database' => {{.Values.redis.session.database}},
            'password' => '{{.Values.redis.session.password}}'
        ],
        'redis2' => [
            'class'    => 'yii\redis\Connection',
            'hostname' => '{{.Values.redis.session.host}}',
            'port' => {{.Values.redis.session.port}},
            'database' => {{.Values.redis.session.database}},
            'password' => '{{.Values.redis.session.password}}'
        ],

        'script_authorize_redis_lock' => [
            'class'    => 'yii\redis\Connection',
            'hostname' => '{{.Values.redis.dan.host}}',
            'port' => {{.Values.redis.dan.port}},
            'database' => {{.Values.redis.dan.database}},
            'password' => '{{.Values.redis.dan.password}}',
        ],

        'session' => [
            'class'      => 'yii\redis\Session',
            'useCookies' => true,
            'timeout' => defined('SESSIONID_LIFE_TIME') ? constant('SESSIONID_LIFE_TIME') : 86400,       // session 过期时间
            'redis' => [
              'hostname' => '{{.Values.redis.session.host}}',
              'port' => {{.Values.redis.session.port}},
              'database' => {{.Values.redis.session.database}},
              'password' => '{{.Values.redis.session.password}}'
            ],
        ],

        'aliyunoss' => [
            'class'  => 'app\components\Aliyunoss',
            'config' => $params['oss'],
        ],

        'elasticsearch' => [
            'class'  => 'app\components\Elasticsearch',
            'config' => $params['elasticsearch']
        ],

        'version_upload_log' => [
            'class' => 'app\components\Logger',
            'logFile' => '@runtime/script_upload/'.date('Y-m-d').'.log',
        ],
    ];
    return array_merge($components, $db);

  console.php: |
    <?php

    $params = require(__DIR__ . '/params.php');
    $db = require(__DIR__ . '/db.php');
    $components = require(__DIR__ . '/components.php');
    unset($components['request']);
    unset($components['errorHandler']);
    unset($components['mailer']);
    unset($components['user']);

    $config = [
        'id' => 'basic-console',
        'basePath' => dirname(__DIR__),
        'bootstrap' => ['log'],
        'controllerNamespace' => 'app\commands',

        /*
        'components' => [
            'cache' => [
                'class' => 'yii\caching\FileCache',
            ],
            'log' => [
                'targets' => [
                    [
                        'class' => 'yii\log\FileTarget',
                        'levels' => ['error', 'warning'],
                    ],
                ],
            ],
            'db' => $db,
        ],
        'params' => $params,
        */

        'components'   => $components,
        'params'       => $params,

        /*
        'controllerMap' => [
            'fixture' => [ // Fixture generation command line.
                'class' => 'yii\faker\FixtureController',
            ],
        ],
        */
    ];

    if (YII_ENV_DEV) {
        // configuration adjustments for 'dev' environment
        $config['bootstrap'][] = 'gii';
        $config['modules']['gii'] = [
            'class' => 'yii\gii\Module',
        ];
    }
    return $config;

  db.php: |
    <?php

    return [
        // 触动DB
        'db' => [
            'class'    => 'yii\db\Connection',
            'dsn' => 'mysql:host={{.Values.mysql.main_rw_splitting.host}};dbname={{.Values.mysql.main_rw_splitting.dbname}}',
            'username' => '{{.Values.mysql.main_rw_splitting.user}}',
            'password' => '{{.Values.mysql.main_rw_splitting.password}}',
            'charset'  => 'utf8mb4',
            'attributes' => [
                PDO::MYSQL_ATTR_FOUND_ROWS => true,
            ],
        ],

        'db_pay' => [
            'class'    => 'yii\db\Connection',
            'dsn' => 'mysql:host={{.Values.mysql.ts_pay.host}};dbname={{.Values.mysql.ts_pay.dbname}}',
            'username' => '{{.Values.mysql.ts_pay.user}}',
            'password' => '{{.Values.mysql.ts_pay.password}}',
            'charset'  => 'utf8'
        ],

        'db_elf' => [
            'class'    => 'yii\db\Connection',
            'dsn' => 'mysql:host={{.Values.mysql.elf.host}};dbname={{.Values.mysql.elf.dbname}}',
            'username' => '{{.Values.mysql.elf.user}}',
            'password' => '{{.Values.mysql.elf.password}}',
            'charset'  => 'utf8'
        ],

        'db_ent' => [
            'class'    => 'yii\db\Connection',
            'dsn' => 'mysql:host={{.Values.mysql.enterprise.host}};dbname={{.Values.mysql.enterprise.dbname}}',
            'username' => '{{.Values.mysql.enterprise.user}}',
            'password' => '{{.Values.mysql.enterprise.password}}',
            'charset'  => 'utf8'
        ],

        'db_pro' => [
            'class' => 'yii\db\Connection',
            'dsn' => 'mysql:host={{.Values.mysql.tspro.host}};dbname={{.Values.mysql.tspro.dbname}}',
            'username' => '{{.Values.mysql.tspro.user}}',
            'password' => '{{.Values.mysql.tspro.password}}',
            'charset' => 'utf8',
        ],

        'db_statis' => [
            'class' => 'yii\db\Connection',
            'dsn' => 'mysql:host={{.Values.mysql.ts_statis.host}};dbname={{.Values.mysql.ts_statis.dbname}}',
            'username' => '{{.Values.mysql.ts_statis.user}}',
            'password' => '{{.Values.mysql.ts_statis.password}}',
            'charset' => 'utf8',
        ],
    ];

  params.php: |
    <?php

    return [

        'loginUrl' => 'fsdfsdf',

        'oss' => [
            'OSS_ACCESS_ID'=>'{{.Values.ram.author_platform.access_id}}',
            'OSS_ACCESS_KEY'=>'{{.Values.ram.author_platform.access_key}}',
            'EndPoint'=>'http://fsdfsdf',
            'OSS_BUCKETNAME'=>'fsdfsd',
            'root'=>'fsdf',
            'auth_photo_root' => 'fdsfsf',
        ],

        'ts-source-bucket'=>'fsdfsdfs-fsd',

        'cdn' => [
            'tsp'=>"https://{{.fdsp}}",
            'update'=>"https://{{.fsd.fsd.fds.fsdf}}",
            'oss'=>"https://{{.fsd.fs.ds.oss}}",
        ],

        'RSA_private_key' => file_get_contents( __DIR__ . '/secret/RsaPrivateKey.pem' ),
        'RSA_public_key'  => file_get_contents( __DIR__ . '/secret/RsaPublicKey.pem' ),

        'TSP_private_key' => file_get_contents( __DIR__ . '/secret/TspPrivateKey.pem' ),

        'card_auth_device_max_year' => 3,

        'card_day_consume' => 1,

        'buy_point_unit_price' => 0.05,

        'card_forever_consume' => 1000,

        'elasticsearch' => [
            'host' => [
                'fsdfs.fdsfsdf.54.17:fds'
            ]
        ],


        'devices_list_es_search' => false,
        'system_upgrade' => false,

    ];

  web.php: |
    <?php

    $params = require(__DIR__ . '/params.php');
    $db = require(__DIR__ . '/db.php');
    $components = require(__DIR__ . '/components.php');

    $config = [
        'id'           => 'tsp',
        'basePath'     => dirname(__DIR__),
        'bootstrap'    => ['log'],
        'language'     => 'zh-CN',
        'components'   => $components,
        'params'       => $params,
    ];

    if (YII_ENV_DEV) {
        // configuration adjustments for 'dev' environment
        $config['bootstrap'][] = 'debug';
        $config['modules']['debug'] = [
            'class' => 'yii\debug\Module',
            // uncomment the following to add your IP if you are not connecting from localhost.
            'allowedIPs' => ['115.171.135.157'],
        ];

        $config['bootstrap'][] = 'gii';
        $config['modules']['gii'] = [
            'class' => 'yii\gii\Module',
            // uncomment the following to add your IP if you are not connecting from localhost.
        ];
    }

    return $config;


---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cm-{{$app_name}}-nginx
data:
  nginx.conf: |
    limit_req_zone $binary_remote_addr zone=addr:10m rate=1000r/s;
    server {
        client_max_body_size 50m;
        listen 80;

        proxy_ignore_client_abort on;
        client_header_timeout 300s;
        client_body_timeout   300s;

        #server_name localhost dev.touchsprite.com;
        server_name  {{ template "nginx.servername" . }};
    	#limit_req   zone=req_one  burst=100;
        limit_req zone=addr burst=5000 nodelay;

        root /www/default/web;
        index index.php index.html index.htm;


        location /static/ {
            access_log off;
            expires 1d;
            root "/www/default/web/frontEnd/dist";
        }

        location /new_public/ {
           access_log off;
           expires 1d;
           root "/www/default/web/frontEnd";
        }

        location / {
            try_files $uri $uri/ /index.php?$args;
        }

        location = /s-c-data {
          # 允许跨域
          add_header Access-Control-Allow-Origin *;
          add_header Access-Control-Allow-Headers X-Requested-With;
          add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS;
          default_type text/html;
          return 200 $msec;
        }

        location /ajax/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /site/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /images/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /css/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /js/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /assets/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /script/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }
        location /public/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /key/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /category/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /blacklist/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /device/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /temporary/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /log/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /about/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /weixin/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /openapi/luacts1 {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /weixinqa/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location ~ \.php$ {
            include fastcgi.conf;
            fastcgi_connect_timeout 300s;
            fastcgi_send_timeout 300s;
            fastcgi_read_timeout 300s;
            fastcgi_pass  unix:/var/run/php-fpm.sock;
            #fastcgi_pass   localhost:9000;
            #fastcgi_pass unix:/var/run/php5-fpm.sock;
            try_files $uri =404;
        }
    }



---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cm-{{$app_name}}-web
data:
  index.php: |
    <?php

    define("SESSIONID_LIFE_TIME", 86400);
    ini_set('session.cookie_lifetime', SESSIONID_LIFE_TIME);

    $host = $_SERVER['HTTP_HOST'];
    $suffix = substr($host, strrpos($host, '.'));

    ini_set('session.cookie_domain', "touchsprite{$suffix}");

    // comment out the following two lines when deployed to production
    {{- if .Values.debug }}
    defined('YII_DEBUG') or define('YII_DEBUG', true);
    defined('YII_ENV') or define('YII_ENV', 'dev');
    {{- else }}
    defined('YII_DEBUG') or define('YII_DEBUG', false);
    defined('YII_ENV') or define('YII_ENV', 'dev');
    {{- end }}


    require(__DIR__ . '/../vendor/autoload.php');
    require(__DIR__ . '/../vendor/yiisoft/yii2/Yii.php');

    $config = require(__DIR__ . '/../config/web.php');

    (new yii\web\Application($config))->run();



---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cm-{{$app_name}}-supervisor
data:


---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cm-{{$app_name}}-root
data:


---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cm-{{$app_name}}-secret
data:
  TspPrivateKey.pem: |
    -----BEGIN RSA PRIVATE KEY-----
    MIIEpQIBAAKCAQEAzwyG5Ag2AnoAab+87ZJS/h7Jh4ZyIgH3JTbQTW1nsxuP/dNp
    a0uHqNkFjgN6QETVin3WTP/nTQt0PqKlJn9Tb8O8R+0iP1pGtacENd8iiUoNc1ts
    8Pu29IyFrQTnT+CG2eb4EVVNSwYXKyQeQirLohNDE5ld+dnjQlMDcKZCdlveb6T7
    22qJ6pYSvxi7D5yVCdaAmHCXzNEWpYizon5dxDJlhXZsyTPJmkvYWaxkhK0oIU4S
    b/cJBLgBT9VmQGLuCNK3UzZmR7rzoHj70aVDc9nKSUu7RD9chYWJaz61dehfgG8e
    NF6kOSnW83J+4dPi6miEsGcN/5PTM+MX/ddmiQIDAQABAoIBADFM5U2k2t9qF3EW
    s7DJ97MEt63qiICqgSO+UoktNNUEChxBW8etm2bMDjOLhm+JNGOepQl+oZ/Jy2si
    pTpudPqW290wjMgTAeU9GJaPRBT2qg8+xMj41s6SKz5QfZeaeeGmyoiuDBKCJ8Ah
    AId20zgLaBxhl2vnwuJHC/mlzQuLVLvbC7g+S02e8WY4h4eBZ1iBQmL7D0pzyQ+j
    aiGlZvVJ+VBPXHpqHv+HM1wjqYmQAH2TfNJdSDOwuQCNpishBBV8yCPk6BrHZpAH
    xkTbrnGmBFOl6HqGfFaGKxaxl7v58jBckQVoVckqEm+pZmC9WGhu2rVZ/MZOSNQm
    bkkExVECgYEA8gEDF9asDanYQYcaNzI4fVzxWSR1xBTFiQGUGWhKC+u/RX2dT7gG
    rITy2jKtzZn74EKU5Ope65ISkw4Mo7Ha7RwFsDhv+QXel+CX2r6+8r7PfQ5CcGuj
    UldBXTHu2tmMRq3HORRIrpVbXa0qw0G9jt9Fcdw7pynvSdvnsPXBbX0CgYEA2wX9
    D2vh0BFC6SJwb30+DT5IX5ITXUybiBJ8C7+7eHfK5fwwgaZae6n5QUra/vhQ8yDz
    YFBshIVZYdV3vYH2RkbuoZy35Finyoq0jUmHdOQl2Ji4rRark9nvsYAWnCGXCZPc
    jH1TcToYVejjpTa9Jfcq9kfc0dbr3PxSs+Xlmv0CgYEAoye7hh7c8HlJqyQCsKPT
    IfG/ZXIHU6MNakj+KAL/qPnPgnIl1NEk7rrTX/g65RqjjZZV+99nDzrz+uDF9La7
    +o+h5iSmmSUz5QEuX/OpmM675Hvwnwpymdjp4IMBndp9kEkov3rFZa6cYpOU+P8h
    ZWlx0EnCjfjfstPnaI7HUaECgYEA1SNewEMb3H7vvi/leplGaVzS0S416fVC5YgX
    bteGeBUbPfPMwF5Cb1VZWlCeDMFZBUBrlq6s68lY0fwKKkDuiDU+w8berTgZEOEq
    EtQbHYVnzv/Pt6D4F0leGD2twwJtGMTrOfff0w6h1UhmXipD33VU7zT8ha8rPeZT9O8
    J5Txe4ECgYEA3yVm5TvZpi7GWtjklFGX+/4kISL8MkkvS7BhStk1y/F5Aj4F+/LI
    GbKzsC78vYhsqBhP+jNCWgKGSjEOBFsjMl7SnpU7zQ6wO+N5N4jDeOlDS7YbafCC
    mHVO5XDmVw93opRVsm8Fns6s0NhDQP4rzO1bODUFxZH1QNMZ4Hle7tw=
    -----END RSA PRIVATE KEY-----

  RsaPrivateKey.pem: |
    -----BEGIN RSA PRIVATE KEY-----
    MIICXAIBAAKBgQCh1l7EsjADCC2sSBFun7SbAftCnufCklS9OsFE6U4PY/M/dE8q
    LAP36SUkS28CesC7DBN7kka7F+LQHiO2KmxQi8YcayKZ5IPGvNhoh0gCdTnvXRE9
    FSmP42KiDbnJOGWQO86Y1LpQY74MJvYsnxBNYURc719A/ZRuV9uPJSZXHwIDAQAB
    AoGAL03NnYjH59r4HqdiEQe1bqmBm9N+wqyrADSwUUgwfOcmLqH8kcMT1d7b8GPs
    KrlepE2/VBtJeV5d+Z8VqSV1Sw7Rmkpn2nMeQ1rhavkipnB3tanEYwFgpI9TFg+F
    GRINrrREbvsYMVSe44G0BxB3LcgdLcfsssdi6QLWzXMEoddFdrAECQQDM4CQWVceK8XTS
    w6Bx6eQJAUZr7vK5YdnrZxGQ0Q85HMlD7uPeFCbwkPYGUKHiNj9vCyzJ3iPz3v5P
    1Ncg5n+fAkEAyjjdfw4Ub188kfnC+JYzHzdZODPrqiatCsAaXoEDq7Iul9NDAH75
    HW4WR6z2SMTozcfIaqz7QSQ4AK/CheL4gQJAENpTPZ8axfwsvvWmqhgyUOdQ8qn6
    P3OkKHAXCtGXrfwHNlZdWjRQK7PQ+R4C4wfRWgISUhy62mG6i7iXZbZwQwJBALZ6
    +A1GJFSX6S2E51axGzKpHH6mA5xISFByJ5lt7GUMZhUlU8nnyl6vT7WgM6JY5geD
    p6vzqssOpuafs/ZjaYECQEzevhkcJUzSBOTU8y46fx9vBcMbxFC8wAXn0rnIfUB5
    bl2s/46Qxw6KS0+ZD6XXSFfgxi7Rj9nP9Kq0YhZ65d0=
    -----END RSA PRIVATE KEY-----

  RsaPublicKey.pem: |
    -----BEGIN PUBLIC KEY-----
    MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCh1l7EsjADCC2sSBFun7SbAftC
    nufCklS9OsFE6U4PY/M/dE8qLAP36fffSUkS28CesC7DBN7kka7F+LQHiO2KmxQi8Yc
    ayKZ5IPGvNhoh0gCdTnvXRE9FSmP42KiDbnJOGWQO86Y1LpQY74MJvYsnxBNYURc
    719A/ZRuV9uPJSZXHwIDAQAB
    -----END PUBLIC KEY-----


---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cm-{{$app_name}}-fpm
data:
  zzz-docker.conf: |
    [global]
    daemonize = no

    [www]
    listen = /var/run/php-fpm.sock
    listen.mode = 0777
```

use postman

POST http://localhost:8080/v1/api/upload/cloudmer19
Error: connect ECONNREFUSED 127.0.0.1:8080

![2021-01-14 16-11-14屏幕截图](https://user-images.githubusercontent.com/11722888/104562391-40a21280-5683-11eb-99fe-6181dfab52c0.png)


ide show No error message

![2021-01-14 16-11-45屏幕截图](https://user-images.githubusercontent.com/11722888/104562419-4bf53e00-5683-11eb-9944-ad771ae4f421.png)

The service has stopped working！！！
Change-Id: I7dca9f7117e54954ad12f5c04f4dd81315008d0e

This PR will add support for graceful shutdown using graceful third party library and expose new function called `RunGracefully()` to the user. 
- tests and complete functionality will be added soon along as either second commit or all squashed commits
- Updated READ.ME to present this new functionality


Fix #2226 

I've read discussion in #2226, but there are few reasons to consider on behalf of merge of this PR:

* It's pretty easy to fix it
* Even if Basic Auth should not be considered as a secure auth method, it will be often misused in the wild. It'll be hard to make people using basic auth middleware always make informed decision.
* There are cases like server to server integration via HTTPS where basic auth is just good enough.
For who need to customize his own client IP extractor.

Fixes #2474  and  #2232 


## Description
I've a gin web server for simply uploading roughly-10M-sized files by posting multipart form format http requests, whose cpu usage is extremely high.  By profiling, i found calling c.Form caused too much cpu usage.

For simplicity, i wrote a demo justing receiving file content and disabling upload stage and the result is the same.

## How to reproduce
1.Server code

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
        ...........
)

func uploadfile(c *gin.Context) {

       file, err := c.FormFile("file")
       _ = file 
       if err != nil {
           glog.Info("FormFileErr: ", err) 
       }

       c.JSON(http.StatusOK, gin.H{})

}

func main() {
      router := gin.Default()

     router.MaxMultipartMemory = 16 << 20
     .....
     router.POST("<The Path>/files", uploadfile)
     ....
     s := &http.Server{
            Addr:         ":8880",
            ReadTimeout:  180 * time.Second, 
            WriteTimeout: 180 * time.Second,
           Handler:      router, // < here Gin is attached to the HTTP server
      }
}
```

2. Benchmark client code

```
$  for i in 1 2 3;do ./wrk -t15 -c600 -d300s "<MY SERVICE ADDRESS>:8880" -s scripts/multipart2.lua
```

The multipart2.lua is used to generate 10M post requests.
```
local i
i = 0

request = function()
    local headers = {}
    headers["Content-Type"] = "multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW"

    path = "<The Path>/files?file_name=/aaa.txt_" .. (i % 5000)

    --print (path)

    i = i + 1

    body = '------WebKitFormBoundary7MA4YWxkTrZu0gW\r\n'
    body = body .. [[Content-Disposition: form-data; name="file"; filename="en.txt"]]
    body = body .. '\r\n\r\n'
    file = io.open("tmp/10M_size.txt", "rb")
    body = body .. file:read("*a")
    body = body .. '\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW--'
    io.close(file)

    return wrk.format('POST', path, headers, body)
end
```


## Expectations

The cpu should be low since the logic is so simple that it just parses the form field !!

## Actual result

The bandwidth is full and the cpu is very high.
<img width="1285" alt="截屏2021-01-10 下午2 26 03" src="https://user-images.githubusercontent.com/2518001/104116078-5f856980-5350-11eb-9116-9c39c684e8dd.png">

The "perf top" shows cpu is busy with kernel locking
<img width="930" alt="截屏2021-01-10 上午11 31 46" src="https://user-images.githubusercontent.com/2518001/104116106-9f4c5100-5350-11eb-986f-310bd5e1453c.png">


## Environment

- go version:  go1.15 linux/amd64
- gin version (or commit ref):  github.com/gin-gonic/gin v1.6.3
- operating system: x86_64 GNU/Linux

## Description

I want to use a struct to bind map query parameter, it seems that gin doesn't support it yet.

<!-- Description of a problem -->

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
Run server:
```
package main

import (
	"fmt"
	"github.com/gin-gonic/gin"
)

type Req struct {
	Ext map[string]string `form:"ext"`
}

func main() {
	r := gin.Default()
	r.GET("/map", func(c *gin.Context) {
		ext := c.QueryMap("ext")
		fmt.Println(ext)
		// output: map[foo:bar]

		f := Req{}
		err := c.BindQuery(&f)
		if err != nil {
			c.Status(500)
		}
		fmt.Println(f)
		// actual output: { map[]}
		// expected output: { map[foo:bar]}
		c.Status(200)
	})

	r.Run(":8082")
}
```

Curl: 
```
curl --location -g --request GET 'localhost:8082/map?ext[foo]=bar'
```

## Environment

- go version: Go 1.14.12
- gin version (or commit ref): v1.6.3-0.20210112003204-f4bc259de33c
- operating system: Darwin 19.6.0



## Description

I like that gin-gonic can produce several different types of output, such as json, yaml, xml, html template, string, etc. I would like to "detect" what the user wants by looking at the "Accept" header, and run the appropriate c.WHATEVER based on that. 

For example, if someone is querying via API they may ask for json output, but if they are using a browser, we should send them a rendered template (html). 

Some items, like "serverListCSV" will still send CSV as a file, but I feel like it would be useful to have the same endpoints (routes) and controllers but just send the "display" portion to another method that would smartly format it.

Before I *try* to create this myself, can someone tell me if there is already something like this, and what it would be called (view controller is what comes to mind), where I would pass it the context, data and possibly a default type, and have it detect and send the appropriate type. I have tried googling various terms, related, but have just been led astray or maybe I just didn't understand the results.





## Description

custom recovery is not published yet with tag


## Environment

- go version: 1.15.6
- gin version (or commit ref): v.1.6.3 using go mod
- operating system: win10

This reverts commit fca3f95d7cdfdef203c78f220b84118f44590512.

details: https://github.com/gin-gonic/gin/pull/2538#issuecomment-753717649

cc @kishorkunal-raj
https://github.com/gin-gonic/gin/blob/fca3f95d7cdfdef203c78f220b84118f44590512/gin.go#L415
According to root.getValue，the nodeValue.Param is just a shallow copy of given params. So what's the different use ctx.param all the way since it gets filled sequentially in single request? 

adding a new method in context.go; main purpose is to support Context Value set / get.

The existing Value() only returns entry related to an earlier Set(). However within the current request handling, context bound values are not touched at all; hence these values are never "Set()" to the underlying "Keys" map.

The just added ContextValue() will look into these values by accessing the underlying Request object's Context.

Unit test has been updated to reflect on how the process works.
https://github.com/gin-gonic/gin/blob/7742ff50e0a05d079a0c468ccfbf7c6ecfe2414b/binding/form_mapping.go#L236-L245

hi， My question is :  Why not return Parse Error when convert string("") to int?  
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

when I use postman to request data from my gin project .
then, in my gin project I will use go-resty to get response from third part response ,
finally, return the third part response to postman.
But I get Error: socket hang up response from postman 
I don't know what's wrong with this operation 

here is go-resty home page: [resty](https://github.com/go-resty/resty)

and this is my golang code

```go
func CADDOverlapUnionMiddleware(uri string) func(c *gin.Context) {
	return func(c *gin.Context) {
		var params dao.OverlapUnionRequestData
		client := resty.New()
		client.SetTimeout(4 * time.Minute)
		client.SetDebug(true)
		targetFile, header, err := c.Request.FormFile("upload_file")
		if err != nil {
			c.JSON(http.StatusBadRequest, dao.ImportFile400)
			return
		}
		if err := c.Bind(&params); err != nil {
			c.JSON(400, dao.CommonResponse400)
			return
		}
		targetFilePath, err := caddutil.WriteFile(configs.TmpDir, header.Filename, &targetFile)
		if err != nil {
			c.JSON(500, dao.CommonResponse{Code: 500, Message: "write csv error"})
			return
		}
		csvDownloadParams := dao.FilterRequestData{Filters: make(map[string][]dao.Filter, 0), FileId: params.FileId}
		var model caddmodels.CADDModel
		model.InitWithoutParams()
		res, err := model.GetFilterData(&csvDownloadParams)
		if err != nil {
			c.JSON(500, dao.CommonResponse{Code: 500, Message: err.Error()})
			return
		}
		refFilePath, err := res.WriteCsvWithName(strconv.FormatInt(time.Now().Unix(), 10))
		if err != nil {
			c.JSON(500, dao.CommonResponse{Code: 500, Message: err.Error()})
			return
		}
		refFileBytes, _ := ioutil.ReadFile(refFilePath)
		targetFileBytes, _ := ioutil.ReadFile(targetFilePath)
		resp, err := client.R().
			SetFileReader("ref_file", path.Base(refFilePath), bytes.NewReader(refFileBytes)).
			SetFileReader("target_file", path.Base(targetFilePath), bytes.NewReader(targetFileBytes)).
			SetFormData(map[string]string{
				"begin_1":    strconv.Itoa(params.Begin1),
				"end_1":      strconv.Itoa(params.End1),
				"begin_2":    strconv.Itoa(params.Begin2),
				"end_2":      strconv.Itoa(params.End2),
				"median_val": strconv.Itoa(params.MedianVal)}).
			Post(configs.AliyunUrl + uri)
		if err != nil {
			configs.Logger.Error(err)
			return
		}
		configs.Logger.Info("resp ", resp.String())
		//c.String(resp.StatusCode(),resp.String())
		c.String(resp.StatusCode(), resp.String())
	}
}
```
this is postman error:
![image](https://user-images.githubusercontent.com/64942637/103346062-00ad2e00-4ace-11eb-8410-cdc15371877f.png)

Trying to solve: #2582 

Merge before: 

- open [Setting > Secrets](https://github.com/gin-gonic/gin/settings/secrets/actions) and set you'r gitter room id to `GITTER_ROOM_ID `
- Merge #2595

**If the master branch changes, or if a problem occurs that does not necessarily occur, you can choose to re-run the github action job.**

Differences from Travis CI:

- Multiple os `ubuntu-latest`, `macos-latest`, `windows-latest`
- No go master version
- Sending gitter notifications using curl

---

### Some of the problems I've encountered since using GitHub Action

- `TestUnixSocket` windows cannot read `/tmp/unix_unit_test` **(fixed: #2595)**
- `TestPathCleanMallocs` have a certain chance of failure **(I don't know how to repair it :confused: )**
>     path_test.go:85: 
>        	Error Trace:	path_test.go:85
>        	Error:      	Not equal: 
>        	            	expected: float64(2010)
>        	            	actual  : int(0)
>        	Test:       	TestPathCleanMallocs
- `TestUnixSocket` have a certain chance of failure **(I don't know how to repair it :confused: )**
> Get http://127.0.0.1:49379/test: dial tcp 127.0.0.1:49379: bad file descriptor

windows cannot use path `/tmp/unix_unit_test`
My current architecture is a mix of static files and REST endpoints and I want to migrate from REST to gRPC - which is working quite well in itself.  To keep the number of processes low, I would like to serve the static files AND the gRPC-web from a single process, but behind different routes (e.g. `/static` and `/grpc`).

Can I somehow "serve" gRPC from a route in gin?

In the example below `http.Server variant` works fine, but the `GIN Server variant` does nothing except logging the request.

````
func (gs *GRPCWebServer) Init(servePort int, path string) {

	gs.port = servePort

	grpcServer := grpc.NewServer()
	library.RegisterPermissionServiceServer(grpcServer, newPermissionService(path))
	grpclog.SetLogger(log.New(os.Stdout, "grpc: ", log.LstdFlags))

	wrappedServer := grpcweb.WrapServer(grpcServer)

	// http.Server variant
	//
	// handler := func(resp http.ResponseWriter, req *http.Request) {
	// 	wrappedServer.ServeHTTP(resp, req)
	// }
	// httpServer := http.Server{
	// 	Addr:    fmt.Sprintf(":%d", gs.port),
	// 	Handler: http.HandlerFunc(handler),
	// }
	// grpclog.Printf("Starting gRPC-web server, port: %d", gs.port)
	// if err := httpServer.ListenAndServe(); err != nil {
	// 	grpclog.Fatalf("failed starting gRPC-web server: %v", err)
	// }

	// GIN Server variant
	//
	ginServer := gin.New()
	ginServer.Use(gin.Logger())
	ginServer.Use(gin.Recovery())
	ginServer.Group("/grpc", func(c *gin.Context) {
		wrappedServer.ServeHTTP(c.Writer, c.Request)
	})
	ginServer.Run(fmt.Sprintf(":%d", servePort+1))
}
````
I am trying to template an XML file:

```
func GETSitemap(c *gin.Context) {
	urls := make([]map[string]string, 0)
	urls = append(urls, map[string]string{
		"url":      "/home",
		"priority": "0.8",
	})

	c.Header("Content-Type", "application/xml")
	c.HTML(http.StatusOK, "sitemap.xml", gin.H{
		"domain": "example.com",
		"urls":   urls,
	})
}
```

This results in the following:

```
&lt;?xml version="1.0" encoding="UTF-8"?>
...
```

The `<` has been escaped. Normally I'd just disable HTML escaping, but I cannot seem to do this. Is there a way to do "raw" templating?
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

Hi,

I has an issue with function `func (formBinding) Bind(req *http.Request, obj interface{}) error {`, when i push an query like `http://0.0.0.0:8080/v1/transaction?start_date=2006-01-02T15:04:05+07:00&end_date=2006-01-02T15:04:05+07:00&page=1&page_size=100` and use `if err := c.ShouldBindQuery(&request); err != nil {` for parsing, but I see that the value in `setTimeField(val string, structField reflect.StructField, value reflect.Value) error` has invalid string, below is my debug 

request url 
![image](https://user-images.githubusercontent.com/24843184/103199932-986c1a00-491e-11eb-9b2b-768eea7e9413.png)

value in parse
![image](https://user-images.githubusercontent.com/24843184/103198317-9acc7500-491a-11eb-867e-46f3f01f0465.png)

that you see the variable val is missing `+` character so it will be fail set time.

## How to reproduce

define struct with time format

```
type A struct {
	StartDate *time.Time `form:"start_date" time_format:"2006-01-02T15:04:05Z07:00"`
	EndDate   *time.Time `form:"end_date" time_format:"2006-01-02T15:04:05Z07:00"`
}
```

binding a struct with gin context

```var request dtos.SearchCodeTransactionRequest
	if err := c.ShouldBindQuery(&request); err != nil {`
```

see value in `func setTimeField(val string, structField reflect.StructField, value reflect.Value) error {` in form_mapping.go

## Environment

- go version: go version go1.15.6 linux/amd64
- gin version (or commit ref): github.com/gin-gonic/gin v1.6.3
- operating system: Ubuntu 20.04.1 LTS x86_64 

Edit : I saw that gin will be unescape character `+` in query request, so how can we parse time with timezone like +07:00 ?
HttpRouter seems to be more performant than Gin?  The benchmarks show that :

>(1): Total Repetitions achieved in constant time, higher means more confident result
> **Gin = 43550** / **HttpRouter = 55938**

>(2): Single Repetition Duration (ns/op), lower is better
> **Gin = 27364** / **HttpRouter = 21360**

>(3): Heap Memory (B/op), lower is better
> **Gin = 0** / **HttpRouter = 0**

>(4): Average Allocations per Repetition (allocs/op), lower is better
> **Gin = 0** / **HttpRouter = 0**

Could the benchmarks be sorted by performance?
cc #1714

similar to https://github.com/gorilla/handlers/pull/159/files
## Description

If the get request parameter contains a percent sign, the corresponding value will not be obtained

## How to reproduce

```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/hello/:name", func(c *gin.Context) {
		c.String(200, "Hello %s", c.Param("name"))
	})
	g.Run(":9000")
}
```

## Expectations

```
$ curl http://localhost:8201/hello/world?name=%Hello
%Hello
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl -i http://localhost:8201/hello/world?name=%Hello
<>
```

### Want 
Can I use a router like this：
```
/pages/archives-{id}.html
```

 and use that parm by :
```
id := c.Param("id")
```
### This is how I use it at present
```
/pages/archives-:id
```
then
```
id := c.Param("id")[0,strings.Index(c.Param("id"), ".")]
```


## Description

<!-- Description of a problem -->

I've gotten axios error with 400 bad request error message

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```go
package router

import (
	"fmt"
	"github.com/gin-gonic/gin"
	"os"
	"myapp/lib/env"
)

func Init() {
	router := gin.Default()
	router.Use(func(c *gin.Context) {
		c.Writer.Header().Set("Access-Control-Allow-Origin", "*")
		c.Writer.Header().Set("Access-Control-Max-Age", "86400")
		c.Writer.Header().Set("Access-Control-Allow-Methods", "POST, GET, OPTIONS, PUT, DELETE, UPDATE")
		c.Writer.Header().Set("Access-Control-Allow-Headers", "Origin, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization")
		c.Writer.Header().Set("Access-Control-Expose-Headers", "Content-Length")
		c.Writer.Header().Set("Access-Control-Allow-Credentials", "true")

		if c.Request.Method == "OPTIONS" {
			fmt.Println("OPTIONS")
			c.AbortWithStatus(200)
		} else {
			c.Next()
		}
	})
	router.POST("/api/login", func(c *gin.Context) {
		fmt.Println(c.PostForm("message"))
	})
	
	router.Run()
}

```

```javascript
try {
                await axios.post(
                    `/api/login`,
                    {
                        "message": "aksdkaskd"
                    }
                );

               
            } catch (err) {
                
                console.log(err);
                
            }
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
got 200 with json data as the response
```

## Actual result

<!-- Actual result showing the problem -->
```
got 400 bad request
```

## Environment

- go version: 1.15.3
- gin version (or commit ref): 0.0.0-20171026143024-cafe2ce98974
- operating system: Mac Catalina

my project catalog is：

|--main.go
　　|--template
　　        |--temp1
                         |--index.html   
               |--temp2
                         |--index.html

--------------------------------------------------------------
and main.go is:

package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
        g.LoadHTMLGlob("template/**/*")
	g.GET("/temp1/index", func(c *gin.Context) {
		c.HTML(200, "temp1/index.html", gin.H{
			"title": "index",
			"name":  "myname1",
		})
	})
	g.GET("/temp2/index", func(c *gin.Context) {
		c.HTML(200, "temp2/index.html", gin.H{
			"title": "index",
			"name":  "myname2",
		})
	})
	g.Run(":9000")
}
----------------------------------------------------------------------

when I enter 'http://localhost:9000/tem1/index' in browser
I got 'HTTP ERROR 500'.  

---------------------------------------------------------------------
How to solve the problem？

error min support Go version compare with README.md
- With issues:
Please tell me the meaning of 255.

## Description

<!-- Description of a problem -->

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
func countParams(path string) uint8 {
	var n uint
	for i := 0; i < len(path); i++ {
		if path[i] != ':' && path[i] != '*' {
			continue
		}
		n++
	}
	if n >= 255 {
		return 255
	}
	return uint8(n)
}
```

- go version:go version go1.13 windows/amd64
- gin version (or commit ref): master
- operating system:

See the hack news:『[Travis CI is no longer providing CI minutes for open source projects](https://news.ycombinator.com/item?id=25338983)』

Twitter: https://twitter.com/james_hilliard/status/1336081776691843072





## Description

Not specifying any particular version a go build fails due to...

```
gopkg.in/yaml.v2@v2.2.8: reading gopkg.in/yaml.v2/go.mod at revision v2.2.8: unknown revision v2.2.8
```

## How to reproduce

```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/hello/:name", func(c *gin.Context) {
		c.String(200, "Hello %s", c.Param("name"))
	})
	g.Run(":9000")
}
```

## Expectations

An executable binary.

## Actual result

```
$ go mod init gintest
go: creating new go.mod: module gintest
$ go build .
go: finding module for package github.com/gin-gonic/gin
go: found github.com/gin-gonic/gin in github.com/gin-gonic/gin v1.6.3
go: github.com/gin-gonic/gin@v1.6.3 requires
	gopkg.in/yaml.v2@v2.2.8: reading gopkg.in/yaml.v2/go.mod at revision v2.2.8: unknown revision v2.2.8
```

## Environment

- go version: go1.15.5 linux/amd64
- gin version (or commit ref): not specifying
- operating system: CentOS 8

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

wrong content-type causes stack overflow

## How to reproduce
send a json string request with content-type  test/plain

## Actual result
runtime: goroutine stack exceeds 1000000000-byte limit
fatal error: stack overflow

runtime stack:
runtime.throw(0x1355a3a, 0xe)
	/usr/lib/golang/src/runtime/panic.go:774 +0x72
runtime.newstack()
	/usr/lib/golang/src/runtime/stack.go:1046 +0x7a9
runtime.morestack()
	/usr/lib/golang/src/runtime/asm_amd64.s:449 +0x8f

goroutine 102 [running]:
runtime.mapaccess2_faststr(0x11f6980, 0xc000740120, 0x1117bbf, 0x3, 0x0, 0x0)
	/usr/lib/golang/src/runtime/map_faststr.go:107 +0x7a8 fp=0xc020740350 sp=0xc020740348 pc=0x41b238
github.com/gin-gonic/gin/binding.setByForm(0x12fa560, 0xc005b3a400, 0x199, 0x1117bbf, 0x3, 0x0, 0x0, 0x14efda0, 0x12d2000, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:140 +0x93 fp=0xc020740508 sp=0xc020740350 pc=0xf2fa73
github.com/gin-gonic/gin/binding.formSource.TrySet(0xc000740120, 0x12fa560, 0xc005b3a400, 0x199, 0x1117bbf, 0x3, 0x0, 0x0, 0x14efda0, 0x12d2000, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:45 +0x104 fp=0xc020740608 sp=0xc020740508 pc=0xf2e6a4
github.com/gin-gonic/gin/binding.tryToSetValue(0x12fa560, 0xc005b3a400, 0x199, 0x1117bbf, 0x3, 0x0, 0x0, 0x14efda0, 0x12d2000, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:136 +0x5ac fp=0xc020740798 sp=0xc020740608 pc=0xf2f8ec
github.com/gin-gonic/gin/binding.mapping(0x12fa560, 0xc005b3a400, 0x199, 0x1117bbf, 0x3, 0x0, 0x0, 0x14efda0, 0x12d2000, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:78 +0x567 fp=0xc020740a00 sp=0xc020740798 pc=0xf2ee47
github.com/gin-gonic/gin/binding.mapping(0x12d2000, 0xc005b2fc10, 0x196, 0x1117bbf, 0x3, 0x0, 0x0, 0x14efda0, 0x12d2000, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020740c68 sp=0xc020740a00 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2fc00, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020740ed0 sp=0xc020740c68 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1de50, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020741138 sp=0xc020740ed0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1ddd0, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc0207413a0 sp=0xc020741138 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2fbe0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020741608 sp=0xc0207413a0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2fb00, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020741870 sp=0xc020741608 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1ddc0, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020741ad8 sp=0xc020741870 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1dd40, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020741d40 sp=0xc020741ad8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2fae0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020741fa8 sp=0xc020741d40 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2fa00, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020742210 sp=0xc020741fa8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1dd30, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020742478 sp=0xc020742210 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1dcb0, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc0207426e0 sp=0xc020742478 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f9e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020742948 sp=0xc0207426e0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f900, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020742bb0 sp=0xc020742948 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1dca0, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020742e18 sp=0xc020742bb0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1dc20, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020743080 sp=0xc020742e18 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f8e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc0207432e8 sp=0xc020743080 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f800, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020743550 sp=0xc0207432e8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1dc10, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc0207437b8 sp=0xc020743550 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1db90, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020743a20 sp=0xc0207437b8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f7e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020743c88 sp=0xc020743a20 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f700, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020743ef0 sp=0xc020743c88 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1db80, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020744158 sp=0xc020743ef0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1db00, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc0207443c0 sp=0xc020744158 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f6e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020744628 sp=0xc0207443c0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f600, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020744890 sp=0xc020744628 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1daf0, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020744af8 sp=0xc020744890 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1da70, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020744d60 sp=0xc020744af8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f5e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020744fc8 sp=0xc020744d60 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f500, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020745230 sp=0xc020744fc8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1da60, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020745498 sp=0xc020745230 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d9e0, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020745700 sp=0xc020745498 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f4e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020745968 sp=0xc020745700 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f400, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020745bd0 sp=0xc020745968 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d9d0, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020745e38 sp=0xc020745bd0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d950, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc0207460a0 sp=0xc020745e38 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f3e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020746308 sp=0xc0207460a0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f300, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020746570 sp=0xc020746308 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d940, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc0207467d8 sp=0xc020746570 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d8c0, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020746a40 sp=0xc0207467d8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f2e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020746ca8 sp=0xc020746a40 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f200, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020746f10 sp=0xc020746ca8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d8b0, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020747178 sp=0xc020746f10 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d830, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc0207473e0 sp=0xc020747178 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f1e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020747648 sp=0xc0207473e0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f100, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc0207478b0 sp=0xc020747648 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d820, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020747b18 sp=0xc0207478b0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d7a0, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020747d80 sp=0xc020747b18 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f0e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020747fe8 sp=0xc020747d80 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f000, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020748250 sp=0xc020747fe8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d790, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc0207484b8 sp=0xc020748250 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d710, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020748720 sp=0xc0207484b8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2efe0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020748988 sp=0xc020748720 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2ef00, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020748bf0 sp=0xc020748988 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d700, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020748e58 sp=0xc020748bf0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d680, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc0207490c0 sp=0xc020748e58 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2eee0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020749328 sp=0xc0207490c0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2ee00, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020749590 sp=0xc020749328 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d670, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc0207497f8 sp=0xc020749590 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d5f0, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020749a60 sp=0xc0207497f8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2ede0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020749cc8 sp=0xc020749a60 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2ed00, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020749f30 sp=0xc020749cc8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d5e0, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074a198 sp=0xc020749f30 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d560, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074a400 sp=0xc02074a198 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2ece0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074a668 sp=0xc02074a400 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2ec00, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074a8d0 sp=0xc02074a668 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d550, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074ab38 sp=0xc02074a8d0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d4d0, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074ada0 sp=0xc02074ab38 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2ebe0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074b008 sp=0xc02074ada0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2eb00, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074b270 sp=0xc02074b008 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d4c0, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074b4d8 sp=0xc02074b270 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d440, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074b740 sp=0xc02074b4d8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2eae0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074b9a8 sp=0xc02074b740 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2ea00, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074bc10 sp=0xc02074b9a8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d430, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074be78 sp=0xc02074bc10 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d3b0, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074c0e0 sp=0xc02074be78 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2e9e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074c348 sp=0xc02074c0e0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2e900, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074c5b0 sp=0xc02074c348 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d3a0, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074c818 sp=0xc02074c5b0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d320, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074ca80 sp=0xc02074c818 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2e8e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074cce8 sp=0xc02074ca80 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2e800, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074cf50 sp=0xc02074cce8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d310, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074d1b8 sp=0xc02074cf50 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d290, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074d420 sp=0xc02074d1b8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2e7e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074d688 sp=0xc02074d420 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2e700, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074d8f0 sp=0xc02074d688 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d280, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074db58 sp=0xc02074d8f0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d200, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074ddc0 sp=0xc02074db58 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2e6e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074e028 sp=0xc02074ddc0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2e600, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074e290 sp=0xc02074e028 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d1f0, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074e4f8 sp=0xc02074e290 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d170, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074e760 sp=0xc02074e4f8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2e5e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074e9c8 sp=0xc02074e760 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2e500, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074ec30 sp=0xc02074e9c8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d160, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074ee98 sp=0xc02074ec30 pc=0xf2ec1c
...additional frames elided...
created by net/http.(*Server).Serve
	/usr/lib/golang/src/net/http/server.go:2927 +0x911


## Environment
- go version: go version go1.13.6 linux/amd64
- gin version (or commit ref):v1.5.0
- operating system:Linux localhost.localdomain 3.10.0-1127.el7.x86_64 #1 SMP Tue Mar 31 23:36:51 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux


## Description

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	r := gin.Default()
        r.Static("/static", "../static")
	r.Run(":9000")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl http://localhost:8201/static/file.webp
<File here>
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl -i http://localhost:8201/static/file.webp
404 error
```

## Environment

- go version: v1.15
- gin version (or commit ref): 1.6.3
- operating system: ubuntu 20.04

# Other important information

This is the minimal project structure:
```
- cmd
  - main.go
- static
   - a file.webp
```
for example，url  GET "/user/1245" matched the pattern "/user/:userId", Is there any way to get the matched url pattern from gin.context in middleware?
## Description
I do it by command “go get -u -v github.com/gin-gonic/gin”，The following error message appears

【
    package github.com/gin-gonic/gin
        imports github.com/gin-contrib/sse
        imports net/http
        imports crypto/tls
        imports golang.org/x/crypto/chacha20poly1305
        imports golang.org/x/sys/cpu: C source files not allowed when not using cgo or SWIG: cpu_gccgo_x86.c
】

## Environment

- go version: 1.5.6
- gin version (or commit ref): lasted
- operating system: win 10 

## Description

Why using context.QueryArray() for a non-existing or empty array, the length of the return value is `1`? 
It should be `0`.

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"fmt"
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/hello", func(c *gin.Context) {
		list := c.QueryArray("list")
		fmt.Printf("the len of list is: %v.\n", len(list))
	})
	g.Run(":9000")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
![image](https://user-images.githubusercontent.com/34429036/101275777-52baa680-37e3-11eb-8278-b3bfd000d9f5.png)

![image](https://user-images.githubusercontent.com/34429036/101275722-e9d32e80-37e2-11eb-9b9e-980b43297bcf.png)


## Actual result

<!-- Actual result showing the problem -->
![image](https://user-images.githubusercontent.com/34429036/101275737-08d1c080-37e3-11eb-977d-6fb8813505ae.png)

## Environment

- go version: 1.15.5
- gin version (or commit ref): v1.6.3
- operating system: mac OS Catalina 10.15.7

## Description

I try to do some works with goroutine in handler as the [demo](https://github.com/gin-gonic/gin#goroutines-inside-a-middleware), and when I read the request body from copied context in goroutine, the reader always closed. the error detail is `http: invalid Read on closed Body`

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.POST("/dosomething", func(c *gin.Context) {
		cCp := c.Copy()
                go func() {
                    var err error
		    var buf []byte
		    if buf, err = ioutil.ReadAll(cCp.Request.Body); err != nil {
                        log.Println(err)
			return
		    }
                    fmt.Println(string(buf))
                }()
	})
	g.Run(":9000")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl -XPOST -d '...some json data...' http://localhost:9000/dosomething

...json data...
```

## Actual result

<!-- Actual result showing the problem -->
```
Show in stdout:

http: invalid Read on closed Body
```

## Environment

- go version: go1.14.4 darwin/amd64
- gin version (or commit ref): v1.6.3
- operating system: MacOS 10.14.5

This PR introduces fuzzing for Gin. The fuzzer in this PR is implemented by way of the [go-fuzz](https://github.com/dvyukov/go-fuzz) fuzzing engine.

Fuzzing is a way of testing applications whereby pseudo-random data is passed to a target function with the goal of finding bugs and vulnerabilities. The fuzzer in this PR is implemented with the go-fuzz fuzzing engine.

I have worked on setting continuous fuzzing up for the fuzzer which will allow it to run for longer and find harder-to-find bugs as well. I will shortly set up the integration for Gin on OSS-fuzz, and upon merging the fuzzer here, it will be able to run continuously through OSS-fuzz. OSS-fuzz is a free service for open source projects, and if/when bugs are found, maintainers get notified with an email containing a link to a detailed bug report with stacktrace and reproducer test-case. While it is a free service it is offered with an implied expectation that bugs are fixed, so that the resources spent on fuzzing Gin go towards resolving bugs in the codebase.

All that is needed to setup continuous fuzzing would be at least one maintainer email address.

For some examples of previous bugs found from fuzzing Golang projects I recommend checking out the trophy list on the go-fuzz repository: https://github.com/dvyukov/go-fuzz#trophies


This project has been a long time didn't update version.

It seem the project still updating but version never change.

Do you have any certain plan?
some loop don't need to transfer to bytes slice and some use the zero copy will much better.
## Description
    I used c.JSON() to return after json binding failed. But the Content-Type in response header is "text/plain; charset=utf-8".  

   After trying.I found that all headers setting after c.Writer.WriteHeaderNow() are invalid.
 
 How to reproduce

```
package main

import (
	"github.com/gin-gonic/gin"
)

type User1 struct {
	UserName string `json:"username"`
	Date     int    `json:"date"`
}

func main() {
	h := gin.New()
	h.POST("/api/ct", func(c *gin.Context) {
		var u User1
		if err := c.BindJSON(&u); err != nil {
			c.JSON(400, "fail")
			return
		}

		c.JSON(200, "ok")
	})

	h.Run(":4000")
}
```

## Expectations
 The Content-Type in response header is "application/json; charset=utf-8". That is, the header can be set correctly

## Actual result

![1123](https://user-images.githubusercontent.com/33141719/100606400-544c2080-3344-11eb-8858-ebcd9555621f.jpg)


## Environment

- go version: go1.14.9 darwin/amd64
- gin version (or commit ref):  gin 1.6.3
- operating system: darwin/amd64

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description
Im use the Gin'bind to check the request's  postdata，the struct like  that
```
type EditServiceForm struct {
	ID          string `form:"id" valid:"Required;MaxSize(30)"`
	State       int    `form:"state" valid:"Range(0,1)"`
}
//some  func  like  this  
func UpdateVoiceService(c *gin.Context) {
	log.Debug("enter func UpdateVoiceService")

	var (
		appG = app.Gin{C: c}
		form = EditServiceForm{ID: c.Param("id")}
	)

	httpCode, errCode := app.BindAndValid(c, &form)
	if errCode != e.SUCCESS {
		log.Error("UpdateVoiceService    BindAndValid  errcode:", errCode)
		appG.Response(httpCode, errCode, nil)
		return
	}
}

```

the  filed  state's default value is  0,If  the  postdate have no "data" field,  user the "form "  obj   to  update  mysql with ORM,it  must be wrong,because the "state" be set 0.



## Description

Getting Error: refused to get unsafe header "location" when trying to upload video using uppy via tusd to S3.
Operating System: Ubuntu 20.04
Used tusd version: current
Used tusd data storage: s3
Used tus client library: Uppy.js

## How to reproduce

```
package main

import (
	"fmt"
	"time"

	"github.com/aws/aws-sdk-go/aws"
	"github.com/aws/aws-sdk-go/aws/credentials"
	"github.com/aws/aws-sdk-go/aws/session"
	"github.com/aws/aws-sdk-go/service/s3"
	"github.com/gin-contrib/cors"
	gin "github.com/gin-gonic/gin"

	"github.com/tus/tusd/pkg/s3store"
	tusd "github.com/tus/tusd/pkg/handler"
)

func main() {

	router := gin.New()
	// router.Use(cors.New(cors.Config{
	// 	AllowOrigins:     []string{"http://localhost:3000"},
	// 	AllowMethods:     []string{"GET", "PATCH", "POST", "PUT"},
	// 	AllowHeaders:     []string{"Origin"},
	// 	ExposeHeaders:    []string{"Content-Length"},
	// 	AllowCredentials: true,
	// 	MaxAge:           12 * time.Hour,
	// }))
         **//Tried multiple things**
	// config := cors.DefaultConfig()
	// config.AllowOrigins = []string{"http://localhost:3000/*"}
	// router.Use(cors.New(config))

	router.Use(cors.Default())

	// S3 Configuration
	s3Config := &aws.Config{
		Region:      aws.String("ap-south-1"),
		Credentials: credentials.NewStaticCredentials(S3_ACCESS_KEY, S3_SECRET_KEY, ""),
	}

	router.POST("/files/", func(c *gin.Context) {

		s3Locker := s3store.New("bucket", s3.New(session.Must(session.NewSession()), s3Config))
		composer := tusd.NewStoreComposer()
		s3Locker.UseIn(composer)

		handler, err := tusd.NewHandler(tusd.Config{
			BasePath:                "/files/",
			StoreComposer:           composer,
			NotifyCompleteUploads:   true,
			NotifyTerminatedUploads: true,
			NotifyUploadProgress:    true,
			NotifyCreatedUploads:    true,
		})
		if err != nil {
			panic(fmt.Errorf("Unable to create handler: %s", err))
		}
		go func() {
			for {
				event := <-handler.CompleteUploads
				fmt.Printf("Upload %s finished\n", event.Upload.ID)
			}
		}()
	})
	router.Run()
}
```
My S3 CORS config:

```
[
    {
        "AllowedHeaders": [
            "Range"
        ],
        "AllowedMethods": [
            "GET",
            "POST",
            "PUT",
            "DELETE"
        ],
        "AllowedOrigins": [
            "*"
        ],
        "ExposeHeaders": [
            "Accept-Ranges",
            "Content-Encoding",
            "Content-Length",
            "Content-Range"
        ]
    }
]
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
The file must be uploaded to S3
```

## Actual result

![image](https://user-images.githubusercontent.com/41233079/100536704-57fa7d00-3248-11eb-8bb2-9bbcd0da4a92.png)

after meddling around my S3 CORS
![image](https://user-images.githubusercontent.com/41233079/100536717-6fd20100-3248-11eb-972c-fbf8c78c90ba.png)


## Environment

- go version: go1.15.3
- gin version (or commit ref): current
- operating system: Ubuntu

## Description

First, it's a pleasure for me to use this incredible framework. Thanks to the communities for all what it did.
And i open this issue to try to understand what is going wrong and if we found out that is a real issue, i will be proud to help you

I created a little api with gin gonic with few routes with severals gin-contrib package (cache, cors) to manage cache and cors issue.
And i started to test my gin gonic api and i chose to mock a gin.Context to be able to call the hundlerFunc easier. 
So i have two files, let's say a list.go and a list_test.go

## How to reproduce
As example, we could manage routes like that:
```
package api

import (
	"github.com/gin-gonic/gin"
	"github.com/gin-gonic/gin/binding"

	"net/http"
)

type inputParameter struct {
	Page int `form:"page" binding:"omitempty,numeric"`
}

func handleList(c *gin.Context) {
	var p inputParameter
	if err := c.ShouldBindWith(p, binding.Query); err != nil {
		c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
	}
	c.String(200, "Hello %s", c.Param("name"))

}
func main() {
	g := gin.Default()
	g.GET("/hello/:name", handleList)
	g.Run(":9000")
}
```
And a test file: 
```
package api

import (
	"fmt"
	"net/http/httptest"

	"github.com/stretchr/testify/assert"

	"testing"

	"github.com/gin-gonic/gin"
)

func TestList(t *testing.T) {
	w := httptest.NewRecorder()
	g, _ := gin.CreateTestContext(w)
	handleList(g)
	fmt.Println("result", g)
	// assert equality
	assert.Equal(t, 200, w.Code)

}
```
## Expectations

Should display a success message
```
$ go test -v
--- PASS: TestList (0.00s)
PASS
ok  	api	0.616s
```
## Actual result

Instead of a panic message
```
$ go test -v
--- FAIL: TestList (0.00s)
panic: runtime error: invalid memory address or nil pointer dereference [recovered]
	panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x10 pc=0x91c246]

goroutine 41 [running]:
testing.tRunner.func1(0xc00027e500)
	/usr/local/go/src/testing/testing.go:874 +0x3a3
panic(0x9f3de0, 0xf63fc0)
	/usr/local/go/src/runtime/panic.go:679 +0x1b2
github.com/gin-gonic/gin/binding.queryBinding.Bind(0x0, 0xa071c0, 0xf95760, 0xe8, 0xf0)
	~/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/binding/query.go:16 +0x26
github.com/gin-gonic/gin.(*Context).ShouldBindWith(...)
	~/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/context.go:679
api.list(0xc0002c41e0)
	simple.go:24 +0x80
api.TestList(0xc00027e500)
	simple_test.go:17 +0xbb
testing.tRunner(0xc00027e500, 0xacbd60)
	/usr/local/go/src/testing/testing.go:909 +0xc9
created by testing.(*T).Run
	/usr/local/go/src/testing/testing.go:960 +0x350
exit status 2
FAIL	api	0.540s
```
And to fix that, i found a workaround which is to define locally a custom struct which is compliant with 
```
type Binding interface {
	Name() string
	Bind(*http.Request, interface{}) error
}
```
Finally, we have:
```
type customBinding struct {}

func (q *customBinding) Name() string {
	return "query"
}
func (q *customBinding) Bind(req *http.Request, obj interface{}) error {
	return nil
}
func handleList(c *gin.Context) {
	var p inputParameter
	var b customBinding
	if err := c.ShouldBindWith(p, &b); err != nil {
		c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
	}
	c.String(200, "Hello %s", c.Param("name"))

}
```
It seems strange that i need to redefine a struct which is already defined in package binding and i don't understand why this happens, as if the binding package can not be reached

I stay available if you need more details guys.


## Environment

- go version: go version go1.13.6 linux/amd64
- gin version: gin-gonic/gin v1.6.3
- operating system: Ubuntu 18.04.4 LTS x86_64

Ryl
Before:

```
panic: gin mode unknown: development

goroutine 1 [running]:
github.com/gin-gonic/gin.SetMode(...)
	/home/flatearther/go/packages/pkg/mod/github.com/gin-gonic/gin@v1.6.3/mode.go:61
github.com/gin-gonic/gin.init.0()
	/home/flatearther/go/packages/pkg/mod/github.com/gin-gonic/gin@v1.6.3/mode.go:48 +0x16a
exit status 2
```

After:

```
panic: gin mode unknown: development (available mode: debug release test)

goroutine 1 [running]:
github.com/gin-gonic/gin.SetMode(...)
	/home/flatearther/go/packages/pkg/mod/github.com/gin-gonic/gin@v1.6.3/mode.go:61
github.com/gin-gonic/gin.init.0()
	/home/flatearther/go/packages/pkg/mod/github.com/gin-gonic/gin@v1.6.3/mode.go:48 +0x16a
exit status 2
```
https://ru.stackoverflow.com/questions/1208712/eof-in-bindjson-gin

I implements a delete method by gin, and I get data form body like this:
```go
func Delete(context *gin.contex){
        id:=context.PostForm("id")
        //do some logical codes
}
```
But I found that the id is an empty string which means **the context doesn't contain `id` param in body**(I'm not sure, but I think it has a high possibility).
I found there is a closed issue(#396) but it was closed without solving method. I'm confused about this .
##  Description

`c.FullPath()` output incorrect relative path

## How to reproduce
```go
func HTTPRouter(r gin.IRouter) {
	r.GET("/fullpathadfaadfaf", func(c *gin.Context) {
		fmt.Println(c.FullPath())
	})
}
```
`curl http://localhost:9112/local/api/fullpathadfaadfaf`
output:
```
/local/api/fk-exchange-shop-backup/          // this is another router
```
## Environment

- go version: go1.12.17
- gin version (or commit ref): 73c4633943d596bdbeaa7d02cebdd4bd0c4f4630
- operating system: windows10 64


- Slow response to concurrent requests

- response body : 14M
- concurrent requests number: 300
- just read memory string data to return, but very slow in concurrent requests scenarios, 
- go-version: go 1.14
- gin version: v1.6.3
How should I use it accurately?

```
		ctx.String(http.StatusOK, memData.JsonData)
		return
```



## Description

After starting a `c.Stream` or `io.Copy(writer, body)`, etc. it becomes impossible to alert the client that the request has failed (except by corrupting the body or hijacking the request).

## How to reproduce

```go
package main

import (
	"io"
	"net/http"

	"github.com/gin-gonic/gin"
)

func main() {
	router := gin.Default()

	router.GET("/test", func(c *gin.Context) {
		first := true
		c.Stream(func(w io.Writer) bool {
			if first {
				w.Write([]byte("test"))
				first = false
				return true
			}

			if wr, ok := w.(gin.ResponseWriter); ok {
				wr.WriteHeader(http.StatusInternalServerError)
			}
			return false
		})
	})

	router.Run(":8080")
}
```

## Expectations

```bash
$ curl -v localhost:8080/test
...
< HTTP/1.1 500 Internal Server Error
...
```

## Actual result

```bash
$ curl -v localhost:8080/test
...
< HTTP/1.1 200 OK
...
```

## Environment

- go version: go1.15.3 darwin/amd64
- gin version (or commit ref): v1.6.3
- operating system: MacOS

### Other notes

It looks like the issue is on the `gin.responseWriter.Write` that calls `WriteHeaderNow`:

```go
func (w *responseWriter) Write(data []byte) (n int, err error) {
	w.WriteHeaderNow()
	n, err = w.ResponseWriter.Write(data)
	w.size += n
	return
}
``` 

It should also be noted that this renders `c.AbortWithStatus()` useless

Logs from server:

```bash
[GIN-debug] [WARNING] Headers were already written. Wanted to override status code 200 with 500
[GIN] 2020/11/18 - 14:54:00 | 500 |      52.011µs |             ::1 | GET      "/test"
```
## Description

<!-- Description of a problem -->
I've defined a structure with some validate tags

**for example:**
```
type User struct{
       Username `form:"username" binding:"required"`
       Password `form:"password" binding:"required,min=8,max=16"`
}
```
**When I use it like the following:**
```
func f1(c *gin.context){
       var u User
       err := c.ShouldBindWith(&User)
       if err != nil {
          log.Fatal(err)
       }
{
```
1. The first time, I send the correct password to the server(8<= len <=16). It passed.
2. Later, I intentionally sent the password of the wrong length.It still goes through.

I was very surprised. I thought there was something wrong with the parameter verification of GIN, which was very abnormal

The `copy()` function cannot forcefully restrict the use of `*gin.context` within the coroutine, so it is easy to cause variable competition. Unconscious things need to be restricted, and the kv carried in a clear context will be recycled after the request ends.
## Environment

- go version: 1.15
- gin version (or commit ref): 1.6.3
- operating system: macOS
I prefer to restrict user post data with the required field ```enable```
so I defined the rule as below
```
type EnableRequest struct {
	Enable bool `json:"enable" binding:"required"`
}
var enableRequest EnableRequest
err := c.BindJson(&enableRequest)
```

when I call the API as below, nothing goes wrong.
```
curl --location --request POST 'localhost:8081/api/v1/config/throttle' \
--header 'Content-Type: application/json' \
--header 'Cookie: _csrf=miWgQTwMDH_SCDe9MSucP0uobmADouDl' \
--data-raw '{
    "enable": true
}'
```
however, when I change the value to bool ```false```
error of ```Key: 'EnableRequest.Enable' Error:Field validation for 'Enable' failed on the 'required' tag``` will return.

I tried to pass the string ```"false"``` to the API, an error will raise for invalid type

full sample below:
```

package main

import (
	"fmt"
	"github.com/gin-gonic/gin"
)

type Req struct {
	Enable bool `json:"enable" binding:"required"`
}

func main() {
	r := gin.Default()
	r.POST("/post", x)
        r.Any("/any", x)
	r.Run(":8082")
}

func x(c *gin.Context) {
	var req Req
	err := c.BindJSON(&req)
	if err != nil {
		fmt.Println(err)
		return
	}
	fmt.Println("Req", req)
	return
}
```
false value will cause error
```
{
    "enable": false
}
```




# Description


 I use goroutine to deal a post function,but if i send two post in the same time or one by one ,i get this this error: [debug]error on parse multipart form array: multipart: NextPart: http: invalid Read on closed Body


## How to reproduce

![image](https://user-images.githubusercontent.com/12507576/98926742-a8689f80-2512-11eb-974e-57261877d1bc.png)

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"fmt"
	"github.com/gin-gonic/gin"
	"log"
	"time"
)

func main() {
	r := gin.Default()
	r.POST("/long_async", func(c *gin.Context) {
		// create copy to be used inside the goroutine
		cCp := c.Copy()
		go func() {
			// simulate a long task with time.Sleep(). 5 seconds
			fmt.Println(cCp.PostForm("log_id"))
			image, _ := cCp.FormFile("image")
			fmt.Println(image.Filename)
			time.Sleep(5 * time.Second)
			// note that you are using the copied context "cCp", IMPORTANT
			log.Println("Done! in path " + cCp.Request.URL.Path)
		}()
	})

	// Listen and serve on 0.0.0.0:8080
	r.Run(":8080")
}

```

## Expectations



## Environment

- go version:1.15.3
- gin version (or commit ref):v1.6.3
- operating system:Mac os 10.15.7

I am using gin to implement the original PHP API. Currently, there are online requests similar to 

`/path?a[]=1&a[]=2&b[0]=1&b[1]=2&c[0][age]=1&c[0][name]=abc`.

 How can I get such array parameters in gin?

get value like:

```
a=["1", "2"]
b=["1", "2"]
c=[{"age": "1", "name": "abc"}]
```
## Description

The `GET` request query string parameter with whitespace will directly return to 400. How can I directly process this kind of parameter with whitespace like PHP?

The request is as follows:

` curl -XGET -g "http://localhost:9000/query?starttime=2020-11-12 08:01:00&endtime=2020-11-12 09:01:00"`



When the whitespace is replaced by `+` or `%20`, the request can be received normally. However, there is whitespace in the actual online request, which needs to be compatible. Is there any way?



## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/query", func(c *gin.Context) {
		c.String(200, "from %s to %s", c.Query("starttime"), c.Query("endtime"))
	})
	g.Run(":9000")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
curl -XGET -g "http://localhost:9000/query?starttime=2020-11-12 08:01:00&endtime=2020-11-12 09:01:00"
from 2020-11-12 08:01:00 to 2020-11-12 09:01:00
```

## Actual result

<!-- Actual result showing the problem -->
```
curl -XGET -g "http://localhost:9000/query?starttime=2020-11-12 08:01:00&endtime=2020-11-12 09:01:00"
400 Bad Request
```

## Environment

- go version:1.14
- gin version (or commit ref):1.6.3
- operating system:macos zsh

go version: master branch
issue info: `internal/bytesconv/bytesconv.go:14:8: possible misuse of reflect.StringHeader`
more info: https://travis-ci.org/github/gin-gonic/gin/jobs/742893211

ref go issue: https://github.com/golang/go/issues/40701
…ce before the if statement on graceful shutdown

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


Minor fixes on comments. No additional test is needed.
HTTP HEAD requests are intended to be identical to the corresponding GET requests, except that there is no response body (https://tools.ietf.org/html/rfc7231#section-4.3.2). It is a considerable convenience to Gin users if this behavior is provided automatically, so that's the purpose of this PR.

* Whenever a GET handler is registered, the equivalent HEAD handler will exist automatically.
* Extra HEAD handlers can be added but will rarely be needed.

This PR

* refactored `Engine.handleHTTPRequest` so that two passes are made if the request is HEAD and there isn't a matching HEAD handler - this is the important part of the PR
* suppresses rendering for HEAD request in `Context.Render`, which means that wasteful processing is avoided
* re-ordered GET and HEAD methods to be adjacent
* added test cases for the new code
* added more documentation

The standard Go api `net/http` also has automatic behavior for HEAD requests such that the response body is discarded. This PR doesn't rely on this (although it could), because rendering the unwanted HEAD response can be avoided.

Hey, we need to use the customRecovery which is not included into the v1.6.3 - is there any plan to release a new version in the next days? 

thanks
controller like this:
```go
type myStruct struct {
    Mobile int `json:"mobile"`
}
c.JSON(200, myStruct)
```

I want response like this:
```json
{
    "code": 0,
    "data": {
        "mobile": 12345678
    },
    "msg": "success"
}
```
---

Can I intercept fields in the middleware that return to add wrapping?
just like this:
```go
func ApiResponse() gin.HandlerFunc {
	return func(c *gin.Context) {
		c.Next()

		errs := c.Errors.ByType(gin.ErrorTypeAny)
		if len(errs) > 0 {
                        switch err.(type) {
			case validator.ValidationErrors:
				statusCode = http.StatusUnprocessableEntity

				errs, _ := err.(validator.ValidationErrors)
				trans, transerr := validation.InitTrans(viper.GetString("locale"))

				var valiErr interface{}
				if transerr == nil {
					valiErr = errs.Translate(trans)
				} else {
					valiErr = errs
				}

				errResp = &e.Errno{
					Code: statusCode,
					Msg:  "failed",
					Errs: valiErr,
				}
			default:
				errResp = &e.Errno{
					Code: statusCode,
					Msg:  fmt.Sprintf("unknow error: %s", err.Error()),
				}
			}

			c.AbortWithStatusJSON(statusCode, errResp)
			return
		} else {
                        // todo interrupt and modify response
                        // how ?
               }

	}
}
```



## Description
As the code showing in the binding.go, there is no multipart/mixed supported.
<!--  -->
![image](https://user-images.githubusercontent.com/11610514/98091939-09fc8e80-1ec1-11eb-8395-e074ca5b3434.png)

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```

```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$curl -i -X POST http://127.0.0.1:9702/upload -F "upfile=@/Users/test/Desktop/test.png" -F "type=image" -H "Content-Type: multipart/mixed"
```

## Actual result

<!-- Actual result showing the problem -->
```
	ErrNotMultipart = &ProtocolError{"request Content-Type isn't multipart/form-data"}

```

## Environment

- go version: 1.13


render/json.go defines `AsciiJSON` and some internal names `jsonContentType`, `jsonpContentType`, `jsonAsciiContentType`. This shows a misunderstanding of [RFC4627](https://tools.ietf.org/html/rfc4627) section 3: "JSON text SHALL be encoded in Unicode".

From the RFC, it follows

* the content type `application/json` implies that the content is UTF-8 or UTF-16 or UTF-32 - the RFC describes how the decoder detects the correct UTF from the first bytes.
* it is not helpful to use the term _ASCII_, even if the JSON content happens to be an ASCII-subset of UTF-8

`AsciiJSON` doesn't do what its name suggests. It should be deprecated (and later removed)

Because Go strings are UTF-8 by default, it is equally correct to use the content-type with charset (`application/json;charset=utf-8`) and without charset (`application/json`). The longer form takes a few more bytes but eliminates the (tiny) chance of there being a faulty decoder at the other end and it getting it wrong.

But if someone wants to force the encoding to be some other UTF (e.g. UTF-16 for Asian content), there isn't a way to do that in Gin and maybe that's what is needed. For Asian content, the advantage would be that the UTF-16 encoding would take fewer bytes (a bit less than two-thirds) than UTF-8 encoding for the same content.

So perhaps replace `AsciiJSON` with `JSON_UTF16LE` and `JSON_UTF16BE`. The render methods would need to ensure that the written content is correctly transcoded into the chosen UTF-16 encoding.
## Description

<!-- Description of a problem -->

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"net/http"
	
	"github.com/gin-gonic/gin"
)

// Binding from JSON
type Login struct {
	User     string `form:"user" json:"user" binding:"-"`
	Password string `form:"password" json:"password" binding:"-"`
	Email    string `form:"email" json:"email"  binding:"required_without_all=user password"`
}

func main() {
	router := gin.Default()

	router.POST("/loginJSON", func(c *gin.Context) {
		var json Login
		if err := c.ShouldBindJSON(&json); err != nil {
			c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
			return
		}

		c.JSON(http.StatusOK, gin.H{"status": "you are logged in"})
	})

	// Listen and serve on 0.0.0.0:8080
	router.Run(":8080")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
curl --location --request POST 'http://127.0.0.1:8080/loginJSON' --header 'Content-Type: application/json' --data-raw '{"user":"aaa","password":"bbb","email": ""}'
{"status":"you are logged in"}
```

## Actual result

<!-- Actual result showing the problem -->
```
curl --location --request POST 'http://127.0.0.1:8080/loginJSON' --header 'Content-Type: application/json' --data-raw '{"user":"aaa","password":"bbb","email": ""}'
{"error":"Key: 'Login.Email' Error:Field validation for 'Email' failed on the 'required_without_all' tag"}
```

## Environment

- go version:
  go version go1.14.1 windows/amd64
- gin version (or commit ref):
  v1.6.3
- operating system:
  Win10




## Description

 when i use bindQuey, i hope the required validation method will not execute(because the required binding tag just for POST, not for query) , Or can gin let me call the validate method  explicitly?

now when i call bindquery, it will raise required error because of the 'required' tag.  

example:

package main

import (
	"github.com/gin-gonic/gin"
)

type User struct {
     Name string `json:"name" binding: "required"`
     Age int          `json: "age" binding: "required"`
}

func main() {
	g := gin.Default()
	g.GET("/hello?name=jack", func(c *gin.Context) {
	       var u User
               c.BindQuery(&u)
	})
       g.POST("/hello", func(c *gin.Context) {
             var u User  
             c.BindJSON(&u)
        }
	g.Run(":9000")
}


## Environment

- go version: 1.13
- gin version (or commit ref): 1.6.3
- operating system: mac

if i do like this ,the binding won't work 
```
func formHandler(c *gin.Context) {
    var fakeForm myForm
  var  it interface{} = fakeForm
    c.ShouldBind(&fakeForm)
    c.JSON(200, gin.H{"color": fakeForm.Colors})
}
```


I just discovered gin & want to visit its website.

But I found the link https://gin-gonic.com/ is not opening.
Clicking the link to `gin-gonic.com` on this page https://github.com/gin-gonic/gin gives a 404 error



- With issues:
  - Greetings to all, I am Heru from Indonesia.
I entered this forum for the purpose of asking for help from all for problems from the server I just bought.
Server name / type:
Dell PowerEdge T340
Troble: the Dell PE T340 server does not yet support installing Centos 7 OS, information from Dell technical support.

Help:
Please help share this forum, if anyone has OS Centos 7 firmware that can support the Dell PowerEdge T340 server.

My hope is that seniors are willing to share a little of their knowledge in this forum to provide solutions to my problems together.
thank you foll all

- go version:
- gin version (or commit ref):
- operating system:

Hi,
I had added ppc64le(Linux on Power) architecture support on travis-ci in the PR and looks like its been successfully added. I believe it is ready for the final review and merge. The travis ci build logs can be verified from the link below.
https://travis-ci.com/github/kishorkunal-raj/gin/builds/191395651

Reason behind running tests on ppc64le: This package is included in the ppc64le versions of RHEL and Ubuntu - this allows the top of tree to be tested continuously as it is for Intel, making it easier to catch any possible regressions on ppc64le before the distros begin their clones and builds. This reduces the work in integrating this package into future versions of RHEL/Ubuntu.

Please have a look.
After I registered other routers, when I want to register the static resources router to the path "/",  it told me "CONFLICTS"

My code:
```go
func main() {
        router := gin.Default()

	router.Use(gin.Logger())

	router.Use(gin.Recovery())

	router.StaticFS("/", http.Dir("public"))

	v1 := router.Group("/api/v1")

	{
		task := v1.Group("/task")

		api.NewTaskApi(task)

	}

	router.Run(":3408")
}
```

errors like that:
```bash
panic: '/api/v1/task/' in new path '/api/v1/task/' conflicts with existing wildcard '/*filepath' in existing prefix '/*filepath'
```

fix https://github.com/gin-gonic/gin/issues/2534

`required_if` and `required_unless` are released in v10.4.0.
gin uses v10.2.0, so I can't use it.
https://pkg.go.dev/github.com/go-playground/validator/v10#hdr-Required_If

## How to reproduce
```
package main

import (
	"github.com/gin-gonic/gin"
)

type UserRequest struct {
	Id       int    `uri:"id"`
	Nickname string `json:"nickname"`
	Mobile   string `json:"mobile"`
	Email    string `json:"email"`
}

func main() {
	g := gin.Default()
	g.GET("/user/:id", func(c *gin.Context) {
		// how to do?
	})
	g.Run(":9000")
}
```

```
curl -v -X POST \
  http://localhost:8080/user/12\
  -H 'content-type: application/json' \
  -d '{"nickname": "nickname1","mobile": "133232323232","email": "fqlw@qqq.com"

```


## Description

Undefined validation function 'required_if' on field 'Field'

[https://godoc.org/github.com/go-playground/validator#hdr-Required_If](url)

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)

type ListReq struct {
        Id        int64  `form:"id" binding:"required,gte=1"`
	AppCode   string `form:"appCode" binding:"required"`
	BranchTag string `form:"branchTag" binding:"required_if=Id 1"`
}

func main() {
	g := gin.Default()
	g.GET("/list", func(c *gin.Context) {
		var form ListReq
	        if err := c.ShouldBindQuery(&form); err != nil {
		       c.String(http.StatusOK, "error")
		       return
	        }
                c.String(http.StatusOK, "ok")
	})
	g.Run(":9000")
}
```

## Expectations
```
$ curl -i http://localhost:9000/list
ok
```

## Actual result

```

$ curl -i http://localhost:9000/list
curl: (52) Empty reply from server

Undefined validation function 'required_if' on field 'BranchTag'
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/go-playground/validator/v10/cache.go:289 (0xd6ae36)
	(*Validate).parseFieldTagsRecursive: panic(strings.TrimSpace(fmt.Sprintf(undefinedValidation, current.tag, fieldName)))
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/go-playground/validator/v10/cache.go:150 (0xd68e27)
	(*Validate).extractStructCache: ctag, _ = v.parseFieldTagsRecursive(tag, fld.Name, "", false)
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/go-playground/validator/v10/validator.go:37 (0xd71aed)
	(*validate).validateStruct: cs = v.v.extractStructCache(current, typ.Name())
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/go-playground/validator/v10/validator_instance.go:304 (0xd7a02d)
	(*Validate).StructCtx: vd.validateStruct(ctx, top, val, val.Type(), vd.ns[0:0], vd.actualNs[0:0], nil)
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/go-playground/validator/v10/validator_instance.go:277 (0xd79ad6)
	(*Validate).Struct: return v.StructCtx(context.Background(), s)
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/binding/default_validator.go:30 (0xeebedd)
	(*defaultValidator).ValidateStruct: if err := v.validate.Struct(obj); err != nil {
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/binding/binding.go:115 (0xeebd29)
	validate: return Validator.ValidateStruct(obj)
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/binding/query.go:20 (0xef2ca4)
	queryBinding.Bind: return validate(obj)
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/context.go:679 (0xf00c11)
	(*Context).ShouldBindWith: return b.Bind(c.Request, obj)
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/context.go:654 (0xf00785)
	(*Context).ShouldBindQuery: return c.ShouldBindWith(obj, binding.Query)
I:/source/go/src/dev-zt-api.2345.cn/controller/webapi/appMobileController.go:186 (0x12af8c4)
	CompList: if err := c.ShouldBindQuery(&form); err != nil {
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/context.go:161 (0xefcb5b)
	(*Context).Next: c.handlers[c.index](c)
I:/source/go/src/dev-zt-api.2345.cn/middleware/user/user.go:45 (0x127f4d2)
	User.func1: c.Next()
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/context.go:161 (0xefcb5b)
	(*Context).Next: c.handlers[c.index](c)
I:/source/go/src/dev-zt-api.2345.cn/middleware/trace/traceLog.go:37 (0x12b6ae4)
	LogBase.func1: c.Next()
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/context.go:161 (0xefcb5b)
	(*Context).Next: c.handlers[c.index](c)
I:/source/go/src/dev-zt-api.2345.cn/middleware/cors/cors.go:29 (0x12b4cfa)
	Cors.func1: c.Next()
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/context.go:161 (0xefcb5b)
	(*Context).Next: c.handlers[c.index](c)
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/logger.go:241 (0xf174f7)
	LoggerWithConfig.func1: c.Next()
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/context.go:161 (0xefcb5b)
	(*Context).Next: c.handlers[c.index](c)
I:/source/go/src/dev-zt-api.2345.cn/middleware/cors/recovery.go:107 (0x12b6684)
	RecoveryWithWriter.func1: c.Next()
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/context.go:161 (0xefcb5b)
	(*Context).Next: c.handlers[c.index](c)
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/gin.go:409 (0xf09ef2)
	(*Engine).handleHTTPRequest: c.Next()
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/gin.go:367 (0xf0997e)
	(*Engine).ServeHTTP: engine.handleHTTPRequest(c)
C:/Go/src/net/http/server.go:2843 (0x9bf86a)
	serverHandler.ServeHTTP: handler.ServeHTTP(rw, req)
C:/Go/src/net/http/server.go:1925 (0x9b9944)
	(*conn).serve: serverHandler{c.server}.ServeHTTP(w, w.req)
C:/Go/src/runtime/asm_amd64.s:1374 (0x5f5c00)
	goexit: BYTE	$0x90	// NOP
<!-- Actual result showing the problem -->
```

## Environment

- go version:1.5.2
- gin version (or commit ref):1.6.3
- operating system:win10 1909

## Description

I'm trying to pass a file upload and a json with some data. I tried using both c.ShouldBindJSON() and c.FormFile("file"). They work individually but not together. I dont want to pass the json as form-data but I've tried that too but cant get it to find to the custom struct. 

Basically the file I get will be saved and a link of it will be added to database along with some data passed through the same handler. I'm testing using postman.

## How to reproduce
```
type Files struct {
	Id           int64    
	User_Id   int64     
	FileName string   
	Type         string     
	Name         string   
	Link         string  
	Created      time.Time
	Updated      time.Time 
}

func FileUploadHandler() func(c *gin.Context) {
	return func(c *gin.Context) {
	
		var model Files
		err := c.ShouldBindJSON(&model)
		file, err := c.FormFile("file")
		if err != nil {
			fmt.Println(err)
			c.String(http.StatusBadRequest, fmt.Sprintf("get form err: %s", err.Error()))
			return
		}
		
		fileSrc := "../uploads/" + filename
		// FILE SAVED
		if err := c.SaveUploadedFile(file, fileSrc); err != nil {
	
			c.JSON(http.StatusBadRequest, fmt.Sprintf("upload file err: %s", err.Error()))
			return
		}else{
			err:=model.Add
			if err!=nil{
				c.JSON(http.StatusInternalServerError, fmt.Sprintf("upload file err: %s", err.Error()))
				return

			}else{
				c.JSON(200, gin.H{
					"success": "files added successfully",
				})
			}
		}
	}
}
```

## Actual result

I get this error:
multipart: NextPart: bufio: buffer full
```

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


## Description

The json data parsed to `interface{}` can be output well with c.JOSN and c.YAML. But when i output it with c.XML, an error will be reported. like `xml: unsupported type: map[string]interface {}`.

## How to reproduce

```
package main
import (
	"github.com/gin-gonic/gin"
	"encoding/json"
)
func main() {
	router := gin.Default()
	router.GET("/*uri", func(c *gin.Context) {
		var a interface{}
		b := []byte(`{"Name":"Wednesday","Age":6,"Parents":["Gomez","Morticia"]}`)
		json.Unmarshal(b, &a)
		c.XML(200, a)
	})
	router.Run("127.0.0.1:8080")
}
```

## Environment

- go version: 1.14.2
- gin version (or commit ref): 1.6.3
- operating system: windows10



I want to get the data in the body of response. How can I get this data


## Description

Can't install dependencies using `dep ensure` due to error: "Solving failure: No versions of github.com/go-playground/validator met constraints" (full error below)

I'm new to Go and Gin, so I may be missing something obvious, but I found [this comment](https://github.com/go-playground/validator/issues/565#issuecomment-575471064) in a `go-playground/validator` issue where one of the contributors seems to be saying that there could be a change made on the gin side to get around this. I've tried the other suggestions from that issue, but it's still failing. So I'm hoping someone can suggest a solution here.

## How to reproduce

1. Create project in GOPATH src directory: C:\dev\go\src\github.com\paltamadura\go-api\
    1. echo %GOPATH% C:\dev\go 
1. Run `go mod init`
    1. Contents are two lines: `module github.com/paltamadura/go-api` and `go 1.14`
1. Manually create `Gopkg.toml` with the contents below (manually creating because of another issue where `dep init` hangs on Windows)
1. Run `dep ensure`

```toml
[[constraint]]
  name = "github.com/gin-gonic/gin"
  version = "1.6.3"

[[constraint]]
  name = "github.com/lib/pq"
  version = "1.0.0"

[prune]
  go-tests = true
  unused-packages = true
```

## Expectations

`dep ensure` installs dependencies successfully

## Actual result

dep ensure
Solving failure: No versions of github.com/go-playground/validator met constraints:
        v10.3.0: Could not introduce github.com/go-playground/validator@v10.3.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v10.2.0: Could not introduce github.com/go-playground/validator@v10.2.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v10.1.0: Could not introduce github.com/go-playground/validator@v10.1.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v10.0.1: Could not introduce github.com/go-playground/validator@v10.0.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v10.0.0: Could not introduce github.com/go-playground/validator@v10.0.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.31.0: Could not introduce github.com/go-playground/validator@v9.31.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.30.2: Could not introduce github.com/go-playground/validator@v9.30.2, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.30.1: Could not introduce github.com/go-playground/validator@v9.30.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.30.0: Could not introduce github.com/go-playground/validator@v9.30.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.29.1: Could not introduce github.com/go-playground/validator@v9.29.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.29.0: Could not introduce github.com/go-playground/validator@v9.29.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.28.0: Could not introduce github.com/go-playground/validator@v9.28.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.27.0: Could not introduce github.com/go-playground/validator@v9.27.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.26.0: Could not introduce github.com/go-playground/validator@v9.26.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.25.0: Could not introduce github.com/go-playground/validator@v9.25.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.24.0: Could not introduce github.com/go-playground/validator@v9.24.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.23.0: Could not introduce github.com/go-playground/validator@v9.23.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.22.0: Could not introduce github.com/go-playground/validator@v9.22.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.21.1: Could not introduce github.com/go-playground/validator@v9.21.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.21.0: Could not introduce github.com/go-playground/validator@v9.21.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.20.2: Could not introduce github.com/go-playground/validator@v9.20.2, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.20.1: Could not introduce github.com/go-playground/validator@v9.20.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.20.0: Could not introduce github.com/go-playground/validator@v9.20.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.19.0: Could not introduce github.com/go-playground/validator@v9.19.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.18: Could not introduce github.com/go-playground/validator@v9.18, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.17.1: Could not introduce github.com/go-playground/validator@v9.17.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.17.0: Could not introduce github.com/go-playground/validator@v9.17.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.16.1: Could not introduce github.com/go-playground/validator@v9.16.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.16.0: Could not introduce github.com/go-playground/validator@v9.16.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.15.0: Could not introduce github.com/go-playground/validator@v9.15.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.14.0: Could not introduce github.com/go-playground/validator@v9.14.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.13.0: Could not introduce github.com/go-playground/validator@v9.13.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.12.0: Could not introduce github.com/go-playground/validator@v9.12.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.11.0: Could not introduce github.com/go-playground/validator@v9.11.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.10.0: Could not introduce github.com/go-playground/validator@v9.10.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.9.4: Could not introduce github.com/go-playground/validator@v9.9.4, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.9.3: Could not introduce github.com/go-playground/validator@v9.9.3, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.9.2: Could not introduce github.com/go-playground/validator@v9.9.2, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.9.1: Could not introduce github.com/go-playground/validator@v9.9.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.9.0: Could not introduce github.com/go-playground/validator@v9.9.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.8.0: Could not introduce github.com/go-playground/validator@v9.8.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.7.0: Could not introduce github.com/go-playground/validator@v9.7.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.6.0: Could not introduce github.com/go-playground/validator@v9.6.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.5.0: Could not introduce github.com/go-playground/validator@v9.5.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.4.0: Could not introduce github.com/go-playground/validator@v9.4.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.3.6: Could not introduce github.com/go-playground/validator@v9.3.6, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.3.5: Could not introduce github.com/go-playground/validator@v9.3.5, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.3.4: Could not introduce github.com/go-playground/validator@v9.3.4, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.3.3: Could not introduce github.com/go-playground/validator@v9.3.3, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.3.2: Could not introduce github.com/go-playground/validator@v9.3.2, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.3.1: Could not introduce github.com/go-playground/validator@v9.3.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.3.0: Could not introduce github.com/go-playground/validator@v9.3.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.2.2: Could not introduce github.com/go-playground/validator@v9.2.2, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.2.1: Could not introduce github.com/go-playground/validator@v9.2.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.2.0: Could not introduce github.com/go-playground/validator@v9.2.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.1.3: Could not introduce github.com/go-playground/validator@v9.1.3, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.1.2: Could not introduce github.com/go-playground/validator@v9.1.2, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.1.1: Could not introduce github.com/go-playground/validator@v9.1.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.1.0: Could not introduce github.com/go-playground/validator@v9.1.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9: Could not introduce github.com/go-playground/validator@v9, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.0.0: Could not introduce github.com/go-playground/validator@v9.0.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.18.2: Could not introduce github.com/go-playground/validator@v8.18.2, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.18.1: Could not introduce github.com/go-playground/validator@v8.18.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.18.0: Could not introduce github.com/go-playground/validator@v8.18.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.17.3: Could not introduce github.com/go-playground/validator@v8.17.3, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.17.2: Could not introduce github.com/go-playground/validator@v8.17.2, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.17.1: Could not introduce github.com/go-playground/validator@v8.17.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.17: Could not introduce github.com/go-playground/validator@v8.17, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.16: Could not introduce github.com/go-playground/validator@v8.16, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.15.1: Could not introduce github.com/go-playground/validator@v8.15.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.15: Could not introduce github.com/go-playground/validator@v8.15, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.14: Could not introduce github.com/go-playground/validator@v8.14, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.13: Could not introduce github.com/go-playground/validator@v8.13, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.12: Could not introduce github.com/go-playground/validator@v8.12, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.11: Could not introduce github.com/go-playground/validator@v8.11, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.10: Could not introduce github.com/go-playground/validator@v8.10, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.9: Could not introduce github.com/go-playground/validator@v8.9, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.8.1: Could not introduce github.com/go-playground/validator@v8.8.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.8: Could not introduce github.com/go-playground/validator@v8.8, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.7: Could not introduce github.com/go-playground/validator@v8.7, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.6: Could not introduce github.com/go-playground/validator@v8.6, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.5: Could not introduce github.com/go-playground/validator@v8.5, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.4: Could not introduce github.com/go-playground/validator@v8.4, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.3: Could not introduce github.com/go-playground/validator@v8.3, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.2: Could not introduce github.com/go-playground/validator@v8.2, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.1: Could not introduce github.com/go-playground/validator@v8.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8.0.1: Could not introduce github.com/go-playground/validator@v8.0.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8: Could not introduce github.com/go-playground/validator@v8, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v7.2: Could not introduce github.com/go-playground/validator@v7.2, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v7.1: Could not introduce github.com/go-playground/validator@v7.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v7: Could not introduce github.com/go-playground/validator@v7, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v6.8: Could not introduce github.com/go-playground/validator@v6.8, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v6.7: Could not introduce github.com/go-playground/validator@v6.7, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v6.6: Could not introduce github.com/go-playground/validator@v6.6, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v6.5.1: Could not introduce github.com/go-playground/validator@v6.5.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v6.5: Could not introduce github.com/go-playground/validator@v6.5, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v6.4: Could not introduce github.com/go-playground/validator@v6.4, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v6.3: Could not introduce github.com/go-playground/validator@v6.3, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v6.2: Could not introduce github.com/go-playground/validator@v6.2, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v6.1.1: Could not introduce github.com/go-playground/validator@v6.1.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v6.1: Could not introduce github.com/go-playground/validator@v6.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v6.0.2: Could not introduce github.com/go-playground/validator@v6.0.2, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v6.0.1: Could not introduce github.com/go-playground/validator@v6.0.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v6.0: Could not introduce github.com/go-playground/validator@v6.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.12: Could not introduce github.com/go-playground/validator@v5.12, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.11: Could not introduce github.com/go-playground/validator@v5.11, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.10.3: Could not introduce github.com/go-playground/validator@v5.10.3, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.10.2: Could not introduce github.com/go-playground/validator@v5.10.2, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.10.1: Could not introduce github.com/go-playground/validator@v5.10.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.10: Could not introduce github.com/go-playground/validator@v5.10, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.9.2: Could not introduce github.com/go-playground/validator@v5.9.2, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.9.1: Could not introduce github.com/go-playground/validator@v5.9.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.9: Could not introduce github.com/go-playground/validator@v5.9, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.8.1: Could not introduce github.com/go-playground/validator@v5.8.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.8: Could not introduce github.com/go-playground/validator@v5.8, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.7.1: Could not introduce github.com/go-playground/validator@v5.7.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.7: Could not introduce github.com/go-playground/validator@v5.7, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.6.1: Could not introduce github.com/go-playground/validator@v5.6.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.6: Could not introduce github.com/go-playground/validator@v5.6, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.5.1: Could not introduce github.com/go-playground/validator@v5.5.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.5: Could not introduce github.com/go-playground/validator@v5.5, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.4: Could not introduce github.com/go-playground/validator@v5.4, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.2: Could not introduce github.com/go-playground/validator@v5.2, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.1: Could not introduce github.com/go-playground/validator@v5.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.0.2: Could not introduce github.com/go-playground/validator@v5.0.2, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5.0.1: Could not introduce github.com/go-playground/validator@v5.0.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5: Could not introduce github.com/go-playground/validator@v5, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v4.0.4: Could not introduce github.com/go-playground/validator@v4.0.4, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v4.0.3: Could not introduce github.com/go-playground/validator@v4.0.3, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v4.0.1: Could not introduce github.com/go-playground/validator@v4.0.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v4.0: Could not introduce github.com/go-playground/validator@v4.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v3.0.2: Could not introduce github.com/go-playground/validator@v3.0.2, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v3.0.1: Could not introduce github.com/go-playground/validator@v3.0.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v3.0: Could not introduce github.com/go-playground/validator@v3.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v2.3: Could not introduce github.com/go-playground/validator@v2.3, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v2.2: Could not introduce github.com/go-playground/validator@v2.2, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v2.1: Could not introduce github.com/go-playground/validator@v2.1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v2.0: Could not introduce github.com/go-playground/validator@v2.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v1.0: Could not introduce github.com/go-playground/validator@v1.0, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        master: Could not introduce github.com/go-playground/validator@master, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        updates-and-fixes: Could not introduce github.com/go-playground/validator@updates-and-fixes, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v4: Could not introduce github.com/go-playground/validator@v4, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v5: Could not introduce github.com/go-playground/validator@v5, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v6: Could not introduce github.com/go-playground/validator@v6, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v7: Could not introduce github.com/go-playground/validator@v7, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8: Could not introduce github.com/go-playground/validator@v8, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9: Could not introduce github.com/go-playground/validator@v9, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v8,8: Could not introduce github.com/go-playground/validator@v8,8, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)
        v9.0.0RC1: Could not introduce github.com/go-playground/validator@v9.0.0RC1, as its subpackage github.com/go-playground/validator/v10 is missing. (Package is required by github.com/gin-gonic/gin@v1.6.3.)


## Environment

- go version: 1.14.4
- gin version (or commit ref): 1.6.3
- operating system: Windows 10

Hello!
I want to have few independent middlewares in same router, for example:
```
func (a *foo) Routes(r gin.IRoutes) {
	r.Use(firstMiddleware()).POST("", ...)
	r.Use(secondMiddleware()).PUT("", ...)
}
```
Currently to call PUT method we need to pass `firstMiddleware` and then `secondMiddleware`. But I want to do that for PUT I need to pass **only** secondMiddleware middleware, not both.
Is it possible? 
Many thanks

## Description
When I use `ginCtx.ClientIP()`, my program got panic. I figured out that in that context, engine is `<nil>`.

## How to reproduce

```
package main

import (
	"fmt"
	"net/http/httptest"
	"testing"
	"github.com/stretchr/testify/require"
	"github.com/gin-gonic/gin"
)

func TestContext(t *testing.T) {
	w := httptest.NewRecorder()
	ginCtx, engine := gin.CreateTestContext(w)
	ginCtx.Header("X-Forwarded-For", "127.0.0.1")

	fmt.Println(ginCtx.ClientIP())
	require.Equal(t, true, engine.ForwardedByClientIP)
}
```

## Expectations
I expected that my program must be run correctly without be panicked. And it would print `127.0.0.1`.

## Actual result
```
panic: runtime error: invalid memory address or nil pointer dereference [recovered]
	panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x38 pc=0x15390d6]
```

## Environment
- go version: go version go1.14.3 darwin/amd64
- gin version: github.com/gin-gonic/gin v1.3.0 
- operating system: macOS Catalina 10.15.5. Macbook Pro 13-inch, 2017.


## Description

Binding uuid.UUID using ShouldBind gives error ["45e1f85e-bca5-458d-bd9c-c56edd8f847b"] is not valid value for uuid.UUID

## How to reproduce
Used Postman to make request:
Content-Type: multipart/form-data
Body with form-data:
key: colorID
value: 45e1f85e-bca5-458d-bd9c-c56edd8f847b

```
// Go model in which I want to map
type Test struct {
     colorID uuid.UUID `binding:"required" form:"colorID"`
}

func test(ctx *gin.Context) {
    t := Test{}
    err := ctx.ShouldBind(&t)
    if err != nil {
	panic(err)
    }
}
```

## Actual result

<!-- Actual result showing the problem -->
```
["45e1f85e-bca5-458d-bd9c-c56edd8f847b"] is not valid value for uuid.UUID
```
I'm serving my index.html like a static file like this:

router.StaticFile("/", "../client/dist/index.html")

It is a Vue PWA application, but i want to disable the cache for index.html because it is caching my production environment variables. The app can sometimes build the dist folder even multiple times during the day only for changing  those variables and because of the service worker cache the client side does not read the new variables.

How can i prevent this from caching using the golang side ?

when i try to enter "go get -u github.com/gin-gonic/gin" in goland terminal, then it shows nothing , wait for 10 sec it prints infos below: 


go get github.com/gin-gonic/gin: module github.com/gin-gonic/gin: Get "https://proxy.golang
.org/github.com/gin-gonic/gin/@v/list": dial tcp 34.64.4.113:443: connectex: A connection a
ttempt failed because the connected party did not properly respond after a period of time,
or established connection failed because connected host has failed to respond.


and i don`t know how to solve ,
when i enter the code in cmd, it worked fine , but i can`t import packages, and can`t find the gin packages
## Description

<!-- Description of a problem -->
I am trying import my static file with Static() function,  but it seem gin can not find the file. How can I fix this?

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
In router
```
router.Static("/static", "/view")
router.LoadHTMLGlob("view/html/**/*")
```

local path
```
├── main.go
└── view
      ├── css
      │     └── style.css
      ├── html
      │     ├── component
      │     └── meta
      │           └── index.html
      └── js
             └── render.js
```

HTML import
```
<link rel="stylesheet" href="/static/css/style.css" >
```

and my console in debug mode show that handlers has generate
```
[GIN-debug] GET    /static/*filepath         --> github.com/gin-gonic/gin.(*RouterGroup).createStaticHandler.func1 (3 handlers)
[GIN-debug] HEAD   /static/*filepath         --> github.com/gin-gonic/gin.(*RouterGroup).createStaticHandler.func1 (3 handlers)
```

## Expectations

rend css file correctly

## Actual result

<!-- Actual result showing the problem -->

404 response of the css file

my custom log
```
2020-07-01T07:05:15.747+0800    INFO    /static/123.js  {"status": 404, "method": "GET"}
```

## Environment

- go version: go1.13.4 linux/amd64
- gin version (or commit ref): v1.5.0
- operating system: Ubuntu 18.04.4 LTS (Bionic Beaver)

As far as I can tell, there is currently no way to configure internally used jsoniter.
Some options (such as disabled `SortMapKeys`) can provide significant benefits in certain situations.
## Description

Use response writer to write a large tar file (180M) take up too much memory (1.2~1.7G).
I'm new about golang, and I try to search the io memory solution but I can't find. I hope somebody can help me :0

## How to reproduce

```
r.GET("/download", func(c *gin.Context) {
                ......
                data := buf.Bytes() //the memory take up 500M
		c.Writer.WriteHeader(http.StatusOK)
		c.Header("Content-Disposition", "attachment; filename=a.tar")
		c.Header("Content-Type", "application/octet-stream")
		c.Header("Content-Length", fmt.Sprintf("%d", len(data)))
		c.Writer.Write(data) //the memory take up 1.2~1.7G
}
```

## Expectations

Low memory usage

## Environment

- go version:go1.13.8 linux/amd64
- gin version (or commit ref):v1.6.3
- operating system:Ubuntu 18.04

- With issues:
  - custom logger

## Description

What I would expect is to log the body data of the request if the method of the request is not GET.
However, in the repository that handles the contents of config, it works properly. In the place where the repository is imported, the request body is output as empty.

## How to reproduce
### Origin Repository
```go
package footprint

import (
	"fmt"
	"github.com/gin-gonic/gin"
	satori "github.com/satori/go.uuid"
	"io/ioutil"
	"net/http"
	"time"
)

const (
	defaultLogFormat            = "%s %-7s %s %s %3d %s [remote ip: \"%15s\", proto: \"%s\", agent: \"%s\"] -> \"%s\"(request id: %s) %v %13v error: \"%s\"\n"
	defaultLogFormatWithReqBody = "%s %-7s %s %s %3d %s [remote ip: \"%15s\", proto: \"%s\", agent: \"%s\"] -> \"%s\"(request id: %s) %v %13v request: \"%s\" error: \"%s\"\n"
)

func NewLoggerConfig(formatter func(gin.LogFormatterParams) string, skipPaths []string) gin.LoggerConfig {
	return gin.LoggerConfig{
		Formatter: formatter,
		SkipPaths: skipPaths,
	}
}

func DefaultLoggerFormatter(param gin.LogFormatterParams) string {
	requestID := generateRequestID()
	param.Request.Header.Set("X-Request-Id", requestID)

	if param.Method != http.MethodGet {
		reqBody, _ := ioutil.ReadAll(param.Request.Body)
		return loggingWithReqBodyLog(param, string(reqBody))
	}

	return loggingDefaultLog(param)
}

func loggingWithReqBodyLog(param gin.LogFormatterParams, reqBody string) string {
	var statusColor, methodColor, resetColor string
	if param.IsOutputColor() {
		statusColor = param.StatusCodeColor()
		methodColor = param.MethodColor()
		resetColor = param.ResetColor()
	}

	return fmt.Sprintf(defaultLogFormatWithReqBody,
		methodColor, param.Method, resetColor,
		statusColor, param.StatusCode, resetColor,
		param.ClientIP,
		param.Request.Proto,
		param.Request.UserAgent(),
		param.Path,
		param.Request.Header.Get("X-Request-Id"),
		param.TimeStamp.Format(time.RFC3339),
		param.Latency,
		reqBody,
		param.ErrorMessage,
	)
}
```

### Repository to import and use
```go
func setUpRouter() *gin.Engine {
	config := newCorsConfig()

	r := gin.New()

	r.Use(config, useLogger(footprint.DefaultLoggerFormatter), gin.Recovery())

	// health checker
	r.GET("/")

	registerRoute(r)

	return r
}

func useLogger(formatter func(params gin.LogFormatterParams) string) gin.HandlerFunc {
	loggerConfig := footprint.NewLoggerConfig(formatter, skipPaths)
	return gin.LoggerWithConfig(loggerConfig)
}
```

```text
## Expectations
 POST      400  [remote ip: "               ", proto: "HTTP/1.1", agent: ""] -> "/"(request id: e3b81155-d137-45f2-9f94-a7d8ab318de8) 2020-06-23T10:34:15+09:00      16.022µs request: "{"id":1,"name":"test","created_at":"2020-06-23T10:34:15.179062+09:00"}" error: ""
```
```text
## Actual result
 POST      400  [remote ip: "               ", proto: "HTTP/1.1", agent: ""] -> "/"(request id: 982ad35f-991b-4591-932a-d770dc5adb52) 2020-06-23T10:30:58+09:00       6.891µs request: "" error: ""
```

## Environment

- go version: 1.12
- gin version (or commit ref): 1.6.3
- operating system: MacOS Catalina(10.15.5)

## Description

Conflict map when use path parameter and static url in same url resource

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/path/:dynamicpath", func(c *gin.Context) {
		c.String(200, "Hello dynamic", c.Param("name"))
	})
	g.GET("/path/staticpath", func(c *gin.Context) {
		c.String(200, "Hello static", c.Param("name"))
	})

	g.Run(":9000")
}
```
## Expectations
Both url's are mapping in Gin Engine
## Actual result

```
panic: 'staticpath' in new path '/path/staticpath' conflicts with existing wildcard ':dynamicpath' in existing prefix '/path/:dynamicpath'

goroutine 1 [running]:
github.com/gin-gonic/gin.(*node).addRoute(0xc00046b110, 0xc0002cc456, 0xa, 0xc000302570, 0x6, 0x6)
        /Users/bi001189/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/tree.go:215 +0x152b
github.com/gin-gonic/gin.(*Engine).addRoute(0xc00013b900, 0xc00011fbe0, 0x3, 0xc0002cc450, 0x10, 0xc000302570, 0x6, 0x6)
        /Users/bi001189/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/gin.go:264 +0x1e7
github.com/gin-gonic/gin.(*RouterGroup).handle(0xc00013b900, 0xc00011fbe0, 0x3, 0xc00011fbb0, 0x10, 0xc000302570, 0x6, 0x6, 0x0, 0x0)
        /Users/bi001189/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/routergroup.go:75 +0x132
github.com/gin-gonic/gin.(*RouterGroup).Handle(0xc00013b900, 0xc00011fbe0, 0x3, 0xc00011fbb0, 0x10, 0xc000119840, 0x5, 0x8, 0x0, 0x0)
        /Users/bi001189/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/routergroup.go:93 +0x15d
main.registerGinEngine(0xc000121160, 0x11, 0x1, 0x101, 0xc000144480, 0x2, 0x2, 0x1, 0x1388, 0xc00010ed20, ...)
```

## Environment

- go version: 1.14.4
- gin version (or commit ref): 1.6.3
- operating system: macOS Catalina 10.15.5 (19F96)

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

I'm trying to redirect users to login page if they are not authenticated . an if I'm in /note and want to 
redirect to /user/login it redirects me to /note/user/login

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
func IsAuthenticated() gin.HandlerFunc {
	return func(c *gin.Context) {
		c.Next()
		fmt.Println("im here")
		token, err := c.Cookie("token")
		if err != nil {
			c.Redirect(http.StatusFound, "/user/login")
                        return
		}

		u, timeout, err := user.UserByToken(token)
		if err != nil {
			c.Redirect(http.StatusFound, "/user/login")
                        return
		}
		if time.Now().After(*timeout){
				c.Redirect(http.StatusFound, "/user/login")
                        return

		}
		c.Set("user", u)
	}
}
```
```
func Routers(r *gin.Engine) {
	note := r.Group("/note")
	note.GET("/", middleware.IsAuthenticated(), Index)
}
```
````
func Index(c *gin.Context){
	u, _ := c.Get("user")

	notes, err := note.Find(u.(user.User).ID)
	if err != nil {
		c.HTML(http.StatusBadRequest, "error.html", gin.H{
			"Error": err.Error(),
		})
		return
	}
	c.HTML(http.StatusOK, "list.html", gin.H{
		"Title": "user list",
		"Notes": notes,
	})
	return
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
/user/login
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl -i http://localhost:8080/note/
/note/user/login
```

## Environment

- go version:
- gin version (or commit ref):
- operating system:

I am having a weird issue here 

Notice the below url

`/codes/confirm?api_key=adad&api_secret=adad&request_id=adaadaad&code=269215&number=+23470********`

Whenever I do 
`number:=c.Query("number")`

Number is always coming out as **23470********** without the **+** character. Why is this? I need to preserve the **+** character. Is there a work around to this?
## Description

The [documentation](https://godoc.org/github.com/gin-gonic/gin#Engine.Use) for the `Use` function says

>Use attaches a global middleware to the router. ie. the middleware attached though Use() will be included in the handlers chain for every single request. Even 404, 405, static files... For example, this is the right place for a logger or error management middleware.

But this is not accurate since the router can return a redirect without executing any of the declared middlewares. https://github.com/gin-gonic/gin/blob/master/gin.go#L406-L434

For some middlewares it is ok. But for features such as CORS, instrumentation, rate-limiting and others, it is not.

## How to reproduce

```
package main

import (
	"log"
	"net/http"
	"time"

	"github.com/gin-gonic/gin"
)

func main() {
	router := gin.Default()

	router.RedirectTrailingSlash = true
	router.RedirectFixedPath = true
	router.HandleMethodNotAllowed = true

	router.Use(func(c *gin.Context) {
		t := time.Now()
		log.Print(c.Request.URL.String())

		c.Next()

		log.Print(time.Since(t))
		log.Println(c.Writer.Status())
	})

	router.GET("/foo/bar", func(context *gin.Context) {
		context.JSON(http.StatusOK, gin.H{"hello": "world"})
	})

	router.Run(":8080")
}
```

and then

```
$ curl http://localhost:8080/foo//bar/

<a href="/foo/bar">Moved Permanently</a>.
```

## Expectations

I would expect 3 custom log lines in the stdout
```
[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.

[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /foo/bar                  --> main.main.func2 (4 handlers)
[GIN-debug] Listening and serving HTTP on :8080
2020/06/15 18:21:49 /foo//bar/
2020/06/15 18:21:49 275.831µs
2020/06/15 18:21:49 301
[GIN-debug] redirecting request 301: /foo//bar/ --> /foo//bar
```

## Actual result

The logs are not present because the middleware is not executed
```
[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.

[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /foo/bar                  --> main.main.func2 (4 handlers)
[GIN-debug] Listening and serving HTTP on :8080
[GIN-debug] redirecting request 301: /foo//bar/ --> /foo//bar
```

## Environment

- go version: 1.14.3
- gin version (or commit ref): 1.6.3
- operating system: darwin

I have an endpoint that uses an optional query parameter via DefaultQuery(). 
In one unit test case I want to test the route with that parameter.
I write that test as
```go
	w := httptest.NewRecorder()
	c, _ := gin.CreateTestContext(w)
	routeHandler(c)
```
And this panics when routeHandler() calls c.DefaultQuery() because c.Request == nil.

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- in router
```
r.GET("/api/call",
		auth.LoginHandler,
		TokenParsing)
```

- handler chain: 
TokenParsing after LoginHandler 

```
func (mw *GinJWTMiddleware) LoginHandler(c *gin.Context) {
	/*
		...
	*/
			c.JSON(http.StatusOK, gin.H{
				"code":   http.StatusOK,
				"token":  token,
				"expire": expire.Format(time.RFC3339),
			})
}
```

```
func TokenParsing(c *gin.Context) {
	/*
		In here, is there a way to get 'token' value from login handler?
	*/
}
```
In TokenParsing handler, how can i get 'token' value from login handler? 
If anyone knows this, please let me know.. thank you 
I found this point can enhance speed of BasicAuth func.
- go version: go version go1.14.1 darwin/amd64
- gin version (or commit ref): 1.6.3
- operating system:

```
2020/06/12 14:27:43 http: panic serving 127.0.0.1:52658: write tcp 127.0.0.1:80->127.0.0.1:52658: write: broken pipe
goroutine 34342467 [running]:
net/http.(*conn).serve.func1(0xc00024dae0)
	/usr/local/go/src/net/http/server.go:1772 +0x139
panic(0x1071f40, 0xc001250f00)
	/usr/local/go/src/runtime/panic.go:975 +0x3e3
github.com/gin-gonic/gin/render.JSON.Render(...)
	/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/render/json.go:59
github.com/gin-gonic/gin.(*Context).Render(0xc0008490e0, 0x1f4, 0x138dfe0, 0xc000ebdcf0)
	/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/context.go:841 +0x146
github.com/gin-gonic/gin.(*Context).JSON(...)
	/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/context.go:884
pkg.poizon.com/golang/go-common/globally.(*Handler).RecoveryWithLogger.func1.1(0xc0008490e0)
	/go/pkg/mod/pkg.poizon.com/golang/go-common@v0.0.0-20200608152559-b4436c72198f/globally/handler.go:53 +0x370
panic(0x1071f40, 0xc001250f00)
	/usr/local/go/src/runtime/panic.go:969 +0x166
github.com/gin-gonic/gin/render.JSON.Render(...)
	/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/render/json.go:59
github.com/gin-gonic/gin.(*Context).Render(0xc0008490e0, 0xc8, 0x138dfe0, 0xc000ebdb50)
	/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/context.go:841 +0x146
github.com/gin-gonic/gin.(*Context).JSON(...)
	/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/context.go:884
pkg.poizon.com/golang/go-common/gin_controller.(*Controller).Response(0xc000402420, 0xc0008490e0, 0xf84fc0, 0xc001094bc0)
	/go/pkg/mod/pkg.poizon.com/golang/go-common@v0.0.0-20200608152559-b4436c72198f/gin_controller/controller.go:48 +0x17a
pkg.poizon.com/sns/sns-content/pkg/controllers.(*ContentController).Detail(0xc000402420, 0xc0008490e0)
	/drone/src/pkg/controllers/content.go:44 +0x16a
github.com/gin-gonic/gin.(*Context).Next(0xc0008490e0)
	/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/context.go:161 +0x3b
pkg.poizon.com/golang/go-common/server.(*GinServer).Localizer(0xc0000a4360, 0xc0008490e0)
	/go/pkg/mod/pkg.poizon.com/golang/go-common@v0.0.0-20200608152559-b4436c72198f/server/server.go:164 +0x1d9
github.com/gin-gonic/gin.(*Context).Next(0xc0008490e0)
	/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/context.go:161 +0x3b
pkg.poizon.com/golang/go-common/tracer.(*TracerServer).MiddlewareTracerFunc(0xc0007803f0, 0xc0008490e0)
	/go/pkg/mod/pkg.poizon.com/golang/go-common@v0.0.0-20200608152559-b4436c72198f/tracer/server.go:87 +0x651
github.com/gin-gonic/gin.(*Context).Next(0xc0008490e0)
	/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/context.go:161 +0x3b
pkg.poizon.com/golang/go-common/server.(*Prometheus).HandlerFunc.func1(0xc0008490e0)
	/go/pkg/mod/pkg.poizon.com/golang/go-common@v0.0.0-20200608152559-b4436c72198f/server/prometheus.go:325 +0xbc
github.com/gin-gonic/gin.(*Context).Next(0xc0008490e0)
	/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/context.go:161 +0x3b
pkg.poizon.com/golang/go-common/globally.(*Access).GinZap.func1(0xc0008490e0)
	/go/pkg/mod/pkg.poizon.com/golang/go-common@v0.0.0-20200608152559-b4436c72198f/globally/access.go:37 +0xfad
github.com/gin-gonic/gin.(*Context).Next(0xc0008490e0)
	/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/context.go:161 +0x3b
pkg.poizon.com/golang/go-common/globally.(*Handler).RecoveryWithLogger.func1(0xc0008490e0)
	/go/pkg/mod/pkg.poizon.com/golang/go-common@v0.0.0-20200608152559-b4436c72198f/globally/handler.go:67 +0x4e
github.com/gin-gonic/gin.(*Context).Next(0xc0008490e0)
	/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/context.go:161 +0x3b
github.com/gin-gonic/gin.(*Engine).handleHTTPRequest(0xc0001f4a00, 0xc0008490e0)
	/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/gin.go:409 +0x666
github.com/gin-gonic/gin.(*Engine).ServeHTTP(0xc0001f4a00, 0x1395ee0, 0xc00138c2a0, 0xc000d2ae00)
	/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/gin.go:367 +0x14d
net/http.serverHandler.ServeHTTP(0xc0006f6000, 0x1395ee0, 0xc00138c2a0, 0xc000d2ae00)
	/usr/local/go/src/net/http/server.go:2807 +0xa3
net/http.(*conn).serve(0xc00024dae0, 0x139b4e0, 0xc000f09c80)
	/usr/local/go/src/net/http/server.go:1895 +0x86c
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2933 +0x35c
```

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

<!-- Description of a problem -->
[Bug] BindQuery will trim the substring after character semicolon`;`

```
$ curl 'localhost:8088/get?seq="1;2;3"&text=word1;word2'
{"text":"word1;word2"}
```

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main
import (
    "github.com/gin-gonic/gin"
    "net/http"
    _"fmt"
)
type Params struct {
    Text     string `form:"text" binding:"required"`
}

func main() {
    router := gin.Default()

    router.GET("/get", func(c *gin.Context) {
        var params Params
        if err := c.ShouldBind(&params); err == nil {
            c.JSON(http.StatusOK, gin.H{"text": params.Text})
        }
    })

    router.Run(":8088")
}

```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl 'localhost:8088/get?seq="1;2;3"&text=word1;word2'
{"text":"word1"}
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl 'localhost:8088/get?seq="1;2;3"&text=word1;word2'
{"text":"word1"}
```

## Environment

- go version: 1.12.17
- gin version (or commit ref):  v1.4.0
- operating system: Mac OSX 10.15.2

```golang

func h1(c *gin.Context) {
	u := c.Param("user")
	c.JSON(200, u)
	h2(c.Copy()) // is this ok?
}

// h2 is a handler can be called by http request and other functions
func h2(c *gin.Context) {
	u := c.Param("from_h1") // how can I set Param/body/form in h1?
	c.JSON(200, u)
}

```

I want to add a uniform response header to all the processing functions, but it does not work


As shown in the figure below, I want to add a custom header "X-TIME" after the processing is completed, but it does not work.
``` go
package main

import "github.com/gin-gonic/gin"
func main() {
	r:=gin.Default()
	g:=r.Group("/res", func(context *gin.Context) {
		context.Next()

		//I want to add a unified response header here,
		//but it is invalid.
		context.Header("X-TIME","time")
	})
	g.GET("/", func(context *gin.Context) {
		//it is valid.
		context.Header("X-KEY","key")
		context.JSON(200,gin.H{
			"key":"value",
		})
	})
	r.Run(":18080")
}

```
Hello!

I've enable logger color print for windows console.
I've use  [github.com/shiena/ansicolor](https://github.com/shiena/ansicolor) for it.





- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

<!-- Description of a problem -->

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/hello/:name", func(c *gin.Context) {
		c.String(200, "Hello %s", c.Param("name"))
	})
	g.Run(":9000")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl http://localhost:8201/hello/world
Hello world
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl -i http://localhost:8201/hello/world
<YOUR RESULT>
```

## Environment

- go version:
- gin version (or commit ref):
- operating system:

I would love to be able to just log using gin, so I don't have to import anything else.

I love it, it is simple, colored, fantastic. I'm quite new to Go and gin, and I'm not sure how to solve.

I was expecting, or better said, thought it would use something like an internal logger.

Is there any way to log As gin? or using gin's internal logger 

```
[INFO] Starting Server
[GIN] 2020/05/29 - 08:37:58 | 200 |     116.336µs |             ::1 | GET      "/api/v1/status/ping"
[GIN] 2020/05/29 - 08:37:58 | 404 |         656ns |             ::1 | GET      "/favicon.ico"
```

looks like:

![Screen Shot 2020-05-29 at 8 45 20 AM](https://user-images.githubusercontent.com/10869684/83272729-c327a180-a188-11ea-9b7c-2bbddde8b08b.png)



```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
        gin.DefaultWriter.Write([]byte("[INFO] Starting Server\n"))
	router.Run(":8080")
}
```
## Environment

- go version: latest
- gin version (or commit ref): latest
- operating system: OSX (Darwin)

## Description
Hi I'hitting a roadblock when trying to get a file stream from a client sending a file via multipart. I would to allow a multipart upload and stream it to S3 (which takes an `io.reader` to upload) without saving the file to disk (or keeping the full copy in memory).
So far, I use `multipart.FileHeader` and bind the request directly but `FileHeader.Open()` may save the file to a temp location if too big. Is there a way to do this?

My understanding is that `MustBindWith` will instantiate the `multipart.FileHeader` which will upload the file, save it in memory if it's less than 10Mb and save it to a temp file otherwise. In any ways it's not a direct stream from the client.

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```golang
package main

import (
	"github.com/gin-gonic/gin"
	"github.com/gin-gonic/gin/binding"
	"mime/multipart"
)

type FileUploadParam struct {
	File multipart.FileHeader `form:"file" binding:"required"`
}

func Upload(c *gin.Context) {
	var p FileUploadParam
	if err := c.MustBindWith(&p, binding.FormMultipart); err == nil {
		file, _ := p.File.Open()
		// file may or may not be in memory
		// I can use file in s3.PutObject as it is a io.Reader but it is from local memory not sreamed from client
	}
}
func main() {
	g := gin.Default()
	g.POST("/upload", Upload)
	g.Run(":9000")
}
```
Hello! When are you planning to change go version from 1.13 to 1.14?
Thank you!
```
r := gin.New()
r.Use(func (ctx *gin.Context) {
    var (
        sign = ctx.Query("sign")
        start = time.Now()
    )
    if sign == "" {
        sign = ctx.PostForm("sign")
    }
    // check request sign
    // if !BOOL {ctx.Abort();return}

    ctx.Next()
}, func (ctx, *gin.Context) {
    requestData, _ := ctx.GetRawData()
    ctx.Request.Body = ioutil.NopCloser(bytes.NewBuffer(requestData))
    ctx.Next()

    var (
        latency = time.Now().Sub(start) / time.Millisecond
        logData, _ = json.Marshal(gin.H{
                "latency": latency,
                "request": requestData,
        })
    )
    log.Info(requestData )
})
r.POST("/doit", func (ctx *gin.Context) {
    var raw = ctx.GetRawData() // raw is empty
   //  ......
})
```

- when i used like this, handler get raw data is empty
- so change like these, no use  ioutil.NopCloser, no empty

> sorry for my english
Currently, if  I want to set grpc metadata in context, I need to create a new context in every grpc call, if it is able to set grpc metadata in gin.Context, then I can write a router middleware for this, it wil save a lot of repeated work.
## Description

https://tools.ietf.org/html/rfc7231#section-6.5.5 says

>The origin server MUST generate an Allow header field in a 405 response containing a list of the target resource's currently supported methods.

gin does not do this with `HandleMethodNotAllowed` set to `true`. Also it is arguable that even with this setting enabled, all HTTP/1.0 requests should still be given a 404 error as HTTP 1.0 does not define 405.

## How to reproduce

Server:
```
package main

import (
	"net/http"

	"github.com/gin-gonic/gin"
)

func main() {
	router := gin.Default()
	router.GET("hi", func(c *gin.Context) {
		name := c.Param("name")
		c.String(http.StatusOK, "Hello %s", name)
	})
	router.HandleMethodNotAllowed = true
	router.Run()
}
```

Test:
```
$ curl -D- localhost:8080/hi -XPOST
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
HTTP/1.0 405 Method Not Allowed
Allow: GET
```

## Actual result

<!-- Actual result showing the problem -->
```
HTTP/1.0 405 Method Not Allowed
Content-Type: text/plain
Date: Mon, 25 May 2020 21:53:14 GMT
Content-Length: 22

405 method not allowed
```

## Environment

- go version: go version go1.14.3 darwin/amd64
- gin version (or commit ref): v1.6.3
- operating system: Mac

I am trying to pass some variables after some processes on my `Handler` function. How can I `redirect `to a new page an pass some json variables to this new template?

```go
// main package
func main() {
    apiRoutes := gin.Default()
    apiRoutes.POST("api/ipg/send", controllers.GatewayIpgSendHandler)
    apiRoutes.GET("ipg/:token", controllers.GatewayIpgRequestHandler)

    // ... rest of the codes
}


// controllers package
func GatewayIpgRequestHandler(context *gin.Context) {
    // some processes that lead to these variables.
    wage := 123
    amount := 13123
    redirectUrl := "www.test.com/callback"


    // What should I do here to pass those
    // three variables above to an existing `custom-view.tmpl` file
    // in my `templates` folder.

}
```
New test case added  for custom format using DebugPrintRouteFunc()
## Description
Cancelling a request with the AbortController doesn't seems to cancel the request context.
Details about the AbortController: https://developer.mozilla.org/en-US/docs/Web/API/AbortController/abort

## How to reproduce
Query an endpoint via javascript while aborting the request like the example on the mozilla doc. 

## Expectations
Gin c.Request.Context().Done() triggers.

## Actual result
Gin c.Request.Context().Done() never gets triggered.


## Environment
- go version: 1.14.1
- gin version (or commit ref): 1.6.3
- operating system: Ubuntu 18


json ->  jsonData, avoid conflicts with json package names
onlyfilesFS -> onlyFilesFS,  little camel-case
## Description
Error in golang is very annoying.
Is it possible to develop a solution to deal with error elegantly like Java's Lombok in GIN?
Maybe read comments in code and generate "if err!=nil......" before compiling.

## Example
Before compiling
**CONVERT**
```golang
    // @BadRequest
    err := c.ShouldBindJSON(&req)
```
**TO**
```golang
    err := c.ShouldBindJSON(&req)
    if err!=nil{
        // Bad request response
        return
    }
```
- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.

remove an unused type SecureJSONPrefix in render/json.go
- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.

remove an unused type SecureJSONPrefix in render/json.go
Refer to issue https://github.com/gin-gonic/gin/issues/444

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.



- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.

There are two same functions in github.com/gin-gonic/gin/internal/bytesconv.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.

There are two same functions in `github.com/gin-gonic/gin/internal/bytesconv`.
I saved state in session for google login callback validation. But I found that session state saved by first request on server is overridden by second 
one. 
OldCommentStatus CommentStatusCode `form:"old_comment_status,default=-1" json:"old_comment_status,default=-1"` // form's default work but json's default do't work！！！
## Description
on windows console log have not color just print
```
[GIN] 2020/05/19 - 15:46:43 |?[97;42m 200 ?[0m|      1.9264ms | xxx |?[97;44m
```

and i use this lib to fix color print
```
github.com/shiena/ansicolor
```
maybe need  official  to solve it 

the same port with nginx, not panic

## Description

my nginx conf:

```
server {
    listen       4000;
    server_name  localhost;
    location ~  {
        proxy_pass   http://127.0.0.1:3000;
    }
  }
```

and my code is
```
package main

import "github.com/gin-gonic/gin"

func main() {
	r := gin.Default()
	r.GET("/ping", func(c *gin.Context) {
		c.JSON(200, gin.H{
			"message": "pong",
		})
	})
	err := r.Run(":4000")
	if err != nil {
		panic(err)
	}
}
```
my nginx is runing used 4000, then run code with use 4000, why not panic ?

## Environment

- go version go1.14.2 darwin/amd64
- nginx version: nginx/1.17.10  (brew install nginx) 
- operating system: mac 10.15.4



Hi,

I'm using the CORS middleware shown below to apply a CORS policy to all endpoints. All endpoints should only allow requests from the host `example.com`, except for the endpoint `/logging`. This endpoint should allow requests from all origins. I came up with the solution shown below but I'm not sure if it can be spoofed. Can a request, for example, be sent to `/protected/by/cors` but still show `/logging` as `c.Request.URL.Path` so that it passes through the middleware and doesn't get blocked?

**Cors middleware:**

```go
func Cors(c *gin.Context) {
	origin := "example.com"
	path := c.Request.URL.Path

	if path == "/logging" {
		origin = "*"
	}

	c.Writer.Header().Set("Access-Control-Allow-Origin", origin)
	c.Writer.Header().Set("Access-Control-Allow-Credentials", "true")
	c.Writer.Header().Set("Access-Control-Allow-Headers", "Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization, accept, origin, Cache-Control, X-Requested-With")
	c.Writer.Header().Set("Access-Control-Allow-Methods", "POST, DELETE, GET, PUT, OPTIONS")

	if c.Request.Method == "OPTIONS" {
		c.AbortWithStatus(204)
		return
	}

	c.Next()
}
```

**Used only once before registering routes:**

```go
func InitRoutes(router *gin.Engine, store store.InterfaceStore) {
	router.Use(middlewares.Cors)

	// registering all routes
}
```
If you have a `required` upload file field inside your HTML form, when you send that form with empty file field the binding returns an error like so:
```go
&json.SyntaxError{msg:"unexpected end of JSON input", Offset:0}
```
while it must return a validation error!

Simply this PR will fix #2376 
```go
package convert

import (
	"bytes"
	"strings"
	"testing"
)

var (
	strColon = []byte(":")
	strStar  = []byte("*")
)

func countParamsOld(path string) uint16 {
	var n uint
	for i := range []byte(path) {
		switch path[i] {
		case ':', '*':
			n++
		}
	}
	return uint16(n)
}

func countParamsNew(path string) uint16 {
	var n uint
	s := strToBytes(path)
	n += uint(bytes.Count(s, strColon))
	n += uint(bytes.Count(s, strStar))
	return uint16(n)
}

var foo = strings.Repeat("/:param", 256)

func BenchmarkCountParamsOld(b *testing.B) {
	for i := 0; i < b.N; i++ {
		countParamsOld(foo)
	}
}

func BenchmarkCountParamsNew(b *testing.B) {
	for i := 0; i < b.N; i++ {
		countParamsNew(foo)
	}
}
```

## Performance result

```sh

goos: linux
goarch: amd64
BenchmarkCountParamsOld-48    	 3000000	      1751 ns/op	       0 B/op	       0 allocs/op
BenchmarkCountParamsNew-48    	30000000	       148 ns/op	       0 B/op	       0 allocs/op
```
Hey there.
I've created this PR in order to add the **IContext** interface. The reason behind doing this is to expose the methods that Context has using an interface.

Use case:
```golang
type Input IContext

func NewInput(c *Context) Input {
	return c
}

func example(i Input) {
	i.Get() // Works out of the box.
}
```

I didn't add any tests because it doesn't need to change gin's internal behavior. I also didn't add any documentation for the same reason.
Hi There
```go
package main

import (
    "fmt"
    "mime/multipart"
    "net/http"

    "github.com/gin-gonic/gin"
)

type ProfileForm struct {
    Name   string                `form:"name" binding:"required"`
    Avatar *multipart.FileHeader `form:"avatar" binding:"required"`

    // or for multiple files
    // Avatars []*multipart.FileHeader `form:"avatar" binding:"required"`
}

func main() {
    router := gin.Default()
    router.POST("/profile", func(c *gin.Context) {
        // you can bind multipart form with explicit binding declaration:
        // c.ShouldBindWith(&form, binding.Form)
        // or you can simply use autobinding with ShouldBind method:
        var form ProfileForm
        // in this case proper binding will be automatically selected
        if err := c.ShouldBind(&form); err != nil {
            c.String(http.StatusBadRequest, "bad request")
            fmt.Printf("err: %#v\n", err)
            return
        }

        err := c.SaveUploadedFile(form.Avatar, "./avatar/" + form.Avatar.Filename)
        if err != nil {
            c.String(http.StatusInternalServerError, "unknown error")
            return
        }

        // db.Save(&form)

        c.String(http.StatusOK, "ok")
    })
    router.Run(":8080")
}
```
This gin example for file upload.
If I run below command it works fine,
```
curl -X POST -v --form name=user --form "avatar=@./avatar.png" http://localhost:8080/profile
```
But if I don't provide the avatar file like so it wont give me validation error like this field is required instead giving me that strange error:
```
curl -X POST -v --form name=user --form avatar="" http://localhost:8080/profile
```
```go
err: &json.SyntaxError{msg:"unexpected end of JSON input", Offset:0}
```

Thanks!

## Description

Request.Body.Read get body data lost

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

g := gin.Default()
	g.POST("/kubernetes/api/v1.10/controller", func(c *gin.Context) {
		jsons := make([]byte, c.Request.ContentLength)
		fmt.Println(c.Request.ContentLength)
		if _, err := c.Request.Body.Read(jsons); err != nil {
			if err.Error() != "EOF" {
				return
			}
		}
		fmt.Println(jsons)
		fmt.Println(string(jsons))
		c.String(200, "Hello %s", c.Param("name"))
	})
	g.Run(":8080")
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl --location --request POST 'http://192.168.138.128:8080/kubernetes/api/v1.10/controller?productId=100&namespace=default&cluster=c_6812529878I&type=json' \
--header 'Content-Type: application/json' \
--header 'Content-Type: text/plain' \
--data-raw '{
    "kind": "Deployment",
    "apiVersion": "apps/v1",
    "metadata": {
        "name": "ffff",
        "namespace": "default",
        "selfLink": "/apis/apps/v1/namespaces/default/deployments/ffff",
        "uid": "fd9a29af-344a-4bdd-bd76-bf3876c7d4b8",
        "resourceVersion": "51091212",
        "generation": 14,
        "creationTimestamp": "2020-05-07T08:21:23Z",
        "labels": {
            "app": "ffff"
        },
        "annotations": {
            "deployment.kubernetes.io/revision": "14"
        }
    },
    "spec": {
        "replicas": 1,
        "selector": {
            "matchLabels": {
                "app": "ffff"
            }
        },
        "template": {
            "metadata": {
                "creationTimestamp": null,
                "labels": {
                    "app": "ffff"
                }
            },
            "spec": {
                "containers": [
                    {
                        "name": "ffff-35kd89",
                        "image": "nginx",
                        "ports": [
                            {
                                "name": "aaaaa",
                                "containerPort": 80,
                                "protocol": "TCP"
                            }
                        ],
                        "resources": {},
                        "livenessProbe": {
                            "tcpSocket": {
                                "port": "df"
                            },
                            "initialDelaySeconds": 1,
                            "timeoutSeconds": 1,
                            "periodSeconds": 10,
                            "successThreshold": 1,
                            "failureThreshold": 3
                        },
                        "readinessProbe": {
                            "tcpSocket": {
                                "port": 90
                            },
                            "initialDelaySeconds": 1,
                            "timeoutSeconds": 1,
                            "periodSeconds": 10,
                            "successThreshold": 1,
                            "failureThreshold": 3
                        },
                        "terminationMessagePath": "/dev/termination-log",
                        "terminationMessagePolicy": "File",
                        "imagePullPolicy": "IfNotPresent"
                    }
                ],
                "restartPolicy": "Always",
                "terminationGracePeriodSeconds": 30,
                "dnsPolicy": "ClusterFirst",
                "securityContext": {},
                "schedulerName": "default-scheduler"
            }
        },
        "strategy": {
            "type": "RollingUpdate",
            "rollingUpdate": {
                "maxUnavailable": "25%",
                "maxSurge": "25%"
            }
        },
        "revisionHistoryLimit": 10,
        "progressDeadlineSeconds": 600
    },
    "status": {
        "observedGeneration": 14,
        "replicas": 2,
        "updatedReplicas": 1,
        "readyReplicas": 1,
        "availableReplicas": 1,
        "unavailableReplicas": 1,
        "conditions": [
            {
                "type": "Available",
                "status": "True",
                "lastUpdateTime": "2020-05-12T11:00:23Z",
                "lastTransitionTime": "2020-05-12T11:00:23Z",
                "reason": "MinimumReplicasAvailable",
                "message": "Deployment has minimum availability."
            },
            {
                "type": "Progressing",
                "status": "False",
                "lastUpdateTime": "2020-05-12T11:10:24Z",
                "lastTransitionTime": "2020-05-12T11:10:24Z",
                "reason": "ProgressDeadlineExceeded",
                "message": "ReplicaSet \"ffff-6bcd6b9f7b\" has timed out progressing."
            }
        ]
    }
}'
```

## Browser request Actual result
{
    "kind": "Deployment",
    "apiVersion": "apps/v1",
    "metadata": {
        "name": "ffff",
        "namespace": "default",
        "selfLink": "/apis/apps/v1/namespaces/default/deployments/ffff",
        "uid": "fd9a29af-344a-4bdd-bd76-bf3876c7d4b8",
        "resourceVersion": "51091212",
        "generation": 14,
        "creationTimestamp": "2020-05-07T08:21:23Z",
        "labels": {
            "app": "ffff"
        },
        "annotations": {
            "deployment.kubernetes.io/revision": "14"
        }
    },
    "spec": {
        "replicas": 1,
        "selector": {
            "matchLabels": {
                "app": "ffff"
            }
        },
        "template": {
            "metadata": {
                "creationTimestamp": null,
                "labels": {
                    "app": "ffff"
                }
            },
            "spec": {
                "containers": [
                    {
                        "name": "ffff-35kd89",
                        "image": "nginx",
                        "ports": [
                            {
                                "name": "aaaaa",
                                "containerPort": 80,
                                "protocol": "TCP"
                            }
                        ],
                        "resources": {},
                        "livenessProbe": {
                            "tcpSocket": {
                                "port": "df"
                            },
                            "initialDelaySeconds": 1,
                            "timeoutSeconds": 1,
                            "periodSeconds": 10,
                            "successThreshold": 1,
                            "failureThreshold": 3
                        },
                        "readinessProbe": {
                            "tcpSocket": {
                                "port": 90
                            },
                            "initialDelaySeconds": 1,
                            "timeoutSeconds": 1,
                            "periodSeconds": 10,
                            "successThreshold": 1,
                            "failureThreshold": 3
                        },
                        "terminationMessagePath": "/dev/termination-log",
                        "terminationMessagePolicy": "File",
                        "imagePullPolicy": "IfNotPresent"
                    }
                ],
                "restartPolicy": "Always",
                "terminationGracePeriodSeconds": 30,
                "dnsPolicy": "ClusterFirst",
                "securityContext": {},
                "schedulerName": "default-scheduler"
            }
        },
        "strategy": {
            "type": "RollingUpdate",
            "rollingUpdate": {
                "maxUnavailable": "25%",
                "maxSurge": "25%"
            }
        },
        "revisionHistoryLimit": 10,
        "progressDeadlineSeconds": 600
    },
    "status": {
        "observedGeneration": 14,
        "replicas": 2,
        "updatedReplicas": 1,
        "readyReplicas": 1,
        "availableReplicas": 1,
        "unavailableReplicas": 1,
        "conditions": [
            {
                "type": "Available",
                "status": "True",
                "lastUpdateTime": "2020-05-12T11:00:23Z",
                "lastTrans

## Explanation
`json data is no longer complete`
c.Request.ContentLength = 4039
The actual reception is less than 4039
`Browser request cannot get full json, curl can`
<!-- Actual result showing the problem -->

## Environment

- go version: 1.14
- gin version (or commit ref): v1.6.2
- operating system: Ubuntu 18.04.1 LTS

- With issues:
  

## Description

How to get raw http request headers, format like this,I want to write file

<img width="1570" alt="截屏2020-05-13 上午10 48 29" src="https://user-images.githubusercontent.com/60533474/81766000-c7588b80-9507-11ea-848f-a33eac2bb248.png">


## How to reproduce

## Expectations



## Actual result



## Environment

- go version: 1.14.2
- gin version (or commit ref): v1.6.2
- operating system: macOS

We are using Haproxy on our server. Our gin version was **v1.4.0** end everyting was working great. However when I updated gin **v.1.6.3**, the service always responded with 404 in all routes. By the way, when I try to access directly, the responses are OK. So the problem is about Haproxy and gin v.1.6.3 I think.

Our Haproxy configuration is:
```
backend user-service
   reqrep ^([^\ ]*)\ /user(.*)     \1\ /\2
   balance roundrobin
   server manager01 127.0.0.1:8080
```
My dummy test service which responds 404 is this:
```
package main

import (
	"net/http"
	"github.com/gin-gonic/gin"
)

func main() {
	router := gin.Default()
	router.POST("/test", func(c *gin.Context) {
		name := c.Param("name")
		c.String(http.StatusOK, "Hello %s", name)
	})
	router.Run(":8080")
}
```

Should it be a bug or something in this version?

## Environment
- go version: 1.4.2
- gin version 1.6.3
- operating system: Ubuntu 18.04

```
if !cond {
}
// else code
```
instead of
```
if cond {
} else {
}
```
![image](https://user-images.githubusercontent.com/32809471/81548146-6f0e7600-93af-11ea-8145-a9c346846258.png)
访问的地址被重定向到原来的地址

api的定义为 api.GET("/:code/download/", HandleDownload)

解决方式是更改api为
api的定义为 api.GET("/:code/download", HandleDownload)

显然gin中的func joinPaths(absolutePath, relativePath string) string 并没有起作用
![image](https://user-images.githubusercontent.com/32809471/81548426-ddebcf00-93af-11ea-9dc7-d5b7601b6a0c.png)


i want to learn gin framework 
i am new to programing and i want to learn gin so i can build websites with golang 
and i dont find any real useful sorce of  raw learning website 
can you lead me to some gin learning resorces   
 i think that you shold have a website with a docs section  
1. Add `*Params` in context.
2. move `maxParams` counts to engine
## Description

According to the docs at:
https://godoc.org/github.com/gin-gonic/gin#Context.JSONP

> JSONP serializes the given struct as JSON into the response body. It add padding to response body to request data from a server residing in a different domain than the client. It also sets the Content-Type as "application/javascript".


This does not seem to be the case? There is no padding added and the content-type is set to "application/json" not "application/javascript" as if JSON() was called.

## How to reproduce
```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/", func(ctx *gin.Context) {
		ctx.JSONP(200, gin.H{
			"somefield": "woop",
		})
	})
	g.Run()
}
```

## Expectations

The response should be padded appropriately and the response header content-type should be "application/javascript".

## Actual result

There is no padding added and the response content-type is set to "application/json".

## Environment

- go version: go version go1.14.2 windows/amd64
- gin version (or commit ref): v1.6.2
- operating system: Windows 10 x64, also reproduced on Fedora 31 x64

## Proposed changes

While using func `context.FullPath()`, I encountered an issue that it always returns previous registered parent path. It's fine when I change the registration order.

Example: 

```go
func (s *testSuite) registerTest() {
	s.router.GET("/user/:id/status", s.processWithStatus())
	s.router.GET("/user/:id", s.processWithID())
}

func (s *testSuite) processWithStatus() gin.HandlerFunc {
	return func(c *gin.Context) {
		logger.Infof("XXX - FullPath /user/:id/status ---> %s", c.FullPath())
		return
	}
}

func (s *testSuite) processWithID() gin.HandlerFunc {
	return func(c *gin.Context) {
		logger.Infof("XXX - FullPath /user/:id ---> %s", c.FullPath())
		return
	}
}
```

Result: 
```
XXX - FullPath /user/:id/status ---> /service/api/v1/user/:id/status
XXX - FullPath /user/:id ---> /service/api/v1/user/:id/status
```

But, when I register with different the order of router, such as: 

```go
func (s *testSuite) registerTest() {
	s.router.GET("/user/:id", s.processWithID())
	s.router.GET("/user/:id/status", s.processWithStatus())
}
```

It's every thing so ok. 

I have fix this bug and updated the test case. 
Hope you spend your time review and accept my pull request with this issue.

## Types of changes

- [x] Bugfix (non-breaking change which fixes an issue)

## Checklist

- [x] Lint and unit tests pass locally with my changes

testing repo: https://github.com/appleboy/web-framework-benchmark

## before

script:

```sh
$ go get github.com/gin-gonic/gin@v1.6.3
$ go test -bench=. -benchtime=10s
```

result: 

```
BenchmarkGinStatic-8               23306             50344 ns/op            8283 B/op        157 allocs/op
BenchmarkGinGitHubAPI-8            16506             71542 ns/op           10801 B/op        203 allocs/op
BenchmarkGinGplusAPI-8            284379              4061 ns/op             685 B/op         13 allocs/op
BenchmarkGinParseAPI-8            153843              7657 ns/op            1361 B/op         26 allocs/op
```

## after

script:

```sh
$ go get github.com/gin-gonic/gin@1bd5a8f
$ go test -bench=. -benchtime=10s
```

result: 

```
BenchmarkGinStatic-8              246488             46740 ns/op            9915 B/op        314 allocs/op
BenchmarkGinGitHubAPI-8           176192             65348 ns/op           12940 B/op        406 allocs/op
BenchmarkGinGplusAPI-8           3298646              3747 ns/op             811 B/op         26 allocs/op
BenchmarkGinParseAPI-8           1683153              7003 ns/op            1620 B/op         52 allocs/op
```
- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


product.GET("/:id",controller.GetProductById)
product.GET("/order/:id",controller.GetOrderWhitProduct)

When the two routes exist ,go build error



fix bug that tag form:"page_no,default=1" are not effective in some cases, e.g: http://host/list?page_no=&page_size=

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


## Description
- Firstly I'm querying data from MongoDB with "providerName" and returning it in response.
- Here the order of object is not preserving.
<!-- Description of a problem -->

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
/* 
Sample data in database
{
	"_id" : ObjectId("5eb2c12ff21aca93ec9d8c79"),
	"title" : "vmware",
	"config_attributes" : {
		"vsphere_username" : "",
		"vsphere_password" : "",
		"vsphere_server" : "",
		"allow_unverified_ssl" : ""
	}
}
*/

type Providers struct {
	ID               primitive.ObjectID `json:"_id,omitempty" bson:"_id,omitempty"`
	Title            string             `json:"title,omitempty" bson:"title,omitempty" binding:"required"`
	ConfigAttributes map[string]string  `json:"config_attributes" bson:"config_attributes,omitempty" binding:"required"`
}

// GetOneProvider : Fetch provider with name
func GetOneProvider(c *gin.Context) {

	providerName := c.Param("provider_name")
	var provider Providers
	provider,err := db.GetProvider(providerName)
	if err != nil {
		c.JSON(http.StatusInternalServerError, gin.H{
			"message": "Something went wrong",
		})
		return
	}

	c.JSON(http.StatusOK, provider)
}

```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl http://localhost:8000/providers/vmware
{
	"_id" : ObjectId("5eb2c12ff21aca93ec9d8c79"),
	"title" : "vmware",
	"config_attributes" : {
		"vsphere_username" : "",
		"vsphere_password" : "",
		"vsphere_server" : "",
		"allow_unverified_ssl" : ""
	}
}
```

## Actual result

<!-- Actual response -->
As you can see order of objects inside `config_attributes` is not preserved (seems to be in alphabetical order)
```
$ curl http://localhost:8000/providers/vmware
{
    "_id": "5eb2c12ff21aca93ec9d8c79",
    "title": "vmware",
    "config_attributes": {
        "allow_unverified_ssl": "",
        "vsphere_password": "",
        "vsphere_server": "",
        "vsphere_username": ""
    }
}
```

#### so is there any way to preserve order of json objects in response?
fix bug that tag `form:"page_no,default=1"` are not effective in some cases, e.g: http://host/list?page_no=&page_size=

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.



old: https://godoc.org/github.com/gin-gonic/gin
new: https://pkg.go.dev/github.com/gin-gonic/gin?tab=doc

As title. Gin v1.6.3 benchmark result.

as title
example 1:
`CreatedAts  []time.Time       `form:"createdAt" time_format:"2006-01-02 15:04:05" example:"2019-09-09 12:12:12,2019-09-09 12:12:12"`

when i get url?createdAt=2019-09-09 12:12:12&createdAt=2020-09-09 12:12:12，it can work success,but sometimes i need post data.

example 2:
`CreatedAts1 []time.Time `form:"createdAt" json:"createdAt" time_format:"2006-01-02 15:04:05" example:"2019-09-09 12:12:12,2019-09-09 12:12:12"`

when i post url,and the data is {created:["2019-09-09 12:12:12","2020-09-09 12:12:12"]},it can word faill,get nothing.

example 3:
```
CreatedAts1 []Locatime `form:"createdAt" json:"createdAt" time_format:"2006-01-02 15:04:05" example:"2019-09-09 12:12:12,2019-09-09 12:12:12"

...

func (t *LocalTime) UnmarshalJSON(bs []byte) error {
	var s string
	err := json.Unmarshal(bs, &s)
	if err != nil {
		return err
	}
	l, err := time.ParseInLocation(TimeLayout, s, time.UTC)
	if err != nil {
		return err
	}
	*t = LocalTime{Time: l}
	return nil
}

func (t LocalTime) MarshalJSON() ([]byte, error) {
	//格式化秒
	var stamp = fmt.Sprintf(`"%s"`, t.Format(TimeLayout))
	return []byte(stamp), nil
}

```

when i post url,and the data is {created:["2019-09-09 12:12:12","2020-09-09 12:12:12"]},it can word success,but if the http method is get ,it will tip:invalid character '-' after top-level value
fix #2350 

See the report: https://github.com/gin-gonic/gin/issues/2350

Change `*sync.RWMutex` to `sync.RWMutex`. See [the commet](https://github.com/gin-gonic/gin/pull/2305#discussion_r399993737)

## step and result

Testing in my Macbook Pro

```
$ go get github.com/gin-gonic/gin@d5a42fc8ac93cebe42cde9c9b91a138358e4f99a
go: github.com/gin-gonic/gin d5a42fc8ac93cebe42cde9c9b91a138358e4f99a => v1.6.3-0.20200503042414-d5a42fc8ac93
go: downloading github.com/gin-gonic/gin v1.6.3-0.20200503042414-d5a42fc8ac93
$ go get github.com/julienschmidt/httprouter@master
go: github.com/julienschmidt/httprouter master => v1.3.1-0.20200114094804-8c9f31f047a3
go: downloading github.com/julienschmidt/httprouter v1.3.1-0.20200114094804-8c9f31f047a3
```

Benchmark Result:

```
BenchmarkEcho_Param              	12894638	        88.9 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param               	16120810	        75.8 ns/op	       0 B/op	       0 allocs/op
BenchmarkHttpRouter_Param        	20860491	        59.0 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_Param5             	 5107472	       236 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param5              	 8665498	       139 ns/op	       0 B/op	       0 allocs/op
BenchmarkHttpRouter_Param5       	10716376	       111 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_Param20            	 1649486	       736 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param20             	 3693909	       317 ns/op	       0 B/op	       0 allocs/op
BenchmarkHttpRouter_Param20      	 4302121	       291 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_ParamWrite         	 6067071	       206 ns/op	       8 B/op	       1 allocs/op
BenchmarkGin_ParamWrite          	 7927640	       153 ns/op	       0 B/op	       0 allocs/op
BenchmarkHttpRouter_ParamWrite   	12336866	        97.2 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GithubStatic       	 9660526	       123 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubStatic        	12108596	        99.3 ns/op	       0 B/op	       0 allocs/op
BenchmarkHttpRouter_GithubStatic 	22733364	        53.9 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GithubParam        	 4760176	       241 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubParam         	 6903195	       175 ns/op	       0 B/op	       0 allocs/op
BenchmarkHttpRouter_GithubParam  	 8757140	       139 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GithubAll          	   25303	     47044 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubAll           	   35906	     32017 ns/op	       0 B/op	       0 allocs/op
BenchmarkHttpRouter_GithubAll    	   48505	     24723 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GPlusStatic        	13986368	        88.1 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusStatic         	15715994	        76.2 ns/op	       0 B/op	       0 allocs/op
BenchmarkHttpRouter_GPlusStatic  	40313703	        30.6 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GPlusParam         	 8838810	       132 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusParam          	11063152	       110 ns/op	       0 B/op	       0 allocs/op
BenchmarkHttpRouter_GPlusParam   	14874406	        83.3 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GPlus2Params       	 5957268	       197 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlus2Params        	 8538530	       138 ns/op	       0 B/op	       0 allocs/op
BenchmarkHttpRouter_GPlus2Params 	11009853	       109 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GPlusAll           	  610393	      2072 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusAll            	  845540	      1452 ns/op	       0 B/op	       0 allocs/op
BenchmarkHttpRouter_GPlusAll     	 1000000	      1022 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_ParseStatic        	13372183	        89.4 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseStatic         	15553862	        76.2 ns/op	       0 B/op	       0 allocs/op
BenchmarkHttpRouter_ParseStatic  	36294546	        32.0 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_ParseParam         	10718779	       108 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseParam          	14966005	        82.9 ns/op	       0 B/op	       0 allocs/op
BenchmarkHttpRouter_ParseParam   	18341719	        65.6 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_Parse2Params       	 8146166	       149 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Parse2Params        	11563095	       105 ns/op	       0 B/op	       0 allocs/op
BenchmarkHttpRouter_Parse2Params 	14198692	        83.3 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_ParseAll           	  343478	      3427 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseAll            	  467335	      2817 ns/op	       0 B/op	       0 allocs/op
BenchmarkHttpRouter_ParseAll     	  739195	      1768 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_StaticAll          	   39229	     29002 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_StaticAll           	   50160	     25493 ns/op	       0 B/op	       0 allocs/op
BenchmarkHttpRouter_StaticAll    	   90253	     12674 ns/op	       0 B/op	       0 allocs/op
PASS
ok  	github.com/julienschmidt/go-http-routing-benchmark	67.399s
```

Or you can see the benchmark result from Travis: https://travis-ci.org/github/gin-gonic/go-http-routing-benchmark/jobs/682559844
#1391 trigger the performance issue.

benchmark:

```
pkg: github.com/julienschmidt/go-http-routing-benchmark
BenchmarkEcho_Param        	13535522	        88.0 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param         	 5361892	       238 ns/op	      32 B/op	       1 allocs/op
BenchmarkEcho_Param5       	 5008866	       244 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param5        	 4290758	       272 ns/op	      32 B/op	       1 allocs/op
BenchmarkEcho_Param20      	 1641387	       760 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param20       	 2317610	       521 ns/op	      32 B/op	       1 allocs/op
BenchmarkEcho_ParamWrite   	 5904582	       203 ns/op	       8 B/op	       1 allocs/op
BenchmarkGin_ParamWrite    	 4513596	       267 ns/op	      32 B/op	       1 allocs/op
BenchmarkEcho_GithubStatic 	 9554672	       144 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubStatic  	 4920577	       246 ns/op	      32 B/op	       1 allocs/op
BenchmarkEcho_GithubParam  	 4610731	       246 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubParam   	 4571893	       338 ns/op	      32 B/op	       1 allocs/op
BenchmarkEcho_GithubAll    	   22447	     55123 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubAll     	   18040	     65561 ns/op	    6496 B/op	     203 allocs/op
BenchmarkEcho_GPlusStatic  	12387967	        87.6 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusStatic   	 5539902	       230 ns/op	      32 B/op	       1 allocs/op
BenchmarkEcho_GPlusParam   	 8484045	       136 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusParam    	 4628140	       257 ns/op	      32 B/op	       1 allocs/op
BenchmarkEcho_GPlus2Params 	 5794423	       209 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlus2Params  	 4435572	       260 ns/op	      32 B/op	       1 allocs/op
BenchmarkEcho_GPlusAll     	  567093	      2104 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusAll      	  327002	      3349 ns/op	     416 B/op	      13 allocs/op
BenchmarkEcho_ParseStatic  	13683361	        88.8 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseStatic   	 5690004	       218 ns/op	      32 B/op	       1 allocs/op
BenchmarkEcho_ParseParam   	11511034	       109 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseParam    	 5031255	       247 ns/op	      32 B/op	       1 allocs/op
BenchmarkEcho_Parse2Params 	 7868221	       152 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Parse2Params  	 4861460	       261 ns/op	      32 B/op	       1 allocs/op
BenchmarkEcho_ParseAll     	  318800	      3533 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseAll      	  230422	      6377 ns/op	     832 B/op	      26 allocs/op
BenchmarkEcho_StaticAll    	   40495	     29597 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_StaticAll     	   29606	     42596 ns/op	    5024 B/op	     157 allocs/op
```

Without #1391 commit:

```
pkg: github.com/julienschmidt/go-http-routing-benchmark
BenchmarkEcho_Param        	13765762	        88.7 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param         	16475670	        78.0 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_Param5       	 5095788	       239 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param5        	 8914904	       135 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_Param20      	 1580520	       759 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param20       	 3694677	       321 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_ParamWrite   	 6190405	       204 ns/op	       8 B/op	       1 allocs/op
BenchmarkGin_ParamWrite    	 7506909	       151 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GithubStatic 	 9014336	       130 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubStatic  	10326368	       123 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GithubParam  	 4447852	       279 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubParam   	 6891337	       174 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GithubAll    	   25905	     46867 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubAll     	   36128	     32502 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GPlusStatic  	13771851	        88.7 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusStatic   	16447762	        78.9 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GPlusParam   	 8797988	       133 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusParam    	11276586	       106 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GPlus2Params 	 5849034	       201 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlus2Params  	 9059781	       131 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GPlusAll     	  596871	      1998 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusAll      	  732151	      1584 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_ParseStatic  	12376551	       128 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseStatic   	10699678	       106 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_ParseParam   	 9799104	       127 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseParam    	13203855	       127 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_Parse2Params 	 6864175	       184 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Parse2Params  	10904766	       122 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_ParseAll     	  260600	      4147 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseAll      	  378186	      2756 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_StaticAll    	   30274	     34241 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_StaticAll     	   37824	     28181 ns/op	       0 B/op	       0 allocs/op
```

## How to test

```
git clone https://github.com/appleboy/go-http-routing-benchmark.git
# performance issue
go test -bench="Gin|Echo"
# without performance
go get github.com/gin-gonic/gin@67008be35f5432aeec06641540f3b6df3eac8747
go test -bench="Gin|Echo"
```
…edJSON

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please docuHi, I have add a method named `IndentJsonIndentSpaceNum` for `Engine` to set number of indented blanks when you use `Context.IndentedJSON`.We can use it like this:

```
router := gin.Default()
router.IndentJsonIndentSpaceNum(2)
```

The serialized string of `gin.H {" name ":" test "," age ": 2}` is like:

```
{
  "name":  "test",
  "age": 2
}
```

There are only 2 spaces in front of the `name` field.ment it on the README.


Hi, I have add a method named `IndentJsonIndentSpaceNum` for `Engine` to set number of indented blanks when you use `Context.IndentedJSON`.We can use it like this:

```
router := gin.Default()
router.IndentJsonIndentSpaceNum(2)
```

The serialized string of `gin.H {" name ":" test "," age ": 2}` is like:

```
{
  "name":  "test",
  "age": 2
}
```

There are only 2 spaces in front of the `name` field.

Hi, I have add a method named `IndentJsonIndentSpaceNum` for `Engine` to set number of indented blanks when you use `Context.IndentedJSON`.We can use it like this:

```
router := gin.Default()
router.IndentJsonIndentSpaceNum(2)
```

The serialized string of `gin.H {" name ":" test "," age ": 2}` is like:
```
{
  "name":  "test",
  "age": 2
}
```
There are only 2 spaces in front of the `name` field.
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

<!-- Description of a problem -->
There is bug that form:",default=1", in some cases are not effective

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)

type ListReq struct {
	PageNo   int `form:"page_no,default=1"`
	PageSize int `form:"page_size,default=60"`
}

func main() {
	g := gin.Default()
	g.GET("/list", func(c *gin.Context) {
		req := new(ListReq)
		if err := c.ShouldBindQuery(req); err != nil {
			c.String(400, "err:%+v", err)
			return
		}
		c.String(200, "page_no:%d,page_size:%d", req.PageNo, req.PageSize)
	})
	g.Run(":9000")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl http://localhost:9000/list?page_no=&page_size=

page_no:1,page_size:60
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl -i http://localhost:9000/list?page_no=&page_size=

page_no:0,page_size:0
```

## Environment

- go version: 1.14.1
- gin version (or commit ref):v1.6.2
- operating system:Mac OS 15

fix bug that tag `form:",default=1"` are not effective in some cases, e.g: http://host/list?page_no=&page_size=

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


Hi there!
Is there any built-in approach to convert form values to structs like [gorilla/schema](https://github.com/gorilla/schema) or maybe use `c.Bind` method without validation that gives the same output?
Thanks!
I want my Gin application to run on a different timezone (Asia/Jakarta, UTC +7) and not take the system timezone. How do I do this? 
Hi guys,

Hope you are all well !

Is there a geoip middleware ? to get the country code of incoming requests.

Thanks in advance for any insights or references on that topic.

Cheers,
X
TestUnixSocket fails if you run it twice in a row.  This is due to the unix socket file persisting.  Added defer to clean up.

Whats unclear is the following test TestBadUnixSocket I suspect is just looking for cruft maybe from a prior test or defaults not working, I have not enough background to say.

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


How to Resume an Interrupted Download With gin?

I just find something about this.

http://cavaliercoder.com/blog/downloading-large-files-in-go.html
I think it is better to replace `[] string {}` with `nil` when` key` does not exist, because the zero value of `[] string` type is` nil`.


I think it is better to replace `[] string {}` with `nil` when` key` does not exist, because the zero value of `[] string` type is` nil`。
This allows users to use a single logger within their application for all printing, regardless of level.

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


After upgrading from `v1.1.2` to `v1.6.2`, I sometimes see 500 which is caused by the following error:

```
2020/04/23 06:04:36 [Recovery] 2020/04/23 - 06:04:36 panic recovered:
http2: stream closed
/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/context.go:845 (0x90eca2)
/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/context.go:934 (0x9f8b39)
```


Looks like before `Render` didn't return the error from `Write()`:

https://github.com/gin-gonic/gin/blob/v1.1.4/render/data.go#L18

but in the latest code it is returning the error:

https://github.com/gin-gonic/gin/blob/v1.6.2/render/data.go#L18

---

(update)

I created a repo to reproduce the problem: https://github.com/mkfsn/gin-http2-panic

```
$ go run main.go
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /                         --> main.main.func1 (2 handlers)
[GIN-debug] Listening and serving HTTPS on localhost:8334
Warning: Binary output can mess up your terminal. Use "--output -" to tell
Warning: curl to output it to your terminal anyway, or consider "--output
Warning: <FILE>" to save to a file.
2020/04/23 20:42:52 http2: panic serving 127.0.0.1:51239: http2: stream closed
goroutine 50 [running]:
net/http.(*http2serverConn).runHandler.func1(0xc000256010, 0xc0000e5f67, 0xc00011aa80)
	/usr/local/opt/go/libexec/src/net/http/h2_bundle.go:5706 +0x16b
panic(0x15924e0, 0xc0000209c0)
	/usr/local/opt/go/libexec/src/runtime/panic.go:679 +0x1b2
github.com/gin-gonic/gin.(*Context).Render(0xc0002a20e0, 0xc8, 0x171c5a0, 0xc000246810)
	/Users/mkfsn/Workspaces/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/context.go:845 +0x173
github.com/gin-gonic/gin.(*Context).Data(...)
	/Users/mkfsn/Workspaces/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/context.go:934
main.main.func1(0xc0002a20e0)
	/Users/mkfsn/Workspaces/go/src/github.com/mkfsn/gin-http2-panic/main.go:34 +0x98
github.com/gin-gonic/gin.(*Context).Next(0xc0002a20e0)
	/Users/mkfsn/Workspaces/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/context.go:156 +0x3b
github.com/gin-gonic/gin.LoggerWithConfig.func1(0xc0002a20e0)
	/Users/mkfsn/Workspaces/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/logger.go:241 +0xe1
github.com/gin-gonic/gin.(*Context).Next(0xc0002a20e0)
	/Users/mkfsn/Workspaces/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/context.go:156 +0x3b
github.com/gin-gonic/gin.(*Engine).handleHTTPRequest(0xc00018dcc0, 0xc0002a20e0)
	/Users/mkfsn/Workspaces/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/gin.go:409 +0x66d
github.com/gin-gonic/gin.(*Engine).ServeHTTP(0xc00018dcc0, 0x1720260, 0xc000256010, 0xc000388100)
	/Users/mkfsn/Workspaces/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/gin.go:367 +0x17f
net/http.serverHandler.ServeHTTP(0xc0002a2000, 0x1720260, 0xc000256010, 0xc000388100)
	/usr/local/opt/go/libexec/src/net/http/server.go:2802 +0xa4
net/http.initNPNRequest.ServeHTTP(0x1721e60, 0xc0002467e0, 0xc0002d6000, 0xc0002a2000, 0x1720260, 0xc000256010, 0xc000388100)
	/usr/local/opt/go/libexec/src/net/http/server.go:3365 +0x8d
net/http.(*http2serverConn).runHandler(0xc00011aa80, 0xc000256010, 0xc000388100, 0xc000258020)
	/usr/local/opt/go/libexec/src/net/http/h2_bundle.go:5713 +0x9f
created by net/http.(*http2serverConn).processHeaders
	/usr/local/opt/go/libexec/src/net/http/h2_bundle.go:5447 +0x4eb

```




## Description
I've got a form with two fields for uploading different images that are optional. It works fine if I provide both of the fields with respective files but when I don't set one of them or both the `c.ShouldBind` gives me a strange error like so:
  
<!-- Description of a problem -->

## How to reproduce

```go
package main

import (
	"fmt"
	"mime/multipart"

	"github.com/gin-gonic/gin"
)

type Form struct {
	HeaderImage *multipart.FileHeader `form:"headerimage"`
	LogoImage   *multipart.FileHeader `form:"logoimage"`
}

func main() {
	r := gin.Default()

	r.LoadHTMLFiles("/Users/testacc/Desktop/app/template/create.html")
	r.Static("/static", "web/static")

	r.GET("/test", func(c *gin.Context) {
		c.HTML(200, "create", nil)
	})

	r.POST("/test", func(c *gin.Context) {
		var form Form
		if err := c.ShouldBind(&form); err != nil {
			fmt.Printf("%#v\n", err)
			return
		}
		err := c.SaveUploadedFile(form.LogoImage, form.LogoImage.Filename)
		if err != nil {
			c.String(500, "unknown error")
			return
		}
	})

	r.Run(":3000")
}

```

HTML form
```html
{{define "create"}}
<html lang="en">
<body>
    <div>
        <div>
            <form  action="/test" method="post" enctype="multipart/form-data">
                <div>
                    <input name="logoimage" type="file"  id="logoimage">
                    <label for="logoimage">Choose logo image</label>
                </div>

                <div>
                    <input name="headerimage" type="file"  id="headerimage">
                    <label for="headerimage">Choose header image</label>
                </div>
                <button type="submit">Send</button>
            </form>
        </div>
    </div>
    
</body>
</html>
{{end}}
```

## Expectations
To see it works just fine!

## Actual result
```
go run main.go           
[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.

[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /static/*filepath         --> github.com/gin-gonic/gin.(*RouterGroup).createStaticHandler.func1 (3 handlers)
[GIN-debug] HEAD   /static/*filepath         --> github.com/gin-gonic/gin.(*RouterGroup).createStaticHandler.func1 (3 handlers)
[GIN-debug] GET    /test                     --> main.main.func1 (3 handlers)
[GIN-debug] POST   /test                     --> main.main.func2 (3 handlers)
[GIN-debug] Listening and serving HTTP on :3000
[GIN] 2020/04/23 - 01:54:39 | 200 |     391.041µs |             ::1 | GET      "/test"
&json.SyntaxError{msg:"unexpected end of JSON input", Offset:0}
[GIN] 2020/04/23 - 01:54:41 | 200 |       328.6µs |             ::1 | POST     "/test"

```

## Environment

- go version: 1.13.4
- gin version (or commit ref): 1.6.2
- operating system: macOS
## Description

There is no way to handle validation error If struct field has type "int" and user sends string value.

## How to reproduce

```go
package main

import (
	"fmt"
	"github.com/gin-gonic/gin"
	"github.com/go-playground/validator/v10"
	"net/http"
        "reflect"
)

func main() {
	g := gin.Default()
	g.GET("/articles", func(c *gin.Context) {
		type Paginator struct {
			Page int `form:"page" binding:"required,min=1"`
		}
		var pag Paginator
		if err := c.ShouldBindQuery(&pag); err != nil {
			errs := err.(validator.ValidationErrors)
			respErrors := make(map[string]interface{})
			for _, v := range errs {
				field, _ := reflect.TypeOf(&pag).Elem().FieldByName(v.Field())
				fieldName, _ := field.Tag.Lookup("form")
				respErrors[fieldName] = v.Tag()
			}
			c.JSON(http.StatusBadRequest, gin.H{"errors": respErrors})
			return
		}
		c.String(200, "Articles list is here")
	})
	g.Run(":9000")
}
```

## Expectations

For example: ```/articles?page=1``` is correct but ```/articles?page=stringishere``` throws panic. How to resolve this situation and return correct error message ```{"errors":"page":"Number expected"}```? 

## Environment

- go version: go1.12.7 linux/amd64
- gin version (or commit ref): 1.6.2
- operating system: Linux Mint

## Description
I was trying to use docker cli by fsouza in my project but it produces an error when i compile it. After a few researches i findout what problem is hidden in gin. If you run go mod tidy you can see package golang.org/x/sys v0.0.0-20200116001909-b77594299b42 which is a main problem. This package is used by github.com/mattn/go-isatty v0.0.12
So there is a question: how to fix this dependency?
## How to reproduce
```
package main

import "github.com/fsouza/go-dockerclient"

func main() {
	if _, err := docker.NewClientFromEnv(); err != nil {
		panic(err)
	}
}
```
```
module exec.org/helpme

go 1.14

require (
	github.com/fsouza/go-dockerclient v1.6.4
	github.com/gin-gonic/gin v1.6.2 // indirect
)
```
## Expectations
```
normal compile
```
## Actual result
```
..\..\go\pkg\mod\github.com\docker\docker@v1.4.2-0.20191101170500-ac7306503d23\pkg\system\filesys_windows.go:112:24: cannot use uintptr(unsafe.Pointer(&sd[0])) (ty
pe uintptr) as type *"golang.org/x/sys/windows".SECURITY_DESCRIPTOR in assignment
```
## Environment

- go version: 1.14.2
- gin version (or commit ref): 1.6.2
- operating system: Windows 10



/:name:reset  name is a var,reset is a string
## Description

I would like to bind a query parameter into a custom type (uuid.UUID).
Is there an interface to implement on custom type to support this ?

It works with json binding for example, as custom type implements Unmarshaler interface.

## How to reproduce

```
package main

import (
	"github.com/gin-gonic/gin"
	"github.com/google/uuid"
)

type ID uuid.UUID

type QueryStruct struct {
	MyID ID `form:"id"`
}

func main() {
	g := gin.Default()
	g.GET("/test", func(c *gin.Context) {
		var query QueryStruct
		if err := c.BindQuery(&query); err != nil {
			c.AbortWithError(400, err)
			return
		}
		c.String(200, "OK")
	})
	g.Run(":9000")
}
```

## Expectations

```
$ curl http://localhost:9000/test?id=46697e30-349e-4d21-b586-a18674e50385
OK
```

## Actual result

```
$ curl http://localhost:9000/test?id=46697e30-349e-4d21-b586-a18674e50385
["46697e30-349e-4d21-b586-a18674e50385"] is not valid value for main.ID
```

## Environment

- go version: 1.15.7
- gin version (or commit ref): 1.6.3
- operating system: darwin/amd64

package common

import (
	"ehiv/app/service"
	"ehiv/lib/response"
	"github.com/gin-gonic/gin"
	"github.com/small-ek/antgo/os/config"
	"log"
	"path/filepath"
)

//UploadFile 
func UploadFile(c *gin.Context) {
	var key = config.Decode().Get("file").Get("upload_file_Key").String()
	var path = config.Decode().Get("file").Get("path").String()
	// Source
	file, err := c.FormFile(key)
	if err != nil {
		response.Fail(c, "failed", err)
		return
	}
	log.Println(file.content)
	filepath.Base(file.Filename)
	//hash.Sha1(file.Filename)
	if err := c.SaveUploadedFile(file, path+file.Filename); err != nil {
		response.Fail(c, "failed", err)
		return
	}
	response.Success(c, "success", map[string]interface{}{
		"file_name": file.Filename,
	})
}
## Description

Per route middleware cannot abort even with 

```go
c.Abort()
return
```

## How to reproduce

```go
package middleware

func Login() gin.HandlerFunc {
	return func(c *gin.Context) {
		if err := CheckToken(...); err != nil {
			c.Abort()
			return
		}
		c.Next()
	}
}
```

```go
router.POST("/avatar", controller.UploadAvatar, middleware.Login())
```

## Expectations

should abort if login check failed

## Actual result

the request still went through the controller

## Environment

- go version: go1.14.14 
- gin version (or commit ref): 1.6.3
- operating system: darwin/amd64

## Description

Can you validate data inside a middleware handler? I'd like to do something like this:

``` go
func Binder(t reflect.Type) gin.HandlerFunc {
    return func(c *gin.Context) {
        obj := reflect.New(t).Elem().Interface()
        if err := c.BindQuery(&obj); err != nil {
            c.AbortWithStatus(http.StatusBadRequest)
            return
        }

        c.Set(t.Name(), obj)
    }
}
```

So that later on I could access, let's say, the query data validated to a struct named "Subject" (with gin bindings) by doing:

```go
sub := c.MustGet("Subject").(Subject)
```

Here what's happening is that `obj` is empty. Is this possible? If not by passing `reflect.Type`, could it be done using an interface object? (Maybe one that all types that require validation implement)
When the response has been written, the status code saved in `responseWriter`
should no longer be changed by subsequent calls to `WriteHeader()`.

This fixes for example the logging possibly showing the wrong status code, or
any other middleware function checking the status code.


## Description

Current versions of gin are affected by CVE-2020-28483.
https://nvd.nist.gov/vuln/detail/CVE-2020-28483

## How to reproduce

N/A

## Expectations

Looking for a new release of gin that resolves the identified vulnerability.

## Actual result

N/A

## Environment

- go version: 1.14.4 and higher
- gin version (or commit ref):
- operating system:


go get -u github.com/gin-gonic/gin 
above command doesn't work I decide change above to below in readme.md:
go get -v github.com/gin-gonic/gin
Hi, i wanna ask why is fiber framework faster than gin or beego ?  according to the info in this page: https://github.com/the-benchmarker/web-frameworks

Is it cuz the size of the framework ?

Will gin become as fast as fiber ?

Thank you for help and support.
Deleted redundant spaces
I want to use some original http server methods like func (s *Server) Shutdown(ctx context.Context),so i put the http server in the engine.





Your Bind Json, Should Bind, ShouldBindJSON etc etc things is waste of time, 

trying to get simple json body, it was simply done with net/http:

```
		var payload user
		err := json.NewDecoder(r.Body).Decode(&payload)
		if err != nil {
			log.Println(err)
			http.Error(w, err.Error(), http.StatusBadRequest)
			return
		}
```

but I HAVE TO SPEND ABOUT 1HOURS+ JUST FOR FINDING WHY MY GIN GOT 400 WITHOUT ANY MESSAGE ON SERVER SIDE
Current version of `decodeJSON()` is not checking the existence of foreign characters after the single JSON payload while decoding. On the other hand, `Unmarshal()` from the standard library has this functionality and returns error `invalid character 'h' after top-level value map[]`.

This PR will fix this problem, and `decodeJSON()` will return error **"invalid character after the JSON data"**. Important note - symbols `}` and `]` are ignored by this check.

Also, `TestJSONBindingBindBody()` was modified to provide testing of foreign symbols.


There are duplicate `assert.Equal(t, name, c.Param("name"))` lines in `TestRouteParamsByName` and `TestRouteParamsByNameWithExtraSlash` in `routes_test.go`, so I remove them.
The gin.Content.ShouldBindJSON not recognized the 'false' bool value. **Please see detail below:** 

## How to reproduce: 
```
package handler

import (
    "github.com/gin-gonic/gin"
    "net/http"
)

type prod struct {
    Disable bool `json:"disable" binding:"required"`
}

// New product
func NewProduct(c *gin.Context) {
    var p prod

    // Read request body
    if err := c.ShouldBindJSON(&p); err != nil {
        h := gin.H{"error":err.Error()}
        c.JSON(http.StatusOK, h)
        return
    }

    c.JSON(http.StatusOK, gin.H{"msg":"ok!"})
}
```

## Actual result
```
$ curl http://127.0.0.1:8080/v1/auth/products -X POST -d '{"disable": false}'
{"error":"Key: 'prod.Disable' Error:Field validation for 'Disable' failed on the 'required' tag"}

$ curl http://127.0.0.1:8080/v1/auth/products -X POST -d '{"disable": true}'
{"msg":"ok!"}
```
But the 1st reply is not what we expect.

## Environment

- go version: 1.14.13
- gin version (or commit ref): v1.6.3 using go mod
- operating system: macOS Mojave 10.14.6

After do
```
go get -u github.com/gin-gonic/gin
```
I use `gin.CustomRecovery`. But there are some errors here: CustomRecovery not declared by package gin.

Then I checked the local code, the version of gin is 1.6.3, same with here. But there is no `CustomRecovery` method in the recover.go file.

What can I do for this?
```
gin.H{"a":"a"}
+
gin.H{"b":"b"}
=
gin.H{"a":"a","b":"b"}
```

---

how to easy realization ??

```
func html(c *gin.Context, s string, o interface{}) {
        //   o + gin.H{"b":"b"}

       //o...........
	c.HTML(http.StatusOK, s, o)
}

// return {"a":"a","b":"b"} in html
func CIndexView(c *gin.Context) {
	html(c, "index_index.html", gin.H{
		"a":       "a",
	})
}

```
## Question
If there any bug on multipart form data file receiving? Browser on windows 10 cannot receive response correctly when use auth middleware to reject the request before execute any operational function.

## Description
- Env
Windows 10
Edge browser (Chromium)

- Process to error:
1. Big size file, over 2 MB
2. Uploading file with multipart form with any browser supported js function such as xhr, fetch or others
3. If server code do not process the received form data in handler, but return response directly such as when auth fails.
4. You will get connection_reset error on browser.

- Process to success:
Just change the place of return statement on server code to be after any codes that have processed the received data.

By the way, no problem if use curl to send request directly or use postman to help construct the request.

```
// c.ShouldBind(&obj)  -- before return, browser received 401 correctly
c.JSON(401, gin.H{"test": "test"})
return
// c.ShouldBind(&obj)  -- after return, which means server does not do anything about the post data, browser will get connection_reset error
```

## How to reproduce

- Server Side
<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
        "github.com/gin-contrib/cors"
        "mime/multipart"
	"net/http"
	"strings"
)

type ProfileForm struct {
	Files []*multipart.FileHeader `form:"files" binding:"required"`
	Json string                            `form:"json" binding:"required"`
}

func main() {
	router := gin.Default()
	router.Use(cors.New(cors.Config{
		AllowMethods:     []string{"PUT", "PATCH", "POST", "OPTIONS"},
		AllowHeaders:     []string{"Origin"},
		ExposeHeaders:    []string{"Content-Length"},
		AllowCredentials: true,
		AllowOriginFunc: func(origin string) bool {
			return true
		},
		MaxAge: 12 * time.Hour,
	}))

	// Set a lower memory limit for multipart forms (default is 32 MiB)
	router.MaxMultipartMemory = 8 << 20 // 8 MiB
	router.POST("/upload", func(c *gin.Context) {
		obj := ProfileForm{}

		if strings.Contains(c.GetHeader("content-type"), "multipart") {
			c.JSON(401, gin.H{"test": "test"})
			return
		}

		// Multipart form
		if err := c.ShouldBind(&obj); err != nil {
			c.JSON(406, gin.H{"error": err.Error()})
			return
		}

		form, _ := c.MultipartForm()
		files := form.File["upload[]"]

		for _, file := range files {
			log.Println(file.Filename)

			// Upload the file to specific dst.
			c.SaveUploadedFile(file, "./files")
		}
		c.String(http.StatusOK, fmt.Sprintf("%d files uploaded!", len(files)))
	})
	router.Run(":8080")

}
```

- Client Side
```
<!DOCTYPE html>
<body>
    <input type="file" id="file_upload">
    <button id="btn">send</button>
    <script>
        document.getElementById("btn").addEventListener("click", sendRequest);
        function sendRequest(){
            var data = new FormData()
            data.append("json", JSON.stringify(
                {"data": "test"}
            ))
            var file = document.getElementById("file_upload").files[0]
            data.append("files", file)
            var xhr = new XMLHttpRequest()
            xhr.onreadystatechange = function(){
                if (xhr.status === 200 && xhr.readyState === 4) {
                    console.log(xhr.responseText)
                } else{
                    console.log(xhr.responseText)
                }
            }
            xhr.open("post", "http://127.0.0.1:8080/upload")
            xhr.send(data)
        }
    </script>
</body>
```
Hi, I'm having a problem trying to define different middleware for different routes, please let me know if my understanding is correct and whether this behaviour is supported by the framework

Here it's mentioned that to use a middleware, application need to call `Engine.Use(middleware)`, which in turns call `engine.RouterGroup.Use(middleware)`
https://pkg.go.dev/github.com/gin-gonic/gin#Engine.Use

Here it's mentioned that application can define a *group of routes* that shares common middleware - which is what I want
https://pkg.go.dev/github.com/gin-gonic/gin#RouterGroup.Group

However the engine is only attached to one `RouterGroup`, so not sure how to define multiple `RouterGroup`s for an engine (and whether it's actually supported)
https://pkg.go.dev/github.com/gin-gonic/gin#Engine

Here it's mentioned that once `Run`, the engine will block the goroutine, so not sure if it's possible to define multiple engine, one per router group (and whether it's recommended to do so)
https://pkg.go.dev/github.com/gin-gonic/gin#Engine.Run
```
go version
go version go1.14.5 linux/amd64
```
gin version 1.6.3
// Version is the current gin framework's version.
const Version = "v1.6.3"

```
func Upload(ctx *gin.Context)  {
	// 单文件
	file, err := ctx.FormFile("file")
	fmt.Println(file, err)
}
```

file: test.yaml
```
{{- $app_name := .Values.application.name -}}

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cm-{{$app_name}}-config
data:
  components.php: |
    <?php

    $db = require(__DIR__ . '/db.php');

    $components = [

        'request' => [
            // !!! insert a secret key in the following (if it is empty) - this is required by cookie validation
            'cookieValidationKey' => '3zX3FVJW7jtWMyNc8mHOIiZPzjwh-XIu1',
        ],

        'cache' => [
            'class' => 'yii\caching\FileCache',
        ],

        'user' => [
            'identityClass'   => 'app\models\User',
            'enableAutoLogin' => true,
        ],

        'errorHandler' => [
            'errorAction' => 'touch/errors/error',
        ],

        /*
        'log' => [
            'traceLevel' => YII_DEBUG ? 3 : 0,
            'targets' => [
                [
                    'class'  => 'yii\log\FileTarget',
                    'levels' => ['error', 'warning'],
                ],
            ],
        ],
        */

        'log' =>[
            'traceLevel' => YII_DEBUG ? 3 : 0,
            'targets' => [
                'db' =>[
                    'class'   => 'yii\log\DbTarget',
                    'enabled' => true,
                    'prefix'  => function () {
                        return Yii::$app->user->id;
                    },
                    'categories' => ['admin', 'author'],
                    'levels'     => ['info'],
                    {{ $logTable := "{{%ts_log}}" }}
                    'logTable' => '{{$logTable}}',
                    'logVars'    => [],
                ],
            ],
        ],

        'mailer' => [
            // send all mails to a file by default. You have to set
            // 'useFileTransport' to false and configure a transport
            // for the mailer to send real emails.
            //'useFileTransport' => true,
            'class'            => 'yii\swiftmailer\Mailer',
            'viewPath'         => 'mail',
            'useFileTransport' => false,
            'transport' => [
                'class'      => 'fdsfsf',
                'host'       => 'gsdgsg',
                'port'       => 'gds',
                'encryption' => 'gsdgsd',
                'username'   => 'gdsgsd@gdsgsg.cn',
                'password'   => "dgsgsgsdgs",
            ],
        ],

        'urlManager' => [
            'enablePrettyUrl' => true,
            'showScriptName'  => false,
            'rules'           => [],
        ],

        'redis' => [
            'class'    => 'yii\redis\Connection',
            'hostname' => '{{.Values.redis.session.host}}',
            'port' => {{.Values.redis.session.port}},
            'database' => {{.Values.redis.session.database}},
            'password' => '{{.Values.redis.session.password}}'
        ],
        'redis2' => [
            'class'    => 'yii\redis\Connection',
            'hostname' => '{{.Values.redis.session.host}}',
            'port' => {{.Values.redis.session.port}},
            'database' => {{.Values.redis.session.database}},
            'password' => '{{.Values.redis.session.password}}'
        ],

        'script_authorize_redis_lock' => [
            'class'    => 'yii\redis\Connection',
            'hostname' => '{{.Values.redis.dan.host}}',
            'port' => {{.Values.redis.dan.port}},
            'database' => {{.Values.redis.dan.database}},
            'password' => '{{.Values.redis.dan.password}}',
        ],

        'session' => [
            'class'      => 'yii\redis\Session',
            'useCookies' => true,
            'timeout' => defined('SESSIONID_LIFE_TIME') ? constant('SESSIONID_LIFE_TIME') : 86400,       // session 过期时间
            'redis' => [
              'hostname' => '{{.Values.redis.session.host}}',
              'port' => {{.Values.redis.session.port}},
              'database' => {{.Values.redis.session.database}},
              'password' => '{{.Values.redis.session.password}}'
            ],
        ],

        'aliyunoss' => [
            'class'  => 'app\components\Aliyunoss',
            'config' => $params['oss'],
        ],

        'elasticsearch' => [
            'class'  => 'app\components\Elasticsearch',
            'config' => $params['elasticsearch']
        ],

        'version_upload_log' => [
            'class' => 'app\components\Logger',
            'logFile' => '@runtime/script_upload/'.date('Y-m-d').'.log',
        ],
    ];
    return array_merge($components, $db);

  console.php: |
    <?php

    $params = require(__DIR__ . '/params.php');
    $db = require(__DIR__ . '/db.php');
    $components = require(__DIR__ . '/components.php');
    unset($components['request']);
    unset($components['errorHandler']);
    unset($components['mailer']);
    unset($components['user']);

    $config = [
        'id' => 'basic-console',
        'basePath' => dirname(__DIR__),
        'bootstrap' => ['log'],
        'controllerNamespace' => 'app\commands',

        /*
        'components' => [
            'cache' => [
                'class' => 'yii\caching\FileCache',
            ],
            'log' => [
                'targets' => [
                    [
                        'class' => 'yii\log\FileTarget',
                        'levels' => ['error', 'warning'],
                    ],
                ],
            ],
            'db' => $db,
        ],
        'params' => $params,
        */

        'components'   => $components,
        'params'       => $params,

        /*
        'controllerMap' => [
            'fixture' => [ // Fixture generation command line.
                'class' => 'yii\faker\FixtureController',
            ],
        ],
        */
    ];

    if (YII_ENV_DEV) {
        // configuration adjustments for 'dev' environment
        $config['bootstrap'][] = 'gii';
        $config['modules']['gii'] = [
            'class' => 'yii\gii\Module',
        ];
    }
    return $config;

  db.php: |
    <?php

    return [
        // 触动DB
        'db' => [
            'class'    => 'yii\db\Connection',
            'dsn' => 'mysql:host={{.Values.mysql.main_rw_splitting.host}};dbname={{.Values.mysql.main_rw_splitting.dbname}}',
            'username' => '{{.Values.mysql.main_rw_splitting.user}}',
            'password' => '{{.Values.mysql.main_rw_splitting.password}}',
            'charset'  => 'utf8mb4',
            'attributes' => [
                PDO::MYSQL_ATTR_FOUND_ROWS => true,
            ],
        ],

        'db_pay' => [
            'class'    => 'yii\db\Connection',
            'dsn' => 'mysql:host={{.Values.mysql.ts_pay.host}};dbname={{.Values.mysql.ts_pay.dbname}}',
            'username' => '{{.Values.mysql.ts_pay.user}}',
            'password' => '{{.Values.mysql.ts_pay.password}}',
            'charset'  => 'utf8'
        ],

        'db_elf' => [
            'class'    => 'yii\db\Connection',
            'dsn' => 'mysql:host={{.Values.mysql.elf.host}};dbname={{.Values.mysql.elf.dbname}}',
            'username' => '{{.Values.mysql.elf.user}}',
            'password' => '{{.Values.mysql.elf.password}}',
            'charset'  => 'utf8'
        ],

        'db_ent' => [
            'class'    => 'yii\db\Connection',
            'dsn' => 'mysql:host={{.Values.mysql.enterprise.host}};dbname={{.Values.mysql.enterprise.dbname}}',
            'username' => '{{.Values.mysql.enterprise.user}}',
            'password' => '{{.Values.mysql.enterprise.password}}',
            'charset'  => 'utf8'
        ],

        'db_pro' => [
            'class' => 'yii\db\Connection',
            'dsn' => 'mysql:host={{.Values.mysql.tspro.host}};dbname={{.Values.mysql.tspro.dbname}}',
            'username' => '{{.Values.mysql.tspro.user}}',
            'password' => '{{.Values.mysql.tspro.password}}',
            'charset' => 'utf8',
        ],

        'db_statis' => [
            'class' => 'yii\db\Connection',
            'dsn' => 'mysql:host={{.Values.mysql.ts_statis.host}};dbname={{.Values.mysql.ts_statis.dbname}}',
            'username' => '{{.Values.mysql.ts_statis.user}}',
            'password' => '{{.Values.mysql.ts_statis.password}}',
            'charset' => 'utf8',
        ],
    ];

  params.php: |
    <?php

    return [

        'loginUrl' => 'fsdfsdf',

        'oss' => [
            'OSS_ACCESS_ID'=>'{{.Values.ram.author_platform.access_id}}',
            'OSS_ACCESS_KEY'=>'{{.Values.ram.author_platform.access_key}}',
            'EndPoint'=>'http://fsdfsdf',
            'OSS_BUCKETNAME'=>'fsdfsd',
            'root'=>'fsdf',
            'auth_photo_root' => 'fdsfsf',
        ],

        'ts-source-bucket'=>'fsdfsdfs-fsd',

        'cdn' => [
            'tsp'=>"https://{{.fdsp}}",
            'update'=>"https://{{.fsd.fsd.fds.fsdf}}",
            'oss'=>"https://{{.fsd.fs.ds.oss}}",
        ],

        'RSA_private_key' => file_get_contents( __DIR__ . '/secret/RsaPrivateKey.pem' ),
        'RSA_public_key'  => file_get_contents( __DIR__ . '/secret/RsaPublicKey.pem' ),

        'TSP_private_key' => file_get_contents( __DIR__ . '/secret/TspPrivateKey.pem' ),

        'card_auth_device_max_year' => 3,

        'card_day_consume' => 1,

        'buy_point_unit_price' => 0.05,

        'card_forever_consume' => 1000,

        'elasticsearch' => [
            'host' => [
                'fsdfs.fdsfsdf.54.17:fds'
            ]
        ],


        'devices_list_es_search' => false,
        'system_upgrade' => false,

    ];

  web.php: |
    <?php

    $params = require(__DIR__ . '/params.php');
    $db = require(__DIR__ . '/db.php');
    $components = require(__DIR__ . '/components.php');

    $config = [
        'id'           => 'tsp',
        'basePath'     => dirname(__DIR__),
        'bootstrap'    => ['log'],
        'language'     => 'zh-CN',
        'components'   => $components,
        'params'       => $params,
    ];

    if (YII_ENV_DEV) {
        // configuration adjustments for 'dev' environment
        $config['bootstrap'][] = 'debug';
        $config['modules']['debug'] = [
            'class' => 'yii\debug\Module',
            // uncomment the following to add your IP if you are not connecting from localhost.
            'allowedIPs' => ['115.171.135.157'],
        ];

        $config['bootstrap'][] = 'gii';
        $config['modules']['gii'] = [
            'class' => 'yii\gii\Module',
            // uncomment the following to add your IP if you are not connecting from localhost.
        ];
    }

    return $config;


---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cm-{{$app_name}}-nginx
data:
  nginx.conf: |
    limit_req_zone $binary_remote_addr zone=addr:10m rate=1000r/s;
    server {
        client_max_body_size 50m;
        listen 80;

        proxy_ignore_client_abort on;
        client_header_timeout 300s;
        client_body_timeout   300s;

        #server_name localhost dev.touchsprite.com;
        server_name  {{ template "nginx.servername" . }};
    	#limit_req   zone=req_one  burst=100;
        limit_req zone=addr burst=5000 nodelay;

        root /www/default/web;
        index index.php index.html index.htm;


        location /static/ {
            access_log off;
            expires 1d;
            root "/www/default/web/frontEnd/dist";
        }

        location /new_public/ {
           access_log off;
           expires 1d;
           root "/www/default/web/frontEnd";
        }

        location / {
            try_files $uri $uri/ /index.php?$args;
        }

        location = /s-c-data {
          # 允许跨域
          add_header Access-Control-Allow-Origin *;
          add_header Access-Control-Allow-Headers X-Requested-With;
          add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS;
          default_type text/html;
          return 200 $msec;
        }

        location /ajax/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /site/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /images/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /css/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /js/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /assets/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /script/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }
        location /public/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /key/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /category/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /blacklist/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /device/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /temporary/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /log/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /about/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /weixin/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /openapi/luacts1 {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location /weixinqa/ {
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
            proxy_pass http://svc-tsstore-web-http;
        }

        location ~ \.php$ {
            include fastcgi.conf;
            fastcgi_connect_timeout 300s;
            fastcgi_send_timeout 300s;
            fastcgi_read_timeout 300s;
            fastcgi_pass  unix:/var/run/php-fpm.sock;
            #fastcgi_pass   localhost:9000;
            #fastcgi_pass unix:/var/run/php5-fpm.sock;
            try_files $uri =404;
        }
    }



---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cm-{{$app_name}}-web
data:
  index.php: |
    <?php

    define("SESSIONID_LIFE_TIME", 86400);
    ini_set('session.cookie_lifetime', SESSIONID_LIFE_TIME);

    $host = $_SERVER['HTTP_HOST'];
    $suffix = substr($host, strrpos($host, '.'));

    ini_set('session.cookie_domain', "touchsprite{$suffix}");

    // comment out the following two lines when deployed to production
    {{- if .Values.debug }}
    defined('YII_DEBUG') or define('YII_DEBUG', true);
    defined('YII_ENV') or define('YII_ENV', 'dev');
    {{- else }}
    defined('YII_DEBUG') or define('YII_DEBUG', false);
    defined('YII_ENV') or define('YII_ENV', 'dev');
    {{- end }}


    require(__DIR__ . '/../vendor/autoload.php');
    require(__DIR__ . '/../vendor/yiisoft/yii2/Yii.php');

    $config = require(__DIR__ . '/../config/web.php');

    (new yii\web\Application($config))->run();



---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cm-{{$app_name}}-supervisor
data:


---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cm-{{$app_name}}-root
data:


---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cm-{{$app_name}}-secret
data:
  TspPrivateKey.pem: |
    -----BEGIN RSA PRIVATE KEY-----
    MIIEpQIBAAKCAQEAzwyG5Ag2AnoAab+87ZJS/h7Jh4ZyIgH3JTbQTW1nsxuP/dNp
    a0uHqNkFjgN6QETVin3WTP/nTQt0PqKlJn9Tb8O8R+0iP1pGtacENd8iiUoNc1ts
    8Pu29IyFrQTnT+CG2eb4EVVNSwYXKyQeQirLohNDE5ld+dnjQlMDcKZCdlveb6T7
    22qJ6pYSvxi7D5yVCdaAmHCXzNEWpYizon5dxDJlhXZsyTPJmkvYWaxkhK0oIU4S
    b/cJBLgBT9VmQGLuCNK3UzZmR7rzoHj70aVDc9nKSUu7RD9chYWJaz61dehfgG8e
    NF6kOSnW83J+4dPi6miEsGcN/5PTM+MX/ddmiQIDAQABAoIBADFM5U2k2t9qF3EW
    s7DJ97MEt63qiICqgSO+UoktNNUEChxBW8etm2bMDjOLhm+JNGOepQl+oZ/Jy2si
    pTpudPqW290wjMgTAeU9GJaPRBT2qg8+xMj41s6SKz5QfZeaeeGmyoiuDBKCJ8Ah
    AId20zgLaBxhl2vnwuJHC/mlzQuLVLvbC7g+S02e8WY4h4eBZ1iBQmL7D0pzyQ+j
    aiGlZvVJ+VBPXHpqHv+HM1wjqYmQAH2TfNJdSDOwuQCNpishBBV8yCPk6BrHZpAH
    xkTbrnGmBFOl6HqGfFaGKxaxl7v58jBckQVoVckqEm+pZmC9WGhu2rVZ/MZOSNQm
    bkkExVECgYEA8gEDF9asDanYQYcaNzI4fVzxWSR1xBTFiQGUGWhKC+u/RX2dT7gG
    rITy2jKtzZn74EKU5Ope65ISkw4Mo7Ha7RwFsDhv+QXel+CX2r6+8r7PfQ5CcGuj
    UldBXTHu2tmMRq3HORRIrpVbXa0qw0G9jt9Fcdw7pynvSdvnsPXBbX0CgYEA2wX9
    D2vh0BFC6SJwb30+DT5IX5ITXUybiBJ8C7+7eHfK5fwwgaZae6n5QUra/vhQ8yDz
    YFBshIVZYdV3vYH2RkbuoZy35Finyoq0jUmHdOQl2Ji4rRark9nvsYAWnCGXCZPc
    jH1TcToYVejjpTa9Jfcq9kfc0dbr3PxSs+Xlmv0CgYEAoye7hh7c8HlJqyQCsKPT
    IfG/ZXIHU6MNakj+KAL/qPnPgnIl1NEk7rrTX/g65RqjjZZV+99nDzrz+uDF9La7
    +o+h5iSmmSUz5QEuX/OpmM675Hvwnwpymdjp4IMBndp9kEkov3rFZa6cYpOU+P8h
    ZWlx0EnCjfjfstPnaI7HUaECgYEA1SNewEMb3H7vvi/leplGaVzS0S416fVC5YgX
    bteGeBUbPfPMwF5Cb1VZWlCeDMFZBUBrlq6s68lY0fwKKkDuiDU+w8berTgZEOEq
    EtQbHYVnzv/Pt6D4F0leGD2twwJtGMTrOfff0w6h1UhmXipD33VU7zT8ha8rPeZT9O8
    J5Txe4ECgYEA3yVm5TvZpi7GWtjklFGX+/4kISL8MkkvS7BhStk1y/F5Aj4F+/LI
    GbKzsC78vYhsqBhP+jNCWgKGSjEOBFsjMl7SnpU7zQ6wO+N5N4jDeOlDS7YbafCC
    mHVO5XDmVw93opRVsm8Fns6s0NhDQP4rzO1bODUFxZH1QNMZ4Hle7tw=
    -----END RSA PRIVATE KEY-----

  RsaPrivateKey.pem: |
    -----BEGIN RSA PRIVATE KEY-----
    MIICXAIBAAKBgQCh1l7EsjADCC2sSBFun7SbAftCnufCklS9OsFE6U4PY/M/dE8q
    LAP36SUkS28CesC7DBN7kka7F+LQHiO2KmxQi8YcayKZ5IPGvNhoh0gCdTnvXRE9
    FSmP42KiDbnJOGWQO86Y1LpQY74MJvYsnxBNYURc719A/ZRuV9uPJSZXHwIDAQAB
    AoGAL03NnYjH59r4HqdiEQe1bqmBm9N+wqyrADSwUUgwfOcmLqH8kcMT1d7b8GPs
    KrlepE2/VBtJeV5d+Z8VqSV1Sw7Rmkpn2nMeQ1rhavkipnB3tanEYwFgpI9TFg+F
    GRINrrREbvsYMVSe44G0BxB3LcgdLcfsssdi6QLWzXMEoddFdrAECQQDM4CQWVceK8XTS
    w6Bx6eQJAUZr7vK5YdnrZxGQ0Q85HMlD7uPeFCbwkPYGUKHiNj9vCyzJ3iPz3v5P
    1Ncg5n+fAkEAyjjdfw4Ub188kfnC+JYzHzdZODPrqiatCsAaXoEDq7Iul9NDAH75
    HW4WR6z2SMTozcfIaqz7QSQ4AK/CheL4gQJAENpTPZ8axfwsvvWmqhgyUOdQ8qn6
    P3OkKHAXCtGXrfwHNlZdWjRQK7PQ+R4C4wfRWgISUhy62mG6i7iXZbZwQwJBALZ6
    +A1GJFSX6S2E51axGzKpHH6mA5xISFByJ5lt7GUMZhUlU8nnyl6vT7WgM6JY5geD
    p6vzqssOpuafs/ZjaYECQEzevhkcJUzSBOTU8y46fx9vBcMbxFC8wAXn0rnIfUB5
    bl2s/46Qxw6KS0+ZD6XXSFfgxi7Rj9nP9Kq0YhZ65d0=
    -----END RSA PRIVATE KEY-----

  RsaPublicKey.pem: |
    -----BEGIN PUBLIC KEY-----
    MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCh1l7EsjADCC2sSBFun7SbAftC
    nufCklS9OsFE6U4PY/M/dE8qLAP36fffSUkS28CesC7DBN7kka7F+LQHiO2KmxQi8Yc
    ayKZ5IPGvNhoh0gCdTnvXRE9FSmP42KiDbnJOGWQO86Y1LpQY74MJvYsnxBNYURc
    719A/ZRuV9uPJSZXHwIDAQAB
    -----END PUBLIC KEY-----


---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cm-{{$app_name}}-fpm
data:
  zzz-docker.conf: |
    [global]
    daemonize = no

    [www]
    listen = /var/run/php-fpm.sock
    listen.mode = 0777
```

use postman

POST http://localhost:8080/v1/api/upload/cloudmer19
Error: connect ECONNREFUSED 127.0.0.1:8080

![2021-01-14 16-11-14屏幕截图](https://user-images.githubusercontent.com/11722888/104562391-40a21280-5683-11eb-99fe-6181dfab52c0.png)


ide show No error message

![2021-01-14 16-11-45屏幕截图](https://user-images.githubusercontent.com/11722888/104562419-4bf53e00-5683-11eb-9944-ad771ae4f421.png)

The service has stopped working！！！
Change-Id: I7dca9f7117e54954ad12f5c04f4dd81315008d0e

This PR will add support for graceful shutdown using graceful third party library and expose new function called `RunGracefully()` to the user. 
- tests and complete functionality will be added soon along as either second commit or all squashed commits
- Updated READ.ME to present this new functionality


Fix #2226 

I've read discussion in #2226, but there are few reasons to consider on behalf of merge of this PR:

* It's pretty easy to fix it
* Even if Basic Auth should not be considered as a secure auth method, it will be often misused in the wild. It'll be hard to make people using basic auth middleware always make informed decision.
* There are cases like server to server integration via HTTPS where basic auth is just good enough.
For who need to customize his own client IP extractor.

Fixes #2474  and  #2232 


## Description
I've a gin web server for simply uploading roughly-10M-sized files by posting multipart form format http requests, whose cpu usage is extremely high.  By profiling, i found calling c.Form caused too much cpu usage.

For simplicity, i wrote a demo justing receiving file content and disabling upload stage and the result is the same.

## How to reproduce
1.Server code

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
        ...........
)

func uploadfile(c *gin.Context) {

       file, err := c.FormFile("file")
       _ = file 
       if err != nil {
           glog.Info("FormFileErr: ", err) 
       }

       c.JSON(http.StatusOK, gin.H{})

}

func main() {
      router := gin.Default()

     router.MaxMultipartMemory = 16 << 20
     .....
     router.POST("<The Path>/files", uploadfile)
     ....
     s := &http.Server{
            Addr:         ":8880",
            ReadTimeout:  180 * time.Second, 
            WriteTimeout: 180 * time.Second,
           Handler:      router, // < here Gin is attached to the HTTP server
      }
}
```

2. Benchmark client code

```
$  for i in 1 2 3;do ./wrk -t15 -c600 -d300s "<MY SERVICE ADDRESS>:8880" -s scripts/multipart2.lua
```

The multipart2.lua is used to generate 10M post requests.
```
local i
i = 0

request = function()
    local headers = {}
    headers["Content-Type"] = "multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW"

    path = "<The Path>/files?file_name=/aaa.txt_" .. (i % 5000)

    --print (path)

    i = i + 1

    body = '------WebKitFormBoundary7MA4YWxkTrZu0gW\r\n'
    body = body .. [[Content-Disposition: form-data; name="file"; filename="en.txt"]]
    body = body .. '\r\n\r\n'
    file = io.open("tmp/10M_size.txt", "rb")
    body = body .. file:read("*a")
    body = body .. '\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW--'
    io.close(file)

    return wrk.format('POST', path, headers, body)
end
```


## Expectations

The cpu should be low since the logic is so simple that it just parses the form field !!

## Actual result

The bandwidth is full and the cpu is very high.
<img width="1285" alt="截屏2021-01-10 下午2 26 03" src="https://user-images.githubusercontent.com/2518001/104116078-5f856980-5350-11eb-9116-9c39c684e8dd.png">

The "perf top" shows cpu is busy with kernel locking
<img width="930" alt="截屏2021-01-10 上午11 31 46" src="https://user-images.githubusercontent.com/2518001/104116106-9f4c5100-5350-11eb-986f-310bd5e1453c.png">


## Environment

- go version:  go1.15 linux/amd64
- gin version (or commit ref):  github.com/gin-gonic/gin v1.6.3
- operating system: x86_64 GNU/Linux

## Description

I want to use a struct to bind map query parameter, it seems that gin doesn't support it yet.

<!-- Description of a problem -->

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
Run server:
```
package main

import (
	"fmt"
	"github.com/gin-gonic/gin"
)

type Req struct {
	Ext map[string]string `form:"ext"`
}

func main() {
	r := gin.Default()
	r.GET("/map", func(c *gin.Context) {
		ext := c.QueryMap("ext")
		fmt.Println(ext)
		// output: map[foo:bar]

		f := Req{}
		err := c.BindQuery(&f)
		if err != nil {
			c.Status(500)
		}
		fmt.Println(f)
		// actual output: { map[]}
		// expected output: { map[foo:bar]}
		c.Status(200)
	})

	r.Run(":8082")
}
```

Curl: 
```
curl --location -g --request GET 'localhost:8082/map?ext[foo]=bar'
```

## Environment

- go version: Go 1.14.12
- gin version (or commit ref): v1.6.3-0.20210112003204-f4bc259de33c
- operating system: Darwin 19.6.0



## Description

I like that gin-gonic can produce several different types of output, such as json, yaml, xml, html template, string, etc. I would like to "detect" what the user wants by looking at the "Accept" header, and run the appropriate c.WHATEVER based on that. 

For example, if someone is querying via API they may ask for json output, but if they are using a browser, we should send them a rendered template (html). 

Some items, like "serverListCSV" will still send CSV as a file, but I feel like it would be useful to have the same endpoints (routes) and controllers but just send the "display" portion to another method that would smartly format it.

Before I *try* to create this myself, can someone tell me if there is already something like this, and what it would be called (view controller is what comes to mind), where I would pass it the context, data and possibly a default type, and have it detect and send the appropriate type. I have tried googling various terms, related, but have just been led astray or maybe I just didn't understand the results.





## Description

custom recovery is not published yet with tag


## Environment

- go version: 1.15.6
- gin version (or commit ref): v.1.6.3 using go mod
- operating system: win10

This reverts commit fca3f95d7cdfdef203c78f220b84118f44590512.

details: https://github.com/gin-gonic/gin/pull/2538#issuecomment-753717649

cc @kishorkunal-raj
https://github.com/gin-gonic/gin/blob/fca3f95d7cdfdef203c78f220b84118f44590512/gin.go#L415
According to root.getValue，the nodeValue.Param is just a shallow copy of given params. So what's the different use ctx.param all the way since it gets filled sequentially in single request? 

adding a new method in context.go; main purpose is to support Context Value set / get.

The existing Value() only returns entry related to an earlier Set(). However within the current request handling, context bound values are not touched at all; hence these values are never "Set()" to the underlying "Keys" map.

The just added ContextValue() will look into these values by accessing the underlying Request object's Context.

Unit test has been updated to reflect on how the process works.
https://github.com/gin-gonic/gin/blob/7742ff50e0a05d079a0c468ccfbf7c6ecfe2414b/binding/form_mapping.go#L236-L245

hi， My question is :  Why not return Parse Error when convert string("") to int?  
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

when I use postman to request data from my gin project .
then, in my gin project I will use go-resty to get response from third part response ,
finally, return the third part response to postman.
But I get Error: socket hang up response from postman 
I don't know what's wrong with this operation 

here is go-resty home page: [resty](https://github.com/go-resty/resty)

and this is my golang code

```go
func CADDOverlapUnionMiddleware(uri string) func(c *gin.Context) {
	return func(c *gin.Context) {
		var params dao.OverlapUnionRequestData
		client := resty.New()
		client.SetTimeout(4 * time.Minute)
		client.SetDebug(true)
		targetFile, header, err := c.Request.FormFile("upload_file")
		if err != nil {
			c.JSON(http.StatusBadRequest, dao.ImportFile400)
			return
		}
		if err := c.Bind(&params); err != nil {
			c.JSON(400, dao.CommonResponse400)
			return
		}
		targetFilePath, err := caddutil.WriteFile(configs.TmpDir, header.Filename, &targetFile)
		if err != nil {
			c.JSON(500, dao.CommonResponse{Code: 500, Message: "write csv error"})
			return
		}
		csvDownloadParams := dao.FilterRequestData{Filters: make(map[string][]dao.Filter, 0), FileId: params.FileId}
		var model caddmodels.CADDModel
		model.InitWithoutParams()
		res, err := model.GetFilterData(&csvDownloadParams)
		if err != nil {
			c.JSON(500, dao.CommonResponse{Code: 500, Message: err.Error()})
			return
		}
		refFilePath, err := res.WriteCsvWithName(strconv.FormatInt(time.Now().Unix(), 10))
		if err != nil {
			c.JSON(500, dao.CommonResponse{Code: 500, Message: err.Error()})
			return
		}
		refFileBytes, _ := ioutil.ReadFile(refFilePath)
		targetFileBytes, _ := ioutil.ReadFile(targetFilePath)
		resp, err := client.R().
			SetFileReader("ref_file", path.Base(refFilePath), bytes.NewReader(refFileBytes)).
			SetFileReader("target_file", path.Base(targetFilePath), bytes.NewReader(targetFileBytes)).
			SetFormData(map[string]string{
				"begin_1":    strconv.Itoa(params.Begin1),
				"end_1":      strconv.Itoa(params.End1),
				"begin_2":    strconv.Itoa(params.Begin2),
				"end_2":      strconv.Itoa(params.End2),
				"median_val": strconv.Itoa(params.MedianVal)}).
			Post(configs.AliyunUrl + uri)
		if err != nil {
			configs.Logger.Error(err)
			return
		}
		configs.Logger.Info("resp ", resp.String())
		//c.String(resp.StatusCode(),resp.String())
		c.String(resp.StatusCode(), resp.String())
	}
}
```
this is postman error:
![image](https://user-images.githubusercontent.com/64942637/103346062-00ad2e00-4ace-11eb-8410-cdc15371877f.png)

Trying to solve: #2582 

Merge before: 

- open [Setting > Secrets](https://github.com/gin-gonic/gin/settings/secrets/actions) and set you'r gitter room id to `GITTER_ROOM_ID `
- Merge #2595

**If the master branch changes, or if a problem occurs that does not necessarily occur, you can choose to re-run the github action job.**

Differences from Travis CI:

- Multiple os `ubuntu-latest`, `macos-latest`, `windows-latest`
- No go master version
- Sending gitter notifications using curl

---

### Some of the problems I've encountered since using GitHub Action

- `TestUnixSocket` windows cannot read `/tmp/unix_unit_test` **(fixed: #2595)**
- `TestPathCleanMallocs` have a certain chance of failure **(I don't know how to repair it :confused: )**
>     path_test.go:85: 
>        	Error Trace:	path_test.go:85
>        	Error:      	Not equal: 
>        	            	expected: float64(2010)
>        	            	actual  : int(0)
>        	Test:       	TestPathCleanMallocs
- `TestUnixSocket` have a certain chance of failure **(I don't know how to repair it :confused: )**
> Get http://127.0.0.1:49379/test: dial tcp 127.0.0.1:49379: bad file descriptor

windows cannot use path `/tmp/unix_unit_test`
My current architecture is a mix of static files and REST endpoints and I want to migrate from REST to gRPC - which is working quite well in itself.  To keep the number of processes low, I would like to serve the static files AND the gRPC-web from a single process, but behind different routes (e.g. `/static` and `/grpc`).

Can I somehow "serve" gRPC from a route in gin?

In the example below `http.Server variant` works fine, but the `GIN Server variant` does nothing except logging the request.

````
func (gs *GRPCWebServer) Init(servePort int, path string) {

	gs.port = servePort

	grpcServer := grpc.NewServer()
	library.RegisterPermissionServiceServer(grpcServer, newPermissionService(path))
	grpclog.SetLogger(log.New(os.Stdout, "grpc: ", log.LstdFlags))

	wrappedServer := grpcweb.WrapServer(grpcServer)

	// http.Server variant
	//
	// handler := func(resp http.ResponseWriter, req *http.Request) {
	// 	wrappedServer.ServeHTTP(resp, req)
	// }
	// httpServer := http.Server{
	// 	Addr:    fmt.Sprintf(":%d", gs.port),
	// 	Handler: http.HandlerFunc(handler),
	// }
	// grpclog.Printf("Starting gRPC-web server, port: %d", gs.port)
	// if err := httpServer.ListenAndServe(); err != nil {
	// 	grpclog.Fatalf("failed starting gRPC-web server: %v", err)
	// }

	// GIN Server variant
	//
	ginServer := gin.New()
	ginServer.Use(gin.Logger())
	ginServer.Use(gin.Recovery())
	ginServer.Group("/grpc", func(c *gin.Context) {
		wrappedServer.ServeHTTP(c.Writer, c.Request)
	})
	ginServer.Run(fmt.Sprintf(":%d", servePort+1))
}
````
I am trying to template an XML file:

```
func GETSitemap(c *gin.Context) {
	urls := make([]map[string]string, 0)
	urls = append(urls, map[string]string{
		"url":      "/home",
		"priority": "0.8",
	})

	c.Header("Content-Type", "application/xml")
	c.HTML(http.StatusOK, "sitemap.xml", gin.H{
		"domain": "example.com",
		"urls":   urls,
	})
}
```

This results in the following:

```
&lt;?xml version="1.0" encoding="UTF-8"?>
...
```

The `<` has been escaped. Normally I'd just disable HTML escaping, but I cannot seem to do this. Is there a way to do "raw" templating?
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

Hi,

I has an issue with function `func (formBinding) Bind(req *http.Request, obj interface{}) error {`, when i push an query like `http://0.0.0.0:8080/v1/transaction?start_date=2006-01-02T15:04:05+07:00&end_date=2006-01-02T15:04:05+07:00&page=1&page_size=100` and use `if err := c.ShouldBindQuery(&request); err != nil {` for parsing, but I see that the value in `setTimeField(val string, structField reflect.StructField, value reflect.Value) error` has invalid string, below is my debug 

request url 
![image](https://user-images.githubusercontent.com/24843184/103199932-986c1a00-491e-11eb-9b2b-768eea7e9413.png)

value in parse
![image](https://user-images.githubusercontent.com/24843184/103198317-9acc7500-491a-11eb-867e-46f3f01f0465.png)

that you see the variable val is missing `+` character so it will be fail set time.

## How to reproduce

define struct with time format

```
type A struct {
	StartDate *time.Time `form:"start_date" time_format:"2006-01-02T15:04:05Z07:00"`
	EndDate   *time.Time `form:"end_date" time_format:"2006-01-02T15:04:05Z07:00"`
}
```

binding a struct with gin context

```var request dtos.SearchCodeTransactionRequest
	if err := c.ShouldBindQuery(&request); err != nil {`
```

see value in `func setTimeField(val string, structField reflect.StructField, value reflect.Value) error {` in form_mapping.go

## Environment

- go version: go version go1.15.6 linux/amd64
- gin version (or commit ref): github.com/gin-gonic/gin v1.6.3
- operating system: Ubuntu 20.04.1 LTS x86_64 

Edit : I saw that gin will be unescape character `+` in query request, so how can we parse time with timezone like +07:00 ?
HttpRouter seems to be more performant than Gin?  The benchmarks show that :

>(1): Total Repetitions achieved in constant time, higher means more confident result
> **Gin = 43550** / **HttpRouter = 55938**

>(2): Single Repetition Duration (ns/op), lower is better
> **Gin = 27364** / **HttpRouter = 21360**

>(3): Heap Memory (B/op), lower is better
> **Gin = 0** / **HttpRouter = 0**

>(4): Average Allocations per Repetition (allocs/op), lower is better
> **Gin = 0** / **HttpRouter = 0**

Could the benchmarks be sorted by performance?
cc #1714

similar to https://github.com/gorilla/handlers/pull/159/files
## Description

If the get request parameter contains a percent sign, the corresponding value will not be obtained

## How to reproduce

```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/hello/:name", func(c *gin.Context) {
		c.String(200, "Hello %s", c.Param("name"))
	})
	g.Run(":9000")
}
```

## Expectations

```
$ curl http://localhost:8201/hello/world?name=%Hello
%Hello
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl -i http://localhost:8201/hello/world?name=%Hello
<>
```

### Want 
Can I use a router like this：
```
/pages/archives-{id}.html
```

 and use that parm by :
```
id := c.Param("id")
```
### This is how I use it at present
```
/pages/archives-:id
```
then
```
id := c.Param("id")[0,strings.Index(c.Param("id"), ".")]
```


## Description

<!-- Description of a problem -->

I've gotten axios error with 400 bad request error message

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```go
package router

import (
	"fmt"
	"github.com/gin-gonic/gin"
	"os"
	"myapp/lib/env"
)

func Init() {
	router := gin.Default()
	router.Use(func(c *gin.Context) {
		c.Writer.Header().Set("Access-Control-Allow-Origin", "*")
		c.Writer.Header().Set("Access-Control-Max-Age", "86400")
		c.Writer.Header().Set("Access-Control-Allow-Methods", "POST, GET, OPTIONS, PUT, DELETE, UPDATE")
		c.Writer.Header().Set("Access-Control-Allow-Headers", "Origin, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization")
		c.Writer.Header().Set("Access-Control-Expose-Headers", "Content-Length")
		c.Writer.Header().Set("Access-Control-Allow-Credentials", "true")

		if c.Request.Method == "OPTIONS" {
			fmt.Println("OPTIONS")
			c.AbortWithStatus(200)
		} else {
			c.Next()
		}
	})
	router.POST("/api/login", func(c *gin.Context) {
		fmt.Println(c.PostForm("message"))
	})
	
	router.Run()
}

```

```javascript
try {
                await axios.post(
                    `/api/login`,
                    {
                        "message": "aksdkaskd"
                    }
                );

               
            } catch (err) {
                
                console.log(err);
                
            }
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
got 200 with json data as the response
```

## Actual result

<!-- Actual result showing the problem -->
```
got 400 bad request
```

## Environment

- go version: 1.15.3
- gin version (or commit ref): 0.0.0-20171026143024-cafe2ce98974
- operating system: Mac Catalina

my project catalog is：

|--main.go
　　|--template
　　        |--temp1
                         |--index.html   
               |--temp2
                         |--index.html

--------------------------------------------------------------
and main.go is:

package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
        g.LoadHTMLGlob("template/**/*")
	g.GET("/temp1/index", func(c *gin.Context) {
		c.HTML(200, "temp1/index.html", gin.H{
			"title": "index",
			"name":  "myname1",
		})
	})
	g.GET("/temp2/index", func(c *gin.Context) {
		c.HTML(200, "temp2/index.html", gin.H{
			"title": "index",
			"name":  "myname2",
		})
	})
	g.Run(":9000")
}
----------------------------------------------------------------------

when I enter 'http://localhost:9000/tem1/index' in browser
I got 'HTTP ERROR 500'.  

---------------------------------------------------------------------
How to solve the problem？

error min support Go version compare with README.md
- With issues:
Please tell me the meaning of 255.

## Description

<!-- Description of a problem -->

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
func countParams(path string) uint8 {
	var n uint
	for i := 0; i < len(path); i++ {
		if path[i] != ':' && path[i] != '*' {
			continue
		}
		n++
	}
	if n >= 255 {
		return 255
	}
	return uint8(n)
}
```

- go version:go version go1.13 windows/amd64
- gin version (or commit ref): master
- operating system:

See the hack news:『[Travis CI is no longer providing CI minutes for open source projects](https://news.ycombinator.com/item?id=25338983)』

Twitter: https://twitter.com/james_hilliard/status/1336081776691843072





## Description

Not specifying any particular version a go build fails due to...

```
gopkg.in/yaml.v2@v2.2.8: reading gopkg.in/yaml.v2/go.mod at revision v2.2.8: unknown revision v2.2.8
```

## How to reproduce

```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/hello/:name", func(c *gin.Context) {
		c.String(200, "Hello %s", c.Param("name"))
	})
	g.Run(":9000")
}
```

## Expectations

An executable binary.

## Actual result

```
$ go mod init gintest
go: creating new go.mod: module gintest
$ go build .
go: finding module for package github.com/gin-gonic/gin
go: found github.com/gin-gonic/gin in github.com/gin-gonic/gin v1.6.3
go: github.com/gin-gonic/gin@v1.6.3 requires
	gopkg.in/yaml.v2@v2.2.8: reading gopkg.in/yaml.v2/go.mod at revision v2.2.8: unknown revision v2.2.8
```

## Environment

- go version: go1.15.5 linux/amd64
- gin version (or commit ref): not specifying
- operating system: CentOS 8

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

wrong content-type causes stack overflow

## How to reproduce
send a json string request with content-type  test/plain

## Actual result
runtime: goroutine stack exceeds 1000000000-byte limit
fatal error: stack overflow

runtime stack:
runtime.throw(0x1355a3a, 0xe)
	/usr/lib/golang/src/runtime/panic.go:774 +0x72
runtime.newstack()
	/usr/lib/golang/src/runtime/stack.go:1046 +0x7a9
runtime.morestack()
	/usr/lib/golang/src/runtime/asm_amd64.s:449 +0x8f

goroutine 102 [running]:
runtime.mapaccess2_faststr(0x11f6980, 0xc000740120, 0x1117bbf, 0x3, 0x0, 0x0)
	/usr/lib/golang/src/runtime/map_faststr.go:107 +0x7a8 fp=0xc020740350 sp=0xc020740348 pc=0x41b238
github.com/gin-gonic/gin/binding.setByForm(0x12fa560, 0xc005b3a400, 0x199, 0x1117bbf, 0x3, 0x0, 0x0, 0x14efda0, 0x12d2000, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:140 +0x93 fp=0xc020740508 sp=0xc020740350 pc=0xf2fa73
github.com/gin-gonic/gin/binding.formSource.TrySet(0xc000740120, 0x12fa560, 0xc005b3a400, 0x199, 0x1117bbf, 0x3, 0x0, 0x0, 0x14efda0, 0x12d2000, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:45 +0x104 fp=0xc020740608 sp=0xc020740508 pc=0xf2e6a4
github.com/gin-gonic/gin/binding.tryToSetValue(0x12fa560, 0xc005b3a400, 0x199, 0x1117bbf, 0x3, 0x0, 0x0, 0x14efda0, 0x12d2000, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:136 +0x5ac fp=0xc020740798 sp=0xc020740608 pc=0xf2f8ec
github.com/gin-gonic/gin/binding.mapping(0x12fa560, 0xc005b3a400, 0x199, 0x1117bbf, 0x3, 0x0, 0x0, 0x14efda0, 0x12d2000, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:78 +0x567 fp=0xc020740a00 sp=0xc020740798 pc=0xf2ee47
github.com/gin-gonic/gin/binding.mapping(0x12d2000, 0xc005b2fc10, 0x196, 0x1117bbf, 0x3, 0x0, 0x0, 0x14efda0, 0x12d2000, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020740c68 sp=0xc020740a00 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2fc00, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020740ed0 sp=0xc020740c68 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1de50, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020741138 sp=0xc020740ed0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1ddd0, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc0207413a0 sp=0xc020741138 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2fbe0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020741608 sp=0xc0207413a0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2fb00, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020741870 sp=0xc020741608 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1ddc0, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020741ad8 sp=0xc020741870 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1dd40, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020741d40 sp=0xc020741ad8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2fae0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020741fa8 sp=0xc020741d40 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2fa00, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020742210 sp=0xc020741fa8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1dd30, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020742478 sp=0xc020742210 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1dcb0, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc0207426e0 sp=0xc020742478 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f9e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020742948 sp=0xc0207426e0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f900, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020742bb0 sp=0xc020742948 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1dca0, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020742e18 sp=0xc020742bb0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1dc20, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020743080 sp=0xc020742e18 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f8e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc0207432e8 sp=0xc020743080 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f800, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020743550 sp=0xc0207432e8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1dc10, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc0207437b8 sp=0xc020743550 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1db90, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020743a20 sp=0xc0207437b8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f7e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020743c88 sp=0xc020743a20 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f700, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020743ef0 sp=0xc020743c88 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1db80, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020744158 sp=0xc020743ef0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1db00, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc0207443c0 sp=0xc020744158 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f6e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020744628 sp=0xc0207443c0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f600, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020744890 sp=0xc020744628 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1daf0, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020744af8 sp=0xc020744890 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1da70, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020744d60 sp=0xc020744af8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f5e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020744fc8 sp=0xc020744d60 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f500, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020745230 sp=0xc020744fc8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1da60, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020745498 sp=0xc020745230 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d9e0, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020745700 sp=0xc020745498 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f4e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020745968 sp=0xc020745700 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f400, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020745bd0 sp=0xc020745968 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d9d0, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020745e38 sp=0xc020745bd0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d950, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc0207460a0 sp=0xc020745e38 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f3e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020746308 sp=0xc0207460a0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f300, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020746570 sp=0xc020746308 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d940, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc0207467d8 sp=0xc020746570 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d8c0, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020746a40 sp=0xc0207467d8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f2e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020746ca8 sp=0xc020746a40 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f200, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020746f10 sp=0xc020746ca8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d8b0, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020747178 sp=0xc020746f10 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d830, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc0207473e0 sp=0xc020747178 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f1e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020747648 sp=0xc0207473e0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f100, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc0207478b0 sp=0xc020747648 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d820, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020747b18 sp=0xc0207478b0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d7a0, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020747d80 sp=0xc020747b18 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2f0e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020747fe8 sp=0xc020747d80 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2f000, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020748250 sp=0xc020747fe8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d790, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc0207484b8 sp=0xc020748250 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d710, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020748720 sp=0xc0207484b8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2efe0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020748988 sp=0xc020748720 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2ef00, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020748bf0 sp=0xc020748988 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d700, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020748e58 sp=0xc020748bf0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d680, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc0207490c0 sp=0xc020748e58 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2eee0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020749328 sp=0xc0207490c0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2ee00, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020749590 sp=0xc020749328 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d670, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc0207497f8 sp=0xc020749590 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d5f0, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020749a60 sp=0xc0207497f8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2ede0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc020749cc8 sp=0xc020749a60 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2ed00, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc020749f30 sp=0xc020749cc8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d5e0, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074a198 sp=0xc020749f30 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d560, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074a400 sp=0xc02074a198 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2ece0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074a668 sp=0xc02074a400 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2ec00, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074a8d0 sp=0xc02074a668 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d550, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074ab38 sp=0xc02074a8d0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d4d0, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074ada0 sp=0xc02074ab38 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2ebe0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074b008 sp=0xc02074ada0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2eb00, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074b270 sp=0xc02074b008 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d4c0, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074b4d8 sp=0xc02074b270 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d440, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074b740 sp=0xc02074b4d8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2eae0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074b9a8 sp=0xc02074b740 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2ea00, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074bc10 sp=0xc02074b9a8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d430, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074be78 sp=0xc02074bc10 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d3b0, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074c0e0 sp=0xc02074be78 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2e9e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074c348 sp=0xc02074c0e0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2e900, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074c5b0 sp=0xc02074c348 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d3a0, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074c818 sp=0xc02074c5b0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d320, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074ca80 sp=0xc02074c818 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2e8e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074cce8 sp=0xc02074ca80 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2e800, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074cf50 sp=0xc02074cce8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d310, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074d1b8 sp=0xc02074cf50 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d290, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074d420 sp=0xc02074d1b8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2e7e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074d688 sp=0xc02074d420 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2e700, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074d8f0 sp=0xc02074d688 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d280, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074db58 sp=0xc02074d8f0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d200, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074ddc0 sp=0xc02074db58 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2e6e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074e028 sp=0xc02074ddc0 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2e600, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074e290 sp=0xc02074e028 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d1f0, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074e4f8 sp=0xc02074e290 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x130d820, 0xc005b1d170, 0x199, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074e760 sp=0xc02074e4f8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x129e8c0, 0xc005b2e5e0, 0x196, 0x1121192, 0x8, 0x0, 0x0, 0x14efda0, 0x129e8c0, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074e9c8 sp=0xc02074e760 pc=0xf2ec1c
github.com/gin-gonic/gin/binding.mapping(0x132ad20, 0xc005b2e500, 0x199, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:96 +0x8f1 fp=0xc02074ec30 sp=0xc02074e9c8 pc=0xf2f1d1
github.com/gin-gonic/gin/binding.mapping(0x1325320, 0xc005b1d160, 0x196, 0x111f069, 0x7, 0x0, 0x0, 0x14efda0, 0x1325320, 0x0, ...)
	/usr/lib/golang/src/github.com/gin-gonic/gin/binding/form_mapping.go:67 +0x33c fp=0xc02074ee98 sp=0xc02074ec30 pc=0xf2ec1c
...additional frames elided...
created by net/http.(*Server).Serve
	/usr/lib/golang/src/net/http/server.go:2927 +0x911


## Environment
- go version: go version go1.13.6 linux/amd64
- gin version (or commit ref):v1.5.0
- operating system:Linux localhost.localdomain 3.10.0-1127.el7.x86_64 #1 SMP Tue Mar 31 23:36:51 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux


## Description

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	r := gin.Default()
        r.Static("/static", "../static")
	r.Run(":9000")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl http://localhost:8201/static/file.webp
<File here>
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl -i http://localhost:8201/static/file.webp
404 error
```

## Environment

- go version: v1.15
- gin version (or commit ref): 1.6.3
- operating system: ubuntu 20.04

# Other important information

This is the minimal project structure:
```
- cmd
  - main.go
- static
   - a file.webp
```
for example，url  GET "/user/1245" matched the pattern "/user/:userId", Is there any way to get the matched url pattern from gin.context in middleware?
## Description
I do it by command “go get -u -v github.com/gin-gonic/gin”，The following error message appears

【
    package github.com/gin-gonic/gin
        imports github.com/gin-contrib/sse
        imports net/http
        imports crypto/tls
        imports golang.org/x/crypto/chacha20poly1305
        imports golang.org/x/sys/cpu: C source files not allowed when not using cgo or SWIG: cpu_gccgo_x86.c
】

## Environment

- go version: 1.5.6
- gin version (or commit ref): lasted
- operating system: win 10 

## Description

Why using context.QueryArray() for a non-existing or empty array, the length of the return value is `1`? 
It should be `0`.

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"fmt"
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/hello", func(c *gin.Context) {
		list := c.QueryArray("list")
		fmt.Printf("the len of list is: %v.\n", len(list))
	})
	g.Run(":9000")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
![image](https://user-images.githubusercontent.com/34429036/101275777-52baa680-37e3-11eb-8278-b3bfd000d9f5.png)

![image](https://user-images.githubusercontent.com/34429036/101275722-e9d32e80-37e2-11eb-9b9e-980b43297bcf.png)


## Actual result

<!-- Actual result showing the problem -->
![image](https://user-images.githubusercontent.com/34429036/101275737-08d1c080-37e3-11eb-977d-6fb8813505ae.png)

## Environment

- go version: 1.15.5
- gin version (or commit ref): v1.6.3
- operating system: mac OS Catalina 10.15.7

## Description

I try to do some works with goroutine in handler as the [demo](https://github.com/gin-gonic/gin#goroutines-inside-a-middleware), and when I read the request body from copied context in goroutine, the reader always closed. the error detail is `http: invalid Read on closed Body`

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.POST("/dosomething", func(c *gin.Context) {
		cCp := c.Copy()
                go func() {
                    var err error
		    var buf []byte
		    if buf, err = ioutil.ReadAll(cCp.Request.Body); err != nil {
                        log.Println(err)
			return
		    }
                    fmt.Println(string(buf))
                }()
	})
	g.Run(":9000")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl -XPOST -d '...some json data...' http://localhost:9000/dosomething

...json data...
```

## Actual result

<!-- Actual result showing the problem -->
```
Show in stdout:

http: invalid Read on closed Body
```

## Environment

- go version: go1.14.4 darwin/amd64
- gin version (or commit ref): v1.6.3
- operating system: MacOS 10.14.5

This PR introduces fuzzing for Gin. The fuzzer in this PR is implemented by way of the [go-fuzz](https://github.com/dvyukov/go-fuzz) fuzzing engine.

Fuzzing is a way of testing applications whereby pseudo-random data is passed to a target function with the goal of finding bugs and vulnerabilities. The fuzzer in this PR is implemented with the go-fuzz fuzzing engine.

I have worked on setting continuous fuzzing up for the fuzzer which will allow it to run for longer and find harder-to-find bugs as well. I will shortly set up the integration for Gin on OSS-fuzz, and upon merging the fuzzer here, it will be able to run continuously through OSS-fuzz. OSS-fuzz is a free service for open source projects, and if/when bugs are found, maintainers get notified with an email containing a link to a detailed bug report with stacktrace and reproducer test-case. While it is a free service it is offered with an implied expectation that bugs are fixed, so that the resources spent on fuzzing Gin go towards resolving bugs in the codebase.

All that is needed to setup continuous fuzzing would be at least one maintainer email address.

For some examples of previous bugs found from fuzzing Golang projects I recommend checking out the trophy list on the go-fuzz repository: https://github.com/dvyukov/go-fuzz#trophies


This project has been a long time didn't update version.

It seem the project still updating but version never change.

Do you have any certain plan?
some loop don't need to transfer to bytes slice and some use the zero copy will much better.
## Description
    I used c.JSON() to return after json binding failed. But the Content-Type in response header is "text/plain; charset=utf-8".  

   After trying.I found that all headers setting after c.Writer.WriteHeaderNow() are invalid.
 
 How to reproduce

```
package main

import (
	"github.com/gin-gonic/gin"
)

type User1 struct {
	UserName string `json:"username"`
	Date     int    `json:"date"`
}

func main() {
	h := gin.New()
	h.POST("/api/ct", func(c *gin.Context) {
		var u User1
		if err := c.BindJSON(&u); err != nil {
			c.JSON(400, "fail")
			return
		}

		c.JSON(200, "ok")
	})

	h.Run(":4000")
}
```

## Expectations
 The Content-Type in response header is "application/json; charset=utf-8". That is, the header can be set correctly

## Actual result

![1123](https://user-images.githubusercontent.com/33141719/100606400-544c2080-3344-11eb-8858-ebcd9555621f.jpg)


## Environment

- go version: go1.14.9 darwin/amd64
- gin version (or commit ref):  gin 1.6.3
- operating system: darwin/amd64

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description
Im use the Gin'bind to check the request's  postdata，the struct like  that
```
type EditServiceForm struct {
	ID          string `form:"id" valid:"Required;MaxSize(30)"`
	State       int    `form:"state" valid:"Range(0,1)"`
}
//some  func  like  this  
func UpdateVoiceService(c *gin.Context) {
	log.Debug("enter func UpdateVoiceService")

	var (
		appG = app.Gin{C: c}
		form = EditServiceForm{ID: c.Param("id")}
	)

	httpCode, errCode := app.BindAndValid(c, &form)
	if errCode != e.SUCCESS {
		log.Error("UpdateVoiceService    BindAndValid  errcode:", errCode)
		appG.Response(httpCode, errCode, nil)
		return
	}
}

```

the  filed  state's default value is  0,If  the  postdate have no "data" field,  user the "form "  obj   to  update  mysql with ORM,it  must be wrong,because the "state" be set 0.



## Description

Getting Error: refused to get unsafe header "location" when trying to upload video using uppy via tusd to S3.
Operating System: Ubuntu 20.04
Used tusd version: current
Used tusd data storage: s3
Used tus client library: Uppy.js

## How to reproduce

```
package main

import (
	"fmt"
	"time"

	"github.com/aws/aws-sdk-go/aws"
	"github.com/aws/aws-sdk-go/aws/credentials"
	"github.com/aws/aws-sdk-go/aws/session"
	"github.com/aws/aws-sdk-go/service/s3"
	"github.com/gin-contrib/cors"
	gin "github.com/gin-gonic/gin"

	"github.com/tus/tusd/pkg/s3store"
	tusd "github.com/tus/tusd/pkg/handler"
)

func main() {

	router := gin.New()
	// router.Use(cors.New(cors.Config{
	// 	AllowOrigins:     []string{"http://localhost:3000"},
	// 	AllowMethods:     []string{"GET", "PATCH", "POST", "PUT"},
	// 	AllowHeaders:     []string{"Origin"},
	// 	ExposeHeaders:    []string{"Content-Length"},
	// 	AllowCredentials: true,
	// 	MaxAge:           12 * time.Hour,
	// }))
         **//Tried multiple things**
	// config := cors.DefaultConfig()
	// config.AllowOrigins = []string{"http://localhost:3000/*"}
	// router.Use(cors.New(config))

	router.Use(cors.Default())

	// S3 Configuration
	s3Config := &aws.Config{
		Region:      aws.String("ap-south-1"),
		Credentials: credentials.NewStaticCredentials(S3_ACCESS_KEY, S3_SECRET_KEY, ""),
	}

	router.POST("/files/", func(c *gin.Context) {

		s3Locker := s3store.New("bucket", s3.New(session.Must(session.NewSession()), s3Config))
		composer := tusd.NewStoreComposer()
		s3Locker.UseIn(composer)

		handler, err := tusd.NewHandler(tusd.Config{
			BasePath:                "/files/",
			StoreComposer:           composer,
			NotifyCompleteUploads:   true,
			NotifyTerminatedUploads: true,
			NotifyUploadProgress:    true,
			NotifyCreatedUploads:    true,
		})
		if err != nil {
			panic(fmt.Errorf("Unable to create handler: %s", err))
		}
		go func() {
			for {
				event := <-handler.CompleteUploads
				fmt.Printf("Upload %s finished\n", event.Upload.ID)
			}
		}()
	})
	router.Run()
}
```
My S3 CORS config:

```
[
    {
        "AllowedHeaders": [
            "Range"
        ],
        "AllowedMethods": [
            "GET",
            "POST",
            "PUT",
            "DELETE"
        ],
        "AllowedOrigins": [
            "*"
        ],
        "ExposeHeaders": [
            "Accept-Ranges",
            "Content-Encoding",
            "Content-Length",
            "Content-Range"
        ]
    }
]
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
The file must be uploaded to S3
```

## Actual result

![image](https://user-images.githubusercontent.com/41233079/100536704-57fa7d00-3248-11eb-8bb2-9bbcd0da4a92.png)

after meddling around my S3 CORS
![image](https://user-images.githubusercontent.com/41233079/100536717-6fd20100-3248-11eb-972c-fbf8c78c90ba.png)


## Environment

- go version: go1.15.3
- gin version (or commit ref): current
- operating system: Ubuntu

## Description

First, it's a pleasure for me to use this incredible framework. Thanks to the communities for all what it did.
And i open this issue to try to understand what is going wrong and if we found out that is a real issue, i will be proud to help you

I created a little api with gin gonic with few routes with severals gin-contrib package (cache, cors) to manage cache and cors issue.
And i started to test my gin gonic api and i chose to mock a gin.Context to be able to call the hundlerFunc easier. 
So i have two files, let's say a list.go and a list_test.go

## How to reproduce
As example, we could manage routes like that:
```
package api

import (
	"github.com/gin-gonic/gin"
	"github.com/gin-gonic/gin/binding"

	"net/http"
)

type inputParameter struct {
	Page int `form:"page" binding:"omitempty,numeric"`
}

func handleList(c *gin.Context) {
	var p inputParameter
	if err := c.ShouldBindWith(p, binding.Query); err != nil {
		c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
	}
	c.String(200, "Hello %s", c.Param("name"))

}
func main() {
	g := gin.Default()
	g.GET("/hello/:name", handleList)
	g.Run(":9000")
}
```
And a test file: 
```
package api

import (
	"fmt"
	"net/http/httptest"

	"github.com/stretchr/testify/assert"

	"testing"

	"github.com/gin-gonic/gin"
)

func TestList(t *testing.T) {
	w := httptest.NewRecorder()
	g, _ := gin.CreateTestContext(w)
	handleList(g)
	fmt.Println("result", g)
	// assert equality
	assert.Equal(t, 200, w.Code)

}
```
## Expectations

Should display a success message
```
$ go test -v
--- PASS: TestList (0.00s)
PASS
ok  	api	0.616s
```
## Actual result

Instead of a panic message
```
$ go test -v
--- FAIL: TestList (0.00s)
panic: runtime error: invalid memory address or nil pointer dereference [recovered]
	panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x10 pc=0x91c246]

goroutine 41 [running]:
testing.tRunner.func1(0xc00027e500)
	/usr/local/go/src/testing/testing.go:874 +0x3a3
panic(0x9f3de0, 0xf63fc0)
	/usr/local/go/src/runtime/panic.go:679 +0x1b2
github.com/gin-gonic/gin/binding.queryBinding.Bind(0x0, 0xa071c0, 0xf95760, 0xe8, 0xf0)
	~/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/binding/query.go:16 +0x26
github.com/gin-gonic/gin.(*Context).ShouldBindWith(...)
	~/go/pkg/mod/github.com/gin-gonic/gin@v1.6.3/context.go:679
api.list(0xc0002c41e0)
	simple.go:24 +0x80
api.TestList(0xc00027e500)
	simple_test.go:17 +0xbb
testing.tRunner(0xc00027e500, 0xacbd60)
	/usr/local/go/src/testing/testing.go:909 +0xc9
created by testing.(*T).Run
	/usr/local/go/src/testing/testing.go:960 +0x350
exit status 2
FAIL	api	0.540s
```
And to fix that, i found a workaround which is to define locally a custom struct which is compliant with 
```
type Binding interface {
	Name() string
	Bind(*http.Request, interface{}) error
}
```
Finally, we have:
```
type customBinding struct {}

func (q *customBinding) Name() string {
	return "query"
}
func (q *customBinding) Bind(req *http.Request, obj interface{}) error {
	return nil
}
func handleList(c *gin.Context) {
	var p inputParameter
	var b customBinding
	if err := c.ShouldBindWith(p, &b); err != nil {
		c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
	}
	c.String(200, "Hello %s", c.Param("name"))

}
```
It seems strange that i need to redefine a struct which is already defined in package binding and i don't understand why this happens, as if the binding package can not be reached

I stay available if you need more details guys.


## Environment

- go version: go version go1.13.6 linux/amd64
- gin version: gin-gonic/gin v1.6.3
- operating system: Ubuntu 18.04.4 LTS x86_64

Ryl
Before:

```
panic: gin mode unknown: development

goroutine 1 [running]:
github.com/gin-gonic/gin.SetMode(...)
	/home/flatearther/go/packages/pkg/mod/github.com/gin-gonic/gin@v1.6.3/mode.go:61
github.com/gin-gonic/gin.init.0()
	/home/flatearther/go/packages/pkg/mod/github.com/gin-gonic/gin@v1.6.3/mode.go:48 +0x16a
exit status 2
```

After:

```
panic: gin mode unknown: development (available mode: debug release test)

goroutine 1 [running]:
github.com/gin-gonic/gin.SetMode(...)
	/home/flatearther/go/packages/pkg/mod/github.com/gin-gonic/gin@v1.6.3/mode.go:61
github.com/gin-gonic/gin.init.0()
	/home/flatearther/go/packages/pkg/mod/github.com/gin-gonic/gin@v1.6.3/mode.go:48 +0x16a
exit status 2
```
https://ru.stackoverflow.com/questions/1208712/eof-in-bindjson-gin

I implements a delete method by gin, and I get data form body like this:
```go
func Delete(context *gin.contex){
        id:=context.PostForm("id")
        //do some logical codes
}
```
But I found that the id is an empty string which means **the context doesn't contain `id` param in body**(I'm not sure, but I think it has a high possibility).
I found there is a closed issue(#396) but it was closed without solving method. I'm confused about this .
##  Description

`c.FullPath()` output incorrect relative path

## How to reproduce
```go
func HTTPRouter(r gin.IRouter) {
	r.GET("/fullpathadfaadfaf", func(c *gin.Context) {
		fmt.Println(c.FullPath())
	})
}
```
`curl http://localhost:9112/local/api/fullpathadfaadfaf`
output:
```
/local/api/fk-exchange-shop-backup/          // this is another router
```
## Environment

- go version: go1.12.17
- gin version (or commit ref): 73c4633943d596bdbeaa7d02cebdd4bd0c4f4630
- operating system: windows10 64


- Slow response to concurrent requests

- response body : 14M
- concurrent requests number: 300
- just read memory string data to return, but very slow in concurrent requests scenarios, 
- go-version: go 1.14
- gin version: v1.6.3
How should I use it accurately?

```
		ctx.String(http.StatusOK, memData.JsonData)
		return
```



## Description

After starting a `c.Stream` or `io.Copy(writer, body)`, etc. it becomes impossible to alert the client that the request has failed (except by corrupting the body or hijacking the request).

## How to reproduce

```go
package main

import (
	"io"
	"net/http"

	"github.com/gin-gonic/gin"
)

func main() {
	router := gin.Default()

	router.GET("/test", func(c *gin.Context) {
		first := true
		c.Stream(func(w io.Writer) bool {
			if first {
				w.Write([]byte("test"))
				first = false
				return true
			}

			if wr, ok := w.(gin.ResponseWriter); ok {
				wr.WriteHeader(http.StatusInternalServerError)
			}
			return false
		})
	})

	router.Run(":8080")
}
```

## Expectations

```bash
$ curl -v localhost:8080/test
...
< HTTP/1.1 500 Internal Server Error
...
```

## Actual result

```bash
$ curl -v localhost:8080/test
...
< HTTP/1.1 200 OK
...
```

## Environment

- go version: go1.15.3 darwin/amd64
- gin version (or commit ref): v1.6.3
- operating system: MacOS

### Other notes

It looks like the issue is on the `gin.responseWriter.Write` that calls `WriteHeaderNow`:

```go
func (w *responseWriter) Write(data []byte) (n int, err error) {
	w.WriteHeaderNow()
	n, err = w.ResponseWriter.Write(data)
	w.size += n
	return
}
``` 

It should also be noted that this renders `c.AbortWithStatus()` useless

Logs from server:

```bash
[GIN-debug] [WARNING] Headers were already written. Wanted to override status code 200 with 500
[GIN] 2020/11/18 - 14:54:00 | 500 |      52.011µs |             ::1 | GET      "/test"
```
## Description

<!-- Description of a problem -->
I've defined a structure with some validate tags

**for example:**
```
type User struct{
       Username `form:"username" binding:"required"`
       Password `form:"password" binding:"required,min=8,max=16"`
}
```
**When I use it like the following:**
```
func f1(c *gin.context){
       var u User
       err := c.ShouldBindWith(&User)
       if err != nil {
          log.Fatal(err)
       }
{
```
1. The first time, I send the correct password to the server(8<= len <=16). It passed.
2. Later, I intentionally sent the password of the wrong length.It still goes through.

I was very surprised. I thought there was something wrong with the parameter verification of GIN, which was very abnormal

The `copy()` function cannot forcefully restrict the use of `*gin.context` within the coroutine, so it is easy to cause variable competition. Unconscious things need to be restricted, and the kv carried in a clear context will be recycled after the request ends.
## Environment

- go version: 1.15
- gin version (or commit ref): 1.6.3
- operating system: macOS
I prefer to restrict user post data with the required field ```enable```
so I defined the rule as below
```
type EnableRequest struct {
	Enable bool `json:"enable" binding:"required"`
}
var enableRequest EnableRequest
err := c.BindJson(&enableRequest)
```

when I call the API as below, nothing goes wrong.
```
curl --location --request POST 'localhost:8081/api/v1/config/throttle' \
--header 'Content-Type: application/json' \
--header 'Cookie: _csrf=miWgQTwMDH_SCDe9MSucP0uobmADouDl' \
--data-raw '{
    "enable": true
}'
```
however, when I change the value to bool ```false```
error of ```Key: 'EnableRequest.Enable' Error:Field validation for 'Enable' failed on the 'required' tag``` will return.

I tried to pass the string ```"false"``` to the API, an error will raise for invalid type

full sample below:
```

package main

import (
	"fmt"
	"github.com/gin-gonic/gin"
)

type Req struct {
	Enable bool `json:"enable" binding:"required"`
}

func main() {
	r := gin.Default()
	r.POST("/post", x)
        r.Any("/any", x)
	r.Run(":8082")
}

func x(c *gin.Context) {
	var req Req
	err := c.BindJSON(&req)
	if err != nil {
		fmt.Println(err)
		return
	}
	fmt.Println("Req", req)
	return
}
```
false value will cause error
```
{
    "enable": false
}
```




# Description


 I use goroutine to deal a post function,but if i send two post in the same time or one by one ,i get this this error: [debug]error on parse multipart form array: multipart: NextPart: http: invalid Read on closed Body


## How to reproduce

![image](https://user-images.githubusercontent.com/12507576/98926742-a8689f80-2512-11eb-974e-57261877d1bc.png)

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"fmt"
	"github.com/gin-gonic/gin"
	"log"
	"time"
)

func main() {
	r := gin.Default()
	r.POST("/long_async", func(c *gin.Context) {
		// create copy to be used inside the goroutine
		cCp := c.Copy()
		go func() {
			// simulate a long task with time.Sleep(). 5 seconds
			fmt.Println(cCp.PostForm("log_id"))
			image, _ := cCp.FormFile("image")
			fmt.Println(image.Filename)
			time.Sleep(5 * time.Second)
			// note that you are using the copied context "cCp", IMPORTANT
			log.Println("Done! in path " + cCp.Request.URL.Path)
		}()
	})

	// Listen and serve on 0.0.0.0:8080
	r.Run(":8080")
}

```

## Expectations



## Environment

- go version:1.15.3
- gin version (or commit ref):v1.6.3
- operating system:Mac os 10.15.7

I am using gin to implement the original PHP API. Currently, there are online requests similar to 

`/path?a[]=1&a[]=2&b[0]=1&b[1]=2&c[0][age]=1&c[0][name]=abc`.

 How can I get such array parameters in gin?

get value like:

```
a=["1", "2"]
b=["1", "2"]
c=[{"age": "1", "name": "abc"}]
```
## Description

The `GET` request query string parameter with whitespace will directly return to 400. How can I directly process this kind of parameter with whitespace like PHP?

The request is as follows:

` curl -XGET -g "http://localhost:9000/query?starttime=2020-11-12 08:01:00&endtime=2020-11-12 09:01:00"`



When the whitespace is replaced by `+` or `%20`, the request can be received normally. However, there is whitespace in the actual online request, which needs to be compatible. Is there any way?



## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/query", func(c *gin.Context) {
		c.String(200, "from %s to %s", c.Query("starttime"), c.Query("endtime"))
	})
	g.Run(":9000")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
curl -XGET -g "http://localhost:9000/query?starttime=2020-11-12 08:01:00&endtime=2020-11-12 09:01:00"
from 2020-11-12 08:01:00 to 2020-11-12 09:01:00
```

## Actual result

<!-- Actual result showing the problem -->
```
curl -XGET -g "http://localhost:9000/query?starttime=2020-11-12 08:01:00&endtime=2020-11-12 09:01:00"
400 Bad Request
```

## Environment

- go version:1.14
- gin version (or commit ref):1.6.3
- operating system:macos zsh

go version: master branch
issue info: `internal/bytesconv/bytesconv.go:14:8: possible misuse of reflect.StringHeader`
more info: https://travis-ci.org/github/gin-gonic/gin/jobs/742893211

ref go issue: https://github.com/golang/go/issues/40701
…ce before the if statement on graceful shutdown

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


Minor fixes on comments. No additional test is needed.
HTTP HEAD requests are intended to be identical to the corresponding GET requests, except that there is no response body (https://tools.ietf.org/html/rfc7231#section-4.3.2). It is a considerable convenience to Gin users if this behavior is provided automatically, so that's the purpose of this PR.

* Whenever a GET handler is registered, the equivalent HEAD handler will exist automatically.
* Extra HEAD handlers can be added but will rarely be needed.

This PR

* refactored `Engine.handleHTTPRequest` so that two passes are made if the request is HEAD and there isn't a matching HEAD handler - this is the important part of the PR
* suppresses rendering for HEAD request in `Context.Render`, which means that wasteful processing is avoided
* re-ordered GET and HEAD methods to be adjacent
* added test cases for the new code
* added more documentation

The standard Go api `net/http` also has automatic behavior for HEAD requests such that the response body is discarded. This PR doesn't rely on this (although it could), because rendering the unwanted HEAD response can be avoided.

Hey, we need to use the customRecovery which is not included into the v1.6.3 - is there any plan to release a new version in the next days? 

thanks
controller like this:
```go
type myStruct struct {
    Mobile int `json:"mobile"`
}
c.JSON(200, myStruct)
```

I want response like this:
```json
{
    "code": 0,
    "data": {
        "mobile": 12345678
    },
    "msg": "success"
}
```
---

Can I intercept fields in the middleware that return to add wrapping?
just like this:
```go
func ApiResponse() gin.HandlerFunc {
	return func(c *gin.Context) {
		c.Next()

		errs := c.Errors.ByType(gin.ErrorTypeAny)
		if len(errs) > 0 {
                        switch err.(type) {
			case validator.ValidationErrors:
				statusCode = http.StatusUnprocessableEntity

				errs, _ := err.(validator.ValidationErrors)
				trans, transerr := validation.InitTrans(viper.GetString("locale"))

				var valiErr interface{}
				if transerr == nil {
					valiErr = errs.Translate(trans)
				} else {
					valiErr = errs
				}

				errResp = &e.Errno{
					Code: statusCode,
					Msg:  "failed",
					Errs: valiErr,
				}
			default:
				errResp = &e.Errno{
					Code: statusCode,
					Msg:  fmt.Sprintf("unknow error: %s", err.Error()),
				}
			}

			c.AbortWithStatusJSON(statusCode, errResp)
			return
		} else {
                        // todo interrupt and modify response
                        // how ?
               }

	}
}
```



## Description
As the code showing in the binding.go, there is no multipart/mixed supported.
<!--  -->
![image](https://user-images.githubusercontent.com/11610514/98091939-09fc8e80-1ec1-11eb-8395-e074ca5b3434.png)

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```

```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$curl -i -X POST http://127.0.0.1:9702/upload -F "upfile=@/Users/test/Desktop/test.png" -F "type=image" -H "Content-Type: multipart/mixed"
```

## Actual result

<!-- Actual result showing the problem -->
```
	ErrNotMultipart = &ProtocolError{"request Content-Type isn't multipart/form-data"}

```

## Environment

- go version: 1.13


render/json.go defines `AsciiJSON` and some internal names `jsonContentType`, `jsonpContentType`, `jsonAsciiContentType`. This shows a misunderstanding of [RFC4627](https://tools.ietf.org/html/rfc4627) section 3: "JSON text SHALL be encoded in Unicode".

From the RFC, it follows

* the content type `application/json` implies that the content is UTF-8 or UTF-16 or UTF-32 - the RFC describes how the decoder detects the correct UTF from the first bytes.
* it is not helpful to use the term _ASCII_, even if the JSON content happens to be an ASCII-subset of UTF-8

`AsciiJSON` doesn't do what its name suggests. It should be deprecated (and later removed)

Because Go strings are UTF-8 by default, it is equally correct to use the content-type with charset (`application/json;charset=utf-8`) and without charset (`application/json`). The longer form takes a few more bytes but eliminates the (tiny) chance of there being a faulty decoder at the other end and it getting it wrong.

But if someone wants to force the encoding to be some other UTF (e.g. UTF-16 for Asian content), there isn't a way to do that in Gin and maybe that's what is needed. For Asian content, the advantage would be that the UTF-16 encoding would take fewer bytes (a bit less than two-thirds) than UTF-8 encoding for the same content.

So perhaps replace `AsciiJSON` with `JSON_UTF16LE` and `JSON_UTF16BE`. The render methods would need to ensure that the written content is correctly transcoded into the chosen UTF-16 encoding.
## Description

<!-- Description of a problem -->

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"net/http"
	
	"github.com/gin-gonic/gin"
)

// Binding from JSON
type Login struct {
	User     string `form:"user" json:"user" binding:"-"`
	Password string `form:"password" json:"password" binding:"-"`
	Email    string `form:"email" json:"email"  binding:"required_without_all=user password"`
}

func main() {
	router := gin.Default()

	router.POST("/loginJSON", func(c *gin.Context) {
		var json Login
		if err := c.ShouldBindJSON(&json); err != nil {
			c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
			return
		}

		c.JSON(http.StatusOK, gin.H{"status": "you are logged in"})
	})

	// Listen and serve on 0.0.0.0:8080
	router.Run(":8080")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
curl --location --request POST 'http://127.0.0.1:8080/loginJSON' --header 'Content-Type: application/json' --data-raw '{"user":"aaa","password":"bbb","email": ""}'
{"status":"you are logged in"}
```

## Actual result

<!-- Actual result showing the problem -->
```
curl --location --request POST 'http://127.0.0.1:8080/loginJSON' --header 'Content-Type: application/json' --data-raw '{"user":"aaa","password":"bbb","email": ""}'
{"error":"Key: 'Login.Email' Error:Field validation for 'Email' failed on the 'required_without_all' tag"}
```

## Environment

- go version:
  go version go1.14.1 windows/amd64
- gin version (or commit ref):
  v1.6.3
- operating system:
  Win10




## Description

 when i use bindQuey, i hope the required validation method will not execute(because the required binding tag just for POST, not for query) , Or can gin let me call the validate method  explicitly?

now when i call bindquery, it will raise required error because of the 'required' tag.  

example:

package main

import (
	"github.com/gin-gonic/gin"
)

type User struct {
     Name string `json:"name" binding: "required"`
     Age int          `json: "age" binding: "required"`
}

func main() {
	g := gin.Default()
	g.GET("/hello?name=jack", func(c *gin.Context) {
	       var u User
               c.BindQuery(&u)
	})
       g.POST("/hello", func(c *gin.Context) {
             var u User  
             c.BindJSON(&u)
        }
	g.Run(":9000")
}


## Environment

- go version: 1.13
- gin version (or commit ref): 1.6.3
- operating system: mac

if i do like this ,the binding won't work 
```
func formHandler(c *gin.Context) {
    var fakeForm myForm
  var  it interface{} = fakeForm
    c.ShouldBind(&fakeForm)
    c.JSON(200, gin.H{"color": fakeForm.Colors})
}
```


I just discovered gin & want to visit its website.

But I found the link https://gin-gonic.com/ is not opening.
Clicking the link to `gin-gonic.com` on this page https://github.com/gin-gonic/gin gives a 404 error



- With issues:
  - Greetings to all, I am Heru from Indonesia.
I entered this forum for the purpose of asking for help from all for problems from the server I just bought.
Server name / type:
Dell PowerEdge T340
Troble: the Dell PE T340 server does not yet support installing Centos 7 OS, information from Dell technical support.

Help:
Please help share this forum, if anyone has OS Centos 7 firmware that can support the Dell PowerEdge T340 server.

My hope is that seniors are willing to share a little of their knowledge in this forum to provide solutions to my problems together.
thank you foll all

- go version:
- gin version (or commit ref):
- operating system:

Hi,
I had added ppc64le(Linux on Power) architecture support on travis-ci in the PR and looks like its been successfully added. I believe it is ready for the final review and merge. The travis ci build logs can be verified from the link below.
https://travis-ci.com/github/kishorkunal-raj/gin/builds/191395651

Reason behind running tests on ppc64le: This package is included in the ppc64le versions of RHEL and Ubuntu - this allows the top of tree to be tested continuously as it is for Intel, making it easier to catch any possible regressions on ppc64le before the distros begin their clones and builds. This reduces the work in integrating this package into future versions of RHEL/Ubuntu.

Please have a look.
After I registered other routers, when I want to register the static resources router to the path "/",  it told me "CONFLICTS"

My code:
```go
func main() {
        router := gin.Default()

	router.Use(gin.Logger())

	router.Use(gin.Recovery())

	router.StaticFS("/", http.Dir("public"))

	v1 := router.Group("/api/v1")

	{
		task := v1.Group("/task")

		api.NewTaskApi(task)

	}

	router.Run(":3408")
}
```

errors like that:
```bash
panic: '/api/v1/task/' in new path '/api/v1/task/' conflicts with existing wildcard '/*filepath' in existing prefix '/*filepath'
```

fix https://github.com/gin-gonic/gin/issues/2534

`required_if` and `required_unless` are released in v10.4.0.
gin uses v10.2.0, so I can't use it.
https://pkg.go.dev/github.com/go-playground/validator/v10#hdr-Required_If

## How to reproduce
```
package main

import (
	"github.com/gin-gonic/gin"
)

type UserRequest struct {
	Id       int    `uri:"id"`
	Nickname string `json:"nickname"`
	Mobile   string `json:"mobile"`
	Email    string `json:"email"`
}

func main() {
	g := gin.Default()
	g.GET("/user/:id", func(c *gin.Context) {
		// how to do?
	})
	g.Run(":9000")
}
```

```
curl -v -X POST \
  http://localhost:8080/user/12\
  -H 'content-type: application/json' \
  -d '{"nickname": "nickname1","mobile": "133232323232","email": "fqlw@qqq.com"

```


## Description

Undefined validation function 'required_if' on field 'Field'

[https://godoc.org/github.com/go-playground/validator#hdr-Required_If](url)

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)

type ListReq struct {
        Id        int64  `form:"id" binding:"required,gte=1"`
	AppCode   string `form:"appCode" binding:"required"`
	BranchTag string `form:"branchTag" binding:"required_if=Id 1"`
}

func main() {
	g := gin.Default()
	g.GET("/list", func(c *gin.Context) {
		var form ListReq
	        if err := c.ShouldBindQuery(&form); err != nil {
		       c.String(http.StatusOK, "error")
		       return
	        }
                c.String(http.StatusOK, "ok")
	})
	g.Run(":9000")
}
```

## Expectations
```
$ curl -i http://localhost:9000/list
ok
```

## Actual result

```

$ curl -i http://localhost:9000/list
curl: (52) Empty reply from server

Undefined validation function 'required_if' on field 'BranchTag'
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/go-playground/validator/v10/cache.go:289 (0xd6ae36)
	(*Validate).parseFieldTagsRecursive: panic(strings.TrimSpace(fmt.Sprintf(undefinedValidation, current.tag, fieldName)))
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/go-playground/validator/v10/cache.go:150 (0xd68e27)
	(*Validate).extractStructCache: ctag, _ = v.parseFieldTagsRecursive(tag, fld.Name, "", false)
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/go-playground/validator/v10/validator.go:37 (0xd71aed)
	(*validate).validateStruct: cs = v.v.extractStructCache(current, typ.Name())
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/go-playground/validator/v10/validator_instance.go:304 (0xd7a02d)
	(*Validate).StructCtx: vd.validateStruct(ctx, top, val, val.Type(), vd.ns[0:0], vd.actualNs[0:0], nil)
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/go-playground/validator/v10/validator_instance.go:277 (0xd79ad6)
	(*Validate).Struct: return v.StructCtx(context.Background(), s)
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/binding/default_validator.go:30 (0xeebedd)
	(*defaultValidator).ValidateStruct: if err := v.validate.Struct(obj); err != nil {
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/binding/binding.go:115 (0xeebd29)
	validate: return Validator.ValidateStruct(obj)
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/binding/query.go:20 (0xef2ca4)
	queryBinding.Bind: return validate(obj)
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/context.go:679 (0xf00c11)
	(*Context).ShouldBindWith: return b.Bind(c.Request, obj)
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/context.go:654 (0xf00785)
	(*Context).ShouldBindQuery: return c.ShouldBindWith(obj, binding.Query)
I:/source/go/src/dev-zt-api.2345.cn/controller/webapi/appMobileController.go:186 (0x12af8c4)
	CompList: if err := c.ShouldBindQuery(&form); err != nil {
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/context.go:161 (0xefcb5b)
	(*Context).Next: c.handlers[c.index](c)
I:/source/go/src/dev-zt-api.2345.cn/middleware/user/user.go:45 (0x127f4d2)
	User.func1: c.Next()
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/context.go:161 (0xefcb5b)
	(*Context).Next: c.handlers[c.index](c)
I:/source/go/src/dev-zt-api.2345.cn/middleware/trace/traceLog.go:37 (0x12b6ae4)
	LogBase.func1: c.Next()
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/context.go:161 (0xefcb5b)
	(*Context).Next: c.handlers[c.index](c)
I:/source/go/src/dev-zt-api.2345.cn/middleware/cors/cors.go:29 (0x12b4cfa)
	Cors.func1: c.Next()
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/context.go:161 (0xefcb5b)
	(*Context).Next: c.handlers[c.index](c)
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/logger.go:241 (0xf174f7)
	LoggerWithConfig.func1: c.Next()
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/context.go:161 (0xefcb5b)
	(*Context).Next: c.handlers[c.index](c)
I:/source/go/src/dev-zt-api.2345.cn/middleware/cors/recovery.go:107 (0x12b6684)
	RecoveryWithWriter.func1: c.Next()
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/context.go:161 (0xefcb5b)
	(*Context).Next: c.handlers[c.index](c)
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/gin.go:409 (0xf09ef2)
	(*Engine).handleHTTPRequest: c.Next()
I:/source/go/src/dev-zt-api.2345.cn/vendor/github.com/gin-gonic/gin/gin.go:367 (0xf0997e)
	(*Engine).ServeHTTP: engine.handleHTTPRequest(c)
C:/Go/src/net/http/server.go:2843 (0x9bf86a)
	serverHandler.ServeHTTP: handler.ServeHTTP(rw, req)
C:/Go/src/net/http/server.go:1925 (0x9b9944)
	(*conn).serve: serverHandler{c.server}.ServeHTTP(w, w.req)
C:/Go/src/runtime/asm_amd64.s:1374 (0x5f5c00)
	goexit: BYTE	$0x90	// NOP
<!-- Actual result showing the problem -->
```

## Environment

- go version:1.5.2
- gin version (or commit ref):1.6.3
- operating system:win10 1909

## Description

I'm trying to pass a file upload and a json with some data. I tried using both c.ShouldBindJSON() and c.FormFile("file"). They work individually but not together. I dont want to pass the json as form-data but I've tried that too but cant get it to find to the custom struct. 

Basically the file I get will be saved and a link of it will be added to database along with some data passed through the same handler. I'm testing using postman.

## How to reproduce
```
type Files struct {
	Id           int64    
	User_Id   int64     
	FileName string   
	Type         string     
	Name         string   
	Link         string  
	Created      time.Time
	Updated      time.Time 
}

func FileUploadHandler() func(c *gin.Context) {
	return func(c *gin.Context) {
	
		var model Files
		err := c.ShouldBindJSON(&model)
		file, err := c.FormFile("file")
		if err != nil {
			fmt.Println(err)
			c.String(http.StatusBadRequest, fmt.Sprintf("get form err: %s", err.Error()))
			return
		}
		
		fileSrc := "../uploads/" + filename
		// FILE SAVED
		if err := c.SaveUploadedFile(file, fileSrc); err != nil {
	
			c.JSON(http.StatusBadRequest, fmt.Sprintf("upload file err: %s", err.Error()))
			return
		}else{
			err:=model.Add
			if err!=nil{
				c.JSON(http.StatusInternalServerError, fmt.Sprintf("upload file err: %s", err.Error()))
				return

			}else{
				c.JSON(200, gin.H{
					"success": "files added successfully",
				})
			}
		}
	}
}
```

## Actual result

I get this error:
multipart: NextPart: bufio: buffer full
```

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.



https://github.com/gin-gonic/gin/pull/1296

fixed the conflicts!
If an addr parameter is not passed in `Run`, it will get `PORT` env variable. If there is not a PORT variable，it will use default port - `8080`. But sometimes, there is a PORT env variable, but it is not a valid value(0-65535),the app will panic. So I add a function to judge the PORT whether is valid. For example:

my code:
```
func main() {
    r := gin.Default()
    ...
    if  err := r.Run(); err != nil {
       ...
   }
}
```

run:
```
➜  gin $ echo $PORT
abc
➜  gin $ go run main.go
[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.

[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /get                      --> main.main.func1 (3 handlers)
[GIN-debug] Environment variable PORT="abcd"
[GIN-debug] Listening and serving HTTP on :abcd
[GIN-debug] [ERROR] listen tcp: lookup tcp/abcd: nodename nor servname provided, or not known
2020/04/16 23:33:36 listen tcp: lookup tcp/abcd: nodename nor servname provided, or not known
exit status 1
```
Is it possible to use htpasswd file for basic auth?
If an addr parameter is not passed in `Run`, it will get `PORT` env variable. If there is not a PORT variable，it will use default port - `8080`. But sometimes, there is a PORT env variable, but it is not a valid value(0-63335),the app will panic. So I add a function to judge the PORT whether is valid. For example:

my code:
```
func main() {
    r := gin.Default()
    ...
    if  err := r.Run(); err != nil {
       ...
   }
}
```

run:
```
➜  gin $ echo $PORT
abc
➜  gin $ go run main.go
[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.

[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /get                      --> main.main.func1 (3 handlers)
[GIN-debug] Environment variable PORT="abcd"
[GIN-debug] Listening and serving HTTP on :abcd
[GIN-debug] [ERROR] listen tcp: lookup tcp/abcd: nodename nor servname provided, or not known
2020/04/16 23:33:36 listen tcp: lookup tcp/abcd: nodename nor servname provided, or not known
exit status 1
```
If an addr parameter is not passed in `Run`, it will get `PORT` env variable。If there is not a `PORT` variable，it will use default port - `8080`。But sometimes, there is a `PORT` env variable, but it is not a valid value(0-63335),the app will panic。So I add a function to judge the `PORT` whether is valid。For example:
```
➜  gin $ echo $PORT
abc
➜  gin $ go run main.go
[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.

[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /get                      --> main.main.func1 (3 handlers)
[GIN-debug] Environment variable PORT="abcd"
[GIN-debug] Listening and serving HTTP on :abcd
[GIN-debug] [ERROR] listen tcp: lookup tcp/abcd: nodename nor servname provided, or not known
2020/04/16 23:33:36 listen tcp: lookup tcp/abcd: nodename nor servname provided, or not known
exit status 1
```

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.

CustomRecovery allows the user to control what happens in the case of a panic without having to re-implement the Recovery middleware

I think this is more elegant。In switch-case，we don't need judge that `value` is `""`。

Why the `Engine.trees` is a `[]methodTree`，not is a `map[string]*node`？
My question is why `Engine.trees` is a slice instead of a map？
In `httprouter`，the `tree` is `map[string]*node`，but in gin, it is 
`type methodTree struct {
	method string
	root   *node
}
`
`
type methodTrees []methodTree
`
- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


https://github.com/gin-gonic/gin/tree/master/ginS
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

<!-- Description of a problem -->

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```go
package main

import (
	"github.com/gin-gonic/gin"
)

func setRouter() {
    group.POST("",
        RequestBodyCheck(&RequestFormat{}),
	RequestHandler)
}

// RequestHandler for business logic
func RequestHandler(ctx *gin.Context) {
    reqData, _ := ctx.Get("request_body")
    // it doesn't necessary conversion success check
    body, ok := reqData.(*CreateRequest)
    if !ok {
        ctx.Status(http.StatusBadRequest)
        return
    }

    log.Println(body)
}

// RequestBodyCheck this handler is validation check for request body
func RequestBodyCheck(reqData interface{}) gin.HandlerFunc {
    return func(c *gin.Context) {
		// request body marshaling and validation check
		clear(reqData)
		body, _ := ioutil.ReadAll(c.Request.Body)
		marshal, err := reqBodyCheck(body, reqData)
		if err != nil {
			c.String(http.StatusBadRequest, "error occurred")
			return
		}
		log.Printf("Request Body : %s", body)
		c.Set("request_body", marshal)
		c.Next()
	}
}

func reqBodyCheck(body []byte, inter interface{}) (interface{}, error) {
	if err := json.Unmarshal(body, inter); err != nil {
		return nil, err
	}
	return inter, nil
}
```

## Expectations
Hi.
I am currently developing api with gin.
However, I have an issue and I inquire.
I am using a handler chain to validate the format for routers with a request body. Among them, if the format is valid, I try to store the requested data in the context using the c.Set ('') function and have the next handler use it. If this is a concurrent request, the data seems to be handled incorrectly. Am I using it wrong?

If you make a request to the router at the same time, there are seems to be a problem when overwriting other data.

Is there a problem in gin context's Set () and Get () functions in a concurrent request?

## Environment

- go version: 1.12
- gin version (or commit ref): v1.5.0
- operating system: ubuntu 16.04

`NegotationFormat` raises out-of-range access to an offer string with some invalid HTTP Accept header values. It happens with the current master: 3315353c20ab224d9308db9df19d83383dba539a .

For example, the following header causes an internal server error.

```
Accept: application/json2
```

I also found `NegotationFormat` returns an inappropriate result with some invalid Accept values. Please refer to the `TestContextNegotiationFormatWithInvalidAccept`.

So I updated the implementation to handle those invalid values properly.

---

I found that the wildcard support for content negotiation was introduced in https://github.com/gin-gonic/gin/pull/1112.
But it seems there is no discussion about the old implementation.
I am sorry if I missed something.
I use gin to write Envoy's xDS whose endpoints carry special character ':' which doesn't mean parameter It's just a part of the path.

My issue is: Can I escape ':' let it only as raw ':'
## Description
Validator panics with datetime field

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)

type request struct {
	Timestamp     time.Time `json:"timestamp" binding:"datetime=20060102"`
}

func main() {
	g := gin.Default()
	g.GET("/hello/", func(c *gin.Context) {
                var r request
                if err := c.BindJson(&r); err != nil {
                     c.String(400, "Bad request")
                }
		c.String(200, "Hello %s", r.Timestamp))
	})
	g.Run(":9000")
}
```

## Expectations

```
$ curl http://localhost:9000/hello/
Bad request
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl -i http://localhost:9000/hello/
Bad field type time.Time
C:/Users/latsha/go/pkg/mod/github.com/go-playground/validator/v10@v10.2.0/baked_in.go:2090 (0x741b8c)
        isDatetime: panic(fmt.Sprintf("Bad field type %T", field.Interface()))
C:/Users/latsha/go/pkg/mod/github.com/go-playground/validator/v10@v10.2.0/baked_in.go:36 (0x751f6f)
        wrapFunc.func1: return fn(fl)
C:/Users/latsha/go/pkg/mod/github.com/go-playground/validator/v10@v10.2.0/validator.go:445 (0x74951c)
        (*validate).traverseField: if !ct.fn(ctx, v) {
C:/Users/latsha/go/pkg/mod/github.com/go-playground/validator/v10@v10.2.0/validator.go:77 (0x748a5b)
        (*validate).validateStruct: v.traverseField(ctx, parent, current.Field(f.idx), ns, structNs, f, f.cTags)
C:/Users/latsha/go/pkg/mod/github.com/go-playground/validator/v10@v10.2.0/validator_instance.go:304 (0x74ee85)
        (*Validate).StructCtx: vd.validateStruct(ctx, top, val, val.Type(), vd.ns[0:0], vd.actualNs[0:0], nil)
C:/Users/latsha/go/pkg/mod/github.com/go-playground/validator/v10@v10.2.0/validator_instance.go:277 (0x8e0150)
        (*Validate).Struct: return v.StructCtx(context.Background(), s)
C:/Users/latsha/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/binding/default_validator.go:30 (0x8e0113)
        (*defaultValidator).ValidateStruct: if err := v.validate.Struct(obj); err != nil {
C:/Users/latsha/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/binding/binding.go:115 (0x8e3f62)
        validate: return Validator.ValidateStruct(obj)
C:/Users/latsha/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/binding/json.go:55 (0x8e3f31)
        decodeJSON: return validate(obj)
C:/Users/latsha/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/binding/json.go:37 (0x8e3d7c)
        jsonBinding.Bind: return decodeJSON(req.Body, obj)
C:/Users/latsha/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/context.go:682 (0x8f024d)
        (*Context).ShouldBindWith: return b.Bind(c.Request, obj)
C:/Users/latsha/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/context.go:625 (0x8f0218)
        (*Context).MustBindWith: if err := c.ShouldBindWith(obj, b); err != nil {
C:/Users/latsha/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/context.go:588 (0x9db8a9)
        (*Context).BindJSON: return c.MustBindWith(obj, binding.JSON)
C:/Users/latsha/Documents/Projects/go/validator/card/views.go:13 (0x9db8b4)
        cardPass: if err := c.BindJSON(&s); err != nil {
C:/Users/latsha/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/context.go:156 (0x8ed8d1)
        (*Context).Next: c.handlers[c.index](c)
C:/Users/latsha/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/recovery.go:83 (0x901eda)
        RecoveryWithWriter.func1: c.Next()
C:/Users/latsha/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/context.go:156 (0x8ed8d1)
        (*Context).Next: c.handlers[c.index](c)
C:/Users/latsha/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/logger.go:241 (0x900fe7)
        LoggerWithConfig.func1: c.Next()
C:/Users/latsha/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/context.go:156 (0x8ed8d1)
        (*Context).Next: c.handlers[c.index](c)
C:/Users/latsha/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/gin.go:409 (0x8f8133)
        (*Engine).handleHTTPRequest: c.Next()
C:/Users/latsha/go/pkg/mod/github.com/gin-gonic/gin@v1.6.2/gin.go:367 (0x8f77f5)
        (*Engine).ServeHTTP: engine.handleHTTPRequest(c)
C:/Go/src/net/http/server.go:2802 (0x6c005a)
        serverHandler.ServeHTTP: handler.ServeHTTP(rw, req)
C:/Go/src/net/http/server.go:1890 (0x6bb82b)
        (*conn).serve: serverHandler{c.server}.ServeHTTP(w, w.req)
C:/Go/src/runtime/asm_amd64.s:1357 (0x45c330)
        goexit: BYTE    $0x90   // NOP

```

## Environment

- go version: go version go1.13.3 windows/amd64
- gin version (or commit ref): 1.6.2
- operating system: windows 10

Just like json.Unmarshaler, some times we want to customize the form binding behavior, we can implement the encoding.TextUnmarshaler to arrive this.

Example:
We want to distinguish if query param is undefined or empty string, we can define a StringWrapper implemented encoding.TextUnmarshaler and mark the query param defined true in UnmarshalText method.
So, we can determine the request meaning exactly.  

```go
package main

import (
	"fmt"
	"net/http"
	"net/http/httptest"
	"net/url"

	"github.com/gin-gonic/gin"
)

type StringWrapper struct {
	defined bool
	val     string
}

func (t *StringWrapper) UnmarshalText(text []byte) error {
	t.defined = true
	t.val = string(text)
	return nil
}

func (t *StringWrapper) String() string {
	return t.val
}

func (t *StringWrapper) Undefined() bool {
	return !t.defined
}

type Example struct {
	Name StringWrapper `form:"name" json:"name"`
}

func main() {

	engine := gin.New()

	engine.GET("/example/lang/query", func(c *gin.Context) {

		query := Example{}
		if err := c.ShouldBindQuery(&query); err != nil {
			c.JSON(400, err.Error())
			return
		}

		c.JSON(200, map[string]interface{}{
			"undefined": query.Name.Undefined(),
			"name":      query.Name.String(),
		})
	})

	var requst = func(query map[string]string) {
		w := httptest.NewRecorder()
		values := url.Values{}
		for k, v := range query {
			values.Set(k, v)
		}
		req, _ := http.NewRequest("GET", "/example/lang/query?"+values.Encode(), nil)
		engine.ServeHTTP(w, req)
		fmt.Println(w.Body.String())

	}
	fmt.Println("output:\n", )

	requst(map[string]string{})
	requst(map[string]string{"name": ""})
	requst(map[string]string{"name": "lang"})
}

```

output:

{"name":"","undefined":true}
{"name":"","undefined":false}
{"name":"lang","undefined":false}



- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


I want is close response headers  "Transfer-Encoding: chunked " .  because frontend error. I want try close it.
After upgrading the validator, I got an error.

```
        gopkg.in/go-playground/validator.v10: gopkg.in/go-playground/validator.v10@v10.2.0: parsing go.mod:
        module declares its path as: github.com/go-playground/validator/v10
                but was required as: gopkg.in/go-playground/validator.v10
```

And fixed it by rename the path to "github.com/go-playground/validator/v10"

Which is correct?
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description
I have to place a request in a struct which uses fields from both headers and json body. 
Is there a way to bind to a struct with json and header struct tags both ?
Like a ShouldBindWith which takes Json and header binding both ? 

## How to reproduce
Code : 
```
package main

import (
	"github.com/gin-gonic/gin"
)

type Request struct {
	AppCode       string `header:"appCode" binding:"required"`
	SomeId string `json:"someId" binding:"required"`
	UserId      string `header:"userId"`
	EmailId       string `json:"emailId"`
}

func bindTest(ctx *gin.Context) {
	var request Request
	err = ctx.ShouldBindJSON(&request)
	if err != nil {
		err = errors.REQUEST_BIND_FAIL(err, request)
		return
	}

	err = ctx.ShouldBindHeader(&request)
	if err != nil {
		err = errors.REQUEST_BIND_FAIL(err, request)
		return
	}
}
```

## Expectations
1. A common function which does both.
or
2. When binding required with JSON, it checks only the json struct tags and binding required with Headers only check the header struct tags. 

## Actual result
Currently, Im getting a binding:required error from a field which only has a header tag and not json tag when I do ShouldBindJSON. 

Hello

There has been a breaking API change again, which is undocumented

Please read https://github.com/gin-gonic/gin/issues/2214, it's the same issue

Can you update the README?

Thank you
sync to tag v1.6.2

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


fixed #2299 
fix #2301 

## Description

I would like to be able to stop a running gin.Engine, but cannot. I believe the root issue is that https://github.com/gin-gonic/gin/blob/master/gin.go#L301 calls http.ListenAndServe. If instead, it created and returned a server, then that server could be shutdown, thus closing the Engine.

E.g. replace line 301 with:
	server := &Server{Addr: address, Handler: engine}
	return server, server.ListenAndServe()


## How to reproduce

Create an engine and run it.


## Expectations

That an engine should either have a close/shutdown/stop command or should return a server that can be run and shutdown independently.


## Actual result

The Run command never halts and provides no way mechanism to shutdown cleanly without issuing a signal.

## Environment

- go version: 1.13.7
- gin version (or commit ref): v1.5.0
- operating system: MacOs

## Description

I am using [zap logger](https://github.com/uber-go/zap) in gin framework. At the very start, when I was searching for how to use zap to log the output from gin, someone recommended using zap logger in a middleware way.

However, I find another way work for me. Here is what I do

## How to reproduce

``` go
         ... ...

        // log rotate hooker
	hook := lumberjack.Logger{
		Filename: logPath,
		MaxSize:  1024,
		MaxAge:   7,
	}

	// writers for zap logger
	fileWriter := zapcore.AddSync(&hook)
	consoleWriter := zapcore.Lock(os.Stdout)

        // set writer for gin
        gin.DefaultWriter = io.MultiWriter(fileWriter, consoleWriter)

         ... ...
```

## My question

It is simple and a little tricky, but it works. It helps me to log the output from gin.

I wonder if there exists any side effects or performance problems that I overlook.

Is it a right way to do that?

support usage followed:

```golang
type StructExample struct {
    A string `json:"a" form:"a" binding"required,max=16"`
}

func exampleHandler(c *gin.Context) {
    var data []StructExample

    if c.Bind(&data) != nil {
        return
    }
    c.JSON(http.StatusOK, data)
}
```

**this pull is rewritten for https://github.com/gin-gonic/gin/pull/2194， avoid to change the validator interface**



- With issues:


## Description

After upgrade to 1.6.0, I got panic when use `Get` `Set` context.

``` 
panic: runtime error: invalid memory address or nil pointer dereference [recovered]
 	panic: runtime error: invalid memory address or nil pointer dereference
 [signal SIGSEGV: segmentation violation code=0x1 addr=0x10 pc=0x9193c3]
 goroutine 9 [running]:
 testing.tRunner.func1(0xc000137100)
 	/usr/local/go/src/testing/testing.go:830 +0x392
 panic(0xb33d40, 0x120e870)
 	/usr/local/go/src/runtime/panic.go:522 +0x1b5
 sync.(*RWMutex).RLock(...)
 	/usr/local/go/src/sync/rwmutex.go:48
 github.com/gin-gonic/gin.(*Context).Get(0xc0003b8000, 0xbfc6f8, 0x5, 0x2, 0x2, 0x10)
 	/go/pkg/mod/github.com/gin-gonic/gin@v1.6.1/context.go:239 +0x33
```

I compare with the 1.5.0 version, and saw that you used RWMutex inside the Get context function. 
Please check and remove it as 1.5.0 version.

```
// Get returns the value for the given key, ie: (value, true).
// If the value does not exists it returns (nil, false)
func (c *Context) Get(key string) (value interface{}, exists bool) {
	c.KeysMutex.RLock()
	value, exists = c.Keys[key]
	c.KeysMutex.RUnlock()
	return
}
```
 
## How to reproduce

Here my code example
```
type logger struct {
	GinCtx  *gin.Context
}

func (_this *logger) Set(key string, value interface{}) {
	if _this.GinCtx != nil {
		_this.GinCtx.Set(key, value)
	}
}

func (_this *logger) Get(key string) interface{} {
	if _this.GinCtx != nil {
		value, _ := _this.GinCtx.Get(key)
		return value
	}
	return nil
}
```
on handler package, I call this `Get`, `Set` function and got panic :( 


## Environment

- go version: 1.13
- gin version (or commit ref): 1.6.0, 1.6.1
- operating system: linux 

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

<!-- Description of a problem -->

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/hello/:name", func(c *gin.Context) {
		c.String(200, "Hello %s", c.Param("name"))
	})
	g.Run(":9000")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl http://localhost:8201/hello/world
Hello world
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl -i http://localhost:8201/hello/world
<YOUR RESULT>
```

## Environment

- go version:
- gin version (or commit ref):
- operating system:

https://github.com/gin-gonic/gin/pull/1615 is a breaking change

and it is released to v1.6.0

but for go version style, it is should be released to v2.0.0 and change `go.mod` to `github.com/gin-gonic/gin/v2` (and the package name is `gin` )

please revert https://github.com/gin-gonic/gin/pull/1615 and put the `SameSite` param to v2.0.0 

thanks.

Reverts gin-gonic/gin#2216
Reverts gin-gonic/gin#2216
fix the critical bug #2292 
Reverts gin-gonic/gin#2216 and fix #2292 
to sync with tag v1.6.0

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


## Description

Hi! In gin `1.6.0` it appears starting a default gin instance will now bind to:

localhost:8080

Instead of previously it would bind to just :8080 (0.0.0.0)

This causes issues when used inside of Docker as it is binding to Docker's localhost rather than 0.0.0.0

## How to reproduce

```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/hello/:name", func(c *gin.Context) {
		c.String(200, "Hello %s", c.Param("name"))
	})
	g.Run()
}
```

More or less the example above should show gin starting on `localhost:8080` rather than `:8080` like in gin 1.5.0

## Expectations

The expectation is by default, gin should bind the way it previously did

A project that is setup to show this:

https://github.com/DarthHater/hello-world/tree/TestBranch

If you clone that repo, and run `docker-compose up`, you should see the project start on `:8080` as it is using gin 1.5.0, if you switch the go.mod to use gin 1.6.0, you'll see `localhost:8080`, and if you attempt to hit:

`http://locahost:8080/ping`

You'll see empty response, as although Docker has exposed 8080, it's not making it through to the host application since it is bound to Docker's `localhost` rather than the machines `0.0.0.0`

Let me know if there are any questions! I was teaching some friends how to use gin, etc... and ran into this while doing so.
https://github.com/gin-gonic/gin/blob/a412209e60c4b9562bd723e9e01019829e357a39/recovery.go#L48

maybe,you can use this code:
                                               errMsg := strings.ToLower(se.Error())

						// 记录操作日志
						//logger.Emergency(c, "os syscall error", map[string]interface{}{
						//	"trace_error": errMsg,
						// })

						if strings.Contains(errMsg, "broken pipe") ||
							strings.Contains(errMsg, "reset by peer") ||
							strings.Contains(errMsg, "request headers: small read buffer") ||
							strings.Contains(errMsg, "unexpected EOF") ||
							strings.Contains(errMsg, "i/o timeout") {
							brokenPipe = true
						}
fix #2268 
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

Receiving "panic: wildcard route ':id' conflicts with existing children in path '/users/:id'" error

## How to reproduce


```
	user := r.Group("/users")
	{
		user.POST("/", ur.SignUp)
		user.POST("/login", l.Login)
		user.GET("/sendconfirmationemail/:userId", rc.SendConfirmationEmail)
		user.GET("/:id", lc.GetUserByUserId)
		user.GET("/confirmemail", rc.ConfirmEmail)
		user.GET("/resendconfirmationemail", rc.ResendEmailConfirmation)
		user.GET("/forgotusername", rc.ForgotUsername)
		user.GET("/sendpasswordreset", rc.SendPasswordReset)
		user.POST("/confirmpasswordreset", rc.ConfirmPasswordReset)
	}
```

## Expectations

Somewthing working

## Actual result

wildcard error

## Environment

- go version: 1.13.18
- gin version (or commit ref): 1.5.0
- operating system: windows

The initial purpose was to remove the dead code from the example. Still, I hooked up a few improvements as well, such as comments in the code and the text structure separating the usage of third-party libraries from the usage of the built-in packages to handle it manually.

I also changed the term "graceful stop" to graceful shutdown, which seems to be more common in the web, therefore, it would make it easier to find the text.

Related pull request https://github.com/gin-gonic/examples/pull/33
## Description

Recently, I am meeting a normal request spent 31m40s at some times. Usualy, it only spend 400ms.

## How to reproduce

I can't reproduce it.

## Expectations

normal case
`[GIN] 2020/03/19 - 15:50:06 | 200 |  469.636269ms |      172.18.0.1 | GET      /api/confMgr/v1/scenarioConfig/luaScript?enterprise_id=bb3exxxxx0ad11e7bd860242ac1xxxxx&app_id=c3f3e49531xxxxxd8bbb5b247c9a8db6&scenario_id=06e25665-e4fb-xxxx-xxxx-f1622cef3d0e`

## Actual result

abnormal case.
`[GIN] 2020/03/19 - 17:56:05 | 200 |        **31m40s** |      172.18.0.1 | GET      /api/confMgr/v1/scenarioConfig/luaScript?enterprise_id=bb3xxxxxf0ad11e7bd860242ac1xxxxx&app_id=c3f3e49531xxxxxd8bbb5b247c9a8db6&scenario_id=06e25665-e4fb-xxxx-xxxx-f1622cef3d0e`

## Environment

- go version: 1.3
- gin version (or commit ref):
- operating system: macOS: 10.15.3

How do I achieve the following with Gin

router.GET("/: userHandle/*userAction", func(c *gin.Context) {
}

panic: wildcard route ': userHandle' conflicts with existing children in path '/:userHandle'

**Engine.UnescapePathValues** comment  make me confused.
```go
// If true, the path value will be unescaped.
// If UseRawPath is false (by default), the UnescapePathValues effectively is true,
// as url.Path gonna be used, which is already unescaped.
UnescapePathValues bool
```
It should be:
```go
// If true, the path value will be unescaped.
// If UseRawPath is false (by default), the UnescapePathValues effectively is  false,
// as url.Path gonna be used, which is already unescaped.
UnescapePathValues bool
```
 refer to logic of code below:
```go
func (engine *Engine) handleHTTPRequest(c *Context) {
	httpMethod := c.Request.Method
	rPath := c.Request.URL.Path
	unescape := false
	if engine.UseRawPath && len(c.Request.URL.RawPath) > 0 {
		rPath = c.Request.URL.RawPath
		unescape = engine.UnescapePathValues
	}
       // .....
}
```

maybe related #633

## Description
invalid content type

## How to reproduce

```go
package main

import (
	"net/http"

	"github.com/gin-gonic/gin"
)

type obj struct {
	Message string
}

func main() {
	r := gin.New()
	r.POST("/", func(c *gin.Context) {
		body := obj{}
		err := c.BindJSON(&body)
		if err != nil {
			c.JSON(http.StatusBadRequest, obj{"bad message"})
			return
		}
		c.JSON(http.StatusOK, obj{"ok"})
	})
	r.Run() // listen and serve on 0.0.0.0:8080 (for windows "localhost:8080")
}
```
## Expectations
I received expected `Content-Type` header (application/json) with valid json body `{}`
```
curl -vvv -d '{}' -H "Content-Type: application/json" -X POST http://localhost:8080/
Note: Unnecessary use of -X or --request, POST is already inferred.
*   Trying ::1:8080...
* TCP_NODELAY set
* Connected to localhost (::1) port 8080 (#0)
> POST / HTTP/1.1
> Host: localhost:8080
> User-Agent: curl/7.68.0
> Accept: */*
> Content-Type: application/json
> Content-Length: 2
> 
* upload completely sent off: 2 out of 2 bytes
* Mark bundle as not supporting multiuse
< HTTP/1.1 200 OK
< Content-Type: application/json; charset=utf-8
< Date: Thu, 12 Mar 2020 18:50:55 GMT
< Content-Length: 17
< 
{"Message":"ok"}
* Connection #0 to host localhost left intact
```
## Actual result

I received invalid `Content-Type` header with invalid post body `{`
```
$ curl -vvv -d '{' -H "Content-Type: application/json" -X POST http://localhost:8080/
Note: Unnecessary use of -X or --request, POST is already inferred.
*   Trying ::1:8080...
* TCP_NODELAY set
* Connected to localhost (::1) port 8080 (#0)
> POST / HTTP/1.1
> Host: localhost:8080
> User-Agent: curl/7.68.0
> Accept: */*
> Content-Type: application/json
> Content-Length: 1
> 
* upload completely sent off: 1 out of 1 bytes
* Mark bundle as not supporting multiuse
< HTTP/1.1 400 Bad Request
< Date: Thu, 12 Mar 2020 18:46:09 GMT
< Content-Length: 26
< Content-Type: text/plain; charset=utf-8
< 
{"Message":"bad message"}
* Connection #0 to host localhost left intact
```
## Environment

- go version:
```
go env

GO111MODULE=""
GOARCH="amd64"
GOBIN=""
GOCACHE="/home/me/.cache/go-build"
GOENV="/home/me/.config/go/env"
GOEXE=""
GOFLAGS=""
GOHOSTARCH="amd64"
GOHOSTOS="linux"
GOINSECURE=""
GONOPROXY=""
GONOSUMDB=""
GOOS="linux"
GOPATH="/home/me/go"
GOPRIVATE=""
GOPROXY="https://proxy.golang.org,direct"
GOROOT="/usr/lib/go"
GOSUMDB="sum.golang.org"
GOTMPDIR=""
GOTOOLDIR="/usr/lib/go/pkg/tool/linux_amd64"
GCCGO="gccgo"
AR="ar"
CC="gcc"
CXX="g++"
CGO_ENABLED="1"
GOMOD="/tmp/issue/go.mod"
CGO_CFLAGS="-g -O2"
CGO_CPPFLAGS=""
CGO_CXXFLAGS="-g -O2"
CGO_FFLAGS="-g -O2"
CGO_LDFLAGS="-g -O2"
PKG_CONFIG="pkg-config"
GOGCCFLAGS="-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build332976201=/tmp/go-build -gno-record-gcc-switches"
```
- gin version (or commit ref): `1.5.0`
- operating system: linux

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description
I tried to run the main.go  file which is resulting an error. can you please help. It used to work.
go run ./httpd/main.go
go: finding module for package golang.org/x/sync/errgroup
go: finding module for package github.com/gin-gonic/gin
go: finding module for package gopkg.in/natefinch/lumberjack.v2
httpd/handler/app_page.go:7:2: module github.com/gin-gonic/gin@latest found (v1.5.0), but does not contain package github.com/gin-gonic/gin
httpd/main.go:14:2: module golang.org/x/sync@latest found (v0.0.0-20190911185100-cd5d95a43a6e), but does not contain package golang.org/x/sync/errgroup
httpd/main.go:15:2: module gopkg.in/natefinch/lumberjack.v2@latest found (v2.0.0), but does not contain package gopkg.in/natefinch/lumberjack.v2
make: *** [dev] Error 1

## How to reproduce

I have the go mod.file configured the below way and in main.go i am importing the packages.

go.modfile:

module cob

go 1.14

require (
	github.com/gin-contrib/static v0.0.0-20191128031702-f81c604d8ac2
	github.com/gin-gonic/gin v1.5.0
	github.com/go-playground/universal-translator v0.17.0 // indirect
	github.com/json-iterator/go v1.1.8 // indirect
	github.com/leodido/go-urn v1.2.0 // indirect
	github.com/mattn/go-isatty v0.0.11 // indirect
	github.com/modern-go/concurrent v0.0.0-20180306012644-bacd9c7ef1dd // indirect
	github.com/modern-go/reflect2 v1.0.1 // indirect
	golang.org/x/sync v0.0.0-20190911185100-cd5d95a43a6e
	golang.org/x/sys v0.0.0-20191210023423-ac6580df4449 // indirect
	gopkg.in/go-playground/validator.v9 v9.30.2 // indirect
	gopkg.in/natefinch/lumberjack.v1 v1.0.0-20140618183000-8ec9c6b748e0 // indirect
	gopkg.in/natefinch/lumberjack.v2 v2.0.0
	gopkg.in/yaml.v2 v2.2.7 // indirect
)


main.gofile:
import (
	"cob/httpd/handler"
	"cob/platform/cob"
	"encoding/json"
	"io/ioutil"
	"log"
	"net/http"
	"os"
	"time"

	"github.com/gin-gonic/gin"
	"golang.org/x/sync/errgroup"
	"gopkg.in/natefinch/lumberjack.v2"
)
## Expectations

go should download the files and install it 

## Actual result

I tried to run the main.go  file which is resulting an error. can you please help. It used to work.
go run ./httpd/main.go
go: finding module for package golang.org/x/sync/errgroup
go: finding module for package github.com/gin-gonic/gin
go: finding module for package gopkg.in/natefinch/lumberjack.v2
httpd/handler/app_page.go:7:2: module github.com/gin-gonic/gin@latest found (v1.5.0), but does not contain package github.com/gin-gonic/gin
httpd/main.go:14:2: module golang.org/x/sync@latest found (v0.0.0-20190911185100-cd5d95a43a6e), but does not contain package golang.org/x/sync/errgroup
httpd/main.go:15:2: module gopkg.in/natefinch/lumberjack.v2@latest found (v2.0.0), but does not contain package gopkg.in/natefinch/lumberjack.v2
make: *** [dev] Error 1
```

## Environment

- go version: 1.14
- gin version (or commit ref):v1.15.0
- operating system:mac

## Description

RedirectFixedPath is redirecting trailing slashes regardless of the RedirectTrailingSlash setting.

In [gin.go](https://github.com/gin-gonic/gin/blob/master/gin.go#L73) there is a comment that the RedirectTrailingSlash is independent, but then the comment does not indicate that the behavior would be to also redirect trailing slashes in RedirectFixedPath always. If it's the intended behavior then the comment should be clarified.

If it's not the intended behavior then the trouble is in [gin.go](https://github.com/gin-gonic/gin/blob/master/gin.go#L421) where it uses engine.RedirectFixedPath for the trailingSlash parameter, which is always going to evaluate to true in where RedirectFixedPath is in use.

## How to reproduce

```
package main

import (
	"fmt"
	"net/http/httptest"

	"github.com/gin-gonic/gin"
)

func main() {
	r := gin.Default()
	r.RedirectTrailingSlash = false
	r.RedirectFixedPath = true
	r.GET("/ping", func(c *gin.Context) {
		c.String(200, "pong")
	})

	resp := httptest.NewRecorder()
	r.ServeHTTP(resp, httptest.NewRequest("GET", "/ping/", nil))
	fmt.Println(resp.Result().StatusCode, resp.Header().Get("Location"))
}
```

## Expectations

```
$ curl localhost:8080/ping/
404 page not found
```

## Actual result

```
$ curl localhost:8080/ping/
<a href="/ping">Moved Permanently</a>.
```

## Environment

- go version: go version go1.13.8 darwin/amd64
- gin version (or commit ref): v1.5.0
- operating system: macOS High Sierra

I added getter functions for the `Request` and `Writer` field in `Context`.
With these changes, it will be easier to create an interface for `Context` in a project using gin and because of this, easier to mock.

The current handling of Unix sockets is not correct.

1) The service should not delete the socket before binding to it. If the socket exists, that implies another service is already listening on the socket.
2) The socket should instead be cleaned up at shutdown.
3) The permissions should NOT be world writable by default.

One of the main reasons to use sockets is for security. Using sockets allows you to lock access down to a specific unix group/user.However, due to the various use cases for unix sockets, it may be a good idea to accept a `net.Listener` interface, so that the socket can be configured before the server is started.
## Description

<!-- Description of a problem -->

Panic error if client cancel request when server is running a long task and response >8192 length content after it. 
(content length <=8192 works fine.)

```go
select {
	case <-r.C.Request.Context().Done():
		return
	default:
		c.String(200, strings.Repeat("A", 8193))
}
```

Are there any other solutions except above??

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```go
package main

import (
	"github.com/gin-gonic/gin"
	"strings"
	"time"
)

func main() {
	router := gin.Default()
	router.GET("/", func(c *gin.Context) {
		time.Sleep(time.Second * 2)
		c.String(200, strings.Repeat("A", 8193))
	})
	router.Run(":8080")
}
```
1.Open the page directly in the browser then close the tab before server response
2.Send request in Postman then cancel it before server response

## Expectations

<!-- Your expectation result of 'curl' command, like -->
ignore the request if it's cancelled

## Actual result

<!-- Actual result showing the problem -->
GET / HTTP/1.1
Host: 127.0.0.1:8080
Connection: close
Accept: */*
Accept-Encoding: gzip, deflate, br
Cache-Control: no-cache
Connection: close
Postman-Token: c137d141-a132-49ee-8087-397f5ca7d131
User-Agent: PostmanRuntime/7.22.0


write tcp 127.0.0.1:8080->127.0.0.1:54928: wsasend: An established connection was aborted by the software in your host machine.
/src/github.com/gin-gonic/gin/context.go:817 (0x8ed689)
        (*Context).Render: panic(err)
/src/github.com/gin-gonic/gin/context.go:892 (0x8ff331)
        (*Context).String: c.Render(code, render.String{Format: format, Data: values})
/tmp/main.go:13 (0x8ff2b5)
        main.func1: c.String(200, strings.Repeat("A", 8193))
/src/github.com/gin-gonic/gin/context.go:147 (0x8e95d1)
        (*Context).Next: c.handlers[c.index](c)
/src/github.com/gin-gonic/gin/recovery.go:83 (0x8fd86a)
        RecoveryWithWriter.func1: c.Next()
/src/github.com/gin-gonic/gin/context.go:147 (0x8e95d1)
        (*Context).Next: c.handlers[c.index](c)
/src/github.com/gin-gonic/gin/logger.go:241 (0x8fc977)
        LoggerWithConfig.func1: c.Next()
/src/github.com/gin-gonic/gin/context.go:147 (0x8e95d1)
        (*Context).Next: c.handlers[c.index](c)
/src/github.com/gin-gonic/gin/gin.go:411 (0x8f3b23)
        (*Engine).handleHTTPRequest: c.Next()
/src/github.com/gin-gonic/gin/gin.go:369 (0x8f3214)
        (*Engine).ServeHTTP: engine.handleHTTPRequest(c)
/src/net/http/server.go:2802 (0x6bab8a)
        serverHandler.ServeHTTP: handler.ServeHTTP(rw, req)
/src/net/http/server.go:1890 (0x6b635b)
        (*conn).serve: serverHandler{c.server}.ServeHTTP(w, w.req)
/src/runtime/asm_amd64.s:1357 (0x45add0)
        goexit: BYTE    $0x90   // NOP

[GIN-debug] [WARNING] Headers were already written. Wanted to override status code 200 with 500
## Environment

- go version: 1.13.1
- gin version (or commit ref): 1.5.0
- operating system: windows/amd64

I have a problem in getting HandlerFunc with reflect. 
### Below is my code :
```
type ServiceHandler struct {
    Name string
}
var handler *ServiceHandler

func init() {
   handler = ServiceHandler{Name: "test"}
}

func (handler *ServiceHandler) Handler1(c *gin.Context) {
    ...
}

func (handler *ServiceHandler) Handler2(c *gin.Context) {
    ...
}
```

So far so good. Now, I am using reflection to list all of my methods and pass them to gin router.  

```
func listHanlderMethods() {
	handlerType := reflect.TypeOf(handler)
	for i := 0; i < fooType.NumMethod(); i++ {
		method := handlerType.Method(i)
		fmt.Println(method.Name)
	}
}
```

which gives **Handler1 and Handler2**.

> My question is here: *How can I get HandlerFunc s via reflect?*
Copy https://github.com/gin-gonic/gin/pull/2265 and fix the tests

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

<!-- Description of a problem -->

## How to reproduce
package main
import (
	"github.com/gin-gonic/gin"
)

func Response(c *gin.Context){
       c.String(200, "Hello %s", c.Param("name"))
}
func main() {
	g := gin.Default()
	g.GET("/hello/:name", func(c *gin.Context) {
		go Response(c)
	})
	g.Run(":9000")
}
```

## Expectations

$ curl http://localhost:8201/hello/world
Hello world

## Actual result

<!-- Actual result showing the problem -->
```
$ curl -i http://localhost:8201/hello/world
<YOUR RESULT>
server core
panic : wrote more than declared Content-Length

## Environment

- go version: 1.22.5
- gin version (or commit ref): 094b3fdb393ff8eab16ec293bf49513213955523
- operating system:

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

<!-- Description of a problem -->
c.HTML() load the html file(the file is generated by a tool) for client,  But the server is panic when a http request from the client.

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```

```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
don't panic, and working good
```

## Actual result

<!-- Actual result showing the problem -->
```
2020/03/01 06:33:02 [Recovery] 2020/03/01 - 06:33:02 panic recovered:
GET /formulas/IsJifenfanchang?go_session_id=b6c6683c-c04f-49de-9931-156886fbc3ba HTTP/1.1
Host: www.antobot.com
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Connection: keep-alive
Cookie: go_session_id=NjBlZDliN2UtZjBhYy00MDdkLTg2ZDUtMDkwNmJkZGQ3ZWJl.6b0294875cd07ed3fbfeaa6c81cd4f13dfc7c205
Sec-Ch-Ua: nwjs 74
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: cross-site
Sec-Fetch-User: ?F
Sec-Origin-Policy: 0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1 wechatdevtools/1.02.1911180 MicroMessenger/7.0.4 Language/zh_CN webview/16928_365 webdebugger miniprogramhtmlwebview miniProgram port/20779


html/template:IsJifenfanchang.html: "<" in attribute name: "_0<b</script></p><p><span>上式右边两个"
/home/sunmingang/go/pkg/mod/github.com/gin-gonic/gin@v1.5.0/context.go:817 (0x8e0542)
	(*Context).Render: panic(err)
/home/sunmingang/go/pkg/mod/github.com/gin-gonic/gin@v1.5.0/context.go:826 (0x8e05e5)
	(*Context).HTML: c.Render(code, instance)
/home/sunmingang/go/src/antobot_server/controllers/formulas.go:10 (0x93e2da)
	StaticFormulas: c.HTML(http.StatusOK, name + ".html", gin.H{"title" : name})
/home/sunmingang/go/pkg/mod/github.com/gin-gonic/gin@v1.5.0/context.go:147 (0x8dc629)
	(*Context).Next: c.handlers[c.index](c)
/home/sunmingang/go/pkg/mod/github.com/gin-gonic/gin@v1.5.0/recovery.go:83 (0x8f0159)
	RecoveryWithWriter.func1: c.Next()
/home/sunmingang/go/pkg/mod/github.com/gin-gonic/gin@v1.5.0/context.go:147 (0x8dc629)
	(*Context).Next: c.handlers[c.index](c)
/home/sunmingang/go/pkg/mod/github.com/gin-gonic/gin@v1.5.0/logger.go:241 (0x8ef280)
	LoggerWithConfig.func1: c.Next()
/home/sunmingang/go/pkg/mod/github.com/gin-gonic/gin@v1.5.0/context.go:147 (0x8dc629)
	(*Context).Next: c.handlers[c.index](c)
/home/sunmingang/go/pkg/mod/github.com/gin-gonic/gin@v1.5.0/gin.go:403 (0x8e65e9)
	(*Engine).handleHTTPRequest: c.Next()
/home/sunmingang/go/pkg/mod/github.com/gin-gonic/gin@v1.5.0/gin.go:364 (0x8e5cdd)
	(*Engine).ServeHTTP: engine.handleHTTPRequest(c)
/usr/local/go/src/net/http/server.go:2774 (0x6b70a7)
	serverHandler.ServeHTTP: handler.ServeHTTP(rw, req)
/usr/local/go/src/net/http/server.go:1878 (0x6b2c90)
	(*conn).serve: serverHandler{c.server}.ServeHTTP(w, w.req)
/usr/local/go/src/runtime/asm_amd64.s:1337 (0x459a40)
	goexit: BYTE	$0x90	// NOP
``

## Environment

- go version: 1.13
- gin version (or commit ref):1.5.0
- operating system:ubuntu 16.04

@thinkerou Maybe we should move some items out of v1.6?

https://github.com/gin-gonic/gin/milestone/11
# Description
Our goal is to have good integration tests on our api, so we use gin's rouuter capabilities along with httptest.NewRecorder() to setup a dummy in process endpoint we can simulate http calls to.  This ensures we test the actual path bindings, middleware, etc.

Our issue is in go's built in go coverage reports from say:
go test -coverprofile=coverage.txt  ./...
It does not register hits against the apis.  Full script we using to get coverage and upload to codecov.io is similar to this:
https://github.com/codecov/example-go
We loop per go package and aggregate a coverage.txt.

Has anyone experienced this?
How do we fix?
Is the indirect nature of invoking the code via simulated http requests expected to cause this gap?

## How to reproduce:
        http := gin.New()
	api := http.Group("/api")
	api.GET("/", apis.WelcomeHandler)
etc...

func PerformRequest(r http.Handler, method, path string, headers map[string]string, jsonPost string) *httptest.ResponseRecorder {
	var payload io.Reader
	if len(jsonPost) > 0 {
		payload = bytes.NewBufferString(jsonPost)
	}
	req, err := http.NewRequest(method, path, payload)

	if err != nil {
		fmt.Printf("Problem sending http request, %e", err)
		return nil
	}
	if headers != nil && len(headers) > 0 {
		for k, v := range headers {
			req.Header.Add(k, v)
		}
	}
	if len(jsonPost) > 0 {
		req.Header.Set("Content-Type", "application/json") // This makes it work
	}
	w := httptest.NewRecorder()
	r.ServeHTTP(w, req)
	return w
}

## Environment
MacOS X
go version go1.13.4 darwin/amd64


HI All,
I have the response i need to send back when an endpoint is called in the yaml file. I basically want to use the writer function to send back this response when my endpoint is called (pass response to body basically). FYI: Serwver is a struct which calls another struct declared in there which holds the value and looks as follows:
FYI: i am fairly new to GO

type Serwver struct {
Changelog changelog.demo
}
type demo struct {
Changelog map[string]interface{}
}

 Any ideas how to implement this? Code snippet below
func ChangeLog(s *Serwver) gin.HandlerFunc {
   return func(c *gin.Context) {
c.Writer (s.) (//want to pass the response from yaml file by calling struct here using context)
      c.Writer.WriteHeader(http.StatusOK)
  }
}
because https://github.com/gin-gonic/gin/pull/2237#issuecomment-590925246 and recommit the pr

I cannot use "/" prefix to access static resources and "/ api" prefix as an interface. How can I solve this problem?

func InitRouter() *gin.Engine {
	Router := gin.Default()
	Router.Use(middleware.Logger())
	APIRouters := Router.Group("")
	routers.DetaultRouter(APIRouters)
	routers.TokenRouter(APIRouters)
	routers.StaticRouter(APIRouters)
	return Router
}
// DetaultRouter 不需要验证登录
func DetaultRouter(Router *gin.RouterGroup) {
	v1 := Router.Group("/api")
	{
		v1.GET("/home", api.GetHome)
	}
}

// TokenRouter 需要验证登录
func TokenRouter(Router *gin.RouterGroup) {
	v2 := Router.Group("/api")
	v2.Use(middleware.Token())
	{
		v2.GET("/", api.GetHome)
	}
}

// StaticRouter 静态文件路由
func StaticRouter(Router *gin.RouterGroup) {
	v3 := Router.Group("/")
	v3.Static("/", "./static")
}

as title.

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.



- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

I'm currently trying to validate the request body with `ShouldBindJSON` and I'm sending a random JSON body (ex. `{"a":"a"}` -which is the one I'm using btw-) and it returns no error

## How to reproduce

My struct:
```golang
type UserSignUp struct {
	Username string `json:"username"`
	Password string `json:"password"`
	Email    string `json:"email"`
}
```

The code that implements the validation

```golang
var dto register.UserSignUp

	if err := c.ShouldBindJSON(&dto); err != nil {
		// do something
	}
```

## Expectations

An error

## Actual result

No error

## Environment

- go version:go version go1.13.6 windows/amd64
- gin version (or commit ref):github.com/gin-gonic/gin v1.5.0
- operating system:Windows 10

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description
I need to return data some like : 
```
<xml>
         <Content>...</Content>
          ...
</xml>
```

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)

type Message struct{
    Content string
}

func main() {
	g := gin.Default()
	g.GET("/hello", func(c *gin.Context) {
               var message = Message{Content:"123"}
		c.XML(200, &message)
	})
	g.Run(":9000")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl http://localhost:9000/hello
<xml><Content>123</Content></xml>
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl -i http://localhost:9000/hello
<Message><Content>123</Content></Message>
```

## Environment

- go version: ``go version go1.13.4 linux/amd64``
- gin version (or commit ref): ``github.com/gin-gonic/gin v1.5.0``
- operating system:  ``ubuntu 16``


Thank any help!!
- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


fix https://github.com/gin-gonic/gin/issues/2236

Signed-off-by: Bo-Yi Wu <appleboy.tw@gmail.com>

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

<!-- Description of a problem -->
Is this is a feature or I used it wrong, Mutliple slashes in the url,like a////b will match a/b,a little weired
## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
	"log"
)

func main() {
	r := gin.Default()
	r.GET("/a", func(c *gin.Context) {
		log.Printf("in handler1, url = %s", c.Request.RequestURI)
		c.JSON(200, c.Request.RequestURI)
	})
	r.GET("/a/b", func(c *gin.Context) {
		log.Printf("in handler1, url = %s", c.Request.RequestURI)
		c.JSON(200, c.Request.RequestURI)
	})
	r.Run(":9999")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl -i http://localhost:9999//////a
http 404
$ curl -i http://localhost:9999//////a//////b
http 404
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl -i http://localhost:9999//////a
http 200, route /a was matched
$ curl -i http://localhost:9999//////a//////b
http 200, route /a/b was matched
```

## Environment

- go version: go version go1.12.14 windows/amd64
- gin version (or commit ref): v1.5.0
- operating system: windows

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

in the  function handler2, Send multiple requests in a row, except the first request,others the value of variable s is empty 

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
	"log"
)

func main() {
	r := gin.Default()
	r.POST("/some", handler1("s"), handler2("s"))
	r.Run(":9999")
}

func handler1(s string) gin.HandlerFunc {
	return func(c *gin.Context) {
		result := c.PostForm("s")
		log.Printf("handler1,the input field s = %s", result)
		c.Set(s, result)
	}
}

func handler2(s string) gin.HandlerFunc {
	return func(c *gin.Context) {
		s = c.GetString(s)   // I know if write like this other:=c.GetString(s),there will be no problem
		log.Printf("handler2, s = %s", s)   // here,first time s is not empty,then always empty
		c.JSON(200, "")
	}
}

```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl -d "s=123123" 192.168.198.1:9999/some
the variable s in handler s should not be empty
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl -d "s=123123" 192.168.198.1:9999/some
the variable s in handler s is empty if not first request,logs:
[GIN-debug] Listening and serving HTTP on :9999
2020/02/21 11:35:38 handler1,the input field s = 123457a2
2020/02/21 11:35:38 handler2, s = 123457a2
[GIN] 2020/02/21 - 11:35:38 | 200 |     19.9462ms |       127.0.0.1 | POST     /some
2020/02/21 11:35:39 handler1,the input field s = 123457a2
2020/02/21 11:35:39 handler2, s = 
[GIN] 2020/02/21 - 11:35:39 | 200 |            0s |       127.0.0.1 | POST     /some
2020/02/21 11:35:39 handler1,the input field s = 123457a2
2020/02/21 11:35:39 handler2, s = 
[GIN] 2020/02/21 - 11:35:39 | 200 |            0s |       127.0.0.1 | POST     /some
2020/02/21 11:35:40 handler1,the input field s = 123457a2
2020/02/21 11:35:40 handler2, s = 
[GIN] 2020/02/21 - 11:35:40 | 200 |       997.9µs |       127.0.0.1 | POST     /some
[GIN] 2020/02/21 - 11:40:34 | 200 |            0s | 192.168.198.145 | POST     /some
2020/02/21 11:40:34 handler1,the input field s = 123123
2020/02/21 11:40:34 handler2, s =
```

## Environment

- go version: go version go1.12.14 windows/amd64
- gin version (or commit ref): v1.5.0
- operating system: windows

Hello, I add a mitigation for log injection. It prevents that malicious user to do a log injection.

## Before

```
$ curl --request "POST" "http://127.0.0.1:3000/%0a[GIN]%20..%20blahblah"

-->

[GIN] 2020/02/19 - 15:35:08 | 401 |     712.772µs |       127.0.0.1 | POST     /
[GIN] .. blahblah
```

## After
```
$ curl --request "POST" "http://127.0.0.1:3000/%0a[GIN]%20..%20blahblah"

-->

[GIN] 2020/02/19 - 15:36:56 | 401 |     814.381µs |       127.0.0.1 | POST     "/\n[GIN] .. blahblah"
```

Thanks.

## References

https://www.geeksforgeeks.org/log-injection/
https://golang.org/pkg/fmt/
Hi there! I wanted to propose adding the following badge to the README to indicate how many `TODO` comments are in this codebase:

[![TODOs](https://badgen.net/https/api.tickgit.com/badgen/github.com/gin-gonic/gin)](https://www.tickgit.com/browse?repo=github.com/gin-gonic/gin)

The badge links to `tickgit.com` which is a free service that indexes and displays TODO comments in public github repos. It can help surface latent work and be a way for contributors to find areas of code to improve, that might not be otherwise documented.

The markdown is:

```
[![TODOs](https://badgen.net/https/api.tickgit.com/badgen/github.com/gin-gonic/gin)](https://www.tickgit.com/browse?repo=github.com/gin-gonic/gin)
```

Thanks for considering, feel free to close this issue if it's not appropriate or you prefer not to!
- With issues:
  - Binding Url with ';'(semicolon) value

## Description

<!-- Description of a problem -->
Hi. I have some problem with binding Query.
I'm porting a Java program to golang.
One of the request protocol fields, 'area' is an array, 
This field contains coordinate information,
and field may be requested separately, or may be requested with ';' (semicolon)" as the delimiter.

ex) http://localhost:8080/testing?area=127.04275975,37.49794;127.0363829,37.485006368
ex) http://localhost:8080/testing?area=127.04275975,37.49794&area=127.0363829,37.485006368&area=127.1001092,37.513256

**hear is my problem**.
if a single value containing ';' comes in, and after binding, 
only the data is recognized until the ';'

**The requested value is truncated before the semicolon**

I can't modify the delimiter or protocol.
how can i recognize, and binding the full context with including ";" (semicolon) ? 


## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```


type ReqInfo struct {
	area       []string `form:"area"`        //TODO. ex)area=127.04275975,37.49794;127.0363829,37.485006368;127.1001092,37.513256
}

func Foo(c *gin.Context) {

	reqInfo := new(ReqInfo)	

	c.Bind(reqInfo)

        for idx, val := range reqInfo.area {
		fmt.Println("area : ", idx, val) 
	}
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl http://localhost:8080/testing?area=127.04275975,37.49794;127.0363829,37.485006368
area : 0 127.04275975,37.49794;127.0363829,37.485006368
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl http://localhost:8080/testing?area=127.04275975,37.49794;127.0363829,37.485006368
<YOUR RESULT>
area : 0 127.04275975,37.49794
```

## Environment

- go version: 1.13.4
- gin version (or commit ref):  1.5.0 (maybe)
- operating system: windows

related #1838 
Is there a proper way to get array-params like this?
`/?id[1]=10&id[2]=11&id[3]=13`

I saw this PR, but it doen't fit here: https://github.com/gin-gonic/gin/pull/570
because items of array here isn't named:
`/?id[]=10&id[]=11&id=[]`

Generally I can't know length of this array, so I even can't get it separately without some mess in code.

Actually, if this problem isn't solved, I can work on it and make PR with solution.
## Description

`X-Forwarded-For` header should be processed last-to-first to prevent IP spoofing, as explained in this [post](https://blog.gingerlime.com/2012/rails-ip-spoofing-vulnerabilities-and-protection/). It would be needed to set up IP addresses of known proxies to be ignored.

## Current implementation

In [context.go](https://github.com/gin-gonic/gin/blob/731c827892f5b1eac9f58fc65cef32fa1908972c/context.go#L688):

```go
func (c *Context) ClientIP() string {
	if c.engine.ForwardedByClientIP {
		clientIP := c.requestHeader("X-Forwarded-For")
		clientIP = strings.TrimSpace(strings.Split(clientIP, ",")[0])
		if clientIP == "" {
			clientIP = strings.TrimSpace(c.requestHeader("X-Real-Ip"))
		}
		if clientIP != "" {
			return clientIP
		}
	}
	...
```



## Description

I try the these way to get the query string, but not work, println empty string

url: https://test.com/cgi/getinfo?openid=2201306406664704
```
openid := c.Query("openid")
c.Request.URL.Query()
```

## Environment

- go version: 1.13.1
- gin version (or commit ref): 1.5.0
- operating system: mac os


Fixes the issue #2209 

## Description

I have a personal API that's based on gin, because I want everything to be in a single binary.
I've used go-bindata to embed static assets into my binary. Sometimes (not always though, I'm able to reproduce it rarely) I get this:

```
❯ tail -f /var/log/servus.log 
[GIN] 2020/02/06 - 08:53:44 | 200 |     119.879µs |       127.0.0.1 | GET      /startpage 
[GIN] 2020/02/06 - 08:53:44 | 404 |      13.777µs |       127.0.0.1 | GET      /assets/styles.css 
[GIN] 2020/02/06 - 08:53:44 | 404 |    1.128397ms |       127.0.0.1 | GET      /assets/date.js 
[GIN] 2020/02/06 - 08:53:44 | 404 |         907ns |       127.0.0.1 | GET      /favicon.ico 
[GIN] 2020/02/06 - 08:54:34 | 200 |      57.376µs |       127.0.0.1 | GET      /startpage 
[GIN] 2020/02/06 - 08:54:34 | 404 |      28.349µs |       127.0.0.1 | GET      /assets/styles.css 
[GIN] 2020/02/06 - 08:54:34 | 404 |      29.775µs |       127.0.0.1 | GET      /assets/date.js 
[GIN] 2020/02/06 - 08:54:34 | 404 |       1.078µs |       127.0.0.1 | GET      /favicon.ico 
^C 
 
~ 15s 
❯ sudo systemctl restart servus 
 
~ 
❯ tail -f /var/log/servus.log 
[GIN] 2020/02/06 - 08:54:49 | 200 |     182.806µs |       127.0.0.1 | GET      /startpage 
[GIN] 2020/02/06 - 08:54:49 | 200 |    2.084316ms |       127.0.0.1 | GET      /assets/date.js 
[GIN] 2020/02/06 - 08:54:49 | 200 |    2.144894ms |       127.0.0.1 | GET      /assets/styles.css 
[GIN] 2020/02/06 - 08:54:49 | 404 |       1.285µs |       127.0.0.1 | GET      /favicon.ico 
```

## How to reproduce

Not the smallest possible code, but the codebase is small enough, plus a Makefile is included: https://github.com/DictumMortuum/servus

## Expectations

Static assets should not return 404 when gin starts.

## Actual result

They do. Not reproducible all the time.

## Environment

- go version: go1.13.4 linux/amd64
- gin version (or commit ref): github.com/gin-gonic/gin v1.5.0
- operating system: Archlinux and ubuntu 18.04.4

## Description
When using gin.BasicAuth to secure a website with only one admin user, the implementation is susceptible to a Timing Oracle Attack.  Such an attack would brute force the password using a dictionary attack, noting that when more characters of the password are properly matched, the call will take longer.  With this scheme each character of the password can be determined given enough time.

Additionally since the application contains the password in plain text, if a intruder is able to make it onto the server, he can use the linux strings command on the binary to yield the stored passwords.  This would mean any intrusion into your server would be a reportable event to regulatory agencies.

## How to reproduce
Please see here for details on the attack: https://en.wikipedia.org/wiki/Timing_attack

## Expectations
1. The code shouldn't require the developer to enter a plain text password to begin with.  Would be better if the the user entered hashed + salted password to begin with.  See linkedin hack for rationale: https://en.wikipedia.org/wiki/2012_LinkedIn_hack
2. For Password comparison, it's best practice to hash or bcrypt the strings prior to comparison to randomize the response time.  Alternatively one could force a rune by rune comparison that always takes constant time (https://golang.org/src/crypto/subtle/constant_time.go). 
## Description

I have created a couple of functions that live as Google Cloud Functions. The functions serve as Slack slash commands, with the `ParserGCP` function returning a dialog box that users can make selections on, and the `DialogGCP` function making a database call and returning the appropriate information. I have constructed the following code to handle the requests:

```
// ParserGCP handles initial requests
func ParserGCP(rw http.ResponseWriter, rr *http.Request) {
	r.Use(helpers.AddRequestToContext(rr))
	r.Handle("POST", "/parser", func(c *gin.Context) { handlers.ParseSlash(c) })
	r.ServeHTTP(rw, rr)

}

// DialogGCP handles user submitted dialog box requests
func DialogGCP(rw http.ResponseWriter, rr *http.Request) {
	r.Use(helpers.AddRequestToContext(rr))
	r.Handle("POST", "/dialog", func(c *gin.Context) { handlers.ParseDialog(c) })
	r.ServeHTTP(rw, rr)
}
```

The above works 50% of the time. The other half of the time, the function fails with the error in the subject line: "Function panic: handlers are already registered for path"

I am confused by as nowhere else in the code do I identify any other handlers - what you see above are the only handler declarations and there is certainly no duplication of handlers at all. I would suspect that each call of the functions would spawn a new environment anyway (and it's important to note that it's always the first instantiation of the function that creates the error), so I am kind of lost on what would be causing this. Unfortunately, Google and previous issues didn't provide the direction I was hoping for.

## Expectations

100% successful completion of the functions.

## Actual result

See log results below. Please note the existence of failing and successful requests:
![image](https://user-images.githubusercontent.com/29058450/73868742-42721d80-4806-11ea-9f80-787282a85a7d.png)


## Environment

- go version: v1.13.4
- gin version (or commit ref): v1.5.0
- operating system: function running on GCP, GO version 1.13

There were few commits made to master branch but were never tagged which is causing issues while using this library using go modules.
Unsure if this is a gin issue or an issue with your validator, but:

```
_field validation for "_client_id" failed on the "required" tag
```

Converting to underscores seems to just bulk replace capital letters to underscores

The function RunTLS seems to be broken.  

```
package main

import (
    "fmt"
    "github.com/gin-gonic/gin"
    "net/http"
)

var sslkey string = ""
var sslcert string = ""

func main() {
    router := gin.Default()
    router.GET("/", func(c *gin.Context) {
        c.String(http.StatusOK, "hello world")
    })
    err := router.RunTLS("127.0.0.1:5443", sslcert, sslkey)
    if err != nil {
        fmt.Println("Server could not be started")
    }
}
```

After building, the application starts and listen

[GIN-debug] [WARNING] Running in DEBUG mode! Disable it before going production
[GIN-debug] GET   /                         --> main.func·001 (3 handlers)
[GIN-debug] Listening and serving HTTPS on 127.0.0.1:5443

I tried it also with a real certificate and a key but unfortunately it won't read them. Got the same message see below

```
curl https://127.0.0.1:5443
curl: (35) Unknown SSL protocol error in connection to 127.0.0.1:-9847
```

see out put of `go test -v` here:
https://gist.github.com/kmulvey/16dc3cc49ef58c5517c6

running in travis seems fine

Today I was doing command: go get github.com/gin-gonic/gin
# github.com/gin-gonic/gin

 github.com/gin-gonic/gin/gin.go:34:undefined: sync.Pool

Not sure where the integration tests should go, ideally they would be run separately from unit tests.

=== RUN TestLogger
--- PASS: TestLogger (0.00s)
=== RUN TestColorForMethod
--- PASS: TestColorForMethod (0.00s)
=== RUN TestColorForStatus
--- PASS: TestColorForStatus (0.00s)

Hello guys,

I've put a comment in some commit you did that basically removed the TLS version of Run. 

Here it is : 
https://github.com/gin-gonic/gin/commit/b690611c381a2c9765ac7cdbd6588da7714c4790#commitcomment-11397410

Cheers,
Clem DAL PALU.

My app receives requests which are JSON arrays of objects. I'm representing these data using slices and `map[string]interface{}`, since the objects can have unknown fields.

I've noticed that latest changes to Gin cause are assuming the binding is using structs only and performing validation on them. This is causing gin to crash if trying to bind on something other than struct, like a slice of maps.

``` go
type Object map[string]interface{}
type MyObjects []Object

func MyHandler(context *gin.Context) {
    var objects MyObjects
    context.Bind(&objects)  // Request is `[{"key1":"value1"},{"key2":"value2"},..]`
    ...
}
```

``` go
2015/05/27 17:16:51 Panic recovery -> interface passed for validation is not a struct
/home/ory/.gvm/gos/go1.4.1/src/runtime/panic.go:387 (0x4168a8)
        gopanic: reflectcall(unsafe.Pointer(d.fn), deferArgs(d), uint32(d.siz), uint32(d.siz))
/home/ory/.gvm/pkgsets/go1.4.1/global/src/gopkg.in/bluesuncorp/validator.v5/validator.go:177 (0x6d3c49)
        (*Validate).structRecursive: panic("interface passed for validation is not a struct")
/home/ory/.gvm/pkgsets/go1.4.1/global/src/gopkg.in/bluesuncorp/validator.v5/validator.go:173 (0x6d3b89)
        (*Validate).structRecursive: return v.structRecursive(top, current, structValue.Elem().Interface())
/home/ory/.gvm/pkgsets/go1.4.1/global/src/gopkg.in/bluesuncorp/validator.v5/validator.go:162 (0x6d3960)
        (*Validate).Struct: return v.structRecursive(s, s, s)
/home/ory/.gvm/pkgsets/go1.4.1/global/src/github.com/gin-gonic/gin/binding/binding.go:59 (0x5e4680)
        Validate: if err := validate.Struct(obj); err != nil {
/home/ory/.gvm/pkgsets/go1.4.1/global/src/github.com/gin-gonic/gin/binding/json.go:24 (0x5e5aae)
        jsonBinding.Bind: return Validate(obj)
<autogenerated>:6 (0x5e5ff7)
/home/ory/.gvm/pkgsets/go1.4.1/global/src/github.com/gin-gonic/gin/context.go:262 (0x4f05b2)
        (*Context).BindWith: if err := b.Bind(c.Request, obj); err != nil {
/home/ory/.gvm/pkgsets/go1.4.1/global/src/github.com/gin-gonic/gin/context.go:254 (0x4f046e)
        (*Context).Bind: return c.BindWith(obj, b)
...
```

The question arises: Why is gin forcing me to validate my objects? More so, validate using https://github.com/bluesuncorp/validator . What if I want to validate using another preferred validator package, like https://github.com/asaskevich/govalidator ? What if I don't want to validate at all?

I feel like this type of control should be given to the developer, and not forced upon him. Maybe validation is better off as an optional (or default) middleware instead?


Hi! I'm trying to determine between Gin or Martini. I'm really impressed by Gin's speed and performance, and how easy the APIs are! However, in Martini, people can "clone" the mgo (mongodb driver for Go) session and pass it into the routing service, so I can assume only a minimal number of connection is being established. However it seems that with Gin I can't do this:

``` go
    reqSession := session.Clone()
    c.Map( reqSession.DB( "goattrs" ) )
```

Can someone tell me how or if there is a better way to achieve this (connection pooling) in Gin?


Restored support of multipart/form-data

```
* restored support of multipart/form-data
* paths to the inner packages were changed, because using of absolute paths, like "github.com/gin-gonic/gin/binding", creates some difficulties for contributors,
  for example, when I make changes in the "binding" package in tests still used paсkage "binging" from github.com/gin-gonic/gin
* skipped failing tests
* wrote tests for multipart/form-data binding functionality
```


I have some URLs in the form `.../u:<param>/...`. I've been trying to figure out if there's a way to capture only the param part (considering the URL matching uses `:` for capturing parameters), but I haven't found a solution. As a temporary solution I'm capturing everything including the `:` but this requires an extra validation on the handler.


When using RouterGroup.Static, .../index.html redirect to .../ and .../ returns a 404 error. Even if said file exist.

This is caused by the use of a naive check of the path to see if it is an directory listing: https://github.com/gin-gonic/gin/blob/master/routergroup.go#L141

But net.http redirect .../index.html to .../ and serves .../index.html for .../ when possible: http://golang.org/src/net/http/fs.go?s=13208:13248#L344

Work around:

Use RouterGroup.StaticFS( ... , http.Dir( ... ) , true) to allow directory listing and index.html

Suggested fixes:

Replace 404 with a 403 error and directory listing denied message. This will help new developers (me) know that directory listing is turned off, and not some misspelled path.

Document that Static has listDirectory turned off. (or expose that option in Static)

Check for the existence of .../index.html instead of blocking all .../ requests

```
rtr.Static("/static", "./static")
rtr.GET("/:slug", handlePost)
```

```
panic: wildcard route ':slug' conflicts with existing children in path '/:slug'
```

Any way to solve that? I could prefix `/:slug` with `/post/:slug` but I don't want to do that. I'd like `/static/` to serve static files and `handlePost` to handle everything else.

Hope this help someone want to use Gin with [pongo2](https://github.com/flosch/pongo2) like me!

32 int overflows: https://github.com/gin-gonic/gin/issues/298

Hi!
I can't install package on my ubuntu, x86.

```
src/github.com/gin-gonic/gin/context.go:271: constant 2147483648 overflows int
src/github.com/gin-gonic/gin/logger.go:25: constant 4294967295 overflows int
```

Type `gin.H`  is an alias of `map[stirng]interface{}`, what is `H` named for?  And why is framework named as `gin`?  Very curious.

How about integrating zero downtime restarts in gin server? Maybe using endless?

https://github.com/fvbock/endless

hi,

i have a custom middleware that validates request. if request is not valid then it throw a panic. but when it throw a panic the Recovery() middleware is not catcing error ?

there is my part of code

``` go
type NewPostRequest struct {
    Title       string   `validate:"nonzero"`
    Description string   `validate:"nonzero"`
    Body        string   `validate:"nonzero"`
    Tags        []string `validate:"min=2"`
}

func (this *NewPostRequest) Validate() error {
    return validator.Validate(this)
}

func (this *NewPostRequest) Fill(req *http.Request) error {
    return json.NewDecoder(req.Body).Decode(this)
}

func ValidateAndFillRequestMiddleware(req RequestInterface) gin.HandlerFunc {
    return func(c *gin.Context) {
        req.Fill(c.Request)

        if err := req.Validate(); err != nil {
            panic(err.Error())
        }

        c.Set("request", req)
    }
}

func main() {
    initDB()

    router := gin.Default()

    post_resource := post.PostResource{Service: post.PostService{DB: ORM}}

    // Routes
    router.POST("posts", ValidateAndFillRequestMiddleware(new(post.NewPostRequest)), post_resource.Create)

    router.Run(":8000")
}
```

there is a problem during go get

```
➜  go  go get github.com/gin-gonic/gin
# github.com/gin-gonic/gin
src/github.com/gin-gonic/gin/gin.go:36: undefined: sync.Pool
```

I'd like to use something like authboss that has its own http.Handler:
https://godoc.org/gopkg.in/authboss.v0#Authboss.NewRouter

With Gorilla Mux you can attach the handler to a routegroup like so:

```
mux.PathPrefix("/auth").Handler(ab.NewRouter())
```

I see httprouter has this functionality as well:
http://godoc.org/github.com/julienschmidt/httprouter#Router.Handler

Can you do something similar with Gin? If I just wrapped it in a context would it handle the routing correctly still? Thanks!

The current `ctx.Render()` is slow, buggy and ugly. It uses variadic arguments in order to be flexible enough. That makes it slow, the compiler can not inline methods with variadic arguments and it requires an additional heap allocation.

Also, the compiler can not verify at compiler time if the types are ok, since everything is a `interface{}`.

The new rendering API introduces:

``` go
func (c *Context) Header(key, value string)
```

``` go
func (c *Context) Render(r render.Render)
```

``` go
func (c *Context) Return(code int, r render.Render)
```

https://github.com/gin-gonic/gin/blob/develop/context.go#L319-L339

API changes:
Old API:

``` go
func handler1(c *gin.Context) {
    c.HTMLString(200, "<html> %s </html>", unsafeString)
}

func handler2(c *gin.Context) {
    c.Render(200, render.JSON, data)
    c.Abort()
}

func handler3(c *gin.Context) {
    c.Render(-1, render.XML, data)
}
```

New API:

``` go
func handler1(c *gin.Context) {
    c.Header("Content-Type", "text/html")
    c.String(200, "<html> %s </html>", unsafeString)
}

func handler2(c *gin.Context) {
    c.Return(200, render.JSON{data})
}

func handler3(c *gin.Context) {
    c.Render(render.XML{data})
}
```

When i try to use gin.Context.JSON(200, instanceOfAStruct) the server always give a 500 error, as in this example:

```
type ExampleResp struct {
    Success bool `json:"success"`
    Data string `json:"data"`
}

func getRequestHandler(c *gin.Context) {
    resp := ExampleResp {
        Success : true,
        Data : "ssdfsd",
    }
    c.JSON(200, resp)
}
```

This example give me a 500 error with no message and no log in the console output (even if in gin.DebugMode)

Middlewares will always be executed even if there is a response in one of the middlewares.  

// Gin context code: 

``` go
func (c *Context) Next() {
    c.index++
    s := int8(len(c.handlers))
    for ; c.index < s; c.index++ {
        c.handlers[c.index](c)
    }
}
```

// compare with Martini:

``` go
func (r *routeContext) Next() {
    r.index += 1
    r.run()
}
func (r *routeContext) run() {
    for r.index < len(r.handlers) {
        handler := r.handlers[r.index]
        vals, err := r.Invoke(handler)
        if err != nil {
            panic(err)
        }
        r.index += 1

        // if the handler returned something, write it to the http response
        if len(vals) > 0 {
            ev := r.Get(reflect.TypeOf(ReturnHandler(nil)))
            handleReturn := ev.Interface().(ReturnHandler)
            handleReturn(r, vals)
        }

        if r.Written() {
            return
        }
    }
}
```

Hi!
What do you think about simple queue to the context? We already have a functions

``` go
func (c *Context) Set(key string, value interface{})
```

and 

``` go
func (c *Context) Get(key string) (value interface{}, exists bool)
```

for the specified context, but this is just a queue for non-specified contexts.
This is looks like:

``` go
func Foobar() gin.HandlerFunc {
    return func(c *gin.Context) {
        c.Enqueue("item1")
        c.Enqueue("item2")
    }
}

func main() {
    r := gin.New()
    r.Use(Foobar())

    r.GET("/test", func(c *gin.Context) {
        fmt.Println(c.Dequeue()) //item2
        fmt.Println(c.Dequeue()) //item1
    })
    r.Run(":8080")
}
```

godoc.org use master brach, so we always get old docs if you do not update master branch

I came across an interesting issue today. I wrote a super basic authentication middleware, which executes `c.next()` if user is logged in and simply returns when user is not logged in.

However even when I do `return` before `c.next()` the actual handler **still executes**. Is this the expected behavior? If so, why?

``` go
func Authentication() gin.HandlerFunc {
    return func(c *gin.Context) {
        tokenHeader := c.Request.Header.Get("Token")

        if len(tokenHeader) == 0 {
            c.JSON(http.StatusUnauthorized, gin.H{"Error": "Token header is missing"})
            return
        }

        token, err := jwt.Parse(tokenHeader, func(t *jwt.Token) (interface{}, error) {
            // Don't forget to validate the alg is what you expect:
            if _, ok := t.Method.(*jwt.SigningMethodHMAC); !ok {
                return nil, fmt.Errorf("Unexpected signing method: %v", t.Header["alg"])
            }
            if int64(t.Claims["exp"].(float64)) < time.Now().Unix() {
                return nil, ErrorInvalidToken
            }
            return []byte(config.Config.Key), nil
        })

        if err != nil || !token.Valid {
            c.JSON(http.StatusUnauthorized, gin.H{"Error": err.Error()})
            return
        }

        c.Set("UserID", int64(token.Claims["id"].(float64)))
        c.Set("AuthToken", token)



// <----
// THIS NEXT IS COMPLETELY POINTLESS. EVEN IF I return BEFORE IT, THE HANDLER WILL STILL EXECUTE
// ---->
        c.Next()

    }
}
```

Hi,
I would like to have access to a groups absolutePath so that i can generate reverse url. Is there any reason why this is not exposed.

Thanks

I am experimenting with several new APIs:

```
c.Stream(stepFunction)
c.SSEvent(name, message)
```

I expect this will help developers to build simple and stable streaming correctly with Go and Gin.

I created a realtime-chat example: https://github.com/gin-gonic/gin/blob/develop/examples/realtime-chat/main.go

The implementation: 
https://github.com/gin-gonic/gin/blob/470b7e1010b3ceee8574fda670143f73710a04e5/context.go#L383-L412
https://github.com/gin-gonic/gin/blob/470b7e1010b3ceee8574fda670143f73710a04e5/render/ssevent.go

Feedback is welcome!

This is result of `go get github.com/gin-gonic/gin` on MacOS

→ go get github.com/gin-gonic/gin
# github.com/gin-gonic/gin

code/src/github.com/gin-gonic/gin/gin.go:36: undefined: sync.Pool

If I use templates using gin's default approach, e.g., c.HTML(http.StatusOK, "mytemplate", gin.H{ "values": values }), with the in-memory cache from contrib/cache, the page is delivered correctly the first time, but I get an empty page on subsequent requests. However, if I render the template to a string and use c.HTMLString(http.StatusOK, mystring), subsequent requests are delivered correctly (and are coming from the in memory cache).

Hi,
I tried to write a REST API that returns a list of objects,  If the objects are strings (or any simple built-in objects),  it works fine.  However, if the objects are user-defined-type, Context.JSON returns a list of EMPTY objects.  It does not work when I either passing list as input to the Context.JSON or parsing the list and inserting objects  into gin.H{}  

Hi, I want to learn gin， but I found that examples provided by gin are too small to tell me how to build a real project with gin.
could gin provided some examples like revel or rails? I think that will help lots of people....

If gin would've used `http.Server`, I could've just done the following:

``` go
// s is a http.Server instance
s.SetKeepAlivesEnabled(false)
```

But gin doesn't allow that. So, [how do we accomplish this](https://godoc.org/net/http#Server.SetKeepAlivesEnabled)?

As the doc said, 

```
r.GET("/user/:name/*action"...
action := c.Params.ByName("action")
```

should return value string of **action**, but in fact it returns **/action** with the slash before param string, which is not correctly & inconvenient.

How to easy handle file upload with gin?
can you show us some example?

``` go
c *gin.Context;
var x int64 =10000;
c.Set("testInt64",x);
```

when

``` go
c.MustGet("testInt64") //is a float64 ,not int64 more.
```

If we could expose an API method like `.Before(gin.Handler)` that allows a user to wrap the muxer with a handler.


I'm in the process of writing a REST API which returns JSON. I've found my route handlers can get quite cluttered with error handling. I've been looking at ways I can reduce and simply error handling and would appreciate anyone's opinions or advice on what I've come up with.

I'm following the JSON API standard for error returning, http://jsonapi.org/format/#errors, they contain a bit more than the standard Error in Go, so when I initiate an error it can get quite big.

I have created an APIError struct, some helper functions and some default errors:

``` go
type APIErrors struct {
    Errors      []*APIError `json:"errors"`
}

func (errors *APIErrors) Status() int {
    return errors.Errors[0].Status
}

type APIError struct {
    Status      int         `json:"status"`
    Code        string      `json:"code"`
    Title       string      `json:"title"`
    Details     string      `json:"details"`
    Href        string      `json:"href"`
}

func newAPIError(status int, code string, title string, details string, href string) *APIError {
    return &APIError{
        Status:     status,
        Code:       code,
        Title:      title,
        Details:    details,
        Href:       href,
    }
}

var (
    errDatabase         = newAPIError(500, "database_error", "Database Error", "An unknown error occurred.", "")
    errInvalidSet       = newAPIError(404, "invalid_set", "Invalid Set", "The set you requested does not exist.", "")
    errInvalidGroup     = newAPIError(404, "invalid_group", "Invalid Group", "The group you requested does not exist.", "")
)
```

All of my other funcs in my app return their err but when it get backs to my handler I need to handle how I return it to the client. As far as I'm aware I can't return to middleware so I've added my own Recovery middleware which handles APIError that I panic from my handlers, i.e.

``` go
func Recovery() gin.HandlerFunc {
    return func(c *gin.Context) {
        defer func() {
            if err := recover(); err != nil {
                switch err.(type) {
                    case *APIError:
                        apiError := err.(*APIError)
                        apiErrors := &APIErrors{
                            Errors: []*APIError{apiError},
                        }
                        c.JSON(apiError.Status, apiErrors)
                    case *APIErrors:
                        apiErrors := err.(*APIErrors)
                        c.JSON(apiErrors.Status(), apiErrors)
                }
                panic(err)
            }
        }()

        c.Next()
    }
}
```

Then in my handler I can do something like this:

``` go
    // Grab the set from storage
    set, err := storage.GetSet(set_uuid)

    if (err == database.RecordNotFound) {
        panic(errInvalidSet)
    } else {
        panic(errDatabase)
    }
```

which, in my opinion, keeps things really tidy and reduces repetition. I've seen that people recommend you try to use panic as little as possible, but I'm not sure if it works well in this situation? I wonder what people think of this, whether it's a good way to go about it and, if my method isn't great, whether there's any recommended alternatives?

merge develop branch content to master so that "go get" can download the latest version of code (especially "gin/binding")

merge develop branch content to master so that "go get" can download the latest version of code (especially "gin/binding")

.... MIMEPOSTForm is required for req.ParseForm() to succeed in parsing the request body. Setting the Content-Type is only required for TestBindingPOSTForm, but I figured I might as well add it to all of the requests for consistency. 

Could you provide an examples of using a database connection in middleware?


I can't seem to figure out how to serve index.html under public dir which is served using

```
mux.Static("/public", utils.ConfigEntry("StaticDir"))
```

My goal is to make it a default template for the index page. I know I can try adding 

```
static := mux.Group("/")
{
    static.GET("/", vc.Index)
}
```

but this doesn't work with angular because the delimiters will conflict. I also couldn't find a way to change the default delimiters. I would greatly appreciate it if you could help me guys!

Thanks in advance,
Red   

Hi, 

Now I am using a lot on gin. And now I wonder if I can disable gin's stdout ?

If there is some , then how?

Thanks.

Hi

we are using a custom v0.6 fork with the static service bug fix on top of it, since develop and master seem unstable. Is there a stable gin-gonic hosted branch/tag we can use that contains the latest fixes, or can you tag a stable release?

thanks!

Great job on gin.

And, I recommend this better `Recovery()`, which works perfect with `Logger()`

```
func Recovery() HandlerFunc {
    return func(c *Context) {
        defer func() {
            if err := recover(); err != nil {
                stack := stack(3)
                c.Error(err.(error), string(stack))
                c.AbortWithStatus(500)
            }
        }()

        c.Next()
    }
}
```

So we can deal with these error messages in one place!

Hello i'm using apache ab -n 1000 -c 10 -t 5 http://localhost:8888/my-page.html

here my codes

``` go
import(
    "./router"
    "github.com/gin-gonic/contrib/gzip"
    "github.com/gin-gonic/contrib/sessions"
    "github.com/gin-gonic/contrib/static"
    "github.com/gin-gonic/gin"
)

func main() {
web := gin.Default()
web.Use(gzip.Gzip(gzip.DefaultCompression))
web.Use(static.Serve("/", static.LocalFile("./public", true)))
web.Use(static.Serve("/admin/assets", static.LocalFile("./admin/assets", true)))
web.Use(sessions.Sessions("master", sessions.NewCookieStore([]byte("test"))))

// All Routers
web.GET("/", router.Index)
web.GET("/:page/*pages", router.Main)
web.NoRoute(router.NotRoute)
web.Run(":8888")
}
```

what's wrong with my code?

Due to gin is Martini-like framework, why gin does not support service injection?
Will the service injection slow down gin's performance ?

When running the appengine example in source tree, I see the following error

http_runtime.py:285] bad runtime process port ['[GIN-debug] GET   /                         --> main79457.func\xc2\xb7001 (1 handlers)\n']

c.Bind successfully parses JSON data from the request body if the request method is POST. If request method is GET, that doesn't work, i.e. the body does not get parsed at all.

I find that gin does not support listening socket, I add it.


"undefined: render.WriteHeader"
https://github.com/gin-gonic/gin/blob/develop/examples/pluggable_renderer/example_pongo2.go#L47

Can use this?
https://gist.github.com/mopemope/51ea51b7a537a37c0dd5#file-example_pongo2-go-L17

Hi,

I encounter what I believed may be a bug with unicode urls:
say I have the following route

``` go
r.GET("/:role", FilterRole(), func(c *gin.Context) {
    url := c.Params.ByName("role")
}
```

If the `:role` param is to be unicode encoded a possible route may be `http://127.0.0.1:53286/%E4%B8%AD%E5%9B%BD` if generated using `url.QueryEscape("中国")` (unicode urls seems to always be escaped but modern browser display them as unicode...)

But when I call a `c.Params.ByName("role")` I do not get the escaped string `"%E4%B8%AD%E5%9B%BD"`, instead I get the unicode string `"中国"` which doesn't match.

Any idea on how to fix this issue?

By the way, thanks for the awesome framework

We had the following issue:

```
type Event struct {
    Timestamp string `form:"timestamp" json:"timestamp,omitempty"`
}
type AnotherEvent struct {
      Event
      Value string `form:"value" json:"value,omitempty"`
}
```

Using gins default Bind the embedded struct is ignored. This pull request adds support for embedded structs. Not sure if this is useful in general. 

does gin-gonic has similar API as martini can easily re-direct log to a file
e.g

``` go
   m.Map(log.New(f, "[martini]", log.LstdFlags))    
```

Minor bug where the absolute path would get duplicated for static rendering. HEAD and GET expect relative paths, and convert those to absolute paths. Static was passing them absolute paths causing duplicated pathing

```
/doc/doc/*filepath
```

instead of

```
/doc/*filepath
```

Fixed with @arnoldcano

For a json object with all elements as 'required':

If all the items have the initialization value ("" for strings, 0 for ints, etc.) then the bind succeeds... even if some of the items are not provided.

If one or more of the items has a non-init value, then any other item(s) with an init value causes a binding error for the latter item(s).

This is with e2fa89777e344782ef5d31929f095f4589c35dcc (0.5 - LAG in master)

Hi there!

I am enjoying my taste of Gin, and thought I would help by pointing out a typo in the documentation.

The plural of "middleware" is not "middlewares" but simply "middleware" -- just like "software."

cheers

-- kf.

Hello.

I wanted to create an rest json api, but I'm not sure is it possible in current version.

There is an empty param in example below.

```
r.GET("/api/meas/:name.json", func(c *gin.Context)
c.Params.ByName("name")
```

I have not pretty workaround:

```
r.GET("/api/meas/:name/.json", func(c *gin.Context)
c.Params.ByName("name")
```

Optional params in routing would be quite useful, I think.

If I go to http://upload.wikimedia.org/wikipedia/commons/7/76/Pagoda.svg I view the svg in the browser as an image, that is I don't see the svg "xml" text but the image itself.

When I serve my svg folder with gin however the svg's are treated as XML file's, how can I change that?

`r.Static("/trees", "./json/svg/")`

Because of the release of `echo`, a high performance router that claims to make zero allocations per request, I have decided to show something I have been working on.

Gin will also make zero allocations per request, but! not yet, I am close, this is still a work in progress.

Here are the benchmarks

```
BenchmarkEcho_Param 20000000                102 ns/op          0 B/op          0 allocs/op
BenchmarkGin_Param  20000000                112 ns/op          0 B/op          0 allocs/op

BenchmarkEcho_Param5    10000000            201 ns/op          0 B/op          0 allocs/op
BenchmarkGin_Param5 10000000                203 ns/op          0 B/op          0 allocs/op

BenchmarkEcho_Param20    3000000            557 ns/op          0 B/op          0 allocs/op
BenchmarkGin_Param20     3000000            506 ns/op          0 B/op          0 allocs/op

BenchmarkEcho_ParamWrite    20000000        104 ns/op          0 B/op          0 allocs/op
BenchmarkGin_ParamWrite 10000000            265 ns/op          8 B/op          1 allocs/op

BenchmarkEcho_GithubStatic  10000000        134 ns/op          0 B/op          0 allocs/op
BenchmarkGin_GithubStatic   10000000        141 ns/op          0 B/op          0 allocs/op

BenchmarkEcho_GithubParam    5000000        246 ns/op          0 B/op          0 allocs/op
BenchmarkGin_GithubParam    10000000        242 ns/op          0 B/op          0 allocs/op

BenchmarkEcho_GithubAll    30000            54892 ns/op        0 B/op          0 allocs/op
BenchmarkGin_GithubAll     30000            56149 ns/op     2336 B/op         32 allocs/op

BenchmarkEcho_GPlusStatic   20000000        99.2 ns/op         0 B/op          0 allocs/op
BenchmarkGin_GPlusStatic    10000000        121 ns/op          0 B/op          0 allocs/op

BenchmarkEcho_GPlusParam    10000000        160 ns/op          0 B/op          0 allocs/op
BenchmarkGin_GPlusParam 10000000            160 ns/op          0 B/op          0 allocs/op

BenchmarkEcho_GPlus2Params  10000000        221 ns/op          0 B/op          0 allocs/op
BenchmarkGin_GPlus2Params   10000000        191 ns/op          0 B/op          0 allocs/op

BenchmarkEcho_GPlusAll    500000            2620 ns/op         0 B/op          0 allocs/op
BenchmarkGin_GPlusAll     500000            2550 ns/op       128 B/op          2 allocs/op

BenchmarkEcho_ParseStatic   20000000        100 ns/op           0 B/op          0 allocs/op
BenchmarkGin_ParseStatic    20000000        115 ns/op           0 B/op          0 allocs/op

BenchmarkEcho_ParseParam    10000000        132 ns/op           0 B/op          0 allocs/op
BenchmarkGin_ParseParam 10000000            138 ns/op           0 B/op          0 allocs/op

BenchmarkEcho_Parse2Params  10000000        166 ns/op          0 B/op          0 allocs/op
BenchmarkGin_Parse2Params   10000000        164 ns/op          0 B/op          0 allocs/op

BenchmarkEcho_ParseAll    300000            4741 ns/op         0 B/op          0 allocs/op
BenchmarkGin_ParseAll     300000            5320 ns/op       288 B/op          8 allocs/op

BenchmarkEcho_StaticAll    50000            34539 ns/op        0 B/op          0 allocs/op
BenchmarkGin_StaticAll     50000            33725 ns/op        0 B/op          0 allocs/op
```

stay tuned!!

Context.Engine 应该为不可导出的 以避免出现以下代码

Edit by @manucorporat:
Context.Engine Should not be exported to avoid the following code:

``` go
package main

import (
    "github.com/gin-gonic/gin"
    "net/http"
)

func main() {
    router := gin.Default()
    router.GET("/", func(c *gin.Context) {
        c.Engine.GET("/ping", func(c *gin.Context) { // Should not be
            c.String(http.StatusOK, "pong")
        })
    })

    router.Run(":8090")
}
```

I want to provide a better API to get the input parameters from the path, POSTForm and GETForm.

Let's say, we register this route:

``` go
router.POST("/user/:username", handler)
```

and we expect to receive requests like this:

```
POST /user/manu?page=10 HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Host: localhost:8080

email=manu.mtza%40gmail.com
```
- Includes a parameter in the path (**:username**)
- Includes a GET form parameter (**page**)
- Includes a POST form parameter (**email**)

Right now, you would have to do this in order to get the parameters:

``` go
func handler(c *gin.Context) {
    c.Request.ParseForm()

    name := c.Params.ByName("username")
    page := c.Request.Form.Get("page")
    email := c.Request.PostForm.Get("email")
}
```
- Inconsistent
- Low level (`c.Request.ParseForm()`)
- Difficult to learn

The new proposal:

``` go
func handler(c *gin.Context) {
    name := c.Input.FromPath("username")
    page := c.Input.FromGET("page")
    email := c.Input.FromPOST("email")
}
```

Also, `c.Input` will implement an intelligent `Get()` method that takes the value from the proper source. This feature is implemented in popular frameworks like laravel.

``` go
router.GET("/account/:id", func(c *gin.Context) {
        // same than  c.Input.FromPath("id") in this context
    id := c.Input.Get("id")

    // ... read account with id
}
```

---

```
GET /list?page=2
```

``` go
router.GET("/list", func(c *gin.Context) {
        // same than  c.Input.FromGET("page") in this context
    page := c.Input.Get("page") // page = 2
}
```

One more thing, c.Input can be printed directly with `fmt.Print()` providing a useful debugging tool.

``` go
fmt.Println(c.Input)
```

I have started an effort to increase the coverage of unit tests to 100%, in order to make Gin a production ready framework. If anyone is interested to help, please contact me so we can coordinate.

Thanks!
Stay tuned!

Debug causes App Engine to fail building, output looks like this:

```
ERROR    2015-03-22 04:15:01,027 http_runtime.py:285] bad runtime process port ['[GIN-debug] GET   /                         --> web.func\xc2\xb7001 (1 handlers)\n']
```

Setting to ReleaseMode fixes this.



readme好像没有写怎么连接数据库呢

if you have the following templates

templates/index.tmpl
templates/group/index.tmpl

`r.LoadHTMLGlob("templates / ** / *.tmpl")`  will cause the root index.tmpl to be overwritten by group/index.tmpl

this means all your template file names must be globally unique! which looks like a bug

also the following will not work

``` go
c.HTML(http.StatusOK, "group/index.tmpl",..)
```

Ah...disregard this please. Was user error mixed with testing the new v0.6 

Not sure if it's best way to solve my problem with websocket connections and gin, but it does it.

What subj says :) I have websocket handler that manages connection by itself and can't find a way to stop gin from writing headers. It happens in routergroup.go around line 60. context.Writer.WriterHeaderNow()

Is there any workaround, or maybe we need a flag like 'hijacked' in a context struct?

The warning in question is: "http: response.WriteHeader on hijacked connection"

The error messages in `*gin.Context.Errors` contain strings like "Required title". Is there a way to pull the field name so my API's can easily send back errors like `"errors":[ { "title":"Required" } ]` ? Hoping for a way to do it without assuming I can extract from the string with any consistency

I have something like this currently: 

```
    var response ErrorResponse
    response.Errors = make(map[string]string)
    response.Message = "Invalid request"
    for _, e := range c.Errors {
        response.Errors[e.Meta.(string)] = e.Err
    }
```

Which displays something like: `"errors":[ { "Operation aborted":"Required slug" } ]`

In order to learn Golang, I am building a "[read later](https://github.com/rogierlommers/readinglist-golang)" service. It uses a bookmarlet which sends an urlencoded get-request to my gin-gonic powered golang service. I'm using the endpoint below to add records (urls) to a slice. 

```
r.GET("/add/:url", func(c *gin.Context) {
    url := c.Params.ByName("url")
    database = AddRecord(database, url)
    c.String(200, url)
})
```

The problem is that it does not match the endpoint when the get parameter contains special characters like `%2F` (I get a 404). When I simple test `http://localhost:8080/add/test-url`, it's working fine. There must be something wrong with the encoded characters, but I can't figure out how to define the endpoint in gin-gonic which does this trick.

The bookmarklet I use is:

```
javascript:location.href='http://localhost:8080/add/'+encodeURIComponent(window.location.href)
```

Example output is: `http://localhost:8080/add/https%3A%2F%2Fwww.reddit.com%2F`, but as mentioned above, this url does not match my /add endpoint and I can't figure out why.

Some more investigation learned that the `%2F` is causing the problem. I think this is a bug?

Include NoMethod method to Gin to allow middleware handling of 405 errors. Use just as you use the NoRoute method which gin already bundles so for example:

``` go
r := gin.Default() //start gin with default middlewares
r.Use(gzip.Gzip(gzip.DefaultCompression))  //add the gzip middleware to normal routes
r.NoRoute(gzip.Gzip(gzip.DefaultCompression)) //pass 404 errors to gzip middleware
r.NoMethod(gzip.Gzip(gzip.DefaultCompression)) //pass 405 No Method errors to gzip middleware
```

without the `r.NoMethod(...)` call, 405 No Method errors are not handled by any gin middleware and simply fall through to the go http.Router

First time trying and I get the following err.:

<pre>
lsoave@basenode:~$  go get github.com/gin-gonic/gin
# github.com/gin-gonic/gin
go/src/github.com/gin-gonic/gin/gin.go:34: undefined: sync.Pool
</pre>


<pre>
lsoave@basenode:~/test$ go version
go version go1.2 linux/amd64
</pre>

Hello everyone, 

This post is intended to notify the postpone of v0.6 release from today until this weekend. I've been working very hard at a local hackathon in the last 48 hours and I need some rest. I'll post changelog here when ready. I've reading all issues, new and existing.

Thank you all.


Depending on the use case, it might be useful to be able to have different realms for different route groups.

Before

![](http://go-gyazo.appspot.com/50b9fb122915f547.png)

After

![](http://go-gyazo.appspot.com/7ff3834c918f7ad6.png)

`router.GET("/year/(?P<year>[0-9]*)", handler)` or even
`router.GET("/year/\\d{0,4}", handler)`
does not work. Thanks!

I've tried to get a funcmap injected via HTMLTemplate(...) but with no luck using it. Does anyone have any samples?

Thank you

Hello,

I'm planning to use gin to get an RESTFull API but I don't see how shoud I use Gin to listen HTTPS connections. Is there any tutorial or video or contrib I could see?

Thanks,

### gin-gonic/gin now has a Chat Room on Gitter

@javierprovecho has just created a chat room. You can visit it here: [https://gitter.im/gin-gonic/gin](https://gitter.im/gin-gonic/gin?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&content=body_link).

This pull-request adds this badge to your README.md:

[![Gitter](https://badges.gitter.im/Join%20Chat.svg)](https://gitter.im/gin-gonic/gin?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=body_badge)

If my aim is a little off, please [let me know](https://github.com/gitterHQ/readme-badger/issues).

Happy chatting.

PS: [Click here](https://gitter.im/settings/badger/opt-out) if you would prefer not to receive automatic pull-requests from Gitter in future.

Hello! I'm currently working on a library to make writing tests for Gin web services easier. An obstacle in my path is that there is no interface for a Context, I'm creating some test helpers that will create a mocked context so I can fake requests. The lack of an interface makes this frustrating because if I just make my own interface I can't access the HTTP Request without doing a type conversion in my handler.

I propose creating a Context interface in Gin and adding a GetRequest() method to it. This wouldn't break API compatibility as long as we name the interface something other than Context and would be a great help to me. I'm happy to make the changes myself and submit a PR, I'd just like to know if it would be accepted or not.

This fix can help validating sub structures, for example we have something like this:

``` go
struct {
  RequiredField int `json:"required"`
  OptionalField struct{
    RequiredSubField string `json:"optional_sub_field" binding:"required"` 
    OptionalSubField string `json:"optional_sub_field"`
  }  `json:"optional_field"`
}
```

Without this patch Bind wont fail on something like this json

``` go
{
  "optional_field": {
    "optional_sub_field": "more"
  },
  "required_field": 10
}
```

This allow to define optional fields, that, if present, shoud fit some critreias.

It's not mentioned in the doc block at https://github.com/gin-gonic/gin/blob/master/context.go#L286

And also when I use another product (https://github.com/smira/aptly) that uses `gin` internally I cannot find out how to encode array for application to marshall it properly.

```
-H "Content-Type: application/json; charset=utf-8" --data '{"PackageRefs":["Pall test-build 2.3.19-0 e5a407129146e72a"]}'
```

This is the request that passes.

The corresponding structure looks like

```
var b struct {
    PackageRefs []string
}
```

I tried various combinations of

```
--data 'PackageRefs[0]=Pall test-build 2.3.19-0 e5a407129146e72a'
```

which included removing the `0` index and all possible permutations of encoding of the string (like using `+` for spaces, or `%20` or encoding `[` and `]` additionally, etc).

So my final question is - is `gin` currently able to marshall the `application/x-www-form-urlencoded` request into that struct?

If so, how the request body should look like?

I read this find the reason  https://github.com/gorilla/sessions/commit/44fb592008c2ecfbfc89725a8ae1638711dfa423
sessions use this package github.com/gorilla/context   have some  global variables, the variables never be clear. 
the doc of  gorilla/context is here http://www.gorillatoolkit.org/pkg/context
finally!forgive me ,I am not good at Englsih.



Most templating (moustache, erb, etc) libraries usually include a way to have a layout template:

``` html
<html>
    <head></head>
    <body>
        {{ content }}
    </body>
</html>
```

And subpages get injected into the content/yield part of the layout.

Is there documentation or a standard way to use a layout file?

change similate to simulate

... Also changed parsing of integer fields to take into account the size of the fields.

Hey guys,

Is it possible to generate a more explicit error message or just print out a string representation of `req.Body`when this happens? 

I'm getting, "cannot unmarshal number into Go value of type string", so it would be great to log what was actually sent as well. I think `req.Body` is emptied after Binding takes place. 

Edit: I meant, `json.NewDecoder` takes in a `ReadCloser` as a parameter. The subsequent calling of `Decode` drains the the ReadCloser, which is `r.Body` in this case.

Just throwing this out there..

But I feel like this step might be causing more confusion that it is helping. In this approach I think it's better to **under** prescribe than to **over** prescribe.

If the user is getting errors about a missing library, that is expected behavior, if a user is getting errors about an unused library, that is noise.

Just my opinion.. So I figured I would throw the PR out there.. 

any plan  to support other template, like pango or ace or amber?

I have JSON in the request body which I would like to bind into an array.  I tried several ways, but nothing seems to work.  Can someone please provide an example where a JSON body contains an array of structs which bound?  I know there are people who use maps.  I prefer to stick with struct objects.  Any tips would be greatly appreciated.

Thanks  :)

```
router.GET("/users/index", func(c *gin.Context) {
   c.HTML(http.StatusOK, "users/index.tmpl", gin.H{
        "title": "Users",
    })
})
```

I know this code can return the html file to the browser, but this file is not compressed. How to compressed the whole template before rendering?

Is there any successful template?

The offending code is 

```
    // RFC 2616 recommends that a short note "SHOULD" be included in the
    // response because older user agents may not understand 301/307.
    // Shouldn't send the response for POST or HEAD; that leaves GET.
    if r.Method == "GET" {
        note := "<a href=\"" + htmlEscape(urlStr) + "\">" + statusText[code] + "</a>.\n"
        fmt.Fprintln(w, note)
    }
```

This should be customisable as I want to return a JSON response to this something akin to

```
{"message": "301 Redirect " + urlStr}
```

So either allow for disabling this optional HTML response or allow overriding it.

I'm a newbie when it comes to Go so please excuse my ignorance, but I've setup a server that supports a POST request. I want the user to POST their request which includes a JSON payload then have that request redirected to another URL passing the original JSON payload. For example, if the user issues this CURL request: 

curl -H "Content-Type: application/json" -d '{ "name": "NewTest Network", "organizationId": 534238, "type": "wireless"}' -X POST "http://localhost:8080/network"

My Gin code does this:
r.POST("/network", func(c *gin.Context) {
       c.Redirect(http.StatusMovedPermanently, networks_url)
})

where: networks_url is another URL. I need a way to pass the original JSON payload to the redirected URL.

Any help you could provide would be greatly appreciated.

``` go
package routers

import (
    "github.com/gin-gonic/gin"
    "net/http"
    "sms/filter"
    "sms/controllers"
)

func NewRouters() *gin.Engine {

    chain := &filter.Filter{}

    router := gin.Default()
    router.Use(chain.FilterIp)

    //init controller
    smsTtemplateAtion := &controllers.SmsTemplateAction{}
    smsAppAction :=  &controllers.SmsAppAction{}


    v1 := router.Group("/v1")
    {
        //template
        v1.GET("/template/:id", smsTtemplateAtion.FindById)
        v1.GET("/findByAlias", smsTtemplateAtion.FindByAlias)
        v1.GET("/findByCompanyId", smsTtemplateAtion.FindByCompany)
        v1.GET("/template", smsTtemplateAtion.FindByPage)
        v1.POST("/template/create", smsTtemplateAtion.Create)
        v1.PUT("template/:id/update", smsTtemplateAtion.UpdateTpl)
        v1.PUT("template/:id", smsTtemplateAtion.Update)
        //app
        v1.POST("/apps/create",smsAppAction.Create)//conflicts with existing children in path '/v1/apps/:appId/recharge'
        v1.POST("/apps/:appId/recharge",smsAppAction.Recharge)
        v1.POST("/apps/:appId/setprovider",smsAppAction.SetProvider)
        v1.PUT("/apps/:appId/update",smsAppAction.Update)
        v1.GET("/apps",smsAppAction.FindByPage)
        v1.GET("/apps/:appId",smsAppAction.FindById)

    }

    router.GET("/ping", func(c *gin.Context) {
        c.JSON(http.StatusOK, gin.H{"message": "pong"})
    })

    return router
}
```

console print:

```
GIN-debug] GET    /v1/template/:id          --> sms/controllers.(*SmsTemplateAction).FindById-fm (4 handlers)
[GIN-debug] GET    /v1/findByAlias           --> sms/controllers.(*SmsTemplateAction).FindByAlias-fm (4 handlers)
[GIN-debug] GET    /v1/findByCompanyId       --> sms/controllers.(*SmsTemplateAction).FindByCompany-fm (4 handlers)
[GIN-debug] GET    /v1/template              --> sms/controllers.(*SmsTemplateAction).FindByPage-fm (4 handlers)
[GIN-debug] POST   /v1/template/create       --> sms/controllers.(*SmsTemplateAction).Create-fm (4 handlers)
[GIN-debug] PUT    /v1/template/:id/update   --> sms/controllers.(*SmsTemplateAction).UpdateTpl-fm (4 handlers)
[GIN-debug] PUT    /v1/template/:id          --> sms/controllers.(*SmsTemplateAction).Update-fm (4 handlers)
[GIN-debug] POST   /v1/apps/create           --> sms/controllers.(*SmsAppAction).Create-fm (4 handlers)
[GIN-debug] POST   /v1/apps/:appId/recharge  --> sms/controllers.(*SmsAppAction).Recharge-fm (4 handlers)
panic: wildcard route ':appId' conflicts with existing children in path '/v1/apps/:appId/recharge'

goroutine 1 [running]:
panic(0x4d3300, 0xc42000c7f0)
    /usr/local/Cellar/go/1.7/libexec/src/runtime/panic.go:500 +0x1a1
github.com/gin-gonic/gin.(*node).insertChild(0xc42030a480, 0xc420141b01, 0xc4200125a9, 0xf, 0xc4200125a0, 0x18, 0xc4200125c0, 0x4, 0x4)
    /Users/shine/Documents/dev/gosms/src/github.com/gin-gonic/gin/tree.go:275 +0xc37
github.com/gin-gonic/gin.(*node).addRoute(0xc42030a480, 0xc4200125a0, 0x18, 0xc4200125c0, 0x4, 0x4)
    /Users/shine/Documents/dev/gosms/src/github.com/gin-gonic/gin/tree.go:231 +0x22f
github.com/gin-gonic/gin.(*Engine).addRoute(0xc4203080e0, 0x57d187, 0x4, 0xc4200125a0, 0x18, 0xc4200125c0, 0x4, 0x4)
    /Users/shine/Documents/dev/gosms/src/github.com/gin-gonic/gin/gin.go:191 +0x1aa
github.com/gin-gonic/gin.(*RouterGroup).handle(0xc420016140, 0x57d187, 0x4, 0x589fcb, 0x15, 0xc42002c090, 0x1, 0x1, 0x7c6701, 0xc42002c090)
    /Users/shine/Documents/dev/gosms/src/github.com/gin-gonic/gin/routergroup.go:73 +0xe7
github.com/gin-gonic/gin.(*RouterGroup).POST(0xc420016140, 0x589fcb, 0x15, 0xc42002c090, 0x1, 0x1, 0x7c6780, 0xc420016140)
    /Users/shine/Documents/dev/gosms/src/github.com/gin-gonic/gin/routergroup.go:96 +0x7c
sms/routers.NewRouters(0xc400000018)
    /Users/shine/Documents/dev/gosms/src/sms/routers/router.go:34 +0x7af
main.main()
    /Users/shine/Documents/dev/gosms/src/sms/main.go:22 +0x54
exit status 2
```

I think assigning iota to each constant is not required

Dear gin committers, thanks for your great and awesome work. Unfortunately i've hit a corner case to which i didn't find a sufficient solution and would like to share my fix with the community.

We are rewriting a large pile of fu^Wold PHP Code from a project i just was put upon. The problem being that this is highly SEO-crap-stuff that the URLs that have been used in the past, need to work exactly like they are, because they have been pimped, yadda yadda blah.

Anyway, i could not convince them that using a better URL Scheme with 3xx would be probably better. So technically the problem is that they have URLs with multiple parameters within one /-segment. Imagine /:categoryName-at-:city . Now since i have all the categories and cities in the database, i tried adding them all, but that didnt work out to well as it took a few hours to load all categories for all the cities. Now i hot-fixed it to be /:category/at/:city and rewrite my Request in the NotFoundHandler and stick it back into gin with .HandleContext.

Hope this either gets merged or helps someone else.

Hey guys, 

I'm using gin to create some services at my company.
We have a service  responding to a .socket , a cron scheduler or the gin's endpoint.

I wouldn't like the ideia of my service will crashing because a GIN_MODE are wrong, I want just log the problem and let my service working as usual at scheduler and socket modes.

Since panic is called on a "gin.init()" I just can't programmatically avoid that behavior.

I suggest call SetMode lazylly!


The last commit was on 4 month ago and the issue never closed. Do you plan to update this?

Hi, 

When I try to use gin on release mode, my program freezes right after its start. I use the following lines of code : 
gin.SetMode(gin.ReleaseMode)
router := gin.New()
router.Use(gin.Recovery())

However, when I use debug mode, the program runs normally:
gin.SetMode(gin.DebugMode)
router := gin.New()
router.Use(gin.Recovery())

OR router := gin.Default()

Am I doing something wrong ?
Also, can you explain what's the difference between these two modes ? I tried to look for this information but didn't find anything relevant.

Thanks in advance!

I have a group "/foo".

this group uses middleware: group.Use(CertainFunc)

within this group I just have 
group.GET("/", doGet)
group.POST("/", doPost)

unfortunately the CertainFunc is never called, if I do GET on the path /foo


Fix for : fatal error: concurrent map read and map write

Golang spec says: a nil map is equivalent to an empty map except that no elements may be added.

I got a race condition when getting value from `Context`: `concurrent map read and map write`

The potential error code is in `/gin-gonic/gin/context.go`

```
// Set is used to store a new key/value pair exclusivelly for this context.
// It also lazy initializes  c.Keys if it was not used previously.
func (c *Context) Set(key string, value interface{}) {
    if c.Keys == nil {
        c.Keys = make(map[string]interface{})
    }
    c.Keys[key] = value
}

// Get returns the value for the given key, ie: (value, true).
// If the value does not exists it returns (nil, false)
func (c *Context) Get(key string) (value interface{}, exists bool) {
    if c.Keys != nil {
        value, exists = c.Keys[key]
    }
    return
}
```

I thought here we must use Mutex around `c.Keys[key]` to avoid the race condition.

```go
type Login struct {
    Timestamp time.Time `json:"timestamp"`
}

func main() {
    router := gin.Default()

    // Example for binding JSON ({"timestamp": 128989884})
    router.POST("/loginJSON", func(c *gin.Context) {
        var json Login
        if c.BindJSON(&json) == nil {
            // It will fail, how to convert parameters here?
        }
    })
    // Listen and server on 0.0.0.0:8080
    router.Run(":8080")
}
```

like the title

Add document to show how to support HTML5 history API and pushstate

I want to forward some to other route
Such as /login forward to /user/login

When using [glide](https://github.com/Masterminds/glide) as a dependency manager, the latest version detected is 0.6.0, which is an old release leading to the following errors in functions that have been added more recently:

```
c.Param undefined (type *gin.Context has no field or method Param)
c.BindJSON undefined (type *gin.Context has no field or method BindJSON)
c.Param undefined (type *gin.Context has no field or method Param)
c.DefaultQuery undefined (type *gin.Context has no field or method DefaultQuery)
c.Header undefined (type *gin.Context has no field or method Header)
c.Header undefined (type *gin.Context has no field or method Header)
c.Header undefined (type *gin.Context has no field or method Header)
c.Param undefined (type *gin.Context has no field or method Param)
```

Closes #693

I've noticed that, in responses from `gin.Context.JSON`,  special html characters get escaped, while other unicode characters are treated normally.

Here's a handler to reproduce this:

```
func Hello(c *gin.Context) {
    c.JSON(200, map[string]string{
        "message": "<foo> zażółć gęślą jaźń",
    })
}
```

```
$ curl localhost:3000/api/v1/
{"message":"\u003cfoo\u003e zażółć gęślą jaźń"}
```

Nginx uses X-Real-Ip with its IP instead of the client's IP. Therefore, we should use X-Forwarded-For _before_ X-Real-Ip

You can try setting up and AWS ELB instance with the following code and see for yourself.

``` go
package main

import (
    "fmt"
    "log"
    "net/http"
    "strings"

    "github.com/gin-gonic/gin"
)

func main() {
    router := gin.Default()
    router.GET("/", func(c *gin.Context) {
        log.Printf("%s", strings.Split(c.Request.Header.Get("X-Forwarded-For"), ",")[0])
        log.Printf("%s", c.Request.Header.Get("X-Real-Ip"))
        log.Printf("%s", c.ClientIP())
        c.JSON(http.StatusOK, gin.H{})
    })

    router.Run(fmt.Sprintf("0.0.0.0:%d", 5000))
}
```

``` go
package main

import (
    "fmt"
    "github.com/gin-gonic/gin"
)

func main() {

    r := gin.New()

    // Global middleware
    r.Use(gin.Logger())
    r.Use(gin.Recovery())

    // All request always use the middleware
    r.Use(func(c *gin.Context) {
        fmt.Println("Global middleware passed")
    })

    v2 := r.Group("/v2/")

    // Only the right request method can be use the middleware
    v2.Use(MiddlewareV2)
    {
        v2.GET("/normal", normal)
    }

    r.Run(":8080")
}

func MiddlewareV2(c *gin.Context) {
    fmt.Println("Group middleware passed")
    c.AbortWithStatus(503) //just test
    return
}

func normal(c *gin.Context) {
    c.String(200, "OK")
}

```

Test

``` sell
#right method
$ curl -XGET http://127.0.0.1:8080/v2/normal
```

``` shell
# Log
Global middleware passed
Group middleware passed
[GIN] 2016/08/29 - 11:11:31 | 503 |      61.649µs | 127.0.0.1 |   GET     /v2/normal
```

``` shell
# invalid method
$ curl -XOPTIONS http://127.0.0.1:8080/v2/normal
```

``` shell
# Log
Global middleware passed
[GIN] 2016/08/29 - 11:11:44 | 404 |      43.675µs | 127.0.0.1 |   OPTIONS /v2/normal
```

The above show that  global middleware can be effect when use invalid method. 
But the group middleware must the right method can be effect.  

IF not an issue, please tell me how to do it?

Thanks.

# bug desc

``` go
type UpdateUserReqParameters struct {
    Sender  int    `form:"sender" json:"sender" binding:"required"`
}

code:
var req UpdateUserReqParameters
    if err := c.BindJSON(&req); err != nil {
        response.ErrorResponse(c, http.StatusBadRequest, err)
        return
    }




when i  use  postman  send 
{
    "sender":0,
}

get  this error
r
{err":"Key: 'UpdateUserReqParameters.Sender' Error:Field validation for 'Sender' failed on the 'required' tag"}


```
# I think

the  int 0 in req body can not unmashal.

Hi,

I seem to be having an issue with bind not getting the values I'm expecting. I have a created a gist that demonstrates the issue I am experiencing. https://gist.github.com/dvwright/4852fe63c753196fa077bb76928b4b20

When I run this I get:

go test  -run TestWhyNotBinding
[GIN-debug] POST   /api/v1/users  --> example/gin.CreateUser (5 handlers)
Raw Request Body : %s {{"email": "testEmail", "password": "testPassword"}}
Decoded Body Request Email : testEmail
Decoded Body Request Password : testPassword
Bind Email - Why not Set?
Bind Password  - Why not Set?

Thank you



How to reverse proxy web requests for a few routes to another backend in Gin Gonic web golang framework

Is there a way to directly forward in the Handle function as shown below?

```
router := gin.New()
router.Handle("POST", "/api/v1/endpoint1", ForwardToAnotherBackend)
```

I'm attempting to enforce required JSON request fields using the `binding="required"` tag. I expected `c.BindJSON` to raise an error when a required field was not present, however, it also raises an error when a required bool field is set to `false`. 

Is there a better way to enforce required JSON request bodies?

Here is an example:

``` go
func myHandler(c *gin.Context) {
    var req struct {
        Foo string `json:"foo" binding="required"`
        Bar bool   `json:"bar" binding="required"`
    }

    if err := c.BindJSON(&req); err != nil {
        // When a request's `foo` field is set to `false`, the following error is raised:
        // err="Key: '.Foo' Error:Field validation for 'Foo' failed on the 'required' tag"
    }
}
```

in context.go ,package context is from "golang.org/x/net"

``` code
import"golang.org/x/net/context"
```

hope  can change to:

``` code
import "context"
```

when go 1.7 release. 
If can change now, better. Thanks.

Hi all, I needed render a template base of a simple dashboard, immediately how a database's petition. The database is lower and delayed about 3 seg and just after i needed render the other template with the new info. But I don't know how to make this. I tried several ways but not work. This is my code, I omitted the database petition and replace with a simple delay:

![image](https://cloud.githubusercontent.com/assets/18302365/17646427/35e75574-618e-11e6-8e65-eee48d2c73b2.png)

Can you make working something like that? 

``` go
func TestCreateNamedAndParamRoutes(t *testing.T) {
    router := New()
    router.GET("/some_route/subroute", func(c *Context) {
        c.String(400, "subroute")
    })
    router.GET("/some_route/:some_value", func(c *Context) {
        value := c.Param("some_value")
        c.String(400, "route with value '%s'", value)
    })

    w := performRequest(router, "GET", "/some_route/subroute")
    assert.Equal(t, w.Code, 400)
    assert.Equal(t, w.Body.String(), "subroute")

    w = performRequest(router, "GET", "/some_route/abc")
    assert.Equal(t, w.Code, 400)
    assert.Equal(t, w.Body.String(), "route with value 'abc'")
}
```

I mean creating named subroute besides route with parameter. When calling `/some_route/subroute`, the first handler fires, when calling `/some_route/something_else`, second handler fires with appropriate value

``` go
func MW1(c *gin.Context) {

     // go next middleare and run handlerFunc
     // and has already used c.JSON(200, "some data") in handlerFunc
    c.Next() 

    // Invalid!!  (Because the Header buffer already send)
    c.Header("X-Request-Id", "123")
}
```

How solve the problem that set header after handlerFunc in middleware?
:)

Hi,

I'm willing to use gin to replace mux, is there a way to do pattern route matching based on regex?

Like so:

```
router.GET("/display/{sig}/{op}/x{h:[\\d]+}/{path:[\\w\\-/.]+}", handlerFunc)
```

Thank you

For example, Gorilla has: `r.Host("www.example.com")`

Is that possible?

In order to make a custom GIN template renderer, you need to implement two small interfaces, one is the Render interface in render/render.go and the other is the HTMLRender interface in render/html.go which provides the Instance method.

I have successfully created two custom template rendering libraries for Gin using this method, one is https://github.com/robvdl/pongo2gin and a new one I just released recently https://github.com/robvdl/ginraymond adds handlebars style templates to Gin.

I have found one small issue in Gin's design while doing these libraries, and this is that the "Instance" method in the HTMLRender interface does not return an error type, which means that if I cannot load the template in my ginraymond library or pongo2gin I am forced to panic, this is not ideal.

See: https://github.com/robvdl/pongo2gin/blob/master/render.go#L45

See: https://github.com/robvdl/ginraymond/blob/master/render.go#L38

I am proposing to change the HTMLRender interface slightly, to also return an error type in the Instance method, which may break some third party libraries, but I think it's worth it as it encourages better Go design.

求大神推荐

The assets generate by [go-bindata](https://github.com/jteeuwen/go-bindata) can embedded html template into the execute file itself.

It's usefull while gin running as release mode, so that it can distribute only one execute file without many templates files.

This patch added support for that.

I'm pretty new in Go! but I just finished to migrate my nodejs REST api to Go...
I need to implement a behaviour of sails.js framwork which can handle socket.io requests and simulate http ones...the only way to do it with Gin I found was 'mocking' the request like I do on my test:

``` go
return func(so *gosocketio.Channel, req SockRequest) SockResponse {
// Prepare the request (SockRequest is a json incoming on the socket unmarshaled by socket.io)
            request, _ := http.NewRequest(http.MethodGet, req.Url, nil)
            for prop, value := range req.Headers {
                request.Header.Set(prop, value)
            }
            request.Header.Set("SockId", so.Id())

            writer := httptest.NewRecorder()
            srv.ServeHTTP(writer, request)
            var body interface{}
            _ = json.Unmarshal(writer.Body.Bytes(), &body)

            return SockResponse{Body: body, Headers: writer.Header(), StatusCode: writer.Code}
}
```

I have a huge drop of performance, I assume is on the chain here, as a lots of marshaling, unmarshaling, mocking and the httptest.NewRecorder()...

So my question is, any advice? what's the best way to do this?
Thanks in advance!

How about something like - 

``` go
func SaveUploadedFile(file *multipart.File, dest string) error {    
    out, err := os.Create(dest)    
    if err != nil {    
        return err    
    }    
    defer out.Close()    
    if _, err := io.Copy(out, file); err != nil {    
        return err    
    }    
    return nil    
}    
```

Wouldn't it be nicer then the need to do it by yourself? File uploading isn't a rare thing

Now, I'm using Nginx as proxy.
And I want to use fast-cgi mode using fcgi package.
[fcgi](https://golang.org/pkg/net/http/fcgi/)

As far as I know, fcgi has been not supported on gin.
Is there plan to adjust it?

Thanks.

Harry.

If an URL/Route contains a trailing question mark, an 404-Error occures. I stumbled about this issue at https://github.com/parnurzeal/gorequest/issues/65, https://github.com/golang/go/issues/13488 and https://github.com/golang/go/issues/14573.

The golang net/http package solved this issue, see this small example (taken from here: https://golang.org/doc/articles/wiki/#tmp_3)

``` go
package main

import (
    "fmt"
    "net/http"
)

func handler(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintf(w, "Hi there, I love %s!", r.URL.Path[1:])
}

func main() {

    http.HandleFunc("/", handler)
    http.HandleFunc("/q?", handler)
    http.HandleFunc("/q?foo=?", handler)

    fmt.Fprintln("Running on 127.0.0.1:8080")
    http.ListenAndServe(":8080", nil)
}
```

If i make a GET-Request to `127.0.0.1/q?` with Postman it works, and prints back "Hi there, I love q!"
The next example is written in gin-gonic:

``` go
package main

import (
    "fmt"
    "strings"

    "github.com/gin-gonic/gin"
)

func main() {
    r := gin.Default()
    r.GET("/q?", func(c *gin.Context) {
        c.String(200, "Hello there!")
    })
    r.GET("/q?foo=?", func(c *gin.Context) {
        foo, exists := c.Get("foo")
        if !exists  {
            foo = ""
        }
        c.String(200, "Hello there: %v", foo)
    })
    r.Run()
}
```

Same Get-Request with Postman. Here i get a 404-Not Found Error. Also the Server-Logs in console say 404.

I am using OS-X build my project, code below:

```
/usr/bin/env CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -v kong # kong is my project directory name 
```

Deploy to server, But all static request respond 404, Only POST request is working. My server env:

```
GOARCH="amd64"
GOBIN=""
GOEXE=""
GOHOSTARCH="amd64"
GOHOSTOS="linux"
GOOS="linux"
GOPATH="/mydata/gowork"
GORACE=""
GOROOT="/mydata/go"
GOTOOLDIR="/mydata/go/pkg/tool/linux_amd64"
GO15VENDOREXPERIMENT="1"
CC="gcc"
GOGCCFLAGS="-fPIC -m64 -pthread -fmessage-length=0"
CXX="g++"
CGO_ENABLED="1"
```

If upload source to server and ' go run main.go ' so static request can be working.

How to fix the issue, Thanks everyone!  

Is there any plan on v2? Features like integrate `net/context` in `gin.Context`

Let programmers who are using Intellij IDEA as golang IDE do not commit the IDEA's configuration folder.

It looks like version tags (semver style) were being done at some point, then stopped at v1.0rc1

Any plans to bring this back? It would help to get specific versions of Gin from a glide.yaml file when using Glide (and probably other versioning tools that support semver too).

HI I've been trying to make the router/service run on TCP4 only

//none of these are working , It keeps being listed on tcp6
r.Run(":8080")
r.Run("*:8080")
r.Run("0.0.0.0:8080")

RT

@manucorporat, in your example [here](https://github.com/gin-gonic/gin/issues/274#issuecomment-104472296), what if the error is something like a "not found" error, in which case it would be more appropriate to return a status code of 404 instead of 500? What is the recommended way to handle status codes in this architecture? Should the codes be attached to the errors using the `Meta` method?

Im writing some rest API Services on the appegine in a different modules im also using Gin for routing.
This is my dispatch file

```
  - url: "*/meal"
       module: meal
```

And the gin code .

```
r.Handle("POST", "/meal", m.InsertMeal) //http 200 
    r.Handle("GET", "/meal", m.GetAllMeals)//http 200 
    r.Handle("GET", "/meal/:id", m.GetAllMealById) //http404 

    http.Handle("/meal", r)
```

What is the proper way to config my handler? 

Here is simple code that i am trying to run

```
package main

import (
    "log"

    "github.com/gin-gonic/gin"
)

func main() {
    server := gin.Default()

    server.GET("/countries/*code", GetCountries)
    server.Run()
}

func GetCountries(c *gin.Context) {
    ccode := c.Param("code")
    log.Printf("Code: %s", ccode)
}
```

Here is output after run

```
[GIN-debug] redirecting request 301: /countries --> /countries/
Code: /
[GIN] 2016/07/16 - 17:24:59 | 200 |      16.508��s | ::1 |   GET     /countries/
Code: /USA
[GIN] 2016/07/16 - 17:25:17 | 200 |       12.47��s | ::1 |   GET     /countries/USA
```

It is visible that if code is not passed to url still it is giving `/`.
Expected output is empty string or nil.

Hello @danslimmon, @DennyLoko, @sidbusy, @stxml, @dgsi, @kongfei605, @LeBronoMars and @tsirolnik,

First of all, sorry for delay in answering, I was just a little bit busy with university (final exams).

Regarding all the following issues (#629, #633, #636, https://github.com/danslimmon/gin/pull/1 and #661), here is what I suggest:
- Because Gin now has the API frozen (doesn't allow breaking changes in functions or behavior), I can't change the behavior of `c.BindWith()` (#661, @sidbusy), however I like the idea, so keep reading.
- I'll review and merge the PR #633 with the fix https://github.com/danslimmon/gin/pull/1 (@danslimmon, @DennyLoko).
- I propose to add two function/aliases called:
  - `c.ShouldBindWith()` implementing #661, which will allow custom error managment.
  - `c.MustBindWith()` being an alias of `c.BindWith()` and soft deprecating the last one (just a message via `fmt.Println`), for a future change of behavior, by moving `c.ShouldBindWith()` back to `c.BindWith()`.

Because I'm not a native english speaker, maybe the naming of the two new proposed functions sound strange or completely wrong, so I'm open to suggestion about this, and also about everything else in this message.

Hope I did explained correctly. Tell me your thoughts.



I'm honestly not sure whether or not it is the intended behavior or a bug, but here it goes:

``` go
type MyRequestStruct struct {
    PropertyOne string `json:"propertyOne" binding:"required"`
    PropertyTwo string `json:"propertyTwo" binding:"required"`
}

func main() {

    engine := gin.New()

    engine.POST("/test", func (ctx *gin.Context) {
        var req MyRequestStruct

        if err := ctx.BindJSON(&req); err != nil {
            ctx.JSON(http.StatusBadRequest, err)
        } else {
            ctx.JSON(http.StatusOK, req)
        }
    })

    engine.Run("localhost:8080")
}
```

So I have tested with these 3 requests. For me only the last one should fail.

1 - 

``` bash
curl -X POST http://localhost:8080/test -d '{ "propertyOne": "1", "propertyTwo": "2" }' -H "Content-Type: application/json"
```

Respone:

``` json
{
    "propertyOne": "1",
    "propertyTwo": "2"
}
```

2 - 

``` bash
curl -X POST http://localhost:8080/test -d '{ "propertyOne": "", "propertyTwo": "" }' -H "Content-Type: application/json"
```

Response:

``` json
{
    "MyRequestStruct.PropertyOne": {
        "FieldNamespace": "MyRequestStruct.PropertyOne",
        "NameNamespace": "PropertyOne",
        "Field": "PropertyOne",
        "Name": "PropertyOne",
        "Tag": "required",
        "ActualTag": "required",
        "Kind": 24,
        "Type": {},
        "Param": "",
        "Value": ""
    },
    "MyRequestStruct.PropertyTwo": {
        "FieldNamespace": "MyRequestStruct.PropertyTwo",
        "NameNamespace": "PropertyTwo",
        "Field": "PropertyTwo",
        "Name": "PropertyTwo",
        "Tag": "required",
        "ActualTag": "required",
        "Kind": 24,
        "Type": {},
        "Param": "",
        "Value": ""
    }
}
```

3 - 

``` bash
curl -X POST http://localhost:8080/test -d '{ }' -H "Content-Type: application/json"
```

Returns:

``` json
{
    "MyRequestStruct.PropertyOne": {
        "FieldNamespace": "MyRequestStruct.PropertyOne",
        "NameNamespace": "PropertyOne",
        "Field": "PropertyOne",
        "Name": "PropertyOne",
        "Tag": "required",
        "ActualTag": "required",
        "Kind": 24,
        "Type": {},
        "Param": "",
        "Value": ""
    },
    "MyRequestStruct.PropertyTwo": {
        "FieldNamespace": "MyRequestStruct.PropertyTwo",
        "NameNamespace": "PropertyTwo",
        "Field": "PropertyTwo",
        "Name": "PropertyTwo",
        "Tag": "required",
        "ActualTag": "required",
        "Kind": 24,
        "Type": {},
        "Param": "",
        "Value": ""
    }
}
```

Could you tell me how to use Gin the Get or POST request to download a file,  i have go the file's byte[] stream,thanks every one 

How do I make a session timeout after X minutes of inactivity.  All I seem to see is Fixed anount of minutes in the examples.   Thanks for any help.

nd

build the example ,warn me "not find package stats".where can i get package stats


As executing gin applications, I just use golang.org/x/net/context for async process, such as sending logs with fluentd, or r/w databases. So I create `ctx := context.Background()`, but I cloud not call it because `gin.GET(func)`'s func has only one arg: `*gin.Context`, cloud not include `ctx` (= context.Context).

i use extjs to send params array like ["ac1","ac2"] with name "acMode" in Get request,
then how can i  get the params use c.Query("acMode")? now i only get the first value "ac1",
thanks every one

Scenario: 
User submits something, I want to give an instantaneous response "ok received", so that the user can go on his way. Meanwhile, I need to spend 2-3 seconds to perform some computation on the new submission (e.g., generate thumbnails, add indices, inform admins). Users don't need to wait for the result, but I want the computation done asap. 

My current solution is to launch a goroutine for heavy stuffs before returning response. I don't know whether this is the best practise. In my opinion, this is wasteful, because it should be cheaper to continue on the same thread instead of launching a new one.  It also appears that when I perform gin.JSON(...), the result is sent already? even if there are more lines down the road? 

Is it possible to first return the response and then continue in the same thread? Does gin support this already?


Hi,

I have the following directory structure:

src/mywebapp.go 
src/www/ (In this dir I've got html files - for example test.html, auth.html, etc)

The www dir contains 107 html files. All these html files are mostly static, however they all contain a variable {{.testing}}. 

I'd like the client to browse to http://127.0.0.1/test.html and be presented with the file located in src/www/test.html (test.html contains {{.testing}})

So far I only know how to accomplish this by having 107 router.GET calls. 
`router.GET("/testing.html", func(c *gin.Context) {
        c.HTML(http.StatusOK, "testing.html", gin.H{
            "test": "display on webpage",
        })`

Any assistance would be appreciated. Thanks!

When a request hits Gin, it would be great for instrumentation to have access to the original route string that was passed to register the handler that has been selected to handle the request.

Dear all,

I'm trying to use [Authboss](https://github.com/go-authboss/authboss), which is some kind of devise equivalent in Go, with Gin and I have some trouble to understand how to plug authboss's router with Gin'.

In their example, they use [gorilla/mux](https://github.com/gorilla/mux) and they do the plugging doing :

``` go
mux.PathPrefix("/auth").Handler(ab.NewRouter())
```

knowing that [ab.NewRouter](https://godoc.org/gopkg.in/authboss.v0#Authboss.NewRouter) returns an [http.Handler](https://godoc.org/net/http#Handler).

Is this possible using Gin ? I have tried using `gin.WrapH(ab.NewRouter())` but I don't really know what am I doing with this.

Thanks a lot for your help,
Albin.

Is it safe in terms of concurrency to serve the same Engine from HTTP and HTTPS ports?

``` go
r := gin.Default()
r.GET ...
r.RunTLS(...) // RunTLS and Run should run concurrently.
r.Run()
```

Basically I want to add the prefix www even if the users are not using it.

Maybe I can check context->request->url->host, and then redirect if I don't see www, but this requires that I do it for every handler.

Is there a better way, thanks!

Sample code:

```
v1 := router.Group("/v1")
    {
        v1.GET("/tableN/:number", v1GetTableN)
    }
```

Is it possible to have `:number` optional? Or, do I need to just add another route?


I'm currently running my API fully in HTTPS. This is ok, but now I also want to add some front-end pages to my system. Most people land on that front-end by just typing www.mydomain.com (HTTP). How can I set Gin to behave so that all HTTP calls will be redirected to their HTTPS equivalent? So not only `"/"`, but all other paths too.

Hi I wonder if there is a way to write custom validator function as straight usage of v8 provides (gin use it for validation while binding, right? https://godoc.org/gopkg.in/go-playground/validator.v8)

Or is there a way to overwrite a validator used by gin??

Sorry if this issue has already been reported, but I can't find an answer. I'm making some sort of proxy API in front of a Docker Registry. As some of you probably knows, Docker Registry API calls start with `/v2/<parameter>/<command>/...`.

For example, I'm trying to catch the PUT manifest call: `/v2/<repository>/manifests/<reference>`. The problem is that the `repository` parameter can contains slashes, and a route like: `/v2/:repository/manifests/:reference` can't handle this. Is there a way to do this?

Thank you!

If we pass parameter to the REST function containing "/" (slash), then the param is not accepted, and results in an error. This seems to indicate that escaping special characters like "/" (slash) was not built in the gin framework. 

```
eg:- if we built an api like "/api/apps/{id}", then for a value of {id} as "/hello/world", it does not work. 
```

I added a Boolean `UseRawPath` to the `struct Engine` that if set to true, extracts the RawPath from the URL. The `handleHTTPRequest` is modified to include the check if `UseRawPath` is toggled or not.

If we pass parameter to the REST function containing "/" (slash), then the param is not accepted, and results in an error. This seems to indicate that escaping special characters like "/" (slash) was not built in the gin framework. 

```
eg:- if we built an api like "/api/apps/{id}", then for a value of {id} as "/hello/world", it does not work. 
```

I added a Boolean `UseRawPath` to the `struct Engine` that if set to true, extracts the RawPath from the URL. The `handleHTTPRequest` is modified to include the check if `UseRawPath` is toggled or not.

This interface is implemented on the standard net/http response object in order to unlock some optimizations around sendfile. In the same vein as the other optional interfaces, calling ReadFrom will result in a runtime panic if the underling http.ResponseWriter doesn't implement it.

Hi!

This pull request removes the obsolete func (`LoadHTMLTemplates`) in README.

Single-line fix! See #633.

Fixes #634.

I imported a package (github.com/mkevac/debugcharts) that has dependencies on gin. Suddenly all my log messages were missing the time stamps and I tracked it down to the [init function in debug.go](https://github.com/gin-gonic/gin/blob/develop/debug.go#L14)

If you call `context.Bind()` and it fails, `context.AbortWithError()` gets called, which means headers get sent. Result: you can't send a non-`text/plain` response later.
## Example

``` go
package main

import (
    "net/http"

    "github.com/gin-gonic/gin"
)

func main() {
    router := gin.Default()
    router.POST("/", func(c *gin.Context) {
        reqBody := make(map[string]string)
        err := c.BindJSON(&reqBody)
        if err != nil {
            c.JSON(http.StatusBadRequest, map[string]string{
                "error": err.Error(),
            })
        } else {
            c.JSON(http.StatusOK, map[string]string{
                "error": "No error. Everything is fine.",
            })
        }
    })
    router.Run(":8913")
}
```

If you send invalid JSON in the request, you should still expect the response to have the header `Content-Type: application/json; charset=utf-8`, but instead it has `Content-Type: text/plain; charset=utf-8`.

IMO `context.BindJSON()` should not call `context.AbortWithError()`. Instead, the caller should have to handle sending their own error response. If you agree, I'll certainly be happy to write the PR.

I’m Nhat, I’m student from Viet Nam. I’m using Gin gonic and having a problem. Can you help me? How can I import a json like that?
[
{
"Name": "Apolo",
"Phone": "2147483643247",
"Email": "aloha1@gmail.com",
"Content": "ccvodoi"
},
{
"Name": "Apolo1",
"Phone": "214567643247",
"Email": "aloha2@gmail.com",
"Content": "ccvodoi"
},
{
"Name": "Apolo2",
"Phone": "214756743247",
"Email": "aloha3@gmail.com",
"Content": "ccvodoi"
}
]

Details can be found in issue #630

I was attempting to use the exported `gin.Error`type  in `func (c *Context) Error(err error) *Error` but it fails on compilation. 

``` go
func someFunc(c *gin.Context) {
  if u, err := SomeOp(); err != nil {
    c.Error(gin.Error{err, gin.ErrorTypePublic, c.Request.URL.String()})
  }
}
```

Here's the compilation error :
`cannot use gin.Error literal (type gin.Error) as type error in argument to c.Error:
    gin.Error does not implement error (Error method has pointer receiver)`

If seems like the inteface was improperly implemented [here](https://github.com/gin-gonic/gin/blob/develop/errors.go#L74-L77) as the reviecer type should not have be an *Error.

This should fix it.

``` go
// Implements the error interface
func (msg Error) Error() string {
    return msg.Err.Error()
}
```

It is working fine with localhost, but when i uploaded the app to aws ec2 i'm getting this warning. Records are created in database but i wasn't able to return the 201 status.

this is my code

> //insert record to database
> result := handler.db.Create(&newRoom)
> 
> //check if record is created
> if result.RowsAffected > 0 {
>     c.JSON(http.StatusCreated, newRoom)
> } else {
>  //display error message 
>  errMsg := &ErrMsg{Message: result.Error.Error()}
>   c.JSON(http.StatusBadRequest,errMsg)
>   c.AbortWithStatus(http.StatusBadRequest)  
> }

I have my HTML coming from a cache. That's because the combining of a DB read and rendering is expensive. So I cache the HTML (a string starting with `<!doctype html><html>...`). 
And in my view function I fetch it from the cache and push it out. 

If I use `c.String(http.StatusOK, html)` it works but the content-type gets set to `text/plain`. 

I could use...: 

``` go
c.HTML(http.StatusOK, "index.tmpl", gin.H{
            "html": template.HTML(html),
        })
```

with a template that does nothing other than `{{ .html }}`.

`reset` field should be after `method` in LoggerWithWriter function.

Hi! We have a weird use case where we need to stop an entire router from listening. I've looked through the source and only see code for running it. This isn't specific to go but I think this is what i'm talking about: http://www.hydrogen18.com/blog/stop-listening-http-server-go.html


Hello, 

I have a url in the form 

`````` http://localhost:5000/oauth2?foo=1#access_token=qwerty```

and a request handler
```go
router.GET("/oauth2", func(c *gin.Context) {
  fmt.Println("Fragment: ",c.Request.URL.Fragment, "URL: ", c.Request.URL.String())
})
``````

but when I hit the endpoint with my url, it results in

```
Fragment:  URL: /oauth2?foo=1
```

note: As much as I would prefer, I cant send the access_token as a query param because I do not control the Imugur's OAuth2 service.


Signed-off-by: tsaikd tsaikd@gmail.com

I'm developing web server program that there are some pages which accept only https or http depending on page.
How should I handle it as suitable gin style.

That means, I want to handle that restriction on below code as my image.

```
//http
route.GET("/", IndexAction)

//https only
route.GET("/", someSSHAction)

```

Thanks.

add code  to c.String

Hello,

I found if my POST json message contains an underscore attribute, the bind won't work.

For example, this doesn't work

```
{
"created_by":"abc"
}

```

But if I remove the underscore, then it will work

```
 {
"createdby":"abc"
}
```

Could anyone explain why? is it designed on purpose or a bug?

go build
endor/github.com/gin-gonic/gin/binding/default_validator.go:48:14: undefined: validator.Config
vendor/github.com/gin-gonic/gin/binding/default_validator.go:49:29: too many arguments in call to validator.New

- go version: 1.12.0
- gin version :1.13.0
- operating system:macos 10.14.3

The middleware has to be added before calling engine.Run/RunTLS etc.
This is a big limitation, as some middleware are only needed on certain circumstances.

please see https://github.com/github/explore

Add topic and display like this:

![image](https://user-images.githubusercontent.com/4488261/54575258-5cf4aa00-4a2e-11e9-82c1-965f79204fed.png)

This will reduce the number of times we have to do a redirect
and allow multiple slashes in path to be routed!
fixes #1644
# What I did
Remove `sudo: false` setting from `travis.yml` .

# Context
According to the following posts, Travis-CI had two Linux infrastructures which are containers and virtual machines, but recently Travis-CI was combined two Linux infrastructures into a virtual machine-based Linux infrastructures.

https://blog.travis-ci.com/2018-11-19-required-linux-infrastructure-migration
https://blog.travis-ci.com/2018-10-04-combining-linux-infrastructures

Now Container-based environment is duplicated.

[Build Environment Overview - Travis CI](https://docs.travis-ci.com/user/reference/overview/#deprecated-virtualization-environments)

> If you currently specify sudo: false in your .travis.yml, we recommend removing that configuration soon.

quoted by
https://blog.travis-ci.com/2018-11-19-required-linux-infrastructure-migration


## Description
It's not possible to test endpoints that use `gin.Context.Stream` using `httptest.ResponseRecorder`. Here is a minimal reproducer:
```
package main

import (
	"github.com/gin-gonic/gin"
	"io"
	"net/http"
	"net/http/httptest"
	"testing"
)

func TestRecorder(t *testing.T) {
	router := gin.Default()
	router.GET("/stream", func(c *gin.Context) {
		c.Status(200)
		c.Stream(func(w io.Writer) bool {
			w.Write([]byte("Hello"))
			return false
		})
	})

	req, _ := http.NewRequest("GET", "/stream", nil)
	w := httptest.NewRecorder()
	router.ServeHTTP(w, req)
	if w.Body.String() != "Hello" {
		t.Fail()
	}
}
```
The stack trace:
```
interface conversion: *httptest.ResponseRecorder is not http.CloseNotifier: missing method CloseNotify
/usr/local/go/src/runtime/panic.go:513 (0x102d528)
	gopanic: reflectcall(nil, unsafe.Pointer(d.fn), deferArgs(d), uint32(d.siz), uint32(d.siz))
/usr/local/go/src/runtime/iface.go:85 (0x100a826)
	getitab: panic(&TypeAssertionError{concrete: typ, asserted: &inter.typ, missingMethod: m.init()})
/usr/local/go/src/runtime/iface.go:522 (0x100ba57)
	assertI2I: r.tab = getitab(inter, tab._type, false)
/[snip]/vendor/github.com/gin-gonic/gin/response_writer.go:108 (0x15572a2)
	(*responseWriter).CloseNotify: return w.ResponseWriter.(http.CloseNotifier).CloseNotify()
/[snip]/vendor/github.com/gin-gonic/gin/context.go:903 (0x154fbb1)
	(*Context).Stream: clientGone := w.CloseNotify()
/[snip]/bug_test.go:15 (0x156173d)
	TestRecorder.func1: c.Stream(func(w io.Writer) bool {
/[snip]/vendor/github.com/gin-gonic/gin/context.go:124 (0x154b549)
	(*Context).Next: c.handlers[c.index](c)
/[snip]/vendor/github.com/gin-gonic/gin/recovery.go:76 (0x155e439)
	RecoveryWithWriter.func1: c.Next()
/[snip]/vendor/github.com/gin-gonic/gin/context.go:124 (0x154b549)
	(*Context).Next: c.handlers[c.index](c)
/[snip]/vendor/github.com/gin-gonic/gin/logger.go:225 (0x155d790)
	LoggerWithConfig.func1: c.Next()
/[snip]/vendor/github.com/gin-gonic/gin/context.go:124 (0x154b549)
	(*Context).Next: c.handlers[c.index](c)
/[snip]/vendor/github.com/gin-gonic/gin/gin.go:388 (0x1554bca)
	(*Engine).handleHTTPRequest: c.Next()
/[snip]/vendor/github.com/gin-gonic/gin/gin.go:351 (0x1554411)
	(*Engine).ServeHTTP: engine.handleHTTPRequest(c)
/[snip]/bug_test.go:23 (0x1561561)
	TestRecorder: router.ServeHTTP(w, req)
/usr/local/go/src/testing/testing.go:827 (0x10f1fbe)
	tRunner: fn(t)
/usr/local/go/src/runtime/asm_amd64.s:1333 (0x105cf30)
	goexit: BYTE	$0x90	// NOP
```
My current workaround is to extend `httptest.ResponseRecorder` with the missing methods:
```
type GinResponseRecorder struct {
	http.ResponseWriter
}

func (GinResponseRecorder) CloseNotify() <-chan bool {
	return nil
}

func (GinResponseRecorder) Flush() {
}

...

router.ServeHTTP(GinResponseRecorder{w}, req)
```

I'm using gin revision 05b5c3ba7495fb3cd737cad8b35e62e0862ed1c2 and go version go1.11.2 darwin/amd64 on macOS Mojave 10.14.3.
Minor text update. :)
- go version: go version go1.11.4 darwin/amd64
- gin version (or commit ref): 1.3.0
- operating system: Mac OS 10.13.6

## Description

```
	auth := new(controller.AuthController)
	authGroup := router.Group("/api/auth")
	{
		authGroup.POST("/login", auth.Login)
	}
```

Visit the url:  `http://localhost:4200/api/auth/login` , I get success。
Visit the url:  `http://localhost:4200//api/auth/login` ，it's return `404`.

How should I code this route? 

Thanks in advance for your time.

SSIA

>go mod download
go: cloud.google.com/go@v0.26.0: unrecognized import path "cloud.google.com/go" (https fetch: Get https://cloud.google.com/go?go-get=1: dial tcp 172.217.27.142:443: i/o timeout)
go: error loading module requirements

- go version:1.11.4
- operating system:windows




handle Body will return EOF when it used in middleware.

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


handle Body will return EOF when it used in middleware.

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


I want to be able to create dynamic routes within my gin application. Every so often, existing routes will be removed and new ones created (without restarting the application). Is this possible currently?

I know if i do like this,it will works

```
func public(r *gin.Engine) {
	r.GET("/index", sth)
	r.GET("/index.html", sth)
        r.GET("/index.json", sth)
        r.GET("/index.xml", sth)
}
```
But it's not cool,right?  And if there are many routes in my project,this'll be a complete mess...

In short words,just want handel .html .json .xml match with the original route path .
Does gin support this?

ps:don't want use a DIY function  to fix the problem,for example:

```
func GenPath(r *gin.Engine,path string)  {
	r.GET(path, sth)
	r.GET(path + ".html", sth)
	r.GET(path + ".json", sth)
	r.GET(path + ".xml", sth)
}
```


because it will make too many route handel any way...

Fix: https://github.com/gin-gonic/gin/issues/1804

`allNoRoute` contains middlewares such as `gin.Logger`, `gin.Recovery`, so on.  The correct code is to use `noRoute`.

cc: @MetalBreaker
- go version: 1.11.4
- gin version (or commit ref): master
- operating system: OSX, 10.13.6

## Description
I am receiving two log lines from a 404, even when using the default engine.

If I remove the router.StaticFS I no longer see the issue.

Code example:
```
func main() {
	router := gin.Default()
	router.StaticFS("/", http.Dir("/public"))
	router.Run(":1756")
}
```
## Screenshots
![Screen Shot 2019-03-09 at 12 07 48 PM](https://user-images.githubusercontent.com/1168391/54074746-2798d100-4264-11e9-857c-290a5d9aec44.png)


It makes possible to correctly cancel handlers when request cancelled (connection closed, etc.)
Try to extract value from request context when it was not found in gin context

It is strange behavior that `DisableConsoleColor` turns the `IsTerm` flag false.

This PR contains the following changes.
 - `IsTerm` represents whether is the output destination console.
 - Default logger distinguishes color by using new method `IsOutputColor`.
 - If `ForceConsoleColor` and `DisableConsoleColor` are called together, Later one is valid.

**Note**
This change breaks backward compability, but `LogFormatterParams` and `ForceConsoleColor` is not released yet. This change affects only the user which is using master branch.
SSIA



- go version: 1.10.2
- gin version (or commit ref): v1.4.0-dev
- operating system: mac os High Sierra

## Description
CORS issue when Basic Auth is enabled on a group
Added two routes,
1. /api/v1/application -- No Basic Auth -- WORKS
2. /api/v2/application --Basic Auth ENABLED -- CORS ISSUE

**Error Message On Client:**
Access to XMLHttpRequest at 'http://localhost:8080/api/v2/application' from origin 'http://localhost:3000' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.

## Screenshots
![image](https://user-images.githubusercontent.com/36086704/53984087-39506c00-40de-11e9-838f-cfad08f8a69f.png)

## Code Attached
[main.txt](https://github.com/gin-gonic/gin/files/2943009/main.txt)

## CODE
```
package main

import (
	"fmt"

	"github.com/gin-gonic/gin"
)

func main() {
	r := gin.Default()

	r.Use(CORSMiddleware())

	v1 := r.Group("/api/v1/")
	{
		v1.GET("/application", resp1)
	}

	authorized := r.Group("/api/v2/", gin.BasicAuth(gin.Accounts{
		"Admin": "Admin",
	}))

	v2 := authorized.Group("/application")
	{
		v2.GET("/", resp)
	}

	r.Run() // listen and serve on 0.0.0.0:8080
}

func resp(c *gin.Context) {

	c.JSON(200, gin.H{
		"message": "pong",
	})
}

func resp1(c *gin.Context) {

	if c.Request.Method == "OPTIONS" {
		fmt.Println("OPTIONS")
		c.AbortWithStatus(200)
	} else {
		c.Next()
	}

	fmt.Println(c.Request.Method)

	c.JSON(200, gin.H{
		"message": "pong",
	})
}

func CORSMiddleware() gin.HandlerFunc {
	return func(c *gin.Context) {
		c.Writer.Header().Set("Access-Control-Allow-Origin", "http://localhost:3000")
		c.Writer.Header().Set("Access-Control-Max-Age", "86400")
		c.Writer.Header().Set("Access-Control-Allow-Methods", "POST, GET, OPTIONS, PUT, DELETE, UPDATE")
		c.Writer.Header().Set("Access-Control-Allow-Headers", "Access-Control-Allow-Origin, Origin, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization")
		c.Writer.Header().Set("Access-Control-Expose-Headers", "Content-Length")
		c.Writer.Header().Set("Access-Control-Allow-Credentials", "true")

		fmt.Println(c.Request.Method)

		if c.Request.Method == "OPTIONS" {
			fmt.Println("OPTIONS")
			c.AbortWithStatus(200)
		} else {
			c.Next()
		}
	}
}
```


Say I have the following application 

```go
func main() {
	auth := authority.Create(authConfig)

	r := gin.Default()
	r.GET("/ping", handler.PingGet)

	base := r.Group(baseURL)

	oauth := base.Group("/oauth")
	oauth.GET("/login", handler.LoginGet(oAuthConfig))
	oauth.GET("/callback", handler.CallbackGet(oAuthConfig))

	api := base.Group("/api")
	api.Use(auth.TokenMiddleware())
	api.GET("/whoami", handler.WhoAmIGet)
	api.GET("/overview", handler.OverviewGet())

	r.NoRoute(handler.SPAGet(publicFolder, baseURL))
	r.Run("0.0.0.0:5000")
}
```

By default `gin.Default()` will print a log for all routes.
I'd like to ignore `/ping` and everything on `/oauth`

Can I configure the default router to do that, or must I build my own?


```
var s struct {
	Nums [2]int `form:"nums"`
}
req := formPostRequest("", "nums=3&nums=8")
Form.Bind(req, &s)
```
- spell check
- variable should be little camel-case
- variable path collides with imported package name,avoid to use it


This fixes a URL to the starter template in https://github.com/gin-gonic/gin/blob/master/README.md#use-a-vendor-tool-like-govendor
```
var s struct {
    Timeout time.Duration `form:"timeout"`
}
req := formPostRequest("", "timeout=5s")
Form.Bind(req, &s)
```
We have had gin website and examples repo, so we should update gin README.md.

- [x] sync `README.md` commit log to gin/examples repo (please see https://github.com/gin-gonic/website/graphs/contributors)

- [x] update gin website documentation (English version) according new gin README.md (please see https://github.com/gin-gonic/website/pull/49)

- [x] update gin website address on gin repo description

- [x] update gin website address on gin-gonic org (https://github.com/gin-gonic)

- [x] add gin website address on gin-contrib org (https://github.com/gin-contrib)

@javierprovecho the last thres TODO need you help, thanks!


Remove the link that doesn't use gin anymore. See the https://github.com/drone/drone/blob/20c19bc522abacc6072c566b6a4bd7cc3d19c2a6/go.mod#L29-L30
After https://github.com/gin-gonic/gin/pull/1776, all examples link in README.md are dead

- go version: 1.12
- gin version (or commit ref): 1.3.0
- operating system: macOS 10.14.3

## Description

Why is this output every time I start a gin server?

```text
[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.
```

I'm not doing anything explicitly with those middleware, so it must be part of what gin does by default.
the post doc move https://gin-gonic.com/blog/
Fix test errors on go master branch. #1784
go version: master branch

gin version: master branch

unit test error info:
```
=== RUN   TestContextError
--- FAIL: TestContextError (0.00s)
    context_test.go:1269: 
        	Error Trace:	context_test.go:1269
        	Error:      	Not equal: 
        	            	expected: &errors.errorString{s:"first error", frame:errors.Frame{frames:[3]uintptr{0x4671b3, 0x9e6cfc, 0x4fddf0}}}
        	            	actual  : &errors.errorString{s:"first error", frame:errors.Frame{frames:[3]uintptr{0x4671b3, 0x9e69f9, 0x4fddf0}}}
        	            	
        	            	Diff:
        	Test:       	TestContextError
    context_test.go:1273: 
        	Error Trace:	context_test.go:1273
        	Error:      	Not equal: 
        	            	expected: &errors.errorString{s:"second error", frame:errors.Frame{frames:[3]uintptr{0x4671b3, 0x9e6e69, 0x4fddf0}}}
        	            	actual  : &errors.errorString{s:"second error", frame:errors.Frame{frames:[3]uintptr{0x4671b3, 0x9e6bac, 0x4fddf0}}}
        	            	
        	            	Diff:
        	Test:       	TestContextError
```
i wrote microservice for key value storing, after every request ram usage increasing whats is the problem ?



Ref: #1381 

Because all gin middleware build failed now at go1.6 branch, error info:
```
# golang.org/x/sys/unix
../../../golang.org/x/sys/unix/ioctl.go:18: undefined: runtime.KeepAlive
../../../golang.org/x/sys/unix/ioctl.go:28: undefined: runtime.KeepAlive
../../../golang.org/x/sys/unix/syscall_linux.go:86: undefined: runtime.KeepAlive
```

details: https://travis-ci.org/gin-contrib/gzip/jobs/498504557

As https://github.com/golang/go/issues/26576 said, it only support go1.7.

so, I will remove go1.6/go1.7 now. do you think? @appleboy 
Can gin set max qps?
I think gin use one conection one gorutine ,can I set max connection that gin accecpted ?
Also ,I notice the exapmle https://github.com/gin-gonic/gin/blob/master/examples/graceful-shutdown/close/server.go
what's the deference between close and shutdown 
the code in the repo example use close(),it's not shutdown right?

This makes the context available in LogFormatterParams and therefore allows access to context variables as part of the log output formatting.

```
func lastChar(str string) uint8 {
	if str == "" {
		panic("The length of the string can't be 0")
	}
	return str[len(str)-1]
}

func joinPaths(absolutePath, relativePath string) string {
	if relativePath == "" {
		return absolutePath
	}

	finalPath := path.Join(absolutePath, relativePath)
	appendSlash := lastChar(relativePath) == '/' && lastChar(finalPath) != '/'
	if appendSlash {
		return finalPath + "/"
	}
	return finalPath
}
```

the condition of the code ```appendSlash := lastChar(relativePath) == '/' && lastChar(finalPath) != '/'```, may be never exec it 
ref: #1775 

- [x] merge or close all pull request about `examples/*`

- [x] remove `embedmd` from `README.md` and `.travis.yml`

- [x] remove `examples/*`

- [x] add `README.md` at `examples` dir

- [x] add `gin-gonic/examples` repo and move `examples`

- [x] sync git log
For making the `gin` repo simple and reducing dependencies, I suggest we create one repo `gin-gonic/examples` saves example code.

cc @javierprovecho @appleboy 

thanks!
before:
```
# github.com/gin-gonic/gin
/tmp/go-build038919107/github.com/gin-gonic/gin/_test/_obj_test/context.go:719:11: unknown field 'SameSite' in struct literal of type http.Cookie
FAIL	github.com/gin-gonic/gin [build failed]
The command "make test" exited with 0.
```

And
```
# github.com/gin-gonic/gin/render
package github.com/gin-gonic/gin/render (test)
	imports github.com/stretchr/testify/assert
	imports github.com/pmezard/go-difflib/difflib: cannot find package "github.com/pmezard/go-difflib/difflib" in any of:
	/home/travis/gopath/src/github.com/gin-gonic/gin/vendor/github.com/pmezard/go-difflib/difflib (vendor tree)
	/home/travis/.gimme/versions/go1.8.7.linux.amd64/src/github.com/pmezard/go-difflib/difflib (from $GOROOT)
	/home/travis/gopath/src/github.com/pmezard/go-difflib/difflib (from $GOPATH)
FAIL	github.com/gin-gonic/gin/render [setup failed]
```
when test case failed, it should return `1` not `0`.

For example #1615 


 context add RelativePath
I want to do like bellow nginx conf with gin, so how to do? thanks somebody can help me.

```
location / {
    try_files $uri $uri/ /index.html;
  }
```

Fix https://github.com/gin-gonic/gin/issues/1768


I found a strange behaviour but maybe it is intended:

I have middleware A and B and C which are chained.
In middleware A all panics are cought with a defer. It calls Next() on the gin.Context
Middleware B throws a panic and thus does not call Next().

What I expect: Middleware C is not called. But actually it is called indeed. Is this supposed to be like this and why?

This is middleware A:
```
...
defer func() {
	if rc := recover(); rc != nil {
		l.WithField("recover", rc).Error("Panic occured")
		c.JSON(http.StatusInternalServerError, "Internal error")
	}
}()
c.Next()
...
```
How can I generate an HTML template to a string and modify it before it's sent to the user?
## Description
I want to customize the logger format, by using below code:
``` go
	e := gin.New()
	e.Use(gin.LoggerWithConfig(config))
```

the config is like this:
![image](https://user-images.githubusercontent.com/1725060/52522323-a975f880-2cbe-11e9-89ae-63fab2b08b94.png)

The red functions & variable above is private, so I have to redundant define them to my package, they should be public.


- go version: go version go1.11.2 linux/amd64
- gin version (or commit ref): Commit #5acf660 
- operating system: Ubuntu 16.04LTS

## Description
I am trying to generate code coverage reports for a gin server using sample application. 
sample.go
```
package main

import (
        "github.com/gin-gonic/gin"
)

func main() {
        r := gin.Default()
        r.GET("/ep1", getEp1)
        r.GET("/ep2", getEp2)
        //r.Run()
}

func getEp1(c *gin.Context) {
}

func getEp2(c *gin.Context) {
}
```
This is my test file: sample_test.go
```
package main

import (
        "fmt"
        "testing"
)

func TestRunMain(t *testing.T) {
        fmt.Println("TestRunMain ...")
        main()
}
```
Command to generate code coverage: 

> $ go test -covermode=count -coverpkg ./... -test.coverprofile cover.cov
> TestRunMain ...
> [GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.
> 
> [GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
>  - using env:   export GIN_MODE=release
>  - using code:  gin.SetMode(gin.ReleaseMode)
> 
> [GIN-debug] GET    /ep1                      --> _/home/ubuntu/tmp/sample.getEp1 (3 handlers)
> [GIN-debug] GET    /ep2                      --> _/home/ubuntu/tmp/sample.getEp2 (3 handlers)
> PASS
> coverage: 100.0% of statements in ./...
> ok      _/home/ubuntu/tmp/sample        0.013s

Here is the content of cover.cov file:

> mode: count
> /home/ubuntu/tmp/sample/sample.go:7.13,12.2 3 1
> /home/ubuntu/tmp/sample/sample.go:14.30,15.2 0 0
> /home/ubuntu/tmp/sample/sample.go:17.30,18.2 0 0
> 

Everything good so far! But as you can see I am not running the server yet. In file: sample.go, when I uncomment the line  r.Gin(), server runs. To exit the application I need to perform Ctrl+C. In this case, there are no code coverage reports generated. **What  am I missing?**

Command line output with r.Gin() uncommented in sample.go:

> $ go test -covermode=count -coverpkg ./... -test.coverprofile cover.cov
> TestRunMain ...
> [GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.
> 
> [GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
>  - using env:   export GIN_MODE=release
>  - using code:  gin.SetMode(gin.ReleaseMode)
> 
> [GIN-debug] GET    /ep1                      --> _/home/ubuntu/tmp/sample.getEp1 (3 handlers)
> [GIN-debug] GET    /ep2                      --> _/home/ubuntu/tmp/sample.getEp2 (3 handlers)
> [GIN-debug] Environment variable PORT is undefined. Using port :8080 by default
> [GIN-debug] Listening and serving HTTP on :8080
> ^Csignal: interrupt
> FAIL    _/home/ubuntu/tmp/sample        0.711s
> 

Content of cover.go:

> $ cat cover.cov
> mode: count
> 


Can anyone please tell me what I am missing here?

Can someone explain - why on `Copy()` method we are set `null` value to `cp.writermem.ResponseWriter`?

https://github.com/gin-gonic/gin/blob/5acf6601170bb49a1958c055d66d54ba152dc34b/context.go#L79-L86

Without that we can call `Stream()` method on copy of Context.
Fix #1763 
There are many tests write debug info to `os.Stderr`. And after that is hard to inspect failed tests.
Now I see only logs of failed tests.
Fix #1760

We need to restore `c.index` value after recursive handle an another path.
- go version: 1.10
- gin version (or commit ref): 1.3.0
- operating system:debian

## Description

Hi, I get the following crash if I use a copied context (inside a goroutine) and I try to start a .Stream command:

> panic: interface conversion: interface is nil, not http.CloseNotifier
> 
> goroutine 63 [running]:
> github.com/gin-gonic/gin.(*responseWriter).CloseNotify(0xc0000ccbb0, 0x100010000)
> 	/home/pippus/gocode/pkg/mod/github.com/gin-gonic/gin@v1.3.0/response_writer.go:108 +0x43
> github.com/gin-gonic/gin.(*Context).Stream(0xc0000ccbb0, 0xc000144fa0)
> 	/home/pippus/gocode/pkg/mod/github.com/gin-gonic/gin@v1.3.0/context.go:823 +0x42

It looks like this is because the Copy function nullifies the ResponseWriter used by the stream.

How should this work? It is possible to use context.Stream inside a goroutine?

Thanks in advance for your time.

Is here a way to enable `ChaCha20-Poly1305` for ssl with gin?

Right now, by default it uses `AES_128_GCM`
Sometimes travis-ci tests fails like this https://travis-ci.org/gin-gonic/gin/jobs/488105097
It happens when `TestConcurrentHandleContext` freezes - client don't have timeout and request waiting unlimited.
If test it without net layout (without start server), just by testing of handler - we can avoid this problem.
Here is my server code 
```
package main

import (
  "fmt"
  "github.com/gin-gonic/gin"
  "strconv"
)

func main() {
  r := gin.Default()

  r.GET("/calc/:value", func(c *gin.Context) {
    var response string

    if v, exists := c.Params.Get("value"); exists {
      value, er := strconv.Atoi(v)
      if er != nil || value < 0 {
        response = "Unexpected value"
      } else if(value == 0) {
        response = "Done"
      } else {
        response = strconv.Itoa(value - 1)
        c.Request.URL.Path = "/calc/" + response
        c.JSON(200, gin.H{
          "message": response,
        })
        r.HandleContext(c)
        return
      }
    }

    c.JSON(200, gin.H{
      "message": response,
    })
  })

  if er := r.Run("0.0.0.0:8080"); er != nil {
    fmt.Printf("Error occured on start server. Error: %v\n", er)
  }
}
```

If I exec the query like `curl -X GET 'http://localhost:8080/calc/30 -L` all works as expected.
But, if I run `curl -X GET 'http://localhost:8080/calc/45' -L` I get errors in server log like that 

```
GIN] 2019/02/03 - 20:42:14 | 500 |    3.182878ms |       127.0.0.1 | GET      /calc/43
[GIN] 2019/02/03 - 20:42:14 | 500 |    3.191694ms |       127.0.0.1 | GET      /calc/44
2019/02/03 20:42:14 [Recovery] 2019/02/03 - 20:42:14 panic recovered:
[GIN] 2019/02/03 - 20:42:14 | 500 |    3.233546ms |       127.0.0.1 | GET      /calc/45
GET /calc/45 HTTP/1.1
Host: localhost:8080
Accept: */*
User-Agent: curl/7.54.0


runtime error: index out of range
/usr/local/Cellar/go/1.11.2/libexec/src/runtime/panic.go:513 (0x102bcd8)
	gopanic: reflectcall(nil, unsafe.Pointer(d.fn), deferArgs(d), uint32(d.siz), uint32(d.siz))
/usr/local/Cellar/go/1.11.2/libexec/src/runtime/panic.go:44 (0x102ab19)
	panicindex: panic(indexError)
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/context.go:109 (0x154eab1)
	(*Context).Next: c.handlers[c.index](c)
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/gin.go:383 (0x1557fba)
	(*Engine).handleHTTPRequest: c.Next()
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/gin.go:359 (0x15579a3)
	(*Engine).HandleContext: engine.handleHTTPRequest(c)
/Users/vladimir.dumanovskiy/go/src/github.com/voltento/linkShorter/main.go:32 (0x156390a)
	main.func2: c.JSON(200, gin.H{
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/context.go:109 (0x154ea79)
	(*Context).Next: c.handlers[c.index](c)
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/recovery.go:76 (0x1561379)
	RecoveryWithWriter.func1: c.Next()
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/context.go:109 (0x154ea79)
	(*Context).Next: c.handlers[c.index](c)
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/logger.go:170 (0x1560700)
	LoggerWithConfig.func1: c.Next()
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/context.go:109 (0x154ea79)
	(*Context).Next: c.handlers[c.index](c)
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/gin.go:383 (0x1557fba)
	(*Engine).handleHTTPRequest: c.Next()
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/gin.go:359 (0x15579a3)
	(*Engine).HandleContext: engine.handleHTTPRequest(c)
/Users/vladimir.dumanovskiy/go/src/github.com/voltento/linkShorter/main.go:32 (0x156390a)
	main.func2: c.JSON(200, gin.H{
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/context.go:109 (0x154ea79)
	(*Context).Next: c.handlers[c.index](c)
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/recovery.go:76 (0x1561379)
	RecoveryWithWriter.func1: c.Next()
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/context.go:109 (0x154ea79)
	(*Context).Next: c.handlers[c.index](c)
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/logger.go:170 (0x1560700)
	LoggerWithConfig.func1: c.Next()
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/context.go:109 (0x154ea79)
	(*Context).Next: c.handlers[c.index](c)
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/gin.go:383 (0x1557fba)
	(*Engine).handleHTTPRequest: c.Next()
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/gin.go:359 (0x15579a3)
	(*Engine).HandleContext: engine.handleHTTPRequest(c)
/Users/vladimir.dumanovskiy/go/src/github.com/voltento/linkShorter/main.go:32 (0x156390a)
	main.func2: c.JSON(200, gin.H{
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/context.go:109 (0x154ea79)
	(*Context).Next: c.handlers[c.index](c)
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/recovery.go:76 (0x1561379)
	RecoveryWithWriter.func1: c.Next()
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/context.go:109 (0x154ea79)
	(*Context).Next: c.handlers[c.index](c)
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/logger.go:170 (0x1560700)
	LoggerWithConfig.func1: c.Next()
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/context.go:109 (0x154ea79)
	(*Context).Next: c.handlers[c.index](c)
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/gin.go:383 (0x1557fba)
	(*Engine).handleHTTPRequest: c.Next()
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/gin.go:359 (0x15579a3)
	(*Engine).HandleContext: engine.handleHTTPRequest(c)
/Users/vladimir.dumanovskiy/go/src/github.com/voltento/linkShorter/main.go:32 (0x156390a)
	main.func2: c.JSON(200, gin.H{
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/context.go:109 (0x154ea79)
	(*Context).Next: c.handlers[c.index](c)
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/recovery.go:76 (0x1561379)
	RecoveryWithWriter.func1: c.Next()
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/context.go:109 (0x154ea79)
	(*Context).Next: c.handlers[c.index](c)
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/logger.go:170 (0x1560700)
	LoggerWithConfig.func1: c.Next()
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/context.go:109 (0x154ea79)
	(*Context).Next: c.handlers[c.index](c)
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/gin.go:383 (0x1557fba)
	(*Engine).handleHTTPRequest: c.Next()
/Users/vladimir.dumanovskiy/go/src/github.com/gin-gonic/gin/gin.go:349 (0x1557811)
	(*Engine).ServeHTTP: engine.handleHTTPRequest(c)
/usr/local/Cellar/go/1.11.2/libexec/src/net/http/server.go:2741 (0x127fefa)
	serverHandler.ServeHTTP: handler.ServeHTTP(rw, req)
/usr/local/Cellar/go/1.11.2/libexec/src/net/http/server.go:1847 (0x127c155)
	(*conn).serve: serverHandler{c.server}.ServeHTTP(w, w.req)
/usr/local/Cellar/go/1.11.2/libexec/src/runtime/asm_amd64.s:1333 (0x1058e10)
	goexit: BYTE	$0x90	// NOP

```

Could you help me with that, is that bug or I do something wrong.

- go version:1.11
- gin version (or commit ref): master

## Description

Hello,

I want to get the relativePath of the request in the request middleware to make some judgments. What should I do?
```

router.User(middlerWare)
router.POST("/hi/:name", func(c *gin.Context) {
       	c.JSON(200,"")
})

func middlerWare(c *gin.Context){
	fmt.Println(c.Request.URL.Path)
}
```

curl -get 127.0.0.1/hi/gin
I want it print `/hi/:name` not `/hi/gin`


- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:
- gin version (or commit ref):
- operating system:

## Description

## Screenshots


 branch = "master"
  digest = "1:6375f542808927c64c4938b160697a53b597f3db29cd0cf7faa576b8dd251155"
  name = "github.com/gin-gonic/gin"
  revision = "500ebd9ea866c57427aeaddc31f374adedd4084b"

go version:
1.11.4

I cannot seem to find any way to pull the same response time that gin outputs to stdout (in microseconds). I am talking about this (174.138µs)
![image](https://user-images.githubusercontent.com/23349818/51987856-c93a3f00-24bc-11e9-90b8-d18184ecf7af.png)
I am currently using this snnippet in middleware:
`		
start := time.Now() `
`c.Next()`
`end := time.Now().Sub(start)
`
But It does not match to whatever the gin prints to stdout.

I have searched both repo, google and package files through IDE tools but cannot find any built in way to do this.
Could you confirm that this feature does not exist? 
Or point me to the direction how could I calculate exactly the same or closely matching time? 

Can it be done without gin.Logger()  ?
I use custom logger and I just want latency value.
Thanks

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: go1.11.1
- gin version (or commit ref): v1.3.0
- operating system: x86_64 GNU/Linux  4.8.0-36-generic

## Description
I user router llike this:
```
session := v2.Group("/sessions")
{
	session.POST("", controllers.Login)
	session.DELETE("/:user_id", controllers.Logout)
	session.POST("/signup", controllers.SignUp)
	session.POST("/forgot_password", controllers.PassBack)
	session.POST("/:user_id/scan", controllers.ScanLogin)
}
```
but error returns on logs, the methods of sessions/:user_id & sessions/:user_id/scan are deferrent actrauly.
```
[GIN-debug] POST   /api/v2/sessions          --> app/cmd/http/controllers.Login (4 handlers)
[GIN-debug] DELETE /api/v2/sessions/:user_id --> app/cmd/http/controllers.Logout (4 handlers)
[GIN-debug] POST   /api/v2/sessions/signup   --> app/cmd/http/controllers.SignUp (4 handlers)
[GIN-debug] POST   /api/v2/sessions/forgot_password --> 
![selection_050](https://user-images.githubusercontent.com/36183188/51963956-0c39e980-24a0-11e9-8761-a1a160d53b7a.png)
app/cmd/http/controllers.PassBack (4 handlers)
[GIN-debug] POST   /api/v2/sessions/:user_id/scan --> app/cmd/http/controllers.ScanLogin (4 handlers)
panic: wildcard route ':user_id' conflicts with existing children in path '/api/v2/sessions/:user_id/scan'
```
How can i fix this?? Thank you very much.
## Screenshots


- go version:
- gin version (or commit ref):
~1.3.0
- operating system:
Windows 10 / amd64
## Description
* In `POST` method, `func (c *Context) PostForm(key string) string` can recognize both application/x-www-form-urlencoded data and form data payload
* However, in `DELETE` method, `func (c *Context) PostForm(key string) string` can only recognize form data payload (rather than application/x-www-form-urlencoded data)
* This also appears in `DefaultPostForm` function
* Is it a flaw or just intended to be so?

Thank you.
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: 1.11.4
- gin version (or commit ref): `d27685e714cb0b9375e0c9d3ca3df5a6a4945a6c`
- operating system: Ubuntu 18.04

## Description
I'm currently using `gin.WrapF` to wrap and serve a custom http handler func in order to integrate with the Stripe payment system.

[here](https://github.com/RTradeLtd/Temporal/blob/398edf367ec81fc84cc92a02a158ceb63bed24e3/api/v2/routes_payment.go#L316-L356) is where I declare the functions

[here](https://github.com/RTradeLtd/Temporal/blob/398edf367ec81fc84cc92a02a158ceb63bed24e3/api/v2/api.go#L463-L464) is where I wrap and allow usage of the calls with my gin api. I'm using the `gin-jwt` middleware in order to perform authentication. 

I then have [this](https://github.com/RTradeLtd/Temporal/blob/398edf367ec81fc84cc92a02a158ceb63bed24e3/api/v2/context.go#L50-L65) helper function used to extract the username from the associated JWT. The part I'm unsure about, is how to use this function, within my custom http handler funcs in order to extract the username from these calls.
- go version: 1.10.3
- gin version (or commit ref): 1.3.0
- operating system: macOS 10.14.2

## Description
API request
Content-type: application/octet-stream
Method: POST
Body: image binary stream
Route: /name

## Error
It will call 307 http code when someone request '/name/'. It turn to Get method.
I try this https://github.com/gin-gonic/gin/blob/master/gin.go#L58-L63
But not work.
Is there a bug in this situation?


Here is a change to make the response body size an available log formatter param.
#1604 #1566 #1700 #1737 

because some dependencies only are used on example i.e. grpc.

Or migrate `examples` to gin-gonic/examples`?
- go version: 1.11.4
- gin version (or commit ref): github.com/gin-gonic/gin v1.3.0
- operating system: MacOS

```
auth := gin.Accounts{"admin": constants.Env.AdminPassword}
base := r.Group("/service-base")
api := base.Group("/api")
admin := api.Group("/admin")

admin.Use(gin.BasicAuth(auth))

api.GET("/ping", PingGet)
admin.GET("/admin", AdminGet)

r.Run(constants.Env.HTTPHost)
```

when visiting `/admin` I am not prompted for authentication. However I am when using
admin.GET("/admin",  gin.BasicAuth(auth), AdminGet)

edit: title was a bit harsh
https://github.com/gin-gonic/gin#using-basicauth-middleware

edit: Solved it, was a stupid mistake
* fix #1672 correct work with ptr - not create value if field is not set
* avoid allocations on strings.Split() - change to strings.Index()
* fix #610 tag value "-" is mean ignoring field
* struct fields mapped like json.Unmarshal
* map fields mapped like json.Unmarshal

Run benchmark: 
`go test -run=NONE -benchmem -bench=BenchmarkMapForm ./binding -benchtime=20s > new.bench`

Compare `benchcmp old.bench new.bench`:
```
benchmark                  old ns/op     new ns/op     delta
BenchmarkMapFormFull-4     2706          2476          -8.50%
BenchmarkMapFormName-4     271           228           -15.87%

benchmark                  old allocs     new allocs     delta
BenchmarkMapFormFull-4     22             12             -45.45%
BenchmarkMapFormName-4     3              1              -66.67%

benchmark                  old bytes     new bytes     delta
BenchmarkMapFormFull-4     384           200           -47.92%
BenchmarkMapFormName-4     40            8             -80.00%
```
- With issues:
  - I  test  mixphp ，nginx , gin for a simple api test , find the qps of gin is lowest , following is my test information and result, some one can tell me is my test wrong or  how can i  modify ?

- go version:  go1.11.2 linux/amd64
- gin version (or commit ref): v1.3.0 ( b869fe14 )
- operating system: compile system ubuntu-16.04  and  run system ubuntu-14.04
## Description
     I  use ab test the qps for gin ,and also test nginx and php, only test a simple api, 
    test command ：
        ab -n 1000000 -c 1000 http://52.1.47.196:8080/test


##Result Screenshots:
![mixphp-qps](https://user-images.githubusercontent.com/26518131/51449477-291b4200-1d67-11e9-9908-f072a971f71d.png)
![nginx-qps](https://user-images.githubusercontent.com/26518131/51449480-30425000-1d67-11e9-9ff8-ce9f7a1d0950.png)
  
  cpu use:
     mixphp 100% cpu use
     nginx 45%-55% cpu use
     gin  5%-30%  cpu use
 
My question:
   if  my test way is wrong ? I  think this not the golang language performance, I want someone can help me ,thanks
  if also find  In the process of testing, it starts very fast and then looks slower and slower



   


Fix the bug of issue https://github.com/gin-gonic/gin/issues/1746.

PR https://github.com/gin-gonic/gin/pull/1677 caused it.
I was working on an app that doesn't lock in its dependencies and noticed something after 1.3.0 release is causing the default logger to print query params like the following:

```
[GIN] 2019/01/17 - 07:59:20 | 200 |    2.594888ms |    69.420.69.420 | POST     /api/someRoute/otherRoute?thing=Borat%!A(MISSING)zumat&otherThing=Pamel%!a(MISSING)4&blah=true&id=69
```

I saw that there are some changes going on with query params-- it seems like the %20 stuff in the URL needs to be escaped so GO doesnt think these are string formatting parameters.
If gin sometimes reset `Context.index` and `.handlers` then needs to recheck len of handlers every iteration on func `Context.Next()`:
https://github.com/gin-gonic/gin/blob/29a145c85dc0fafc3dd0ada62d856c4d95240010/context.go#L103-L111

---
Fix #1678, because gin change `c.handlers` when error on open file.
https://github.com/gin-gonic/gin/blob/29a145c85dc0fafc3dd0ada62d856c4d95240010/routergroup.go#L195-L202

---
Fix #1744, because gin reset `c.handlers` slice on `HandleContext()` func.
https://github.com/gin-gonic/gin/blob/29a145c85dc0fafc3dd0ada62d856c4d95240010/gin.go#L354-L360
https://github.com/gin-gonic/gin/blob/29a145c85dc0fafc3dd0ada62d856c4d95240010/context.go#L67-L75

  
- go version: go1.11.4
- gin version (or commit ref): 29a145c85dc0 (master)
- operating system: osx

## Description

When redirect to StaticFile endpoint is made, when called for first time, it panics (after successful redirect)

**router:**
```
router := gin.New()
	router.Use(gin.LoggerWithFormatter(config.GinJSONLogger))
	router.Use(gin.Recovery())
	router.GET("/", RedirectRootToAPI(router))

	v1 := router.Group("/v1")
	{
		v1.StaticFile("/", "./api/index.html")
	}

	return router
}

// RedirectRootToAPI redirects all calls from root endpoint to current API documentation endpoint
func RedirectRootToAPI(r *gin.Engine) gin.HandlerFunc {
	return func(c *gin.Context) {
		c.Request.URL.Path = "/v1"
		r.HandleContext(c)
	}
}
```

**customLogger** (just in case)
```
// GinJSONLogger is a custom function that satisfies gin Logger.
// It does not use any Marshaler or encoder to not sacrifice performance
func GinJSONLogger(param gin.LogFormatterParams) string {
	return fmt.Sprintf("{\"timestamp\": \"%s\",\"statusCode\": %d,\"latency\": %d,\"clientIP\": \"%s\",\"method\": \"%s\",\"path\": \"%s\",\"errorMessage\": \"%s\"}\n",
		param.TimeStamp.Format("2006/01/02 - 15:04:05"), param.StatusCode, param.Latency, param.ClientIP, param.Method, param.Path, param.ErrorMessage)
}
```

**panic:**
```
2019/01/16 11:15:47 [Recovery] 2019/01/16 - 11:15:47 panic recovered:
GET / HTTP/1.1
Host: localhost:8080
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
Accept-Encoding: gzip, deflate, br
Accept-Language: en,pl;q=0.9,en-US;q=0.8
Connection: keep-alive
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36


runtime error: index out of range
/usr/local/go/src/runtime/panic.go:513 (0x102bdd8)
	gopanic: reflectcall(nil, unsafe.Pointer(d.fn), deferArgs(d), uint32(d.siz), uint32(d.siz))
/usr/local/go/src/runtime/panic.go:44 (0x102ac19)
	panicindex: panic(indexError)
/Users/tomek/go/pkg/mod/github.com/gin-gonic/gin@v1.3.1-0.20190109013244-29a145c85dc0/context.go:109 (0x15f181f)
	(*Context).Next: c.handlers[c.index](c)
/Users/tomek/go/pkg/mod/github.com/gin-gonic/gin@v1.3.1-0.20190109013244-29a145c85dc0/recovery.go:76 (0x1603cb9)
	RecoveryWithWriter.func1: c.Next()
/Users/tomek/go/pkg/mod/github.com/gin-gonic/gin@v1.3.1-0.20190109013244-29a145c85dc0/context.go:109 (0x15f17e2)
	(*Context).Next: c.handlers[c.index](c)
/Users/tomek/go/pkg/mod/github.com/gin-gonic/gin@v1.3.1-0.20190109013244-29a145c85dc0/logger.go:170 (0x1603090)
	LoggerWithConfig.func1: c.Next()
/Users/tomek/go/pkg/mod/github.com/gin-gonic/gin@v1.3.1-0.20190109013244-29a145c85dc0/context.go:109 (0x15f17e2)
	(*Context).Next: c.handlers[c.index](c)
/Users/tomek/go/pkg/mod/github.com/gin-gonic/gin@v1.3.1-0.20190109013244-29a145c85dc0/gin.go:383 (0x15fa92a)
	(*Engine).handleHTTPRequest: c.Next()
/Users/tomek/go/pkg/mod/github.com/gin-gonic/gin@v1.3.1-0.20190109013244-29a145c85dc0/gin.go:349 (0x15fa181)
	(*Engine).ServeHTTP: engine.handleHTTPRequest(c)
/usr/local/go/src/net/http/server.go:2741 (0x12cd7fa)
	serverHandler.ServeHTTP: handler.ServeHTTP(rw, req)
/usr/local/go/src/net/http/server.go:1847 (0x12c9a45)
	(*conn).serve: serverHandler{c.server}.ServeHTTP(w, w.req)
/usr/local/go/src/runtime/asm_amd64.s:1333 (0x1059320)
	goexit: BYTE	$0x90	// NOP

[GIN-debug] [WARNING] Headers were already written. Wanted to override status code 301 with 500
```

# how to reproduce

1. start a new server with such redirect
2. call `/` path (`curl localhost:8080/`)
3. check stack trace

**note:** redirect is successful, as the panic happens after redirect

 


OS: Linux

For every small change, I had to restart the server.
- Kill the process
- Kill the occupied port `fuser -i -k 8080/tcp` (Closing the connection)
- Then `go run`

### Solution / Package
I node.js world this problem is solved using [nodemon](https://www.npmjs.com/package/nodemon).
Is there any similar package in go.

### I am pretty new to go, coming form node.js world :+1: 





- go version:
go1.11.4 darwin/amd64
- gin version (or commit ref):
1.3.0
- operating system:
macOS 10.13.1

## Description
Hi, I'm trying to handle all undefined routes with `NoRoute` func using the following code, but the response contains `404 page not found` at the beginning.
I'm not sure if it's the correct way to handle this.

```go
r.NoRoute(func(c *gin.Context) {
    c.HTML(404, "404.html", gin.H{})
})
```

The response is:
```html
404 page not found
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>404 page</title>
</head>
...
```

notice the first line, I think there is a handler before mine which writes that.


Hi there when i try to upload a large file (for example 17 ML)

I get this error in my browser (after hitting submit and file being uploaded at 17%)

```
dancegeek.net unexpectedly closed the connection.
Try:

Checking the connection
Checking the proxy and the firewall
ERR_CONNECTION_CLOSED
```

and on the router side I have no log that it even received a request POST.


while reading github issues, I tried using with and without these options:

``` 
router.MaxMultipartMemory = 640 << 20 
```


```
	s := &http.Server{
		Addr:           ":80",
		Handler:        router,
		ReadTimeout:    200 * time.Second,
		WriteTimeout:   20 * time.Second,
		MaxHeaderBytes: 640 << 20, // 640 MiB
	}
	s.ListenAndServe()
```

and regarldess of using those options I still see the same behavior.



here is my html code

```
    <form action="/user/upload" id="uploadform" method="post" enctype="multipart/form-data">
        Name: <input type="text" name="name"><br /><br />
        Type:
        <select name="dance_type" required="required">
            <option value="Salsa" selected>Salsa</option>
            <option value="Tango">Tango</option>
            <option value="Kurdish">Kurdish</option>
        </select><br /><br />
        File: <input type="file" id="file" class="filepond" name="file" required="required"><br>
            <input type="submit" value="Submit">
    </form>

```


and my upload handler go code is just like the example code

```
	session := sessions.Default(c)
	fileHeader, err := c.FormFile("file")

```
but in this case, the POST request wont even reach the handler...

I have no idea how to solve this Mystery, my own guts says I have to change something on the client side but I am not sure what !
- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.

Add a example

kill command will default send syscall.SIGTERM, add it in example will friendly to gin user.
Fix all warnings after run `golangci-lint run --disable-all -E errcheck`
Fix #1738 #1247

- go version: go1.11.2 windows/amd64
- gin version (or commit ref): master branch
- operating system: win10 17763

## Description
`gin/binding/form.go`
```go
func (formBinding) Bind(req *http.Request, obj interface{}) error {
	if err := req.ParseForm(); err != nil {
		return err
	}
	req.ParseMultipartForm(defaultMemory)
	if err := mapForm(obj, req.Form); err != nil {
		return err
	}
	return validate(obj)
}
```
`req.ParseMultipartForm(defaultMemory) should return error`


for basic demo
```
package main

import "github.com/gin-gonic/gin"

func main() {
	r := gin.Default()
	r.GET("/ping", func(c *gin.Context) {
		c.JSON(200, gin.H{
			"message": "pong",
		})
	})
	r.Run() // listen and serve on 0.0.0.0:8080
}

```
if I run 
`go run main.go`

the error is
`
../../../golang/pkg/mod/github.com/gin-gonic/gin@v1.3.0/binding/msgpack.go:12:2: 
../../../golang/pkg/mod/github.com/ugorji/go/codec@v0.0.0-20181209151446-772ced7fd4c2/goversion_vendor_eq_go15.go:1:1: expected 'package', found 'EOF'
`

go version 1.11.4 with GO111MODULE=on
revert #1690 
Here https://github.com/gin-gonic/gin/issues/153#issuecomment-103240995 @manucorporat said `gin.Context behave like context.Background + Value`, and revert it to fix #1731 first.
cc @rbeuque74 

@appleboy please help me to review the revert, thanks!
context.AbortWithError should be renamed context.AbortWithStatusError.
And AbortWithError should not have code param.
```golang
func (c *Context) AbortWithError(err error) *Error {
	c.Abort()
	return c.Error(err)
}
```
Use the AbortWithError we can process err in middleware like this:
```golang
func err_process(c *gin.Context) {
	c.Next()

	err := c.Errors.Last()

	if err != nil && !c.Writer.Written() {
		c.JSON(http.StatusInternalServerError, gin.H{
			"error_msg": err.Error(),
		})
	}
}
```
Otherwise if we can't write header in middleware err_process.
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: 1.11.4
- gin version (or commit ref): 1.3
- operating system: Arch linux

## Description
My setup is a gin router in front of a `99designs/gqlgen` graphql handler which uses the regular `net/http` package.

My problem is that i wrote my basic authentication middleware as a gin handler, it takes the basic auth header and validates it etc. Fetches the user from the database and sets it inside of the gin.Context with `context.Set("user", usr)`. When i try to access this through the `context.Context` object later in the middleware chain this is gone.

I fixed this by setting this line in my gin middleware:
```
func (uc *UserController) AuthenticateUserKey() gin.HandlerFunc {
	return func(c *gin.Context) {
		c.Request = c.Request.WithContext(c)
                // ... do some authentication stuff and fetch/set the user
``` 

Otherwise i will just get a error when i try to get the `"user"` key from the context.Context.

I could do this in some middleware after the `authenticateUserKey` call, which would look nicer i guess. But i still think that using the gin context exactly like a regular context might have some issues, i am not sure how solid the gin implementation of the regular context methods are, as far as i can read some of them don't work at all which might ruin it for other developers.

My question is, how have people in similar situations dealt with this?

## Screenshots


As discussed in issue #610 when using `c.Bind()`, sometimes we don't want to bind certain fields from the user request. While this can be done adding `json:"-"` to field tag, the same can't be achieved for multipart/formdata requests.

This PR allows setting in the tag `form:"-"`, which solves the described issue.
I'm using Glide as a dependency manager and I'm using a new feature (ShouldBindUri which I guess it has 30 days merged in Master), can you guys create a new version so we can use those new features?
- go version: 1.11
- gin version (or commit ref):807368579f8939cedfa59ec689708754920f93e4
- operating system:linux

## Description
panic in package context:

panic: context: internal error: missing cancel error

goroutine 6 [running]:
context.(*cancelCtx).cancel(0xc000052180, 0xc000090000, 0x0, 0x0)
	/home/xiaotao.01/go-1.11/src/context/context.go:369 +0x258
context.(*timerCtx).cancel(0xc000052180, 0x0, 0x0, 0x0)
	/home/xiaotao.01/go-1.11/src/context/context.go:447 +0x4a
context.propagateCancel.func1(0xc00007e000, 0x207, 0x10000, 0x4de000, 0xc00000a080, 0x4dde40, 0xc000052180, 0xc0000700c0, 0xc000070120, 0x0)
	/home/xiaotao.01/go-1.11/src/context/context.go:281 +0x1f6
created by context.propagateCancel
	/home/xiaotao.01/go-1.11/src/context/context.go:271 +0x316
exit status 2

analysis:
gin use sync.pool to cache gin.Context objects:
```
func (engine *Engine) ServeHTTP(w http.ResponseWriter, req *http.Request) {
	c := engine.pool.Get().(*Context)
	c.writermem.reset(w)
	c.Request = req
	c.reset()

	engine.handleHTTPRequest(c)

	engine.pool.Put(c)
}
```

but a context objects should not be reused, if we use ginCtx as parent to make a new timeout-context(or deadline-context or cancel-context), the package context will start a goroutine to select Done() of parent and child context. if parent is done, cancel child by parent.Err(), but parent is a reusable ginCtx, if it's already using by another handler, the Err() is nil, then panic as above

in short, gin put ginCtx back to pool means "free this context", but it's still used by package context

The Context cannot be cached in the pool, otherwise the Context that is immediately fetched by another goroutine will be in an unknown state, which may lead to a Panic
    --by Vincen, my workmate

---

哎，英文太渣了凑合看吧，用中文大概说一下，就是gin用pool存context是一个错误的做法，因为有可能第一个context在放入pool后立即被另一个go程get出来重用，但这个context还被标准库监听着Done()呢，而且标准库监听的是它之前的Done()返回的chan，这个chan被close（在上面ServeHTTP之后，net/http中）后，标准库要通知它的child，这时候又要调用parent.Err()去获取错误，可惜parent这个被重用了，已经物是人非，Err返回nil，context里面就崩了
老版本没问题是因为老的ginCtx的Done永远返回nil，隐藏了这个问题，最近的新版本改成了用ginCtx.Request.Context()，就不行了，在并发比较高的时候容易触发
Hei,

This issue is related to #205 #388 #1065 #1162 #1301.

Gin uses httprouter, which is not very helpful when using wildcards and a few routes. The related issue julienschmidt/httprouter#73 has been closed 4 years ago. It's by design and the suggestions are to do manual routing by hand, which I think is not acceptable for a cool framework.

> Only explicit matches: With other routers, like http.ServeMux, a requested URL path could match multiple patterns. Therefore they have some awkward pattern priority rules, like longest match or first registered, first matched. By design of this router, a request can only match exactly one or no route. As a result, there are also no unintended matches, which makes it great for SEO and improves the user experience.

Therefore, gin could perhaps switch to a more advanced router. "First registered" works well with Express for example.

This PR adds a HandlerNames method which returns all registered handles for the context in descending order
- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


How to use zipkin (like https://github.com/openzipkin/zipkin-go) to trace gin request, and http request in gin handler?


* add sync.Pool to manager JSON,XML,YAML,ProtoBuf,MsgPack Render object.
* we can move JSON,XML,YAML,ProtoBuf,MsgPack Render implement to sub-module in Gin (such like [github.com/alimy/gin/tree/master/module](https://github.com/alimy/gin/tree/master/module))  or other module repository based on this change.


Add a function `ForceConsoleColor`, like `DisableConsoleColor` but to force coloring the output.

It usefull when some IDE's integrated console (like IntelliJ or Goland) are not detected as TTY, but can display colors.

Also helps if one want to output color in log file (#1590) and as a workaround for #1547.

* add sync.Pool to manager JSON,XML,YAML,ProtoBuf,MsgPack Render object.
* we can move JSON,XML,YAML,ProtoBuf,MsgPack Render implement to sub-module in Gin (such like [github.com/alimy/gin/tree/master/module](https://github.com/alimy/gin/tree/master/module))  or other module repository based on this change.


fix #1721 


Hi,

Implementing request logger I've noticed that for half of all requests to Gin 
c.HandlerName() equals to "github.com/itsjamie/gin-cors.Middleware.func1"

For context:
1. I'm using "github.com/itsjamie/gin-cors"
2. Interceptor implemented as simple as:

```
r.Use(LoggerMW)
...
where
...
func LoggerMW(c *gin.Context) {
...
println(c.HandlerName())
...
}
```

My expectation was that a middleware would be "transparent" and following docs for 
func (c *Context) HandlerName() we have _"// HandlerName returns the main handler's name."_ where I read "main" as a handler behind a middleware.

Please let me know if this is something expected and I need to filter this string out then, or this is a bug or there's a some correct way to make Gin + its CORS middleware? 

Thank you!
D

if a path doesn't match any of my routes, can I capture that and display a specific page? i.e. don't show "404 page not found" show my nice version from my template.

I'm doing

c.Request.Header.Get("Host")

and it's ""

Do I have to enable gin to get this field from the browser?

Some errors I keep seeing in my logs:

`http2: server: error reading preface from client 173.73.165.109:62190: timeout waiting for client preface
`
`http: TLS handshake error from 141.212.122.81:58006: tls: no cipher suite supported by both client and server`

Any ideas if these should be worried about?

I can say Run(":443") but how do I give it my cert file and make https work?

Looks like the http2 support has broken web socket hijacking...

If I run a server and disable http2, no panic. Otherwise, using http2 and trying to open a ws causes the following error:

```
interface conversion: *http.http2responseWriter is not http.Hijacker: missing method Hijack
github.com/gin-gonic/gin/response_writer.go:105
```

i disabled http2 by running a server with 

```
 GODEBUG=http2server=0
```

my form struct is like this:

```
type XXX struct {
  Offset int `binding:"required"`
}
```

And my test case is like this:

```
curl http://127.0.0.1:8080/xxx?offset=0
```

Currently, when using `c.Bind()`, it is possible to set the `binding` tag to `required` to ensure that the field must be set. It would be useful to also be able to set this field to something like `skipped` so that when using `c.Bind()`, the field is skipped and isn't actually decoded.

To give a bit of matter to this issue, my current use case is as follows: I have a model (struct) which I use to interact with my database and to also encode/decode json from my users requests (my application is an API). The model has an ID field which contains the ID of the object referenced in the database. This field should automatically be set by my application, but it should also be returned to the user when requested (when encoding the response's JSON).

Basically, being able to set the `binding` tag to `skipped` would give the ability to have fields as read-only. 

I've started to use it.
But I wander how to handle unexpected 500 error and 401 error?
I want to show specific error page when something error occured.

Is there something handler?

Hello,

`c.JSON` seems to be very slow on the browser dev console network response time, why?

Why is this code faster:

```
// 17 ms (browser)
// 4ms (gin log)
out, _ := json.Marshal(versions)
c.String(http.StatusOK, string(out))
```

while this one is quite slow?

```
// 1195 ms (browser)
// 3ms (gin log)
c.JSON(http.StatusOK, versions)
```

What is the difference? (other than the headers content type)

---

**update**

So I tried this:

```
// 1125 ms (browser)
// 3.6ms (gin log)
c.Writer.Header().Set("Content-Type", "application/json; charset=utf-8")
c.String(http.StatusOK, string(out))
```

So I guess the content type is making it slower? How? Why?

I didn't find links on other contribs in this summary. But I am sure it has to be here. 
**go1.6** "block" template feature was added in standard library. But gin don't allow by default several _html.Templates_. It misunderstood people who want to check new features.

It's been almost a year since the last stable tag and it seems like a lot has been added or modified since.

gin-gonic/contrib/static is working, but I hope to work with HTTP auth. I did not how to use? 

authorized.Use(static.Serve(xxx , xxx)) seems not work.

Its really strange how hard i am finding it to get the client IP.

All i get back is "::1". Weird ????

```
// Call down
clientIP, err := getClientIPByRequest(c.Request)

// getClientIPByRequest tries to get directly from the Request.
// https://blog.golang.org/context/userip/userip.go
func getClientIPByRequest(req *http.Request) (ip string, err error) {

    // Try via request
    ip, port, err := net.SplitHostPort(req.RemoteAddr)
    if err != nil {
        log.Printf("debug: Getting req.RemoteAddr %v", err)
        return "", err
    } else {
        log.Printf("debug: With req.RemoteAddr found IP:%v; Port: %v", ip, port)
    }

    userIP := net.ParseIP(ip)
    if userIP == nil {
        message := fmt.Sprintf("debug: Parsing IP from Request.RemoteAddr got nothing.")
        log.Printf(message)
        return "", fmt.Errorf(message)

    }
    log.Printf("debug: Found IP: %v", userIP)
    return userIP.String(), nil

}
```

Hi,

Thanks you all for this amazing package.

I just wondering if it is possible to add a get response body method to context? sometime it is needed to get response body in middleware, however i don't see any public method in gin that can provide that.

Thanks!

Hi,

I've tried to log gin's output to a file. I've tried to use Multiwriter like in Issue #255
I've also tried log.SetOutput(f) and also the Middleware gin.LogWithWriter

Nothing seems to work. Here's my source:

``` go
    f, err := os.OpenFile("logfile.log", os.O_RDWR|os.O_CREATE|os.O_APPEND, 0666)
    if err != nil {
        log.Fatalf("error opening file: %v", err)
    }
    defer f.Close()

    gin.SetMode(gin.DebugMode)
    gin.DefaultWriter = io.MultiWriter(f)
    r := gin.New()
    r.Use(gin.Logger())
    r.Use(gin.Recovery())
```

Can someone explain me, how it _should_ work?

We now have ctx.Msgpack() as render function.

The Content-Type will be "application/x-msgpack" and passed object will be encoded as Msgpack.

Also, there is a new dependency which is github.com/vmihailenco/msgpack.

Hello,

I am writing a server for my research group where I obtain a list of s3 buckets and need to make a dropdown menu dynamically. This is what I have so far:

``` html
<form class="form-horizontal" role="form"  action="/bucketview" method="POST">
  <div class="dropdown">
    <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                Bucket(s)
    <span class="caret"></span>
    </button>
    <ul class="dropdown-menu" aria-labelledby="dropdownMenu">
      {{ .bucketlist }}
    </ul>
  </div>
</form>
```

``` go
func main() {
  bucketlist := ""
  for _, dataset := range resp.Item["Datasets"].SS {
    bucketlist = bucketlist + makeListItem(*dataset)
  }
  c.HTML(http.StatusOK, "bucketlist.tmpl", gin.H{
    "bucketlist": bucketlist,
  })
  } else {
    c.HTML(http.StatusUnauthorized, "index.tmpl", gin.H{
      "message": "Invalid login information.",
    })
  }
}

func makeListItem(bucket string) string {
  liststring := "<li>" + bucket + "</li>"
  return liststring
}
```

But the output I get is looks like this:
<img width="255" alt="screen shot 2016-04-23 at 3 05 43 pm" src="https://cloud.githubusercontent.com/assets/1553055/14764214/ea58be44-0964-11e6-9276-183a8bd1c60f.png">

How do I put HTML code inside a template placeholder? Help would be greatly appreciated.

1. If request body is nil, decoder.Decode will panic.
2. Returns the message as a error.
3. With testing.

Even with GIN_MODE=release, gin still prints the full request log to console, which can seriously slow down performance.

We've had to disable it temporarily during performance testing by redirecting it to /dev/null.

Please document how to properly enable/disable the request log.

Thank you

`package main

import (
    //"log"
    //"encoding/json"
    "github.com/gin-gonic/gin"

)

type Job struct {
    protocol    string      `json:"protocol"`
    job_id      string      `json:"job_id"`
    targets     []string    `json:"targets"`
}

type Jobs struct {
    error       int     `json:"error"`
    ip          string  `json:"ip"`
    jobs        []Job   `json:"jobs"`
}

func JobsHandler(c *gin.Context) {
    rtnBody := &Jobs{
                    error:  0,
                    ip:     "10.197.1.58",
                    jobs:   []Job{
                                    {  
                                        protocol:   "icmp",
                                        job_id:     "sdfsdf132434",
                                        targets:    []string{
                                            "8.8.8.8",
                                            "8.8.4.4",
                                        },
                                    },
                                    {
                                        protocol:   "http",
                                        job_id:     "s2323143455",
                                        targets:    []string{
                                            "www.baidu.com",
                                            "www.qq.com",
                                        },
                                    },
                                },
                            }

```
    c.JSON(200, *rtnBody)
```

}

func main() {
    r := gin.Default()
    r.GET("/jobs", JobsHandler)
    r.Run()
}
`

get http://127.0.0.1/jobs return {}, not the rtnBody, anyone help to check, thanks

I'm using gin to build a simple api server. right now, after the server started a few minutes later, all of incoming requests were stuck. After checking connections state , I got a message like below :
![image](https://cloud.githubusercontent.com/assets/5574178/14666642/632b0b2e-070d-11e6-91f7-3fabbf373f65.png)

I already have tried to set c.Request.Close=true or c.Header("Connection","close") or both of them, but it was not working. I was wondering if anyone can help me fix this issue. 

Probably I don't understand, how this should work, but still.

I have error checking in Handler function. And if I make:

``` go
if err != nil {
    panic("500")
}
```

Everithing works proper - 500 code response and panic trace in terminal

If I use:

``` go
if err != nil {
    c.AbortWithStatus(500)
}
```

nothing happens. I get 200 response with null.

Mb, thats because at the end I use 

``` go
c.JSON(http.StatusOK, u)
```

?

But still, this should not be conflicted, as I understand.

Update:
This works as needed:

``` go
if err != nil {
    c.AbortWithStatus(500)
    return
}
c.JSON(http.StatusOK, u)
```

Hi,

The problem is when I do:

```
curl -i -X POST http://localhost:8180/v1/feeds
```

No body data, and when using `c.Bind()` there is a crash.

``` go
func PostFeed(c *gin.Context) {
    var in = &newFeed{}
    err := c.Bind(&in)
    if err != nil {
        c.JSON(-1, gin.H{
            "status":  http.StatusBadRequest,
            "error":   err.Error(),
            "message": "Your payload is not valid or well-formated.",
        })
        return
    }
   // Another c.JSON ...
}
```

The stack trace is at this address: https://gist.github.com/kokaz/72bd0de7e18d232c56a5eb6d5c269e5d

Hi,

I'm using master branch at commit 5caaac4, and when my `BindJSON()` fails because no data:

```
curl -i -X POST http://localhost:8180/v1/feeds
```

``` go
func PostFeed(c *gin.Context) {
    var in = &newFeed{}
    err := c.BindJSON(&in)
    if err != nil {
        c.JSON(-1, gin.H{
            "status":  http.StatusBadRequest,
            "error":   err.Error(),
            "message": "Your payload is not valid or well-formated.",
        })
        return
    }
}
```

The `Content-Type` returned is `text/plain; charset=utf-8` I logged the `Content-Type` before and after the call to `c.JSON` with `c.Writer.Header.Get()` it's OK but no in my final response. I don't have any middleware (nor the `gin.Default()` one) adding/editing my `Content-Type`. I looked through the whole source of code gin without finding anything!

Any idea?

Are there any plans to create a middleware for providing authorization with Oauth?

I'm not really sure whether this belongs in this repo or in contrib, but the commit referenced above, which was merged in yesterday, means that the contrib/cors package no longer works properly. It calls AbortWithStatus and expects to be able to write to the headers after that call is made, until it returns.

Raising this here because it might affect other packages - not sure if this sort of side effect was already considered and dismissed. It's a pretty easy fix in contrib/cors if that's preferred.

Quote from docs

> DefaultWriter is the default io.Writer

But DefaultWriter has type `*os.File`, so i can't run code like this:

```
package main

import (
    "github.com/gin-gonic/gin"
    "io/ioutil"
)

func main() {
    gin.DefaultWriter = ioutil.Discard
}
```

```
$ go run main.go 
# command-line-arguments
./main.go:9: cannot use ioutil.Discard (type io.Writer) as type *os.File in assignment: need type assertion
```

It broke in [this](https://github.com/gin-gonic/gin/commit/9e930b9bdd5a29bac38fb491ffac4e7ea84b825d#diff-fd98eaa389d204eaf86f6913742c7551L34) commit

ref https://github.com/gin-gonic/gin/commit/007bd5124afeeaa151bcbddc30d39ebd98e61f9a and https://github.com/gin-gonic/gin/issues/514

Hi @javierprovecho 

I create the `example` section which include project lists using gin framework.

Otherwise, caller needs to invoke WriteHeaderNow himself after
AbortWithStatus(), which is error-prone.

Also modified ErrorLoggerT() such that it always writes log to response
body. Otherwise calling AbortWithStatus() will fail to write body because
c.Writer.Written() is set true by WriteHeaderNow().

It addresses #585

context.Status() is a public function and it does almost the same thing as context.AbortWithStatus(). Suggest to make it as private to prevent user confusion.

If you call c.AbortWithStatus(400), it calls responseWriter.WriteHeader() and sets writer's status code. This however won't be written into response header because responseWriter.WriteHeaderNow() is not invoked. As a result you'll see 200 in response code.

The fix should be easy: let c.AbortWithStatus() call c.String() instead of s.Status(). I can submit a pull request if it sounds good to you.

If a route is defined as

`engine.POST("/endpoint/:id/something", ...)`

Is it possible, somewhere in the `gin.Context` object, to retrieve the string `"/endpoint/:id/something"` (different from, for example `"/endpoint/123/something"`.

Hi there,

Is that possible to use subtemplate in Gin? For example,  decomposing one single page into main.html, header.html and footer.html for reuse. Any example?

BR, Kevin


This addresses #580 

`test_helpers.go` is built with the package. It should be built only when testing which means it should have the suffix `_test.go`. One side effect is that is that by `test_helpers.go` using `httptest` every program that uses `gin` gets `-httptest.serve` flag.

``` go
package main

import (
    "flag"
    "net/http"

    "github.com/gin-gonic/gin"
)

func main() {
    rtr := gin.Default()
    rtr.GET("/", func(ctx *gin.Context) {
        ctx.String(http.StatusOK, "Hi")
    })
    flag.Parse()
    rtr.Run(":8080")
}
```

Now run the program with `--help` and you'll see:

```
$ go run /tmp/t.go --help
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:   export GIN_MODE=release
 - using code:  gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /                         --> main.main.func1 (3 handlers)
Usage of /tmp/go-build903640301/command-line-arguments/_obj/exe/t:
  -httptest.serve string
        if non-empty, httptest.NewServer serves on this address and blocks
exit status 2
$
```

Gin changes the log package default flags. This removes that code.

The downside of this fix is that it will change log formatting for users who have not been explicitly resetting the log flags.

The `test_helpers.go` file imports `net/http/httptest` which hooks into command line args.

Run any program using Gin with `-help`:

```
~/wgo/src/github.com/divtxt/lockd$ go run main.go -help
Usage of /var/folders/3q/77h08dhn0svg36nb4b53h1zr0000gp/T/go-build776975792/command-line-arguments/_obj/exe/main:
  -httptest.serve string
        if non-empty, httptest.NewServer serves on this address and blocks
  -listen string
        listen address (default ":2080")
exit status 2
```

Changing the file name to end with `_test.go` avoids the `-httptest.serve` flag showing up.

The downside of this fix is that this will result in `gin.CreateTestContext(..)` no longer being exported, but since it's not Gin's goal to provide test helpers, I hope that's ok.

I added support of a ["block" template feature from go1.6](https://golang.org/doc/go1.6#template)
It relates with #567

I decided to use custom names for templates. It's pretty comfy. Check my example 

> _examples/template-blocks/main.go_

For a storing of templates I use map. It's only for reading. [It' safe](http://stackoverflow.com/questions/11063473/map-with-concurrent-access/11063566#11063566).

Fixes typo from 'If Parses' to 'It parses'

I found some stuff in `README.md` that I thought could be improved on.

As i try to move the library from Martini to Gin , The panic "path segment conflicts with existing wildcard" was happen .  I can not change the rest path of api which is invoke by lots of client on product environment. I found the following way to solve that problem .
https://github.com/figoxu/goPraticse/tree/master/3rd/gin/routeInject
There is any risk abount my solution ?  Please give some advice .Thanks

I found that the PostForm() function has changed to PostFormValue(), also the same problem with  DefaultPostFormValue(), please update it in the readme file, it is confused.
![screenshot from 2016-04-01 13-06-47](https://cloud.githubusercontent.com/assets/7886167/14198266/a8c2f582-f80a-11e5-99e6-48cc10199f24.png)

Hi,

I'd like to make a middleware that detects if a jsonp response has been required ("callback=callbackValue" as query param) and if that is true, let the normal execution run and then capture the answer and rewrite it as jsonp (callbackValue(json)); I could not see a way to obtain the written body

Thanks


For scenarios like this:

``` go
// POST /?[]foo_ids=1&[]foo_ids=3&[]foo_ids=5

c.PostFormArray("[]foo_ids") // []string{"1", "3", "5"}
```

How to get all routes registered at runtime?

Because I hide the go program under nginx by using proxy_pass, and the go program are under a sub path of our website, for example: 

GET http://www.test.com/api/xxx/
Redirect by 301 to http://www.test.com/xxx

You see you problem, for the go program, its request URI is http://www.test.com/xxx/, not include the /api, so gin redirect to a wrong URL.

So I think if gin support internal redirect will resolve this problem, how do you think about it?

Hello there!

I am trying to use the new "block" features in the `html/template` package in go 1.6, but I cannot get it to work inside a gin application.

I filled a thorough description of the bug as well as example code in the repository at https://github.com/esantoro/gin-template-bug
#### TLDR

layout.html

```
<!doctype html>
<html>
  <head>
    <title>{{block "title" .}} DEFAULT TITLE {{end}}</title>

  </head>
  <body>
    <div id="container" style="border: 1px solid black;">
      {{ block "content" .}}  DEFAULT CONTENT {{ end }}
    </div>

    <div class="footer" style="border: 1px solid yellow;">
      {{ block "footer" .}}
      DEFAULT FOOTER
      {{ end }}
    </div>
  </body>
</html>
```

index.html : 

```
{{define "title"}} CUSTOMIZED TITLE {{end}}
{{define "content"}} CUSTOMIZED CONTENT {{end}}
{{ define "footer" }} CUSTOMIZED FOOTER {{end}}
```

**Expected result**: Rendering index.html should fill layout.html with values from index.html

**Actual result**: index.html is rendered to a blank page.

For some reason I am getting an error when trying to bind form values (POST) into a *string field in a struct. It works fine when using bind.JSON but binding using FORM fails when "unknown type".

My struct looks like the following 

type Person struct {
    FirstName        *string   `form:"firstName" json:"firstName" binding:"required"`
    LastName *string `form:"lastName" json:"lastName" binding:"required"`
}

and I am doing a bind via c.BindWith(&postObj, binding.Form)

If I change the *string to a string then it works fine but obviously I want to use *string.

My application use gin for web framework and use Protobuf to exchange data.
So I added protobuf support for negotiation.

Hi, i already updated comment once as similar issue. 

I coded somthing like this. 

func (up *UploadHandler)UploadMultiParts(c *gin.Context) {
    //rw := c.Writer
    req := c.Request
        defer func(){ do something }
       -- huge File io working --
......

And I implemented "defer" function within this function , I expected that "defer" will be called by excepted situation such as the abnormal disconnection.
However, it did not do anything.... 

Well , Related resource seems to be remaining in the memory. 
Do you have a good solution ? Using a context ? Waitgroup ? Gorutine? i want to make defer funtions and align my higher cpu percent.. Please let me know 

Thanks !!! 

I want add <?xml version="1.0" encoding="UTF-8" ?>
for the result

Fix #548 

Add upload file example code.

cc @javierprovecho 

https://github.com/braintree/manners

cc @javierprovecho 

perhaps gin can borrow some ideas to make the framework faster:

https://github.com/kataras/iris#benchmarks

https://github.com/julienschmidt/httprouter now supports OPTIONS response generation by a boolean flag

The code paths for routing still seem quite close. Can we bring this enhancement into the Gin router?

Relevant code:

https://github.com/julienschmidt/httprouter/blob/master/router.go#L379

https://github.com/julienschmidt/httprouter/blob/master/router.go#L296

Added a clone function of gin.Logger() called gin.LoggerDisk(LogFile io.Writer) which accepts an io.Writer parameter to write to. LoggerDisk() will write to os.Stdout like normal and also write to file. I also added a hostname lookup field which I think is useful. 

Example usage: 

```
var f io.Writer
var err error
logfilename := fmt.Sprint(APP_DIRECTORY, "/log/access.log")

if _, err = os.Stat(logfilename); os.IsExist(err) {
  f, err = os.Open(logfilename)
} else {
  f, err = os.Create(logfilename)
}

router.Use(gin.LoggerDisk(f))
```

Fixes #550, change a duplicate assert on the Path of the route by an assert on Handler name associated with the route.




I need help,the gin freamework example is like this 

``` go
func main() {
    router := gin.Default()
    router.LoadHTMLGlob("templates/**/*")
    router.GET("/posts/index", func(c *gin.Context) {
        c.HTML(http.StatusOK, "posts/index.tmpl", gin.H{
            "title": "Posts",
        })
    })
    router.GET("/users/index", func(c *gin.Context) {
        c.HTML(http.StatusOK, "users/index.tmpl", gin.H{
            "title": "Users",
        })
    })
    router.Run(":8080")
}
```

my Directory is

``` go
|------templates
             |----users
                     |-----index.tmpl
                     |-----test.tmpl
             |-----posts
                     |-----index.tmpl
```

I'm use the same like example , but I can't use  c.HTML(http.StatusOK, "users/index.tmpl", gin.H{}) for find the template,it says

``` go
html/template: "users/index.tmpl" is undefined
```

but i use  c.HTML(http.StatusOK, "test.tmpl", gin.H{})  find it successfully
can you help me .Please forgive my poor English.soory

Let's say I have a route that selects the \* from the database. I would like to limit amount of selections per second by caching results. I didn't find anything about cache in API docs though.

Hi,

I have an struct `StructA` which contains another struct `StructB` as an attribute, like this:

``` go
type StructB struct {
    FieldB string  `form:"fieldB"`
}

type StructA struct {
    NestedStruct *StructB
    FieldA string `form:"fieldA"`
    ...
}
```

In my handler I'm `Bind`ing the request content to an `StructA` object:

``` go
func MyHandler(c *gin.Context) {
    var tmp StructA
    ...
    c.Bind(&tmp)
    ...
}
```

My form contains the field `fieldA` as well as `fieldB`, but `NestedStruct` stays `<nil>` after the `Bind` call.
Is manual binding the only way to achieve this at the time? Or am I missing something?

Thanks

Is there something wrong with the following assert line (see [gin_test.go](https://github.com/gin-gonic/gin/blob/develop/gin_test.go#L247)) : `assert.Regexp(t, wantRoute.Path, gotRoute.Path)` ?

As you already test the Path attribute [just above](https://github.com/gin-gonic/gin/blob/develop/gin_test.go#L246), I was wondering that you wanted to do something like `assert.Regexp(t, wantRoute.Handler, gotRoute.Handler)` instead. Is it correct ?

I was about to submit a PR but I wanted to check with you first.

Hi everyone,

First I'd like to thanks every contributor for this great project, it's working marvelously well.

Second, I have question about handler tests and end to end tests with `Gin`. I'm relatively new to `Go` and I have trouble to write something that suit me and seems idiomatic. 

I tried to search for example but nothing stood up. Do you have any example in mind in a good way to test routes handlers or the whole application itself using `net/http/httptest` ?

Thanks,
Albin.

POST: multipart/form-data

Added reflect for ptr types to support the go-swagger generated http clients.

I wonder if it is possible to retry handler execution, something like this:

``` go
func Retry() gin.HandlerFunc {
    return func(c *gin.Context) {
        c.Next()
        if c.IsAborted() {
            c.Index-- // or some other magical function to reset index to previous handler
            c.Next() // or just some generic function c.Retry()
        }
    }
}
```

Hi, please create a slack channel in gophers to users talk about gin-gonic framework maybe to diferentes channels one to users and another to developers..

tks
joao

Hi 
I wanted to omit some parts of the struct when sending responces... but the `json` tag doesn't seem to work ..

Could it be something I did wrong?

My struct is a very deeply nested struct with pointers to other structs (no circular stuff)
`json:"-"`
`json:"someothername"` 
all seem to not work...

any help would be great


This test sample is useful when gin user writes integration test.
Because httptest runs httpserver asyncrhronous and selects port number automatically if we want.

Hi there,

any suggestions on how to bind `POST` requests like:

```
?names[]=foo&names[]=bar
```

and

```
?names=foo&names=bar
```

to 

``` go
type Record struct {
    Names []string `json:"names" form:"names"`
}
```

I tried to use `json:"names[]" form:"names[]"`, but then it breaks `application/json`, `application/x-www-form-urlencoded`, etc.

Would appreciate any help and thanks in advance!

Hey, so, first of all, I really love this framework. But,I've thought that adding a support for regex based routing would be really awesome.
Revel has support so maybe using their code would be an option?

@javierprovecho I added golang 1.5 and 1.6 version in `.travis.yml`.

As topic.


Please update gin tags to support http://labix.org/gopkg.in.
Version zero is already there: https://gopkg.in/gin-gonic/gin.v0.

Just run the following command

```
$ gofmt -w .
```

cc @manucorporat 

Trying something like this and other things.

```
options := sessions.Options{
    Path:     "/",
    Domain:   "www.foodev.com",
    MaxAge:   0,
    Secure:   false,
    HttpOnly: false,
}

sessions.Session.Options(options)
```

Getting

```
 not enough arguments in call to method expression "github.com/gin-gonic/contrib/sessions".Session.Options
```

Would be nice if in the readme/examples, it shows how to supplement these options.

Thanks

I'm able to get the basic examples to work, but trying to get it to work with my MVC skeleton using gin.

So my routes.go is this:

```
package router

import (
    "github.com/gin-gonic/gin"
    "github.com/paulm/platform/auth"
    "github.com/paulm/platform/controllers"
    "github.com/paulm/platform/libraries/common"
)

func Route() {
    // Creates a router without any middleware by default
    r := gin.New()

    // Initialise Controllers
    c := &controllers.Core{
        Engine: r,
    }

    c.Init()

    // Add Static Assets
    r.Static("/assets", "./public/assets")
    r.StaticFile("/favicon.ico", "./public/favicon.ico")

    // Read Config
    r.Use(common.ReadConfigFile())

    // Init Sessions
    r.Use(auth.InitSession())

    // Connect to Database
    //r.Use(models.Connect())

    // Wire up Routes
    authorized := r.Group("/")
    // per group middleware! in this case we use the custom created
    // AuthRequired() middleware just in the "authorized" group.
    authorized.Use(auth.RequireLogin())
    {
        authorized.GET("/", c.Login)
    }

    // listen and serve on 0.0.0.0:7777
    r.Run(":7777")
}
```

My auth.go is this:

```
package auth

import (
    "fmt"
    "github.com/gin-gonic/contrib/sessions"
    "github.com/gin-gonic/gin"
    "github.com/paulm/platform/libraries/common"
)

func InitSession() gin.HandlerFunc {
    return func(c *gin.Context) {
        var config common.TomlConfig
        config = common.ReadConfig(c)

        store := sessions.NewCookieStore([]byte(config.Session.Secret))
        sessions.Sessions(config.Session.Store, store)

        c.Next()
    }
}

// RequireLogin is a simple middleware which checks to see if the user is currently logged in.
// If not, the function returns a 302 redirect to the login page.
func RequireLogin() gin.HandlerFunc {
    return func(c *gin.Context) {
        session := sessions.Default(c)
        user := session.Get("user")

        if user == nil {
            fmt.Println("No user cookie")
        } else {
            fmt.Println("user haz cookie")
        }

        c.Next()
    }
}
```

Why am I seeing:

```
http: panic serving 127.0.0.1:42855: Key "github.com/gin-gonic/contrib/sessions" does not exist
```

Seems that whatever is happening in InitSession is not readable in RequireLogin.  

Thanks

I'm getting this error when I tried to `go get` and every time I try to `go build`. Which only started when I tried to `go get` this package. Thanks.

```
# gopkg.in/go-playground/validator.v8
/root/go/src/gopkg.in/go-playground/validator.v8/validator.go:152: undefined: sync.Pool

go version go1.2.1 linux/amd64
```

I am trying to add this middleware 

```go
func CORS () gin.HandlerFunc {
    return func(context *gin.Context) {
        context.Writer.Header().Add("Access-Control-Allow-Origin", "*")
        context.Writer.Header().Set("Access-Control-Max-Age", "86400")
        context.Writer.Header().Set("Access-Control-Allow-Methods", "POST, GET, OPTIONS, PUT, DELETE, UPDATE")
        context.Writer.Header().Set("Access-Control-Allow-Headers", "Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization, accept, origin, Cache-Control, X-Requested-With")
        context.Writer.Header().Set("Access-Control-Expose-Headers", "Content-Length")
        context.Writer.Header().Set("Access-Control-Allow-Credentials", "true")

        if context.Request.Method == "OPTIONS" {
            context.AbortWithStatus(200)
        } else {
            context.Next()
        }
    }
}
```

but not work with grouping routes

```go
  func main () {
    router := gin.New()
    router.Use(CORS())

    // cors middleware not working
    users := router.Group("/users")
    users.GET("/", Users)

    // cors middleware not working
    users := router.Group("/users")
    users.Use(CORS())
    users.GET("/", Users)

    // cors middleware working fine
    router.GET("/users")

    router.Run(":3000")
  }
```

How do I use a self-signed certificate so I can use https locally? 


Is there a way to get FQDN or at least URI of the server after it Run()'s?
Can't find this in documentation

I just want to ask about your workflow, since I'm using `1.0rc1`, whether things committed to `master` are considered production-ready.

Keep up the awesome work :+1: :). Doing great!

I use gin http.Server under [circus](http://circus.readthedocs.org/en/latest/) which is a socket manager.
I need to run http.Server through a file descriptor, so implemented `RunFd` method.

When using other socket managers (e.g. [einhorn](https://stripe.com/blog/meet-einhorn)), maybe work well.
### Usage

``` go
package main

import (
    "flag"
    "github.com/yyoshiki41/gin"
)

var (
    fd = flag.Int("fd", -1, "")
)

func main() {
    flag.Parse()

    r := gin.Default()
    // Ping test
    r.GET("/ping", func(c *gin.Context) {
        c.String(200, "pong")
    })
    // Method arg is the file descriptor number(int).
    r.RunFd(*fd)
}
```

and, `circus.ini` example is below.

``` ini
[circus]
statsd = 1

[watcher:webapp]
cmd = ./main -fd $(circus.sockets.web)
numprocesses = 1
use_sockets = True

[socket:web]
host = 127.0.0.1
port = 8080
```
### Demo

``` shell
$ circusd circus.ini
2016-02-03 11:07:13 circus[46347] [INFO] Starting master on pid 46347
2016-02-03 11:07:13 circus[46347] [INFO] sockets started
2016-02-03 11:07:13 circus[46347] [INFO] Arbiter now waiting for commands
2016-02-03 11:07:13 circus[46347] [INFO] webapp started
2016-02-03 11:07:13 circus[46347] [INFO] circusd-stats started
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:   export GIN_MODE=release
 - using code:  gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /ping                     --> main.main.func1 (3 handlers)
[GIN-debug] Listening and serving HTTP on fd@5
2016-02-03 11:07:13 circus[46354] [INFO] Starting the stats streamer
```

``` shell
# Ping test
$ curl localhost:8080/ping
pong

# Other terminal
[GIN] 2016/02/03 - 11:08:11 | 200 |    2.571629ms | 127.0.0.1 |   GET     /ping
```

thx :sunny:

<!-- Reviewable:start -->

[<img src="https://reviewable.io/review_button.svg" height="40" alt="Review on Reviewable"/>](https://reviewable.io/reviews/gin-gonic/gin/526)

<!-- Reviewable:end -->

Motivation: it's not uncommon for API requests to include auth-tokens or other key information signed in the request header. This change makes access more native and accessible.
Also modified the implementation to use Header's builtin Get() function which does the same thing in one call.

Can anyone help setting up a server that also handles web-socket with gin?
Preferably I would like to use [github.com/googollee/go-socket.io](url)

Thanks.

The `Gin` development seems to have returned to normal, Did @manucorporat  reconsider the roadmap formulation, such as v2 things.

Hi I'm doing REST service as a separate part of big web application, it's great to write simple things on this, but now we have issue with handling sessions ....
Is it possible to implement it with <code>gin</code> ? 

According to [the spec](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.2.2):

> The newly created resource can be referenced by the URI(s) returned in the entity of the response, with the most specific URI for the resource given by a Location header field.

Seems like a pretty good candidate for `c.Redirect` to me?

I want to send it from the test with travis-ci before sending a pull request.
In the case of gin, it is an error to test the repository that was fork in travis-ci.
https://travis-ci.org/178inaba/gin/jobs/105072041
This is I think because there is assumed test the import path "github.com/gin-gonic/gin".
So, we added a setting to fix the import path of golang set of travis-ci.
When you add test of travis-ci was movement successfully.
https://travis-ci.org/178inaba/gin/jobs/105225833

PS Thank you for always maintains a gin.

> https://github.com/gin-gonic/gin#serving-static-files

``` go
package main

import (
    "fmt"
    "github.com/gin-gonic/gin"
    "net/http"
    "os"
)

func main() {
    bind := fmt.Sprintf("%s:%s", os.Getenv("OPENSHIFT_GO_IP"), os.Getenv("OPENSHIFT_GO_PORT"))
    gin.SetMode(gin.ReleaseMode)
    router := gin.Default()
    router.StaticFile("/favicon.ico", "./templates/favicon.ico")
    router.StaticFile("/bootstrap.min.css", "./templates/bootstrap.min.css")
    router.StaticFile("/bootstrap.min.js", "./templates/bootstrap.min.js")
    router.LoadHTMLFiles("templates/index.html") 
    router.GET("/", func(c *gin.Context) {
        c.HTML(http.StatusOK, "index.html", gin.H{
            "title": "Main website",
            "text":  "this is text",
        })
    })
    router.Run(bind)
}
```

Template

``` html
<html>
      <head>
          <title>{{.title}}</title>
          <link rel="icon" href="favicon.ico">
          <script src="http://code.jquery.com/jquery-latest.js"></script>
          <script src="bootstrap.min.js"></script>
          <link rel="stylesheet" type="text/css" href="bootstrap.min.css">
      </head>
        <body>
            <h1>{{.text}}!</h1>
      <div class="btn-group">
      <button class="btn dropdown-toggle" data-toggle="dropdown">qwerty <span class="caret"></span></button>
      <ul class="dropdown-menu">
        <li><a href="#">1</a></li>
        <li><a href="#">2</a></li>
        <li><a href="#">3</a></li>
        <li class="divider"></li>
        <li><a href="#">4</a></li>
      </ul>
    </body>
</html>
```

Run

![_2016-01-26_22-39-49](https://cloud.githubusercontent.com/assets/9416005/12594297/11448316-c47e-11e5-91af-593b2ac31828.png)

Same tamplete in  browser on localhost
![_2016-01-26_22-49-57](https://cloud.githubusercontent.com/assets/9416005/12594547/4efd2f04-c47f-11e5-88a9-ae78d04370ac.png)

router.StaticFile() does not include anything.

If I try to run the app engine example using "goapp serve" the build fails with the following error:

`ERROR    2016-01-26 17:17:52,160 go_runtime.py:179] Failed to build Go application: (Executed command: C:\Program Files\Google\go_appengine\goroot\bin\go-app-builder.exe -app_base D:\Code\Go\gopath\src\app_engine\gin-example -arch 6 -dynamic -goroot C:\Program Files\Google\go_appengine\goroot -nobuild_files ^^$ -unsafe -gopath D:\Code\Go\gopath\ -print_extras_hash hello.go)`

`2016/01/26 17:17:52 go-app-builder: Failed parsing input: parser: bad import "syscall" in colorable_windows.go from GOPATH`

I think this error happens because one of the gin dependencies (go-colorable) is importing the syscall package which isn't allowed on App Engine?

I'm using go_appengine_sdk_windows_amd64-1.9.31 and Gin 1.0rc2.

What am I doing wrong?
```
func handler(ctx *gin.Context) {
    ctx.SetCookie(
        "token",
	"testtoken",
	3600,
	"/",
	"127.0.0.1",
	false,
	false,
    )
}
```

It does not set cookie in the response header. Tested using postman.
What is missing from my code for c.Bind to work correctly?

The correct result is that of the parameter obtained by the ByName function but in the Bind function it paints me empty

![001](https://cloud.githubusercontent.com/assets/17584143/23322047/2e98c148-fab0-11e6-990b-36bfb099ae05.jpg)


Sorry was my mistake !! please Close
```
go get -u gopkg.in/gin-gonic/gin.v1
import "gopkg.in/gin-gonic/gin.v1"
```
then `go build`

```
# gopkg.in/gin-gonic/gin.v1
../../../gopkg.in/gin-gonic/gin.v1/context.go:498: cannot use sse.Event literal (type sse.Event) as type render.Render in argument to c.Render:
	sse.Event does not implement render.Render (missing WriteContentType method)
```

interface changed?
Hello,

First of all, thanks for your great project, I'm using it a on daily basis and it's just awesome.

## TL;DR

I have no clue on how to properly handle response format when validation fails on `BindJSON` and I want to send back the errors as JSON.

## Context

I'm currently having trouble working with `context.BindJSON`. I have two fields that are required when receiving JSON, let's call them `first` and `second`

```golang
type params struct {
	First  string `json:"first" binding:"required"`
	Second string `json:"second" binding:"required"`
}
```

Now when I receive the request, I handle it like this : 

```golang
func postFirstSecond(c *gin.Context) {
	var err error
	c.Header("Content-Type", "application/json; charset=utf-8")

	p := params{}
	if err = c.BindJSON(&p); err != nil {
		c.JSON(http.StatusBadRequest, gin.H{
			"error":  "json decoding : " + err.Error(),
			"status": http.StatusBadRequest,
		})
		return
	}
}
```

So first of all, I don't understand why `c.JSON()` doesn't return the appropriate content-type, I found that when `BindJSON` fails, it writes the header to be plain text. Anyway my endpoint always returns JSON so I just set the content-type on top of the handler, problem solved (I guess).

When one field is missing, this endpoint returns something like that :

```json
{
    "error": "json decoding : Key: 'params.First' Error:Field validation for 'First' failed on the 'required' tag",
    "status": 400
}
```
That's fine. I mean it's not really what I expected but it works.

## Problem

When both fields are missing, this is what I get back :

```json
{
    "error": "json decoding : Key: 'params.First' Error:Field validation for 'First' failed on the 'required' tag\nKey: 'params.Second' Error:Field validation for 'Second' failed on the 'required' tag",
    "status": 400
}
```

## Question

Is there a simple way to handle those errors ? I'd like to get something more user-friendly, or at least a separate field for my errors. Something like :

```json
{
    "errors": [
        "Key: 'params.First' Error:Field validation for 'First' failed on the 'required' tag",
        "Key: 'params.Second' Error:Field validation for 'Second' failed on the 'required' tag"
     ],
    "status": 400
}
```

I'm aware that checking manually the fields should allow me to do that, but the fact is : I feel like the documentation and examples are pretty vague about error handling. 

Could someone help me with that ? How do you handle errors generated by `Bind` or `BindJSON` ?
Hi guys. I have the following problem

```
type Foo struct {
	Bar bool `json:"bar" binding:"required"` // True / False
}
```

When I send a JSON request with the value true it works, but when I send  the same request with false I get the following error.

```
{
	"error": {
		"Foo.Bar": {
			"FieldNamespace": "Foo.Bar",
          		"NameNamespace": "Bar",
			"Field": "Bar",
			"Name": "Bar",
			"Tag": "required",
			"ActualTag": "required",
			"Kind": 1,
			"Type": {},
			"Param": "",
			"Value": false
		}
	}
},
```


when i use go to get the package:
$go get gopkg.in/gin-gonic/gin.v1

\# cd .; git clone https://gopkg.in/gin-gonic/gin.v1 D:\gos\project\src\gopkg.in\gin-gonic\gin.v1
Cloning into 'D:\gos\project\src\gopkg.in\gin-gonic\gin.v1'...
fatal: Unable to find remote helper for 'https'
package gopkg.in/gin-gonic/gin.v1: exit status 128


use glide to get :
$glide get gopkg.in/gin-gonic/gin.v1

[INFO]  Loading mirrors from mirrors.yaml file
[INFO]  Preparing to install 1 package.
[INFO]  Attempting to get package gopkg.in/gin-gonic/gin.v1
[INFO]  --> Gathering release information for gopkg.in/gin-gonic/gin.v1
[INFO]  --> Adding gopkg.in/gin-gonic/gin.v1 to your configuration
[INFO]  Downloading dependencies. Please wait...
[INFO]  --> Fetching gopkg.in/gin-gonic/gin.v1.
[WARN]  Unable to checkout gopkg.in/gin-gonic/gin.v1
[ERROR] Update failed for gopkg.in/gin-gonic/gin.v1: Unable to get repository
[ERROR] Failed to checkout packages: Unable to get repository


i don't use other pack manage tools to test
I tried to add a simple modificaiton to the template example to go over a list and render the template but the standard .tmpl  for loop or {range} doesnt work, any example for list render in the template?

here is my code 

```

func main() {
	router := gin.Default()
	router.LoadHTMLGlob("templates/*")
	//router.LoadHTMLFiles("templates/template1.html", "templates/template2.html")
	router.GET("/index", func(c *gin.Context) {
		c.HTML(http.StatusOK, "index.tmpl", gin.H{
			"title": "Main website",
			"author": "Medya",
			"movies": []string{"a","b","c"},
		})
	})
	router.Run(":8080")
}
```

and here is my template.
```
<html>
    <h1>
        {{ .title }}
    </h1>
    <body>
        {{ .author}}


        {% for .m in movies %}
            {{ .m }}
        {% endfor %}

    </body>
</html>

```
Hey, I'm trying to bind both json data AND query params in the same request.. when I use c.Bind and c.BindJSON together, gin tries to return a 400.

```
c.Bind(&example)
c.BindJson(&example)

```
Is there a way to avoid that 400 message?

`[GIN-debug] [WARNING] Headers were already written. Wanted to override status code 400 with 200`
Fix for #777, #640, #722.

Another try to make it faster into master :)
Almost same as #777 but handles one more case in tree.getValue.

@appleboy Please review it. With this (plus forcing UseRawPath) the drone became handling escaped params. Thanks!

Replaces #803
```sh
OS X 10.11.6
go version go1.7.3 darwin/amd64
```

my case
```go
// main.go
func main(){
 r := gin.Default()
 r.GET("/", func... )
 r.POST("/", func...)
 r.Run()
}
```
and I run `go run main.go` it's fast. another way:
```go
import (
 "my-project/routes"
 ...
)
func main() {
 r := gin.Default()
 r.GET("/", routes.Index)
 ...
 r.Run()
}
```
running very slowly.
I am new to Go, Did I have a mistake?




```
logFile, err := os.Create("production.log")
if err != nil {
  panic(err)
}
gin.DefaultWriter = io.MultiWriter(logFile, os.Stdout)
r := gin.Default()
```

^ I was expecting everything to be logged into a file & stdout. Everything is being logged into stdout but not everything is being logged into the file. Only http request logs are being logged:

```
[GIN] 2017/02/15 - 21:55:33 | 200 |  4.382883167s | 112.198.83.128 |   POST    /api/events
```

Logs generated by `log.Println("test")` are not being logged in the file.

Trying to download gin, I end up with following error:

```
$ go get gopkg.in/gin-gonic/gin.v1
# cd .; git clone https://gopkg.in/gin-gonic/gin.v1 /Users/wvierber/work/src/gopkg.in/gin-gonic/gin.v1
Cloning into '/Users/wvierber/work/src/gopkg.in/gin-gonic/gin.v1'...
error: RPC failed; HTTP 301 curl 22 The requested URL returned error: 301
fatal: The remote end hung up unexpectedly
package gopkg.in/gin-gonic/gin.v1: exit status 128
```

What am I missing / is this a known issue?

Thanks for helping me out!
Fix for #777, #640, #722.

Another try to make it faster into master :) 
Almost same as #777  but handles one more case in tree.getValue.

@appleboy Please review it. With this (plus forcing UseRawPath) the drone became handling escaped params. Thanks!

It's required to inform the format:

```go
type T struct{
        Time time.Time `form:"a_time" time_format:"02/01/2006"`
}
```

The default location is `time.Local`. If a `utc` tag is given, localtion is `time.UTC`:

```go
type T struct{
        Time time.Time `form:"a_time" time_format:"02/01/2006" utc:"1"`
}
```

If user input is blank (`""`), then `form.Time.IsZero()` will return `true`.
chore(errorHandler):new abortWithStatus method with Json body and contentType application/json
Hi there,
I'm trying to get the SockJS library for golang to work with Gin so I can do some realtime communications between rooms or channels that the clients can create.

However, I'm currently trying to test SockJS with Gin using a simple echo page that sends info to server and server sends it back for it to spit out on screen. I always end up getting a 404 on GET /echo/info. From Chrome console: `GET http://localhost:8000/echo/info?t=1486141708375 404 (Not Found)`

This is the console output:
```
[GIN] 2017/02/03 - 12:15:47 | 200 |     365.523µs | ::1 |   GET     /
[GIN] 2017/02/03 - 12:15:47 | 404 |       1.526µs | ::1 |   GET     /echo/info
```

Basic code below:

```go
func main() {
	router := gin.Default()
	handler := sockjs.NewHandler("/echo/", sockjs.DefaultOptions, echoHandler)

	router.LoadHTMLGlob("templates/*")
	router.GET("/", func(c *gin.Context) {
		c.HTML(http.StatusOK, "index.tmpl", gin.H{
			"title": "Main website",
	}))
	router.GET("/echo", gin.WrapH(handler))

	router.Run(":8000")
}

func echoHandler(session sockjs.Session) {
	log.Println("new sockjs session established")
	for {
		if msg, err := session.Recv(); err == nil {
			session.Send(msg)
			continue
		}
		break
	}
	log.Println("sockjs session closed")
}
```

and in my index template I have `var sock = new SockJS('http://localhost:8000/echo')` so the url address shouldn't be wrong.

Could anyone please help me with this issue?
I suddenly have this problem where some routes started to redirect back to `/` even if the handler is only:

	guest.GET("/register", func(c *gin.Context) {
		fmt.Println("register")
	})

Going to `localhost/register`, the cli logs this:

    [GIN] 2017/02/02 - 13:36:03 | 200 |     802.821µs | 127.0.0.1 |   GET     /

Which is quite weird because I specifically entered `/register` on the address bar.

And I'm also sure that I registered the correct route:

    [GIN-debug] GET    /register                 --> main.func1 (5 handlers)

The weirdest part is if I remove the route, so it won't register, the route still redirects back to the home page.
Simple english typos in the Copy() method
I get the error:

    [GIN-debug] [WARNING] Headers were already written. Wanted to override status code 400 with 301

When using something like:

    var err = c.Bind(&form)
    if err != nil {
      c.Redirect(301, "/")
    }

I saw this on BindWith

    c.AbortWithError(400, err).SetType(ErrorTypeBind)

Looks like it did already send the status code. Anyway, what is the correct approach? I'm trying to create a registration page where I want to redirect back to the registration page to display the errors.


I have a DELETE request in our RESTFUL API that requires the use of form data.  We are using the same block of code as we are for our POST request, but in the DELETE request the PostForm function doesn't seem to find the form data.

This is a code excerpt for what is called from the router.  It looks the same under our POST request and works just fine.  If this doesn't work, are there any suggestions for how I get access to form data for use in a DELETE request?

```
func deleteRequest(c *gin.Context)

	//GET form data
	pfAccountCode := c.PostForm("account_code")

	//Verify required fields
	if pfAccountCode == "" {
		err := fmt.Errorf("Error proccessing transaction. Mssing required form data: account_code)
		log.Println(err.Error())

		return err
	}

}
```
Currently, the usage of gopkg is viral, such that if a contributed Gin package or other third-party library uses gopkg as the import path for a library, they cannot work with users who use the `github.com/gin-gonic/gin` import path, and vice versa.

With the development of https://github.com/golang/dep continuing it looks like Go will likely standardize the package management story at some point around the `/vendor` folder with a tool that uses semver and a manifest file to manage reproducible builds.

I'm raising this now because I've had to write a similar wrapper to https://github.com/gin-contrib/sessions just because of this virality of gopkg.

I would like to propose instead that the official contrib libraries either vendor a tagged version of gin-gonic/gin that they support for testing, which would be flattened by any of the earlier mentioned dependency mgmt tools. Alternatively, simply notate the major version of Gin they support in README.md and ensure that CI pulls the latest major when running tests.

Thank you for the consideration.
Hi there, 
It would be great if changelog could be updated to reflect all the changes between versions.
Last modifications to the changelog have been made over a year ago.
please check . the same to [Issue#400](https://github.com/gin-gonic/gin/issues/400)
------------------------------------------------------------
Yes. I found gzip is invalid.
```go
package main

import (
	"fmt"
	"github.com/gin-gonic/contrib/gzip"
	"github.com/gin-gonic/gin"
)
func main() {
	r := gin.Default()
	r.Use(gzip.Gzip(gzip.BestCompression))
	r.GET("/ping", func(c *gin.Context) {
		fmt.Println("return string")
		c.String(200, "welcome to china, baby")
	})
	r.Run(":80")
}
```
**GOPATH\src\github.com\gin-gonic\contrib\gzip\gzip.go**
```go
func Gzip(level int) gin.HandlerFunc {
	return func(c *gin.Context) {

		if !shouldCompress(c.Request) {
			return
		}

		gz, err := gzip.NewWriterLevel(c.Writer, level)
		if err != nil {
			return
		}

		c.Header("Content-Encoding", "gzip")
		c.Header("Vary", "Accept-Encoding")
		c.Writer = &gzipWriter{c.Writer, gz}

		defer func() {
			c.Header("Content-Length", "0")
			gz.Close()
		}()
		c.Next()
	}
}
```

**questions:**
1. if set 
`c.Header("xxxContent-Encoding", "aaa")`
`c.Header("123Content-Encoding", "aaa")`
you can track the before Http header .
but if set
`c.Header("Content-Encodingxxxx", "aaa")`
couldn't track it
<&emsp>
2.  couldn't find any zip information . except: **`Vary: Accept-Encoding`**
```
HTTP/1.1 200 OK
Content-Type: text/plain; charset=utf-8
Vary: Accept-Encoding
Date: Thu, 19 Jan 2017 07:36:37 GMT
Content-Length: 22
welcome to china, baby
```


how to auto reload template file for debug ???? (in **SetHTMLTemplate** mode)

I was going to do a Redirect and noticed that there only is:
``` c.Redirect(code int, location string)```

Isn't it possible to also add something like
```c.RedirectTo(code int, handler gin.HandlerFunc)```

Right now you have to use a hardcoded path in the Redirect function, which is quite sad.

Thanks!
I am using this framework and testing an application. When I send heavy traffic using apache ab tool it shows this message:

```
Error 1040: Too many connections
exit status 1
```

How can I restart the app after an error like this.
```
go get -u gopkg.in/gin-gonic/gin.v1


gopkg.in/gin-gonic/gin.v1/context.go:498: cannot use sse.Event literal (type sse.Event) as type render.Render in argument to c.Render:
	sse.Event does not implement render.Render (missing WriteContentType method)
```


![screen2017-01-10 12-14-30](https://cloud.githubusercontent.com/assets/2770221/21794618/6692bb08-d72e-11e6-9767-5ca727aca47b.png)

thanks @im7mortal

Fix multitemplate link
I noticed that POSTing a multipart/form request, results in a file being created into /tmp/.
Is there anyway around this? I want to stream the content of the request without creating temp files.

Thanks
cc @tboerger @javierprovecho 
Use X-Forwarded-For before X-Real-Ip as Nginx uses X-Real-Ip with the proxy's IP.

fix #692 testing.

Signed-off-by: Bo-Yi Wu <appleboy.tw@gmail.com>
Hi, i'm learning Gin and Go and thought i might get some insight from you guys. 

I can't understand why Gin automatically sends an error 400 "Bad request" response when i try to bind and validate the incoming data from the a ajax request. 

I set up a simple struct and set the "binding" to "required" on the Name field so it can be validated server-side :

```
type MyForm struct {
    Name string `json:"name"  binding:"required"
    OtherField string `json:"otherfield"`
}

func HandleARoute(c *gin.Context) {

    var form MyForm
    err := c.BindJSON(&form)

    if err == nil {

        // if the binding is successful  i save things to the database and return 
        // my custom JSON "success"  message - this works as long as the 
        // binding is successful

        c.JSON(http.StatusOK, gin.H{
            "status": "success",
            "msg":    "Great, it was saved",
        })

    } else {

        // THIS NEVER GETS SENT
        // if the binding fails (e.g. the required field was not provided or any 
        // other error occured) i want to send my custom message but can't 
        // because Gin has already sent its own response that  looks like this:
        //
        // {"msg":"Key: 'Stream.Name' Error:Field validation for 'Name' failed on the 'required' tag","status":"binding error"}

        c.JSON(http.StatusOK, gin.H{
            "status": "success",
            "msg":    "Great, it was saved",
        })
    }

}
```

So my question is, what is the right way to handle such errors so that i can send my own customized error message back to the browser ?
@appleboy @tboerger this is a solution for #198.

I'm intrigued why [`http.ResponseWriter`](https://golang.org/src/net/http/server.go?h=ResponseWriter#L86) is not returning [`http.ErrBodyNotAllowed`](https://golang.org/src/net/http/server.go?h=ErrBodyNotAllowed#L39).

I don't have time to look into it right now, hope you can, or we can review it later this weekend.

There is no breaking changes except to those who import directly the following:
- [github.com/gin-gonic/gin/render](https://github.com/gin-gonic/gin/tree/master/render)
- [github.com/manucorportat/sse](https://github.com/manucorporat/sse)

Maybe I'm leaving something behind, so more eyes on this are welcome.
cc @javierprovecho 

Signed-off-by: Bo-Yi Wu <appleboy.tw@gmail.com>
Hey, here's an addition to `gin.Context` to allow easy checks of whether the client requested a websocket upgrade, so you can handle things cleanly.

```go
app.GET("/", func(c *gin.Context) {
  if c.IsWebsocket() {
    // Websocket request, so we can do something like:
    melody.HandleRequest(c.Writer, c.Request)
    return
  }
  // No websockets required, serve normally.
  c.HTML(http.StatusOK, ...)
}
```
if i use html/template  Delim ,i can't use html.rander in debug mode.

this caused me to restart the server everytime when i changed the template
This patch aims to fix issue #722 and PR #640 .

I'm currently developing an API with URL parameters with, for example : 
GET /user/:username

By assuming that username can contains special encoded parameters : 
- Jon%20Doe
- Slash%2FMe

The first one is not decoded by using c.Params("username").
The second one, using '/' is currently not working at all.

Using the '*' character does not fix the issue as I've got sub routes : 
GET /user/:username/infos

Feel free to comment. It aims to be a not-breaking change.
How can i remove route ? online!!!
Fixed #774 

## upload single file:

```go
package main

import (
	"github.com/gin-gonic/gin"
	"log"
	"net/http"
)

func main() {
	router := gin.Default()
	router.POST("/upload", func(c *gin.Context) {
		// single file
		file, _ := c.FormFile("file")
		log.Println(file.Filename)

		c.String(http.StatusOK, "Uploaded...")
	})
	router.Run(":8080")
}
```

curl command:

```sh
curl -X POST http://localhost:8080/upload -F "file=@/Users/mtk10671/z.sh" -H "Content-Type: multipart/form-data"
```

## upload multiple file:

```go
package main

import (
	"github.com/gin-gonic/gin"
	"log"
	"net/http"
)

func main() {
	router := gin.Default()
	router.POST("/upload", func(c *gin.Context) {
		// Multipart form
		form, _ := c.MultipartForm()
		files := form.File["upload[]"]

		for _, file := range files {
			log.Println(file.Filename)
		}
		c.String(http.StatusOK, "Uploaded...")
	})
	router.Run(":8080")
}
```

curl command:

```sh
curl -X POST http://localhost:8080/upload -F "upload[]=@/Users/mtk10671/z.sh" -F "upload[]=@/Users/mtk10671/z.sh" -H "Content-Type: multipart/form-data"
```

cc @selvam347 @tboerger @javierprovecho @andreynering

Signed-off-by: Bo-Yi Wu <appleboy.tw@gmail.com>
I can upload single file using [https://github.com/gin-gonic/gin/issues/548](url). 
```
package main
import "github.com/gin-gonic/gin"
import "log"
import "net/http"
import "io"
import "os"

func main() {
	router := gin.Default()
	router.POST("/upload", func(c *gin.Context) {
		file, handler, err := c.Request.FormFile("upload")
		filename := handler.Filename
		log.Println("Received file:", handler.Filename)
		out, err := os.Create("./tmp/" + filename)
		if err != nil {
			log.Fatal(err)
		}
		defer out.Close()
		_, err = io.Copy(out, file)
		if err != nil {
			log.Fatal(err)
		}
		c.String(http.StatusOK, "Uploaded...")
	})
	router.Run(":8080")
}
```
But how to upload array of files like the following,
`curl -X POST http://localhost:8080/upload -F "images[]=@/home/amp/hack/property1.jpg" -F "images[]=@/home/ack/property2.jpeg" -H "Content-Type: multipart/form-data"`

And give me suggestion for the same above code, how to get some parameters with documents. Finally request will be like,
```
{
  "client": {
    "name": "",
    "Industry": "",
    "profile_image": "PROFILE-IMAGE-FILE",
    "supporting_docs": {
      "docs": [
        "DOCUMENT1-FILE",
        "DOCUMENT2-FILE"
      ],
      "comments": "Comment test"
    }
  }
} 
```

RenderWith will is not panic while render is fail.
see the https://github.com/gin-gonic/gin/issues/742#issuecomment-264681292

cc @tboerger @javierprovecho 

Signed-off-by: Bo-Yi Wu <appleboy.tw@gmail.com>
Is there a reason for this (appart from performance) ?
It seems to me that it might be a usual case wanting to send errors to
a logging platform or service which takes time, and a good way of doing
that may be copying the context. Of course it can be done manually, but
it seems to me that the semantics of Copy include copying .Errors.
Fixed #769 

```go
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	// Disable Console Color
	gin.DisableConsoleColor()
	r := gin.Default()

	// Ping test
	r.GET("/ping", func(c *gin.Context) {
		c.String(200, "pong")
	})
}
```
white on bright yellow is pretty hard to read for me. Is there a way to disable color output?
The following request works properly for the below code. 
`curl -X POST localhost:5005/user --data '{"name":"Neel", "email":"neel-test@theamp.com" }' -H "Content-Type:application/json" -H "Authorization:Bearer <AuthToken>"`
```go
type User struct {
	Name  string `gorethink:"name" json:"name"`
	Email string `gorethink:"email" json:"email" binding:"required"`
}

func CreateUser(c *gin.Context) {
	var user User
	if c.BindJSON(&user) == nil {
		fmt.Println("Name", user.Name)
		fmt.Println("Email", user.Email)
                saveUser(user)
	}
}
```
How to change the above code to bind nested json. For example the request will be,
`curl -X POST localhost:5005/user --data '{ "user": {"name":"Neel", "email":"neel-test@theamp.com" }, "send_request":true }' -H "Content-Type:application/json" -H "Authorization:Bearer <AuthToken>"`
.
```
router.GET("/user/:name/*action", func(c *gin.Context) {
        name := c.Param("name")
        action := c.Param("action")
        message := name + " is " + action
        c.String(http.StatusOK, message)
    })
```
this is from the documentation and I expect these:
```
/user/mehdy    -> name: "mehdy", action: ""
/user/mehdy/   -> name: "mehdy", action: ""
/user/mehdy/do -> name: "mehdy", action: "do"
```
but I get these as a result which I think it's not logical:
```
/user/mehdy    -> name: "mehdy", action: ""
/user/mehdy/   -> name: "mehdy", action: "/"
/user/mehdy/do -> name: "mehdy", action: "/do"
```

is it a bug or did I misunderstand the feature?
Hello,
I want to call function in the template, the code is like this.

```html
<img src="{{ imageURL(.Image) }}" />
```

```go
func imageURL(u string){
  return "uploads/" + u
}
```


We have some code in our codebase that is untestable because it is difficult to make a complete test Context object like the one that is in helpers_test.  
CreateTestContext

Would it be possible to expose the CreateTestContext method in a way that users of this 3rd party library could import it?
Hello there,
Trying a new install I found context.go calling:
```
import (
	"github.com/gin-gonic/gin/binding"
        "github.com/gin-gonic/gin/render"
)
```
So a clean install with v1 package still need github develop libraries ?
I guess it's a 'forgotten'...?
I am not sure but it seems this function just do nothing, so when using c.JSON, the Content-Type header is not set.

```
func writeContentType(w http.ResponseWriter, value []string) {
    header := w.Header()
    if val := header["Content-Type"]; len(val) == 0 {
        header["Content-Type"] = value
    }
}
```

I have the problem on my code and I opened this thread on Stackoverflow : http://stackoverflow.com/questions/41109065/golang-gin-gonic-content-type-not-setting-to-application-json-with-c-json
reference: https://github.com/appleboy/golang-testing/blob/master/coverage.sh

Waiting https://github.com/gin-gonic/gin/pull/756 PR.

cc @javierprovecho @tboerger 
I define some template function, such as unescaped: 

    func unescaped(x string) interface{} { return template.HTML(x) }

then I use it in my template.

If I use this:

    .....
    e.LoadHTMLGlob("views/*")
    // template funcs
	e.SetFuncMap(template.FuncMap{
		"unescaped": unescaped,
	})

then, the template compile failed with function unescaped not defined;

If I use this:

    .....
    // template funcs
	e.SetFuncMap(template.FuncMap{
		"unescaped": unescaped,
	})
    e.LoadHTMLGlob("views/*")

then, SetFuncMap will failed:

    SetFuncMap failed: cannot convert.

because gin.Engine has not initialize the render


Last change to logger broke status and request type colours in IntelliJ console.

I just see that gin is in the middle of switching vendor tool. That is cool, but I am just wondering why Glide wasn't chosen instead, which was "supposed to be" the preferred vendoring tool for Go (at least I read that somewhere a while back).

https://github.com/Masterminds/glide/wiki/Go-Package-Manager-Comparison

Feel free the close this issue, it's mainly just a question.
- Migrate from godep to govendor
- Update vendor.json
  - **We must** search or develop an alternative to github.com/mattn/go-isatty, it pulls golang.org/x/sys/unix which weights about 4 MB only for this file: https://github.com/mattn/go-isatty/blob/master/isatty_solaris.go
- Update .travis.yml
  - If we start to use heavily vendor systems, we must test against Go versions that support it, I mean `>= 1.6`.
  - App Engine is actually on `1.6.3`, waiting for security patch to be deployed.
  - Quicker CI with `git: depth 3`
- Packages refs updates here: https://github.com/gin-gonic/gin/pull/756/commits/44529e4a348c1d76594237677cec72eaa2753beb

Fixed #744 
Fixed #752 
Fixed #753 

cc @javierprovecho @tboerger @aviddiviner @kujenga
**critical issue #752**

Please help to review.

cc @javierprovecho @tboerger 

Signed-off-by: Bo-Yi Wu <appleboy.tw@gmail.com>
A recent commit [1] brought in the use of the `terminal.IsTerminal` function. That function is not available at compile time on Google App Engine, as can be seen in the `!appengine` build tag for the file implementing it [2].

[1] https://github.com/gin-gonic/gin/commit/32cab500ecc71d2975f5699c8a65c6debb29cfbe#diff-40646a6e1108f49d452915ba3515c206
[2] https://github.com/golang/crypto/blob/master/ssh/terminal/util.go


It seems like the middleware ability via Use is designed to operate on Requests. I think it would be useful to provide a Response level middleware feature as well. (if there is a way to do this currently please point me to it) Thanks.
Im trying an example but I got 401 status.

Is there is any basic auth by default?

my source is like:

``` go
func main() {
        r := gin.Default()

        v1 := r.Group("v1")
        {
                v1.POST("/validate", PostValidation)
                v1.DELETE("/validate/:id", DeleteValidation)
        }

        r.Run(":8080")
}
I have a use case where the list of exposed apis should be available as an api, where admin user can add some additional parameter for storing to DB.

What I essentially need is to get the matched route in context for processing in middleware or handler function. 

```
router.GET("/get_user_details",func (c *gin.Context){c.JSON(200, gin.H{
           "matched_route":c.MatchedRoute(),
        })})
```

So it there some like c.MatchedRoute or some other way to achieve the result?



… the value of action param is /*{action}.

The example:
func main() {
    router := gin.Default()

    // This handler will match /user/john but will not match neither /user/ or /user
    router.GET("/user/:name", func(c *gin.Context) {
        name := c.Param("name")
        c.String(http.StatusOK, "Hello %s", name)
    })

    // However, this one will match /user/john/ and also /user/john/send
    // If no other routers match /user/john, it will redirect to /user/john/
    router.GET("/user/:name/*action", func(c *gin.Context) {
        name := c.Param("name")
        action := c.Param("action")
        message := name + " is " + action
        c.String(http.StatusOK, message)
    })

    router.Run(":8080")
}

if you access localhost:8080/user/john/send, you will get john is **/send** instead of **send**.
There have been at least a couple of discussions in the past about good error handling strategies in middleware (see #665 and #274). It would be great if the outcome of those discussions would be summarized in the documentation...perhaps under **Custom Middleware** in the README file?


Here's a little improvement to the default logger so that the output isn't colorised if we're not outputting to a terminal. So, if we run with `./server | tee my.log` then instead of my log file looking like this:
```
[GIN] 2016/11/17 - 16:28:44 |^[[97;42m 200 ^[[0m|   24.459651ms | ::1 |^[[97;44m  ^[[0m GET     /
[GIN] 2016/11/17 - 16:28:44 |^[[97;42m 200 ^[[0m|  1.766299995s | ::1 |^[[97;44m  ^[[0m GET     /ws
[GIN] 2016/11/17 - 16:28:44 |^[[97;42m 200 ^[[0m|   11.265361ms | ::1 |^[[97;44m  ^[[0m GET     /static/favicon.gif
```

It looks like this:
```
[GIN] 2016/11/17 - 16:28:44 | 200 |   24.459651ms | ::1 |   GET     /
[GIN] 2016/11/17 - 16:28:44 | 200 |  1.766299995s | ::1 |   GET     /ws
[GIN] 2016/11/17 - 16:28:44 | 200 |   11.265361ms | ::1 |   GET     /static/favicon.gif
```

The same applies to any pipe. You can see this in action by just running `./server | cat`

This does add an extra dependency on `golang.org/x/crypto/ssh/terminal` but it's pretty widely used and stable. I did consider copying over the `IsTerminal` function, but there's a bit of tricky syscall magic there and I'd rather they take care of it.

The other change I could think you might want to do, is assume that it's not a terminal if it isn't a valid `*os.File`, so change line 50 to:
```go
isTerm := false
```
That might be nice for people funnelling their logs off to other random `io.Writer`s that don't want the ANSI code spam. But I've just kinda left it as it is for now.

Let me know what you think! Thanks 😄
I tried to install gin by go get gopkg.in/gin-gonic/gin.v1,
But getting error like
![gin failed](https://cloud.githubusercontent.com/assets/7258031/20361827/c4e9041a-ac17-11e6-8548-e5f009838ff3.png)

```go
package main

import "log"
import "github.com/gin-gonic/gin"

type Person struct {
	Name    string `json:"name"`
	Address string `json:"address"`
}

func main() {
	log.Println("Hello World")
	route := gin.Default()
	route.GET("/testing", startPage)
	route.Run(":8085")
}

func startPage(c *gin.Context) {
	var person Person
	if c.BindJSON(&person) == nil {
		log.Println(person.Name)
		log.Println(person.Address)
		log.Println("Binding success...............")
	} else {
		log.Println("Binding failed...............")
	}

	c.String(200, "Success")
}

```
The above code works only for `curl -X GET localhost:8085/testing --data '{"name":"JJ", "address":"xyz"}' -H "Content-Type:application/json"` but not `curl -X GET localhost:8085/testing?name=JJ&address=xyz  -H "Content-Type:application/json"`

if i use `c.Bind(&person)`, binding failed  both case.
How can i write the above code which binds both query string and json.
Gin normally silently swallows errors writing to the client; however in WriteJSON (and thus context.JSON), the ResponseWriter was being passed directly into the JSON encoder, which will return an error if there's an error writing to the stream. For instance, context.JSON would panic with errors like "write tcp XXX-> YYY: write: connection reset by peer" if the client disconnected before the response was complete. This change makes JSON.Render() treat write errors the same as IndentedJSON, Data, and other renderers (i.e. it ignores them).
router.GET("/index",func(c *gin.Context){
		c.HTML(http.StatusOK, "upload.html", gin.H{
            "title": "Main website",
        })
	} )

If the the browser types http://......../index ,how do I parse the html and change it,and last publish it to the browser.
```go
c.Redirect(http.StatusMovedPermanently, "https://example.com"+c.Request.RequestURI);
```

...Is this safe to do?
Could it be made explicit in the documentation that gin is using gopkg.in/go-playground/validator.v8 as the default validation library? I spent several hours thrown off thinking gin uses https://github.com/gin-gonic/validator and implemented validation against that based off of documentation at https://gowalker.org/github.com/gin-gonic/validator. It would appear that https://github.com/gin-gonic/validator is stale and not being developed anymore? Can that repository be removed or at least a disclaimer mentioned that this library is not in use with gin at the moment?

The documentation only describes being able to add a binding:"required", but there are much more available validation options available with validator.v8. It would be beneficial if at least a link to their documentation in the[ model binding and validation](https://github.com/gin-gonic/gin#model-binding-and-validation) section is provided.
```
type Req struct {
    Field int `json:"field" binding:"required"`
}

func handler(ctx *gin.Context) {
    req := &Req{}
    err := ctx.BindJSON(&req)
}
```

```
"Key: 'Req.Field' Error:Field validation for 'Field' failed on the 'required' tag"
```

So how to avoid the error if I need to parse ```{"field":0}``` ?
In other frameworks like Ruby on Rails, they are having directory structure like where to keep model related code, where to keep view related code, where to keep controller related code and where to seed DB. Is there any directory organization in gin-gonic? Or Any suggestion? 
hi,I am new to gin. Ｉwant publish a html file,this file(upload.html) import some js files.but it dosn't work. if remove this js files,it works well.   can anybody  help me? 
 Excuse for my poor english!

```go
func main(){	
	router := gin.Default()
	router.LoadHTMLGlob("templates/*")
//    router.LoadHTMLFiles("templates/upload.html")
    router.GET("/index",func(c *gin.Context){
		c.HTML(http.StatusOK, "upload.html", gin.H{
            "title": "Main website",
        })
	} )
	router.POST("/upload",uploadHandler)            
    router.Run(":8080")                       
}
```
Added version 1.7 to travis.yml
Replace old github.com imports with gopkg.in with fixed version
Hi, 

Was looking to drop a few very small contributions to this project, but first thing I noticed after forking was a few failing tests on my fork so I wondered if some tiny test clean ups would be a good pull req. 

- Added a runtime.GOOS check for TestUnixSocket and TestBadUnixSocket to abort tests on Windows to avoid panic.
- Replaced the 'org' check in nameOf function assertions to use .*? to avoid test failures in forks.

Cheers
I want to use the gin with the gRPC to backend communication.
But gRPC require newer versions of golang.org/x/net and protocolbuffer.
So do you have a plan to update package info of Godeps.json.


Hi everyone!

I am pretty new to Golang, so maybe this is a newbie question.
What I am trying to do – to add tags field, and it is a select2 select box with multiple choices. So, basically, it is the following HTML:

``` HTML
<select name="tags" multiple="multiple">
   <option value="id_1">Prague</option>
   <option value="id_2">Novi Sad</option>
   <option value="id_3">Vienna</option>
</select>
```

But if I read it through `c.PostForm("tags")`, it shows me only the first value. 

I haven't found the answer, but I've found that I can do the next:

``` go
c.Request.ParseMultipartForm(5 * 1024 * 1024)
tags := c.Request.Form["tags"]
fmt.Println(tags)
```

It works, but I wonder whether it is correct approach or not.

Thank you!

cc @javierprovecho @tboerger 

Signed-off-by: Bo-Yi Wu appleboy.tw@gmail.com



Hi

This PR addresses https://github.com/gin-gonic/gin/issues/421

This change increases extensibility and flexibility.  This change would facilitate mocking of `IRouter`.

Thanks for the consideration.  Cheers.

The only reason to import "golang.org/x/net/context" package is to check that `*gin.Context` implements `context.Context` interface. But this implies fetching whole "golang.org/x/net" package tree using `go get`. So moving this check to `context_test.go` is reasonable.
This also resolves issues #469 and #684.

App Engine does not attach the client's port number to "RemoteAddr". Google says they have no plans to change this behavior: https://code.google.com/p/googleappengine/issues/detail?id=11730

Running it through `SplitHostPort()` can provide inconsistent behavior with IPv6, as the colons in the IPv6 address may cause the final block of a formatted IPv6 address to be truncated with the last portion being treated as the port.

I've noticed that with this handler:

> /test/:phrase

...These URLs are not processed correctly:
- **http://localhost/test/Two+Words** ... Returns "Two+Words" for `c.Param("phrase")` instead of "Two Words" ("+" should translate to space, as "%2B" = "+")
- **http://localhost/test/Two%2FWords** ... Returns 404 error, not "Two/Words"

A workaround for the first one is to manually replace any "+" characters with "%20" in the URL before it reaches Gin, but to me that's not preferable. The "+" character encodes as "%2B" so why is this happening?

https://github.com/gin-gonic/gin#parameters-in-path
vs.
https://github.com/gin-gonic/gin/blob/master/examples/app-engine/hello.go

... Is it possible to combine these two concepts without hand-parsing things from the path?

Hi there,

I'm using gin for an international website where HTML templates need to be localized. Go's html/template can do this via custom functions that are to be injected before parsing or loading the template files.

Ideally I'd have patched this feature into HTMLRender but the fact that its interface is used in many other renderers prohibited it, so you can now set the custom functions in Engine and the HTML renderer picks them up when loading the templates.

Cheers,
Tobias

After checking #562 , I post 10 images (500KB) to `gin`,  code :

``` go
    func extractImgs(c *gin.Context) {
        prefix := "prefix"
        for ix := 0; ix < 10; ix++ {
            file, _, err := c.Request.FormFile(prefix + strconv.Itoa(ix))
            if err != nil {
                // do sth.
                return
            }
            // call face recognition algorithm
            face_rec_async(file)
        }
    }
```

`c.Request.FormFile` cost a lot time. It seems like that `FormFile` returns `file` after retrieved all 10 files.

Face recognition is time-consuming algorithm, this workflow should be better: 

> retrieve first file ->  recognize face -> retrieve second file -> recognition -> ... ,

just like a link list.

My question is how to retrieve files like traverse  linked list.

Hello,
When you use `*gin.Context` outside of the request context (with new goroutine), there are race condition.
For example:
```
WARNING: DATA RACE
Read at 0x00c421b13ef8 by goroutine 767:
  github.com/gin-gonic/gin.(*Context).Value()
     ***/github.com/gin-gonic/gin/context.go:183 +0xcc

Previous write at 0x00c421b13ef8 by goroutine 368:
  ****************
      ***/github.com/gin-gonic/gin/context.go:177 +0x41a
```

The godoc say:
```
Copy returns a copy of the current context that can be safely used outside the request's scope.
This has to be used when the context has to be passed to a goroutine.
```

Unfortunatly, I pass `*gin.Context` as `context.Context` (from SDK go). If I add some deadline or value to  `context.Context` then I can't anymore do type insertion because context.Context is no longer `*gin.Context` but `*context.valueCtx` (panic : `interface conversion: context.Context is *context.valueCtx, not *gin.Context`)

So the ugly workaround, that I found, is call Copy before pass `*gin.Context` as `context.Context` even if I don't use it outside the request context (I can know before, that depend of external info)
ref #801

This enables to specify the location to `time.Time` type in form binding.  It uses `time_location` tag.

```go
type T struct{
        Time time.Time `form:"a_time" time_format:"02/01/2006" time_location:"Asia/Tokyo"`
}
```
var port  = “8080”
func main() {
	mainRouter := gin.Default()
	mainRouter.GET("/ping", func(c *gin.Context) {
		c.JSON(200, gin.H{
			"message": "pong",
		})
	})
	**mainRouter.RunTLS(":"+port, "server.pem", "server.key")**
}

Is it necessary to provide server.pem and server.key to start a tls server , Cant this ssl check can be done at Load Balancer level which resides on the top of gin server ?

I want my application to be independent of the ssl check , is this possible to start server without providing certificate like mainRouter.RunTLS(":"+port)

Purpose - i need to serve http2 request with gin .

Here is sample of my log output:
 ```
[ORM] 2017/09/21 - 16:52:08 | SQL |    0.270000ms | SELECT * FROM "transactions"   ORDER BY posting_date
[GIN] 2017/09/21 - 16:52:08 | 200 |     695.821µs |       127.0.0.1 | GET      /api/transactions
[GIN] 2017/09/21 - 16:52:08 | 200 |      822.19µs |       127.0.0.1 | GET      /api/transactions
[ORM] 2017/09/21 - 16:52:19 | SQL |    2.080000ms | SELECT * FROM "transactions"   ORDER BY posting_date
[GIN] 2017/09/21 - 16:52:19 | 200 |    2.338551ms |       127.0.0.1 | GET      /api/transactions
[GIN] 2017/09/21 - 16:52:19 | 200 |    2.437027ms |       127.0.0.1 | GET      /api/transactions
```

I'm having this error when I'm trying to add a function to a template:
```
func main() {
        router := gin.Default()
	router.Use(gin.Logger())
	router.SetFuncMap(template.FuncMap{
	     "getData": getData,
	})
}
```
router.SetFuncMap undefined (type *gin.Engine has no field or method SetFuncMap)

I tried go get -u but nothing changes. What could be the problem?


Support negotiation wildcards, fix #391.


I have a rice box with structure `public/static/`:

```go
	publicBox := rice.MustFindBox("public")
	r.StaticFS("/static", publicBox.HTTPBox())
```

Is it possible to point `/static` location to `/` of box so that request to `/static` went to `public/static/`, not to `public/static/static/`?
My template file path is as follows:
<img width="234" alt="2017-09-15 3 10 05" src="https://user-images.githubusercontent.com/1724962/30470774-aca75ed8-9a28-11e7-845b-e70c9e010f98.png">

The code for setting up templates is `router.LoadHTMLGlob("views/**/*")`
，but the error is `panic: read views/admin/enterprise: is a directory`
How to  recursive template files？Thanks

Hi, I'm struggling to find good examples of testing a gin application using {httptest.NewRecorder,gin.CreateTestContext,Result()} paradigm.

For example I simply want to test the error codes is 400 for fail and 200 for pass. How best do I accomplish this?


```
package main

import (
        "os"

        "github.com/gin-gonic/gin"
)

func main() {
        port := ":" + os.Getenv("PORT")

        r := gin.Default()
        r.GET("/fail", fail)
        r.GET("/pass", pass)
        r.Run(port)
}

func fail(c *gin.Context) {
        c.JSON(400, gin.H{"message": "failzone"})
}

func pass(c *gin.Context) {
        c.JSON(200, gin.H{"message": "great successs!"})
}
```
main_test.go

```
package main

import (
        "fmt"
        "net/http"
        "net/http/httptest"
        "testing"

        "github.com/gin-gonic/gin"
        "github.com/stretchr/testify/assert"
)

func TestFail(t *testing.T) {
        gin.SetMode(gin.TestMode)
        rec := httptest.NewRecorder()
        c, _ := gin.CreateTestContext(rec)
        c.Request, _ = http.NewRequest("GET", "/fail", nil)
        fmt.Println("recorder", rec.Code)
        res := rec.Result()
        fmt.Println("results", res.StatusCode)
        assert.Equal(t, 400, res.StatusCode)
        c.Request, _ = http.NewRequest("GET", "/pass", nil)
        assert.Equal(t, rec.Code, 200)
}

```
Is Map as query parameter supported? And if it is how to use it? I tried with:

`localhost:8080?test[asd]=asd&test[dsa]=dsa`

and the code 

```
queries := c.Request.URL.Query()
// Doesn't work
log.Println(queries["test"])
// Gets the variable but not how I want it.
log.Println(queries["test[asd]"][0])
```
1.9.x should be working now.


my query string is 

i use the log.Println(c.Request.URL.RawQuery)
can output, the user agent  is encodeURI string
userAgent=Mozilla/5.0%20(Macintosh;%20Intel%20Mac%20OS%20X%2010_12_6)%20AppleWebKit/537.36%20(KHTML,%20like%20Gecko)%20Chrome/60.0.3112.113%20Safari/537.36

but   
userAgent := c.Query("userAgent")
log.Println("userAgent",userAgent)

output is 
userAgent Mozilla/5.0 (Macintosh

i don't know why?

The mothod is more readable because it's more obvious s is a string and not a slice.
Currently there is no option to set the amount of memory the http.Request is allocating when ParseMultipartForm is called, other than the const value 'defaultMemory'.

This PR moves that constant value from the Context to the Engine, so that a different value can be set.

Examples and README.md has been updated accordingly.
Is it even possible? With bare http:

```go
server := http.Server{
    Addr:      cfg.ListenHttps,
    Handler:   http.HandlerFunc(handler),
    TLSConfig: tlsConf,
}
server.ListenAndServeTLS("", "")
```
This commit changes `ShouldBind` `400` error code to `422(Unprocessable Entity)` because it makes more sense for validation errors
#1075
In the previous version
```go
isTerm := true

if w, ok := out.(*os.File); !ok ||
	(os.Getenv("TERM") == "dumb" || (!isatty.IsTerminal(w.Fd()) && !isatty.IsCygwinTerminal(w.Fd()))) ||
	disableColor {
	isTerm = false
}
```

when `out` comes from `colorable.NewColorableStdout()` as [the doc suggested](https://github.com/gin-gonic/gin/blob/master/mode.go#L31), `out` will actually be `*colorable.Writer` type and will fail the type assertion `out.(*os.File)`, but `out` here, wrapped by `colorable`, is indeed a valid terminal that supports colors.

```go
package main

import (
	"fmt"
	"os"

	"github.com/mattn/go-colorable"
)

func main() {
	colored := colorable.NewColorableStdout()
	_, ok := colored.(*os.File)
	fmt.Println(ok) //=> false
}
```

Instead of judging whether `out` is an `io.Writer` wrapped by `colorable` or not in the case, I tried to utilize `github.com/mattn/go-colorable` directly here. Hopefully it's acceptable.

@mattn I think an `io.Writer` wrapped by `colorable` should be considered a terminal, but it may be hard to apply this to your `github.com/mattn/go-isatty`, as `github.com/mattn/go-colorable` depends on it and making the former depends on the latter may lead to circular reference.
	// However, this one will match /user/john/ and also /user/john/send
	// If no other routers match /user/john, it will redirect to /user/john/
	router.GET("/user/:name/*action", func(c *gin.Context) {
		name := c.Param("name")
		action := c.Param("action")
		message := name + " is " + action
		c.String(http.StatusOK, message)
	})
name is john but action is /send why with '/'?
I think bit operations is not human readable in such usecases (compiler optimaze it anyway)
Hi,

It's possible I just don't understand how to use the validations correctly, but I am trying to bind this form object:

```
type Form struct {
   Age int `binding:"required,number"`
}
```

but when testing supplying a string value in the form submission, it errors with an `strconv.Atoi` error instead of providing a validation error. It looks like it's failing when converting the data into my Form type, instead of first validating it.

Is there a recommended pattern for handling this? Using a `interface{}` or `string` for what should be an `int` field doesn't seem ideal.

I try to use ``c.BindJson`` for validation but it forces me to send `400` status code and `plain text` content type. Is there any way to send custom header/response with it?
  
If no, I can add it to the framework and send a merge request. Let me know.
Thanks in advance.

i test gopkg.in/gin-gonic/gin.v1 and github.com/gin-gonic/gin

i disable log 


	gin.SetMode(gin.ReleaseMode)
	public := gin.New()


and my log

```
http: TLS handshake error from 2.61.29.56:3467: tls: oversized record received with length 23801
http: TLS handshake error from 2.61.29.56:3468: tls: oversized record received with length 23801
http: TLS handshake error from 2.61.29.56:3474: tls: oversized record received with length 21536
http: TLS handshake error from 2.61.29.56:3475: EOF
http: TLS handshake error from 80.93.120.44:57317: EOF
http: TLS handshake error from 80.93.120.44:56541: EOF
http: TLS handshake error from 80.93.120.44:56021: tls: oversized record received with length 19029
http: TLS handshake error from 80.93.120.44:58616: tls: oversized record received with length 19030
http: TLS handshake error from 80.93.120.44:60805: tls: oversized record received with length 19030
http: TLS handshake error from 80.93.120.44:55553: tls: oversized record received with length 19030
http: TLS handshake error from 80.93.120.44:51292: tls: oversized record received with length 19031
http: TLS handshake error from 80.93.120.44:54123: tls: oversized record received with length 19030
http: TLS handshake error from 80.93.120.44:50073: tls: oversized record received with length 19035
http: TLS handshake error from 80.93.120.44:59981: tls: oversized record received with length 19035
http: TLS handshake error from 2.61.29.56:3512: tls: first record does not look like a TLS handshake
http: TLS handshake error from 2.61.29.56:3513: tls: first record does not look like a TLS handshake
http: TLS handshake error from 2.61.29.56:3517: tls: first record does not look like a TLS handshake
http: TLS handshake error from 2.61.29.56:3524: tls: oversized record received with length 21536
http: TLS handshake error from 2.61.29.56:3526: tls: oversized record received with length 21536
http: TLS handshake error from 2.61.29.56:3519: tls: first record does not look like a TLS handshake
http: panic serving 171.33.254.131:56942: write tcp 171.25.232.16:8080->171.33.254.131:56942: write: broken pipe
goroutine 1668770 [running]:
net/http.(*conn).serve.func1(0xc45aebc500)
	/usr/local/go/src/net/http/server.go:1697 +0xd0
panic(0xaf5480, 0xc468e93bd0)
	/usr/local/go/src/runtime/panic.go:491 +0x283
gopkg.in/gin-gonic/gin%2ev1.(*Context).Render(0xc45b260a50, 0xc8, 0x1112f40, 0xc45523c870)
	/home/deepweb/ivs/src/gopkg.in/gin-gonic/gin.v1/context.go:597 +0x160
gopkg.in/gin-gonic/gin%2ev1.(*Context).Data(0xc45b260a50, 0xc8, 0xbcb377, 0xa, 0xc445268000, 0x598c4, 0x7734a)
	/home/deepweb/ivs/src/gopkg.in/gin-gonic/gin.v1/context.go:650 +0xb8
main.AppHlsStreamTS(0xc45b260a50)
	/home/deepweb/ivs/ModuleServerAPI.go:717 +0x235
gopkg.in/gin-gonic/gin%2ev1.(*Context).Next(0xc45b260a50)
	/home/deepweb/ivs/src/gopkg.in/gin-gonic/gin.v1/context.go:104 +0x43
gopkg.in/gin-gonic/gin%2ev1.(*Engine).handleHTTPRequest(0xc421244000, 0xc45b260a50)
	/home/deepweb/ivs/src/gopkg.in/gin-gonic/gin.v1/gin.go:332 +0x5b4
gopkg.in/gin-gonic/gin%2ev1.(*Engine).ServeHTTP(0xc421244000, 0x1114700, 0xc47763c000, 0xc5944b0600)
	/home/deepweb/ivs/src/gopkg.in/gin-gonic/gin.v1/gin.go:296 +0x16b
net/http.serverHandler.ServeHTTP(0xc4212f21a0, 0x1114700, 0xc47763c000, 0xc5944b0600)
	/usr/local/go/src/net/http/server.go:2619 +0xb4
net/http.(*conn).serve(0xc45aebc500, 0x1115500, 0xc421dc7e00)
	/usr/local/go/src/net/http/server.go:1801 +0x71d
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2720 +0x288
http: TLS handshake error from 2.61.29.56:3529: EOF
http: TLS handshake error from 176.213.126.183:1602: EOF
```

How can I turn off these errors. ?
write: broken pipe - The client interrupted the download of the file and I do not see this as an error.
http: TLS handshake error - I, too, would not want to see this.

Ref #1075
- fix gins Undefined
I ran into an issue when an int in a JSON message was accidentally passed in as a string. The caller e.g. curl hangs and the error is "unexpected character...".

I have a small gin server like so:
```go
package main

import (
	"fmt"

	"github.com/gin-gonic/gin"
)

func main() {
	r := gin.New()
	r.Use(gin.ErrorLogger())
	r.POST("/messages", handleMessage)
	r.Run(":8080")
}

type Message struct {
	Number int `json:"number"`
}

func handleMessage(c *gin.Context) {
	p := &Message{}
	if err := c.BindJSON(p); err != nil {
		fmt.Println("ERROR", err)
		return
	}
}
```

Build and run this and then make a call with curl:

```
curl -v -X POST -d '{"number":"5"}' localhost:8080/messages
```

Curl hangs and there is an error printed in the server console:

```
ERROR main.Message: Number: readUint64: unexpected character: �, parsing 11 ..."number":"... at {"number":"5"}
```

I've seen this now on both Linux and OSX.

Go version: go version go1.7.4 darwin/amd64
Gin hash: `65a6dd46a50bd435597b5bcababd1b2a811c9073`


# TL;DR

- API stability and deprecation policy
- v2?

---
cc @appleboy @tboerger @nazwa @easonlin404 @thinkerou 

I'm worried on how to keep going and scale the API without breaking everything in a v2. Some people who use Gin love the new activity and features, but want Gin as it is now, somehow API stable. Others want a continuous development and deprecation of prior versions.

Because this is not JS, and there is no `package.json` pre-included, I see it's hard for beginners to understand the difference between `go get ...` and `vendor/` folder and tools.

Projects that use Gin like `drone-io` have it vendor on a version from January 2016.

I was thinking on ways of allowing API changes with deprecation notices like it's being done now in `deprecated.go`.

An idea from the jsonite contribution and the build flags:

- added to *_experimental.go
- moved to *.go
- deprecated to deprecated.go (with printf warning)
- deprecated to *_deprecated.go (for very old builds)

I would like to know your thoughts on this, not just the idea above. Thanks 😃 

PD: everyone is encouraged to participate too.
cc @javierprovecho 
Signed-off-by: Bo-Yi Wu <appleboy.tw@gmail.com>
Keys need to be canonicalized via `textproto.CanonicalMIMEHeaderKey()`.

fix #1079

Changing from my original implementation that retrieved a header directly from a request to the `GetHeader` function failed because it turned out that my casing for the header wasn't correct - the h should be lowercase; the `Header.Get` implementation tolerated that however.

Old working code

```
eventType := c.Request.Header.Get("X-GitHub-Event")
```
New failing code

```
eventType := c.GetHeader("X-GitHub-Event")
```

Wouldn't it make sense to make the retrieval case insensitive? I think different casing for headers is actually pretty common.
When using `BindJSON` multiple times in a single request handler like below it fails the second time because the `c.Request.Body` has already been read the first time and can't be read a second time.

```
var b interface{}
err := c.BindJSON(&b)
...
var requestBody RequestBody
err = c.BindJSON(&requestBody)
```

I do this to be able to log the full structure of a request body coming into my application so I can refine my `RequestBody` struct one property at a time. Also when unMarshalling fails I log the origin body as a string, but using the body `ReadCloser` fails if `BindJSON` already ran.

A workaround is to go back to the non-gin way of reading the body first

```
body, err := ioutil.ReadAll(c.Request.Body)
...
var b interface{}
err = json.Unmarshal(body, &b)
...
var requestBody RequestBody
err = json.Unmarshal(body, &requestBody)
```

But that obviously isn't very nice. 

According to https://stackoverflow.com/questions/31884093/read-multiple-time-a-reader using a `io.TeeReader` in your code would solve the issue. Is that sensible or too slow? Any other options?
part of #1075 

See the warning list from go report card service:

https://goreportcard.com/report/github.com/gin-gonic/gin#golint


updated before：
![image](https://user-images.githubusercontent.com/4488261/29526559-affd8ad0-86c8-11e7-9c99-efa326c87e99.png)
upupdated after：
![image](https://user-images.githubusercontent.com/4488261/29526594-c604f728-86c8-11e7-85e2-fe79fe46c6d3.png)

I wanna use gin for video streaming.
When I use `io.Copy(c.Writer, reader)`,  I always got `write tcp [::1]:8080->[::1]:60336: write: broken pipe` error

But if I go to use simple http ResponseWriter, `io.Copy(...)`, it will be ok.

Is there anything I need to pay attention to?

This is my first issue post, If anything I need to know, pls tell me.
Thanks.

```go

log.Infof("Get S3Object: %v", mediaObject.ObjectName)
reader, err := getCachedReader(mediaObject.ObjectName)
//reader, err := s3Adapter.GetS3Object(mediaObject.ObjectName)
if err != nil {
	c.AbortWithError(http.StatusInternalServerError, err)
	return
}
defer reader.Close()

fileSize := int(mediaObject.Size)
contentEndValue := fileSize - 1
var renderStatus int
if len(c.GetHeader("Range")) == 0 {
	contentLength := strconv.Itoa(fileSize)
	contentEnd := strconv.Itoa(fileSize - 1)

	c.Header("Content-Type", mediaObject.ContentType)
	c.Header("Accept-Ranges", "bytes")
	c.Header("Content-Length", contentLength)
	c.Header("Content-Range", "bytes 0-"+contentEnd+"/"+contentLength)

	renderStatus = http.StatusOK
} else {

	rangeParam := strings.Split(c.GetHeader("Range"), "=")[1]
	splitParams := strings.Split(rangeParam, "-")

	// response values
	contentStartValue := 0
	contentStart := strconv.Itoa(contentStartValue)
	//contentEndValue := fileSize - 1
	contentEnd := strconv.Itoa(contentEndValue)
	contentSize := strconv.Itoa(fileSize)

	// use Range Header, get contentStart
	if len(splitParams) > 0 {
		contentStartValue, err := strconv.Atoi(splitParams[0])
		if err != nil {
			contentStartValue = 0
		}
		contentStart = strconv.Itoa(contentStartValue)
	}
	// get contentEnd
	if len(splitParams) > 1 {
		contentEndValue, err := strconv.Atoi(splitParams[1])
		if err != nil {
			contentEndValue = fileSize - 1
		}
		contentEnd = strconv.Itoa(contentEndValue)
	}

	contentLength := strconv.Itoa(contentEndValue - contentStartValue + 1)

	c.Header("Content-Type", mediaObject.ContentType)
	c.Header("Accept-Ranges", "bytes")
	c.Header("Content-Length", contentLength)
	c.Header("Content-Range", "bytes "+contentStart+"-"+contentEnd+"/"+contentSize)

	renderStatus = http.StatusPartialContent
	// seek to contentStart
	reader.Seek(int64(contentStartValue), 0)
}

c.Status(renderStatus)
wn, err := io.Copy(c.Writer, reader)
//wn, err := io.CopyBuffer(c.Writer, reader, nil)
if err != nil {
	log.Printf("copy error: %v", err)
} else {
	log.Printf("write data: %v", wn)
}
```
Hi, 
in our CI environment, TestDebugPrintLoadTemplate failed
```
--- FAIL: TestDebugPrintLoadTemplate (0.00s)
	assertions.go:239:                         
	Error Trace:	debug_test.go:77		
	Error:      	Not equal: 		
	            	expected: "[GIN-debug] Loaded HTML Templates (2): \n\t- hello.tmpl\n\t- \n\n"		
	            	actual: "[GIN-debug] Loaded HTML Templates (2): \n\t- \n\t- hello.tmpl\n\n"
```

I'm using the 1.2 release, the func `debug PrintLoadTemplate` is same to master.

I'm not a golang expert, but I assume there's a race condition in following code,
https://github.com/gin-gonic/gin/blob/3856206bd07d1a5627eb951e345fff25f9b6209c/debug.go#L34-L38

The full log is at https://paste.debian.net/982070/
How to write gin access log to file without  shell redirect。
`validator` allows for registration of custom validation tag - http://godoc.org/gopkg.in/go-playground/validator.v8#Validate.RegisterValidation. This adds a method to the `StructValidator` interface and implements the same in `defaultValidator`. I also added an example to the readme.
Should use `net/http package` since it is imported from the UI perspective.
Hi,
When using BindJson on a http request data, if data types of defined struct fields be different from http body data field type, Gin will set that field and all of next fields empty!!!!
Please resolve this issue, set only that fields empty of on better way do Panic!  

Thanks

https://github.com/gin-gonic/gin/pull/1063#issuecomment-322041800 fix testing failed. Please review it thanks.
Because the latest development version of Go don't pass pre-existing unit test. We should only use stable version.

```
--- FAIL: TestRouterNotFound (0.00s)
	Error Trace:	routes_test.go:396
	Error:		Not equal: 
			expected: "map[Location:[/path] Content-Type:[text/html; charset=utf-8]]"
			received: "map[Location:[/path]]"
```
See:
- https://travis-ci.org/gin-gonic/gin/jobs/262113482
- https://travis-ci.org/gin-gonic/gin/jobs/262229709
- https://travis-ci.org/gin-gonic/gin/jobs/263348918
- https://travis-ci.org/gin-gonic/gin/jobs/263774413
i am sending time in `time.RFC3339` format it has the following problem with automatic binding.

my modle

```go
type MyModel struct {
	From   time.Time   `form:"from" json:"from"`
}
```
binding 

```go
var myModel MyModel 
context.Bind(&myModel)
```

error `"parsing time ""2017-08-16P15:00:00+00:00"" as ""2006-01-02T15:04:05Z07:00"": cannot parse "P15:00:00+00:00"" as "T"" `


How to setup automatic binding to use format   `time.RFC3339` ?
i cannot find any middle-ware configuration 

Fix https://github.com/gin-gonic/gin/issues/279. Base on https://github.com/gin-gonic/gin/commit/42e0c82bf4f243ea7342bd9e8baeb76882fc63d4 work.
the screenshot of updated before:
![image](https://user-images.githubusercontent.com/4488261/29260129-728bc244-80fa-11e7-98fa-643142065450.png)

the screenshot of updated after:
![image](https://user-images.githubusercontent.com/4488261/29260145-86f85274-80fa-11e7-9bf9-c54c3f89cb44.png)



https://travis-ci.org/gin-gonic/gin/jobs/262229709

```
--- FAIL: TestRouterNotFound (0.00s)
	Error Trace:	routes_test.go:377
	Error:		Not equal: 
			expected: "map[Content-Type:[text/html; charset=utf-8] Location:[/path]]"
			received: "map[Location:[/path]]"
```
Comments should begin with the name of the thing being described and end in a period, from:
https://github.com/golang/go/wiki/CodeReviewComments#comment-sentences
fix https://github.com/gin-gonic/gin/issues/598#issuecomment-293086937
I want some example sending logs of a Golang App to cloudwatch

## gin latest version. 1.2
1) Need to add docs how to use ctx method `AbortWithStatusJSON`
```
	var ucr messages.UsersCreateRequest
	if e := c.BindJSON(&ucr); e != nil {
		c.AbortWithStatusJSON(http.StatusBadRequest, gin.H{
			"errors": "someError",
		})
	}
        fmt.Println(1)
```
response should be `application/json; charset=utf-8` BUT it gives `content-type == 'text/plain; charset=utf-8'`

1. 1 I thought I will not need to write `return` If I will use AbortWithStatusJSON.

2) I'm getting in response headers `content-type == 'text/plain; charset=utf-8'` even if I using c.JSON:
```
	var ucr messages.UsersCreateRequest
	if e := c.BindJSON(&ucr); e != nil {
		c.JSON(http.StatusBadRequest, gin.H{
			"errors": "bsalslasalksaslas"
		})
		return
	}
```

`Bind()` is great, but what do you guys think if it supports default values when a param is not specified? Something like this:

```go
    params = struct {
        Name string `form:"name,default=john"`
        Age uint `form:"address,default=10"`
    }{}

    c.Bind(&param)
```

My vscode go extensions keeps complaining about this in gin.go line 124 perhaps it would be nice to:

```delims: render.Delims{Left: "{{", Right: "}}"},```

thanks
ref https://github.com/gin-gonic/gin/issues/1041#issuecomment-319125864 and https://github.com/gin-gonic/gin/issues/633
https://router.vuejs.org/en/essentials/history-mode.html

How do you solve vue.js HTML5 History Mode?
## Issue Description

Currently, the functions `ctx.Bind`, `ctx.BindJSON`, `ctx.BindQuery` all use `ctx.MustBindWith`.
In my opinion, the current implementation of `ctx.MustBindWith` has the following drawbacks. Note that this has been discussed before and I am including it here to avoid needing to crawl multiple issues, threads:
- **Lack of control**
  - It sets the HTTP status code as 400 and developer cannot set any other HTTP status code(ex: 422, `http.StatusUnprocessableEntity`)
  - It aborts the handler chain. Developer should be able to decide whether the resulting error is worth aborting or can be reconciled.
  - Cannot use repeated `Bind` as discussed in #811. Developer might want to bind query params and JSON body separately.
- **Possibly incorrect `Content-type` header** 
  - It sets the `Content-type` as `text/plain`
  - Neither `ctx.JSON` nor manually trying to set the content type header help. Instead we see this warning:
    ```
    [GIN-debug] [WARNING] Headers were already written. Wanted to override status code 400 with 422
    ```

## Proposal

For backward compatibility, we cannot change the behavior of existing bind methods. So this PR adds `ShouldBind` counterparts - `ctx.ShouldBind`, `ctx.ShouldBindJSON`, `ctx.ShouldBindQuery`. 

~Note that I have not yet updated the readme file and will do so depending on the outcome of the discussion here. I suggest that we switch over all examples on readme to use the `Should` equivalents.~
_All examples on readme have been updated to use `ShouldBind` methods. Also added section explaining difference between `Bind` and `ShouldBind` methods._
For example, this isn't going to work if there is a bind error:
```go
func startPage(c *gin.Context) {
    var person Person
    if c.BindQuery(&person) == nil {
        log.Println("====== Only Bind By Query String ======")
        log.Println(person.Name)
        log.Println(person.Address)
    }
    c.String(200, "Success") // Can cause `[GIN-debug] [WARNING] Headers were already written.`
}
```
I am new to Go 🙇 . I have pretty much duplicated the existing tests for bind methods with `Should` equivalents. Please let me know if anything needs to be changed.

Related issues - #629, #633, #662, #782, #811
Related PR - #636, #661
Closes #840
Hey guys!

I'm trying to extend the **gin.Context** with a function that writes responses using the google's jsonapi lib. I did the following:

``` go
type MyContext struct {
	*gin.Context
}

func (c *MyContext) API(code int, model interface{}) {
	response := new(bytes.Buffer)
	jsonapi.MarshalPayload(response, &model)
	c.Data(code, jsonapi.MediaType, response.Bytes())
}

func handleFunc(handler func(*MyContext)) (func(*gin.Context)) {
	return func (c *gin.Context) {
		customContext := MyContext{ c } // MyContext{ Context: c } not is working too.
		handler(&custonContext)
	}
}

func registerRoutes(r *gin.Engine) {
	r.POST("/users", handleFunc(CreateUserAction))
}
```

Everything compiles and runs just fine, the problem happens when the execution reach the initialization of MyContext at handleFunc. There, the assignment works but the reference of gin.Context.Request and gin.Context.Writer are not "passed" to **customContext**. The funny thing is when I debug the code I can see that the Request and Writer are ok at **c**.

Well, is important to say that I'm not an expert Go programmer so I may be doing something stupid. Can someone help me with this?

this is the **c** variable
![capture](https://user-images.githubusercontent.com/7643882/28750368-0d4ab666-74bf-11e7-91c1-73b774a56c20.PNG)

this is the **customContext** variable
![capture2](https://user-images.githubusercontent.com/7643882/28750373-2cd3282e-74bf-11e7-8dae-f7f7d9e10da5.PNG)
```html
<div>
{{.content}}
</div>
```

```go
c.HTML(http.StatusOK, "index.tmpl", gin.H{
		"content":        "<p><li>six</li></p>"
	})
```

I need the 'content'  is not be as a text , but is be as a html code to be rendered



```go
engine.Static("/", "dist")
user := engine.Group("/user")
user.POST("/login", handler.Login)
user.POST("/reg", handler.Register)
user.GET("/sub", handler.Subscribe)
```

```
panic: path segment '/user/sub' conflicts with existing wildcard '/*filepath' in path '/user/sub'
```

Then ,if I delete all GET method route , it work good.
So ,how to use gin with angular2 gracefully? Thank you very much
This new `StringHTML()` method will allow users to render HTML without
the need of an actual file on disk.

Example:
```go
r.GET("/saludos", func(c *gin.Context) {
	c.StringHTML(200, "<html><body>Hola amigo!</body></html>")
})
```
Signed-off-by: Salim Afiune <afiune@chef.io>

I have an usecase like this.
```go
type user struct {
	Name  string `json:"name" binding:"required"`
	Email string `json:"email" binding:"required,email"`
}

type data struct {
	User []user `json:"user" binding:"required"`
}

//GetDataTest will get test data
func GetDataTest(c *gin.Context) {
	var data data
	err := c.Bind(&data)
	if err == nil {
		fmt.Printf("%+v", data)
		c.JSON(http.StatusOK, gin.H{
			"message": "done",
		})
	} else {
		c.JSON(http.StatusBadRequest, gin.H{
			"message": err.Error(),
		})
	}
}
```

By post body is 
```
{
	"user": [{
		"email": "alu@alu.com",
		"name": "alu"
	},
	{
		"email": "",
		"name": "alu"	
	}]
}
```

In the above case email field validation of required is not working. It is because of list of struct or am missing something.
I have a application which is using gin for http server handling.  I have registered multiple end points. Some time i get "404 page not found" for one of the end point.  I do not see any other in logs.  I have to restart my application to make it work again.   Some time my application crashing with following backtace.

```
|goroutine 109 [running]:
|net/http.(*conn).serve.func1(0xc420576c00)
|	/usr/lib/golang/src/net/http/server.go:1491 +0x12a
|panic(0x7562a0, 0xc42000c1a0)
|	/usr/lib/golang/src/runtime/panic.go:458 +0x243
|encoding/json.(*encodeState).marshal.func1(0xc42033b8e0)
|	/usr/lib/golang/src/encoding/json/encode.go:272 +0x1b9
|panic(0x7562a0, 0xc42000c1a0)
|	/usr/lib/golang/src/runtime/panic.go:458 +0x243
|encoding/json.(*structEncoder).encode(0xc4201f80c0, 0xc4201924d0, 0x789d20, 0xc420016690, 0x199, 0x100)
|	/usr/lib/golang/src/encoding/json/encode.go:601 +0x24e
|encoding/json.(*structEncoder).(encoding/json.encode)-fm(0xc4201924d0, 0x789d20, 0xc420016690, 0x199, 0xc420010100)
|	/usr/lib/golang/src/encoding/json/encode.go:615 +0x64
|encoding/json.(*ptrEncoder).encode(0xc420048118, 0xc4201924d0, 0x750d40, 0xc420016690, 0x16, 0x750100)
|	/usr/lib/golang/src/encoding/json/encode.go:742 +0xe3
|encoding/json.(*ptrEncoder).(encoding/json.encode)-fm(0xc4201924d0, 0x750d40, 0xc420016690, 0x16, 0xc420010100)
|	/usr/lib/golang/src/encoding/json/encode.go:747 +0x64
|encoding/json.(*encodeState).reflectValue(0xc4201924d0, 0x750d40, 0xc420016690, 0x16, 0x100)
|	/usr/lib/golang/src/encoding/json/encode.go:307 +0x82
|encoding/json.(*encodeState).marshal(0xc4201924d0, 0x750d40, 0xc420016690, 0x100, 0x0, 0x0)
|	/usr/lib/golang/src/encoding/json/encode.go:280 +0xb8
|encoding/json.(*Encoder).Encode(0xc42033b978, 0x750d40, 0xc420016690, 0x7fee465ee240, 0xc420192420)
|	/usr/lib/golang/src/encoding/json/stream.go:193 +0x8e
|github.com/gin-gonic/gin/render.jsonRender.Render(0x7fee465ee208, 0xc420192420, 0xc8, 0xc420545330, 0x1, 0x1, 0xc420183a00, 0x7fee465ee208)
|	github.com/gin-gonic/gin/render/render.go:60 +0xfa
|github.com/gin-gonic/gin/render.(*jsonRender).Render(0xb897f8, 0x7fee465ee208, 0xc420192420, 0xc8, 0xc420545330, 0x1, 0x1, 0xc420192401, 0xb897f8)
|	<autogenerated>:2 +0x8b
|github.com/gin-gonic/gin.(*Context).Render(0xc420192420, 0xc8, 0xb54060, 0xb897f8, 0xc420545330, 0x1, 0x1)
|	github.com/gin-gonic/gin/context.go:322 +0xba
|github.com/gin-gonic/gin.(*Context).JSON(0xc420192420, 0xc8, 0x750d40, 0xc420016690)
|	github.com/gin-gonic/gin/context.go:331 +0xc7
```
gin support debug mode ?  I don't want changes code every time, reset gin commands.

Thank You.

By using `github.com/araddon/dateparse` in `binding/form_mapping.go` the `time_format` tag can be optional. 
ref #1031
fix https://github.com/gin-gonic/gin/pull/1013

cc @javierprovecho @thinkerou 

## New benchmark data with GitHub

The GitHub API is rather large, consisting of 203 routes. The tasks are basically the same as in the benchmarks before.

Benchmark name 					| (1) 		| (2) 		| (3) 		| (4)
--------------------------------|----------:|----------:|----------:|------:
BenchmarkAce_GithubAll                     | 10000            | 134059           | 13792        | 167
BenchmarkBear_GithubAll                     | 5000            | 534445           | 86448        | 943
BenchmarkBeego_GithubAll                    | 3000            | 592444           | 74705        | 812
BenchmarkBone_GithubAll                      | 200           | 6957308          | 698784       | 8453
BenchmarkDenco_GithubAll                   | 10000            | 158819           | 20224        | 167
BenchmarkEcho_GithubAll                    | 10000            | 154700            | 6496        | 203
**BenchmarkGin_GithubAll**                    | **30000**             | **48375**               | **0**          | **0**
BenchmarkGocraftWeb_GithubAll               | 3000            | 570806          | 131656       | 1686
BenchmarkGoji_GithubAll                     | 2000            | 818034           | 56112        | 334
BenchmarkGojiv2_GithubAll                   | 2000           | 1213973          | 274768       | 3712
BenchmarkGoJsonRest_GithubAll               | 2000            | 785796          | 134371       | 2737
BenchmarkGoRestful_GithubAll                 | 300           | 5238188          | 689672       | 4519
BenchmarkGorillaMux_GithubAll                | 100          | 10257726          | 211840       | 2272
BenchmarkHttpRouter_GithubAll              | 20000            | 105414           | 13792        | 167
BenchmarkHttpTreeMux_GithubAll             | 10000            | 319934           | 65856        | 671
BenchmarkKocha_GithubAll                   | 10000            | 209442           | 23304        | 843
BenchmarkLARS_GithubAll                    | 20000             | 62565               | 0          | 0
BenchmarkMacaron_GithubAll                  | 2000           | 1161270          | 204194       | 2000
BenchmarkMartini_GithubAll                   | 200           | 9991713          | 226549       | 2325
BenchmarkPat_GithubAll                       | 200           | 5590793         | 1499568      | 27435
BenchmarkPossum_GithubAll                  | 10000            | 319768           | 84448        | 609
BenchmarkR2router_GithubAll                | 10000            | 305134           | 77328        | 979
BenchmarkRivet_GithubAll                   | 10000            | 132134           | 16272        | 167
BenchmarkTango_GithubAll                    | 3000            | 552754           | 63826       | 1618
BenchmarkTigerTonic_GithubAll               | 1000           | 1439483          | 239104       | 5374
BenchmarkTraffic_GithubAll                   | 100          | 11383067         | 2659329      | 21848
BenchmarkVulcan_GithubAll                   | 5000            | 394253           | 19894        | 609

(1): Total Repetitions
(2): Single Repetition Duration (ns/op)
(3): Heap Memory (B/op)
(4): Average Allocations per Repetition (allocs/op)
Dear Team, 
I have one web method which post data in XML format and return JSON format data. its working in raw in postman but when i passed key, value by form-data its return 500 error. that is 'Unexpected '<''.
Please tell me whats wrong with code..

Below are the code

```java
    [WebMethod]
    [ScriptMethod(ResponseFormat = ResponseFormat.Json)]
    public void ValidateUser(string LoginId, string Password)
    {
        System.Web.Script.Serialization.JavaScriptSerializer serializer = new System.Web.Script.Serialization.JavaScriptSerializer();
        string errorMessage = "";
        string EncryptedPwd = "";
        string outputString = "";

        Connection();

        EncryptedPwd = UserCommon_Roznama.ClsCommon_Roznama.Encrypt(Password);

        DataTable dt = new DataTable();
        sqlCmd.CommandType = CommandType.StoredProcedure;
        sqlCmd.CommandText = "wsAuthenticateUser";
        sqlCmd.Parameters.AddWithValue("@LoginID", LoginId);
        sqlCmd.Parameters.AddWithValue("@Password", EncryptedPwd);
        sqlCmd.Parameters.AddWithValue("@ErrorMessage", errorMessage);

        sqlCmd.Parameters[2].SqlDbType = SqlDbType.VarChar;
        sqlCmd.Parameters[2].Size = 500;
        sqlCmd.Parameters[2].Direction = ParameterDirection.Output;

        try
        {
            DataSet ds = new DataSet();
            sqlCon.Open();
            SqlDataAdapter da = new SqlDataAdapter(sqlCmd);
            da.Fill(ds);
            errorMessage = sqlCmd.Parameters[2].Value.ToString();

            List<Dictionary<string, object>> rows = new List<Dictionary<string, object>>();
            Dictionary<string, object> row = null;

            if (errorMessage == "" && ds.Tables.Count > 0)
            {
                dt = ds.Tables[0];
                foreach (DataRow dr in dt.Rows)
                {
                    row = new Dictionary<string, object>();
                    foreach (DataColumn col in dt.Columns)
                    {
                        row.Add(col.ColumnName, dr[col]);
                    }
                    rows.Add(row);
                }
            }
            else
            {
                row = new Dictionary<string, object>();
                row.Add("Error Message", errorMessage);
                rows.Add(row);
            }
            //dt.TableName = "AuthenticateUser";

            this.Context.Response.ContentType = "application/json; charset=utf-8";
            this.Context.Response.Write(serializer.Serialize(rows));
        }
        catch (Exception ex)
        {
            string strError = "Error from RoznamaMobileService: RoznamaService, WebMethod: AuthenticateUser, Exception: ==> " + ex.Message;
            Log.WriteLog(strError);
        }
        finally
        {
            sqlCon.Close();
        }
    }
```
according to https://github.com/gin-gonic/gin/pull/1026#issuecomment-315942327, update jsoniter vendor version.



see https://github.com/gin-gonic/gin/issues/742#issuecomment-268944445 , only parse/bind the query string params


In order to restore Gin support for app engine (disable jsonite through tags), create new folder to support multiple JSON packages.

use jsoniter

```
$ go build -tags=jsoniter .
```

use default json

```
$ go build .
```

fix https://github.com/gin-gonic/gin/issues/1023

cc @javierprovecho @taowen @codedance
When I try[ this snippet](https://github.com/gin-gonic/gin/blob/master/examples/upload-file/single/main.go):

```go
 		// Source
 		file, err := c.FormFile("file")
 		if err != nil {
 			c.String(http.StatusBadRequest, fmt.Sprintf("get form err: %s", err.Error()))
 			return
 		}
 
 		if err := c.SaveUploadedFile(file, file.Filename); err != nil {
 			c.String(http.StatusBadRequest, fmt.Sprintf("upload file err: %s", err.Error()))
 			return
 		}
```

I get this compile time error:

> c.SaveUploadedFile undefined (type *gin.Context has no field or method SaveUploadedFile)


so the doc needs revision, or I'm missing something?


https://github.com/gin-gonic/gin/issues/1008#issuecomment-315601635
https://github.com/gin-gonic/gin/issues/1008#issuecomment-315602843
https://github.com/gin-gonic/gin/pull/990#issuecomment-315601691
ref https://github.com/gin-gonic/gin/issues/674
template: :350: function "formatAsDate" not defined
This PR aims to point an existing race condition with the gin.Context and propose a solution.

The gin.Context stores keys in a `map[string]interface{}`. The function gin.Context.Copy()  (context.go:79) is supposed to give a thread safe copy of the initial gin.Context.

Instead of making a proper copy of the context.Keys, it copies the references of the map. This creates a race condition whenever the map context.Keys is accessed by concurrent go-routines.

With the following script you will get the raise condition instantly. The fix in the PR will solve it.
```go
package main

import (
        "github.com/gin-gonic/gin"
        "math/rand"
)

func main() {

        r := gin.Default()
        r.GET("/", func(ctx *gin.Context) {
                ctx.Set("1", 0)
                ctx.Set("2", 0)

                // Sending a copy of the gin.Context to two separate routines
                go ReadWriteKeys(ctx.Copy())
                go ReadWriteKeys(ctx.Copy())
        })
        r.Run(":8080")
}

func ReadWriteKeys(ctx *gin.Context) {
        for {
                ctx.Set("1", rand.Int())
                ctx.Set("2", ctx.Value("1"))
        }
}
```
This PR aims to point an existing race condition with the gin.Context and propose a solution.

The gin.Context stores keys in a `map[string]interface{}`. The function gin.Context.Copy()  (context.go:79) is supposed to give a thread safe copy of the initial gin.Context.

Instead of making a proper copy of the context.Keys, it copies the reference to the map. This creates a race condition whenever the map context.Keys is accessed by concurrent go-routines.

With the following script you will get the raise condition instantly. The fix in the PR will solve it.
```go
package main

import (
        "github.com/gin-gonic/gin"
        "math/rand"
)

func main() {

        r := gin.Default()
        r.GET("/", func(ctx *gin.Context) {
                ctx.Set("1", 0)
                ctx.Set("2", 0)

                // Sending a copy of the gin.Context to two separate routines
                go ReadWriteKeys(ctx.Copy())
                go ReadWriteKeys(ctx.Copy())
        })
        r.Run(":8080")
}

func ReadWriteKeys(ctx *gin.Context) {
        for {
                ctx.Set("1", rand.Int())
                ctx.Set("2", ctx.Value("1"))
        }
}
```
Add a judgment of JSON format. Under normal circumstances, we may not need this function. However, in the process of using middleware or microservices, the data we may get is already in JSON format. At this time, we need to convert JSON to stuct, and then convert it in line by gin. In this process, we not only need to create a new struct, but also The useless JSON—— struct, struct —— JSON, therefore, I added the JSON type judgment

Assets cannot be submitted to dynamic routed pages. Each page link contains parameters that cannot access the assets.
for example:
``` router.Static ("/a'', "./assets") ```
And the
``` router.GET ("/acount /:name'', acount)```
The browser does not request assets like this:
```http://localhost:8080/a/imgs/turtel.jpg```
Instead it sends the request like this:
```http://localhost:8080/acount/a/imgs/turtel.jpg```
If the assets are presented in a corresponding path, for example:
```router.Static ("/acount/a'',  "./assets '')```
A new conflict will arise with ```router.GET ("/acount/:name", acount)```
My Http  Request Content-Type is  application/x-www-form-urlencoded

Input Params like 
`p1=1&p2=2&p3=4`

When I use Context.ShouldBind to get Reqest
`context.ShouldBind(&myRequest)`

And I want to get All POST param by Context.GetRawData() 

I found it is "" not  origin POST data



Closes #2201


```
history := make(map[string]interface{})
c.ShouldBindQuery(&history)
fmt.Println(history)
```

no matter what request parameters passed, history always be map[]
Implement `.Unwrap() error` method on type `Error`, to be compatible with stdlib `errors.Is()` and `erors.As()` functions.
## Description

The 'Error' type defined in errors.go does not implement ".Unwrap() error", which prevents the usage of "errors.Is()" and "errors.As()"

## How to reproduce

```
package main

import (
	"github.com/gin-gonic/gin"
)

type TestStrErr string

func (e TestStrErr) Error() string { return string(e) }

func main() {
	testErr := TestStrErr("some error")

	err := &gin.Error{Err: testErr}

	if errors.Is(err, testErr) {
	    fmt.Println("match with testErr ok")
	}
	
	var unwrap TestStrErr
	if errors.As(err, &unwrap) {
	    fmt.Println("succesfully unwrapped as a TestStrErr")
	}
}
```

## Expectations

output :
```
match with testErr ok
succesfully unwrapped as a TestStrErr
```
## Actual result

no output

## Environment

- go version: go version go1.14.2 linux/amd64
- gin version (or commit ref):  540b1eff7069128df5d95e09968569f2266d9a6a
- operating system:  linux

## Description

Can gin support HTTP/3?

## Environment

- go version go1.15.2 darwin/amd64
- gin version (or commit ref): v1.6.3
- operating system: macOS
I have send gin context from kafka
In kafka I have json

How to json set gin context?

example:
func readvaluekafka(){

json := `{
"status":"ok",
"Message":"succes"
}`

Var c *gin.context
c.value(json)
callgincontex(c)

}

func callgincontex(c *gin.context){
Var status model.status

err :=c.ShouldBindJSON(&status)

fmt.Println(status)
}

Can you help me, tqu
## Description

When i set the request header to 『Accept: application/xml』，I can not get "Set-Cookie" from the response header?
![image](https://user-images.githubusercontent.com/737958/95020935-ba982800-06a0-11eb-97ff-b197ffb66366.png)

When i set the request header to 『Accept: application/json』 or 『Accept: application/x-yaml』，I can get "Set-Cookie" from the response header?
![image](https://user-images.githubusercontent.com/737958/95020917-95a3b500-06a0-11eb-8eef-3e0f1f749de4.png)

If I can not get  "Set-Cookie" from the response header, The session and cookie does not work.

## How to reproduce

```
package main

import (
	"github.com/gin-gonic/gin"
)

var Options = sessions.Options{
	Path:     "/",
	MaxAge:   3600 * 24 * 180, // 180 days
	Secure:   gin.Mode() == gin.ReleaseMode,
	HttpOnly: gin.Mode() == gin.ReleaseMode,
	SameSite: http.SameSiteLaxMode}

func main() {
	g := gin.Default()

	g.GET("/user/incr", func(c *gin.Context) {
		session := sessions.Default(c)
		session.Options(Options)
		var count float64
		v := session.Get("count")
		if v == nil {
			count = 0
		} else {
			count = v.(float64)
			count++
		}
		session.Set("count", count)
		err := session.Save()

		if err != nil {
			log.Fatal(err)
			panic(err)
		}

		data := gin.H{
			"count": count,
		}

                negotiate := gin.Negotiate{
		   Offered: []string{gin.MIMEJSON, gin.MIMEXML, gin.MIMEYAML},
		   Data:     data
	        }

		c.Negotiate(http.StatusOK, negotiate)
	})

	g.Run(":8080")
}
```

## Expectations

Whether i Add "Accept: application/xml" "Accept: application/json" or "Accept: application/x-yaml"， I want to get the "Set-Cookie" from the response header.

## Actual result
http://localhost:8080/user/incr

When i set the request header to 『Accept: application/xml』，I can not get "Set-Cookie" from the response header?

## Environment

- go version go1.15.2 darwin/amd64
- gin version (or commit ref): v1.6.3
- operating system: macOS 

![image](https://user-images.githubusercontent.com/737958/95021160-e49e1a00-06a1-11eb-812a-90974490556b.png)


## Description

When i set the request header to 『Accept: application/xml』，I can not get "Set-Cookie" from the response header?
![image](https://user-images.githubusercontent.com/737958/95020935-ba982800-06a0-11eb-97ff-b197ffb66366.png)

When i set the request header to 『Accept: application/json』 or 『Accept: application/x-yaml』，I can get "Set-Cookie" from the response header?
![image](https://user-images.githubusercontent.com/737958/95020917-95a3b500-06a0-11eb-8eef-3e0f1f749de4.png)

If I can not get  "Set-Cookie" from the response header, The session and cookie does not work.

## How to reproduce

```
package main

import (
	"github.com/gin-gonic/gin"
)

var Options = sessions.Options{
	Path:     "/",
	MaxAge:   3600 * 24 * 180, // 180 days
	Secure:   gin.Mode() == gin.ReleaseMode,
	HttpOnly: gin.Mode() == gin.ReleaseMode,
	SameSite: http.SameSiteLaxMode}

func main() {
	g := gin.Default()

	g.GET("/user/incr", func(c *gin.Context) {
		session := sessions.Default(c)
		session.Options(Options)
		var count float64
		v := session.Get("count")
		if v == nil {
			count = 0
		} else {
			count = v.(float64)
			count++
		}
		session.Set("count", count)
		err := session.Save()

		if err != nil {
			log.Fatal(err)
			panic(err)
		}

		data := gin.H{
			"count": count,
		}

                negotiate := gin.Negotiate{
		   Offered: []string{gin.MIMEJSON, gin.MIMEXML, gin.MIMEYAML},
		   Data:     data
	        }

		c.Negotiate(http.StatusOK, negotiate)
	})

	g.Run(":8080")
}
```

## Expectations

Whether i Add "Accept: application/xml" "Accept: application/json" or "Accept: application/x-yaml"， I want to get the "Set-Cookie" from the response header.

## Actual result
http://localhost:8080/user/incr

When i set the request header to 『Accept: application/xml』，I can not get "Set-Cookie" from the response header?

## Environment

- go version go1.15.2 darwin/amd64
- gin version (or commit ref): v1.6.3
- operating system: macOS 

![image](https://user-images.githubusercontent.com/737958/95021160-e49e1a00-06a1-11eb-812a-90974490556b.png)


Signed-off-by: Zasda Yusuf Mikail <zasdaym@gmail.com>

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


This PR adds  `HandlersChain []HandlerFunc` to the `RouteInfo` object returned from `Engine.Routes()`. This will return the handlers, in order, associated with each route.

Unlike `context.HandlerNames()`, this can be called for all routes, and can be used at service startup, during unit tests, etc. Our service at work applies different middleware to different routes dynamically, and my intention is to use this to catch unintended changes to the chain.

Inspired by https://github.com/gin-gonic/gin/pull/1131 and https://github.com/gin-gonic/gin/pull/1729

Sample usage:
```
type RouteDetail struct {
	Method   string   `json:"method"`
	Path     string   `json:"path"`
	Handlers []string `json:"handlers"`
}
routeDetails := make([]RouteDetail, 0)
for _, route := range engine.Routes() {
	handlers := []string{}
	for _, handler := range route.HandlersChain {
		handlers = append(handlers, runtime.FuncForPC(reflect.ValueOf(handler).Pointer()).Name())
	}
	routeDetails = append(routeDetails, RouteDetail{
		Method:   route.Method,
		Path:     route.Path,
		Handlers: handlers,
	})
}
file, _ := json.MarshalIndent(routeDetails, "", " ")
_ = ioutil.WriteFile("routes.json", file, 0644)
```

This addresses #2505. Since Recovery doesn't provide the same config as Layout, this is a naive approach with unexporting ConsoleColorMode variable.

If that's not appropriate I can work over the weekend on `RecoveryWithLogger` which would make Recovery use Logger internally. That would mean however a hard dependency between Recovery and Logger parts.

If there is any other approach you'd like me to pursue I'm open to feedback. :)

Hello,

[Based on those lines](https://github.com/gin-gonic/gin/blob/master/context.go#L1100-L1116) implementing the `context.Context` interface, Gin should either proxy those calls to `c.Request.Context()` or otherwise not implement `context.Context` at all. This leads to mistakes and errors since one can think Gin's context will behave as a request context...

Same with the value storage which should also go into the request context in my opinion if you really want to implement `context.Context`.

## Description

How can i write xml declaration when i return the http response with xml?

## How to reproduce

```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/", func(c *gin.Context) {
		data := gin.H{
			"message": "Hello Snowdream Server!",
		}

		c.Negotiate(200, gin.Negotiate{Offered: []string{gin.MIMEXML, gin.MIMEJSON}, Data: data})
	})

	g.Run(":9000")
}
```

## Expectations

```
<? xml version = "1.0" encoding = "UTF-8">
<map>
<message>Hello Snowdream Server!</message>
</map>
```

## Actual result

```
<map>
<message>Hello Snowdream Server!</message>
</map>
```

## Environment

- go version: go version go1.12.5 darwin/amd64
- gin version (or commit ref): v1.6.3
- operating system: macOS



## Description

Custom validations are not being executed even after successful registration

## How to reproduce

```go
package main

import (
  "fmt"
  "github.com/gin-gonic/gin/binding"
  "github.com/go-playground/validator/v10"
)

type Request struct {
  Value *string `json:"value" binding:"something"`
}

func main() {
  v, ok := binding.Validator.Engine().(*validator.Validate)
  if !ok {
    panic("failed")
  }
  err := v.RegisterValidation("something", func(fl validator.FieldLevel) bool {
    fmt.Println("running validator something")
    return true
  })
  if err != nil {
    panic(err)
  }

  request := Request{}
  err = binding.Validator.ValidateStruct(request)

  if err != nil {
    fmt.Printf("validation failed: %s\n", err.Error())
    return
  }
  fmt.Println("validation successful")
}

```

## Expectations

I expect the validation to run and be successful with the following output 
```
running validator something
validation successful
```

## Actual result
```
validation failed: Key: 'Request.Value' Error:Field validation for 'Value' failed on the 'something' tag
```

## Environment

- go version: 1.14.6
- gin version (or commit ref): v1.6.3
- operating system: Mac OSX

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

<!-- Description of a problem -->

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/hello/:name", func(c *gin.Context) {
		c.String(200, "Hello %s", c.Param("name"))
	})
	g.Run(":9000")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl http://localhost:8201/hello/world
Hello world
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl -i http://localhost:8201/hello/world
<YOUR RESULT>
```

## Environment

- go version:
- gin version (or commit ref):
- operating system:

Content-Disposition in the `Context.FileAttachment` method is not a MIME style, but a slight performance response that can be avoided.

benchmark test file: [https://github.com/eudore/eudore/blob/master/_example/textprotoHeader_test.go](https://github.com/eudore/eudore/blob/master/_example/textprotoHeader_test.go)
What it solves
---
Current form binding will failed if custom struct type that underling is string with json.Unmarshal . detail see #2510   
It will trying to Unmarshal the value with quoted again to fix this issue.
## Description

<!-- Description of a problem -->

While the implement of `binding.FormPost` will trying to use`json.Unmarshal` to deal with custom or unknown type.
https://github.com/gin-gonic/gin/blob/3100b7cb05a8072b76d31686d8a7b4f9b12df4be/binding/form_mapping.go#L212
But it will failed if the data is represent as string in json, since `application/x-www-form-urlencoded` won't quote string data. These data will not pass the json's validation.  
And the `json.Unmarshal` for custom data feature is totally broken here. Since we have no way to known if it a string type or other type in `application/x-www-form-urlencoded` format.
I suggest we can add a logic here if it parse custom type failed with json,then add a quote then try again.


## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"encoding/json"
	"fmt"
	"github.com/gin-gonic/gin"
	"github.com/gin-gonic/gin/binding"
	"net/http"
	"time"
)

func main() {
	g := gin.Default()
	g.POST("/hello", func(c *gin.Context) {
		data := TestForm{}
		err := c.MustBindWith(&data,binding.FormPost)
		fmt.Printf("%+v\n",c.Request.PostForm)
		if err != nil {
			fmt.Printf("%+v\n",err)
			return
		}
		
		c.String(http.StatusOK,data.Time.String())
		
		
	})
	g.Run(":9000")
}

type TestForm struct{
	Time CustomDateTime
}

type CustomDateTime time.Time

const CustomDateTimeFormat = "2006/01/02 15:04:05"

func (t CustomDateTime) String() string {
	return time.Time(t).Format(CustomDateTimeFormat)
}

func (t *CustomDateTime) UnmarshalJSON(data []byte) error {
	var value string
	err := json.Unmarshal(data, &value)
	if err != nil {
		return err
	}
	parseTime, err := time.Parse(CustomDateTimeFormat, value)
	if err != nil {
		return err
	}
	*t = CustomDateTime(parseTime)
	return nil
}

```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl -H "Content-Type: application/x-www-form-urlencoded" -X POST -d "Time=2020%2F09%2F23+13%3A20%3A49" http://localhost:9000/hello
2020/09/23 13:20:49
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl -H "Content-Type: application/x-www-form-urlencoded" -X POST -d "Time=2020%2F09%2F23+13%3A20%3A49" http://localhost:9000/hello
<400 Bad Request>
```
### console output
```
GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.

[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

[GIN-debug] POST   /hello                    --> main.main.func1 (3 handlers)
[GIN-debug] Listening and serving HTTP on :9000
map[Time:[2020/09/23 13:20:49]]
invalid character '/' after top-level value
[GIN] 2020/09/23 - 14:59:47 | 400 |            0s |             ::1 | POST     "/hello"
```

## Environment

- go version: 1.14
- gin version (or commit ref): v1.6.3
- operating system: windows 10

I am trying to learn the source code of GIN，when i read the defination of Context, i found Context.writermem and Context.Writer,who can tell me the difference? I think one of them will be enough to supply the demand？

```
type Context struct {
	writermem responseWriter
	Request   *http.Request
	Writer    ResponseWriter
	Params   Params
	handlers HandlersChain
	index    int8
	fullPath string
	engine *Engine
	params *Params
	// This mutex protect Keys map
	mu sync.RWMutex
        ...
}

```
bencmp result

```
benchmark                     old ns/op     new ns/op     delta
BenchmarkReader_Render-12     581           545           -6.20%

benchmark                     old allocs     new allocs     delta
BenchmarkReader_Render-12     9              8              -11.11%

benchmark                     old bytes     new bytes     delta
BenchmarkReader_Render-12     1008          992           -1.59%
```
benchcmp result:
```
benchmark                     old ns/op     new ns/op     delta
BenchmarkReader_Render-12     581           545           -6.20%

benchmark                     old allocs     new allocs     delta
BenchmarkReader_Render-12     9              8              -11.11%

benchmark                     old bytes     new bytes     delta
BenchmarkReader_Render-12     1008          992           -1.59%
```
the new is use `bytesconv.StringToBytes`

## Description

When returning json data, "&" will be automatically escaped. This is an unexpected behavior, how to prohibit it?

## How to reproduce

```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/hello/:name", func(c *gin.Context) {
		c.JSON(200, gin.H{
		    "url": "https://godoc.org/github.com/gin-gonic/gin?a=bbb&c=333",
	        })
	})
	g.Run(":9000")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl http://localhost:8201/hello/world
{"url":"https://godoc.org/github.com/gin-gonic/gin?a=bbb\u0026c=333"}
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl -i http://localhost:8201/hello/world
{"url":"https://godoc.org/github.com/gin-gonic/gin?a=bbb&c=333"}
```

## Environment

- go version: go version go1.14.1 darwin/amd64
- gin version (or commit ref): v1.6.3
- operating system: macos

##  Description

Recovery middleware does not obey `gin.DisableConsoleColor()`, but instead has hard coded ansi color sequences always included in its output

## How to reproduce

```
package main

import (
	"fmt"
	"github.com/gin-gonic/gin"
)

func main() {
	gin.DisableConsoleColor()
	g := gin.Default()
	g.GET("/panic", func(c *gin.Context) {
		panic(fmt.Errorf("demo"))
	})
	g.Run(":9000")
}
```

## Expectations

```
$ curl http://localhost:9000/panic
```

Expect logged panic output to not have color codes.

## Actual result

Logged panic has color codes.

## Environment

- go version: 1.14.x
- gin version (or commit ref): 1.6.3
- operating system: Linux

## Additional Information

https://github.com/gin-gonic/gin/blob/master/recovery.go#L54 -- this should be using `gin.IsOutputColor` to determine whether to include color codes in the logger prefix

This is more important when sending the recovery log output through something like `zerolog`, where the color codes just end up being escape codes inside some other string and have no hope of being rendered.
```golang
import ("github.com/gin-gonic/gin")
```

or

    $ go get -u github.com/gin-gonic/gin


gives:

```
✗ go get -v -t -d ./...
get "google.golang.org/protobuf/reflect/protoreflect": found meta tag get.metaImport{Prefix:"google.golang.org/protobuf", VCS:"git", RepoRoot:"https://go.googlesource.com/protobuf"} at //google.golang.org/protobuf/reflect/protoreflect?go-get=1
get "google.golang.org/protobuf/reflect/protoreflect": verifying non-authoritative meta tag
google.golang.org/protobuf (download)
package google.golang.org/protobuf/reflect/protoreflect: cannot find package "google.golang.org/protobuf/reflect/protoreflect" in any of:
	/usr/local/Cellar/go/1.14.5/libexec/src/google.golang.org/protobuf/reflect/protoreflect (from $GOROOT)
	/Users/stephane.bruckert/go/src/google.golang.org/protobuf/reflect/protoreflect (from $GOPATH)
get "google.golang.org/protobuf/proto": found meta tag get.metaImport{Prefix:"google.golang.org/protobuf", VCS:"git", RepoRoot:"https://go.googlesource.com/protobuf"} at //google.golang.org/protobuf/proto?go-get=1
get "google.golang.org/protobuf/proto": verifying non-authoritative meta tag
package google.golang.org/protobuf/proto: cannot find package "google.golang.org/protobuf/proto" in any of:
	/usr/local/Cellar/go/1.14.5/libexec/src/google.golang.org/protobuf/proto (from $GOROOT)
	/Users/stephane.bruckert/go/src/google.golang.org/protobuf/proto (from $GOPATH)
get "google.golang.org/protobuf/reflect/protoregistry": found meta tag get.metaImport{Prefix:"google.golang.org/protobuf", VCS:"git", RepoRoot:"https://go.googlesource.com/protobuf"} at //google.golang.org/protobuf/reflect/protoregistry?go-get=1
get "google.golang.org/protobuf/reflect/protoregistry": verifying non-authoritative meta tag
package google.golang.org/protobuf/reflect/protoregistry: cannot find package "google.golang.org/protobuf/reflect/protoregistry" in any of:
	/usr/local/Cellar/go/1.14.5/libexec/src/google.golang.org/protobuf/reflect/protoregistry (from $GOROOT)
	/Users/stephane.bruckert/go/src/google.golang.org/protobuf/reflect/protoregistry (from $GOPATH)
get "google.golang.org/protobuf/runtime/protoiface": found meta tag get.metaImport{Prefix:"google.golang.org/protobuf", VCS:"git", RepoRoot:"https://go.googlesource.com/protobuf"} at //google.golang.org/protobuf/runtime/protoiface?go-get=1
get "google.golang.org/protobuf/runtime/protoiface": verifying non-authoritative meta tag
package google.golang.org/protobuf/runtime/protoiface: cannot find package "google.golang.org/protobuf/runtime/protoiface" in any of:
	/usr/local/Cellar/go/1.14.5/libexec/src/google.golang.org/protobuf/runtime/protoiface (from $GOROOT)
	/Users/stephane.bruckert/go/src/google.golang.org/protobuf/runtime/protoiface (from $GOPATH)
get "google.golang.org/protobuf/runtime/protoimpl": found meta tag get.metaImport{Prefix:"google.golang.org/protobuf", VCS:"git", RepoRoot:"https://go.googlesource.com/protobuf"} at //google.golang.org/protobuf/runtime/protoimpl?go-get=1
get "google.golang.org/protobuf/runtime/protoimpl": verifying non-authoritative meta tag
package google.golang.org/protobuf/runtime/protoimpl: cannot find package "google.golang.org/protobuf/runtime/protoimpl" in any of:
	/usr/local/Cellar/go/1.14.5/libexec/src/google.golang.org/protobuf/runtime/protoimpl (from $GOROOT)
	/Users/stephane.bruckert/go/src/google.golang.org/protobuf/runtime/protoimpl (from $GOPATH)


```

it looks similar to https://github.com/grpc/grpc/issues/22820
- With pull requests:
  - [x] Open your pull request against `master`
  - [x] Your pull request should have no more than two commits, if not you should squash them.
  - [x] It should pass all tests in the available continuous integration systems such as TravisCI.
  - [x] You should add/modify tests to cover your proposed code changes.
  - [x] If your pull request contains a new feature, please document it on the README.

# Description

This PR is for #2502 issue I've brought up.

I know this PR code fix is same as #1810 PR but I added tests and updated README for it.

The reason why we want this is mentioned in the #2502 

Thanks.

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

This issue is related to #439, #1810.

I think `c.ShouldBindBodyWith` should not consume a request body for next binding. 

When I read the current [README doc about this method](https://github.com/gin-gonic/gin#try-to-bind-body-into-different-structs), I thought it doesn't but it does so I've got an EOF error like the example below.

I think it's now confusing for users.

Thanks. 

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->

```go
package main

import (
	"encoding/json"
	"fmt"

	"github.com/gin-gonic/gin"
	"github.com/gin-gonic/gin/binding"
)

type MyStruct struct {
	Key string `json:"key" binding:"required"`
}

func MyMiddleware() gin.HandlerFunc {
	return func(c *gin.Context) {
		var h MyStruct

		if err := c.ShouldBindBodyWith(&h, binding.JSON); err != nil {
			c.JSON(400, gin.H{
				"message": fmt.Sprintf("%+v", err),
			})
			return
		}

		c.Next()
	}
}

func main() {
	r := gin.Default()
	r.Use(MyMiddleware())
	r.POST("/post", func(c *gin.Context) {
		var h MyStruct

		decoder := json.NewDecoder(c.Request.Body)
		err := decoder.Decode(&h)
		if err != nil {
				c.JSON(400, gin.H{
					"message": fmt.Sprintf("%+v", err),
				})
				return
		}

		c.JSON(200, gin.H{
			"message": "ok",
		})
	})
	r.Run() // listen and serve on 0.0.0.0:8080 (for windows "localhost:8080")
}

```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl --location --request POST 'http://localhost:8080/post' \
--header 'Content-Type: application/json' \
--data-raw '{
    "key": "value"
}'
{"message":"ok"}
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl --location --request POST 'http://localhost:8080/post' \
--header 'Content-Type: application/json' \
--data-raw '{
    "key": "value"
}'
{"message":"EOF"}
```

## Environment

- go version: go1.15 darwin/amd64
- gin version (or commit ref): 3100b7cb05a8072b76d31686d8a7b4f9b12df4be
- operating system: darwin/amd64

Excuse me!

What I wanted was that Gin could handle both HTTP and gRPC, either directly with GIN, or through an additional agent, such as the agent listening on the port, identifying different data and forwarding it to different handlers.

For example, this case is the same, but it USES native HTTP, not GIN. [go-grpc-example](https://github.com/eddycjy/go-grpc-example)

Something like this:

```
	http.ListenAndServeTLS(":"+PORT,
		certFile,
		keyFile,
		http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
			if r.ProtoMajor == 2 && strings.Contains(r.Header.Get("Content-Type"), "application/grpc") {
				server.ServeHTTP(w, r)
			} else {
				mux.ServeHTTP(w, r)
			}

			return
		}),
	)
```

If so, can you help provide an example?
benchmark cmp result:
```
benchmark                   old ns/op     new ns/op     delta
BenchmarkParseAccept-12     362           176           -51.38%

benchmark                   old allocs     new allocs     delta
BenchmarkParseAccept-12     6              2              -66.67%

benchmark                   old bytes     new bytes     delta
BenchmarkParseAccept-12     224           128           -42.86%
```

## Description

Route handlers are not asynchronous and and when I use goroutines, it crashes because of some wrong memory address access.

## How to reproduce

To test this, I wrote a simple route for `/ping` which will wait for 5 seconds for the first request and next requests should be handled immediately; but it doesn't!  
```golang
package main

import (
    "time"

    "github.com/gin-gonic/gin"
)

func main() {
    ok := false

    r := gin.Default()
    r.GET("/ping", func(c *gin.Context) {
        if !ok {
            ok = true
            time.Sleep(5 * time.Second) // 5 Seconds
        }

        c.JSON(200, gin.H{
            "message": "pong",
        })
    })
    r.Run() // listen and serve on 0.0.0.0:8080 (for windows "localhost:8080")
}

```

And also when I use goroutines, this will happend:
```golang
package main

import (
    "time"

    "github.com/gin-gonic/gin"
)

func main() {
    ok := false

    r := gin.Default()
    r.GET("/ping", func(c *gin.Context) {
        context := c.Copy()

        go func() {
            if !ok {
                ok = true
                time.Sleep(5 * time.Second) // 5 Seconds
            }

            context.JSON(200, gin.H{
                "message": "pong",
            })
        }()
    })
    r.Run() // listen and serve on 0.0.0.0:8080 (for windows "localhost:8080")
}
```

Errors:
```
panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x18 pc=0x1544052]

goroutine 21 [running]:
github.com/gin-gonic/gin.(*responseWriter).Header(0xc000312300, 0x154f5b5)
	<autogenerated>:1 +0x32
github.com/gin-gonic/gin/render.writeContentType(0x37a0ed8, 0xc000312300, 0x1a1ddd0, 0x1, 0x1)
	/Users/*******/go/src/github.com/gin-gonic/gin/render/render.go:36 +0x35
github.com/gin-gonic/gin/render.WriteJSON(0x37a0ed8, 0xc000312300, 0x15c60c0, 0xc000229770, 0x15f4e00, 0x37a0ed8)
	/Users/*******/go/src/github.com/gin-gonic/gin/render/json.go:68 +0x5d
github.com/gin-gonic/gin/render.JSON.Render(...)
	/Users/*******/go/src/github.com/gin-gonic/gin/render/json.go:55
github.com/gin-gonic/gin.(*Context).Render(0xc000312300, 0xc8, 0x1703bc0, 0xc0002d12e0)
	/Users/*******/go/src/github.com/gin-gonic/gin/context.go:865 +0x149
github.com/gin-gonic/gin.(*Context).JSON(...)
	/Users/*******/go/src/github.com/gin-gonic/gin/context.go:908
main.main.func1.1(0xc000302608, 0xc000312300)
	/Users/*******/Desktop/test_go_gin/main.go:22 +0xdc
created by main.main.func1
	/Users/*******/Desktop/test_go_gin/main.go:16 +0x65
exit status 2
```

I know the copy version of `gin.Context` is read-only and it seems `context.JSON` is the problem, but I don't know how to handle it?

## Expectations

The first request should response after 5 seconds and next requests should be handled immediately; but they don't!

## Actual result

It gives the errors above.

## Environment

- go version: `go1.15 darwin/amd64`
- gin version (or commit ref): `3100b7cb05a8072b76d31686d8a7b4f9b12df4be`
- operating system: `Darwin MacBook-Pro.local 19.6.0 Darwin Kernel Version 19.6.0: Thu Jun 18 20:49:00 PDT 2020; root:xnu-6153.141.1~1/RELEASE_X86_64 x86_64`




I am getting this error: (*RouterGroup).combineHandlers: panic("too many handlers")

I found the code for the panic:
`func (group *RouterGroup) combineHandlers(handlers HandlersChain) HandlersChain {
	finalSize := len(group.Handlers) + len(handlers)
	if finalSize >= int(abortIndex) {
		panic("too many handlers")
	}
	mergedHandlers := make(HandlersChain, finalSize)
	copy(mergedHandlers, group.Handlers)
	copy(mergedHandlers[len(group.Handlers):], handlers)
	return mergedHandlers
}`

Where **abortIndex ** is: `const abortIndex int8 = math.MaxInt8 / 2`.

First I don`t really understand this index, must be some kind of safety.

But the fact is that I have only 33 handlers (plus the static assets)  and I am getting this error.

When I restart the server the error goes away. But it comes back after a while.

Am I missing something?
I would like to know how I can execute code with context. I need the context so I can read Sessions. I'd like to do that without writing code for getting sessions every route.

To clarify, I am using an external [library](https://pkg.go.dev/github.com/gin-contrib/sessions?tab=doc) to manage sessions. Context is required to get a session. If I am trying to extract user information from that session, I do not want to have to do it on every GET route. I would like to call this code once and let every path beneath that inherit the User information. (I do not want to call a function on every route either, not that that would be feasible in my case anyway).
My first thought was router.Group(), but that does not provide context, and as far as I assume, does not actually execute code until a path is used.

I understand this is a tricky question as context is intrinsically dependent on specific HTTP requests. Any help would be appreciated.

When i request the url : /favorite/delete?id=19

I got errors ,The gin server crashed as follows:
```
url={/favorite/delete?id=19}
runtime: goroutine stack exceeds 1000000000-byte limit
fatal error: stack overflow

runtime stack:
runtime.throw(0x1bd23d5, 0xe)
	/usr/local/Cellar/go/1.12.5/libexec/src/runtime/panic.go:617 +0x72
runtime.newstack()
	/usr/local/Cellar/go/1.12.5/libexec/src/runtime/stack.go:1041 +0x7a9
runtime.morestack()
	/usr/local/Cellar/go/1.12.5/libexec/src/runtime/asm_amd64.s:429 +0x8f

goroutine 10 [running]:
strconv.Unquote(0x1a5a732, 0x4, 0x4, 0x1, 0xc0240004a8, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/strconv/quote.go:357 +0xcd4 fp=0xc024000430 sp=0xc024000428 pc=0x107e244
reflect.StructTag.Lookup(0x1a5a732, 0x0, 0x1bc986d, 0x4, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/reflect/type.go:1181 +0x501 fp=0xc0240004f8 sp=0xc024000430 pc=0x1094bf1
reflect.StructTag.Get(0x1a5a710, 0x26, 0x1bc986d, 0x4, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/reflect/type.go:1127 +0x63 fp=0xc024000560 sp=0xc0240004f8 pc=0x10946a3
github.com/gin-gonic/gin/binding.tryToSetValue(0x1a97980, 0xc006cdc300, 0x187, 0x1a5a70c, 0x2, 0x0, 0x0, 0x1e90920, 0x1a97980, 0x1a5a710, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:109 +0x9b fp=0xc024000700 sp=0xc024000560 pc=0x176cbdb
github.com/gin-gonic/gin/binding.mapping(0x1a97980, 0xc006cdc300, 0x187, 0x1a5a70c, 0x2, 0x0, 0x0, 0x1e90920, 0x1a97980, 0x1a5a710, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:73 +0x4a4 fp=0xc0240008f0 sp=0xc024000700 pc=0x176c684
github.com/gin-gonic/gin/binding.mapping(0x1b3c880, 0xc006cdc300, 0x199, 0x1a18f33, 0x5, 0x0, 0x0, 0x1e90920, 0x1b3c880, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024000ae0 sp=0xc0240008f0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdc300, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024000cd0 sp=0xc024000ae0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdc2d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024000ec0 sp=0xc024000cd0 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdc2d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc0240010b0 sp=0xc024000ec0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdc200, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc0240012a0 sp=0xc0240010b0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdc1d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024001490 sp=0xc0240012a0 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdc1d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024001680 sp=0xc024001490 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdc100, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024001870 sp=0xc024001680 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdc0d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024001a60 sp=0xc024001870 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdc0d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024001c50 sp=0xc024001a60 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdc000, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024001e40 sp=0xc024001c50 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdbfd8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024002030 sp=0xc024001e40 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdbfd8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024002220 sp=0xc024002030 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdbf00, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024002410 sp=0xc024002220 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdbed8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024002600 sp=0xc024002410 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdbed8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc0240027f0 sp=0xc024002600 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdbe00, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc0240029e0 sp=0xc0240027f0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdbdd8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024002bd0 sp=0xc0240029e0 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdbdd8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024002dc0 sp=0xc024002bd0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdbd00, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024002fb0 sp=0xc024002dc0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdbcd8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc0240031a0 sp=0xc024002fb0 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdbcd8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024003390 sp=0xc0240031a0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdbc00, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024003580 sp=0xc024003390 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdbbd8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024003770 sp=0xc024003580 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdbbd8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024003960 sp=0xc024003770 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdbb00, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024003b50 sp=0xc024003960 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdbad8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024003d40 sp=0xc024003b50 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdbad8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024003f30 sp=0xc024003d40 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdba00, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024004120 sp=0xc024003f30 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdb9d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024004310 sp=0xc024004120 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdb9d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024004500 sp=0xc024004310 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdb900, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc0240046f0 sp=0xc024004500 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdb8d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc0240048e0 sp=0xc0240046f0 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdb8d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024004ad0 sp=0xc0240048e0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdb800, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024004cc0 sp=0xc024004ad0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdb7d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024004eb0 sp=0xc024004cc0 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdb7d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc0240050a0 sp=0xc024004eb0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdb700, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024005290 sp=0xc0240050a0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdb6d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024005480 sp=0xc024005290 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdb6d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024005670 sp=0xc024005480 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdb600, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024005860 sp=0xc024005670 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdb5d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024005a50 sp=0xc024005860 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdb5d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024005c40 sp=0xc024005a50 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdb500, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024005e30 sp=0xc024005c40 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdb4d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024006020 sp=0xc024005e30 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdb4d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024006210 sp=0xc024006020 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdb400, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024006400 sp=0xc024006210 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdb3d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc0240065f0 sp=0xc024006400 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdb3d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc0240067e0 sp=0xc0240065f0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdb300, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc0240069d0 sp=0xc0240067e0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdb2d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024006bc0 sp=0xc0240069d0 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdb2d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024006db0 sp=0xc024006bc0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdb200, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024006fa0 sp=0xc024006db0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdb1d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024007190 sp=0xc024006fa0 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdb1d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024007380 sp=0xc024007190 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdb100, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024007570 sp=0xc024007380 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdb0d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024007760 sp=0xc024007570 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdb0d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024007950 sp=0xc024007760 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdb000, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024007b40 sp=0xc024007950 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdafd8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024007d30 sp=0xc024007b40 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdafd8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024007f20 sp=0xc024007d30 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdaf00, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024008110 sp=0xc024007f20 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdaed8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024008300 sp=0xc024008110 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdaed8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc0240084f0 sp=0xc024008300 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdae00, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc0240086e0 sp=0xc0240084f0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdadd8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc0240088d0 sp=0xc0240086e0 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdadd8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024008ac0 sp=0xc0240088d0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdad00, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024008cb0 sp=0xc024008ac0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdacd8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024008ea0 sp=0xc024008cb0 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdacd8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024009090 sp=0xc024008ea0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdac00, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024009280 sp=0xc024009090 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdabd8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024009470 sp=0xc024009280 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdabd8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024009660 sp=0xc024009470 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdab00, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024009850 sp=0xc024009660 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cdaad8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc024009a40 sp=0xc024009850 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cdaad8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024009c30 sp=0xc024009a40 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cdaa00, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc024009e20 sp=0xc024009c30 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cda9d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc02400a010 sp=0xc024009e20 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cda9d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc02400a200 sp=0xc02400a010 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cda900, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc02400a3f0 sp=0xc02400a200 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cda8d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc02400a5e0 sp=0xc02400a3f0 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cda8d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc02400a7d0 sp=0xc02400a5e0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cda800, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc02400a9c0 sp=0xc02400a7d0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cda7d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc02400abb0 sp=0xc02400a9c0 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cda7d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc02400ada0 sp=0xc02400abb0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cda700, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc02400af90 sp=0xc02400ada0 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cda6d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc02400b180 sp=0xc02400af90 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cda6d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc02400b370 sp=0xc02400b180 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cda600, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc02400b560 sp=0xc02400b370 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cda5d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc02400b750 sp=0xc02400b560 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cda5d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc02400b940 sp=0xc02400b750 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cda500, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc02400bb30 sp=0xc02400b940 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1a6b440, 0xc006cda4d8, 0x196, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x29f fp=0xc02400bd20 sp=0xc02400bb30 pc=0x176c47f
github.com/gin-gonic/gin/binding.mapping(0x1b16de0, 0xc006cda4d8, 0x199, 0x1ad9293, 0xb, 0x0, 0x0, 0x1e90920, 0x1b16de0, 0x1ad92a0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc02400bf10 sp=0xc02400bd20 pc=0x176c9e9
github.com/gin-gonic/gin/binding.mapping(0x1b84d40, 0xc006cda400, 0x199, 0x1a1cf98, 0x8, 0x0, 0x0, 0x1e90920, 0x1a6b440, 0x0, ...)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x809 fp=0xc02400c100 sp=0xc02400bf10 pc=0x176c9e9
...additional frames elided...
created by net/http.(*Server).Serve
	/usr/local/Cellar/go/1.12.5/libexec/src/net/http/server.go:2884 +0x7b7

goroutine 1 [IO wait, 1 minutes]:
internal/poll.runtime_pollWait(0x26add68, 0x72, 0xffffffffffffffff)
	/usr/local/Cellar/go/1.12.5/libexec/src/runtime/netpoll.go:182 +0x5e
internal/poll.(*pollDesc).wait(0xc00042ef18, 0x72, 0x23f1800, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/internal/poll/fd_poll_runtime.go:87 +0x9b
internal/poll.(*pollDesc).waitRead(0xc00042ef18, 0xffffffffffffff00, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/internal/poll/fd_poll_runtime.go:92 +0x45
internal/poll.(*FD).Accept(0xc00042ef00, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/internal/poll/fd_unix.go:384 +0x3a5
net.(*netFD).accept(0xc00042ef00, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/fd_unix.go:238 +0x82
net.(*TCPListener).accept(0xc0000b43d0, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/tcpsock_posix.go:139 +0x5e
net.(*TCPListener).AcceptTCP(0xc0000b43d0, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/tcpsock.go:247 +0x79
net/http.tcpKeepAliveListener.Accept(0xc0000b43d0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/http/server.go:3264 +0x50
net/http.(*Server).Serve(0xc000430a90, 0x1e830e0, 0xc0000b43d0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/http/server.go:2859 +0x370
net/http.(*Server).ListenAndServe(0xc000430a90, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/http/server.go:2797 +0x1ed
net/http.ListenAndServe(0x1bca13d, 0x5, 0x1e76e80, 0xc00045a120, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/http/server.go:3037 +0xd6
github.com/gin-gonic/gin.(*Engine).Run(0xc00045a120, 0xc0002cfea0, 0x1, 0x1, 0x0, 0x0)
	/Users/snowdream/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/gin.go:294 +0x170
main.main()
	/Users/snowdream/workspace/startup/雪梦科技/shm-platform/shm-backend/main.go:73 +0x520

goroutine 34 [select, 1 minutes]:
database/sql.(*DB).connectionOpener(0xc0001f2480, 0x1e845e0, 0xc0003d0400)
	/usr/local/Cellar/go/1.12.5/libexec/src/database/sql/sql.go:1000 +0xf1
created by database/sql.OpenDB
	/usr/local/Cellar/go/1.12.5/libexec/src/database/sql/sql.go:670 +0x29c

goroutine 35 [select, 1 minutes]:
database/sql.(*DB).connectionResetter(0xc0001f2480, 0x1e845e0, 0xc0003d0400)
	/usr/local/Cellar/go/1.12.5/libexec/src/database/sql/sql.go:1013 +0x11f
created by database/sql.OpenDB
	/usr/local/Cellar/go/1.12.5/libexec/src/database/sql/sql.go:671 +0x2d2
goroutine 7 [IO wait, 1 minutes]:
internal/poll.runtime_pollWait(0x26adc98, 0x72, 0xffffffffffffffff)
	/usr/local/Cellar/go/1.12.5/libexec/src/runtime/netpoll.go:182 +0x5e
internal/poll.(*pollDesc).wait(0xc000119b18, 0x72, 0x1e78d00, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/internal/poll/fd_poll_runtime.go:87 +0x9b
internal/poll.(*pollDesc).waitRead(0xc000119b18, 0xc00049c000, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/internal/poll/fd_poll_runtime.go:92 +0x45
internal/poll.(*FD).Read(0xc000119b00, 0xc00049c000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/internal/poll/fd_unix.go:169 +0x39f
net.(*netFD).Read(0xc000119b00, 0xc00049c000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/fd_unix.go:202 +0x7c
net.(*conn).Read(0xc0000106d8, 0xc00049c000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/net.go:177 +0xb5
net/http.(*connReader).Read(0xc00030d7a0, 0xc00049c000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/http/server.go:787 +0x2ca
bufio.(*Reader).fill(0xc0003f1020)
	/usr/local/Cellar/go/1.12.5/libexec/src/bufio/bufio.go:100 +0x2d3
bufio.(*Reader).ReadSlice(0xc0003f1020, 0x34fff0a, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/bufio/bufio.go:356 +0x3cb
bufio.(*Reader).ReadLine(0xc0003f1020, 0x0, 0x0, 0x0, 0x3310000, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/bufio/bufio.go:385 +0x88
net/textproto.(*Reader).readLineSlice(0xc000200090, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/textproto/reader.go:55 +0xb7
net/textproto.(*Reader).ReadLine(0xc000200090, 0x0, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/textproto/reader.go:36 +0x6f
net/http.readRequest(0xc0003f1020, 0x101000, 0xc000546200, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/http/request.go:968 +0xb0
net/http.(*conn).readRequest(0xc00045e460, 0x1e845e0, 0xc0003d08c0, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/http/server.go:967 +0x4e4
net/http.(*conn).serve(0xc00045e460, 0x1e845e0, 0xc0003d08c0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/http/server.go:1819 +0xca6
created by net/http.(*Server).Serve
	/usr/local/Cellar/go/1.12.5/libexec/src/net/http/server.go:2884 +0x7b7

goroutine 42 [IO wait, 1 minutes]:
internal/poll.runtime_pollWait(0x26adbc8, 0x72, 0xffffffffffffffff)
	/usr/local/Cellar/go/1.12.5/libexec/src/runtime/netpoll.go:182 +0x5e
internal/poll.(*pollDesc).wait(0xc00028a018, 0x72, 0x1e78d00, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/internal/poll/fd_poll_runtime.go:87 +0x9b
internal/poll.(*pollDesc).waitRead(0xc00028a018, 0xc0002b1000, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/internal/poll/fd_poll_runtime.go:92 +0x45
internal/poll.(*FD).Read(0xc00028a000, 0xc0002b1000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/internal/poll/fd_unix.go:169 +0x39f
net.(*netFD).Read(0xc00028a000, 0xc0002b1000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/fd_unix.go:202 +0x7c
net.(*conn).Read(0xc000010018, 0xc0002b1000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/net.go:177 +0xb5
net/http.(*connReader).Read(0xc00047e120, 0xc0002b1000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/http/server.go:787 +0x2ca
bufio.(*Reader).fill(0xc0003283c0)
	/usr/local/Cellar/go/1.12.5/libexec/src/bufio/bufio.go:100 +0x2d3
bufio.(*Reader).ReadSlice(0xc0003283c0, 0x34fff0a, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/bufio/bufio.go:356 +0x3cb
bufio.(*Reader).ReadLine(0xc0003283c0, 0x0, 0x0, 0x0, 0xc00041f200, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/bufio/bufio.go:385 +0x88
net/textproto.(*Reader).readLineSlice(0xc00047e180, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/textproto/reader.go:55 +0xb7
net/textproto.(*Reader).ReadLine(0xc00047e180, 0x0, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/textproto/reader.go:36 +0x6f
net/http.readRequest(0xc0003283c0, 0x101000, 0xc00028e200, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/http/request.go:968 +0xb0
net/http.(*conn).readRequest(0xc0001cc000, 0x1e845e0, 0xc000182000, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/http/server.go:967 +0x4e4
net/http.(*conn).serve(0xc0001cc000, 0x1e845e0, 0xc000182000)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/http/server.go:1819 +0xca6
created by net/http.(*Server).Serve
	/usr/local/Cellar/go/1.12.5/libexec/src/net/http/server.go:2884 +0x7b7

goroutine 45 [IO wait, 1 minutes]:
internal/poll.runtime_pollWait(0x26adaf8, 0x72, 0xffffffffffffffff)
	/usr/local/Cellar/go/1.12.5/libexec/src/runtime/netpoll.go:182 +0x5e
internal/poll.(*pollDesc).wait(0xc000118218, 0x72, 0x1e78d00, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/internal/poll/fd_poll_runtime.go:87 +0x9b
internal/poll.(*pollDesc).waitRead(0xc000118218, 0xc00018c100, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/internal/poll/fd_poll_runtime.go:92 +0x45
internal/poll.(*FD).Read(0xc000118200, 0xc00018c161, 0x1, 0x1, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/internal/poll/fd_unix.go:169 +0x39f
net.(*netFD).Read(0xc000118200, 0xc00018c161, 0x1, 0x1, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/fd_unix.go:202 +0x7c
net.(*conn).Read(0xc0005300b0, 0xc00018c161, 0x1, 0x1, 0x0, 0x0, 0x0)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/net.go:177 +0xb5
net/http.(*connReader).backgroundRead(0xc00018c150)
	/usr/local/Cellar/go/1.12.5/libexec/src/net/http/server.go:677 +0xb6
created by net/http.(*connReader).startBackgroundRead
	/usr/local/Cellar/go/1.12.5/libexec/src/net/http/server.go:673 +0xfc
Process exiting with code: 0

```


## Description

<!-- Description of a problem -->

## How to reproduce

The code is :
```

// delete
func deleteFavorite(c *gin.Context) {
	var data models.Favorite

	if err := c.ShouldBindQuery(&data); err != nil {
		c.JSON(200, ghttp.JSONResponseFailed("取消收藏失败", err.Error()))
		return
	}

	if data.ID <= 0 {
		c.JSON(200, ghttp.JSONResponseParamError("取消收藏失败"))
		return
	}

	if err := servers.Db.Delete(&data).Error; err != nil {
		c.JSON(200, ghttp.JSONResponseFailed("取消收藏失败", err.Error()))
	} else {
		c.JSON(200, ghttp.JSONResponseSuccess("取消收藏成功", data))
	}
}
```
## Expectations
It works!

## Actual result
crash

## Environment

- go version: go version go1.12.5 darwin/amd64
- gin version (or commit ref):v1.4.0
- operating system: macOS

Closing the response body after serving data from reader 


Hi,

I want add custom keys to all apis, but I do not want to add it for  every func.

e.g:

The origin code:
`context.JSON(200, gin.H{
		"message": "ha",
	})`

Then I get response:
`{
    "message": "ha"
}`


I expect:
`{
    "key1": 1000,
    "key2": 2000,
    "message": "ha"
}`


I had write a middleware that log the response body to custom logger, but I want to know if there is a way can rewrite the gin response body

I had search some docs but still not figure that out, e.g: #572

Thanks
- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.

I think method `initQueryCache` only needs be called once.


due to c.Error() is not friendly to golint and useless returned,
thought to remove it. 
this is my first try to propose my idea here, if any problems please let me know. thx!

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.

## Description

while running the example of parameters in Path as given in readme.md it fails with error
`c.FullPath() == "/user/:name/*action" evaluated but not used
`
## How to reproduce
create a file example.go as below and run it with command go run example.go

`package main

import (
"github.com/gin-gonic/gin"
        "net/http"
         "fmt"
)

func main() {
        router := gin.Default()

        // This handler will match /user/john but will not match /user/ or /user
        router.GET("/user/:name", func(c *gin.Context) {
                name := c.Param("name")
                c.String(http.StatusOK, "Hello %s", name)
        })

        // However, this one will match /user/john/ and also /user/john/send
        // If no other routers match /user/john, it will redirect to /user/john/
        router.GET("/user/:name/*action", func(c *gin.Context) {
                name := c.Param("name")
                action := c.Param("action")
                message := name + " is " + action
                c.String(http.StatusOK, message)
        })

        // For each matched request Context will hold the route definition
        router.POST("/user/:name/*action", func(c *gin.Context) {
                 c.FullPath() == "/user/:name/*action" // true
                
        })

        router.Run(":8090")
}
`


## Expectations
go run example.go should run without errors and README updated accordingly with some explanation about fullpath and context



## Environment

- go version: 1.15
- gin version (or commit ref): latest 
- operating system: Ubuntu


Can gin have a group without a prefix?

According to the documentation on the method, the answer is YES. but I need to make sure it is supported.

https://github.com/gin-gonic/gin/blob/0304ee96edb2f7f863d5e8337073cade0327af4a/ginS/gins.go#L50

What I am trying to achieve is to group some routes together and apply some middleware (JWT) without having to add some prefix to them all.


close #2432

Hi here is 2 pics of my problem 

1: [https://pasteboard.co/JoL5t8E.png](https://pasteboard.co/JoL5t8E.png)
2: [https://pasteboard.co/JoL6aw1.png](https://pasteboard.co/JoL6aw1.png)

`router.GET("/register/:something", middleware)
router.GET("/register", middleware)`

I have these two path the /register/:something is on the first pic and /register on second.
I dont understand why are /register in the static files path when the path have some params.
currently sse.Event is uncompressed

#285 


It's always been possible to bind using an object of type `map[string]string`. For example:

```go
obj := make(map[string]string)
c.Bind(&obj)
```

If the request body was formatted as JSON (or YAML), this worked fine. You'd get a dictionary with key-values. For example, with input:

```json
{
    "foo": "bar",
    "hello": "world"
}
```

You'd get in the object:

- `obj["foo"] = "bar"`
- `obj["hello"] = "world"`

However, this did **not** work if the request's body was form-encoded (`application/x-www-form-urlencoded` or `multipart/form-data`).

This PR adds support for passing a pointer to `map[string]string` to `Bind` that works with: Forms (POST Forms, Multipart forms), JSON, YAML. It also works with query strings. (However, it does NOT work with XML, because the XML parser doesn't allow that).

**Why is this useful?** Sometimes, there are situations in which I'm expecting a key-value dictionary, but I do not know what keys I'll receive.

This PR includes tests.
go unit test should test handler independently without router and middleware, gin.Context is struct, no way to use gomock to mock it

`gin.CreateTestContext(...)` is not good enough

below is my code
````
type AdminHttpHandler interface {
}

type AdminHttpHandlerImpl struct {
	adminAppService AdminAppService
}

func (this AdminHttpHandlerImpl) QueryCheckRuleHandler(ctx *context.Context) {
	product := ctx.DefaultQuery("productCode", "")
	name := ctx.DefaultQuery("name", "")
	code := ctx.DefaultQuery("code", "")
	dsType := ctx.DefaultQuery("dsType", "")
	enabled := ctx.DefaultQuery("enabled", "")
	page, _ := strconv.Atoi(ctx.DefaultQuery("currentPage", "1"))
	pageSize, _ := strconv.Atoi(ctx.DefaultQuery("pageSize", "20"))

	ret, err := this.adminAppService.QueryCheckRules(product, name, code, dsType, enabled, page, pageSize)
	if err != nil {
		ctx.JsonError(err)
		return
	}

	ctx.JsonSuccessNormal(ret)
}
````
unitest code

````
func TestAdminHttpHandlerImpl_QueryCheckRuleHandler(t *testing.T) {
	type fields struct {
		adminAppService AdminAppService
	}
	type args struct {
		ctx *context.Context
	}

	ginCtx, _ := gin.CreateTestContext(httptest.NewRecorder())

	mockCtl := gomock.NewController(t)
	defer mockCtl.Finish()
	mockObj := NewMockAdminAppService(mockCtl)
	mockObj.EXPECT().QueryCheckRules(gomock.Any(), gomock.Any(), gomock.Any(), gomock.Any(), gomock.Any(), gomock.Any(), gomock.Any()).Return(nil, errors.New("db error"))
	mockObj.EXPECT().QueryCheckRules(gomock.Any(), gomock.Any(), gomock.Any(), gomock.Any(), gomock.Any(), gomock.Any(), gomock.Any()).Return([]*check_rule.CheckRule{}, nil)

	tests := []struct {
		name   string
		fields fields
		args   args
	}{
		// TODO: Add test cases.
		{"test", fields{

		},
			args{
				ctx: context.CreateWrappedContext(ginCtx),
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			this := AdminHttpHandlerImpl{
				adminAppService: tt.fields.adminAppService,
			}
			this.QueryCheckRuleHandler(tt.args.ctx) // panic
		})
	}
}
````
the office mock context panic
#2480 
- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integration systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


Hello, When `c.Error(e)` is called if e is nil, it will panic.

This pull request is to support `c.Error(nil)`
post FormData time is error.
invalid character '-' after top-level value

post map is ok.

```golang
// User
type User struct {
    ID  int64   `json:"id" form:"id" gorm:"column:id;primary_key;AUTO_INCREMENT;comment:'ID'"`
    Birthday DateType   `form:"birthday" json:"birthday" gorm:"column:birthday;type:DATE;not null;default:'1990-01-10';comment:'birthday'"`
}
type DateType time.Time

func (dt DateType) MarshalText() ([]byte, error) {
    fmt.Println("DateType", "MarshalText")
    t := time.Time(dt)
    value := t.Format("2006.01.02")
    return []byte(fmt.Sprintf(`%s`, value)), nil
}

func (dt DateType) MarshalJSON() ([]byte, error) {
    fmt.Println("DateType", "MarshalJSON")
    t := time.Time(dt)
    var stamp = fmt.Sprintf(`"%s"`, t.Format("2006.01.02"))
    return []byte(stamp), nil
}

var _ json.Unmarshaler = &DateType{}

func (dt *DateType) UnmarshalJSON(bs []byte) error {
    var s string
    err := json.Unmarshal(bs, &s)
    if err != nil {
        return err
    }
    t, err := time.ParseInLocation("2006.01.02", s, time.UTC)
    if err != nil {
        return err
    }
    *dt = DateType(t)
    return nil
}

func UserUpdate(c *gin.Context) {
    data := new(model.User)
    fmt.Println("birthday|"+c.PostForm("birthday")+"|")
    err := c.ShouldBind(&data)
    if err != nil {
         //  post FormData err
        fmt.Println("ShouldBind", err)
        return
    }
    // post map is ok.
    fmt.Println("OK", data)
    return
}
```

What's the reason？
## Description

I'm using Gin to serve large files to clients, streaming them.

When a request is in process (while the client is downloading data), if the client disconnects, the goroutine that is serving the request hangs and it leaks.

You can look at the code below as an example. What happens is that `c.Writer` hangs (the method tries to write data in the stream, but there's nothing reading it), so the goroutine hangs on that line.

I have also implemented a solution that listens to when the request's context is canceled to abort writing. However, not every time that the browser cancels the request, the context is canceled.

## How to reproduce

Smallest code sample:

```
func main() error {
	router := gin.New()
	router.GET("/test", func(c *gin.Context) {
		for i := 0; i < 100000; i++ {
			p := make([]byte, 2000)
			io.ReadFull(rand.Reader, p)
			// Goroutine hangs here
			c.Writer.Write(p)
			fmt.Println("Request done")
		}
	})
}
```

Make a request to `/test`, then cancel it while the browser is downloading data. You'll see a goroutine leak (proof: you never see "Request done" in the console, and if you try to kill the app with CTRL+C, it won't respond)

## Expectations

If the client cancels the requests while in progress, there should not be a goroutine leak. It should also output `Request done` in the console. Trying to kill the app with CTR+C, kills it right away.

## Actual result

When the request is canceled, there's a goroutine leak. Nothing appears on the console. Sending a SIGTERM (CTRL+C) to the app doesn't have any effect.

## Environment

- go version: 1.15
- gin version (or commit ref): 1.6.3
- operating system: Linux (Debian)

## What it solves

Currently if enable `RedirectTrailingSlash` or `RedirectFixedPath`, gin will skip any global middlewares and redirect directly. It leads to some problems. For example, recording the path that caused the redirection (logger), adding some external headers to response (handler), or even rewrite target path.

## Feature

- call global middlewares before auto redirection

- add `AutoRedirect` API on engine to set handlers used before auto redirection. It's like `NoMethod` and `NoRoute`, and will be called just before redirect.



may related: #1004 , #2458 
close #2458 

> 6.5.5.  405 Method Not Allowed
>
>   The 405 (Method Not Allowed) status code indicates that the method
>   received in the request-line is known by the origin server but not
>   supported by the target resource.  The origin server MUST generate an
>   Allow header field in a 405 response containing a list of the target
>   resource's currently supported methods.


close #2397 
最近用uint比较多,发现Context中竟然没有相应的GetUint方法,还得自己写方法转,是否考虑增加相应方法呢?
Allow specifying which headers to use for deducing client IP.

Allow specifying which proxies you trust to provide those headers.

Set defaults to match current behaviour.

Fixes #2473 and #2232
https://github.com/gin-gonic/gin/blob/b94d23d1b48d7b5078035ddbab0c3b5df138b827/context.go#L716-L725

If Gin is exposed directly to the internet, a client can easily spoof its client IP by simply setting an X-Forwarded-For header.

The correct way to handle this is to require a list of trusted proxies to be configured. If unset, X-Forwarded-For should be ignored.

I filed a similar issue against Cloud Foundry's gorouter a few years ago. cloudfoundry/gorouter#179  In case that repo should migrate elsewhere, I'm copying the contents of the report in its entirety here:

## Issue

X-Forwarded-For is passed through unfiltered, allowing anyone to spoof their origin IP.

## Context

X-Forwarded-For records the path a given request has taken. The first IP is the origin client, each subsequent IP denotes a path along the way (proxies, load balancers, whatever). It's the only way for a backend service to determine the original IP, since the incoming connection is from the gorouter.

However, blindly trusting the header obviously allows anyone to spoof the origin IP. Common ways to address this security problem is to only trust X-Forwarded-For headers from trusted sources.

Examples of how to mitigate this problem:
https://httpd.apache.org/docs/current/mod/mod_remoteip.html#remoteiptrustedproxy
http://nginx.org/en/docs/http/ngx_http_realip_module.html#set_real_ip_from


## Steps to Reproduce

Pass a X-Forwarded-For header with someone else's IP (e.g. 8.8.8.8) in it to your application, and it'll appear as though that's where the request came from.

## Expected result

Since I'm not a trusted client, my X-Forwarded-For header should have been discarded, and my IP should be the first in the X-Forwarded-For header received by the backend.

## Current result

The backend service will see an X-Forwarded-For header reading "8.8.8.8, [my real IP], [gorouter IP]" (possibly more, if there's a load balancer or something in the path). It will think the request came from 8.8.8.8.

## Possible Fix

Allow specifying a list of IPs (or CIDR's) of trusted proxies and load balancers. If the request didn't come from one of them, discard the X-Forwarded-For. For bonus points, do what nginx does: Go through the list (starting from the last entry) and check each entry to see if it's the list of trusted proxies. When one is encountered that's not on the list, discard everything before it.



All of the above also applies to X-Forwarded-Proto. We shouldn't trust people to say that their request was ever HTTPS if it never was.
I'm using gin to route API requests.
One of the Middlewares is responsible to redirect incoming request from one path to another.
I'm following the docs and use `HandleContext(c)` like this 

```go
...
func(c *gin.Context) {
		ctx := c.Request.Context()
		logger := log.MustGetFromContext(ctx)

		redirectRule := getRedirectRule(c.Request.URL, config.RedirectRoutes)
		if redirectRule == nil {
			c.Next()
			return
		}

		logger.Tracef("re-routing layer from path:[%s %s], to path:[%s %s]",
			c.Request.Method,
			c.Request.URL.Path,
			redirectRule.Method,
			redirectRule.DestinationPath)

		c.Request.URL.Path = redirectRule.DestinationPath
		c.Request.Method = redirectRule.Method
		// this is the phoenix way... even if there is an error...
		logger.Tracef("compatibility layer, changing http status from [%v] to [200] ", c.Writer.Status())
		responseBuffer := response_buffer.NewResponseBuffer(c.Writer)
		c.Writer = responseBuffer
		router.HandleContext(c)
		responseBuffer.SetStatus(http.StatusOK)

		c.Abort()
	}
```

this section 
``` go
        responseBuffer := response_buffer.NewResponseBuffer(c.Writer)
		c.Writer = responseBuffer
		router.HandleContext(c)
		responseBuffer.SetStatus(http.StatusOK)
```

is injecting a custom `ResponseWriter` called responseBuffer that allows me to buffer the body and status  so it can be manipulated just before flushing it back to the client.
but after the call to `router.HandleContext(c)` I see during debug that the c.Writer is of type gin.responseWriter and not my bufferWriter.

any other way for me to change the response status code or manipulate the body with this scenario ?

SO ref: https://stackoverflow.com/questions/63453064/using-router-handlecontextc-to-redirect-and-change-response-status-code
hope its okay to re-post .. just didn't get any help there 
I'd like to execute my own code in case of recovery and the code from the readme would be perfect. Unfortunately there no release with it yet. Why?
Is it possible to re-route an incoming request ? 
I have legacy routes I need to support, and I was wondering if I can add something like a middleware that checks if a given route starts with some prefix and them move it to a different route..

```go
        router := gin.New()
	router.Use(LegacyRouter())

	router.Use(gin.Recovery())
	systemRouter := router.Group("/") 
	noAuthRouter := router.Group("/"
	authRouter := router.Group("/") 
```

so in `LegacyRouter()`
i have this 

```go
func LegacyRouter() gin.HandlerFunc {
	return func(c *gin.Context) {
		pathParts := strings.Split(c.Request.URL.Path,"/")
		RemoveEmpty(&pathParts)
		if len(pathParts) > 0{
			if strings.EqualFold(pathParts[0], "legacyPrefix"){
				if len(pathParts) >= 5 {
					service := pathParts[2]
					action := pathParts[4]
					log.Printf("service: %s action: %s", service, action)
					c.Request.URL.Path = "/"+action
				}
			}
		}
		c.Next()
	}
}
```

I thought that if I change the request path then gin router will hop to the relevant gorup like `authRouter := router.Group("/")`

but it does't :\

any way to tell the router to move to a different route base on url path ? 
Description

Unable to make binding for positive int check work

## How to reproduce


```
package main

import (
	"github.com/gin-gonic/gin"
)


type PaginationQuery struct {
	Limit int `form:"limit" binding:"numeric,gte=0"`
	StartFrom int `form:"start_from" binding:"numeric,gte=0"`
}

func View (c *gin.Context) {
query := new(PaginationQuery)

if err := c.ShouldBindQuery(&query); err != nil {
	c.JSON(
		http.StatusUnprocessableEntity,
	 	BuildErrorResponse(err))  // returns custom error message and 422 code
	return
	}
}
.....
```

## Expectations


```
$ curl http://localhost:8201/hello/world?limit=-1
> 422 failed because of tag gte=0

$ curl http://localhost:8201/hello/world?limit=qwert
> 422 failed because of tag numeric
```

## Actual result
It works only gte=0 part but not for numeric part. When I try to pass non-digit value,  it fails with strconv.ParseInt error

## Environment

- go version: 1.14
- gin version (or commit ref): 1.6.3
- operating system: Ubuntu 16.04






` file, err := c.FormFile("file")
	if err != nil {
		fmt.Println("err", err)
	} `

* What are the allowed file extension that c.FormFile("file") support? 

When I tried to upload simple text file I get following error.
`text/plain File Type Not supported`

* How can I make it accepts other file types like csv, zip, txt etc?

**Environment** 
Gin: v1.6.3
Go: 1.14

The mapping is as follows:
```go
//limit 0:10
job.GET("/details/:id",globalManpowerDemandController.Details)
job.GET("/:limit", globalManpowerDemandController.LimitManpowerDemand)
```
The error is as follows:

```
panic: wildcard segment ':limit' conflicts with existing children in path '/api/job/:limit'
```
At first glance these should be two different paths, but they are identified as conflicting. What should I do?
```
/details/:id
/:limit
```
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description
bind request body have a parameter  type is []string,I want have [] but get nil

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
        info := &struct {
		Test        []string `json:"test" form:"test"`
	}{}

	if err := c.Bind(info); err != nil { // 获取参数
		common.Logger.Error(err.Error())
		ret.Message = err.Error()
		c.JSON(ret.Status, ret)
		return
	}
```

## Expectations
![image](https://user-images.githubusercontent.com/44568110/89984870-ae997680-dcac-11ea-8378-465763b5a793.png)





## Environment

- go version:1.14
- gin version (or commit ref):1.6.3
- operating system:win10

ci support Go 1.15


## Description
Get 400 Bad Request after 2000 requests using PUT\DELETE methods
  router.POST("/attach/:id", Post()) - works fine, but 
  router.PUT("/attach/:id", Post()) and router.DELETE("/attach/:id", Post()) - fail requests after ~2000r

****

<!-- Description of a problem -->

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
  "github.com/gin-gonic/gin"
  "net/http"
)

func main() {
  server := &http.Server{
    Addr:    ":80",
    Handler: GetRouter(),
  }

  server.ListenAndServe()
}

func GetRouter() *gin.Engine {
  router := gin.New()
  router.POST("/attach/:id", Post())
  router.PUT("/attach/:id", Post())
  return router
}

func Post() gin.HandlerFunc {
  return func(context *gin.Context) {
    context.JSON(200,"OK")
  }
}
```
# Request example 
```
PUT /attach/29037 HTTP/1.1
Host: 127.0.0.1
Content-Type:multipart/form-data; boundary=-------------5f2aeef393927
Content-Length:149903

---------------5f2aeef393927
Content-Disposition: form-data; name="entity_name"

goods1
---------------5f2aeef393927
Content-Disposition: form-data; name="entity_id"

1
---------------5f2aeef393927
Content-Disposition: form-data; name="group_name"

images
---------------5f2aeef393927
Content-Disposition: form-data; name="order"

24521
---------------5f2aeef393927
Content-Disposition: form-data; name="attach"; filename="image.jpg"
Content-Type: image/jpeg


```

## Actual result

<!-- Actual result showing the problem -->
```
In my case I get "400 Bad request" in 50% requests after ~2000 requests
RPS no mater
I get this response after 10s 200rps and 100s 20rps 
http://prntscr.com/tx6cjj

The same using DELETE
```

## Environment

- go version 1.14:
- operating system Debian: 
![Снимок экрана от 2020-08-10 16-39-42](https://user-images.githubusercontent.com/30122085/89791160-92ba9700-db2b-11ea-8e3a-c4b288333ee7.png)

## Description

I encountered a panic recently and was somehow misled by the printed panic trace; specifically, the printed line number was incorrect after panic recovery.

## How to reproduce

This issue can be reproduced with the code snippet below:

```
package main

import (
	"fmt"
	"github.com/gin-gonic/gin"
)

func main() {
	r := gin.Default()
	r.GET("/ping", func(c *gin.Context) {
		data, _ := foo()
		fmt.Println(data.b)
	})
	r.Run()
}

type Bar struct {
	b uint
}

func foo() (*Bar, error) {
	return nil, nil
}
```
## Actual result
Trying to call this `ping` API with the curl,
```
curl --location --request GET 'http://localhost:8080/ping'
```
and the stack trace below would be printed out
![panic](https://user-images.githubusercontent.com/9295367/89760024-005fc680-db1e-11ea-9c85-7fdafec5cc2d.png)
## Expectations

<!-- Actual result showing the problem -->
In the printed trace, both the line number and the statement are incorrect, since the nil pointer dereference was caused by `fmt.Println(data.b)` in line 12.

## Environment

- go version: `go1.12.7 darwin/amd64`
- gin version (or commit ref): `815e1ce281f873c62cdbe05d60b5b2ef9d20ed6b`
- operating system: `macOS 10.15.6 (19G73)`
## Description
- `Copy()` method in `gin.Context` is not thread-safe
- it will panic if we use `Set` or `Get` method simultaneously
## Problem Code

> panic raised when ranging `c.Keys`

```
func (c *Context) Copy() *Context {
	cp := Context{
		writermem: c.writermem,
		Request:   c.Request,
		Params:    c.Params,
		engine:    c.engine,
	}
	cp.writermem.ResponseWriter = nil
	cp.Writer = &cp.writermem
	cp.index = abortIndex
	cp.handlers = nil
	cp.Keys = map[string]interface{}{}
	for k, v := range c.Keys {
		cp.Keys[k] = v
	}
	paramCopy := make([]Param, len(cp.Params))
	copy(paramCopy, cp.Params)
	cp.Params = paramCopy
	return &cp
}
```
## My Question
- `Set` or `Get` method has already used mutex to protect Keys map
- why not using the same mutex in `Copy` method?
## Description

Binding error when using `omitempty` along with `gte` or `min` when `gte=1` or `min=1` and parmaeter is `0`.

## How to reproduce

```
package main

import (
	"net/http"

	"github.com/gin-gonic/gin"
	"github.com/gin-gonic/gin/binding"
)

type Test struct {
	Test int `form:"test" binding:"omitempty,lte=10,gte=1"`
	Test2 int `form:"test2" binding:"omitempty,max=10,min=1"`
}

func main() {
	route := gin.Default()

	route.GET("/test", getTest)
	route.Run(":8085")
}

func getTest(c *gin.Context) {
	var t Test
	if err := c.ShouldBindWith(&t, binding.Query); err == nil {
		c.JSON(http.StatusOK, gin.H{"message": "Test is valid!"})
	} else {
		c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
	}
}

```

## Expectations

```
$ curl "localhost:8085/test?test=0&test2=0"
{"error":"Key: 'Test.Test' Error:Field validation for 'Test' failed on the 'gte' tag\nKey: 'Test.Test2' Error:Field validation for 'Test2' failed on the 'max' tag"}
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl "localhost:8085/test?test=0&test2=0"
{"message":"Test is valid!"}
```

## Environment

- go version: go1.14.6 darwin/amd64
- gin version (or commit ref): v1.6.3
- operating system: macOs 10.15.6 (19G73)

## Description

<!-- Description of a problem -->

## How to reproduce
I am sending an AJAX request which has trailing slash redirect but it does not redirects because of CORS issue. I dig the code more and then i found that `gin.go` file has `redirectRequest` function `github.com/gin-gonic/gin/gin.go` if i add the the CORS header then the whole request works fine as you can see the screenshot under EXPECTATION section.

How to resolve the issue without modifying the GIN core file ?

```
func redirectRequest(c *Context) {

        // CODE INSERTED ==================
	c.Writer.Header().Set("Access-Control-Allow-Origin", c.Request.Header.Get("Origin"))

	req := c.Request
       ....
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
<img width="1440" alt="Screenshot 2020-08-07 at 9 31 25 PM" src="https://user-images.githubusercontent.com/2174170/89664871-69182a80-d8f5-11ea-943e-0463a867506c.png">


## Actual result

<!-- Actual result showing the problem -->
<img width="1436" alt="Screenshot 2020-08-07 at 9 26 07 PM" src="https://user-images.githubusercontent.com/2174170/89664473-d9727c00-d8f4-11ea-93c3-eaee7c72f239.png">
<img width="1430" alt="Screenshot 2020-08-07 at 9 25 54 PM" src="https://user-images.githubusercontent.com/2174170/89664484-dd9e9980-d8f4-11ea-9eb7-62b840d4ef64.png">


## Environment

- go version: 1.14
- gin version (or commit ref): v1.6.3
- operating system: OSX

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description
I think goroutines inside middleware need add alter to goroutines-inside-a-middleware-or-handler.
older version is default user know middleware and handler is same thing. it's not clear. i think we should make it clear.then provider code in Readme.
<!-- Description of a problem -->


Hi,
This PR,
Deleted the constant "MINEXML2".
Because, according to [RFC7303](
https://tools.ietf.org/html/rfc7303),
text/xml and application/xml are the same, 
and It was written that is recommended to use application/xml to avoid confusion with past usage.
Therefore, I think it is better to remove it from the constants that users can use.
master 

engine := New()
engine.Use(Logger(), Recovery())

func LoggerWithConfig(conf LoggerConfig) HandlerFunc   not have  Lock operation





go-playground/validator/v10 provides [translations](https://github.com/go-playground/validator/tree/master/translations) features to change the error language. I have traced the code, it initial validator inside of Gin. I couldn't find a way to inject it. Is there another way to change error language?

![image](https://user-images.githubusercontent.com/6435369/89282228-cc982300-d67d-11ea-9b8a-be6f1a7d29fa.png)

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

<!-- Our security team has flagged a security issue in a dependency in this repo. Kindly upgrade so we can upgrade as well -->

## How to reproduce

<img width="890" alt="Screenshot 2020-08-04 at 3 18 09 PM" src="https://user-images.githubusercontent.com/735633/89264600-c8f8a200-d665-11ea-8aee-0fa89ba4dd39.png">
<img width="893" alt="Screenshot 2020-08-04 at 3 18 22 PM" src="https://user-images.githubusercontent.com/735633/89264627-d3b33700-d665-11ea-8d67-6598737a599b.png">


## Environment

- go version: 1.14
- gin version (or commit ref): github.com/gin-gonic/gin v1.5.0
- operating system: na






Function setTimeField calls strconv.ParseInt with bit size 0 when
parsing Unix time, which means it is equivalent to specifying 32 on
32-bit architectures. This causes the function to suffer from the year
2038 problem. To fix it and keep the behavior the same on both 32-bit
and 64-bit architectures, explicitly specify bit size 64.

I am not sure if I should add a test for this pull request. It only affects 32-bit systems, but the CI only tests 64-bit systems.
old: [![GoDoc](https://godoc.org/github.com/gin-gonic/gin?status.svg)](https://pkg.go.dev/github.com/gin-gonic/gin?tab=doc)
new: [![GoDoc](https://pkg.go.dev/badge/github.com/gin-gonic/gin?status.svg)](https://pkg.go.dev/github.com/gin-gonic/gin?tab=doc)



https://github.com/gin-gonic/examples/pull/39
## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
	"go.mongodb.org/mongo-driver/bson"
	"go.mongodb.org/mongo-driver/bson/primitive"
	"net/http"
)

type QueryModel struct {
	Id *primitive.ObjectID `form:"id"`
}

func main() {
	g := gin.Default()

	g.GET("/hello/", func(c *gin.Context) {
		var query QueryModel
		if err := c.BindQuery(&query); err != nil {
			c.JSON(http.StatusBadRequest, bson.M{"msg": err.Error()})
			return
		}
	})
	g.Run(":9000")
}

```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl http://localhost:9000/hello/\?id\=5f2146e27d0e10f02a525412
{"msg":"[\"5f2146e27d0e10f02a525412\"] is not valid value for primitive.ObjectID"}%
```
I see in the examples how you return marshaled data.  For instance:

	c.JSON(http.StatusOK, gin.H{
		"code": 200,
		"msg":  "",
		"data": string(MYJSON),
	})

However this wraps the json into the data node.  I want to return my struct as a top level node.   I also see this example:
c.String(http.StatusOK, string(json))

However this I believe messes with the encoding as a straight string.  

I simply want to return my mode/object as json and not wrapped in a sub node.  Thank you.


with
github.com/go-delve/delve
## Description

The `LoadHTMLGlob("templates/**/*")` example in the [GitHub documentation](https://github.com/gin-gonic/gin#html-rendering) doesn't work.

## How to reproduce

Create template files:
```
$ mkdir -p templates/posts templates/users
$ echo "posts/index.tmpl" > templates/posts/index.tmpl
$ echo "users/index.tmpl" > templates/users/index.tmpl
```

Go code (from example in documentation):
```go
package main

import (
        "net/http"

	"github.com/gin-gonic/gin"
)

func main() {
	router := gin.Default()

        router.LoadHTMLGlob("templates/**/*")
        router.GET("/posts/index", func(c *gin.Context) {
                c.HTML(http.StatusOK, "posts/index.tmpl", gin.H{
                        "title": "Posts",
                })
        })
        router.GET("/users/index", func(c *gin.Context) {
                c.HTML(http.StatusOK, "users/index.tmpl", gin.H{
                        "title": "Users",
                })
        })
        router.Run(":8080")
}
```

## Expectations

```
$ go run main.go
[GIN-debug] Loaded HTML Templates (2): 
	- posts/index.tmpl
	- users/index.tmpl
```

```
$ curl http://localhost:8080/posts/index
posts/index.tmpl
$ curl http://localhost:8080/users/index
users/index.tmpl
```

## Actual result

```
$ go run main.go
[GIN-debug] Loaded HTML Templates (2): 
        - index.tmpl
	- 
```

```
$ curl http://localhost:8080/posts/index
$ curl http://localhost:8080/users/index
```

Also, accessing [http://localhost:8080/posts/index](http://localhost:8080/posts/index) and [http://localhost:8080/users/index](http://localhost:8080/users/index) throws an error server-side:
```
html/template: "posts/index.tmpl" is undefined
```

## Environment

- go version: 1.13.14
- gin version (or commit ref): 1.6.3
- operating system: MacOS 10.15.6

It could be used anywhere to stop the current handler,use less code to  verify params,etc.
If I want to stop a handler to return some error message ,maybe in middleware,or not.
Just like python's **tornado**,it has a `finish()` method,which can stop handler immediately.

In this case,it doesn't work:
```go
func GetCurrentUserID(c *gin.Context) uint {
    c.Done()
    c.Abort()  
    c.AbortWithStatus(999)
    c.AbortWithError(999, errors.New("ERR"))
    c.AbortWithStatus(777)
    c.AbortWithStatusJSON(http.StatusUnauthorized, gin.H{"Message": "Unauthorized"})
    return 0
}
```
Hi Gin,

As FCGI needs an extra web server, I don't see how this could be tested in CI. Anyway it's part of the standard package so I don't think that the FCGI part would need testing.

About web servers:
1/ I could go into more details with Apache but I'm not sure if the readme is the good place for that,
2/ adding the configuration for Nginx would be nice, one day. If someone is interested in doing it, or maybe I will.

Thanks for you time and efforts.
## Description

I have found the related issues:
&nbsp;&nbsp;#1714 
&nbsp;&nbsp;#686 
And try to use the code in the issue, but I got the 404 error when the web broswer get the remote web static file with proxy, how to solve it?

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
r.GET("/test/*proxyPath", ReverseProxy())
...
func ReverseProxy() gin.HandlerFunc {

	target := "http://192.168.1.102:8081"
	return func(c *gin.Context) {
		remote, err := url.Parse(target)
		if err != nil {
			panic(err)
		}
		director := func(req *http.Request) {
			req.URL.Scheme = remote.Scheme
			req.URL.Host = remote.Host
			req.URL.Path = remote.Path
		}
		proxy := &httputil.ReverseProxy{Director: director}
		proxy.ServeHTTP(c.Writer, c.Request)
	}
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
[GIN] 2020/07/22 - 00:00:00| 200 |    8.365956ms |   192.168.1.233 | GET      "/test/"
[GIN] 2020/07/22 - 00:00:00| 200 |       23.26µs |   192.168.1.233 | GET      "/test/myfile"
```

## Actual result

<!-- Actual result showing the problem -->
```
[GIN] 2020/07/22 - 00:00:00| 200 |    8.365956ms |   192.168.1.233 | GET      "/test/"
[GIN] 2020/07/22 - 00:00:00| 404 |       23.26µs |   192.168.1.233 | GET      "/myfile"
```


How to set response in msgpack like this https://github.com/gin-gonic/gin#xml-json-yaml-and-protobuf-rendering ?
go: downloading github.com/gin-gonic/gin v1.6.0
go: finding module for package github.com/leodido/go-urn
..\..\..\..\..\..\pkg\mod\github.com\go-playground\validator\v10@v10.2.0\baked_in.go:19:2: module github.com/leodido/go-urn@latest found (v1.2.0), but does not contain package github.com/leodido/go-urn

Can't seem to use 1.6+ once validator was updated to v10

## Environment

- go version: go1.14.4 windows/amd64
- gin version (or commit ref): 1.6.0+
- operating system: windows10

## Description

Installation failure

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
sudo go get -u github.com/gin-gonic/gin
```

## Expectations

This is a dependency for one of my projects


## Actual result
![image](https://user-images.githubusercontent.com/6247133/87858131-4b385500-c949-11ea-8d98-ea55d47c76cc.png)

```

## Environment

- go version: go version go1.10.4 linux/amd64
- gin version (or commit ref): go version go1.10.4 linux/amd64
- operating system: ubuntu 18

## Description

I want to realize the following demand with golang gin:

When requests of users come into the server(X), the server(X) passes the requests to another server(Y) for solution. When the server(Y) finishs the job, it will call an API of server(X) and post the solution. Then server(X) should respond to the user's request with the solution.

Server(Y) is given, how to design with Golang Gin framework for server(X)? or can gin do it?

In one word: it is a kind of converting async to sync.

## Description

Hi, I would like gin serve only on a domain name not on ip or localhost, is there a way to do this? Thank you!

## How to reproduce

```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/hello/:name", func(c *gin.Context) {
		c.String(200, "Hello %s", c.Param("name"))
	})
	g.Run("www.domain_name.com:80")
}
```

## Expectations

```
Visit "http://www.domain_name.com" to show my index page,
ban "http://127.0.0.1" and "http://localhost" visiting.
```

## Actual result

<!-- Actual result showing the problem -->
```
I can visit either "http://www.domain_name.com", "http://127.0.0.1" or "http://localhost" to show my index page.
```

## Environment

- go version: 1.14.4
- gin version (or commit ref): latest 20200713
- operating system: Windows 10
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

When I make a request to my backend, I see in the logs that every handler gets executed twice

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->

package main main.go
```
	routes.API(r)

```
package routes api.go
```
api.GET("/client", cache.CachePage(storeCache, time.Hour*12, func(c *gin.Context) {
			client.GET(c)
		}))
```
package controllers client.go
```
func GET(c *gin.Context) {
	client := &models.Client{}
	migrate.DB.Where("id = ?", 1).Find(&client)
	fmt.Println(client)
	c.JSON(http.StatusOK, gin.H{"clientInfo": client})
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
[GIN] 2020/07/13 - 07:22:59 | 200 |    1.485762ms |             ::1 | GET      /v1/client
```

## Actual result

<!-- Actual result showing the problem -->
```
[GIN] 2020/07/13 - 07:22:59 | 200 |    1.485762ms |             ::1 | GET      /v1/client
[GIN] 2020/07/13 - 07:22:59 | 200 |    1.550383ms |             ::1 | GET      /v1/client
```

## Environment

- go version: 1.13
- gin version (or commit ref): v1.5.0
- operating system: Linux


Please add a method to context for getting uint64 like this.

func (c *Context) GetUInt64(key string) (ui64 uint64)
## Expectations

### Receive parameters, use binding to receive, hope to be able to customize the error return information in the tag, and hope to be able to bind the url and body data at the same time.



- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

<!-- Description of a problem -->

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/hello/:name", func(c *gin.Context) {
		c.String(200, "Hello %s", c.Param("name"))
	})
	g.Run(":9000")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl http://localhost:8201/hello/world
Hello world
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl -i http://localhost:8201/hello/world
<YOUR RESULT>
```

## Environment

- go version:
- gin version (or commit ref):
- operating system:

I use vim, and whenever I'm editing an HTML template, a swap file's created in the same directory which always causes Gin to crash when I do a refresh. I naturally could disable the creation of these files, or move them to another directory, but wouldn't it make more sense for Gin to ignore non *.html and *.tmpl files instead?

Or another possibility: just don't panic if an invalid template is encountered. Skip files with bad syntax. Log it as an error and continue.


I am trying to use a custom renderer so I can use pongo2 as a template engine, I have found a commit that added this feature a while back:

https://github.com/gin-gonic/gin/commit/5ea7a92267a38b12e1315deda60fbfc636da7fa1#diff-703ef7478e12fbd8acd9d1af87bda71cR72

However, this feature does not appear to be documented and I can't figure out how to get my own custom render to work, I've been trying out this for a while now, but without any luck.

The question was also asked here but no reply yet:

https://github.com/ngerakines/ginpongo2/issues/3

However, I am not really too keen on the ginpongo2 library either, because it:
- does not use the newer HTMLRender interface added in GIN 1.0
- loads templates on each request which is not very efficient

Any help would be appreciated in how to write a custom renderer.

On logger.go , line 74. 

``` go
methodColor, reset, method,
```

I think it should be

``` go
methodColor,  method,reset
```

```go
type Group struct {
    ID          uint       `json:"id"`
    Name        string     `json:"name"`
    Description string     `json:"description"`
    Users       []User     `json:"users"`
    HashID      string     `json:"hashId"`
    CreatedAt   time.Time  `json:"createdAt"`
    UpdatedAt   time.Time  `json:"updatedAt"`
    DeletedAt   *time.Time `json:"deletedAt"`
}
```

Now I have `Users` key that is an array of User objects. But in my output JSON I just want to output the ids of the users and not all of the user objects. Any easy way of doing that? 


The path of a package can change in a situation where
dependency vendoring is in use.
This change modifies gin's unit tests to allow such paths.

http.Request.RemoteAddr contains the client's ip address and port number.
The reverse proxy headers X-Real-Ip and X-Forwarded-For usually only contain a client's ip address.
This change ensures that the ClientIP method behaves the same in both situations.

The additional logic results in one more allocation.
BenchmarkLoggerMiddleware is affected and goes from 14 to 15 allocations.

When we're outputting JSON i'd like to be able to convert my PascalCase properties on my model to camelCase for JSON. How can I do that? I want the whole API to communicate through camelCase but I want my go model properties to stay Pascal Case. Any good solution for this?  

```
var sesssion SessionData
err := c.Bind(&data)

type SessionData struct {
    UserId   int      `json:"user_id" form:"user_id"`
    Login    string   `json:"login_date,omitempty" form:"login_date"`
    Logout   string   `json:"logout_date,omitempty" form:"logout_date"`
    AppOpen  []string `json:"app_open_dates,omitempty" form:"app_open_dates"`
    AppClose []string `json:"app_close_dates,omitempty" form:"app_open_dates"`
}
```

`AppOpen` and `AppClose` seems to be empty after binding.

My test request body is `(app_close_dates%5B%5D=asfd&app_close_dates%5B%5D=qeqwe&app_open_dates%5B%5D=3&app_open_dates%5B%5D=5&login_date=qqq&logout_date=yyy`

Result is
`sessiondata--> {52 qqq yyy [] []}`

``` go
func main() {
    router := gin.Default()

    router.POST("/post", func(c *gin.Context) {
        id := c.Query("id")
        page := c.DefaultQuery("id", "0")
        name := c.PostForm("name")
        message := c.PostForm("message")

        fmt.Println("id: %s; page: %s; name: %s; message: %s", id, page, name, message)
    })
    router.Run(":8080")
}
```

---

first:

``` go
page := c.DefaultQuery("id", "0")
```

should be

``` go
page := c.DefaultQuery("page", "0")
```

---

second:

``` go
fmt.Println("id: %s; page: %s; name: %s; message: %s", id, page, name, message)
```

shoud be

``` go
fmt.Print("id: %s; page: %s; name: %s; message: %s\n", id, page, name, message)
```

the statement above will output : 
`id: %s; page: %s; name: %s; message: %s 1234 1 manu this_is_great`

``` go
func main() {
    router := gin.Default()

    router.POST("/form_post", func(c *gin.Context) {
        message := c.PostForm("message")
        nick := c.DefaultPostForm("nick", "anonymous")

        c.JSON(200, gin.H{
            "status": "posted",
            "message": message,
        })
    })
    router.Run(":8080")
}
```

---

compile error: `nick declared and not used`

need to add the nick to JSON response's body to solve it.

``` go
        c.JSON(200, gin.H{
            "status":  "posted",
            "message": message,
            "nick":    nick,
        })
```

I am going to add a new behaviour to `Engine.Run()`.
- Back-compatible: it will continue working as expected when an address is provided: `router.Run(":3000")`
- NEW: no parameter: `router.Run()`
  Under this API, gin will try to read the `PORT` environment variable and use it.
  If the `PORT` variable is not defined, ":8080" would be used by default.
- Under discussion: **Support for App Engine**
  can we detect in runtime that we are running under the app engine environment?
  if so, router.Run() should use the app engine's api.


How do I support both POST and GET requests to the same path? 
For example, 

``` go
r.GET("/api/linkcollection/:id", links.GinLinkCollectionView)
authorized.PUT("/api/linkcollection/:id", links.GinLinkCollectionUpdate)
```

HI
Is it possible to do a route like this

```
//route 1
r.Get("/product/:id/)

//route 2
r.Get("/product/:id/shop/:shopid")
```

I'm new to Go and Gin, and am having trouble printing out the full request body.

I want to be able to read the request body from third party POST, but I'm getting empty request body.

```
curl -u dumbuser:dumbuserpassword -H "Content-Type: application/json" -X POST --data '{"events": "3"}' http://localhost:8080/events
```

My entire code is as follow. Any point is appreciated.

``` go
package main

import (
  "net/http"
  "fmt"
  "github.com/gin-gonic/gin"
)

func main() {
  router := gin.Default()
  authorized := router.Group("/", gin.BasicAuth(gin.Accounts{
     "dumbuser": "dumbuserpassword",
  }))
  authorized.POST("/events", events)
  router.Run(":8080")
}

func events(c *gin.Context) {
  fmt.Printf("%s", c.Request.Body)
  c.JSON(http.StatusOK, c)
}
```

Here's the function signature:

``` go
WriteString(w http.ResponseWriter, format string, data []interface{})
```

Now let's assume that we are replacing the gin context writer with our custom one, like in gzip middleware:

``` go
writer := c.Writer
context.Writer = &gzipWriter{c.Writer, gz}
```

If we now call context.Write it will use our custom writer as needed, but context.String will not - because it calls WriteString, which uses a generic interface http.ResponseWriter and not  gin.ResponseWriter. I think the signature should be 

``` go
WriteString(w gin.ResponseWriter, format string, data []interface{})
```

Another option is for gzipWriter to implement WriteString interface, which is not intuitive (and probably needs also Size() and Written()...)

Hello Im getting the below error. This error has only started since switching to a multipart form with file being posted. Any advice much appreciated. 

```
$ curl -X POST --form "icon=@ak2.jpg"  --cookie 'session=91b5sdfdsfdsm' "http://127.0.0.1:8080/v1.0/apps" --form data='{"json_name":"test json name","title":"Test"}'
```

```
Panic recovery -> reflect: NumField of non-struct type
/usr/local/go/src/runtime/panic.go:387 (0x40145d8)
    gopanic: reflectcall(unsafe.Pointer(d.fn), deferArgs(d), uint32(d.siz), uint32(d.siz))
/usr/local/go/src/reflect/type.go:657 (0x416ffca)
    (*rtype).NumField: panic("reflect: NumField of non-struct type")
/usr/local/go/src/src/github.com/gin-gonic/gin/binding/form_mapping.go:16 (0x4162831)
    mapForm: for i := 0; i < typ.NumField(); i++ {
/usr/local/go/src/src/github.com/gin-gonic/gin/binding/form.go:20 (0x4162693)
    formBinding.Bind: if err := mapForm(obj, req.Form); err != nil {
<autogenerated>:2 (0x4163e77)
/usr/local/go/src/src/github.com/gin-gonic/gin/context.go:244 (0x40851e2)
    (*Context).BindWith: if err := b.Bind(c.Request, obj); err != nil {
/usr/local/go/src/src/gin-api/controllers/apps.go:1119 (0x405fe68)
    CreateApps: c.BindWith(&json_tmp, binding.Form)
```

```
func CreateApps(c *gin.Context) {
    var json_tmp map[string]interface{}
    c.Bind(&json_tmp)
    ...
}
```

is there a way to get all the parameters with the same name from a request like `http://localhost:8080/test?id=5&id=10`. 

`c.Query("id")` only gets the first one. 

In a DELETE request, 

``` go
token := c.Request.FormValue("auth_token")
```

Results in an empty string, event though auth_token is definitely in the Body.
Is it possible that the body is not properly parsed for a delete request?

I have a `Group` instance with some common handlers. Then I define some route rule with this `Group`.
If I need more common handlers with this `Group` after these...

e.g.

``` go
r := gin.New()
g := r.Group("/path", handler1, handler2)
g.POST("/to", handler)
g.GET("/method", handler)
g.xxx(handler3)
```

`xxx` is what I want.

Hi, I don't know if it's a GB or Gin issue but my app fails to build. Here's the build error:

```
adred@Skynet:~/Dev/project-hf$ gb build all
github.com/goinggo/tracelog
github.com/go-sql-driver/mysql
gopkg.in/bluesuncorp/validator.v5
github.com/kelseyhightower/envconfig
github.com/gin-gonic/gin/render
github.com/gorilla/securecookie
github.com/manucorporat/sse
golang.org/x/net/context
github.com/mattn/go-colorable
github.com/gorilla/context
github.com/gorilla/sessions
github.com/gin-gonic/gin/binding
vendor/src/github.com/gin-gonic/gin/binding/default_validator.go:29: too many arguments in call to validator.New
bitbucket.org/adred/fh/utils
bitbucket.org/adred/hf/models
FATAL command "build" failed: exit status 2
```

Any idea?

Any chance you can publish a new version that upgrades to v6?  

https://godoc.org/gopkg.in/bluesuncorp/validator.v6

Hai, I want to binding array json, this my struct json

``` go
type Login struct {
    Range struct {
        Min int `json:"min"`
        Max int `json:"max"`
    } `json:"range"`
    Title string `json:"title"`
    From int `json:"from"`
    Brand []string `json:"brand"`
}
```

when i send null array is't not working and when I print using 

``` go
fmt.Println(json.Brand == nil)
```

it's false

Content negotiation as implemented does not support request media type wildcards.

For example, when a client sends `Accept: */*`, the negotiotion logic should respond with any type offered. Currently it fails.

Hi,

I'm reading up on how to serve an entire website through Gin. Based the front page demo, I wrote:

``` Go
        router.StaticFile("/", "./web/views/index.html")
    router.StaticFile("/favicon.ico", "./web/views/favicon.ico")
    router.Static("/css", "./web/views/css")
    router.Static("/js", "./web/views/js")
    router.Static("/image", "./web/views/image")
    router.Static("/plugin", "./web/views/plugin")
```

I have a folder under the root directory called `./web/views`, and the structure is:

```
web/views
├── css
├── doc
├── image
├── js
│   └── vendor
└── plugin
    ├── bootstrap
    │   ├── css
    │   ├── img
    │   └── js
    └── font-awesome
        ├── css
        ├── font
        └── less
```

And I got page not found error:

```
[GIN] 2015/07/26 - 15:36:01 | 404 |    4.522716ms | [::1]:52097 |   GET     /
[GIN] 2015/07/26 - 15:36:01 | 404 |      26.345µs | [::1]:52097 |   GET     /favicon.ico
```

How do I serve the file based on the relative address?? 

func main() {
    router := gin.Default()

```
router.POST("/post", func(c *gin.Context) {
    id := c.Query("id")
    page := c.DefaultQuery("id", "0")
    name := c.PostForm("name")
    message := c.PostForm("message")

    fmt.Println("id: %s; page: %s; name: %s; message: %s", id, page, name, message)
})
router.Run(":8080")
```

}

I think 
page := c.DefaultQuery("id", "0") 
should be:
page := c.DefaultQuery("page", "0")

I think this router is valid, but it cause an error.

r.GET("/teachers/list", func (c *gin.Context){})
r.GET("/teachers/:id/profile", func (c *gin.Context){})

Error:
[GIN-debug] GET   /teachers/list            --> main.func·001 (3 handlers)
[GIN-debug] GET   /teachers/:id/profile     --> main.func·002 (3 handlers)
panic: wildcard route ':id' conflicts with existing children in path '/teachers/:id/profile'

I checked existing issue's but couldn't find a solution.

```go
type Device struct {
    Id                   int       `json:"id"`
    CreatedAt            time.Time `json:"created_at"`
    UpdatedAt            time.Time `json:"updated_at"`
    VendorId             string    `json:"vendor_id"                form:"vendor_id"        binding:"required"`
    SystemName           string    `json:"system_name"              form:"system_name"      binding:"required"`
}
```

![](http://i.imgur.com/cDCjNUV.png)

```go
    var newDevice Device
    err := c.Bind(&newDevice)
       // err prints :
       // Struct:Device
       // Field validation for "SystemName" failed on the "required" tag

    fmt.Println("Vendor", c.PostForm("vendor_id"))       // These return correct
    fmt.Println("System", c.PostForm("system_name")) // These return correct

      // printing newDevice gives empty struct.
```

I also tried deleting required tag. error disappeared but still newDevice was empty. The sending method is `POST`. I don't have any headers. Why doesn't it bind?

http.Request.RemoteAddr contains the client's ip address and port number.
The reverse proxy headers X-Real-Ip and X-Forwarded-For usually only contain a client's ip address.
This change ensures that the ClientIP method behaves the same in both situations.

The additional logic results in one more allocation.
BenchmarkLoggerMiddleware is affected and goes from 14 to 15 allocations.

Hi,

Since upgrading to v1.0rc1 we've been seeing intermittent 500s being returned by gin coupled with the error "Redirecting to HTTPS". It seems like the call to c.Writer.Written() on line 171 of secure.go is returning false even though http.Redirect(w, r, url.String(), status) is being called from within the process function. We did not see this error prior to upgrading from 0.x. Here is how we are configuring our secure handler:

```
securer := secure.Secure(secure.Options{
    SSLRedirect:          strings.ToLower(os.Getenv("FORCE_SSL")) == "true",
    SSLProxyHeaders:      map[string]string{"X-Forwarded-Proto": "https"},
    STSSeconds:           315360000,
    STSIncludeSubdomains: true,
    FrameDeny:            true,
    ContentTypeNosniff:   true,
    BrowserXssFilter:     true,
})
```

Is there something we need to update to ensure these types or requests return only 301s and redirect correctly? Thanks!

My markdown converter converts `[What?]()` to the link `http://localhost:3459/What?.html` or `/What?.html` but when I go there I get `404 page not found`, but if I manually change the `?` character to `%3F` everything works.

My relevant gin code:

``` go
func serve(dir string) {
  //gin.SetMode(gin.ReleaseMode)
  r := gin.Default()
  r.Static("/", dir+"/compiled")
  r.Run(":3459")
}
```

Is it possible to make gin recognize my URLs even if they have `?` in them? Could this perhaps have  something to do with my use of r.Static?

Hi,

Is there a way to know if the http socket is still open (the client may reset the connection during the process) or not ? I don't find anything usable from the Context to reach that.

Thanks.

Problem:

context.Stream() listens to the closeNotifier, which gives the impression that context.Stream() will return as soon as a client disconnects.  Unfortunately, it doesn't!

This example code furthers the impression with the defer closeListener(roomid, listener) which one would expect to be called when a client navigates away, which is not the case.  In fact, it's only called on the next message that's sent to the room after said client exits. 

This is because c.SSEvent("message", <-listener) blocks indefinitely until a message comes in, so will not return and yield to c.Stream()'s select that catches the closeNotify.  This means that if a client navigates away, the server never notices and cleans up.

Fix: Also listen to CloseNotifier inside stream handler.  This causes the step() function to return immediately when the client goes away and allows the cleanup to run.  Updating this example should make it more clear, I think!

**Possible use case:** 

Your application receives health check requests every minute and you don't want them to appear in the log.

Hi!

I think it would be a nice improvement to the documentation to maintain a list of open source projects using the gin framework, so that people learning gin can study real-world examples.

I have a router group "/place" that has the routes "/" and "/:id/*action".

localhost/place/2/ works, but localhost/place/2 does not work although I believe it should according to the readme.

![image](https://cloud.githubusercontent.com/assets/3886287/8760713/beb0a336-2ce9-11e5-9247-a34860500225.png)

I've tried with RedirectTrailingSlash = true, with RedirectFixedPath = true, with both, with neither and still localhost/place/2 does not redirect.

Am I missing something?

I want to order my middleware so that at the end of every request, the final act is to save the session.

Example: 

```
router.Use(MongoDB(session))
router.Use(SessionSave())

func SessionSave() gin.HandlerFunc {
    return func(c *gin.Context) {
        defer func() {
            if err := sessions.Default(c).Save(); err != nil {
                log.Println("failed to save session", err)
            }
        }()
        c.Next()
    }
}
```

The problem is that session save never happens. My thought is that the next() happens, but everything has rendered by that point. If I do the save before the Next() the rest of the middleware doesn't happen like AuthRequired() during my routes that are auth only.

there is too many return to write, can the hander signature like this:
func (c *gin.Context) error. so we could write code like this:

```
if err != nil {
    return err
}
```

not:

```
if err != nil {
            c.AbortWithError(500, err)
    return
}
```

Correct the query parameter name.

We use gin as the server of our mobile app, choosing protobuf to Serialize our data for known reasons. So I add a module for protobuf binding. But I'm sorry to say we can not use 'binding:"len<10"' to validate on protobuf util now, this is what I'm doing on.

![path4201](https://cloud.githubusercontent.com/assets/127379/8634385/ff8ed456-27f6-11e5-8b14-c089e33f3ae1.png)

thanks @javierprovecho !

Is there an easy way to use middleware to append to gin.H for example during auth, if you'd wantto append IsAuthed as a flag every call and then User object.


$go get github.com/gin-gonic/gin

github.com/gin-gonic/gin/binding
/usr/local/go/src/github.com/gin-gonic/gin/binding/default_validator.go:15: undefined: StructValidator

I'm new to Go and gin-gonic (so far, not even a programmer) so excuse my ignorance if this is a simple question and I make something wrong.

I've created a slice, filled it through for loop and pushed the slice to template:

``` go
a := make([]int, 1000)
for i := 0; i < 1000; i++ {
        a[i] = i
}

c.HTML(http.StatusOK, "index.tmpl", gin.H{
        "a": a,
})
```

index.tmpl:
`{{ range .a }} {{ . }} {{ end }}`

I'm comparing performance with php. I used to test my php scripts with loader.io, pushing 5k/s of concurrent connections for 1 minute. In php, the for loop is almost the same thing, I create an array, make a loop, push each iteration into it, and then pass the array to template, where I just foreach the array and receive the same result.

But performance in case of php is, well, better. I get more successful responses (over 25-30k) for a 1 min period, while my gin/go app is breaking after 1000-1500 successful responses.

Notes: I'm using the same configuration of PCs and other software, nginx as front-end server.

Hi,

Im trying set cookies and redirect on the same request, but when i redirect the cookies are not created, if i dont redirect, the cookies are created.

Sample code that im using:

``` go
func panelLoginProcess(c *gin.Context) {
    token := getSHA1Hash("2132323213")
    expiration := time.Now().Add(365 * 24 * time.Hour)
    cookie := http.Cookie{Name: "XYZ-SESSION", Value: token, Expires: expiration}
    http.SetCookie(c.Writer, &cookie)
    c.Redirect(http.StatusMovedPermanently, "/panel/home/index")
}
```

Is this the correct way to redirect to another action and set cookie? 

When receiving a json object with number values and calling `context.BindJSON()` (or `context.Bind()`), the numbers will be unmarshalled to `float64` values. If needed, this can be switched to unmarshalling into `int` by using `json.Decoder.UseNumber()`. However, `BindJSON()` doesn't give this control. This should be added somehow:
- maybe a global switch, though this doesn't give per-request control.
- maybe an additional parameter or `...` parameter
- any other idea?

Hi
Can I define routing separated with Host(Domain)?

hi guys,

Gin is great Go Project, special use tree to manage router,
like use ':' & '*' to match params. but when i read tree.go. 
i can't understand how to build a MethodTree, because there are so many complex rules.
Which would have been fine if the document have been built on your website(https://gin-gonic.github.io).
Additionnal, perfer to see some Structure Chart or Timing Chart about this project.
I want to see it in the back. 

thanks.

eg: the user's attributes in different function has defferent required attributes. for example in login function the account and password are required but in update function the id is required. so how can i solve this problem?

``` go
// LoginJSON stuff
type LoginJSON struct {
    User     string `json:"user" binding:"required"`
    Password string `json:"password" binding:"required"`
}

func Create(c *gin.Context) {
    var json LoginJSON
    c.Bind(&json) // This will infer what binder to use depending on the content-type header.
    if json.User == "manu" && json.Password == "123" {
        c.JSON(http.StatusOK, gin.H{"status": "you are logged in"})
    } else {
        c.JSON(http.StatusUnauthorized, gin.H{"status": "unauthorized"})
    }
}
```

the Create handler is called from a POST request. I'm using Postman to test the post calls and it's simply not recognizing it. The response is unauthorized, even when I have "manu" and "123" as my User and Password. 

<img width="1069" alt="screen shot 2015-07-04 at 7 22 53 pm" src="https://cloud.githubusercontent.com/assets/3820846/8509711/2f35eec6-2282-11e5-9dbf-1abecec137fb.png">

I have also tried `c.BindWith(&json, binding.Form)`. Both of them do not work.

I've also tried `c.PostForm("User")` and that doesn't get me `"manu"` it just gives me an empty string. Not exactly sure how to get simple form data without and binding or validation, I just want to get the data.

Which is not likely the desired behavior.

RedirectTrailingSlash setting is meant to cause a redirect, but the code is never called because the setting wasn't being checked. Instead RedirectFixedPath was being checked.

Minor rewrite of some documentation and code, related to issue #252.

I'm sending post request as form-data (shown below) but `c.Bind(&json, binding.Form)` doesn't bind form-data instead it binds URL parameters (localhost:8080?name=XXX&...). 

`c.PostForm` works fine.

`binding.Form` should bind form-data for POST.

---

POST /signup HTTP/1.1
Host: localhost:8080
Cache-Control: no-cache
Postman-Token: a7f408c6-1749-f9c8-0a57-801a2a0448f6
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

----WebKitFormBoundary7MA4YWxkTrZu0gW<br/>Content-Disposition: form-data; name="name"<br/><br/>FormName<br/>----WebKitFormBoundary7MA4YWxkTrZu0gW<br/>Content-Disposition: form-data; name="email"<br/><br/>Form@Mail.com<br/>----WebKitFormBoundary7MA4YWxkTrZu0gW

Just found an interesting issue:

``` go
    r.Static("/assets/", p.rootFolder+"/assets")
    r.GET("/:code", p.redirectHandler)
```

Generates:

> panic: wildcard route ':code' conflicts with existing children in path '/:code'

Seems like it's due to the fact that Static uses *filename wildcard. My plane is due in soon, so can't dig into it now, but I think any static wildcards should be generated below the url path specified, not within root domain.

``` go
As in:
/assets/*filename
instead of 
/*filename
```

Any thoughts?

According to the documentation IsAborted() method should return true if the current context was aborted. 

At the moment it  works only for the Handlers in which Abort() method was triggered. It doesn't work in the previous Handlers after the c.Next() call. It is because c.index will be higher then AbortIndex.

In my applications I would like to be able to determine whether the Context was aborted after the request was processed, without having to populate c.Errors slice.

If you see http://golang.org/pkg/net/http/#Request, the RemoteAddr value is "IP:port". So I remove the port part.

I would like to help in adding the ability for routes to be named in the router and then reconstructed elsewhere in the application. One of the ways I was looking into doing this was to simply add named methods to the router.

``` go
router.NamedGET("show-user", "/users/:id", userShow)
```

The advantage to this would be to not change the return type of the router methods and lose chaining. The named routes could be added to the engine for access through the `context`.

``` go
func userShow(c *gin.Context) {
    url := c.Route("user-show").With(gin.Pair{"id": 44}).URL
    // or
    path := c.Route("user-show").With(gin.Pair{"id": 44}).Path
}
```

Does this seem in the scope of the framework? If so, what changes to the API would be welcomed to accomplish this?

I'lm sure to have comment an issue that says the same. But I have done some tests with my docker-compose stack to be sure. So that's my problem:

```
patachou@patrice-laptop test2 (master)]$ ll
total 16
-rw-rw-r--. 1 patachou patachou  171 28 juin  23:44 docker-compose.yml
drwxrwxr-x. 3 patachou patachou 4096 28 juin  23:41 Godeps
-rw-rw-r--. 1 patachou patachou  201 28 juin  23:41 main.go
-rw-rw-r--. 1 patachou patachou   99 28 juin  23:37 Makefile
[patachou@patrice-laptop test2 (master)]$ cat docker-compose.yml 
test:
    image: golang
    command: make
    volumes:
    - .:/go/src/test2
    working_dir: /go/src/test2
    environment:
        PORT: 3000
    ports:
    - 3000:8080
[patachou@patrice-laptop test2 (master)]$ cat Makefile 
run:
    go get -u -v github.com/codegangsta/gin
    go get -u -v github.com/tools/godep
    gin -g -a 8080
[patachou@patrice-laptop test2 (master)]$ cat main.go 
package main

import (
    "net/http"
)

func TestF(w http.ResponseWriter, r *http.Request) {
    w.Write([]byte("Coucou"))
}

func main() {
    http.HandleFunc("/", TestF)
    http.ListenAndServe(":8080", nil)
}
[patachou@patrice-laptop test2 (master)]$ docker-compose up
Recreating test2_test_1...
Attaching to test2_test_1
test_1 | go get -u -v github.com/codegangsta/gin
test_1 | github.com/codegangsta/gin (download)
test_1 | github.com/codegangsta/cli (download)
test_1 | github.com/codegangsta/envy (download)
test_1 | github.com/codegangsta/cli
test_1 | github.com/codegangsta/envy/lib
test_1 | github.com/codegangsta/gin/lib
test_1 | github.com/codegangsta/gin
test_1 | go get -u -v github.com/tools/godep
test_1 | github.com/tools/godep (download)
test_1 | github.com/kr/fs (download)
test_1 | github.com/pmezard/go-difflib (download)
test_1 | Fetching https://golang.org/x/tools/go/vcs?go-get=1
test_1 | Parsing meta tags from https://golang.org/x/tools/go/vcs?go-get=1 (status code 200)
test_1 | get "golang.org/x/tools/go/vcs": found meta tag main.metaImport{Prefix:"golang.org/x/tools", VCS:"git", RepoRoot:"https://go.googlesource.com/tools"} at https://golang.org/x/tools/go/vcs?go-get=1
test_1 | get "golang.org/x/tools/go/vcs": verifying non-authoritative meta tag
test_1 | Fetching https://golang.org/x/tools?go-get=1
test_1 | Parsing meta tags from https://golang.org/x/tools?go-get=1 (status code 200)
test_1 | golang.org/x/tools (download)
test_1 | github.com/kr/fs
test_1 | github.com/pmezard/go-difflib/difflib
test_1 | golang.org/x/tools/go/vcs
test_1 | github.com/tools/godep
test_1 | gin -g -a 8080
test_1 | [gin] listening on port 0
```

Whatever if I set "-a" option to force port, the problem remains. The litening port is always set to "0".

Other problems appears, as using godep... that was working before and right now I'm unable to use docker-compose to link other services (mongodb for example). 

Any help will be appreciated. Thanks

Hi All,

I received panic on every request. Here the panic log.

2015/06/28 19:32:06 Panic recovery -> runtime error: index out of range
/usr/local/go/src/runtime/panic.go:387 (0x466f18)
        gopanic: reflectcall(unsafe.Pointer(d.fn), deferArgs(d), uint32(d.siz), uint32(d.siz))
/usr/local/go/src/runtime/panic.go:12 (0x4660ae)
        panicindex: panic(indexError)
/root/go/src/gopkg.in/bluesuncorp/validator.v5/validator.go:369 (0x6dbd16)
/root/go/src/gopkg.in/bluesuncorp/validator.v5/validator.go:333 (0x6da7b2)
/root/go/src/gopkg.in/bluesuncorp/validator.v5/validator.go:324 (0x6da600)
/root/go/src/github.com/gin-gonic/gin/binding/default_validator.go:20 (0x6195e7)
        (_defaultValidator).ValidateStruct: if err := v.validate.Struct(obj); err != nil {
/root/go/src/github.com/gin-gonic/gin/binding/binding.go:60 (0x619539)
        validate: return Validator.ValidateStruct(obj)
/root/go/src/github.com/gin-gonic/gin/binding/json.go:24 (0x61ab4e)
        jsonBinding.Bind: return validate(obj)
<autogenerated>:6 (0x61b177)
/root/go/src/github.com/gin-gonic/gin/context.go:244 (0x528fb2)
        (_Context).BindWith: return c.BindWith(obj, binding.JSON)
/root/go/src/github.com/gin-gonic/gin/context.go:235 (0x528e6e)
        (*Context).Bind: // else --> returns an error

c.Writer.Header().Del("Date") or c.Header("Date", "") doesn't seems to have any affect, im using this middleware:

```
func removeDate(c *gin.Context) {
    c.Writer.Header().Del("Date")
    //c.Header("Date", "")
}
```

The reason of those changes is that till methods in the gin.routesInterface returns unexported type there are no ability to implement such interface outside of the gin package.

This PR relates to https://github.com/gin-gonic/gin/pull/348

Hello,

I'm a total newb at react/ go / gin environment.  I modified an index.jsx page and even though i restarted the server , the updates are not showing up?! what gives... 

I'm also running webpack. 

Hi guys,

I'm writing a gin Statsd middleware so I can measure request handlers performance. The idea is to label requests stats just like NewRelic does for other languages. The pattern will be something like: `repo.user.app.module.handlermethod`. I'm facing a problem, though: I couldn't find a good way to get the current request handler.

I know you've recently added the `gin.Engine Routes()` method. I could get its result and perform a pattern matching against the current request `URL.Path`, but: **1)** I would be replicating logic that's already inside gin **2)** It would be a performance waste since gin already did it before calling the middleware.

Looking at gin's code, I've found that this issue would be solved just by exposing the `gin.Context handlers` field. Or, if there are safety concerns about users altering it after  initialization, we could just offer a method that returns a copy of it, like:

``` go
// gin.go
func (c *Context) AllHandlers() HandlersChain {
    handlersCopy := make(HandlersChain, len(c.handlers))
    copy(handlersCopy, c.handlers)
    return handlersCopy
}
```

That way, I could implement the statsd middleware with something like:

``` go
func statFromPath(path string) string {
    return strings.Replace(path, "/", ".", -1)
}

func StatsdMiddleware(engine *gin.Engine) gin.HandlerFunc {

    return func(c *gin.Context) {

        requestHandler := c.AllHandlers().Last()
        fn := runtime.FuncForPC(reflect.ValueOf(requestHandler).Pointer())
        stat := strings.ToLower(statFromPath(fn.Name())))

        statsdUtils.MeasureAndWriteTimingFor(stat, func() {
            c.Next()
        })
    }
}
```

What do you think?

How to generate a log every day

``` go
engine := gin.Default()
engine.GET("/", func(ctx *gin.Context) { ctx.Redirect(http.StatusSeeOther, "/en") })

app := engine.Group("/:locale", middlewares...)
home := app.Group("/", controllers.HomeLayout)

// These works for both "/en" and "/en/":
app.GET("", controllers.HomeLayout, controllers.Home)
app.GET("/", controllers.HomeLayout, controllers.Home)

// These panics: `panic: handlers are already registered for path ''/:locale/'`
home.GET("", controllers.Home)
home.GET("/", controllers.Home)
```

BTW, thanks for all your hard works.

I like working with modules, with [routesInterface](https://github.com/gin-gonic/gin/blob/master/routergroup.go#L14) exported we can construct function that set routes for a give group or directly for the engine

Hello there!
I have a question: How to get multidomain/subdomain (virtualhost) routing?

I tried this,

```
r := gin.Default()
r.GET("example1.com/", func(c *gin.Context) { // http://example1.com
    c.String(200, "welcome to example1.com")
})
r.GET("example2.com/", func(c *gin.Context) { // http://example2.com
    c.String(200, "welcome to example2.com")
})
```

but it didn't work, so I looked features of HttpRouter.
https://github.com/julienschmidt/httprouter#multi-domain--sub-domains

I referred that and tried this.

```
r := gin.Default()
r2 := gin.Default()
...
...
hs := make(HostSwitch)
hs["example1.com"] = r
hs["example2.com"] = r2
http.ListenAndServe(":80", hs)
```

Now, it works like I intended. But I think that this is not good. (Because I am a beginner of Golang.)

Is there a better way to do it?

And I wanna request one more thing.

Please support LoggerWithWriter (logger.go) function to write its host like
"[GIN] example1.com 2015/06/23 (...)"
"[GIN] example2.com 2015/06/23 (...)"
.

Thank you! I started to learn Golang recently and I starred Gin just yesterday, this framework is awesome.

hi,     

``` go
func main() {
    router := gin.Default()
    router.GET("/", func(c *gin.Context) {
       ....
    })
    router.Run(":8080") // data services 

    routerAdmin := gin.Default()
    routerAdmin.GET("/", func(c *gin.Context) {
        .....
    })
    routerAdmin.Run(":8090") // admin and monitor services 
}
```

but , only one port ( 8080 port ) working 

yet, i know there some others solution to split  different URL rout for two propose.
i just want to know single program can service tow port or not.

some one help for this?? 
thanks a lot.

I was succesfully installing gin few weeks ago, now I setup a new project and try to install it again via vendoring, I didnt use any third-party golang dependency manager.

and I got this error when echoing `$ go get github.com/gin-gonic/gin` on my terminal

```
# github.com/gin-gonic/gin
src/github.com/gin-gonic/gin/context.go:369: cannot use sse.Event literal (type sse.Event) as type render.Render in argument to c.Render:
        sse.Event does not implement render.Render (missing Render method)
>>> elapsed time 39s

```

my $GOPATH is `~/Code/golang/webstuff` and $GOROOT reside on `~/bin/go`

thank you for your awesome stuff, really love it! :)

This is more of a feature request/exploration, but I'm wondering if Gin could be made even faster by using [`ffjson`](https://journal.paul.querna.org/articles/2014/03/31/ffjson-faster-json-in-go/). Apparently it's 2-3x faster than `encoding/json` because it doesn't use reflection. Repo: https://github.com/pquerna/ffjson


every time I want to return the error, i must write the following code

``` go
if err != nil {
    c.AbortWithError(code, err)
    return
}
```

it's ugly with so many `return`

I think using the panic maybe the best practice. Like Java's `throw Exception`

``` go
if err != nil {
    panic(err) // maybe err is ErrUserNotFound
}
```

err is defined as 

``` go
type HTTPError interface {
    HTTPStatus() int
}
```

using the catchError middleware to catch the error and abort with the `HTTPStatus`

``` go
func catchError() gin.HandlerFunc {
    return func(c *gin.Context) {
        defer func() {
            if err := recover(); err != nil {
                switch err.(type) {
                case HTTPError:
                    e := err.(*errors.Error)
                    c.JSON(e.HTTPStatus(), e)
                    c.Abort()
                default:
                    c.AbortWithStatus(http.StatusInternalServerError)
                }
            }
        }()
        c.Next()
    }
}
```

lot's of ugly `return` are removed

Right now, if I want to return some JSON I'm (apparently) forced to use the default `application/json; charset=utf-8` content-type, when I need `application/vnd.api+json`. This PR includes modifications and a new unit test to add support.

Previous alternative was using `Data`, having to manually Marshal my struct, etc. Why not build it in? :)

Hey, just a question:

I realized that the code below will never execute `return err` because `c.AbortWithError(400, err).SetType(ErrorTypeBind)` aborts the request, is that correct?

Is that the expected behavior? If so, wouldn't it be better to not return anything instead?

``` go
func (c *Context) BindWith(obj interface{}, b binding.Binding) error {
    if err := b.Bind(c.Request, obj); err != nil {
        c.AbortWithError(400, err).SetType(ErrorTypeBind)
        return err
    }
    return nil
}
```

I'm having problems rendering templates. If all the template files are empty except the base template then there is no issue with the way my templates are currently. The problem is that I can't seem to figure out how to render a template with variables across multiple of the included templates such as in the Base layout and inside a navbar or content area. 

I tried nested structs but have had no luck figuring out how to do this. Can anyone point me in the right direction?

**Base.html**

``` html
{{define "base"}}
<!DOCTYPE html>
<html lang="en">
    <head>
        <title>{{.title}}</title>
    </head>
    <body>
        {{template "navbar"}}
        {{template "content"}}
    </body>
</html>
{{end}}
```

**Index.html**

``` html
{{define "index"}}
{{.stuff}}
{{end}}
```

**What I'm trying to do when rendering the template**

``` go
// Index page template
var index_template = template.Must(template.ParseFiles(
template_dir + "Base.html",
partials_dir + "Navbar.html",
template_dir + "Index.html"))

// Index page handler
r.GET("", func(c *gin.Context) {
    r.SetHTMLTemplate(contact_template)
    c.HTML(200, "base", data)    // How to make data?
})
```

``` go
func Auth(secret string) gin.HandlerFunc {
  return func(c *gin.Context) {
    token, err := jwt.ParseFromRequest(c.Request, func(token *jwt.Token) (interface{}, error) {
      b := ([]byte(secret))
      return b, nil
    })

    if err != nil {
      c.JSON(200, gin.H{"code": 403, "msg": err.Error()})
      return
    }
  }
}
```

how could I get the variable `token` from following router methods?

following discussion in gin-gonic/contrib#49 , i think maybe we should use https://github.com/sebest/xff instead of implementing header parsing? This package looks like it does the job better, filtering private ip addresses and such: https://github.com/sebest/xff/blob/master/xff.go#L11

Now it's possible to declare the routes this way:

``` go
package main

import "github.com/gin-gonic/gin"

func main() {
    router := gin.Default()

    router.
        GET("/", handler).
        StaticFile("favicon.ico", "./resources/favicon.ico").
        GET("/signin", signin).
        POST("/signin", signin_post)

    router.Group("/users/", AuthRequired()).
        GET("/", getUsers).
        GET("/:id", getUserById).
        GET("/:id/pic", getUserPicById).
        PUT("/:id", updateUserById)

    router.Run(":http")
}
```

of course, this API is 100% back-compatible.

I'm using a website's REST API and they require me to send a XML as response! I checked out their documentation, and found out this:

```
<Response>
    <Message src="12023222222" dst="15671234567" type="sms"
            callbackUrl="http://foo.com/sms_status/" callbackMethod="POST">
    Hi, Message from Plivo
    </Message>
</Response>
```

Is there anyway to specify or attach attributes using gin's renderer?
I also found this library: https://github.com/unrolled/render, which claims that they use Martini's renderer. Could this library work with Gin as well?

can you consider this?

```
# github.com/gin-gonic/gin
./auth_test.go:23: undefined: assert.Len
./auth_test.go:24: cannot use authPair literal (type authPair) as type string in argument to assert.Contains
./auth_test.go:27: cannot use pairs (type authPairs) as type string in argument to assert.Contains
./auth_test.go:28: cannot use authPair literal (type authPair) as type string in argument to assert.Contains
./auth_test.go:31: cannot use pairs (type authPairs) as type string in argument to assert.Contains
./auth_test.go:32: cannot use authPair literal (type authPair) as type string in argument to assert.Contains
./auth_test.go:35: cannot use pairs (type authPairs) as type string in argument to assert.Contains
./context_test.go:72: undefined: assert.Len
./context_test.go:75: undefined: assert.Len
./context_test.go:76: undefined: assert.EqualValues
./context_test.go:76: too many errors
FAIL    github.com/gin-gonic/gin [build failed]
```

How to use session.

I was searching a framework to make the code more clean, But for me this added to much overhead
- julienschmidt/httprouter / recovery middleware / mgo

```
~ ❯❯❯ wrk -t 4 -c 16 -d 30s --latency http://127.0.0.1:8080/mails
Running 30s test @ http://127.0.0.1:8080/mails
  4 threads and 16 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   359.23us  183.29us   6.48ms   86.71%
    Req/Sec    11.20k     1.76k   14.48k    76.64%
  Latency Distribution
     50%  307.00us
     75%  375.00us
     90%  581.00us
     99%    1.06ms
  1341064 requests in 30.10s, 327.41MB read
  Non-2xx or 3xx responses: 1341064
Requests/sec:  44552.97
Transfer/sec:     10.88MB
```
- gin / without any middleware

```
Running 30s test @ http://127.0.0.1:8080/mails
  4 threads and 16 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     2.22ms  567.58us   8.39ms   75.66%
    Req/Sec     1.81k   300.50     2.45k    71.08%
  Latency Distribution
     50%    2.11ms
     75%    2.48ms
     90%    2.92ms
     99%    4.14ms
  216235 requests in 30.01s, 310.77MB read
Requests/sec:   7205.48
Transfer/sec:     10.36MB
```
- Command used to start the server: `GOMAXPROCS=8 go run server.go`
1. Why is gin hitting that much the performance
2. there is anything that I can do to fix it or provide more information ? I really want to use gin.

regards.

```
go get github.com/gin-gonic/gin 
# github.com/gin-gonic/gin
github.com/gin-gonic/gin/context.go:367: cannot use sse.Event literal (type sse.Event) as type render.Render in argument to c.Render:
    sse.Event does not implement render.Render (missing Render method)
```

This issue is in response to issue [88](https://github.com/labstack/echo/issues/88) for the micro framework [echo](https://github.com/labstack/echo).

First of all echo is about 8x faster than Gin in that benchmark. Second, Gin went from 69373 ns/op to 412886 ns/op, nearly 6 times slower, what happened?

Since performance is one of the main selling points for Gin I think this is worth discussing. I really like Gin but the reason I started using it was because of the performance, I assume this is the case for many others too.

Here are the relevant numbers

| April 1, 2015 |  |  |  |  |
| --- | --- | --- | --- | --- |
| BenchmarkEcho_GithubAll | 30000 | 42728 ns/op | 0 B/op | 0 allocs/op |
| BenchmarkGin_GithubAll | 20000 | 69373 ns/op | 13792 B/op | 167 allocs/op |

| June 3, 2015 |  |  |  |  |
| --- | --- | --- | --- | --- |
| BenchmarkEcho_GithubAll | 30000 | 51470 ns/op | 0 B/op | 0 allocs/op |
| BenchmarkGin_GithubAll | 3000 | 412886 ns/op | 0 B/op | 0 allocs/op |

There is no link on httprouter [1](github.com/julienschmidt/httprouter) in the Godeps file.

``` bash
Godeps/_workspace/src/github.com/gin-gonic/gin/context.go:13:2: cannot find package "github.com/julienschmidt/httprouter" in any of:
```

I cant find any reference to the function or the variable it sets. Can it be removed or is it something that will be used in the future?

https://github.com/gin-gonic/gin/blob/master/mode.go#L55

I tried to separate router and handler but nothing works
# command-line-arguments

./main.go:23: undefined: statsWorker
./main.go:30: undefined: rateLimit
./main.go:33: undefined: index
./main.go:34: undefined: roomGET
./main.go:35: undefined: roomPOST
./main.go:36: undefined: streamRoom

samples return same error

im working on RunTLS() as well but its still WIP

closes #323 

I'm trying to write tests for my controllers (using Gin, a file that groups route handlers), but I'm not being able to mock gin Contexts. Inside the [context_test.go file](https://github.com/gin-gonic/gin/blob/master/context_test.go), there's a method that does exactly that:

``` go
func createTestContext() (c *Context, w *httptest.ResponseRecorder, r *Engine) {
    w = httptest.NewRecorder()
    r = New()
    c = r.allocateContext()
    c.reset()
    c.writermem.reset(w)
    return
}
```

But it is not exported. I also cannot replicate it because `allocateContext` and Context's `engine` field are unexported too.

What do you think about creating a test-helpers module and exporting `createTestContext`?

To answer questions like #321 

I have 2 template files with the same name. But they are in different folders, e.g. `views/post/index.tmpl` and `views/user/index.tmpl`. (It's common in Rails.) But currently the folder name is not allowed in `context.HTML()`.

```
func main() {
    router := gin.Default()
    router.LoadHTMLGlob("views/post/index.tmpl")
    router.LoadHTMLGlob("views/user/index.tmpl")
    router.GET("/", func(context *gin.Context) {
        context.HTML(http.StatusOK, "post/index.tmpl", gin.H{ "title": "Main website" })
        //                           ^[ERROR] html/template: "post/index.tmpl" is undefined.
        //                           "views/post/index.tmpl" does not work either.
    })
    router.Run(":8080") // listen and serve on 0.0.0.0:8080
}
```

`context.HTML(http.StatusOK, "index.tmpl", gin.H{ "title": "Main website" })` works, but it actually uses `views/user/index.tmpl`, because `router.LoadHTMLGlob("views/user/index.tmpl")` is called after `router.LoadHTMLGlob("views/post/index.tmpl")`.

If gin does not support template files with same name in different folders, we have to make sure each template file name is unique, like post_index.tmpl, user_index.tmpl. It's not convenient.

Update:
Similar issue: #241 (Closed)

Hi,

I'm wondering if using `gin.Context.Engine.setHTMLTemplate` in each handler is the correct/safe way to set up templates? (_nb_: templates that are trying to reuse layout elements and thus using `define` cannot override the `define` blocks so for each handler one needs to load only the specific templates).

This causes a compile bug preventing godeps :(,  go version <1.4 I think (1.3.3)



- With issues:
 json: cannot unmarshal string into Go struct field Channel.extend_data of type map[string]string

## 
![image](https://user-images.githubusercontent.com/21244175/63206479-adf4f100-c0e7-11e9-9be1-785e350c0795.png)



Hi, I'm Yevgeny Founder of [Fuzzit](https://fuzzit.dev) - Continuous fuzzing as a service platform.

We have a free plan for OSS and I would be happy to contribute a PR if that's interesting.
The PR will include the following
- [go-fuzz](https://github.com/dvyukov/go-fuzz) fuzzers
- Continuous Fuzzing of master branch which will generate new corpus and look for new crashes
- Regression on every PR that will run the fuzzers through all the generated corpus and fixed crashes from previous step. This will prevent new or old bugs from crippling into master.

You can see our basic example [here](https://github.com/fuzzitdev/example-go) and you can see an example of "in the wild" integration [here](https://github.com/google/syzkaller).

Let me know if this is something worth working on.

Also, we have a [reward](https://fuzzit.dev/2019/08/12/announcing-rewards-for-go-rust-oss-projects/) program. If you are interested in implementing the fuzzers and the integration yourself I’ll be happy to reward you as well as to get unbiased feedback on how smooth the integration was.

Cheers,
Yevgeny

Signed-off-by: CarlosEDP <me@carlosedp.com>

Updating projects using libraries that were recently updated to support Risc-V architecture.

Go upstream work is tracked on: golang/go#27532

Risc-V software support tracker on https://github.com/carlosedp/riscv-bringup

Add a gracefull method to add error to context#Error #2017 


- go version:
1.12.6
- gin version (or commit ref):
1.4.0
- operating system:
Mac osx
## Description
We are use golangci as our lint tool, [errchek](https://github.com/kisielk/errcheck) is one of the basic rule. We use c.Error to append errors happened in the controller and there is no need to handle return value of c.Error. Every time we use c.Error, we need add a comment to disable lint for that line.

```go
router.GET("/:name", func(c *gin.Context) {
                // do sth
		c.Error(err)  // nolint: errcheck
})
```

What's more, we do not want our application panic when err is nil.



To everyone who's new here:

If you use RESTful-Style API, router of gin will be  a TROUBLEMAKER!

#205
#1681 
#136
#2005 

The root of the problem is [httprouter](https://github.com/julienschmidt/httprouter)
```bash
env GOPATH=`pwd` go run form1.go
```
* form1.go
```golang
package main

import (
	"fmt"
	"github.com/gin-gonic/gin"
)

type testForm struct {
	Mode   string `form:"mode"`
	Text   string `form:"text"`
	Voice  []byte `form:"voice"`
	Voice2 []byte `form:"voice2"`
}

func main() {
	router := gin.Default()
	router.POST("/test.form", func(c *gin.Context) {

		t2 := testForm{}
		if err := c.ShouldBind(&t2); err != nil {
			fmt.Printf("err = %s:%v\n", err, t2)
			c.JSON(500, gin.H{"err": err.Error()})
			return
		}
		c.JSON(200, t2)
	})

	router.Run()
}

//client
/*
curl -F mode=A -F text="test" -F voice=@form1.go -F voice2="voice" 127.0.0.1:8080/test.form|jq
{
  "Mode": "A",
  "Text": "test",
  "Voice": "cGFja2FnZSBtYWluCgppbXBvcnQgKAoJImZtdCIKCSJnaXRodWIuY29tL2dpbi1nb25pYy9naW4iCikKCnR5cGUgdGVzdEZvcm0gc3RydWN0IHsKCU1vZGUgICBzdHJpbmcgYGZvcm06Im1vZGUiYAoJVGV4dCAgIHN0cmluZyBgZm9ybToidGV4dCJgCglWb2ljZSAgW11ieXRlIGBmb3JtOiJ2b2ljZSJgCglWb2ljZTIgW11ieXRlIGBmb3JtOiJ2b2ljZTIiYAp9CgpmdW5jIG1haW4oKSB7Cglyb3V0ZXIgOj0gZ2luLkRlZmF1bHQoKQoJcm91dGVyLlBPU1QoIi90ZXN0LmZvcm0iLCBmdW5jKGMgKmdpbi5Db250ZXh0KSB7CgoJCXQyIDo9IHRlc3RGb3Jte30KCQlpZiBlcnIgOj0gYy5TaG91bGRCaW5kKCZ0Mik7IGVyciAhPSBuaWwgewoJCQlmbXQuUHJpbnRmKCJlcnIgPSAlczoldlxuIiwgZXJyLCB0MikKCQkJYy5KU09OKDUwMCwgZ2luLkh7ImVyciI6IGVyci5FcnJvcigpfSkKCQkJcmV0dXJuCgkJfQoJCWMuSlNPTigyMDAsIHQyKQoJfSkKCglyb3V0ZXIuUnVuKCkKfQo=",
  "Voice2": "dm9pY2U="
}
*/

```


- Fixed : Adjust the correct test case, the source code is to `pinic`,  but test case is not correctly captured
- Add : Add the test case of code 201

Every other context method uses `c.Writer`, so why does `c.Status()` uses `writermem.Writer`?
Made it more clear for Mac users using Go version 1.8 and greater.

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


Please take a look at the following code
```go
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	r := gin.New()

	r.GET("/ping", func(c *gin.Context) { c.JSON(200, gin.H{}) })

	r.Use(gin.Logger())

	r.GET("/pingx", func(c *gin.Context) { c.JSON(200, gin.H{}) })

	r.Run()
}
```

And now please take a look at [the documentation for Use()](https://godoc.org/github.com/gin-gonic/gin#Engine.Use) (emphasis mine):

> Use attaches a **global** middleware to the router. ie. the middleware attached though Use() will be included in the handlers chain for **every single request**

Who in the world would have guessed that the middlewares are only called with the routes that where declared **after** them, not before?

Steps to reproduce:
1. `go run main.go` with main.go being the code above
2. `curl localhost:8080/pingx` and watch as the logger logs requests on stdout
3. `curl localhost:8080/ping` and watch as nothing is logged anywhere.

To me this is a bug but I have a feeling that this is intended behavior...

If it is intended, I would suggest to update the documentation, but this is not enough.
I would also change the README because this behavior is documented nowhere.
Also I suggest renaming `.Use` to `.UseFromNowOn` or to have both calls available.

This bug prevents from using middlewares with OpenAPI `go-gin-server` generator . OpenAPI generator is a tool that writes API routes (among others). By nature, a lot of users will add the CORS middleware, and will:
1. Encounter the bug
2. Add code in an auto-generated file as a work-around

Also, this thread shows users struggling with the bug. It has been around for years
https://github.com/gin-contrib/cors/issues/29

Thank you for your understanding

- go version: go1.12.7
- gin version (or commit ref): v1.4.0-dev
- operating system: linux/amd64

Note. For some people, it might look intuitive in the code above that `Use` means `UseFromNowOn`. But I happened to work on this, where `NewRouter` is generated code. It is way less explicit.
```
	router := routers.NewRouter()
	router.Use(cors.Default())
	log.Fatal(router.Run(":8000"))
```
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: 1.12
- gin version (or commit ref): v1.4.0
- operating system: MacOS

## Description

I want parse unix timestamp to `time.Time` automatically  by  `ctx.ShouldBind(&input)`. But, it seemly doesn't work.

## Screenshots

<img width="981" alt="WX20190807-151556@2x" src="https://user-images.githubusercontent.com/10297148/62602413-48a24280-b926-11e9-8c5e-f1a2dab65062.png">

<img width="1096" alt="WX20190807-151652@2x" src="https://user-images.githubusercontent.com/10297148/62602470-67083e00-b926-11e9-9f70-510c60627b1d.png">



Go get default pull tag instead of master branch
According to [wiki](https://en.wikipedia.org/wiki/JSONP), JSONP must have a semicolon at the end of javascript expression.
``` javascript
callback_func({"foo": "bar", "baz": 42}); <-
```
- Add `.idea` directory to `.gitignore`.
    - This helps those who use the GoLand IDE, which stores its temporary files in `.idea` folder.


- go version:
$ go version
go version go1.12.7 darwin/amd64
- gin version (or commit ref):
v1.4.0
- operating system:

## Description
`panic: ':name' in new path '/reservations/:name/inspect' conflicts with existing wildcard ':id' in existing prefix '/reservations/:id'`

## Screenshots
routers like below will panic
![image](https://user-images.githubusercontent.com/21213088/62099829-e6ac6200-b2c1-11e9-854b-dc3ff189b01c.png)

but this is ok
![image](https://user-images.githubusercontent.com/21213088/62099915-460a7200-b2c2-11e9-8efe-d793cc29c872.png)

I wonder the reason.

Thanks.
- Use buf.String instead of converison
- Remove redundant return
- With issues:
  - SomeTimes,Context.JSON Cost More Than Ten Minutes

- go version: go1.12.1 darwin/amd64
- gin version : github.com/gin-gonic/gin v1.4.0
- operating system:  Linux  4.15.0-45-generic #48-Ubuntu SMP Tue Jan 29 16:28:13 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux

## Description
In Our Production Environment, Context.JSON Cost 15Minute When Gin Render A Json Which Has 675KB . We Did Not Change Any Code Of The Following Func . Just Upgrade Gin Version From "github.com/gin-gonic/gin v1.3.0"  To "github.com/gin-gonic/gin v1.4.0" . Did Any Changes In Context.JSON ?

## Sample Code
``` golang
import  (
	"github.com/gin-gonic/gin"
	"github.com/quexer/utee"
)

func (p *Hdl) xxxxxHandler(c *gin.Context) {
       pl := utee.NewPerfLog(100, logEntry)
       defer pl.Done()
       // do some query  ...
       pl.Tick("c")
       c.JSON(200, gin.H{
                 "data": page,
                 "now":  utee.Tick(),
       })
      pl.Tick("d")
}
```


- go version: 1.12.7
- gin version: 1.4.0 :
- operating system: linux/amd64

## Description
```golang
type Person struct {
	Birthday time.Time `xml:"birthday" json:"birthday" form:"birthday" time_format:"2006-01-02"`
}

func startPage(c *gin.Context) {
	var person Person
	if err := c.ShouldBind(&person); err != nil {
		c.AbortWithStatusJSON(http.StatusBadRequest, err.Error())
		return
	}
	c.JSON(http.StatusOK, person)
}

func main() {
	r := gin.Default()
	r.GET("/", startPage)
	r.POST("/", startPage)
	r.Run()
}
```
The above code works only when I send GET request. When I send POST it can not validate it.

## Screenshots
![image](https://user-images.githubusercontent.com/23114068/61899401-2f1ff480-af3d-11e9-9f97-8122d9d381f4.png)
![image](https://user-images.githubusercontent.com/23114068/61899423-3a732000-af3d-11e9-9dba-d91a8ea5f1bd.png)

How can I validate time field when I want to use POST request?


I'm trying to use a go package manager for my project. I've tried both dep and go module but the 
ShouldBindHeader method is undefined.
I get the following error:
`context.ShouldBindHeader undefined (type *gin.Context has no field or method ShouldBindHeader)
`

- go version: go1.12.7 linux/amd64
- gin version (or commit ref): v1.4.0
- operating system: Ubuntu 19.04


add `SetServer` to `Engine`to customize `http.Server` under the hood, which makes gin much more extensible and powerful, for example, support the idle timeout:
``` go
r := gin.Default()
s := &http.Server{IdleTimeout: 5*time.Second}
r.SetServer(s)
```
https://github.com/gin-gonic/gin/blob/502c898d755b2156b295ea8bdbbecf9ba374d067/context.go#L525

the request.FormFile will call the FileHeader.Open:
```go
func (fh *FileHeader) Open() (File, error) {
	if b := fh.content; b != nil {
		r := io.NewSectionReader(bytes.NewReader(b), 0, int64(len(b)))
		return sectionReadCloser{r}, nil
	}
	return os.Open(fh.tmpfile) // it is posibble to open a disk file
}
```
## Description

Can i use a gin library to make a post request? For example to www.mydomain.com, like _http.NewRequest()_ or like rest template from spring boot.

Something like 
```
route := gin.Default()
route.NewRequest("POST", "www.mydomain.com", data)
```


Ciao,

I use `*gin.Context.Set()` for share variable between middleware.
how can I use a variable injected by a previous mw in the `LoggerWithFormatter()` mw ?

Tanks in advance
Franco
- go version: go1.12.5 darwin/amd64
- gin version (or commit ref): 1.4.0
- operating system: Mac OS

## Description
I follow this example:  https://github.com/gin-gonic/examples/tree/master/file-binding
and I can get it working to binding a file to my struct. but it can only work if I send the file on the request. And for my case, my file is optional (nullable) so it can be empty sometimes.

If I don't pass the file on request, I get error `http: no such file` on binding file to struct using `ShouldBind` method even I not using binding "required" for the file. How can I bind optional file to my request struct?

My code:
```
// UpdateUserRequest UpdateUserRequest
type UpdateUserRequest struct {
	CV              *multipart.FileHeader `form:"cv" binding:"omitempty"`
}
...
func (ctr *UserController) Update(c *gin.Context) {
    var params UpdateUserRequest
    if err := c.ShouldBind(&params); err != nil {
	c.Error(err)
	return
    }
}
```

If I don't put cv in request, it returned "http: no such file", but it's working just fine if I put cv in request

## Screenshots
![Screen Shot 2019-07-18 at 09 59 39](https://user-images.githubusercontent.com/48425113/61426045-38a8cb80-a943-11e9-9d6d-e0a8e6905f0e.png)


page.tmpl
```html
<html>
  <body>
  {{.a}}
  </body>
<html>
```

router code piece
```go
aEle = `<a>I 'm tagA</a>`
r.GET("/page", func(c *gin.Context) {
  c.HTML(200, "page.tmpl",  gin.H{"a":aEle,}})
})
```


result like this
```html
page
<html>
  <body>
    <a>I'‘m tagA</a>
  </body>
<html>
```

Sorry for bothered you.I check the readme for the answer.no related code.Can you give me a full example code?
I crawl some html code as souce data.and I want to insert these pieces into html  after gin render the code .How can I implement it,anyone help me ？

page.tmpl
```
<html>
  <body>
  {{.body}}
  </body>
<html>
```

router code
```
s = `<body>I 'm body<body>`
r.GET("/page", func(c *gin.Context) {
  c.HTML(200,"page.tmpl", 
			"body":s,
  })
})
```
我的系统中出现了无法避免的路由前缀一致的情况，请问应该如何处理？  
代码片段如下:  
```
pakGroup := router.Group("/pak")
{
	terrainGroup := pakGroup.Group("/terrain")
	{
		terrainGroup.GET("/:layername/layer.json", layerjson)
		terrainGroup.GET("/:layername/:z/:x/:y&f", terrain)
	}
}
```  
错误提示如下:
```
panic: wildcard route ':z' conflicts with existing children in path '/pak/terrain/:layername/:z/:x/:y&f'
```
```
url.GET("/projects/mine", view.GetMyProject)
url.GET("/projects/:id", view.GetProjectById)
```
Why doesn't that work by this way in gin?
In java frameword(spring-mvc), similar code can work fine~

(sorry, I'm not good at English)
- go version:
1.12
- gin version (or commit ref):
1.4
- operating system:
OS X 

## Description
Use Case - a simple crud API with an entity that contains fields that are writable on create only or use a separate set of rules during certain operations. Current workaround - using two structs, but that is a bit clunky. When binding it would be nice to conditionally apply the validation rules. Perhaps introducing a binding group concept or something similar. 

 ```
type Entity struct {
	NoEdit string         `binding:"create:min=1,max=100, edit:-"`
}
... 
ctx.ShouldBind(model, "create") 
```
Here's sample code:
```
func RegisterDemoRoute(r *Engine) {
	v1 := r.Group("api/v1/sys")
	{
		v1.GET("users/:id", service.GetSysUser)
		// conflicts with existing wildcard for "v1.GET("users/:id", service.GetSysUser)"
		v1.GET("users/:id/roles", service.GetSysUserRolePageList)
	}
}
```
"users/:id" and "users/roles" are conflicts,but Java web can do this,What should I do under gin?
In the go, the stack burst will occupy 1G memory, the error message is as follows
```runtime: goroutine stack exceeds 1000000000-byte limit```
If it is a user of gin, the structure of the circular reference is defined on the server side,
and the server memory may be used up as long as 100 go processes, and even the server may be down.

So I suggest that the mapping function should add a limit on the number of calls,
and the number of times can be configured.
Of course, I tried several other modifications when I solved the stackoverflow problem described in #1978,
but it was not compatible with the existing API, so I did not adopt the solution I tried.


- go version: go1.10
- gin version (or commit ref): v1.4.0
- operating system: linux

## Description
`c.Request.FormFile` is ridiculously slow, sometimes takes 26s for uploaded image(~600k)

## Screenshots

Here's the related log:

`Upload api took 26.27741246s size 637445 FormFile took 26.067774073s`

Here's the code snippet that generates the `FormFile took` part:

```golang
	start := time.Now()
	file, header, err := c.Request.FormFile("stuff")
	start2 := time.Now()
	log := "FormFile took " + start2.Sub(start).String()
```

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:go1.12.4
- gin version (or commit ref):v1.4.0
- operating system:windows

## Description
First thanks for the contributors of gin. 
I don't know what is the code block({}) use?
Where is it necessary?
## Screenshots


- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: 1.11.x  & 1.12.x
- gin version (or commit ref):
- operating system: max os

## Description
I want to get the route path which defined in route in the context
just like **/api/v1/user/:id**
but I can only get it now like this 
```go
ctx.Request.URL.Path
/api/v1/user/123
```

## Screenshots
I want to develop middleware to expose metrics, but only I can only get the path with parameters

![avatar](https://oss.kyle.link/images/2019/gin_metrics_v1.png)



Here's sample code:

```
package main

import (
	"net/http"

	"github.com/gin-gonic/gin"
)

//CORSMiddleware ...
func CORSMiddleware() gin.HandlerFunc {
	return func(c *gin.Context) {
		c.Writer.Header().Set("Access-Control-Allow-Origin", "http://localhost")
		c.Writer.Header().Set("Access-Control-Max-Age", "86400")
		c.Writer.Header().Set("Access-Control-Allow-Methods", "POST, GET, OPTIONS, PUT, DELETE, UPDATE")
		c.Writer.Header().Set("Access-Control-Allow-Headers", "X-Requested-With, Content-Type, Origin, Authorization, Accept, Client-Security-Token, Accept-Encoding, x-access-token")
		c.Writer.Header().Set("Access-Control-Expose-Headers", "Content-Length")
		c.Writer.Header().Set("Access-Control-Allow-Credentials", "true")

		if c.Request.Method == "OPTIONS" {
			c.AbortWithStatus(200)
		} else {
			c.Next()
		}
	}
}

func main() {
	r := gin.Default()
    r.Use(CORSMiddleware())
    g := r.Group("/users")

	g.GET("/", func(context *gin.Context) {
		context.JSON(http.StatusOK, gin.H{"hello": "world"})
	})

	r.Run(":8081")
}
```

Here's normal response with CORS headers.

```
curl -v localhost:8081/users/                                                       <aws:loop-staging>
*   Trying ::1:8081...
* TCP_NODELAY set
* Connected to localhost (::1) port 8081 (#0)
> GET /users/ HTTP/1.1
> Host: localhost:8081
> User-Agent: curl/7.65.1
> Accept: */*
>
* Mark bundle as not supporting multiuse
< HTTP/1.1 200 OK
< Access-Control-Allow-Credentials: true
< Access-Control-Allow-Headers: X-Requested-With, Content-Type, Origin, Authorization, Accept, Client-Security-Token, Accept-Encoding, x-access-token
< Access-Control-Allow-Methods: POST, GET, OPTIONS, PUT, DELETE, UPDATE
< Access-Control-Allow-Origin: http://localhost
< Access-Control-Expose-Headers: Content-Length
< Access-Control-Max-Age: 86400
< Content-Type: application/json; charset=utf-8
< Date: Fri, 12 Jul 2019 06:27:16 GMT
< Content-Length: 18
<
{"hello":"world"}
* Connection #0 to host localhost left intact
```

But my CORS header doesn't apear in the 301 redirect response
```
[14:27] ➜  ~ curl -v localhost:8081/users                                                        <aws:loop-staging>
*   Trying ::1:8081...
* TCP_NODELAY set
* Connected to localhost (::1) port 8081 (#0)
> GET /users HTTP/1.1
> Host: localhost:8081
> User-Agent: curl/7.65.1
> Accept: */*
>
* Mark bundle as not supporting multiuse
< HTTP/1.1 301 Moved Permanently
< Content-Type: text/html; charset=utf-8
< Location: /users/
< Date: Fri, 12 Jul 2019 06:27:19 GMT
< Content-Length: 42
<
<a href="/users/">Moved Permanently</a>.

* Connection #0 to host localhost left intact
```

- go version: go version go1.12.7
- gin version (or commit ref): gin-1.4.0
- operating system: linux/amd64

## Description
I have the following types in my code
```Go
type User struct {
     S SomeObject
     Name string `json:"user_name"`
     Email string `json: "user_email"`
     ...
}
type SomeObject struct {
     UserID int
     Name string `json:"object_name"`
     Type string `json:"object_type"`
     ...
}
```
I am doing
```Go
var u User
err := ctx.Bind(&u)
..
```
But the issue is when POST request body is sent in the form of application/json, in binded User variable Someobject name and type is missing. i.e.
```
{{  } nameOfUser emailOfUser}
```
When POST request body is sent in the form of form-data, it has all the fields. i.e.
```
{{someObjectName someObjectType} userName userEmail}
```

I have searched here and on google but didn't find anything to identify and solve the issue. 

Any help will be appreciated. Thanks.

strings.Builder undefine, go 1.9 lib doesn't contain it. I notice this change for gin is recently merged from byte->strings.Builder in `error.go`,`debug.go`.

For some reason, project can't upgrade from go 1.9 to go1.12, is there a tag of gin supporting go 1.9 or not?

3q~
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:  go1.12.1 windows/amd64
- gin version (or commit ref):   e602d52, Commits on Jul 4, 2019
- operating system: windows 7

## Description
when I accessed api  in vscode debugger,  no response will be received , but It will  receive  while go build.
It will receive response in vscode debugger while I do the test through jmeter  at the same time.
When I build the executable with `go build`, the response was received. In fact, It need to use flutter app to access.
The received response as below:
```json
{"level":"INFO","ts":"2019-07-08 23:17:13.122","line":"gin/context.go:124","msg":"/login","serviceName":"","status":200,"method":"POST","path":"/login","query":"","ip":"192.168.0.106","user-agent":"Dart/2.3 (dart:io)","latency":"8ms"}
```
## Screenshots

You can get an http.Response with ContentLength set to -1 (Chunked encoding), so for DataFromReader to be useful for those we need to support that.

ref:#1979

```golang
package main

import (
        "fmt"
        "github.com/gin-gonic/gin"
        "time"
)

type shareTime struct {
        CreateTime time.Time `form:"createTime" time_format:"unixNano"`
        UnixTime   time.Time `form:"unixTime" time_format:"unix"`
}

func main() {
        r := gin.Default()
        unix := r.Group("/unix")

        testCT := time.Date(2019, 7, 6, 16, 0, 33, 123, time.Local)
        fmt.Printf("%d\n", testCT.UnixNano())

        testUT := time.Date(2019, 7, 6, 16, 0, 33, 0, time.Local)
        fmt.Printf("%d\n", testUT.Unix())

        unix.GET("/nano", func(c *gin.Context) {
                s := shareTime{}

                c.ShouldBindQuery(&s)

                if !testCT.Equal(s.CreateTime) {
                        c.String(500, "want %d got %d", testCT.UnixNano(), s.CreateTime)
                        return
                }

                c.JSON(200, s)
        })

        unix.GET("/sec", func(c *gin.Context) {
                s := shareTime{}

                c.ShouldBindQuery(&s)

                if !testUT.Equal(s.UnixTime) {
                        c.String(500, "want %d got %d", testCT.Unix(), s.UnixTime)
                        return
                }

                c.JSON(200, s)

        })

        r.Run()
}

// client
//
// curl -X GET "127.0.0.1:8080/unix/sec?unixTime=1562400033"
//   {"CreateTime":"0001-01-01T00:00:00Z","UnixTime":"2019-07-06T16:00:33+08:00"}

// curl -X GET "127.0.0.1:8080/unix/nano?createTime=1562400033000000123"
//   {"CreateTime":"2019-07-06T16:00:33.000000123+08:00","UnixTime":"0001-01-01T00:00:00Z"}
I sometimes use createTime (unix time) as the key for data segmentation. A common usage is that Service A is responsible for generating creatTime. Service B routes to the corresponding database table based on createTime in the data.
It is found that gin does not currently support binding of unix time to time.Time type.


Pseudo code is as follows
```golang
package main

import (
        "fmt"
        "github.com/gin-gonic/gin"
        "time"
)

type shareTime struct {
        CreateTime time.Time `form:"createTime" time_format:"unixNano"`
        UnixTime   time.Time `form:"unixTime" time_format:"unix"`
}

func main() {
        r := gin.Default()
        unix := r.Group("/unix")

        testCT := time.Date(2019, 7, 6, 16, 0, 33, 123, time.Local)
        fmt.Printf("%d\n", testCT.UnixNano())

        testUT := time.Date(2019, 7, 6, 16, 0, 33, 0, time.Local)
        fmt.Printf("%d\n", testUT.Unix())

        unix.GET("/nano", func(c *gin.Context) {
                s := shareTime{}

                c.ShouldBindQuery(&s)

                if !testCT.Equal(s.CreateTime) {
                        c.String(500, "want %d got %d", testCT.UnixNano(), s.CreateTime)
                        return
                }

                c.JSON(200, s)
        })

        unix.GET("/sec", func(c *gin.Context) {
                s := shareTime{}

                c.ShouldBindQuery(&s)

                if !testUT.Equal(s.UnixTime) {
                        c.String(500, "want %d got %d", testCT.Unix(), s.UnixTime)
                        return
                }

                c.JSON(200, s)

        })

        r.Run()
}

// client
//
// curl -X GET "127.0.0.1:8080/unix/sec?unixTime=1562400033"
//   {"CreateTime":"0001-01-01T00:00:00Z","UnixTime":"2019-07-06T16:00:33+08:00"}

// curl -X GET "127.0.0.1:8080/unix/nano?createTime=1562400033000000123"
//   {"CreateTime":"2019-07-06T16:00:33.000000123+08:00","UnixTime":"0001-01-01T00:00:00Z"}
```
- go version: 1.12.6
- gin version (or commit ref): v1.4.0-dev
- operating system: win10

## Description
Stupid people do stupid things. In my case I selected <application/javascript> as Content-Type in Postman instead of <application/json> and was wondering why the heck my code doesn't work as expected.... well, reason found. Anyway an error message which is a little more specific than the following one would have been nice.

Note: I only tested javascript vs. json header, the error is repeatable and it seems that the content of the json message is not relevant.

## Relevant code snipped
```
func(c *gin.Context) {
     org := Organization{}
    if err := c.ShouldBind(&org); err == nil { // within c.ShouldBind() the stack overflow happens
	// not relevant
	c.Header("Location", loc.String())
    } else {
        // Never reached in this case
        log.Println(err)
    }
}
```


## Error message
```
runtime: goroutine stack exceeds 1000000000-byte limit
fatal error: stack overflow

runtime stack:
runtime.throw(0xd9f020, 0xe)
	c:/go/src/runtime/panic.go:617 +0x79
runtime.newstack()
	c:/go/src/runtime/stack.go:1041 +0x7b7
runtime.morestack()
	c:/go/src/runtime/asm_amd64.s:429 +0x97

goroutine 20 [running]:
github.com/gin-gonic/gin/binding.tryToSetValue(0xc87660, 0xc00307af30, 0x198, 0xc53b26, 0x2, 0x0, 0x0, 0xe7a280, 0xc87660, 0xc53b2a, ...)
	D:/gopath/src/github.com/gin-gonic/gin/binding/form_mapping.go:108 +0x6cc fp=0xc020801458 sp=0xc020801450 pc=0xa5463c
github.com/gin-gonic/gin/binding.mapping(0xc87660, 0xc00307af30, 0x198, 0xc53b26, 0x2, 0x0, 0x0, 0xe7a280, 0xc87660, 0xc53b2a, ...)
	D:/gopath/src/github.com/gin-gonic/gin/binding/form_mapping.go:74 +0x4d1 fp=0xc0208016b0 sp=0xc020801458 pc=0xa53a81
github.com/gin-gonic/gin/binding.mapping(0xcfc580, 0xc00307af30, 0x199, 0xc14a7d, 0x7, 0x0, 0x0, 0xe7a280, 0xcbf9c0, 0x0, ...)
	D:/gopath/src/github.com/gin-gonic/gin/binding/form_mapping.go:92 +0x85b fp=0xc020801908 sp=0xc0208016b0 pc=0xa53e0b
github.com/gin-gonic/gin/binding.mapping(0xcbf9c0, 0xc003076960, 0x196, 0xc14a7d, 0x7, 0x0, 0x0, 0xe7a280, 0xcbf9c0, 0x0, ...)
	D:/gopath/src/github.com/gin-gonic/gin/binding/form_mapping.go:63 +0x2a6 fp=0xc020801b60 sp=0xc020801908 pc=0xa53856
github.com/gin-gonic/gin/binding.mapping(0xd45ba0, 0xc003076960, 0x199, 0xca94d5, 0xa, 0x0, 0x0, 0xe7a280, 0xcbfae0, 0xca94e1, ...)
	D:/gopath/src/github.com/gin-gonic/gin/binding/form_mapping.go:92 +0x85b fp=0xc020801db8 sp=0xc020801b60 pc=0xa53e0b
github.com/gin-gonic/gin/binding.mapping(0xcbfae0, 0xc00306f3a8, 0x196, 0xca94d5, 0xa, 0x0, 0x0, 0xe7a280, 0xcbfae0, 0xca94e1, ...)
	D:/gopath/src/github.com/gin-gonic/gin/binding/form_mapping.go:63 +0x2a6 fp=0xc020802010 sp=0xc020801db8 pc=0xa53856
github.com/gin-gonic/gin/binding.mapping(0xd363a0, 0xc00306f380, 0x199, 0xc89710, 0x8, 0x0, 0x0, 0xe7a280, 0xcbfde0, 0xc8971a, ...)
	D:/gopath/src/github.com/gin-gonic/gin/binding/form_mapping.go:92 +0x85b fp=0xc020802268 sp=0xc020802010 pc=0xa53e0b
github.com/gin-gonic/gin/binding.mapping(0xcbfde0, 0xc003076958, 0x196, 0xc89710, 0x8, 0x0, 0x0, 0xe7a280, 0xcbfde0, 0xc8971a, ...)
........
...additional frames elided...
created by net/http.(*Server).Serve
	c:/go/src/net/http/server.go:2884 +0x7be

```

## Edit 2:
Golang structs:
```
type Organization struct {
	// *datatype.DomainResource
	// Identifier []*datatype.Identifier      `json:"identifier,omitempty"`
	// Active bool `json:"active,omitempty" dgraph:"org_identifier,omitempty"`
	// Type       []*datatype.CodeableConcept `json:"type,omitempty"`
	// Name string `json:"name,omitempty"`
	// Alias      []string                    `json:"alias,omitempty"`
	// Telecom    []*datatype.ContactPoint    `json:"telecom,omitempty"`
	// Address    []*datatype.Address         `json:"address,omitempty"`
	PartOf *datatype.Reference `json:"partOf,omitempty"`
	// Contact  []*OrganizationContact `json:"contact,omitempty"`
	Endpoint []*datatype.Reference `json:"endpoint,omitempty"`
}

type Reference struct {
	// *Element
	// Ref        string     `json:"reference,omitempty"`
	// Type       string     `json:"type,omitempty"`
	Identifier *Identifier `json:"identifier,omitempty"`
	// Display    string     `json:"display,omitempty"`
}

type Identifier struct {
	// *Element
	// Use    string           `json:"use,omitempty"`
	// Type   *CodeableConcept `json:"type,omitempty"`
	// System string           `json:"system,omitempty"`
	// Value  string           `json:"value,omitempty"`
	// Period *Period          `json:"period,omitempty"`
	Assigner *Reference `json:"assigner,omitempty"`
}
```
Necessary request to trigger the stack overflow: Any, even an empty request body is enough.

I would like to propose change `msgpack` codec from `ugorji` to `vmihailenco`. Since the `vmihailcenco` has better performance.

Please upgrade gopkg.in/go-playground/validator.v8 to v9 to support multiple languages.
- With issues:
  -  http: panic serving [::1]:59934: write tcp [::1]:8888->[::1]:59934: write: broken pipe

- go version: 1.12.6
- gin version (or commit ref): 1.4
- operating system: mac

## Description
 http: panic serving [::1]:59934: write tcp [::1]:8888->[::1]:59934: write: broken pipe

## Screenshots
![1111](https://user-images.githubusercontent.com/43042929/60646520-22dcd600-9e6e-11e9-8c8b-83295bd2b9d7.jpg)


- go version: 1.12
- gin version (or commit ref): v1.4
- operating system: any

## Description

Currently any operation that reads from Request.Body will cause it to be deleted e.g. context.Bind()
This means that code that wants to be friendly needs to set the Body back to ioutil.NopCloser. And if anyone forgets to set it back, others will not be able to use it.

## Proposal

Add a function: context.GetRequestBody()
There are 3 ways to do it:
1. Use ioutil.NopCloser
2. Use io.TeeReader
3. Save a copy of the []byte and return it
- go version: 1.12
- gin version (or commit ref): v1.4
- operating system: Linux & Windows

## Description
ShouldBindBodyWith will panic if the request doesn't contain a body
I recommend adding a simple check: `c.Request.Body != nil`



When starting a fresh project each time, we need to create folders, configure many things. But it would be better to scaffold a boilerplate from a common standard boilerplate, like "vue webpack" or "create-react-app" cli tools.

Please consider this. We love Gin



Refactor redirecting request in `gin.go` since its use the same `Context`


ref: #1673 
Hi, I'm thinking of removing some checking repetitions.
Although it's slightly less readable, it should perform faster as there are less comparisons for some cases.
For example, you don't have to repeatedly check if `p[r]` is `'.'` when the next byte is not the last.
I have written a module about oauth2 login. When I got user's information,I added sessions with it,then use c.Redirect to redirect another url, which is belongs to different domain.The problem is : After redirection,I cann't get sessions( session.Get("name") returned nil ).Here is sample code:
`func sample(c *gin.Context) {
    session := sessions.Default(c)
    session.Set("name", "joy")
    session.Save()
    c.Redirect(http.StatusMovedPermanently, "/anotherurl")
}`
Also, I used "github.com/gin-contrib/session"
Thanks!!!
typo fix



Go version：1.12.5
Govendor version：v1.0.9

When I started, I reported the following error：
# go_web/vendor/github.com/gin-gonic/gin
vendor/github.com/gin-gonic/gin/context.go:35:26: undefined: binding.MIMEYAML
vendor/github.com/gin-gonic/gin/context.go:583:29: undefined: binding.YAML
vendor/github.com/gin-gonic/gin/context.go:588:29: undefined: binding.Header
vendor/github.com/gin-gonic/gin/context.go:642:31: undefined: binding.YAML
vendor/github.com/gin-gonic/gin/context.go:647:31: undefined: binding.Header
vendor/github.com/gin-gonic/gin/context.go:656:9: undefined: binding.Uri
vendor/github.com/gin-gonic/gin/context.go:873:17: undefined: render.PureJSON
vendor/github.com/gin-gonic/gin/context.go:889:17: undefined: render.ProtoBuf

When I switched to version @v1.3.0, it started normally.

Is this the latest version of the bug?


* fix README.md code bug
``` go
func main() {
        r := gin.Default()

        // r.GET("/JSONP?callback=x", func(c *gin.Context) { // old
        r.GET("/JSONP", func(c *gin.Context) {    // new
                data := gin.H{
                        "foo": "bar",
                }

                //callback is x
                // Will output  :   x({\"foo\":\"bar\"})
                c.JSONP(http.StatusOK, data)
        })

        // Listen and serve on 0.0.0.0:8080
        r.Run(":8080")
}

// client
// curl http://127.0.0.1:8080/JSONP?callback=x

// old output
// 404 page not found

// new output
// x({"foo":"bar"})

```
* change map[string]interface{} to gin.H
Most of the sample code in the documentation map[string]interface{} is represented by gin.H.
gin.H is a very important place for me to like gin, can write a lot less code



- go version: go1.12.5 darwin/amd64
- gin version (or commit ref): v1.4.0-dev
- operating system: MacOS 10.14.5

## Description
when we upload a large file，gin framework will call `ioutil.TempFile` to write to disk and flush buffer.
```
// formdata.go  line 85 and line 86

// too big, write to disk and flush buffer
file, err := ioutil.TempFile("", "multipart-")
```

**However, when we call `SaveUploadedFile` to save file, gin calles the `io.Copy` to create a new file.
My question is that why not move the temp file rather than copy the same file.Moving may be better than copying in effect.**


```
func (c *Context) SaveUploadedFile(file *multipart.FileHeader, dst string) error {
	src, err := file.Open() // here, it opens the temp file
	if err != nil {
		return err
	}
	defer src.Close()

	out, err := os.Create(dst) // and here, it create a new file
	if err != nil {
		return err
	}
	defer out.Close()

	_, err = io.Copy(out, src) // copy file from tempfile to targe file
	return err
}
```


the condition in readme is wrong, use time.After is ok ;)

situation: first install gin. when `go get github.com/gin-gonic/gin` done, it comes out
```
# github.com/gin-gonic/gin
gin-gonic\gin\context.go:35:26: undefined: binding.MIMEYAML
gin-gonic\gin\context.go:583:29: undefined: binding.YAML
gin-gonic\gin\context.go:637:31: undefined: binding.YAML
gin-gonic\gin\context.go:646:9: undefined: binding.Uri
gin-gonic\gin\context.go:660:58: undefined: binding.BindingBody
gin-gonic\gin\context.go:845:17: undefined: render.JsonpJSON
gin-gonic\gin\context.go:857:17: undefined: render.AsciiJSON
gin-gonic\gin\context.go:863:17: undefined: render.PureJSON
gin-gonic\gin\context.go:879:17: undefined: render.ProtoBuf
gin-gonic\gin\context.go:906:17: undefined: render.Reader
gin-gonic\gin\context.go:906:17: too many errors

```
How to solve it? Anybody know?

envirment:
Go version: 1.12.6

```
set GOARCH=amd64
set GOBIN=
set GOCACHE=C:\Users\ASUS\AppData\Local\go-build
set GOEXE=.exe
set GOFLAGS=
set GOHOSTARCH=amd64
set GOHOSTOS=windows
set GOOS=windows
set GOPATH=D:\CodeSpace\Go
set GOPROXY=
set GORACE=
set GOROOT=C:\Go
set GOTMPDIR=
set GOTOOLDIR=C:\Go\pkg\tool\windows_amd64
set GCCGO=gccgo
set CC=gcc
set CXX=g++
set CGO_ENABLED=1
set GOMOD=
set CGO_CFLAGS=-g -O2
set CGO_CPPFLAGS=
set CGO_CXXFLAGS=-g -O2
set CGO_FFLAGS=-g -O2
set CGO_LDFLAGS=-g -O2
set PKG_CONFIG=pkg-config
set GOGCCFLAGS=-m64 -mthreads -fmessage-length=0 -fdebug-prefix-map=C:\Users\ASUS\AppData\Local\Temp\go-build340568606=/tmp/go-build -gno-record-gcc-switches
```
Why gin-gonic does not listen when I request the web service from other machines?

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:
- gin version (or commit ref):
- operating system:

## Description

## Screenshots


update #1956
```go
package main

import (
	"fmt"
	"github.com/gin-gonic/gin"
)

type testHeader struct {
	Rate   int    `header:"Rate"`
	Domain string `header:"Domain"`
}

func main() {
	r := gin.Default()
	r.GET("/", func(c *gin.Context) {
		h := testHeader{}

		if err := c.ShouldBindHeader(&h); err != nil {
			c.JSON(200, err)
		}

		fmt.Printf("%#v\n", h)
		c.JSON(200, gin.H{"Rate": h.Rate, "Domain": h.Domain})
	})

	r.Run()

// client
// curl -H "rate:300" -H "domain:music" 127.0.0.1:8080/
// output
// {"Domain":"music","Rate":300}
}
```


When I refactored some services, I found that gin does not have a function that binds the http header. I think it would be very good if I had this function.
```go
package main

import (
	"fmt"
	"github.com/gin-gonic/gin"
)

type testHeader struct {
	Rate   int    `header:"Rate"`
	Domain string `header:"Domain"`
}

func main() {
	r := gin.Default()
	r.GET("/", func(c *gin.Context) {
		h := testHeader{}

		if err := c.ShouldBindHeader(&h); err != nil {
			c.JSON(200, err)
		}

		fmt.Printf("%#v\n", h)
		c.JSON(200, gin.H{"Rate": h.Rate, "Domain": h.Domain})
	})

	r.Run()
}

```
I have two handlers, like:  
router.POST("/a", handlerA)
router.POST("/b",handlerB)
when I call context.FullPath()  in handlerA, I got "/b",  
 I don't know what is wrong.


Hi everyone!

I'm curious to know which companies are using gin-gonic/gin in production already. Any particular pros/cons that you noticed on your way to production...

If you use it in any of your products, please let me know. I would like to include a list of such companies in README.md, it can be inspiring for others to see which companies are already using gin-gonic/gin and it can help them get comfortable knowing about success from the others.

CC'ing a few of the contributors: @manucorporat @thinkerou @javierprovecho @appleboy @easonlin404 @vkd @pinscript @sairoutine @msoedov @jbampton @mopemope @se77en @kmulvey @dmarkham @chainhelen 
- go version:
go1.12.6 

- gin version (or commit ref):
1.4.0 

- operating system:
Mac + Linux 

## Description
Trying to use PureJSON as described in the example works fine, but when using it in my app to format a database (sqlx + sqlite) response, it will always use the default JSON behaviour of escaping the e.g. "<" in HTML as \u003c.

Working as expected: 
```golang
		c.PureJSON(200, gin.H{
			"html": "<b>Hello, world!</b>",
		})
```

Not working: 
```golang
		data := struct {
			Thing model.Thing
		}{
			thing,
		}
		c.PureJSON(200, data)
```

Where thing is the scanned result of a sqlx db.Get
Usually

```go
func main() {
	r := gin.Default()

	r.GET("/id", func(c *gin.Context) {
		
		var people People
		
		err := c.ShouldBindJSON(&people)
		
		if err != nil {
			// handle err
		}
		
		// do something with sql
		// handle err(empty error, sql error etc)
		
		if err != nil {
			// handle err
		}
		if err != nil {
			// handle err
		}
		
	})
}
```

the way to handle error
```go
c.JSON(error code, gin.H{
	"msg": "some error msg",
	"code": "code",
})
return
```

this way can't reuse, I try `Abort` func to handle but failed, and a bad solution is to use `panic` and `recovery`, like this
```go
func main() {
	r := gin.Default()
	
	gin.re

	r.GET("/id", func(c *gin.Context) {

		var people People

		err := c.ShouldBindJSON(&people)

		c.Abort()

		CheckError(err)

		// do something with sql
		// handle err(empty error, sql error etc)
		CheckError(err)
		CheckError(err)

	})
}

func CheckError(err error)  {
	if err != nil {
		panic(err)
	}
}
```

I wrote a small micro service which has one endpoint of POST, and it does some heavy processing with up to 700ms. And the request can sometime come like 200-300 per second.
So i decided to do a little load testing myself before deploying. 

So if I send 10-50 requests per second from Jmeter the results of response time is as follows:

```
[GIN] 2019/06/14 - 12:54:24 | 200 |  596.883405ms |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:24 | 200 |  706.791715ms |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:24 | 200 |   708.58386ms |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:24 | 200 |  718.216882ms |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:24 | 200 |  724.382184ms |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:24 | 200 |  726.915336ms |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:24 | 200 |  732.617501ms |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:24 | 200 |  737.426436ms |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:24 | 200 |  745.619228ms |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:24 | 200 |  614.107772ms |    x.x.x.x | POST     /some_endpoint
```

which is pretty good considering the heavy task it is doing.

but when i increase the requests to 100 per second:

```
[GIN] 2019/06/14 - 12:54:43 | 200 |  3.720666857s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:43 | 200 |   4.53009285s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:43 | 200 |  4.636402849s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:43 | 200 |  4.220744816s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:43 | 200 |  4.700783464s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:43 | 200 |  4.148736047s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:44 | 200 |  4.560322385s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:44 | 200 |  5.524665406s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:44 | 200 |  5.760167434s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:44 | 200 |  5.164099035s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:44 | 200 |  5.821459766s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:44 | 200 |  5.378766779s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:44 | 200 |  5.379913123s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:44 | 200 |   5.27440942s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:44 | 200 |  5.286473497s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:44 | 200 |  6.190754261s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.012806615s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  5.546387432s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  5.890838201s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.279754742s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |   6.23320441s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.143513862s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.245203976s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.264817503s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.635084514s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.668145771s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |   6.11572772s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.520977644s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.826556114s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.523218641s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.956265914s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.564888082s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.975812248s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.992262041s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.495344259s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.853816346s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  7.076837063s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.342876822s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.280174671s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.550710945s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  6.259411406s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:45 | 200 |  5.872384686s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.297085956s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.237343373s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |   6.22632221s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.233601278s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.178963721s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.037663604s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.760727568s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.056657071s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.387310578s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.945743239s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.523806543s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.760536534s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.966463859s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.795343801s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.906189924s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.092132951s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.996405825s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.503310721s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.680541079s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.797036794s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.961568874s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |   6.97044507s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.860963311s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.914752105s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.439364375s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.020897633s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.418147512s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.262413587s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |   6.92498344s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.629332632s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |   6.98589984s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.415068005s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.457806415s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |    6.9584195s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.899159736s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.779740519s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.049160944s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.522286329s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.369557602s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.577849168s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.329404404s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.005820581s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.119399153s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |   7.20955764s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.750868289s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.917019627s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.691816258s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.352828838s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.924251698s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.175689132s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.633726017s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  6.994425093s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.292243925s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.437246025s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.067826245s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.755403455s |    x.x.x.x | POST     /some_endpoint
[GIN] 2019/06/14 - 12:54:46 | 200 |  7.152475643s |    x.x.x.x | POST     /some_endpoint
```
Results:
for all requests it taking on an average of 6-7 seconds even the first few requests.

Expected results: 

At least first few requests to be resolved within second. 

- go version: go1.12.5 linux/amd64
- gin version (or commit ref): 1.4.0-dev
- operating system: Ubuntu 19.04

Testing environment:
```
gin ReleaseMode
Processor: i7-8750H
Ram: 16 GB
```

Is there anything I have to configure to make sure the requests which came first are resolved first.

Server starting method:
```
        outfile, _ = os.Create("logger.txt")
	gin.DefaultWriter = outfile
	gin.SetMode(gin.ReleaseMode)
	router := gin.New()
	router.Use(gin.Recovery())
	router.Use(gin.Logger())
	router.Use(corsMiddleWare())
	router.POST("/some_endpoint", endpointHandler)
	srv := &http.Server{
		Handler:      router,
		Addr:         ":8000",
		WriteTimeout: 20 * time.Second,
		ReadTimeout:  20 * time.Second,
		ErrorLog:     logger,
	}
```

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:
- gin version (or commit ref):
- operating system:

## Description
```
package main

import (
	"github.com/gin-gonic/gin"
	"github.com/gin-gonic/gin/binding"
	"net/http"
)

type Body struct {
	Name string `binding:"required"`
	Age  int
}

func main() {
	engine := gin.Default()
	engine.POST("/test", func(c *gin.Context) {
		b := &Body{} //b is *Body, ShouldBindBodyWith get **Body, Maybe it’s a mistake
		if err := c.ShouldBindBodyWith(&b, binding.JSON); err != nil {
			c.JSON(http.StatusBadRequest, err)
		}
		c.JSON(http.StatusOK, b)
	})

	engine.Run(":80")
	return

}

```
$ curl -XPOST localhost/test -d '{}'
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100    21  100    19  100     2    306     32 --:--:-- --:--:-- --:--:--   338{"Name":"","Age":0}

curl should get an error, but an object.

because of the defaultValidator just validate *Body.
```
func (v *defaultValidator) ValidateStruct(obj interface{}) error {
	value := reflect.ValueOf(obj)
	valueType := value.Kind()
	if valueType == reflect.Ptr {
		valueType = value.Elem().Kind()
	}
	if valueType == reflect.Struct {
		v.lazyinit()
		if err := v.validate.Struct(obj); err != nil {
			return err
		}
	}
	return nil
}
```
## Screenshots


Fix #1878
Add support multi files on bind multipart requests.

Example:
```
type s struct {
	Files []*multipart.FileHeader `form:"files"`
}
```
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:G1.3
- gin version (or commit ref):master
- operating system:mac

## Description
in the binding , the struct defaultValidator，the element is not exist

## Screenshots


achieve #1898  #1866 

#1898 
```go
package main

import (
        "fmt"
        "github.com/gin-gonic/gin"
)

func main() {
        r := gin.Default()
        r.GET("/", func(c *gin.Context) {
                var i int
                var err error

                err = c.DefaultQueryVar("int", &i, -1)
                fmt.Printf("%v, %v\n", i, err)

                var ss []string
                err = c.DefaultQueryVar("slice", &ss, []string{"5", "5", "5"})
                fmt.Printf("%v, %v\n", ss, err)

                var b bool
                err = c.DefaultQueryVar("bool", &b, false)
                fmt.Printf("%v, %v\n", b, err)

                var f float64
                err = c.DefaultQueryVar("f", &f, 3.14)
                fmt.Printf("%v, %v\n", f, err)

        })

        r.Run()
        return
}

// client
// curl -X GET http://127.0.0.1:8080/?bool=true&int=3&slice=1&slice=2&slice=3
```
#1866 
```go
package main

import (
	"fmt"
	"github.com/gin-gonic/gin"
	"time"
)

func main() {
	r := gin.Default()
	r.GET("/:int/:string/:float/:bool/:duration", func(c *gin.Context) {
		var i int
		var err error

		err = c.ParamVar("int", &i)
		fmt.Printf("%v, %v\n", i, err)

		var b bool
		err = c.ParamVar("bool", &b)
		fmt.Printf("%v, %v\n", b, err)

		var f float64
		err = c.ParamVar("float", &f)
		fmt.Printf("%v, %v\n", f, err)

		var s string
		err = c.ParamVar("string", &s)
		fmt.Printf("%v, %v\n", s, err)

		var d time.Duration
		err = c.ParamVar("duration", &d)
		fmt.Printf("%v, %v\n", d, err)
	})

	r.Run()
	return
}

// client
// curl -X GET 127.0.0.1:8080/1/test/3.14/true/1s
```

How to open the callback function after startup?
There is a cache problem with the post request, resulting in the following post parameters becoming the same
`
GOROOT=D:\code\golang #gosetup
GOPATH=D:\code\gopath\go #gosetup
D:\code\golang\bin\go.exe build -o C:\Users\cits\AppData\Local\Temp\___go_build_demo3_go.exe D:/code/gopath/go/src/demo/demo3.go #gosetup
C:\Users\cits\AppData\Local\Temp\___go_build_demo3_go.exe #gosetup
[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.

[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

[GIN-debug] POST   /                         --> main.main.func1 (3 handlers)
[GIN-debug] Listening and serving HTTP on :8080
[1]
[GIN] 2019/06/11 - 14:35:03 | 200 |            0s |       127.0.0.1 | POST     /
[1]
[GIN] 2019/06/11 - 14:35:06 | 200 |            0s |       127.0.0.1 | POST     /
[1]
[GIN] 2019/06/11 - 14:35:09 | 200 |            0s |       127.0.0.1 | POST     /
`
@thinkerou @appleboy @austinheap @javierprovecho 
if  use HandleContext  ,c.index is new index .if use old ,same func  well be run reduplicate

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


Now the ignore tag `form"-"` not allow for the mapping to walk inside that field.
Fix #1942
```
goroutine 2717 [running]:
github.com/gin-gonic/gin/binding.setByForm(0x126a5a0, 0xc00d970380, 0x198, 0x11a8ab4, 0x6, 0x0, 0x0, 0x1683f20, 0x126a5a0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:137 +0x5e6 fp=0xc0228013f0 sp=0xc0228013e8 pc=0x8e6986
github.com/gin-gonic/gin/binding.formSource.TrySet(0xc0021b9380, 0x126a5a0, 0xc00d970380, 0x198, 0x11a8ab4, 0x6, 0x0, 0x0, 0x1683f20, 0x126a5a0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:45 +0xed fp=0xc0228014c8 sp=0xc0228013f0 pc=0x8e574d
github.com/gin-gonic/gin/binding.tryToSetValue(0x126a5a0, 0xc00d970380, 0x198, 0x11a8ab4, 0x6, 0x0, 0x0, 0x1683f20, 0x126a5a0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:134 +0x29d fp=0xc0228015d8 sp=0xc0228014c8 pc=0x8e630d
github.com/gin-gonic/gin/binding.mapping(0x126a5a0, 0xc00d970380, 0x198, 0x11a8ab4, 0x6, 0x0, 0x0, 0x1683f20, 0x126a5a0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:73 +0x396 fp=0xc022801758 sp=0xc0228015d8 pc=0x8e5ce6
github.com/gin-gonic/gin/binding.mapping(0x13e6360, 0xc00d970380, 0x199, 0x11a1833, 0x3, 0x0, 0x0, 0x1683f20, 0x13bca40, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228018d8 sp=0xc022801758 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x13bca40, 0xc00d969610, 0x196, 0x11a1833, 0x3, 0x0, 0x0, 0x1683f20, 0x13bca40, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022801a58 sp=0xc0228018d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d969600, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc022801bd8 sp=0xc022801a58 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d967550, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022801d58 sp=0xc022801bd8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d9674d0, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc022801ed8 sp=0xc022801d58 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d9695e0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022802058 sp=0xc022801ed8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d969500, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228021d8 sp=0xc022802058 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d9674c0, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022802358 sp=0xc0228021d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d967440, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228024d8 sp=0xc022802358 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d9694e0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022802658 sp=0xc0228024d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d969400, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228027d8 sp=0xc022802658 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d967430, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022802958 sp=0xc0228027d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d9673b0, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc022802ad8 sp=0xc022802958 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d9693e0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022802c58 sp=0xc022802ad8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d969300, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc022802dd8 sp=0xc022802c58 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d9673a0, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022802f58 sp=0xc022802dd8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d967320, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228030d8 sp=0xc022802f58 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d9692e0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022803258 sp=0xc0228030d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d969200, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228033d8 sp=0xc022803258 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d967310, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022803558 sp=0xc0228033d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d967290, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228036d8 sp=0xc022803558 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d9691e0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022803858 sp=0xc0228036d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d969100, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228039d8 sp=0xc022803858 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d967280, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022803b58 sp=0xc0228039d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d967200, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc022803cd8 sp=0xc022803b58 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d9690e0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022803e58 sp=0xc022803cd8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d969000, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, >>>0x1683f20, 0x141a240, 0x0, ...)
117.132.193.219:35615	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc022803fd8  7B09001036343834363234313131367B15034800C10028382A000000000000005200000000000000000000013D000000000000000001460000013D0F7800000000000001420000000200010001000000270028002A0028002D00000FB2
 sp=0xc022803e58 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d9671f0, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022804158 sp=0xc022803fd8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d967170, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228042d8 sp=0xc022804158 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d968fe0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022804458 sp=0xc0228042d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d968f00, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228045d8 sp=0xc022804458 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d967160, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022804758 sp=0xc0228045d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d9670e0, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228048d8 sp=0xc022804758 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d968ee0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022804a58 sp=0xc0228048d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d968e00, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc022804bd8 sp=0xc022804a58 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d9670d0, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022804d58 sp=0xc022804bd8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d967050, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc022804ed8 sp=0xc022804d58 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d968de0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022805058 sp=0xc022804ed8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d968d00, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228051d8 sp=0xc022805058 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d967040, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022805358 sp=0xc0228051d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d966fc0, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228054d8 sp=0xc022805358 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d968ce0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022805658 sp=0xc0228054d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d968c00, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228057d8 sp=0xc022805658 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d966fb0, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022805958 sp=0xc0228057d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d966f30, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc022805ad8 sp=0xc022805958 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d968be0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022805c58 sp=0xc022805ad8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d968b00, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc022805dd8 sp=0xc022805c58 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d966f20, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022805f58 sp=0xc022805dd8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d966ea0, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228060d8 sp=0xc022805f58 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d968ae0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022806258 sp=0xc0228060d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d968a00, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228063d8 sp=0xc022806258 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d966e90, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022806558 sp=0xc0228063d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d966e10, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228066d8 sp=0xc022806558 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d9689e0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022806858 sp=0xc0228066d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d968900, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228069d8 sp=0xc022806858 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d966e00, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022806b58 sp=0xc0228069d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d966d80, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc022806cd8 sp=0xc022806b58 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d9688e0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022806e58 sp=0xc022806cd8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d968800, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc022806fd8 sp=0xc022806e58 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d966d70, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022807158 sp=0xc022806fd8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d966cf0, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228072d8 sp=0xc022807158 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d9687e0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022807458 sp=0xc0228072d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d968700, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228075d8 sp=0xc022807458 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d966ce0, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022807758 sp=0xc0228075d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d966c60, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228078d8 sp=0xc022807758 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d9686e0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022807a58 sp=0xc0228078d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d968600, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc022807bd8 sp=0xc022807a58 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d966c50, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022807d58 sp=0xc022807bd8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d966bd0, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc022807ed8 sp=0xc022807d58 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d9685e0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022808058 sp=0xc022807ed8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d968500, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228081d8 sp=0xc022808058 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d966bc0, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022808358 sp=0xc0228081d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d966b40, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228084d8 sp=0xc022808358 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d9684e0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022808658 sp=0xc0228084d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d968400, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228087d8 sp=0xc022808658 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d966b30, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022808958 sp=0xc0228087d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d966ab0, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc022808ad8 sp=0xc022808958 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d9683e0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022808c58 sp=0xc022808ad8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d968300, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc022808dd8 sp=0xc022808c58 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d966aa0, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022808f58 sp=0xc022808dd8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d966a20, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228090d8 sp=0xc022808f58 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d9682e0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022809258 sp=0xc0228090d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d968200, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228093d8 sp=0xc022809258 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d966a10, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022809558 sp=0xc0228093d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d966990, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228096d8 sp=0xc022809558 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d9681e0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022809858 sp=0xc0228096d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d968100, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc0228099d8 sp=0xc022809858 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d966980, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022809b58 sp=0xc0228099d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d966900, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc022809cd8 sp=0xc022809b58 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d9680e0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc022809e58 sp=0xc022809cd8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d968000, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc022809fd8 sp=0xc022809e58 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d9668f0, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc02280a158 sp=0xc022809fd8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x1401a20, 0xc00d966870, 0x199, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc02280a2d8 sp=0xc02280a158 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x137f3c0, 0xc00d963fe0, 0x196, 0x11ad11a, 0x8, 0x0, 0x0, 0x1683f20, 0x137f3c0, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc02280a458 sp=0xc02280a2d8 pc=0x8e5a99
github.com/gin-gonic/gin/binding.mapping(0x14242c0, 0xc00d963f00, 0x199, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:89 +0x606 fp=0xc02280a5d8 sp=0xc02280a458 pc=0x8e5f56
github.com/gin-gonic/gin/binding.mapping(0x141a240, 0xc00d966860, 0x196, 0x11aaa4f, 0x7, 0x0, 0x0, 0x1683f20, 0x141a240, 0x0, ...)
	D:/workspace/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/binding/form_mapping.go:63 +0x149 fp=0xc02280a758 sp=0xc02280a5d8 pc=0x8e5a99
...additional frames elided...
created by net/http.(*Server).Serve
	C:/Go/src/net/http/server.go:2884 +0x2fb

```
I want to develop a timeout middleware, but I' found only can do it by fix context.Status()

// Status sets the HTTP response code.
func (c *Context) Status(code int) {
   c.writermem.WriteHeader(code)    ->   c.Writer.WriteHeader(code)
}
                   
[reference]
https://github.com/golang/go/blob/003dbc4cda6a1418fc419461799320521d64f4e5/src/net/http/server.go#L3209

I want to develop a timeout middleware, but I' found only can do it by fix context.Status()
Go1.10's strings.Builder structure saves memory
This is its implementation principle
```go
// String returns the accumulated string.
func (b *Builder) String() string {
    return *(*string)(unsafe.Pointer(&b.buf))
}

```
I want to develop a timeout middleware, but I' found only can do it by fix context.Status()


- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: go version go1.12.5 windows/amd64
- gin version (or commit ref): sorry new to go packages just did 
go get -u github.com/gin-gonic/gin
- operating system: windows 10

## Description

The gin routing does not seem to be able to handle HEAD request with data in them. This is the minimum code needed to reproduce the issue.

app.go
```
package main

import (
    "github.com/gin-gonic/gin"
    "net/http"
    "fmt"
)

func main() {
    router := gin.New()

    router.Any("/", func(c *gin.Context) {
        fmt.Println(c.Request.Method)
        c.Data(http.StatusOK, "text/html; charset=utf-8", 
            []byte("<h1>Hello</h1>"))
    })
    router.Run("0.0.0.0:8080") 
}
```

testHead.py
```
import requests

# Head without data
print(requests.head("http://127.0.0.1:8080/").status_code)

# Head with data
print(requests.head("http://127.0.0.1:8080/", data = "test").status_code) 

# Get with data
print(requests.get("http://127.0.0.1:8080/", data = "test").status_code) 
```

curl testing
```
curl -d '{"key1":"value1", "key2":"value2"}' -H "Content-Type: application/json" -X HEAD http://localhost:8080/
```

The output of testHead.py is 

```
200
400
200
```

While the output of app.go is 

```
[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:   export GIN_MODE=release
 - using code:  gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /                         --> main.main.func1 (1 handlers)
[GIN-debug] POST   /                         --> main.main.func1 (1 handlers)
[GIN-debug] PUT    /                         --> main.main.func1 (1 handlers)
[GIN-debug] PATCH  /                         --> main.main.func1 (1 handlers)
[GIN-debug] HEAD   /                         --> main.main.func1 (1 handlers)
[GIN-debug] OPTIONS /                         --> main.main.func1 (1 handlers)
[GIN-debug] DELETE /                         --> main.main.func1 (1 handlers)
[GIN-debug] CONNECT /                         --> main.main.func1 (1 handlers)
[GIN-debug] TRACE  /                         --> main.main.func1 (1 handlers)
[GIN-debug] Listening and serving HTTP on 0.0.0.0:8080
HEAD
GET
```

Then the curl command to prove it isn't a request python issue gives the same 400 status code without the routing registering the HEAD request. It seems to me that gin is not able to route HEAD request with data in them. While I understand that HEAD request should not usually have data in them the same argument can be applied to GET request. GET request should also not have data in them, but gin is able to route them fine. Also I have worked with other web frameworks and non of them seem to have the same issue with routing HEAD requests with data. Is this intentional? 

If anyone has a workaround or anymore insight on this issue please let me know.
- go version: `go1.12.4 linux/amd64`
- gin version (or commit ref): `v1.3.0`
- operating system: `Ubuntu 18.04 bionic`

## Description

Code
struct
```go
type CreateRequest struct {
	Hash      string `json:"password" binding:"required,min=6,max=20"`
	FirstName string `json:"firstname"`
	LastName  string `json:"lastname"`
	Nickname  string `json:"nickname" binding:"required"` // unique
	Email     string `json:"email" binding:"required"`    // unique
	Sex       int    `json:"sex"`                         // 1 – female; 2 – male.
	BDate     string `json:"bdate"`
	Picture   string `json:"picture"`
	Desc      string `json:"desc"`
	Status    string `json:"status"`
}
```
POST handler
```go
        var r CreateRequest
        if err := c.ShouldBindJSON(&r); err != nil {
		c.JSON(http.StatusBadRequest, ResponseData{
			Status: http.StatusBadRequest,
			Data:   err.Error(),
		})
		return
	}
```

## Screenshots

![](https://i.imgur.com/tlEfqQj.png)
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: go1.12.5
- gin version (or commit ref):
- operating system: windows/amd64

## Description
Compilation fails with the error undefined: http.SameSiteNoneMode
when I set the value of SameSite to  http.SameSiteNoneMode 
```
newCookie := &http.Cookie{
				Name:     MatchCookieName,
				Domain:   GetRootDomain(r),
				MaxAge:   CookieMaxAge,
				Expires:  time.Now().Add(CookieMaxAge),
				Value:    matchCookieAfter.EncodeToBase64(),
				SameSite: http.SameSiteNoneMode,
				Secure:   true,
				Path:     "/",
}
```
Golang right now supports the following values for SameSite Cookie attribute
 http.SameSiteLaxMode, http.SameSiteStrictMode, http.SameSiteDefaultMode. A 4th value SameSiteNoneMode should be added to support Chrome release of version 76 in July 2019.


Here are the updates for fix #1912 


- go version:   go1.12.2
- gin version (or commit ref):
- operating system:  windows/amd64

## Description
A Testing 
run gin server with code
```
func main() {
	gin.SetMode(gin.ReleaseMode)
	r := gin.New()
	r.GET("/ping", func(c *gin.Context) {
		c.JSON(200, gin.H{"message": "ping"})
	})
	r.GET("/wait10s", func(c *gin.Context) {
		time.Sleep(time.Second * 10)
		c.JSON(200, gin.H{"message": " 10s"})
	})
	r.GET("/download", func(c *gin.Context) {
               // a 5.85Mb file
		c.File(`D:\Project\awesomeProject\asset\SyncBaseInfo_1552615252.zip`)
	})
	r.Run() // listen and serve on 0.0.0.0:8080
}
```
and then request to the server with code 
```
// requset.go
func get(url string, d time.Duration) {
	start := time.Now()
	resp, err := http.Get(url)
	if err != nil {
		fmt.Println(err.Error())
	} 
	defer resp.Body.Close()
	_, err = ioutil.ReadAll(resp.Body)
	if err != nil {
		fmt.Println(err.Error())
	}
	d2 := time.Now().Sub(start)
	if d2 > d {
		fmt.Println(url, d2)
	}
}

func main() {
	sysGroup := sync.WaitGroup{}
	for i := 10; i < 50; i++ {
		go func() {
			sysGroup.Add(1)
			get("http://localhost:8080/wait10s", time.Millisecond*1000)
			sysGroup.Done()
		}()
	}

	for i := 0; i < 100; i++ {
		go func() {
			sysGroup.Add(1)
			get("http://localhost:8080/download", time.Millisecond*50)
			sysGroup.Done()
		}()

	}
	time.Sleep(time.Millisecond * 20)
	for i := 0; i < 100; i++ {
		go func() {
			sysGroup.Add(1)
			get("http://localhost:8080/ping", time.Millisecond*1)
			sysGroup.Done()
		}()
	}
	sysGroup.Wait()
}
```
when request.go run at first time,ping request will back before download request,when request.go run again,ping request will back after download .
![image](https://user-images.githubusercontent.com/48953728/59001468-48f86180-8841-11e9-9528-2940e0c49be3.png)
Run server with go http ，the problem does not appear。
```
// run with package http
func IndexHandler(w http.ResponseWriter, r *http.Request) {
	fmt.Fprintln(w, "hello world")
}

func waitHandler(w http.ResponseWriter, r *http.Request) {
	time.Sleep(time.Second * 10)
	fmt.Fprintln(w, "hello world")
}
func DownHandler(writer http.ResponseWriter, request *http.Request) {
	reader, err := os.Open(`D:\Project\awesomeProject\asset\SyncBaseInfo_1552615252.zip`)
	if err != nil || reader == nil {
		writer.Write([]byte("error !!"))
		return
	}
	defer reader.Close()
	http.ServeContent(writer, request, "heeh", time.Now(), reader)

}
func listenSignal() {
	sigs := make(chan os.Signal, 1)
	signal.Notify(sigs, syscall.SIGHUP, syscall.SIGINT, syscall.SIGTERM, syscall.SIGQUIT)
	select {
	case <-sigs:
		fmt.Println("exitapp,sigs:", sigs)
		os.Exit(0)
	}
}
func main() {
	go func() {
		http.HandleFunc("/ping", IndexHandler)

		http.HandleFunc("/download", DownHandler)
		http.HandleFunc("/wait10s", waitHandler)
		http.ListenAndServe("0.0.0.0:8080", nil)
		fmt.Println(222222222222222)
	}()

	listenSignal()
}

```


- go version: Go1.11
- gin version (or commit ref):
- operating system: windows 10 64

## Description
Gin Get 200 OK status, but no data get on the page.
## Screenshots
![i3m5U](https://user-images.githubusercontent.com/30425515/58998952-c5417380-8846-11e9-8d61-34b2671451ef.png)
```bash
$ go run main.go
[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.

[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:   export GIN_MODE=release
 - using code:  gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /api/v1/ping              --> goGin/app/routers/api/v1.Hello (3 handlers)
[GIN-debug] GET    /api/v1/assets            --> goGin/app/routers/api/v1.GetAssets (3 handlers)
2019/06/05 16:05:06 [info] start http server listening :8880
[GIN] 2019/06/05 - 16:05:13 | 200 |    437.8697ms |             ::1 | GET      /api/v1/assets
[GIN] 2019/06/05 - 16:05:13 | 200 |    551.5161ms |             ::1 | GET      /api/v1/assets
[GIN] 2019/06/05 - 16:05:19 | 200 |    202.4586ms |             ::1 | GET      /api/v1/assets
```

The assets data can be used fmt.Println to display and when I try to comment ```assets, err := au.GetAllAssets()``` in routers, it can post hello data and /api/v1/ping works fine.

Routers
```go
package routers

import (
	"github.com/gin-gonic/gin"
	_ "go-gin-example/docs"
	"goGin/app/routers/api/v1"
)

// InitRouter initialize routing information
func InitRouter() *gin.Engine {
	r := gin.Default()

	apiv1 := r.Group("/api/v1")
	//apiv1.Use(jwt.JWT())
	{
		apiv1.GET("/ping", v1.Hello)
		apiv1.GET("/assets", v1.GetAssets)
	}

	return r
}

```
```go
package v1

import (
	"net/http"
	"fmt"
	"github.com/gin-gonic/gin"
	"goGin/app/service/asset_service"
)

func GetAssets(c *gin.Context) {
	au:= asset_service.NewAssetService()
	assets, err := au.GetAllAssets()
	if err != nil {
		c.AbortWithStatus(404)
		fmt.Println(err)
	} else {
		c.JSON(http.StatusOK, gin.H {
			"status": http.StatusOK,
			"data": assets[0],
		})
	}
}

func Hello(c *gin.Context) {
	c.JSON(http.StatusOK, gin.H {
		"status": http.StatusOK,
		"message": "pong",
	})
}
```
Service
```go
package asset_service

import (
	"goGin/app/model"
	"goGin/app/dao/mysqlRepo"
)

type Service interface {
	GetAllAssets() (asset []models.Asset, err error)
	//GetById(id string) (asset *models.Asset)
	//InsertOneAsset(asset *models.Asset) (ass *models.Asset)
}

type assetService struct {
	assetRepo mysqlRepo.Repository
}

func NewAssetService() Service {
	ar := mysqlRepo.NewMysqlAssetRepository()
	return &assetService{assetRepo: ar}
}

func (ar *assetService) GetAllAssets() ([]models.Asset, error) {
	assets, err := ar.assetRepo.GetAllAssets()
	return assets, err
}
```
dao
```go
package mysqlRepo

import (
	"fmt"
	"time"
	"goGin/app/model"
	"github.com/jinzhu/gorm"
)

type Repository interface {
	GetAllAssets() (assets []models.Asset, err error)
	//GetById(id string) (asset *models.Asset)
	//InsertOneAsset(asset *models.Asset) (ass *models.Asset)
}

type MysqlAssetRepository struct {
	conn *gorm.DB
}

// Connect to MySQL
func NewMysqlAssetRepository() Repository {
	return &MysqlAssetRepository{db}
}

// GetAllAssets function gets all assets
func (m *MysqlAssetRepository) GetAllAssets() ([]models.Asset, error) {
	var assets []models.Asset

	query := `SELECT * FROM assets ORDER BY assets.OrganisationID, assets.Name ASC`

	rows, err := m.conn.Raw(query).Rows()
	defer rows.Close()
	models.CheckErr(err)
	if err != nil {
		return nil, err
	}

	for rows.Next() {
		var asset models.Asset
		// ScanRows scan a row into user
		db.ScanRows(rows, &asset)
		assets = append(assets,asset)
	}

	return assets, nil
}

func genAssetGUID() string {
	id := Uniqid("AST_")
	return id
}

func Uniqid(prefix string) string {
	now := time.Now()
	sec := now.Unix()
	usec := now.UnixNano() % 0x100000
	return fmt.Sprintf("%s%08x%05x", prefix, sec, usec)
}
```
model
```go
package mysqlRepo

import (
	"log"
	"github.com/jinzhu/gorm"
	_ "github.com/jinzhu/gorm/dialects/mysql"
	"goGin/library/setting"
)

var (
	db *gorm.DB
	err error
)

func Setup() {
	dbAddress := setting.DatabaseSetting.Host
	dbUser := setting.DatabaseSetting.User
	dbPwd := setting.DatabaseSetting.Password
	dbName := setting.DatabaseSetting.Name
	dbString := dbUser + ":" + dbPwd + "@tcp(" + dbAddress + ")/" + dbName + "?charset=utf8"

	db, err = gorm.Open(setting.DatabaseSetting.Type, dbString)
	if err != nil {
		log.Fatalf("models.Setup err: %v", err)
	}

	db.DB().SetMaxIdleConns(10)
	db.DB().SetMaxOpenConns(100)
}
```
```go
package models

type Asset struct {
	ID      				string			`gorm:"column:ID;primary_key" json:"ID"`
	IMEI					string			`gorm:"column:IMEI;null" json:"IMEI"`
	Name    				string			`gorm:"column:Name;null" json:"Name"`
	Contact 				string			`gorm:"column:Contact;" json:"Contact"`
	Email					string			`gorm:"column:Email;" json:"Email"`
	Latitude 				float64			`gorm:"column:Latitude;null" json:"Latitude"`
	Longitude 				float64			`gorm:"column:Longitude;null" json:"Longitude"`
	HorizontalAccuracy		float64			`gorm:"column:HorizontalAccuracy;null" json:"HorizontalAccuracy"`
	Speed					float64			`gorm:"column:Speed;null" json:"Speed"`
	Heading					float64			`gorm:"column:Heading;null" json:"Heading"`
	Deployed				int				`gorm:"column:Deployed;null" json:"Deployed"`
	BatteryLife				string			`gorm:"column:BatteryLife;null" json:"BatteryLife"`
	Status 					string			`gorm:"column:Status;null" json:"Status"`
	OrganisationID			string			`gorm:"column:OrganisationID;null" json:"OrganisationID"`
	CreatedDate				string			`gorm:"column:CreatedDate;null" json:"CreatedDate"`
	LastModified			string			`gorm:"column:LastModified;null" json:"LastModified"`
	TemplateID				string			`gorm:"column:TemplateID;null" json:"TemplateID"`
	OffTimer 				int				`gorm:"column:OffTimer;null" json:"OffTimer"`
	SafetyTimer 			int				`gorm:"column:SafetyTimer;null" json:"SafetyTimer"`
	HazardTimer				int				`gorm:"column:HazardTimer;null" json:"HazardTimer"`
	OffTimerTemp			int				`gorm:"column:OffTimerTemp;null" json:"OffTimerTemp"`
	LastSignedOn  			string			`gorm:"column:LastSignedOn;null" json:"LastSignedOn"`
	LastCheckIn   			string			`gorm:"column:LastCheckIn;null" json:"LastCheckIn"`
	HazardTimerStartedTime	string			`gorm:"column:HazardTimerStartedTime;null" json:"HazardTimerStartedTime"`
	ActiveDeviceType 		string			`gorm:"column:ActiveDeviceType;null" json:"ActiveDeviceType"`
	CurrentDeviceID			string			`gorm:"column:CurrentDeviceID;null" json:"CurrentDeviceID"`
	LastEventTimeStamp		string			`gorm:"column:LastEventTimeStamp;null" json:"LastEventTimeStamp"`
	LoginPassword			string			`gorm:"column:LoginPassword;null" json:"LoginPassword"`
	TrackingInterval		int				`gorm:"column:TrackingInterval;null" json:"TrackingInterval"`
	NewEvent				int				`gorm:"column:NewEvent;null" json:"NewEvent"`
	Display					int				`gorm:"column:Display;null" json:"Display"`
	TakeControl				int				`gorm:"column:TakeControl;null" json:"TakeControl"`
	AssetStatus				string			`gorm:"column:AssetStatus;null" json:"AssetStatus"`
	NewMessage				int				`gorm:"column:NewMessage;null" json:"NewMessage"`
	ResetPassword			string			`gorm:"column:ResetPassword;null" json:"ResetPassword"`
}
```

https://github.com/gin-gonic/gin/blob/73c4633943d596bdbeaa7d02cebdd4bd0c4f4630/render/json.go#L58
When the response is written to the writer, after the panic occurs here, the capture of the machine causes the CPU to skyrocket, which is close to 96%. When the 100% is reached, the request is lost, and the http service hangs.
- go version: 1.12.4
- gin version (or commit ref): 1.3.0/1.4.0
- operating system: Debian stretch

## Description

Hi all, I'm trying to set the default value in my struct and it's actually working with ShouldBind and not ShouldBindJSON.
Here is my sample code:

```golang
type t1 struct {
	Currency string `form:"currency,default=eur"`
}

type t2 struct {
	Currency string `json:"currency,default=eur"`
}

func Test1(c *gin.Context) {
	var s t1
	if err := c.ShouldBind(&s); err != nil {
		c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
		return
	}
	c.JSON(http.StatusOK, s)
}

func Test2(c *gin.Context) {
	var s t2
	if err := c.ShouldBindJSON(&s); err != nil {
		c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
		return
	}
	c.JSON(http.StatusOK, s)
}
```

With  `curl -XPOST localhost:8080/api/v1/test1` then result is of course `{"Currency":"eur"}` but for `curl -XPOST localhost:8080/api/v1/test2` result is `{"error":"EOF"}`

Any specific reason why it's failing with ShouldBindJSON?
- With issues:
Hi all, when using c.PostForm to get parameters from ajax, it seems there's cache in it, and the values do not change for times.

- go version: 1.11.2
- gin version (or commit ref): latest
- operating system: Mac OS

## Description

## Screenshots


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


Whenever you have a file field included in your struct the behaviour of the bind methods behaves in various cases not like expected.

```go
type Entity struct {
	Image    *multipart.FileHeader `form:"image"`
	Tags    []string `form:"tags[]"`
}
```

I don't know why currently but I get several times a "unexpected end of JSON input" error on calling "c.ShouldBind(&form)".

Tags are not bound at all to the struct field. The array interpolation seems not work.

---

Btw: An ArrayOfType to field mapping (like: element[][id], element[][name]) is missing. This is confusing because the most HTTP post mapping algos in other languages and frameworks can handle this.
- It's the typical use case to edit a list of elements via a simple form without using JS/ajax etc. without creating a JSON post request.
- A form should allow upload multiple file fields with a description to the server. This is not possible in the current implementation, and file uploads requires a formdata encoded post. Currently it's only solvable by multiple request if you want use the binding functionality without writing extra boilerplate code.

---

gin 1.4
golang 1.12.5
- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.





您好：
gin怎么解决文件上传第一次请求是option的问题，我写了middleware

func Cors() gin.HandlerFunc {
	return func(c *gin.Context) {
		//method := c.Request.Method

		var headerKeys []string
		for k, _ := range c.Request.Header {
			headerKeys = append(headerKeys, k)
		}
		headerStr := strings.Join(headerKeys, ", ")
		if headerStr != "" {
			headerStr = fmt.Sprintf("access-control-allow-origin, access-control-allow-headers, %s", headerStr)
		} else {
			headerStr = "access-control-allow-origin, access-control-allow-headers"
		}

		c.Header("Access-Control-Allow-Origin", "*");
		c.Header("Access-Control-Allow-Methods", "POST, GET, OPTIONS, DELETE");
		c.Header("Access-Control-Max-Age", "3600");
		c.Header("Access-Control-Allow-Headers", "x-requested-with,Authorization");
		c.Header("Access-Control-Allow-Credentials","true");

		//c.JSON(http.StatusOK, "Options Request!")

		c.Next()
	}
}


router：
    	r.Use(cors.Cors())
	r.POST("file", v1.Upload)


请求file接口，每次都是option请求，导致上传文件失败

DATA store in mysql which has a bigint column
parse to struct int64 and print them is the same value with mysql data
but after gin.H ， vistit API ,the data became not Accuracy
DATA store in mysql which has a bigint column
parse to struct int64 and print them is the same value with mysql data
but after gin.H ， vistit API ,the data became not Accuracy


Hi,

The goroutine example stipulates using a read only copy of the context within a goroutine.

## Sample code from docs:
```
func main() {
	r := gin.Default()

	r.GET("/long_async", func(c *gin.Context) {
		// create copy to be used inside the goroutine
		cCp := c.Copy()
		go func() {
			// simulate a long task with time.Sleep(). 5 seconds
			time.Sleep(5 * time.Second)

			// note that you are using the copied context "cCp", IMPORTANT
			log.Println("Done! in path " + cCp.Request.URL.Path)
		}()
	})

	r.GET("/long_sync", func(c *gin.Context) {
		// simulate a long task with time.Sleep(). 5 seconds
		time.Sleep(5 * time.Second)

		// since we are NOT using a goroutine, we do not have to copy the context
		log.Println("Done! in path " + c.Request.URL.Path)
	})

	// Listen and serve on 0.0.0.0:8080
	r.Run(":8080")
}
```

How would a response be expected to work:

```
func main() {
	r := gin.Default()
	r.GET("/long_async", func(c *gin.Context) {
		// create copy to be used inside the goroutine
		cCp := c.Copy()
		go func() {
			// simulate a long task with time.Sleep(). 5 seconds
			time.Sleep(5 * time.Second)
                        

## **//E.g.
			**cCp.Abort();**
                       //or 
**cCp.AbortWithStatusJSON(http.StatusNotFound, gin.H{"error": http.StatusNotFound, "message": "Invalid request " + urlPath})****

		}()
	})
	r.GET("/long_sync", func(c *gin.Context) {
		// simulate a long task with time.Sleep(). 5 seconds
		time.Sleep(5 * time.Second)

		// since we are NOT using a goroutine, we do not have to copy the context
		log.Println("Done! in path " + c.Request.URL.Path)
	})

	// Listen and serve on 0.0.0.0:8080
	r.Run(":8080")
}
```

Both will throw errors when attempted. I am assuming here that once the go func() {***} is executed the context `c` will no longer be valid.

I am not certain how channels can make use of this.

Any code snippets or proposals on how this can work?. 

Thanks
How go-bindata supports the template
 Hello, i  need  r.GET("/:page",myhandler) ,how  do  it  ?
I currently have a request body like this:
```json
{
	"guests": [
		{
			"firstname": "ryan",
			"lastname": "vlaming"
		}
	],
	"roomType": "suite",
	"checkinDate": "2018-04-13T19:24:00+00:00",
	"checkoutDate": "2018-07-13T19:24:00+00:00"
}
```

and am trying to read it into this struct

```go
type CreateParams struct {
	Username     string `json:"username"`
	Guests       Guests `json:"guests"`
	RoomType     string `json:"roomType"`
	CheckinDate  string `json:"checkinDate"`
	CheckoutDate string `json:"checkoutDate"`
}

type Guests struct {
	Person []struct {
		firstname string
		lastname  string
	}
}
```

using the following code

```go
	r := new(params.CreateParams)
	err := context.BindJSON(r)
	if err != nil {
		context.AbortWithStatusJSON(500, apierrors.JsonBindingError)
		return
	}
```

But i am getting the following error: `json: cannot unmarshal array into Go struct field CreateParams.guests of type params.Guests`

Is there any way i could read this in using the `c.BindJson` function, or do i need some other function for this ? or some sort of custom solution ? 
![](http://oq1xuulg6.bkt.clouddn.com/d8af0580010e089989254781a0c9b8ec.jpg)
when write json data to response ,the code in gin is 
```go

	writeContentType(w, jsonContentType)
	jsonBytes, err := json.Marshal(obj)
	if err != nil {
		return err
	}
	w.Write(jsonBytes)

```

if the obj is big ,why not code like this
```go

	writeContentType(w, jsonContentType)
	json.NewEncoder(w).Encode(obj)

```

I Have seen in binding.json, parse the reqdata to json is very beautiful 

```go
func (jsonBinding) Bind(req *http.Request, obj interface{}) error {
	decoder := json.NewDecoder(req.Body)
	if EnableDecoderUseNumber {
		decoder.UseNumber()
	}
	if err := decoder.Decode(obj); err != nil {
		return err
	}
	return validate(obj)
}
```
should i import
import "gopkg.in/gin-gonic/gin.v1
or 
"github.com/gin-gonic/gin"

```
// trace info
type TraceInfo struct{
    Id_ bson.ObjectId `form:"_id" json:"_id" bson:"_id"` 
    Search SearchInfo `form:"search" json:"search" bson:"search"`
}

// search
type SearchInfo struct{
    Text string `form:"text" json:"text" bson:"text"`
    ResultQty string `form:"result_qty" json:"result_qty" bson:"result_qty"`
}

func SaveJsData(c *gin.Context){
    var traceInfo TraceInfo
    err := c.ShouldBindQuery(&traceInfo);
    if err != nil {
        c.AbortWithStatusJSON(http.StatusOK, util.BuildFailResult(err.Error()))
        return
    }
}
```

when  i access  http://xxxx:3000/fec/trace?search[text]=dress&search[result_qty]=13

can not  get  this search param，empty:

```
 "search": {
     "text": "",
     "result_qty": "" 
  } 
```
Hi

i use gin.HandlerFunc method but first request call handler but when call context.Redirect in handler   then  not call method.
Can you help me?
```

authorized := server.Engine().Group("/home")
authorized.Use(attributes.RequireLogin())
{
authorized.GET("", controller.Index)
}


```
```
func RequireLogin() gin.HandlerFunc {
	return func(c *gin.Context) {
		fmt.Println("RequireLogin")
		c.Next()
	}
}
```
When I run into a panic after setting the http response code, gin prints a 500 to the log, but returns the previous code to the client. This is using the Recovery middleware, via `gin.Default()`.

I've written a small sample program, which has the output shown below. Note the 500 in the GIN log and the 200 of the client.

```
$ go run main.go 2>/dev/null
[GIN] 2018/04/08 - 22:47:32 | 500 |       2.436ms |       192.0.2.1 | GET      /
===> HTTP Code: 200
===> HTTP Body: {"message":"hello"}
```

Here is the program that I used to test this.

```
package main

import (
	"fmt"
	"net/http/httptest"

	"github.com/gin-gonic/gin"
)

func badcode(c *gin.Context) {
	c.JSON(200, gin.H{"message": "hello"})
	panic("Simulated Panic")
}

func main() {
	g := gin.Default()
	g.GET("/", badcode)

	w := httptest.NewRecorder()
	req := httptest.NewRequest("GET", "/", nil)

	g.ServeHTTP(w, req)

	fmt.Printf("===> HTTP Code: %d\n", w.Code)
	fmt.Printf("===> HTTP Body: %s\n", w.Body)
}
```

The sample program above simulates the error with a direct call to `panic`, but as a real example, one could hit this problem when json marshaling panics.

For example, the following code compiles and looks *mostly* correct, but it actually causes a runtime panic.

```
c.JSON(http.StatusBadRequest, gin.H{"error": err.Error})
```
Hi, I'm trying to test json binding and maybe I'm looking at this from the wrong angle, but I can't find the way to achieve what I want.
I would like to write some unit tests around json binding, Ideally I'd like to have a method with a json string as input and a struct as output, where I can check that the string was successfully parsed.

I want a mock context because I want to peek inside the struct, in that case, using httptest makes no sense for me because I don't want to put the marshaled struct in the response.

I hope that my intention is clear, feel free to ask for any clarification needed.

Thanks.
Issue about code in "github.com/gin-gonic/gin/binding/form_mapping.go" Line 56

```go
if _, isTime := structField.Interface().(time.Time); isTime ...
```

The testing code like follow just output "ts3".

```go
package main

import (
	"time"
)

type T1 time.Time
type T2 struct {
	time.Time
}

func main() {
	var ts1, ts2, ts3 interface{}
	ts1 = T1(time.Now())
	ts2 = T2{Time:time.Now()}
	ts3 = time.Now()
	if _, ok := ts1.(time.Time); ok {
		println("ts1")
	}
	if _, ok := ts2.(time.Time); ok {
		println("ts2")
	}
	if _, ok := ts3.(time.Time); ok {
		println("ts3")
	}
}
```
I know it uses HTTP protocol but I'm wondering if somehow it is possible to make real-time API server with gin. is it possible?
This pull request adds a new method called `DataFromReader` to provides an easy way to serve dynamic files.
First of all, thanks for you reading !

When i request from 100+ threads to the server,gin.H will report error.
this is my response json 


`
c.JSON(http.StatusOK, gin.H{
		"code": "ok",
		"data": gin.H{
			"dna": md.GenerateDNA(),
		},
	})
`


sometimes gin.H will make nil point dereference


`
knode1_1  | runtime error: invalid memory address or nil pointer dereference  

knode1_1  | /usr/local/go/src/runtime/panic.go:491 (0x433462)  
knode1_1  | /usr/local/go/src/runtime/panic.go:63 (0x43236d)  
knode1_1  | /usr/local/go/src/runtime/signal_unix.go:367 (0x44995b)  
knode1_1  | /go/src/p/app/handler.metadata.go:87 (0xb92edb)  
knode1_1  | /go/src/vendor/github.com/gin-gonic/gin/context.go:107 (0xb7a482)
knode1_1  | /go/src/vendor/github.com/gin-gonic/gin/recovery.go:46 (0xb8c729) 
knode1_1  | /go/src/vendor/github.com/gin-gonic/gin/context.go:107 (0xb7a482)
knode1_1  | /go/src/vendor/github.com/gin-gonic/gin/logger.go:83 (0xb8ba5b)
knode1_1  | /go/src/vendor/github.com/gin-gonic/gin/context.go:107 (0xb7a482)
knode1_1  | /go/src/vendor/github.com/gin-gonic/gin/gin.go:359 (0xb83595)
knode1_1  | /go/src/vendor/github.com/gin-gonic/gin/gin.go:326 (0xb82d2a)
knode1_1  | /usr/local/go/src/net/http/server.go:2619 (0x69e323)
knode1_1  | /usr/local/go/src/net/http/server.go:1801 (0x69a46c)
knode1_1  | /usr/local/go/src/runtime/asm_amd64.s:2337 (0x462200)
`

What should i do with this problem?

For example,
POST /user/:id ---> update a user
GET /user/:id    ---> query a user

Thanks!
I found a few other issues that look like they are related to this problem, but they are all closed and I'm not sure what the status of this bug is, so I'm making a new issue here...

As an example I've defined two routes, one to get a user by their ID, and another to get a user by their email:
```
	apiRoutes := r.Engine.Group("/api")
	apiRoutes.GET("/users/:id", GetUser)
	apiRoutes.GET("/users/email/:email", GetUser)
```

When I try and build, I get this error:
```
panic: path segment 'email/:email' conflicts with existing wildcard ':id' in path '/api/users/email/:email'
```

The problem is that these routes are NOT ambiguous and shouldn't conflict.  I'm using Gin in several APIs and run into this problem in all of them in various ways.  The above code is just a simplified demonstration of the bug.

Based on the closed issues I've found here:
https://github.com/gin-gonic/gin/issues/205
https://github.com/gin-gonic/gin/issues/388

That last issue referenced this open issue in httprouter:
https://github.com/julienschmidt/httprouter/issues/73

...but that issue hasn't been updated since 2015...

So it seems the Gin team is aware of this bug, but it isn't clear whether or not it's going to be fixed.  I'm just posting this to get some clarity on the problem.

Thanks!
thank u. 
/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
/ / / / / / / / / / / / / / / / / /

I'm write a template for gin framework, I hope it can help some one, and welcome to submit suggestions and fix bug.

repo: https://github.com/foolin/gin-template

/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
/ / / / / / / / / / / / / / / / / /
Hello there!

I'm trying to figure out if there's a way to simplify an upload handler by including the form file in with the bind object.

```go
type UploadRequest struct {
  Image       interface{} `form:"image" binding:"required"`
  Description string      `form:"description" binding:"required"`
  Owner       string      `form:"owner" binding:"required"`
}

func HandleUpload(c *gin.Context) {

  req := new(UploadRequest)
  if err := c.ShouldBind(req); err != nil {
    // fail brilliantly
  }
  // do wonderful upload-y type things

}
```

However, when CURLing an image up I receive a binding error:
```
$ curl -F 'description=super cool thing' -F 'owner=rbalboa27' -F 'image=@/path/to/image.iso' http://localhost:8000/api/image/v1.0/upload
bailing: Key: 'UploadRequest.Image' Error:Field validation for 'Image' failed on the 'required' tag
```

I've tried a few variations to try and "sniff" the type of UploadRequest.Image to no avail.

Is this type of thing supported/a feature within Gin?
I want to post a request like this 
`127.0.0.1:8082//event/write`
and ,I found when I set  RedirectFixedPath true it would be redirect.
the question is my client do not support redirection.
So how can I fix this?
I want a function like auto strip slash or regex url .so could gin do that?
 Currently, Gin doesn't handle recursive load of template files in a folder.
This pull request adds a new method called `LoadHTMLFilesRecursively` to load all files matching a list of extension in a specific folder.
i want get request body in function,but request body is empty.
code such as：
func LiveRecord(c *gin.Context) {
	buf := make([]byte, 1024)
	num, _ := c.Request.Body.Read(buf)
	reqBody := string(buf[0:num])
}

but reqBody is empty,who can tell me how to use?

Whether Gin can provide `Auto return`
like this : 990775042ee852eeb9d38f4d1c0af06d2b835687

```go
// Automatic return json or protobuffer by header content-tyep
func (c *Context) AutoReturn(code int, obj interface{}){
	switch c.ContentType() {
	case "application/x-protobuf":
		c.Protobuf(code, obj)
		break
	case "application/json":
		c.JSON(code, obj)
		break
        // more ...
	}
}
```

so, i can use, like this:
```go
router.POST("/test", func(context *gin.Context) {
	// more ...
	context.AutoReturn(200, output)
})
```
GoLang can use the Headers API to write trailers:
https://golang.org/pkg/net/http/#example_ResponseWriter_trailers

However this panics:
`    g.(*gin.Context).Header("afterBody", "true")`

To make it foolproof, it should take a callback & panic if sent after body started:
`   g.(*gin.Context).Trailer("server-timing", func() string {  
         return fmt.Sprintf("0= %d; \"bodyRenderTime\" ",t)
     })
`
I am trying to write tests around my handler functions and middleware functions, but the context is not being passed to the handlerfunc, and I am not sure why.

My code looks like this:
```golang
resp := httptest.NewRecorder()
gin.SetMode(gin.TestMode)
c, r := gin.CreateTestContext(resp)
c.Set("profile", "myfakeprofile")
r.GET("/test", func(c *gin.Context) {
    _, found := c.Get("profile")
    // found is always false    
    t.Log(found)
    c.Status(200)
})
c.Request, _ = http.NewRequest(http.MethodGet, "/test", nil)
r.ServeHTTP(resp, c.Request)
```
such as
 my user post a new article , customize a url link  
domain.com/customize.html or domain.com/cate/customize.html or
domain.com/date/customize.html 

but now my blog system only post article a fixed link .
such as domain.com/article/id.html 
so,what should I do?
I've saved a context and call the c.SSEvent method every second, yet it continually causes EventSource in JavaScript to reopen the connection. Is there any examples of how it's supposed to be utilized?
Hi,
I have the following function
```golang
func FoodBar(context * gin.Context){
	startTime := time.Now()
	Id := context.Query("id")
	maxContentId := context.Query("max_content_id")
	var TotalelapsedTime time.Duration
	var processingTime time.Duration
	if len(Id) > 0 && len(maxContentId) > 0 {
               //do DB/ Cache query
		outData, status := FoodBarHandler(Id, maxContentId)
		processingTime = time.Since(startTime)
		if status {
			context.String(http.StatusOK, string(outData))
			TotalelapsedTime = time.Since(startTime)
			glog.V(logLevelPerformenceInfo).Infof("FoodBar(), " +
				"processing time :%s, total execution time :%s", processingTime, TotalelapsedTime)
			return
		}
	}
	context.String(http.StatusForbidden, "Status failed")
	glog.V(logLevelPerformenceInfo).Infof("FoodBar(), " +
		"processing time :%s, total execution time :%s", processingTime, TotalelapsedTime)
	return
}
```
IN FooBar() the FooBarHandler does all the heavy lifting like DB/cache query, JSON encoding etc, but the timing measurement does not add up.
It seems like TotalelapsedTime(processing and writing the response back) is significantly taking more time than processingTime (processing). Here are some results


FoodBar(), processing time :400.284µs, total execution time :289.196008ms
FoodBar(), processing time :10.576482ms, total execution time :620.363321ms
FoodBar(), processing time :436.55µs, total execution time :391.341991ms
FoodBar(), processing time :544.983µs, total execution time :570.257745ms
FoodBar(), processing time :3.855597ms, total execution time :4.422912ms
FoodBar(), processing time :8.61613ms, total execution time :570.295792ms
FoodBar(), processing time :4.079823ms, total execution time :4.311607ms
FoodBar(), processing time :5.025624ms, total execution time :254.933137ms
FoodBar(), processing time :452.871µs, total execution time :1.932513ms
FoodBar(), processing time :975.258µs, total execution time :2.675737ms
FoodBar(), processing time :420.936µs, total execution time :1.550688ms
FoodBar(), processing time :384.235µs, total execution time :1.77858ms
FoodBar(), processing time :15.285014ms, total execution time :1.452023705s
`

So it seems like writing the response using context.String() is very slow. Is there any workaround for that or I am missing something?

I am running HTTPS on Gin (in release mode)



In "graceful-shutdown" examples, ListenAndServe errors are checked but just to be logged.
If port is already used by another program, program will start, fail to bind, but still run, waiting for a sigterm.

Also handling error "ErrServerClosed" which is triggered by Shutdown and should be considered as a legit error.
i mean how to realize it in 'gin' way?

or other way to call  back-end functions.

version 1.2, the router.MaxMultipartMemory is missing. 

So how to set the max memory in the new version? Is there new function?
At first time the problem occur when i make registration system, but later on. in my login function `c.Redirect()` not working like before. And i don't know how it can work so i cannot reproduce it.

here is piece of my code, is there any mistake from my code?

```
router.POST("/admin/login", func(c *gin.Context) {
	username := c.PostForm("username")
	password := c.PostForm("password")

	user := User{}
	err = db.Find(bson.M{"username": username, "password": password}).One(&user)

	if err != nil {
		redis.Insert(&Message{
			Path:        "/admin/login",
			MessageType: "danger",
			Message:     "Username or Password is not valid.",
			Timestamp:   time.Now(),
			expireAt:    5 * time.Minute})
		c.Redirect(http.StatusFound, "/admin/login")
	}

	c.String(http.StatusOK, user.Username)
})
```
I use the example code 
```
package main

import (
	"context"
	"log"
	"net/http"
	"os"
	"os/signal"
	"time"

	"github.com/gin-gonic/gin"
)

func main() {
	router := gin.Default()
	router.GET("/", func(c *gin.Context) {
		time.Sleep(5 * time.Second)
		c.String(http.StatusOK, "Welcome Gin Server")
	})

	srv := &http.Server{
		Addr:    ":8080",
		Handler: router,
	}

	go func() {
		// service connections
		if err := srv.ListenAndServe(); err != nil {
			log.Printf("listen: %s\n", err)
		}
	}()

	// Wait for interrupt signal to gracefully shutdown the server with
	// a timeout of 5 seconds.
	quit := make(chan os.Signal)
	signal.Notify(quit, os.Interrupt)
	<-quit
	log.Println("Shutdown Server ...")

	ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
	defer cancel()
	if err := srv.Shutdown(ctx); err != nil {
		log.Fatal("Server Shutdown:", err)
	}
	log.Println("Server exiting")
}

```

build and run,then input ctrl+c,the error like this:

```
[GIN] 2018/03/15 - 11:43:18 | 200 |    1.850909ms |       127.0.0.1 | GET      /coind/ping
^CShutdown Server ...
listen: http: Server closed
Server Shutdown:context deadline exceeded
```

is the message show "Server exiting" is right?
Should fix #1267 

The length might seem drastic, but from [what I understand](https://github.com/gin-gonic/gin/issues/1267) a v6 IP might actually grow up to that length:

> IPv6 addresses are represented as eight groups of four hexadecimal digits with the groups being separated by colons, for example 2001:0db8:0000:0042:0000:8a2e:0370:7334, but methods to abbreviate this full notation exist.


i want to get all request in header and body in any routing, how can i get the data?
thank you
一个xorm的错误，sorry
Hello. I'm student at HAL Osaka in Japan.
I'm very grateful that I usually use **gin** to create web services.

However, I felt that LoadHTMLGlob is a slightly bad implementation.
When loading a nested HTML file with LoadHTMLGlob, you must define it in the tmpl file.

If you implement the following implementation, how do you think HTML can be called immediately?

*gin*

```go
package gin

import (
	"fmt"
	"html/template"
	"net/http"
	"os"
	"path/filepath"
	"strings"
)

var filepathArray []string

func LoadHTMLGlob(path string) {
	var rootDir string

	if strings.HasSuffix(path, "*") {
		rootDir = strings.Split(path, "/")[0]
	}

	err := filepath.Walk(rootDir, func(p string, info os.FileInfo, err error) error {
		if strings.HasSuffix(p, ".html") {
			filepathArray = append(filepathArray, p)
		}
		return nil
	})
	if err != nil {
		panic(err)
	}

}

func GET(endpoint, file string) {

	var path string

	for _, p := range filepathArray {
		if strings.HasSuffix(p, file) {
			path = p
		}
	}

	fmt.Println(endpoint + "->" + path)

	http.HandleFunc(endpoint, func(w http.ResponseWriter, r *http.Request) {
		tmpl, err := template.ParseFiles(path)
		if err != nil {
			panic(err)
		}
		err = tmpl.Execute(w, nil)
		if err != nil {
			panic(err)
		}
	})
}

func Run(port string) {
	http.ListenAndServe(port, nil)
}
```

User write main.go

```go
package main

import (
	"github.com/konojunya/html-glob-handler/gin"
)

func main() {
	gin.LoadHTMLGlob("views/*")
	gin.GET("/", "home/index.html")
	gin.Run(":8000")
}
```

What I'd like to say is not to make gin.Run possible, but I also want LoadHTMLGlob to be able to read HTML files in deep Directory.

Thanks.

i want to use json-iterator lib, because golang stdlib encoding/json speed is slow.  Of course. This is my suggestion.
- Add func `ValidatorEngine` for returning the underlying validator engine used
  in the default `StructValidator` implementation.
- Remove the function `RegisterValidation` from the `StructValidator` interface
  which made it immpossible to use a `StructValidator` implementation without the
  `validator.v8` library.
- Update and rename test for registering validation
  `Test{RegisterValidation => ValidatorEngine}`.
- Update readme and example for registering custom validation.
- Add example for registering struct level validation.
- Add documentation for the following binding funcs/types:
  - `Binding` interface
  - `StructValidator` interface
  - `Validator` instance
  - `Binding` implementations
  - `Default` func

Closes #1147, #1211.
Performance enhancement, overall improvements and added i18n aware custom error message translations.
We emit method metrics in handler func like this:

```go
func(c *gin.Context) {
     name := c.HandlerName()
    //
     emit(name, timeused)
}
```

it works well until we encounter decorator cases, that

```go
func decorator(func()) func(c *gin.Context) {
    // 
    return func(c *gin.Context) {
    }
}
```

when i install handlers like this:

```go
router := Default()
router.GET("/foo", decorator(func(){print func 1}))
router.GET("/boo", decorator(func(){print func 2}))
```

then i always get the decorator's name in metrics

So any way to handle this problem?
The **Model binding and validation** section was outdated, showing the old methods that Gin does not provide anymore.
I've replaced the old ones with the new ones and changed the explanations of their functionality.
gin already support http2, while previously not support server push.
Add Pusher() function to extend the ResponseWriter interface.

```golang
// get http.Pusher
 if pusher := c.Writer.Pusher(); pusher != nil {
     // use pusher.Push() to do server push
}
```
<img width="881" alt="screen shot 2018-03-07 at 11 20 49 pm" src="https://user-images.githubusercontent.com/16014993/37100619-680c00c6-225e-11e8-9352-76ec3bd62894.png">

I'd like to have access to the HandlerFunc in RouteInfos, to write utilities around gin.
This resolves #506 for me.
As explained in the TestInterceptedHeader test, in case a middleware
filters out the headers, this middleware can be done inefficient in case
one following handler is using c.String or other methods writing to the
response body directly.

This commit fixes the issue by using c.Writer when writing the Status as
done in other c.Header, c.SetCookie and other response writers.

The bug has been originally discovered using
https://github.com/gin-contrib/gzip where a failing test has been added
here: https://github.com/tjamet/gzip/blob/header/gzip_test.go#L71

Signed-off-by: Thibault Jamet <tjamet@users.noreply.github.com>
I found that gin printed the current stack information in panic, but there was no time to print panic, and it was hard to know when the panic occurred.
**Hi!**

I tried to look in to the documentation of the GIN async process but I found old outdated functions  that already not exists.

I'm trying to figure out how to response a data that returned from a RPC job.
As right now, the route automatically responding status 200 and not waiting until the go-routine finish his job.

Found something called context.Done() that retunes a nil channel but I didn't understood how I can handle the channels as part of the context.
if cant add feature like this, so i can have a standard JSON format response to caller
Variable-length IP addresses misalign everything to their right.

![image](https://user-images.githubusercontent.com/802664/36942314-468b33e8-1f2c-11e8-9b9b-1b7010df011e.png)
(IPv6 addresses and paths are censored out in orange, but you get the idea.)
Hi,
I'm working on an IoT project and I want to create a Rest API on a Raspberry Pi 3 using the constraint application protocol (CoAP), I found that Gin provides very good preformances, I want to know if I can use Gin in my case
thanks
I am getting following error output while performing **`go get github.com/gin-gonic/gin`**

> package gopkg.in/go-playground/validator.v8: unrecognized import path "gopkg.in/go-playground/validator.v8" (https fetch: Get https://gopkg.in/go-playground/validator.v8?go-get=1: dial tcp: lookup gopkg.in on 127.0.0.53:53: read udp 127.0.0.1:60877->127.0.0.53:53: i/o timeout)
> package gopkg.in/yaml.v2: unrecognized import path "gopkg.in/yaml.v2" (https fetch: Get https://gopkg.in/yaml.v2?go-get=1: dial tcp: lookup gopkg.in on 127.0.0.53:53: read udp 127.0.0.1:34155->127.0.0.53:53: i/o timeout)
> 

I tried using Glide and Govendor but same issue. Looks like gopkg.in/go-playground/validator.v8 is not available.
update for supporting multipart form and file binding 

example:
```
type PhoptUploadForm struct {
	imgData    *multipart.FileHeader `form:"img_data" binding:"required"`
	ProjectID   string `form:"project_id" binding:"required"`
	Description string `form:"description binding:"required"`
}
```


ref: https://github.com/gin-gonic/gin/issues/1263
Hi, 

I'm currently using **go v1.9.2** and **gin v1.2**. Is there any way to bind file data with form and check if it is exist. Or, form's file can only be retrieved by `c.fromfile()`

Here is the form struct:

```
// Binding from Form
type PhoptUploadForm struct {
	imgData    *multipart.FileHeader `form:"img_data" binding:"required"`
	ProjectID   string `form:"project_id" binding:"required"`
	Description string `form:"description binding:"required"`
}
```

and the request body:

```
------WebKitFormBoundarysOtthv5MjO3ut9Ao
Content-Disposition: form-data; name="img_data"; filename="blob"
Content-Type: image/jpeg


------WebKitFormBoundarysOtthv5MjO3ut9Ao
Content-Disposition: form-data; name="project_id"

263a5c1d-c8f8-4bf2-9bc5-e70982820a96
------WebKitFormBoundarysOtthv5MjO3ut9Ao
Content-Disposition: form-data; name="description"

description-test
------WebKitFormBoundarysOtthv5MjO3ut9Ao

```
Hi!

I'm currently using gorilla/mux as http framework. It got a feature where you can define url parameters as regex like:

```go
router.HandleFunc("/test/{hexCode:[A-F0-9]{1,5}}", <func>)
```

In this function you can get the url parameters using `mux.Vars(req)["hexCode"]`. If the request doesn't match the regex it will result in a 404.

Is there a similar feature in gin?


Extends the `context.File` method to allow the Content-Disposition header to be automatically set within this scope. This allows downloads of the file as attachments, allowing the server to specify the filename.

References:
https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition

Resolves https://github.com/gin-gonic/gin/issues/1243
This is a proposed fix for #1089 to prevent the case of a broken pipe leading to a noisy panic stack trace. 
The `DumpRequest` output is still preserved, but the panic is avoided, which is caused by the `RecoveryWithWriter` handler trying to write headers after the body has already been written.
see code :

``` go

type ControllerHandler struct {
}

type ControllerResolver struct {
}

// type Controller* ...

type MyController struct {
	FindByName ControllerHandler `Mapping:/findByName Handler:FindByNameHandler QueryParameters:name(string)`
}

func (a *MyController) FindByNameHandler(name string) {

}

// request: xx/findByName?name=hehe 
// -> Dispatcher -> MyController struct -> Handler:FindByNameHandler 
// -> exec (a *MyController) FindByNameHandler(name string) func

// Registry Controller
type ControllerRegistry struct{
}

ControllerRegistry.Registry(MyController)

```

i like java spring mvc design mode.

Please close if you don't like it.

I am passing HTML form to data to a controller in Go. I am working off [boilerplate](https://github.com/Massad/gin-boilerplate/blob/master/README.md) to teach myself Go, and it includes form validation. The relevant statement, already changed somewhat from its original appearance in the boilerplate, is below:

```
if err := c.ShouldBindWith(&signinForm, binding.Form); err != nil {
      log.Println("err: ",err)
      c.JSON(406, gin.H{"message": "Invalid signin form", "form": signinForm})
      c.Abort()
      return
  }
```

The `err` logs as `Key: 'SigninForm.Email' Error:Field validation for 'Email' failed on the 'email' tag`.

In particular, I don't really know what `c.ShouldBindWith(&signinForm, binding.Form)` does (it was suggested by someone else in regards to my previous issue with `signinForm` being empty, which it solved).

How do I properly validate the form fields so that `err == nil`?

  router.GET("api/:fixed/*optional", func(context *gin.Context) {
	t1 := context.Param("fixed")
	t2 := context.Param("optional")
})

curl http://127.0.0.1:8000/api/user/123

t1 will be "user"
t2 will be "/123"

Is this a bug?
Thank you for any reply

Method for getting body request with Content-Type like MIMEJSON, MIMEPOSTForm or MIMEMultipartPOSTForm
As suggested on
https://github.com/gin-gonic/gin/issues/1251
Hey,
I had a small issue with Stream with cases that the client disconnected middle of stream (had no observer on channels)

Example
```go
context.Stream(func(w io.Writer) bool {
         streamData := <- channelingData // the channel thread is stuck because this method never being called again if disconnected middle
      // ... rest of code			
})
```
I looked over the source code, 
the current situation is:
```go
func (c *Context) Stream(step func(w io.Writer) bool) {
	w := c.Writer
	clientGone := w.CloseNotify()
	for {
		select {
		case <-clientGone:
			return
		default:
			keepOpen := step(w)
			w.Flush()
			if !keepOpen {
				return
			}
		}
	}
}
```

Maybe you should change it to

```go
// returns bool, true = clientGone
func (c *Context) Stream(step func(w io.Writer) bool) bool {
	w := c.Writer
	clientGone := w.CloseNotify()
	for {
		select {
		case <-clientGone:
			return true
		default:
			keepOpen := step(w)
			w.Flush()
			if !keepOpen {
				return false
			}
		}
	}
}
```

So we could do something like

```go
isClientGone := context.Stream(func(w io.Writer) bool {
         streamData := <- channelingData // the channel thread is stuck because this method never being called again if disconnected middle
      // ... rest of code			
})

if isClientGone {
   // handle here 
}
```

Thanks :)
Not setting mode explicitly sets gin into debug mode, but it does not
make it possible to retrieve gin mode as Debug since it's set to "".
Calling `gin.Mode()` returns "" even though gin is in debug mode.

The alternative approach is to change SetMode to not accept "" and make `init` function calling `SetMode(DebugMode)` explicitly when the mode is not defined. That would definitely change how SetMode reacts to inputs and could break some apps.
Adds a badge showing the number of people helping this repo on CodeTriage.

[![Open Source Helpers](https://www.codetriage.com/gin-gonic/gin/badges/users.svg)](https://www.codetriage.com/gin-gonic/gin)


## What is CodeTriage?

CodeTriage is an Open Source app that is designed to make contributing to Open Source projects easier. It works by sending subscribers a few open issues in their inbox. If subscribers get busy, there is an algorithm that backs off issue load so they do not get overwhelmed

[Read more about the CodeTriage project](https://www.codetriage.com/what).

## Why am I getting this PR?

Your project was picked by the human, @schneems. They selected it from the projects submitted to https://www.codetriage.com and hand edited the PR. How did your project get added to [CodeTriage](https://www.codetriage.com/what)? Roughly 6 months ago, [dinsaw](https://github.com/dinsaw) added this project to CodeTriage in order to start contributing. Since then, 5 people have subscribed to help this repo.

## What does adding a badge accomplish?

Adding a badge invites people to help contribute to your project. It also lets developers know that others are invested in the longterm success and maintainability of the project.

You can see an example of a CodeTriage badge on these popular OSS READMEs:

- [![](https://www.codetriage.com/rails/rails/badges/users.svg)](https://www.codetriage.com/rails/rails) https://github.com/rails/rails
- [![](https://www.codetriage.com/crystal-lang/crystal/badges/users.svg)](https://www.codetriage.com/crystal-lang/crystal) https://github.com/crystal-lang/crystal

## Have a question or comment?

While I am a bot, this PR was manually reviewed and monitored by a human - @schneems. My job is writing commit messages and handling PR logistics.

If you have any questions, you can reply back to this PR and they will be answered by @schneems. If you do not want a badge right now, no worries, close the PR, you will not hear from me again.

Thanks for making your project Open Source! Any feedback is greatly appreciated.
This allows to get the raw http.Request even when the context was
only passed as an interface.

For example I have a function where I receive a `gin.Context` and pass data into another library's function. To be independent of the used framework on make the tests easier I only declare an interface as the function parameter. But this does not allow to get the raw request.

```go
func MyHandler(ctx IMyContext) {
  thirdpartylibrary.DoSomething(ctx.Request) // Does not work, because the passed in interface
}
```
`func (r *Request) ParseMultipartForm(maxMemory int64) error` might return an error like this:
`write /tmp/multipart-296085692: no space left on device`. In such case, `func (c *Context) GetPostForm(key string) (string, bool)` will return `'', nil` if we try to get parts other than file, without any information logged regarding the actual error.
I think the error should not be ignored when `req.ParseMultipartForm(32 << 20)` is called.
```
type HcStatus struct {
	Name    string `json:"name" binding:"required"`
	IsAlert int    `json:"isalert" binding:"required"`
}

func UpdateStatus(c *gin.Context) {
	var inputs HcStatus
	err := c.Bind(&inputs)
	fmt.Println("error:====>",err)
}
```
when the `IsAlert` bigger than 0, it will be correct.  But the `alert` is 0, it will be `Key: 'HcStatus.IsAlert' Error:Field validation for 'IsAlert' failed on the 'required' tag`.
sorry,I am a newbie. How can I resolve it?
https://serverfault.com/questions/314574/nginx-real-ip-header-and-x-forwarded-for-seems-wrong

this explains possible spoofing and changes required in nginx config file to address it.

Based on https://github.com/gin-gonic/gin/blob/master/context.go#L511
ClientIP returns the actual client IP ( not the proxies IP - unlike RemoteAdd )

X-Forwarded-For contains an array of IPs. ClientIP() implementation is picking left-most IP and returning it.
For example X-Forwarded-For: 11.11.11.11, 123.123.123.123, 192.168.2.1, 127.0.0.1

if user has spoofed 11.11.11.11, we don't want ClientIP to return 11.11.11.11 instead it should return
123.123.123.123

I wanted to know whether this scenario is being handled? if so - any samples and documents.

Even if user spoofing IP in X-Forwarded-For, is there a way to stipping it in the nginx? if so what is the right settings.
With the given code below, it seems like the custom `MarshalJSON` function isn't being called with i hit the api endpoint. Should it be?

```
type User struct {
 FirstName string `json:"first"`
 LastName string `json:"last"`
 Fullname string `json:"full"`
}

func (u *User) MarshalJSON() ([]byte, error) {
    type Alias User
    return json.Marshal(&struct {
        FullName string `json:"full"`
        *Alias
    }{
        FullName: fmt.Sprintf("%s %s", u.FirstName, u.LastName),
        Alias:  (*Alias)(u),
    })
}

......

user := User{
  FirstName: "Bob",
 LastName: "Denver",
}

c.JSON(200, user)
```

I am not seeing the full name attribute filed out like i'd expect. Any thoughts on what i may be missing here?
I try c.File(fileName) , it does not provide prompting name when downloading, could you provide api such as `c.File(fileName, promptName string) `?

As `echo` does:
<pre>
// Attachment sends a response as attachment, prompting client to save the file.
Attachment(file string, promptName string) error
</pre>

Thank you!

pull request
What's difference between `LoadHTMLGlob` and `LoadHTMLFiles`?
Does it have cache?

Then how do i call template with define name like b and c?

```
a.html
{{template "content"}}

b.html
{{define "content"}}b{{end}

c.html
{{define "content"}}c{{end}
```

Couldn't read anything in the documents.
Dep ensure fetches 1.2.0 which does not have SaveUploadedFile. 

https://github.com/gin-gonic/gin/issues/1025

Doing this in dep is not safe for production environments since it may break  builds.

[[constraint]]
  name = "github.com/gin-gonic/gin"
  branch="master"


Please add a new release tag to a stable version. 

Very useful when using Gin with some reverse proxies like Traefik
func Test(c *gin.Context) {
	defer c.Request.Body.Close()

	b, _ := ioutil.ReadAll(c.Request.Body)

	fmt.Println(string(b))
}
error 
# github.com/bean-du/tbin/vendor/github.com/gin-gonic/gin
vendor/github.com/gin-gonic/gin/gin.go:48: undefined: render.Delims

how to fix it
Catch-all route end with backslash is legal or illegal?

```
diff --git a/tree_test.go b/tree_test.go
index 5bc2717..c9ab19a 100644
--- a/tree_test.go
+++ b/tree_test.go
@@ -281,6 +281,11 @@ func TestTreeWildcardConflict(t *testing.T) {
                {"/user_:name", false},
                {"/id:id", false},
                {"/id/:id", true},
+               // this is ok
+               {"/a/*b", false},
+               {"/a/*b/", false},
+               // this is conflict
+               {"/a/*c/", true},
        }
        testRoutes(t, routes)
 }
```
* the err is as below:
c.ShouldBindJSON undefined (type *gin.Context has no field or method ShouldBindJSON)

* the code is as below:
```
func (this *CommonController) SetRepo(c *gin.Context) {
	var json db_models.Repo
	if err := c.ShouldBindJSON(&json); err == nil {
		if json.ParentID == "manu" {
			c.JSON(http.StatusOK, gin.H{"status": "you are logged in"})
		} else {
			c.JSON(http.StatusUnauthorized, gin.H{"status": "unauthorized"})
		}
	} else {
		c.JSON(http.StatusBadRequest, gin.H{"errorformat": err.Error()})
	}

	c.JSON(http.StatusOK, gin.H{
		"RepoID":   "1",
		"RepoName": "capital",
	})
}
```

* i have imported  `"gopkg.in/gin-gonic/gin.v1"`

* how to fix this error?
Hi

I build gin & use curl to request api
> use "github.com/happierall/l" to make the log pretty

use `l.Log(c.Request.URL)` and the log are below
> c is `c *gin.Context`

```
    URL:    &url.URL{
        Scheme:     "",
        Opaque:     "",
        User:       (*url.Userinfo)(nil),
        Host:       "",
        Path:       "/v1/playback/demo/videmo/id123/1516375842496",
        RawPath:    "",
        ForceQuery: false,
        RawQuery:   "",
        Fragment:   "",
    },
```

why Host & Scheme are empty?
Writing a golang template for gin framework, it use golang html/template syntax, easy and simple to use for gin framework, like this:

```go
package main

import (
	"github.com/gin-gonic/gin"
	"github.com/foolin/gin-template"
	"net/http"
)

func main() {

	router := gin.Default()

	//new template engine
	router.HTMLRender = gintemplate.Default()

	router.GET("/page", func(ctx *gin.Context) {
		ctx.HTML(http.StatusOK, "page.html", gin.H{"title": "Page file title!!"})
	})

	router.Run(":9090")
}
```

page.html : 
```html
<!-- /views/page.html -->
<!doctype html>

<html>
    <head>
        <title>{{.title}}</title>
    </head>

    <body>
        {{.title}}
    </body>
</html>
```
more examples:
https://github.com/foolin/gin-template

I hope it can help some people, and if you have advice, please tell me, thanks!

r -> router
Hi!

If I'm not mistaken, the HandleContext function should not return the context to the sync pool, right? https://github.com/gin-gonic/gin/blob/master/gin.go#L337

HandleContext will only ever be used to handle an adjusted Context, which will already be returned to the pool from the [ServeHTTP method](https://github.com/gin-gonic/gin/blob/master/gin.go#L320).

So if HandleContext returns it too, it might cause all kind of issues, right?

Sorry I'm not providing any benchmarks or tests with this, it is just a gut feeling for now.

Thanks,
Phil
r -> router
r -> router
Hi guys, i'm just learning Go Lang for 3 days, Following tutorial from a website, and the tutorial says to put handler files in the same folder. I'm just wondering if i could put my handler files to specific folder, let say: handlers folder.

The desired folder structure will be like this:
[project's-folder]/main.go
[project's-folder]/routes.go
[project's-folder]/handlers/handlers.user.go
[project's-folder]/models/models.user.go


Is it possible ? Because it is possible to import all of html files from subdirectory using this code:

` router := gin.Default()`
`  router.LoadHTMLGlob("templates/*")`
Is there a way to create authentication system like Rails's `has_secure_password`?

I'm new to Gin / Golang and I come from Rails.

I don't understand if there is a way in gin-gonic like the Rails's system with `has_secure_password`, `bcrypt` and `password_digest`.

I'm wrong?

https://www.pluralsight.com/guides/ruby-ruby-on-rails/token-based-authentication-with-ruby-on-rails-5-api#creating-the-user-model
When I am debugging, I always need to make some changes to the HTML file, so I hope i can see the changes on the browser just by refreshing it, 
However, I have to restart the server, then the templates could be reloaded, after that I can see the changes, it's really inconvenient, Is there any way to reload the HTML templates while server is running? thanks

BTW: I tried debug mode, seems it does not work well

BTW2: this is the test code as below

```go

import	"github.com/gin-gonic/contrib/renders/multitemplate"

func adminRender(engine *gin.Engine) multitemplate.Render {
	render := multitemplate.New()
	pages, err := filepath.Glob("./webadmin/adminpages/*.html")
	if err != nil {
		Log.Error("err = %v", err)
		os.Exit(-1)
		return nil
	}

	for _, page := range pages {
		pageName := page
		pagetmpl := append([]string{pageName}, defaultTemplate()...)
		render.Add(pageName, template.Must(template.New(pageName).Funcs(engine.FuncMap).ParseFiles(pagetmpl...)))
	}

	return render
}

func MakeGinAdminHandler() http.Handler {

	Log.Info("entering...")

       gin.SetMode(gin.DebugMode)

	router := gin.New()
	router.Use(gin.Logger())
	router.Use(gin.Recovery())

	router.Static("/webadmin", "./webadmin")
	router.HTMLRender = adminRender(router)
... ...
}

```

If you use RouterGroup.handle it makes a set of handlers for that path/method based on what is in the RouterGroup.Handlers **at that time** and it will not use any added later.

You can see why that it is in the [routergroup.go](https://github.com/gin-gonic/gin/blob/master/routergroup.go#L199).

What that means is if you have:

```
router := gin.New()
router.GET("/test.html",handler)
router.USE(middleware)
router.GET("/test2.html",handler)
```

Requests to /test.html will run with no middleware while requets to test2.html will go through middleware.

This makes the functions sort of 'non-idempotent' and based on what I've seen in the documentation this is not the intended behavior.
see title, thank u. 
Every **static file http state code** is 200
how to cache static files?
change satat code **200** to **304**
What is the better way inject services?
Database for example, template-cache, etc.
Should I use gin.Context.Keys via middlewares or Use gin.HandlerFunc as struct such as controller in MVC.
What are you thinking about including it in doc for DI or testing example?

I think that context wasn't maked for dependencies and inject to struct actually looks more friendly.

  
copy from https://github.com/julienschmidt/httprouter/commit/15782a78c61201cf2fdbc138d63aa60fff114695


copy from https://github.com/julienschmidt/httprouter/commit/cfa3cb764b4fc4eb98cae67a2020a91c79e065be
## Description

When I am using the `app.Use()` method to add middleware to my application, they all run regardless of if the last middleware called `ctx.Next()` or not.

## How to reproduce

```go
package main

import (
        "log"
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
        g.Use(serveStatic)
        g.Use(rateLimit)
	g.GET("/hello/:name", func(c *gin.Context) {
		c.String(200, "Hello %s", c.Param("name"))
	})
	g.Run(":9000")
}
func serveStatic(c *gin.Context) {
        if someCondition {
                // write something
                log.Println("Some condition, not proceeding")
                return
        }
        log.Println("Calling Next()")
        c.Next()
}
func rateLimit(c *gin.Context) {
        // this function runs regardless of if the `serveStatic` func called `c.Next()` or not
        log.Println("Rate limit middleware")
}
```

## Expectations

```
$ ./main
# request the site, condition is true
Some condition, not proceeding
```

## Actual result

```
$ ./main
# request the site, condition is true
Some condition, not proceeding
Rate limit middleware
```

## Environment

- go version: `go version go1.13.6 linux/amd64`
- gin version (or commit ref): 07c0f05
- operating system: Ubuntu 19.10 eoan
Implement YAML support for negotiation (see #2157)
suggest new feature: cli command scaffold.
like this:

```
gin new project
gin new model newmodel
gin new view newview

gin build
gin run
gin update
gin pack
....
```

refer to:
[kratos-tool](https://github.com/bilibili/kratos/blob/master/doc/wiki-cn/kratos-tool.md)
[bee](https://beego.me/docs/install/bee.md)
[fay](https://github.com/henrylee2cn/fay)



## Description

<!-- Description of a problem -->
Gin broke my go.mod, after go get i have this error :
go: github.com/gin-gonic/gin@v1.5.0: reading github.com/gin-gonic/gin/go.mod at revision v1.5.0: unknown revision v1.5.0



## How to reproduce
go get -u github.com/gin-gonic/gin
<!-- The smallest possible code example to show the problem that can be compiled, like -->
my go.mod
```
go 1.13

require (
	github.com/gin-gonic/gin v1.5.0 // indirect
	github.com/go-kit/kit v0.9.0
	github.com/go-pg/pg/v9 v9.1.1
	github.com/go-playground/universal-translator v0.17.0 // indirect
	github.com/json-iterator/go v1.1.9 // indirect
	github.com/leodido/go-urn v1.2.0 // indirect
	github.com/mattn/go-isatty v0.0.12 // indirect
	github.com/modern-go/concurrent v0.0.0-20180306012644-bacd9c7ef1dd // indirect
	github.com/modern-go/reflect2 v1.0.1 // indirect
	github.com/sirupsen/logrus v1.4.2
	golang.org/x/net v0.0.0-20191209160850-c0dbc17a3553
	golang.org/x/sys v0.0.0-20200122134326-e047566fdf82 // indirect
	gopkg.in/go-playground/validator.v9 v9.31.0 // indirect
	gopkg.in/yaml.v2 v2.2.7 // indirect
)
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
40 times faster
```

## Actual result
go: github.com/gin-gonic/gin@v1.5.0: reading github.com/gin-gonic/gin/go.mod at revision v1.5.0: unknown revision v1.5.0

```

## Environment

- go version: go version go1.13.6 linux/amd64
- gin version (or commit ref):
lastest
- operating system:
Windows amd64 (wsl ubuntu)

fix #2214 
Suggest:
- Turn off Pop-up prompt of accept incoming network connections on mac os.
- Allow apps to communicate through windows defender firewall as default.
See: 

https://github.com/mattn/go-isatty/releases/tag/v0.0.11
https://github.com/json-iterator/go/releases/tag/v1.1.9
Hello

It seems you have made a breaking change 4 hours ago (our CI broke)

In source file, SetCookie expects 8 parameters
https://github.com/gin-gonic/gin/blob/master/context.go#L778

In the README, SetCookie expects 7 parameters
https://github.com/gin-gonic/gin/blob/master/README.md
```go
c.SetCookie("gin_cookie", "test", 3600, "/", "localhost", false, true)
```

On the CI
```
... not enough arguments in call to c.SetCookie
	have (string, string, number, string, string, bool, bool)
	want (string, string, int, string, string, http.SameSite, bool, bool)
```

Could you please update the README so that it is consistent with the source code? Otherwise, it is hard to find out where the problem comes from, and which one is the good prototype :-)

From commit f94406a087079bfa5a924cc8095ba753160e885c

Best
The badge uses a service I developed to provide the number of err checks in the code. It provides no real value, it has no practical use.

Make the constant `stackBufSize` local since the go compiler will replace any occurrence with the const value and it only applies to the `cleanPath` function. 

Also to correct the last wrong sync by me and sync code with httprouter again:
https://github.com/julienschmidt/httprouter/blob/master/path.go#L22
## Description
RedirectTrailingSlash not working if there are more than two child route.

## How to reproduce
```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.New()
        router := g.Group("/v1")
	router.GET("/hello", dummyFunction)
        router.GET("/hello/a", dummyFunction)
        router.GET("/hello/b", dummyFunction)
	g.Run(":9000")
}
```

## Expectations
```
$ curl http://localhost:8201/hello/ should redirect [301] to {{URL}}/hello 
```
## Actual result
Getting 404

The same works if there is only one child /hello/a 
## Environment

- go version: go version go1.13.3 linux/amd64
- gin version (or commit ref):  v1.5.0
- operating system: ubuntu 16.04

V10 now uses a different package path. More at https://github.com/go-playground/validator/releases/tag/v10.0.0


## Description

context.JSON() adds a new line character \n to end of JSON response

## How to reproduce

Clone [this repo](https://github.com/kishaningithub/gin-newline) and run 

```bash
$ GIN_MODE=release go run gin-newline.go
```

## Expectations

Newline character ("\n") must not get added to the end of `{"message":"hello world"}`

## Actual result

new line character gets added

## Environment

- go version: 1.13.5
- gin version (or commit ref): v1.5.0
- operating system: mac os

Validator dropped support for version numbers in the import statement, so it is currently impossible to use gin:

```
../../../gin-gonic/gin/binding/default_validator.go:11:2: cannot find package "github.com/go-playground/validator/v10" in any of:
	/usr/local/go/src/github.com/go-playground/validator/v10 (from $GOROOT)
	/Users/james/go/src/github.com/go-playground/validator/v10 (from $GOPATH)
```

The "/v10" suffix needs to be dropped.
 Use log Middleware  ioutil.ReadAll(c.Copy().Request.Body). Cause is c.ShouldBindJSON(&sup) err=EOF. I use c.copy() does not work.
code:
func Middleware() gin.HandlerFunc {
	return func(c *gin.Context) {
		reqUri := c.Request.RequestURI
		clientIP := c.ClientIP()
		result, _ := ioutil.ReadAll(c.Copy().Request.Body)
		body := string(result)
		utils_tools.AppLogger.Info("uri:" + reqUri + "ip:" + clientIP + "body:" + body)
		c.Next()
	}
}


Benchmark:
```
BenchmarkBytesConvBytesToStrRaw-4   	21003800	        70.9 ns/op	      96 B/op	       1 allocs/op
BenchmarkBytesConvBytesToStr-4      	1000000000	         0.333 ns/op	       0 B/op	       0 allocs/op
BenchmarkBytesConvStrToBytesRaw-4   	18478059	        59.3 ns/op	      96 B/op	       1 allocs/op
BenchmarkBytesConvStrToBytes-4      	1000000000	         0.373 ns/op	       0 B/op	       0 allocs/op
```


<!--
Please answer these questions before submitting your issue. Thanks!
For questions please use one of our forums: https://github.com/golang/go/wiki/Questions
-->

### What version of Go are you using (`go version`)?

<pre>
$ go version
go version go1.13.5 linux/amd64
</pre>

### Does this issue reproduce with the latest release?
Yes


### What operating system and processor architecture are you using (`go env`)?

<details><summary><code>go env</code> Output</summary><br><pre>
$ go env
GO111MODULE=""
GOARCH="amd64"
GOBIN=""
GOCACHE="/home/tiagocardoso/.cache/go-build"
GOENV="/home/tiagocardoso/.config/go/env"
GOEXE=""
GOFLAGS=""
GOHOSTARCH="amd64"
GOHOSTOS="linux"
GONOPROXY=""
GONOSUMDB=""
GOOS="linux"
GOPATH="/home/tiagocardoso/Code/local-environment/go"
GOPRIVATE=""
GOPROXY="https://proxy.golang.org,direct"
GOROOT="/usr/local/go"
GOSUMDB="sum.golang.org"
GOTMPDIR=""
GOTOOLDIR="/usr/local/go/pkg/tool/linux_amd64"
GCCGO="gccgo"
AR="ar"
CC="gcc"
CXX="g++"
CGO_ENABLED="1"
GOMOD="/home/tiagocardoso/Code/local-environment/test-json/go.mod"
CGO_CFLAGS="-g -O2"
CGO_CPPFLAGS=""
CGO_CXXFLAGS="-g -O2"
CGO_FFLAGS="-g -O2"
CGO_LDFLAGS="-g -O2"
PKG_CONFIG="pkg-config"
GOGCCFLAGS="-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build214163253=/tmp/go-build -gno-record-gcc-switches"
</pre></details>

### What did you do?
```golang
package main

import (
	"fmt"
	"log"
	"os"

	"github.com/gin-gonic/contrib/static"
	"github.com/gin-gonic/gin"
)

// Foo -
func Foo(c *gin.Context) {
	c.AbortWithStatus(200)
}

func main() {

	router := gin.Default()
	router.Use(static.Serve("/", static.LocalFile("/app/public", false)))
	
	router.GET("/", Foo)

	log.Println("App is now running")

	if err := router.Run(fmt.Sprintf(":%s", "8200")); err != nil {
		log.Fatal("Failed to run the application")
	}
}
```
I'm serving a version.json which is located under public folder

### What did you expect to see?

The Content-Type using Docker image golang:1.13.5-alpine from version.json  is: text/plain; charset=utf-8

The Content-Type using Docker image golang:1.13.5 from version.json is: application/json

### What did you see instead?

The Content-Type using Docker image golang:1.13.5-alpine from version.json  should be: application/json instead of text/plain; charset=utf-8

The Content-Type using Docker image golang:1.13.5 from version.json is: application/json which is correct


I'm I missing something?

Hi,

how can I add a middleware when serving static files?
I need it for authorization. Only some authenticated users are allowed to see certain directories.
I tried it with 
```
repoRoutes := router.Group("/repo")
repoRoutes.Static("/", os.Getenv("REPOPATH")) 
repoRoutes.Use(restrictRepoAccess())
``` 
or 
```
repoRoutes := router.Group("/repo", restrictRepoAccess())
repoRoutes.Static("/", os.Getenv("GDC_ARCHIVEPATH")) 
```
but it does not work.
Many thanks in advance.


- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

<!-- Description of a problem -->
I used a structure, and the type of a field is itself. When I upload form data and receive it with shoudbind, the stack overflows. Please use the following code to reproduce. I hope to solve this problem. Thank you
## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)
//post form-data a
func main() {
	r := gin.Default()
	r.POST("/test", TestShoudbind)
	r.Run(":8080")
}

func TestShoudbind(c *gin.Context){
	a := A{}
	c.ShouldBind(&a)
	c.JSON(200,a)
}

type A struct {
	B string `form:"b" json:"b"`
	L *A     `json:"l"`
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
postman 
post http://localhost:8080/test
form-data
b test111
```
json:{"b":"test111","l":nil}
## Actual result

<!-- Actual result showing the problem -->
```
postman 
post http://localhost:8080/test
form-data
b test111

runtime: goroutine stack exceeds 1000000000-byte limit
fatal error: stack overflow
```

## Environment

- go version:1.3.5
- gin version (or commit ref):1.4.0
- operating system:macos10.15.2




- With issues:


## Description

https://github.com/gin-gonic/gin/pull/1836 
This PR fix the issue partially, with brokenpipe case, the entire httpReques containing the user credentials is still being logged as error. 

## How to reproduce
Client cancel a downloading request will lead to broken pipe panic, and the RecoveryWithWriter method will log it as errors including the entire http request which contains sensitive user info like Authorization token etc.

## Expectations
No logging of sensitive user data in the log.


## Actual result
Logs contain sensitive user data when encounter broken pipe failure.

## Environment

- go version: go1.13.4
- gin version (or commit ref): v.1.5.0
- operating system: Linux

Hi
are there any way to cache assets files in gin?
I want to serve assets files from memory to fast up server responding. (because i think it's faster if I read files from RAM instead HDD.)
Is it a good idea?
If it was , should i use redis or i must implement my own code to do this?

I hope anyone say to me: " gin do that , you don't need implement it :-) "
## Description

I'm working on migrating from 1.3.0 to 1.4.0 (or 1.5.0) and I've discovered that 1.3.0 for the following snippet

```
router := gin.New()
router.GET("/func/:id/details", func(c *gin.Context) {
    value := c.Param("id")
    fmt.Printf("value is %v\n", value)
})
```

Would always get to the handler even when requesting `/func//details` (note the missing URL param) whereas `1.4.0` and above will return `404`.

Is it possible to control this behavior? (to work the same way as it worked in `1.3.0`?)

## How to reproduce

Start below router

```
router := gin.New()
router.GET("/func/:id/details", func(c *gin.Context) {
    value := c.Param("id")
    fmt.Printf("value is %v\n", value)
})
router.Run("localhost:8080")
```

And make the following request with `curl`

    curl -i localhost:8080/func//details

## Expectations

`HTTP 200` (get inside the handler)

## Actual result

`HTTP 404`

## Environment

- go version: 1.13.5
- gin version (or commit ref): `1.3.0`
- operating system: Mac os 10.15.2




I want to change value of query string from Middleware
```
$ curl http://localhost:8201/?test=1
```

```
 _ = c.Query("test")
params, _ := url.ParseQuery(c.Request.URL.RawQuery)
test:= params.Get("test") 
fmt.Println(test) //output 1

params.Set("test","2")
c.Request.URL.RawQuery = params.Encode()
fmt.Println(c.Query("test")) //output 1

```
how to reset queryCache?

## Environment

- go version:
- gin version (or commit ref): 1.5
- operating system:

This issue has been discussed here #1452, here #1690, here #1736, here #2029, in my opinion, wether current behavior will be changed or not, current documentation doesn't match with real behavior, so it (documentation) has to be changed.
This is my view of what it should look like.
I have two path:

1. /v1a:com
2./v1:coms

When i start the server, i get the panic :

- "panic: path segment 'a:com' conflicts with existing wildcard ':com' in path '/v1a:com'"

why? the ":", in my case , does not mean a wildcard. Is that reasonable？

support usage followed:

```golang
type StructExample struct {
    A string `json:"a" form:"a" binding"required,max=16"`
}

func exampleHandler(c *gin.Context) {
    var data []StructExample

    if c.Bind(&data) != nil {
        return
    }
    c.JSON(http.StatusOK, data)
}
```

## Description
As the [document](https://golang.google.cn/doc/diagnostics.html) said, we need to profile the cpu and memory of a service periodically to make diagnose easy.

## Expectations
Gin provide an option to turn on the periodical profiling and config the detail.



## Description

After seeing all of related issues and source code, i know it is illegal that a path has multiple catch-all node.  so
#### In way a:
```
r.GET("/cmd/:user/*info/*action", func(c *gin.Context) {
		fmt.Println("enter /cmd/:user/*info/*action")
})
```

#### Result:
It will throw a error saying "catch-all routes are only allowed at the end of the path in path '/cmd/:user/*info/*action'".

#### In way b:

```
r.GET("/cmd/:user/*info", func(c *gin.Context) {
		fmt.Println("enter /cmd/:name/*info")
})

r.GET("/cmd/:user/*info/*action", func(c *gin.Context) {
                fmt.Println("enter /cmd/:user/*info/*action")
})

```
#### Reuslt:
It work successfully.


## How to reproduce

```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	r := gin.Default()

	r.GET("/cmd/:user/*info", func(c *gin.Context) {
               fmt.Println("enter /cmd/:name/*info")
	})

	r.GET("/cmd/:user/*info/*action", func(c *gin.Context) {
		fmt.Println("enter /cmd/:name/*info/*action")
	})

	r.GET("/cmd/:user/*info/*action/*test", func(c *gin.Context) {
		fmt.Println("enter /cmd/:name/*info/*action/*test")
	})
	
	r.Run(":8080")
}
```

## Expectations

get a error in terminal like way a.

## Actual result

<!-- Actual result showing the problem -->

```
[GIN-debug] GET    /cmd/:user/*info          --> main.main.func1 (3 handlers)
[GIN-debug] GET    /cmd/:user/*info/*action  --> main.main.func2 (3 handlers)
[GIN-debug] GET    /cmd/:user/*info/*action/*test --> main.main.func3 (3 handlers)
[GIN-debug] Listening and serving HTTP on :8080
```
run successfully with gin.

## Environment

- go version: go1.13.4 
- gin version (or commit ref): v1.5.0
- operating system: windows/amd64

## Description

I wrote a timeout middleware, but when I request http://localhost:9000/hello 
repeatedly, normally it should always return "timeout", but sametimes it return "Hellotimeout".

I see the source code, in ServeHTTP `context` is from the `engine.pool`, in my code when the request is timeout the `context` will be put into the engine.pool, but it is still used by `hello` , so when next time the `context` got from `engine.pool`, actually it is the same one with the context in `hello`
``` golang
// ServeHTTP conforms to the http.Handler interface.
func (engine *Engine) ServeHTTP(w http.ResponseWriter, req *http.Request) {
	c := engine.pool.Get().(*Context)
	c.writermem.reset(w)
	c.Request = req
	c.reset()

	engine.handleHTTPRequest(c)

	engine.pool.Put(c)
}
```
so I want to know how to write `context` in the hello goroutine safely, even if the request is timeout

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```golang
package main

import (
	"net/http"
	"time"

	"github.com/gin-gonic/gin"
)

type TimeoutHandler struct {
	ctx *gin.Context
}

func (h *TimeoutHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {
	h.ctx.Next()
}

func main() {
	g := gin.New()
	g.Use(func(ctx *gin.Context) {
		h := &TimeoutHandler{ctx: ctx}
		handler := http.TimeoutHandler(
			h,
			500*time.Millisecond,
			"timeout",
		)
		handler.ServeHTTP(ctx.Writer, ctx.Request)
	})
	g.GET("/hello", func(c *gin.Context) {
                q := c.Query("q")
		time.Sleep(1 * time.Second)
		c.String(200, "Hello-"+ q+"-")
	})
	g.Run(":9000")
}
```
$ hello.sh
``` bash
#!/bin/bash
url=http://localhost:9000/hello
i=0
while [[ $i -lt 10 ]]
do
curl  ${url}"?q="${i}
echo ""
i=$(($i+1));
done
```
## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ bash hello.sh
timeout
timeout
timeout
timeout
timeout
timeout
timeout
timeout
timeout
timeout
```

## Actual result

<!-- Actual result showing the problem -->
```
$ bash hello.sh
timeout
timeout
Hello-1-timeout
Hello-2-timeout
Hello-3-timeout
Hello-4-timeout
timeout
Hello-6-timeout
Hello-7-timeout
timeout
```
```
$ bash hello.sh
timeout
timeout
Hello-1-timeout
timeout
Hello-3-timeout
timeout
Hello-5-timeout
Hello-6-timeout
Hello-7-timeout
Hello-8-timeout
```
## Environment

- go version: go version go1.12.7 linux/amd64
- gin version (or commit ref): v1.5.0
- operating system: Linux node 3.10.0-957.21.3.el7.x86_64 #1 SMP Tue Jun 18 16:35:19 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux

Passed my manual test, output nothing different.


Just update the go-validator version in README to v10.
Excuse me, I forgot change output in #2186 


Router `r.GET("/admin:MODE", HandleAdmin)`
Hander `mode := c.Param("MODE")`

HTTP GET `http://127.0.0.1:8088/v2d0/admin:offline`
Result `mode = ":offline"` 
is BUG?
- Update fixed code.
- Fix incorrect date for testing & demo.


## Description

the Bind() function seems can not parse "+" correctly into string.
## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main


package main

import (
	"github.com/gin-gonic/gin"
)
type MyData struct {
	Str string `form:"str"`
}

func main() {
	r := gin.Default()
	r.GET("/", func(c *gin.Context) {
		var data MyData
		err:=c.Bind(&data)
		if err != nil{
			panic(err)
		}
		c.JSON(200, gin.H{
			"data":data,
		})
	})
	r.Run() // listen and serve on 0.0.0.0:8080 (for windows "localhost:8080")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl localhost:8080/?str=1+1-1+1
{"data":{"Str":"1+1-1+1"}}
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl localhost:8080/?str=1+1-1+1
{"data":{"Str":"1 1-1 1"}}
```

## Environment

- go version:1.13
- gin version (or commit ref):1.5.0
- operating system:MacOS


## Description
Writing to log file failed.
I use the following code to open gin log setting:
```
f, err := os.Create("./logs/log.log")
	if err != nil {
		log.Error("Open Log File Failed", err)
	}
	gin.DefaultWriter = io.MultiWriter(f, os.Stdout)
	log.Info("Init Gin log set ")
```
## How to reproduce

```
f, err := os.Create("./logs/log.log")
	if err != nil {
		log.Error("Open Log File Failed", err)
	}
	gin.DefaultWriter = io.MultiWriter(f, os.Stdout)
	log.Info("Init Gin log set ")
```

```
package main

import (
	"github.com/gin-gonic/gin"
       "os"
       "io"
       "log"
)

func main() {
	g := gin.Default()
       f, err := os.Create("./logs/log.log")
	if err != nil {
		log.Error("Open Log File Failed", err)
	}
	gin.DefaultWriter = io.MultiWriter(f, os.Stdout)
	log.Info("Init Gin log set ")
```
	g.GET("/hello/:name", func(c *gin.Context) {
		c.String(200, "Hello %s", c.Param("name"))
	})
	g.Run(":9000")
}
```

## Expectations
The log will wirte into `./logs/log.log`

## Actual result
In ` ./logs/log.log`  not found the logs.

## Environment

- go version: 1.13
- gin version (or commit ref): 1.15
- operating system: mac os

Make Context.Value, Context.Get, and Context.Set methods concurrent safe, to be consistent with Go's context.Context.
Make Context.Value, Context.Get, and Context.Set methods concurrent safe, to be consistent with Go's context.Context.
Make Context.Value, Context.Get, and Context.Set methods concurrent safe, to be consistent with Go's context.Context.
Make Context.Value, Context.Get, Context.Set methods concurrent safe, to be consistent with Go's context.Context.
Signed-off-by: Andy Pan <panjf2000@gmail.com>

## Description
 Are there a possibility to bind post form values from array of objects using gin?

## How to reproduce
I have post form like 
```
<input type="text" name="class">
<!-- first student -->
<input type="text" name="students[][first]">
<input type="text" name="students[][last]">
<input type="text" name="students[][age]">

<!-- second student -->
<input type="text" name="students[][first]">
<input type="text" name="students[][last]">
<input type="text" name="students[][age]">
```
And go code 
```
type Student struct {
	First string `form:"first"`
	Last  string `form:"last"`
	Age   int    `form:"age"`
}
type Class struct {
	Class    string    `form:"class"`
	Students []Student `form:"students[]"`
}
func Handle(c *gin.Context) {
	err := c.Request.ParseForm()
	if err != nil {
		log.Fatal(err)
	}
	class:= new(Class)

	err = c.Bind(class)
	if err != nil {
		log.Fatal(err)
	}
	log.Println(c.Request.PostForm)
	log.Println(class)
}
```
I receive next output
```
map[students[][first]:[John Jack] students[][last]:[Johny Jacky] students[][age]:[20 30] class:[myclass]]
&{myclass []}
```
But I expect to receive array of structs Student and get output like
```
&{myclass [{John Johny 20} {Jack Jacky 30}]} 
```
How is it possible to do it?
## Environment

- go version: go version go1.12.7 linux/amd64
- gin version (or commit ref): v1.4.0
- operating system: Ubuntu 16.10

Similar issue
https://github.com/gin-gonic/gin/issues/1523


go get github.com/go-playground/validator/v10

i don't like v9
- With pull requests:
  - Open your pull request against `master`
`Yes`
  - Your pull request should have no more than two commits, if not you should squash them.
`Yes`
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.

Because of using the IDE `goland` will generate a folder `.idea` so add it to .gitignore.

There are several items in tag v1.5.0 release notes tagged as "Break-Backward".

Per the Go compatibility promise and module versioning standards, I feel this release should have been made as a v2.

Not trying to start a fight here, just want to have the discussion -- why wasn't this done?

from httprouter: https://github.com/julienschmidt/httprouter/commit/bbffb24dcda5ec5bd9a53bf843516e59cb4d2178


from httprouter:
https://github.com/julienschmidt/httprouter/commit/e746cd609a26ce7237331c6edd57fc455462095e
https://github.com/julienschmidt/httprouter/commit/6289311caafefac132cb3583bdd8d85580c0aecc


from: https://github.com/julienschmidt/httprouter/commit/b9a36063a10f224c4ae2596f12964d9e59443515#diff-37cf0fd7a164303538a2d22d965646df
## Description

I have the param struct like this:

```
type Param1 struct {
	Timestamp time.Time `json:"Timestamp" binding:"required" time_format:"2006-01-02 15:04:05"`
}

type Param2 struct {
	Timestamp time.Time `json:"Timestamp" binding:"required" time_format:"unix"`
}
```

request json for Param1:
```
{
    "Timestamp": "2001-11-11 11:11:11"
}
```

response error:
```
parsing time \"\"2001-11-11 11:11:11\"\" as \"\"2006-01-02T15:04:05Z07:00\"\": cannot parse \" 11:11:11\"\" as \"T\"]
```

request json for Param2:
```
{
     "Timestamp": 1575528300
}
```

response error:
```
parsing time \"1575528300\" as \"\"2006-01-02T15:04:05Z07:00\"\": cannot parse \"1575528300\" as \"\"\"]
```

## Environment

- go version: 1.13
- gin version (or commit ref): 1.5.0
- operating system: macOS 

Here is the code that can report an error
```go
package main

import (
	"fmt"
	"github.com/gin-gonic/gin"
	"io"
	"net/http"
	"os"
	"time"
)

type header struct {
	Duration   time.Duration `header:"duration"`
	CreateTime time.Time     `header:"createTime" time_format:"unix"`
}

func needFix1() {
	g := gin.Default()
	g.GET("/", func(c *gin.Context) {
		h := header{}
		err := c.ShouldBindHeader(&h)
		if err != nil {
			c.JSON(500, fmt.Sprintf("fail:%s\n", err))
			return
		}

		c.JSON(200, h)
	})

	g.Run(":8081")
}

func needFix2() {
	g := gin.Default()
	g.GET("/", func(c *gin.Context) {
		h := header{}
		err := c.ShouldBindHeader(&h)
		if err != nil {
			c.JSON(500, fmt.Sprintf("fail:%s\n", err))
			return
		}

		c.JSON(200, h)
	})

	g.Run(":8082")
}

func sendNeedFix1() {
	// send to needFix1
	sendBadData("http://127.0.0.1:8081", "duration")
}

func sendNeedFix2() {
	// send to needFix2
	sendBadData("http://127.0.0.1:8082", "createTime")
}

func sendBadData(url, key string) {
	req, err := http.NewRequest("GET", "http://127.0.0.1:8081", nil)
	if err != nil {
		fmt.Printf("err:%s\n", err)
		return
	}

	// Only the key and no value can cause an error
	req.Header.Add(key, "")
	rsp, err := http.DefaultClient.Do(req)
	if err != nil {
		return
	}
	io.Copy(os.Stdout, rsp.Body)
	rsp.Body.Close()
}

func main() {
	go needFix1()
	go needFix2()

	time.Sleep(time.Second / 1000 * 200) // 200ms
	sendNeedFix1()
	sendNeedFix2()
}

```


gin输出日志不能正常显示颜色

[GIN] 2019/12/05 - 21:41:08 |?[97;42m 200 ?[0m|      1.9874ms |       127.0.0.1 |?[97;44m GET     ?[0m /
I know in the validator.v9,it has the function of [Translations & Custom Errors](https://github.com/go-playground/validator/blob/master/_examples/translations/main.go)

now I see gin v1.5.0 has upgraded validator to v9, but I didn't find out some examples about 
Translations & Custom Errors in gin.

can anyone help me,thanks in advance.









## Environment
- go version: 1.13
- gin version (or commit ref): v1.5.0
- operating system: win10

sync httprouter:
https://github.com/julienschmidt/httprouter/pull/261

Add Dkron as user of Gin in the README


Hi,I wonder if gin supports custom request method groups? 
such as Python Flask 
```
@app.route('/login/',methods=['POST','GET'])
```
or PHP Slim

```
<?php
$app = new \Slim\Slim();
$app->map('/foo/bar', function() {
    echo "I respond to multiple HTTP methods!";
})->via('GET', 'POST');
$app->run();
```

Thanks.
the pr includes three parts:
1. use `longestCommonPrefix`  from https://github.com/julienschmidt/httprouter/blob/master/tree.go#L20
2. remove `else` statement to reduce indent
3. sync the issue fixed https://github.com/julienschmidt/httprouter/issues/172

after:
```
➜  go-http-routing-benchmark git:(master) go test -bench=Gin
#GithubAPI Routes: 203
   Gin: 58512 Bytes

#GPlusAPI Routes: 13
   Gin: 4384 Bytes

#ParseAPI Routes: 26
   Gin: 7776 Bytes

#Static Routes: 157
   Gin: 34936 Bytes

goos: darwin
goarch: amd64
pkg: github.com/julienschmidt/go-http-routing-benchmark
BenchmarkGin_Param        	12134269	       100 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param5       	 6822183	       173 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param20      	 2442889	       479 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParamWrite   	 6708414	       168 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubStatic 	 9077402	       118 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubParam  	 5660514	       203 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubAll    	   26366	     43260 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusStatic  	13235361	        83.2 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusParam   	 9402622	       127 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlus2Params 	 6166275	       183 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusAll     	  577646	      1866 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseStatic  	12644926	        86.3 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseParam   	11198742	        99.0 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Parse2Params 	 9181192	       127 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseAll     	  319550	      3366 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_StaticAll    	   40864	     26833 ns/op	       0 B/op	       0 allocs/op
PASS
ok  	github.com/julienschmidt/go-http-routing-benchmark	22.169s
```

before:
```
➜  go-http-routing-benchmark git:(master) go test -bench=Gin
#GithubAPI Routes: 203
   Gin: 58512 Bytes

#GPlusAPI Routes: 13
   Gin: 4384 Bytes

#ParseAPI Routes: 26
   Gin: 7776 Bytes

#Static Routes: 157
   Gin: 34936 Bytes

goos: darwin
goarch: amd64
pkg: github.com/julienschmidt/go-http-routing-benchmark
BenchmarkGin_Param        	10962327	       104 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param5       	 6442416	       179 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param20      	 2381566	       523 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParamWrite   	 6295077	       173 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubStatic 	 9231175	       130 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubParam  	 4975027	       219 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubAll    	   24982	     47799 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusStatic  	12289202	        96.7 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusParam   	 9156241	       138 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlus2Params 	 5860107	       210 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusAll     	  552486	      2111 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseStatic  	11597578	       105 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseParam   	 9847570	       113 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Parse2Params 	 7823059	       142 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseAll     	  290121	      3575 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_StaticAll    	   41952	     28302 ns/op	       0 B/op	       0 allocs/op
PASS
ok  	github.com/julienschmidt/go-http-routing-benchmark	22.864s
```
- [ ] support go1.11.x
- [ ] support go1.12.x
- [ ] support go1.13.x
- [ ] support go master
- [ ] coverage
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

Getting new gin version using go is failing

## How to reproduce

>  $ go get github.com/gin-gonic/gin
package github.com/go-playground/validator/v10: cannot find package "github.com/go-playground/validator/v10" in any of:
/usr/local/go/src/github.com/go-playground/validator/v10 (from $GOROOT)
/Users/dipeshprajapati/Workspace/go/src/github.com/go-playground/validator/v10 (from $GOPATH)
$

## Expectations

Should be able to get Master version without any error

## Actual result

> >  $ go get github.com/gin-gonic/gin
package github.com/go-playground/validator/v10: cannot find package "github.com/go-playground/validator/v10" in any of:
/usr/local/go/src/github.com/go-playground/validator/v10 (from $GOROOT)
/Users/dipeshprajapati/Workspace/go/src/github.com/go-playground/validator/v10 (from $GOPATH)
$

## Environment

- go version: 1.9
- gin version (or commit ref): Master
- operating system: Mac OS

## Description

just upgraded from v1.4.0 to v1.5.0 and end up with internal server error on tag `binding:"exists"`

## How to reproduce


```
package main

import (
	"github.com/gin-gonic/gin"
)

type User struct {
	FirstName *string `json:"fn" binding:"exists"` 
}

	
func main(){
	router := gin.Default()
	router.POST("/register", func(c *gin.Context) {
		var user User
		if err := c.BindJSON(&user); err != nil {
			c.AbortWithStatusJSON(http.StatusBadRequest, gin.H{
		            "error": "first name cannot be empty",
	               })
			return
		}
	})

	router.Run(":8080")
}	
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
return 400 with error message only if field FirstName is empty otherwise 200
```
## Actual result


```
2019/11/29 11:44:13 [Recovery] 2019/11/29 - 11:44:13 panic recovered:
Undefined validation function 'exists' on field 'FirstName'
/home/atif/go/src/github.com/go-playground/validator/cache.go:289 (0x7526b5)
        (*Validate).parseFieldTagsRecursive: panic(strings.TrimSpace(fmt.Sprintf(undefinedValidation, current.tag, fieldName)))
/home/atif/go/src/github.com/go-playground/validator/cache.go:150 (0x751319)
        (*Validate).extractStructCache: ctag, _ = v.parseFieldTagsRecursive(tag, fld.Name, "", false)
/home/atif/go/src/github.com/go-playground/validator/validator.go:37 (0x7577bd)
        (*validate).validateStruct: cs = v.v.extractStructCache(current, typ.Name())
/home/atif/go/src/github.com/go-playground/validator/validator_instance.go:304 (0x75d706)
        (*Validate).StructCtx: vd.validateStruct(ctx, top, val, val.Type(), vd.ns[0:0], vd.actualNs[0:0], nil)
/home/atif/go/src/github.com/go-playground/validator/validator_instance.go:277 (0x8eb6ed)
        (*Validate).Struct: return v.StructCtx(context.Background(), s)
/home/atif/go/src/github.com/gin-gonic/gin/binding/default_validator.go:30 (0x8eb6b7)
        (*defaultValidator).ValidateStruct: if err := v.validate.Struct(obj); err != nil {
/home/atif/go/src/github.com/gin-gonic/gin/binding/binding.go:113 (0x8ef50c)
        validate: return Validator.ValidateStruct(obj)
/home/atif/go/src/github.com/gin-gonic/gin/binding/json.go:55 (0x8ef4c3)
        decodeJSON: return validate(obj)
/home/atif/go/src/github.com/gin-gonic/gin/binding/json.go:37 (0x8ef337)
        jsonBinding.Bind: return decodeJSON(req.Body, obj)
/home/atif/go/src/github.com/gin-gonic/gin/context.go:660 (0x8fc007)
        (*Context).ShouldBindWith: return b.Bind(c.Request, obj)
/home/atif/go/src/github.com/gin-gonic/gin/context.go:603 (0x8fbfd1)
        (*Context).MustBindWith: if err := c.ShouldBindWith(obj, b); err != nil {
/home/atif/go/src/github.com/gin-gonic/gin/context.go:566 (0xba6269)
        (*Context).BindJSON: return c.MustBindWith(obj, binding.JSON)
/home/atif/go/src/gitlab.com/atif/project/handlers/user.go:32 (0xba622f)
        (*Server).RegisterUser: if err := c.BindJSON(&u); err != nil {
/home/atif/go/src/github.com/gin-gonic/gin/context.go:147 (0x8f9859)
        (*Context).Next: c.handlers[c.index](c)
/home/atif/go/src/gitlab.com/atif/project/middlewares/auth.go:32 (0xbb6963)
        Auth.func1: c.Next()
/home/atif/go/src/github.com/gin-gonic/gin/context.go:147 (0x8f9859)
        (*Context).Next: c.handlers[c.index](c)
/home/atif/go/src/github.com/gin-gonic/gin/recovery.go:83 (0x90d179)
        RecoveryWithWriter.func1: c.Next()
/home/atif/go/src/github.com/gin-gonic/gin/context.go:147 (0x8f9859)
        (*Context).Next: c.handlers[c.index](c)
/home/atif/go/src/github.com/gin-gonic/gin/logger.go:241 (0x90c2a0)
        LoggerWithConfig.func1: c.Next()
/home/atif/go/src/github.com/gin-gonic/gin/context.go:147 (0x8f9859)
        (*Context).Next: c.handlers[c.index](c)
/home/atif/go/src/github.com/gin-gonic/gin/gin.go:411 (0x90381c)
        (*Engine).handleHTTPRequest: c.Next()
/home/atif/go/src/github.com/gin-gonic/gin/gin.go:369 (0x902f1d)
        (*Engine).ServeHTTP: engine.handleHTTPRequest(c)
/usr/local/go/src/net/http/server.go:2774 (0x6cf5f7)
        serverHandler.ServeHTTP: handler.ServeHTTP(rw, req)
/usr/local/go/src/net/http/server.go:1878 (0x6cb1e0)
        (*conn).serve: serverHandler{c.server}.ServeHTTP(w, w.req)
/usr/local/go/src/runtime/asm_amd64.s:1337 (0x45f010)
        goexit: BYTE    $0x90   // NOP

```

## Environment

- go version: go1.12.6
- gin version (or commit ref): v1.5.0
- operating system:	linux/amd64

See the detailed benchmark: https://github.com/gin-gonic/gin/pull/2153

before:

```
#GithubAPI Routes: 203
   Gin: 58512 Bytes

#GPlusAPI Routes: 13
   Gin: 4384 Bytes

#ParseAPI Routes: 26
   Gin: 7776 Bytes

#Static Routes: 157
   Gin: 34936 Bytes

goos: darwin
goarch: amd64
pkg: github.com/julienschmidt/go-http-routing-benchmark
BenchmarkGin_Param        	11682692	       107 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param5       	 5853684	       205 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param20      	 2497855	       484 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParamWrite   	 6599636	       180 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubStatic 	 9790374	       125 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubParam  	 4965781	       244 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubAll    	   24424	     49748 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusStatic  	14304789	        86.4 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusParam   	 6814308	       174 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlus2Params 	 4847437	       253 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusAll     	  504351	      2302 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseStatic  	12430803	        99.0 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseParam   	10323856	       119 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Parse2Params 	 7512644	       159 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseAll     	  305469	      3961 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_StaticAll    	   37492	     30986 ns/op	       0 B/op	       0 allocs/op
PASS
ok  	github.com/julienschmidt/go-http-routing-benchmark	23.774s
```

after:

```
#GithubAPI Routes: 203
   Gin: 58512 Bytes

#GPlusAPI Routes: 13
   Gin: 4384 Bytes

#ParseAPI Routes: 26
   Gin: 7776 Bytes

#Static Routes: 157
   Gin: 34936 Bytes

goos: darwin
goarch: amd64
pkg: github.com/julienschmidt/go-http-routing-benchmark
BenchmarkGin_Param        	15443652	        78.9 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param5       	 9414763	       127 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param20      	 4002259	       298 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParamWrite   	 7826979	       151 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubStatic 	11584101	       103 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubParam  	 7606005	       158 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubAll    	   36332	     34051 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusStatic  	12782667	        79.5 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusParam   	12041554	       103 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlus2Params 	 9379024	       128 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusAll     	  813216	      1394 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseStatic  	15016789	        77.1 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseParam   	15004710	        82.2 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Parse2Params 	11183847	       109 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseAll     	  448926	      2553 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_StaticAll    	   51507	     23745 ns/op	       0 B/op	       0 allocs/op
PASS
ok  	github.com/julienschmidt/go-http-routing-benchmark	22.477s
```

ref issue: #1817 and #1644

cc @thinkerou @dmarkham @QianChenglong
- Should point in release notes that there was a change in WriteJSON, what is breaking backward

## Description
Bumping gin version to 1.5 has broken our tests. There is a difference in implementation in WriteJSON. Gin 1.5 uses `encoder := json.NewEncoder(w)` instead of `jsonBytes, err := json.Marshal(obj)`. This difference causes adding a new line at the end of the result object (because it's now an encoder), which is break-backward.

## Difference in code

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
func WriteJSON(w http.ResponseWriter, obj interface{}) error {
	writeContentType(w, jsonContentType)
	jsonBytes, err := json.Marshal(obj)
	if err != nil {
		return err
	}
	w.Write(jsonBytes)
	return nil
}

func WriteJSON(w http.ResponseWriter, obj interface{}) error {
	writeContentType(w, jsonContentType)
	encoder := json.NewEncoder(w)
	err := encoder.Encode(&obj)
	if err != nil {
		return err
	}
	return nil
}
```

## Tests previously

<!-- Your expectation result of 'curl' command, like -->
```
       assert.Equal(t, "{\"foo\":\"bar\",\"html\":\"\\u003cb\\u003e\"}", w.Body.String())
```

## Tests after updating gin version to 1.5

<!-- Your expectation result of 'curl' command, like -->
```
	assert.Equal(t, "{\"foo\":\"bar\",\"html\":\"\\u003cb\\u003e\"}\n", w.Body.String())
```

## Environment

- go version: 1.13
- gin version (or commit ref): 1.5
- operating system: windows

## Description
`Negotiate` function only support XML/HTML/JSON，but I need it to support YAML/Protobuf.
I think it should match the `binding.Default`:

https://github.com/gin-gonic/gin/blob/231ff00d1f77d30f8dd97278680d7731e1317d55/binding/binding.go#L86-L107


- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description

<!-- Description of a problem -->

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	g := gin.Default()
	g.GET("/hello/:name", func(c *gin.Context) {
		c.String(200, "Hello %s", c.Param("name"))
	})
	g.Run(":9000")
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl http://localhost:8201/hello/world
Hello world
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl -i http://localhost:8201/hello/world
<YOUR RESULT>
```

## Environment

- go version:
- gin version (or commit ref):
- operating system:

as title. See the result: https://gist.github.com/appleboy/b5f2ecfaf50824ae9c64dcfb9165ae5e

Note: Gin v1.5 vs Echo v4.1.11

```
#GithubAPI Routes: 203
   Echo: 96120 Bytes
   Gin: 58512 Bytes

#GPlusAPI Routes: 13
   Echo: 9480 Bytes
   Gin: 4384 Bytes

#ParseAPI Routes: 26
   Echo: 11232 Bytes
   Gin: 7776 Bytes

#Static Routes: 157
   Echo: 76584 Bytes
   Gin: 34936 Bytes

goos: linux
goarch: amd64
pkg: github.com/julienschmidt/go-http-routing-benchmark
BenchmarkEcho_Param              9278648               120 ns/op               0 B/op          0 allocs/op
BenchmarkGin_Param               8428953               133 ns/op               0 B/op          0 allocs/op
BenchmarkEcho_Param5             4399473               275 ns/op               0 B/op          0 allocs/op
BenchmarkGin_Param5              4324972               268 ns/op               0 B/op          0 allocs/op
BenchmarkEcho_Param20            1397379               856 ns/op               0 B/op          0 allocs/op
BenchmarkGin_Param20             1538476               758 ns/op               0 B/op          0 allocs/op
BenchmarkEcho_ParamWrite         4614039               249 ns/op               8 B/op          1 allocs/op
BenchmarkGin_ParamWrite          4803710               242 ns/op               0 B/op          0 allocs/op
BenchmarkEcho_GithubStatic       7636855               158 ns/op               0 B/op          0 allocs/op
BenchmarkGin_GithubStatic        6228295               191 ns/op               0 B/op          0 allocs/op
BenchmarkEcho_GithubParam        3394911               351 ns/op               0 B/op          0 allocs/op
BenchmarkGin_GithubParam         2769294               431 ns/op               0 B/op          0 allocs/op
BenchmarkEcho_GithubAll            16564             71683 ns/op               0 B/op          0 allocs/op
BenchmarkGin_GithubAll             15772             75950 ns/op               0 B/op          0 allocs/op
BenchmarkEcho_GPlusStatic       11168800               108 ns/op               0 B/op          0 allocs/op
BenchmarkGin_GPlusStatic         9502640               126 ns/op               0 B/op          0 allocs/op
BenchmarkEcho_GPlusParam         7206974               166 ns/op               0 B/op          0 allocs/op
BenchmarkGin_GPlusParam          5560232               216 ns/op               0 B/op          0 allocs/op
BenchmarkEcho_GPlus2Params       4614630               263 ns/op               0 B/op          0 allocs/op
BenchmarkGin_GPlus2Params        3454112               347 ns/op               0 B/op          0 allocs/op
BenchmarkEcho_GPlusAll            395882              3081 ns/op               0 B/op          0 allocs/op
BenchmarkGin_GPlusAll             346232              3429 ns/op               0 B/op          0 allocs/op
BenchmarkEcho_ParseStatic       10582897               114 ns/op               0 B/op          0 allocs/op
BenchmarkGin_ParseStatic         8852340               135 ns/op               0 B/op          0 allocs/op
BenchmarkEcho_ParseParam         8430432               140 ns/op               0 B/op          0 allocs/op
BenchmarkGin_ParseParam          7924248               152 ns/op               0 B/op          0 allocs/op
BenchmarkEcho_Parse2Params       6224000               192 ns/op               0 B/op          0 allocs/op
BenchmarkGin_Parse2Params        5547054               216 ns/op               0 B/op          0 allocs/op
BenchmarkEcho_ParseAll            245606              4918 ns/op               0 B/op          0 allocs/op
BenchmarkGin_ParseAll             202203              5917 ns/op               0 B/op          0 allocs/op
BenchmarkEcho_StaticAll            27416             43551 ns/op               0 B/op          0 allocs/op
BenchmarkGin_StaticAll             25944             46077 ns/op               0 B/op          0 allocs/op
PASS
ok      github.com/julienschmidt/go-http-routing-benchmark      48.964s
```

I found the root cause on this PR: https://github.com/gin-gonic/gin/pull/1817 and issue https://github.com/gin-gonic/gin/issues/1644

Using master commit and remove the PR #1817

```
#GithubAPI Routes: 203
   Echo: 100088 Bytes
   Gin: 58512 Bytes

#GPlusAPI Routes: 13
   Echo: 9688 Bytes
   Gin: 4384 Bytes

#ParseAPI Routes: 26
   Echo: 11664 Bytes
   Gin: 7776 Bytes

#Static Routes: 157
   Echo: 80328 Bytes
   Gin: 34936 Bytes

goos: darwin
goarch: amd64
pkg: github.com/julienschmidt/go-http-routing-benchmark
BenchmarkEcho_Param        	13713124	        92.9 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param         	14935894	        77.6 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_Param5       	 5711541	       211 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param5        	 9060136	       133 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_Param20      	 2175253	       577 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param20       	 3861374	       309 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_ParamWrite   	 6411573	       206 ns/op	       8 B/op	       1 allocs/op
BenchmarkGin_ParamWrite    	 7676670	       148 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GithubStatic 	10798402	       109 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubStatic  	12585895	        95.1 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GithubParam  	 5745453	       215 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubParam   	 7828753	       154 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GithubAll    	   29811	     41608 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubAll     	   37480	     32039 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GPlusStatic  	14638311	        83.1 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusStatic   	15855790	        74.9 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GPlusParam   	 9653083	       125 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusParam    	12116191	       101 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GPlus2Params 	 6289256	       189 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlus2Params  	 9207663	       131 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GPlusAll     	  656268	      1890 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusAll      	  950498	      1394 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_ParseStatic  	14030162	        86.8 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseStatic   	13807999	        83.9 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_ParseParam   	11691818	       102 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseParam    	13085680	        84.0 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_Parse2Params 	 8457060	       138 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Parse2Params  	12408178	        99.8 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_ParseAll     	  409405	      3041 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseAll      	  431499	      2619 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_StaticAll    	   43801	     26745 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_StaticAll     	   52173	     22331 ns/op	       0 B/op	       0 allocs/op
PASS
ok  	github.com/julienschmidt/go-http-routing-benchmark	47.186s
```

Using master and merged this PR #1817:

```
#GithubAPI Routes: 203
   Echo: 100088 Bytes
   Gin: 58512 Bytes

#GPlusAPI Routes: 13
   Echo: 9688 Bytes
   Gin: 4384 Bytes

#ParseAPI Routes: 26
   Echo: 11872 Bytes
   Gin: 7776 Bytes

#Static Routes: 157
   Echo: 80328 Bytes
   Gin: 34936 Bytes

goos: darwin
goarch: amd64
pkg: github.com/julienschmidt/go-http-routing-benchmark
BenchmarkEcho_Param        	13868967	        91.0 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param         	11227989	       112 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_Param5       	 5590839	       217 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param5        	 5693301	       208 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_Param20      	 1972708	       576 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Param20       	 2329970	       500 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_ParamWrite   	 6480324	       199 ns/op	       8 B/op	       1 allocs/op
BenchmarkGin_ParamWrite    	 6192961	       183 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GithubStatic 	11066961	       110 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubStatic  	 9331580	       131 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GithubParam  	 5655951	       209 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubParam   	 4631484	       264 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GithubAll    	   28891	     40733 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GithubAll     	   23617	     49969 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GPlusStatic  	14360215	        82.9 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusStatic   	14073127	        90.6 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GPlusParam   	 9618414	       125 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusParam    	 6743815	       177 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GPlus2Params 	 6142123	       192 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlus2Params  	 4751052	       261 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_GPlusAll     	  588553	      1935 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_GPlusAll      	  532138	      2351 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_ParseStatic  	14569162	        82.5 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseStatic   	11442459	       103 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_ParseParam   	10626462	       103 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseParam    	 9372045	       128 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_Parse2Params 	 7996203	       144 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_Parse2Params  	 6957308	       175 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_ParseAll     	  383593	      3289 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_ParseAll      	  296257	      4158 ns/op	       0 B/op	       0 allocs/op
BenchmarkEcho_StaticAll    	   42117	     28272 ns/op	       0 B/op	       0 allocs/op
BenchmarkGin_StaticAll     	   38401	     31488 ns/op	       0 B/op	       0 allocs/op
PASS
ok  	github.com/julienschmidt/go-http-routing-benchmark	46.256s
```

cc @dmarkham @thinkerou 
Hi,
I have two different router groups for 2 different purposes.
I'd like to be able to call the same function from those 2 groups but with a different parameter. Is it possible to do so and if it is the case, how can I do that ?

```
v1API := router.Group("v1")
{
		v1API.POST("/items", GetItems(context?, false))
}
v2API := router.Group("v2")
{
		v2API.POST("/items", GetItems(context? , true ))
}
```
thanks in advance for your help
I think it should be "github.com/go-playground/validator.v10"
When user resets connection to the server, the go's http returns "broken pipe -> write tcp...".
There is no needed to panicking because it's common case.

Instead of this I suggest to catch any errors, excepting broken pipe (syscall.EPIPE error), in server-side initialised logger.

This will improve overall performance of gin and will very helpful to log any other render errors to log.
fix #2130 

The only difference between v10 and v9 is the package path
closes #1911 



link: https://github.com/daheige/go-api/blob/master/readme.md#wrk-%E5%B7%A5%E5%85%B7%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95

## Description

According to the readme I should be able to use `c.ShouldBindBodyWith(&objA, binding.JSON)` to get a copy of the request body.  But the code in the README results in a compiler error.   And, rightfully so, because binding.JSON is assigned to a private struct: https://github.com/gin-gonic/gin/blob/master/binding/binding.go#L71

Am I reading the README wrong? Should I not use `ShouldBindBodyWith`? How would I copy the request body and still be able to use it a second time without having to reset the body in the request.


## How to reproduce

Copy and paste the code below and run `go run main.go`.  That will produce the compiler error.

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
	"github.com/gin/binding"
)

func main() {
	g := gin.Default()
	g.GET("/hello/:name", func(c *gin.Context) {

		// Compile error happens below. The nil value is just there to satisfy
		// the method signature. 
		c.ShouldBindBodyWith(nil, binding.JSON)
		c.String(200, "Hello %s", c.Param("name"))
	})
	g.Run(":9000")
}

```

## Expectations

I expected the code above to compile. 

## Actual result

Results in a compile error: 

go/src/github.com/gin/binding/form_mapping.go:14:2: use of internal package github.com/gin-gonic/gin/internal/json not allowed## Environment

- go version: 1.13
- gin version (or commit ref):
- operating system: OSX

UPD: I'm sorry, I found my error: I use `input := &Input{}` and then send `&Input` to bindJSON(), which probably means I send pointer to pointer to a struct. It works when I do `var input Input`


## Description

Given this

```go
type PostAuthor struct {
	PostID		int	`json:"postId"    binding:"required"`
	AuthorID	int	`json:"authorId"  binding:"required"`
	Sort		int16	`json:"sort"      binding:"exists,gte=0"` // <=== not gte=0 tag
}

and this handler: 

func (server *Server) Test(c *gin.Context) {
	type Input struct {
		Items []PostAuthor `json:"items" binding:"required,dive"` // <=== using dive here
	}
	
        input := &Input{}

	if err := c.BindJSON(&input); err != nil {
              // Send error here
	}
}
```

and this request payload: 

```json
{
	"items": [
		{"postId": 1, "authorId": 1, "sort": -1}
	]
}
```

I expecting that bindJSON will fail because `sort` is negative, which confronts gte=0 tag. But `err == nil`. What am I doing wrong?

## Environment

- go version go1.13.3 darwin/amd64
- github.com/gin-gonic/gin v1.4.0
- MacOS Catalina

could support X-HTTP-Method-Override？
Hello,

This may sound like a dumb question but where can I find the reference of the templating language? I'm struggling to find what are the available helpers...

Thanks,


## Description

use ShouldBind(obj interface{}) when I curl "GET",the param first letter is lower case。this method get empty.But I use post json data,this method can get right data .

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
func CheckRequest(c *gin.Context) {
	type User struct {
		UserName string
		UserPass string
	}
	var request User
	if err := c.ShouldBind(&request); err != nil {
		c.JSON(http.StatusBadRequest, err.Error())
		return
	}
	cylog.Infof("%v", request)
	c.JSON(http.StatusOK, request)
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
curl -X GET \
  'http://cyy.com/crol/CheckRequest?UserName=1' \
  -H 'Accept: */*' \
  -H 'Accept-Encoding: gzip, deflate' \
  -H 'Cache-Control: no-cache' \
  -H 'Connection: keep-alive' \
  -H 'Content-Length: 15' \
  -H 'Content-Type: application/json' \
  -H 'Host: cyy.com' \
  -H 'Postman-Token: 6ff675ea-2833-4ea4-8731-a4f08c196f87,30e47b8b-c96b-447e-b3c1-9b6352f601c3' \
  -H 'User-Agent: PostmanRuntime/7.18.0' \
  -H 'cache-control: no-cache' \
  -d '{"username":23}'


curl -X POST \
  'http://cyy.com/crol/CheckRequest' \
  -H 'Accept: */*' \
  -H 'Accept-Encoding: gzip, deflate' \
  -H 'Cache-Control: no-cache' \
  -H 'Connection: keep-alive' \
  -H 'Content-Length: 17' \
  -H 'Content-Type: application/json' \
  -H 'Host: cyy.com' \
  -H 'Postman-Token: 5c65c3e8-7145-4e89-b252-83e54b096f6c,80505fd8-6ed0-4311-801a-261633948d95' \
  -H 'User-Agent: PostmanRuntime/7.18.0' \
  -H 'cache-control: no-cache' \
  -d '{"username":"23"}'
```

## Actual result

<!-- Actual result showing the problem -->
```
$ GET
{
    "UserName": "",
    "UserPass": ""
}

$ POST
{
    "UserName": "23",
    "UserPass": ""
}
```

## Environment

- go version:1.11
- gin version (or commit ref):
- operating system:mac

Hi all,
I'm using the Gin framework for go developments. Actually, I need to use the function Fullpath that you says in documentation, but this function is missing in the stable version (v1.4.0 at this moment).

To solve this, I decided to use the last master commit (db9174ae0c25), but this break compatibility with the validator (v8 -> v9). Now, binding:"exists" is breaking the application.

So please, it would be nice if you didn't document functions that still can't be used without compromising the system. The fullpath function should not be seen in the official documentation until it moves to a stable version (which will already be a v2, as there is no backward compatibility in the master line anymore).
Currently, Gin supports parsing maps in query strings using `GetQueryMap`. The current implementation, however, is limited to simple maps where values are strings. A simple change to the code enables parsing more complex maps where values are string arrays. For instance, the following URL contains such a map:

`/test?map[key1]=value11&map[key1]=value12&map[key2]=value2`

We have use-cases where we need to parse such URLs. Given the change is relatively minor, and it is backwards compatible, it would be nice to have this feature added.

I chose `multimap` to refer to a map containing string arrays (see https://en.wikipedia.org/wiki/Multimap). But, there might be a better name.

I will document the new methods in the README if you think it is a feature you want to add to Gin.

I decided not to duplicate the `get` method to reduce code duplication. The tradeoff is a slight performance reduction. I did some performance evaluation and the results were:

Original GetQueryMap: 216 ns / call
Modified GetQueryMap: 419 ns / call

I believe this is a negligible increase in performance, but you should have a better idea on the latency breakdown across the whole lifespan of a process request. So, let me know if you think it is better not to pay the extra latency.
- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


#  Description

Using the fetch API from WHATWG in Google Chrome, an image upload does *not* have Content-Type multipart/form-data. Instead, the content type is set to the MIME type (ex: `image/jpeg`) with a `boundary` parameter. Setting Content-Type explicitly to `multipart/form-data` should result in an error (and it does).

## How to reproduce

Follow an existing image upload example from Gin's documentation, but use the fetch API on the client to send the upload request.

## Expectations

Use for non-multipart requests should be documented, as people may try to use the fetch API with Gin.

## Actual result

I still haven't figured out how to get it working. Probably gonna have to dive into how Gin works internally to figure this out.

## Environment

- go version: N/A
- gin version (or commit ref): N/A
- operating system: N/A

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

## Description
 using 1-line LetsEncrypt HTTPS servers

Server throw out this error message when client is access
>  http: TLS handshake error from xx.xx.xx.xx:46604: 403 urn:acme:error:unauthorized: Account creation on ACMEv1 is disabled. Please upgrade your ACME client to a version that supports ACMEv2 / RFC 8555. See https://community.letsencrypt.org/t/end-of-life-plan-for-acmev1/88430 for details.

<!-- Description of a problem -->

## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```golang
package main

import (
	"log"

	"github.com/gin-gonic/autotls"
	"github.com/gin-gonic/gin"
)

func main() {
	r := gin.Default()

	// Ping handler
	r.GET("/", func(c *gin.Context) {
		c.String(200, "Hello world")
	})

	log.Fatal(autotls.Run(r, "yourdomain.com"))
}
```

## Expectations

<!-- Your expectation result of 'curl' command, like -->
```
$ curl https://yourdomain.com
Hello world
```

## Actual result

<!-- Actual result showing the problem -->
```
$ curl https://yourdomain.com
curl: (35) error:14094438:SSL routines:ssl3_read_bytes:tlsv1 alert internal error

```

## Environment

- go version:go version go1.13.4 linux/amd64
- gin version (or commit ref):v1.4.0
- operating system:Ubuntu 18.04

## Description

I'm trying to follow this tutorial for setting up a gin gonic server
[https://dev.to/cmelgarejo/creating-an-opinionated-graphql-server-with-go-part-2-46io](https://dev.to/cmelgarejo/creating-an-opinionated-graphql-server-with-go-part-2-46io). However when i try to run the server, this error pops up:
`
panic: gin mode unknown: debug
`

In the .env file I have the GIN_MODE variable set like this

`
GIN_MODE=debug
`

I don't understand what is wrong with this, as the variable value should be correct

## How to reproduce

Set the environment variable for GIN_MODE like this

```
GIN_MODE=debug
```

## Expectations

The server runs in debug mode

## Actual result

The server crash

## Environment

- go version: 1.12
- gin version (or commit ref): 1.4.0
- operating system: Windows 10 1909

Does Bind still not support the []* multipart.fileheader type?

version: 1.4.0
type Test  struct {
	Index int32  `form:"index" binding:"required"`
}

when index = 0 will fail to verify
I hope he is successful, how can i do ?
## Description

I would like to use binding to validate JSON body input to my HTTP handlers, but I get a panic when the incorrect type is passed in. Am I doing something wrong? Should I be type checking my JSON input _before_ calling the `Bind` function?

## How to reproduce

I have a request struct like this:

```go
type myRequest struct {
	MyValue string `json:"my_value" binding:"required"`
}
```

I would like to make use of `context.BindJSON()` to validate input and marshal the request into a struct.

```go
	req := &myRequest{}
	if err := c.BindJSON(req); err != nil {
		c.JSON(400, c.Errors)
		return
	}
```

This works fine until I pass in a non-string value to the POST body, at which point I get a panic.

```
POST /my-endpoint

{
  "my_value": 1
}
```


## Expectations

Validation fails and I can return a `400` from the handler.

## Actual result

produces:
```
panic: interface conversion: error is *json.UnmarshalTypeError, not validator.ValidationErrors [recovered]
	panic: interface conversion: error is *json.UnmarshalTypeError, not validator.ValidationErrors
```

## Environment

- go version: 1.13.1
- gin version (or commit ref): 1.4.0
- operating system: MacOS

https://github.com/go-playground/validator/releases/tag/v10.0.0
EnableJsonDisallowUnknownFields => EnableJsonDecoderDisallowUnknownFields

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


The latest release (v1.4.0) was six months ago (and there have been quite a few fixes after that). The previous release (v1.3.0) goes back more than one year ago, and the one before was released more than two years ago. 

Also, after release v1.2 there hasn't been any minor release (e.g., v1.4.1).

So, I was wondering what the release plan for Gin is. I understand there needs to be a balance between stability and releasing very often. But, the current cadence seems to be rather slow. Is this something intentional?
If I use ShouldBindBodyWith in the middleware it will cause me to not be able to use methods like ShouldBindWith that require the Body

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


I'm confused about this.

context.JSONP() :

```golang
// JSONP serializes the given struct as JSON into the response body.
// It add padding to response body to request data from a server residing in a different domain than the client.
// It also sets the Content-Type as "application/javascript".
func (c *Context) JSONP(code int, obj interface{}) {
	callback := c.DefaultQuery("callback", "")
	if callback == "" {
		c.Render(code, render.JSON{Data: obj})
		return
	}
	c.Render(code, render.JsonpJSON{Callback: callback, Data: obj})
}
```

The question is why can't I define callback parameter's name like this :

```golang
func (c *Context) JSONP(code int, obj interface{}, callback string) {
	if callback == "" {
		c.Render(code, render.JSON{Data: obj})
		return
	}
	c.Render(code, render.JsonpJSON{Callback: callback, Data: obj})
}
```

or if callback parameter is empty,it would be like this:

```golang
func (c *Context) JSONP(code int, obj interface{}, callback string) {
	if callback == "" {
		callback = "callback"
	}
	c.Render(code, render.JsonpJSON{Callback: callback, Data: obj})
}
```

I mean , JSONP is jsonp instead of json.


For example,
Client request body is 
```json
{
  "data": {
    "user_id": "l5jR4eib",
    "password": "password"
  },
  "verify_char": "y8S26y"
}
```
And i hava a struct:
```golang
type data struct {
    UserId
    Password
}
```
I want to bind the "data" field to the validate struct, not all fields.So how can i get it ?
I want to use gin, with http2 and  Let's Encrypt, what can i do?

can you show me a simple example?
- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


Fixed #2111 

Now is possible to call `c.DataFromReader` without extra headers.
```
c.DataFromReader(http.StatusOK, 5, gin.MIMEHTML, strings.NewReader("1234\n"), nil)
```

Thanks: @nikandfor
Closes #2108

Will make gin compatible with nhooyr.io/websocket.

## Description

i want to get /a/index.html, but get a redirect to /a/



Fixes #2117


The static file handler (`RouterGroup.createStaticHandler`) does not close files opened via `fs.Open`:

[Permalink here](https://github.com/gin-gonic/gin/blob/393a63f3b020df89d42695064443760c7d0a0dc8/routergroup.go#L196).

This can lead leave file handles open and may prevent other processes from opening/modifying the file.
go get -u github.com/gin-gonic/gin

```
gin-gonic/gin/binding/json.go:50:10: decoder.DisallowUnknownFields undefined (type *"encoding/json".Decoder has no field or method DisallowUnknownFields)
```

- go version: go1.9.5 linux/amd64

I have so many logs like this "[GIN] 2019/10/29 - 17:34:07 | 200 |     152.814µs", how can I disable the gin logs?
https://github.com/gin-gonic/gin/issues/2104

func (r *Request) FormFile(key string) (multipart.File, *multipart.FileHeader, error)

File is an interface to access the file part of a multipart message. Its contents may be either stored in memory or on disk. If stored on disk, the File's underlying concrete type will be an *os.File. 
``` go
		c.Set("ResponseParams", params)
		content, exist := c.Get("returnData")
		if !exist {
			c.JSON(c.Writer.Status(), code.ServerException)
			return
		}
		marshal, err := json.Marshal(content)
		if err != nil {
			c.JSON(c.Writer.Status(), code.ServerParamsException)
			return
		}
```

The exception is thrown in the above code or panic after the next code can not get the status code will prompt the following:
```log
[GIN-debug] [WARNING] Headers were already written. Wanted to override status code 200 with 500
```



I was missing feature of Serving file from `http.FileSystem`.

Use cases:
* Serve file by alias without redirection and opening file by hands.
* Return help page on root of `/api/` handlers.
* Choose `FileSystem` dynamically.
## Description

`gin.Context.DataFromReader` crashes if I don't set extra headers.

I think this little fix would be the best solution to keep API and not to compel me to write `map[string]string{}` each time.

```diff
diff --git a/render/reader.go b/render/reader.go
index 502d939..fd308a7 100644
--- a/render/reader.go
+++ b/render/reader.go
@@ -22,6 +22,9 @@ type Reader struct {
 func (r Reader) Render(w http.ResponseWriter) (err error) {
        r.WriteContentType(w)
        if r.ContentLength >= 0 {
+               if r.Headers == nil {
+                       r.Headers = make(map[string]string)
+               }
                r.Headers["Content-Length"] = strconv.FormatInt(r.ContentLength, 10)
        }
        r.writeHeaders(w, r.Headers)
```

I also have question why extra headers does not replace global headers here?
https://github.com/gin-gonic/gin/blob/master/render/reader.go#L41
```golang
// render/reader.go

// writeHeaders writes custom Header.
func (r Reader) writeHeaders(w http.ResponseWriter, headers map[string]string) {
    header := w.Header()
    for k, v := range headers {
        if header.Get(k) == "" {
            header.Set(k, v)
        }
    }
}
```

## How to reproduce

```golang
package main

import (
    "net/http"
    "strings"

    "github.com/gin-gonic/gin"
)

func main() {
    r := gin.Default()

    r.GET("/", func(c *gin.Context) {
        // Why not set extra headers as usual (as c.JSON or c.Data)?
        c.Writer.Header().Set("X-Extra-Header", "extra value")

        c.DataFromReader(http.StatusOK, 5, gin.MIMEHTML, strings.NewReader("1234\n"), nil) // If I don't want to set extra headers it crashes
    })

    r.Run(":5000")
}
```

## Expectations

Successful response
```bash
$ curl -v http://localhost:5000
# ...
< HTTP/1.1 200 OK
# ...
```

## Actual result

recovered panic and 500 HTTP response
```bash
$ curl -v http://localhost:5000
# ...
< HTTP/1.1 500 Internal Server Error
# ...
```

## Environment

- go version: go1.13 linux/amd64
- gin version (or commit ref): v1.4.0 and master
- operating system: ubuntu

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- [x] Add break-backward remind log
Why does gin deviate from net/http in that WriteHeader doesn't actually write the header?

You have to call WriteHeaderNow()

https://github.com/gin-gonic/gin/blob/094f9a9105f8e7b971a01a64677eef5a1f7bcd9b/response_writer.go#L69

This is causing https://github.com/nhooyr/websocket/issues/166

I'll add a fix in my library to call it but I would prefer if gin deprecated this behaviour or added some docs explaining why its necessary.
## Description

<!-- Description of a problem -->
Very randomly, I got my Gin application panic for a reason that I don't know.


## How to reproduce

<!-- The smallest possible code example to show the problem that can be compiled, like -->
```
package main

import (
	"github.com/gin-gonic/gin"
)
// Initiate the router
router := gin.Default()

// Use RequestIdMiddleware() middleware
router.Use(requestIDMiddleware())
```
```
package main

import (
	"github.com/gin-gonic/gin"
	uuid "github.com/satori/go.uuid"
)

var globalRequestData = make(map[string]string)

/*
requestIdMiddleware add X-Request-Id to each request
X-Request-Id is a uuid, this should help to trace request in logs
for debug purpose.
*/
func requestIDMiddleware() gin.HandlerFunc {
	return func(c *gin.Context) {
		UUID := uuid.NewV4().String() 
		c.Writer.Header().Set("X-Request-Id", UUID)

		// Append X-Request-Id to globalRequestData array
		globalRequestData["X-Request-Id"] = UUID
	}
}
```

`globalRequestData["X-Request-Id"]` contains an UUID that should be available in each endpoint.

## Expectations

<!-- Your expectation result of 'curl' command, like -->
No panic

## Actual result

<!-- Actual result showing the problem -->
```
fatal error: concurrent map writes

goroutine 547 [running]:
runtime.throw(0xcac95a, 0x15)
	/usr/local/go/src/runtime/panic.go:617 +0x72 fp=0xc00016f838 sp=0xc00016f808 pc=0x42c0d2
runtime.mapassign_faststr(0xbb5d00, 0xc000652000, 0xca55f0, 0xc, 0xc001b44768)
	/usr/local/go/src/runtime/map_faststr.go:211 +0x42a fp=0xc00016f8a0 sp=0xc00016f838 pc=0x412bda
main.requestIDMiddleware.func1(0xc0003e84e0)
	/opt/backend/src/github.com/vinylrecords/middleware.go:33 +0x17b fp=0xc00016f918 sp=0xc00016f8a0 pc=0xb090eb
github.com/gin-gonic/gin.(*Context).Next(0xc0003e84e0)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/context.go:147 +0x3a fp=0xc00016f930 sp=0xc00016f918 pc=0x8ee34a
github.com/gin-gonic/gin.RecoveryWithWriter.func1(0xc0003e84e0)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/recovery.go:83 +0x5a fp=0xc00016f960 sp=0xc00016f930 pc=0x901dba
github.com/gin-gonic/gin.(*Context).Next(0xc0003e84e0)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/context.go:147 +0x3a fp=0xc00016f978 sp=0xc00016f960 pc=0x8ee34a
github.com/gin-gonic/gin.LoggerWithConfig.func1(0xc0003e84e0)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/logger.go:241 +0xe1 fp=0xc00016fb18 sp=0xc00016f978 pc=0x900ee1
github.com/gin-gonic/gin.(*Context).Next(0xc0003e84e0)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/context.go:147 +0x3a fp=0xc00016fb30 sp=0xc00016fb18 pc=0x8ee34a
github.com/gin-gonic/gin.(*Engine).handleHTTPRequest(0xc0006a4000, 0xc0003e84e0)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/gin.go:400 +0x67a fp=0xc00016fcb8 sp=0xc00016fb30 pc=0x8f824a
github.com/gin-gonic/gin.(*Engine).ServeHTTP(0xc0006a4000, 0xde27e0, 0xc0002dca80, 0xc000269e00)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/gin.go:361 +0x14e fp=0xc00016fcf0 sp=0xc00016fcb8 pc=0x8f793e
net/http.serverHandler.ServeHTTP(0xc0003e9450, 0xde27e0, 0xc0002dca80, 0xc000269e00)
	/usr/local/go/src/net/http/server.go:2774 +0xa8 fp=0xc00016fd20 sp=0xc00016fcf0 pc=0x6c7048
net/http.(*conn).serve(0xc0001f8000, 0xde4f20, 0xc000314000)
	/usr/local/go/src/net/http/server.go:1878 +0x851 fp=0xc00016ffc8 sp=0xc00016fd20 pc=0x6c2c31
runtime.goexit()
	/usr/local/go/src/runtime/asm_amd64.s:1337 +0x1 fp=0xc00016ffd0 sp=0xc00016ffc8 pc=0x458321
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2884 +0x2f4

goroutine 1 [IO wait, 7 minutes]:
internal/poll.runtime_pollWait(0x7fa81ef19238, 0x72, 0x0)
	/usr/local/go/src/runtime/netpoll.go:182 +0x56
internal/poll.(*pollDesc).wait(0xc000517398, 0x72, 0x0, 0x0, 0xca12a1)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:87 +0x9b
internal/poll.(*pollDesc).waitRead(...)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:92
internal/poll.(*FD).Accept(0xc000517380, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:384 +0x1ba
net.(*netFD).accept(0xc000517380, 0xc000028070, 0xc000028000, 0x40b919)
	/usr/local/go/src/net/fd_unix.go:238 +0x42
net.(*TCPListener).accept(0xc000228328, 0xc0005c3ae0, 0x84e63823, 0xc66e605e9d3d8e9)
	/usr/local/go/src/net/tcpsock_posix.go:139 +0x32
net.(*TCPListener).AcceptTCP(0xc000228328, 0xc0005c3b08, 0x4bf996, 0x5db2279a)
	/usr/local/go/src/net/tcpsock.go:247 +0x48
net/http.tcpKeepAliveListener.Accept(0xc000228328, 0xc0005c3b58, 0x18, 0xc000000180, 0x6c74f4)
	/usr/local/go/src/net/http/server.go:3264 +0x2f
net/http.(*Server).Serve(0xc0003e9450, 0xde3020, 0xc000228328, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:2859 +0x22d
net/http.(*Server).ListenAndServe(0xc0003e9450, 0xc0003e9450, 0xc000167cb8)
	/usr/local/go/src/net/http/server.go:2797 +0xe4
net/http.ListenAndServe(...)
	/usr/local/go/src/net/http/server.go:3037
github.com/gin-gonic/gin.(*Engine).Run(0xc0006a4000, 0xc000167df8, 0x1, 0x1, 0x0, 0x0)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/gin.go:295 +0x140
main.setupRouter(0xdd2f60)
	/opt/backend/src/github.com/vinylrecords/router.go:148 +0x1a43
main.main()
	/opt/backend/src/github.com/vinylrecords/main.go:26 +0x7b

goroutine 535 [runnable]:
fmt.(*pp).argNumber(0xc001d1e000, 0x1, 0xcc3c7f, 0x37, 0x1c, 0x2, 0x1c, 0x1c, 0xc000173000)
	/usr/local/go/src/fmt/print.go:939 +0x112
fmt.(*pp).doPrintf(0xc001d1e000, 0xcc3c7f, 0x37, 0xc000173120, 0x2, 0x2)
	/usr/local/go/src/fmt/print.go:1082 +0xb9c
fmt.Sprintf(0xcc3c7f, 0x37, 0xc000173120, 0x2, 0x2, 0x40b919, 0xc001d1ca60)
	/usr/local/go/src/fmt/print.go:214 +0x66
fmt.Errorf(...)
	/usr/local/go/src/fmt/print.go:223
github.com/spf13/cast.ToStringMapE(0xbb5400, 0xc00020ec30, 0x9a6c65, 0xc000268300, 0xc00020eba0)
	/opt/go/pkg/mod/github.com/spf13/cast@v1.3.0/caste.go:989 +0x269
github.com/spf13/cast.ToStringMap(...)
	/opt/go/pkg/mod/github.com/spf13/cast@v1.3.0/cast.go:139
github.com/spf13/viper.(*Viper).isPathShadowedInFlatMap(0xc000268300, 0xc001d1ca60, 0x2, 0x2, 0xbb5400, 0xc00020ec30, 0x0, 0x2)
	/opt/go/pkg/mod/github.com/spf13/viper@v1.3.2/viper.go:604 +0x68
github.com/spf13/viper.(*Viper).find(0xc000268300, 0xc001d12670, 0xa, 0xa, 0xa)
	/opt/go/pkg/mod/github.com/spf13/viper@v1.3.2/viper.go:993 +0xcdc
github.com/spf13/viper.(*Viper).Get(0xc000268300, 0xc001d12670, 0xa, 0x3, 0xc001d12670)
	/opt/go/pkg/mod/github.com/spf13/viper@v1.3.2/viper.go:669 +0x7c
github.com/spf13/viper.(*Viper).GetString(0xc000268300, 0xc001d12670, 0xa, 0xc9d95d, 0x1)
	/opt/go/pkg/mod/github.com/spf13/viper@v1.3.2/viper.go:726 +0x3f
github.com/spf13/viper.GetString(...)
	/opt/go/pkg/mod/github.com/spf13/viper@v1.3.2/viper.go:724
main.config(...)
	/opt/backend/src/github.com/vinylrecords/config.go:62
main.cache(0xc001c8c9c0)
	/opt/backend/src/github.com/vinylrecords/cache.go:21 +0xa1
main.checkAuthTokenMiddleware.func1(0xc000655ba0)
	/opt/backend/src/github.com/vinylrecords/middleware.go:78 +0x210
github.com/gin-gonic/gin.(*Context).Next(0xc000655ba0)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/context.go:147 +0x3a
github.com/gin-gonic/gin.LoggerWithConfig.func1(0xc000655ba0)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/logger.go:241 +0xe1
github.com/gin-gonic/gin.(*Context).Next(0xc000655ba0)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/context.go:147 +0x3a
github.com/gin-gonic/gin.RecoveryWithWriter.func1(0xc000655ba0)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/recovery.go:83 +0x5a
github.com/gin-gonic/gin.(*Context).Next(0xc000655ba0)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/context.go:147 +0x3a
github.com/gin-gonic/gin.LoggerWithConfig.func1(0xc000655ba0)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/logger.go:241 +0xe1
github.com/gin-gonic/gin.(*Context).Next(0xc000655ba0)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/context.go:147 +0x3a
github.com/gin-gonic/gin.(*Engine).handleHTTPRequest(0xc0006a4000, 0xc000655ba0)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/gin.go:400 +0x67a
github.com/gin-gonic/gin.(*Engine).ServeHTTP(0xc0006a4000, 0xde27e0, 0xc0003bc2a0, 0xc0004b0000)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/gin.go:361 +0x14e
net/http.serverHandler.ServeHTTP(0xc0003e9450, 0xde27e0, 0xc0003bc2a0, 0xc0004b0000)
	/usr/local/go/src/net/http/server.go:2774 +0xa8
net/http.(*conn).serve(0xc0002da000, 0xde4f20, 0xc000214200)
	/usr/local/go/src/net/http/server.go:1878 +0x851
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2884 +0x2f4

goroutine 152 [select, 21 minutes]:
database/sql.(*DB).connectionOpener(0xc0001ec240, 0xde4f20, 0xc000222400)
	/usr/local/go/src/database/sql/sql.go:1000 +0xe8
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:670 +0x15e

goroutine 800 [select]:
net/http.(*persistConn).writeLoop(0xc001c5d680)
	/usr/local/go/src/net/http/transport.go:1958 +0x113
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1358 +0xb0d

goroutine 68 [select, 4098 minutes]:
database/sql.(*DB).connectionOpener(0xc0001ec0c0, 0xde4f20, 0xc00050e9c0)
	/usr/local/go/src/database/sql/sql.go:1000 +0xe8
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:670 +0x15e

goroutine 177 [select, 21 minutes]:
github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc00056e660, 0xc0001ec780, 0xc000084120)
	/opt/go/pkg/mod/github.com/go-sql-driver/mysql@v1.4.1/connection_go18.go:178 +0xbf
created by github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher
	/opt/go/pkg/mod/github.com/go-sql-driver/mysql@v1.4.1/connection_go18.go:175 +0xbe

goroutine 69 [select, 4098 minutes]:
database/sql.(*DB).connectionResetter(0xc0001ec0c0, 0xde4f20, 0xc00050e9c0)
	/usr/local/go/src/database/sql/sql.go:1013 +0xfb
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:671 +0x194

goroutine 70 [select, 4098 minutes]:
github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc000447560, 0xc0001ec180, 0xc0001fa7e0)
	/opt/go/pkg/mod/github.com/go-sql-driver/mysql@v1.4.1/connection_go18.go:178 +0xbf
created by github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher
	/opt/go/pkg/mod/github.com/go-sql-driver/mysql@v1.4.1/connection_go18.go:175 +0xbe

goroutine 73 [select, 4098 minutes]:
database/sql.(*DB).connectionOpener(0xc0001ec3c0, 0xde4f20, 0xc00050ecc0)
	/usr/local/go/src/database/sql/sql.go:1000 +0xe8
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:670 +0x15e

goroutine 74 [select, 4098 minutes]:
database/sql.(*DB).connectionResetter(0xc0001ec3c0, 0xde4f20, 0xc00050ecc0)
	/usr/local/go/src/database/sql/sql.go:1013 +0xfb
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:671 +0x194

goroutine 75 [select, 4098 minutes]:
github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc0000211a0, 0xc0001ec480, 0xc0001fb380)
	/opt/go/pkg/mod/github.com/go-sql-driver/mysql@v1.4.1/connection_go18.go:178 +0xbf
created by github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher
	/opt/go/pkg/mod/github.com/go-sql-driver/mysql@v1.4.1/connection_go18.go:175 +0xbe

goroutine 85 [select, 4098 minutes]:
database/sql.(*DB).connectionOpener(0xc00031a180, 0xde4f20, 0xc000222000)
	/usr/local/go/src/database/sql/sql.go:1000 +0xe8
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:670 +0x15e

goroutine 37 [select, 4098 minutes]:
database/sql.(*DB).connectionOpener(0xc00064e000, 0xde4f20, 0xc0002147c0)
	/usr/local/go/src/database/sql/sql.go:1000 +0xe8
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:670 +0x15e

goroutine 38 [select, 4098 minutes]:
database/sql.(*DB).connectionResetter(0xc00064e000, 0xde4f20, 0xc0002147c0)
	/usr/local/go/src/database/sql/sql.go:1013 +0xfb
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:671 +0x194

goroutine 39 [select, 4098 minutes]:
github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc00053e900, 0xc00064e0c0, 0xc0005344e0)
	/opt/go/pkg/mod/github.com/go-sql-driver/mysql@v1.4.1/connection_go18.go:178 +0xbf
created by github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher
	/opt/go/pkg/mod/github.com/go-sql-driver/mysql@v1.4.1/connection_go18.go:175 +0xbe

goroutine 548 [runnable]:
net.setDefaultSockopts(0x2b, 0x2, 0x1, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/sockopt_linux.go:12 +0x188
net.socket(0xde4fa0, 0xc0018a2d20, 0xc9e0ce, 0x3, 0x2, 0x1, 0x0, 0x0, 0xdea080, 0x0, ...)
	/usr/local/go/src/net/sock_posix.go:23 +0xa6
net.internetSocket(0xde4fa0, 0xc0018a2d20, 0xc9e0ce, 0x3, 0xdea080, 0x0, 0xdea080, 0xc001b37590, 0x1, 0x0, ...)
	/usr/local/go/src/net/ipsock_posix.go:141 +0x141
net.(*sysDialer).doDialTCP(0xc000554100, 0xde4fa0, 0xc0018a2d20, 0x0, 0xc001b37590, 0xbc9dc0, 0x2482508, 0x0)
	/usr/local/go/src/net/tcpsock_posix.go:65 +0xc2
net.(*sysDialer).dialTCP(0xc000554100, 0xde4fa0, 0xc0018a2d20, 0x0, 0xc001b37590, 0xc000096e20, 0x57f0ae, 0xbf64a824861ee79a)
	/usr/local/go/src/net/tcpsock_posix.go:61 +0xd7
net.(*sysDialer).dialSingle(0xc000554100, 0xde4fa0, 0xc0018a2d20, 0xddb3a0, 0xc001b37590, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/dial.go:571 +0x34b
net.(*sysDialer).dialSerial(0xc000554100, 0xde4fa0, 0xc0018a2d20, 0xc0019a4700, 0x1, 0x1, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/dial.go:539 +0x221
net.(*Dialer).DialContext(0xc0000970c8, 0xde4f60, 0xc0000220a8, 0xc9e0ce, 0x3, 0xc000397d80, 0x15, 0x0, 0x0, 0x0, ...)
	/usr/local/go/src/net/dial.go:417 +0x66b
net.(*Dialer).Dial(...)
	/usr/local/go/src/net/dial.go:340
net.DialTimeout(0xc9e0ce, 0x3, 0xc000397d80, 0x15, 0x12a05f200, 0xc001b37550, 0x15, 0x15, 0xc000097210)
	/usr/local/go/src/net/dial.go:326 +0xb7
github.com/bradfitz/gomemcache/memcache.(*Client).dial(0xc001b37530, 0xddaa20, 0xc0003a6300, 0x0, 0x0, 0x8, 0x2)
	/opt/go/pkg/mod/github.com/bradfitz/gomemcache@v0.0.0-20190913173617-a41fca850d0b/memcache/memcache.go:263 +0xaf
github.com/bradfitz/gomemcache/memcache.(*Client).getConn(0xc001b37530, 0xddaa20, 0xc0003a6300, 0x0, 0x203000, 0xc000097370)
	/opt/go/pkg/mod/github.com/bradfitz/gomemcache@v0.0.0-20190913173617-a41fca850d0b/memcache/memcache.go:281 +0x95
github.com/bradfitz/gomemcache/memcache.(*Client).withAddrRw(0xc001b37530, 0xddaa20, 0xc0003a6300, 0xce0808, 0x0, 0x0)
	/opt/go/pkg/mod/github.com/bradfitz/gomemcache@v0.0.0-20190913173617-a41fca850d0b/memcache/memcache.go:350 +0x4b
github.com/bradfitz/gomemcache/memcache.(*Client).ping(0xc001b37530, 0xddaa20, 0xc0003a6300, 0x0, 0xc000097370)
	/opt/go/pkg/mod/github.com/bradfitz/gomemcache@v0.0.0-20190913173617-a41fca850d0b/memcache/memcache.go:404 +0x4b
github.com/bradfitz/gomemcache/memcache.(*ServerList).Each(0xc001b374a0, 0xc0019a46c0, 0x0, 0x0)
	/opt/go/pkg/mod/github.com/bradfitz/gomemcache@v0.0.0-20190913173617-a41fca850d0b/memcache/selector.go:97 +0xb9
github.com/bradfitz/gomemcache/memcache.(*Client).Ping(0xc001b37530, 0xc001b37530, 0x1)
	/opt/go/pkg/mod/github.com/bradfitz/gomemcache@v0.0.0-20190913173617-a41fca850d0b/memcache/memcache.go:675 +0x69
main.cache(0xc00050d790)
	/opt/backend/src/github.com/vinylrecords/cache.go:31 +0x2db
main.checkAuthTokenMiddleware.func1(0xc000513110)
	/opt/backend/src/github.com/vinylrecords/middleware.go:78 +0x210
github.com/gin-gonic/gin.(*Context).Next(0xc000513110)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/context.go:147 +0x3a
github.com/gin-gonic/gin.LoggerWithConfig.func1(0xc000513110)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/logger.go:241 +0xe1
github.com/gin-gonic/gin.(*Context).Next(0xc000513110)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/context.go:147 +0x3a
github.com/gin-gonic/gin.RecoveryWithWriter.func1(0xc000513110)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/recovery.go:83 +0x5a
github.com/gin-gonic/gin.(*Context).Next(0xc000513110)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/context.go:147 +0x3a
github.com/gin-gonic/gin.LoggerWithConfig.func1(0xc000513110)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/logger.go:241 +0xe1
github.com/gin-gonic/gin.(*Context).Next(0xc000513110)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/context.go:147 +0x3a
github.com/gin-gonic/gin.(*Engine).handleHTTPRequest(0xc0006a4000, 0xc000513110)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/gin.go:400 +0x67a
github.com/gin-gonic/gin.(*Engine).ServeHTTP(0xc0006a4000, 0xde27e0, 0xc00063e2a0, 0xc000269f00)
	/opt/go/pkg/mod/github.com/gin-gonic/gin@v1.4.1-0.20190930062212-beb879e4754a/gin.go:361 +0x14e
net/http.serverHandler.ServeHTTP(0xc0003e9450, 0xde27e0, 0xc00063e2a0, 0xc000269f00)
	/usr/local/go/src/net/http/server.go:2774 +0xa8
net/http.(*conn).serve(0xc0001f8140, 0xde4f20, 0xc0003141c0)
	/usr/local/go/src/net/http/server.go:1878 +0x851
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2884 +0x2f4

goroutine 86 [select, 4098 minutes]:
database/sql.(*DB).connectionResetter(0xc00031a180, 0xde4f20, 0xc000222000)
	/usr/local/go/src/database/sql/sql.go:1013 +0xfb
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:671 +0x194

goroutine 87 [select, 4098 minutes]:
github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc00056f4a0, 0xc00031a240, 0xc000085e60)
	/opt/go/pkg/mod/github.com/go-sql-driver/mysql@v1.4.1/connection_go18.go:178 +0xbf
created by github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher
	/opt/go/pkg/mod/github.com/go-sql-driver/mysql@v1.4.1/connection_go18.go:175 +0xbe

goroutine 138 [select, 21 minutes]:
github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc00020cb40, 0xc00031a300, 0xc0001fa8a0)
	/opt/go/pkg/mod/github.com/go-sql-driver/mysql@v1.4.1/connection_go18.go:178 +0xbf
created by github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher
	/opt/go/pkg/mod/github.com/go-sql-driver/mysql@v1.4.1/connection_go18.go:175 +0xbe

goroutine 153 [select, 21 minutes]:
database/sql.(*DB).connectionResetter(0xc0001ec240, 0xde4f20, 0xc000222400)
	/usr/local/go/src/database/sql/sql.go:1013 +0xfb
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:671 +0x194

goroutine 159 [select, 21 minutes]:
database/sql.(*DB).connectionOpener(0xc0001ec6c0, 0xde4f20, 0xc000222880)
	/usr/local/go/src/database/sql/sql.go:1000 +0xe8
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:670 +0x15e

goroutine 137 [select, 21 minutes]:
database/sql.(*DB).connectionResetter(0xc00031a0c0, 0xde4f20, 0xc000026580)
	/usr/local/go/src/database/sql/sql.go:1013 +0xfb
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:671 +0x194

goroutine 135 [select, 21 minutes]:
github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc0002e09c0, 0xc0001ec300, 0xc0001fa0c0)
	/opt/go/pkg/mod/github.com/go-sql-driver/mysql@v1.4.1/connection_go18.go:178 +0xbf
created by github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher
	/opt/go/pkg/mod/github.com/go-sql-driver/mysql@v1.4.1/connection_go18.go:175 +0xbe

goroutine 160 [select, 21 minutes]:
database/sql.(*DB).connectionResetter(0xc0001ec6c0, 0xde4f20, 0xc000222880)
	/usr/local/go/src/database/sql/sql.go:1013 +0xfb
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:671 +0x194

goroutine 136 [select, 21 minutes]:
database/sql.(*DB).connectionOpener(0xc00031a0c0, 0xde4f20, 0xc000026580)
	/usr/local/go/src/database/sql/sql.go:1000 +0xe8
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:670 +0x15e

goroutine 141 [select, 21 minutes]:
database/sql.(*DB).connectionOpener(0xc00031a3c0, 0xde4f20, 0xc000026f40)
	/usr/local/go/src/database/sql/sql.go:1000 +0xe8
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:670 +0x15e

goroutine 142 [select, 21 minutes]:
database/sql.(*DB).connectionResetter(0xc00031a3c0, 0xde4f20, 0xc000026f40)
	/usr/local/go/src/database/sql/sql.go:1013 +0xfb
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:671 +0x194

goroutine 143 [select, 21 minutes]:
github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc00020d6e0, 0xc00031a480, 0xc0001fade0)
	/opt/go/pkg/mod/github.com/go-sql-driver/mysql@v1.4.1/connection_go18.go:178 +0xbf
created by github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher
	/opt/go/pkg/mod/github.com/go-sql-driver/mysql@v1.4.1/connection_go18.go:175 +0xbe

goroutine 458 [runnable]:
net/http.(*connReader).backgroundRead(0xc0004e8090)
	/usr/local/go/src/net/http/server.go:676
created by net/http.(*connReader).startBackgroundRead
	/usr/local/go/src/net/http/server.go:673 +0xca

goroutine 542 [select]:
net/http.(*persistConn).writeLoop(0xc000550120)
	/usr/local/go/src/net/http/transport.go:1958 +0x113
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1358 +0xb0d

goroutine 541 [IO wait]:
internal/poll.runtime_pollWait(0x7fa81ef19c40, 0x72, 0xffffffffffffffff)
	/usr/local/go/src/runtime/netpoll.go:182 +0x56
internal/poll.(*pollDesc).wait(0xc00042eb18, 0x72, 0x1000, 0x1000, 0xffffffffffffffff)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:87 +0x9b
internal/poll.(*pollDesc).waitRead(...)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:92
internal/poll.(*FD).Read(0xc00042eb00, 0xc000103000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x19b
net.(*netFD).Read(0xc00042eb00, 0xc000103000, 0x1000, 0x1000, 0x1, 0x42deec, 0xc000518b88)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc000228138, 0xc000103000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x69
net/http.(*persistConn).Read(0xc000550120, 0xc000103000, 0x1000, 0x1000, 0xc000518c88, 0x404ff5, 0xc000698b40)
	/usr/local/go/src/net/http/transport.go:1524 +0x7b
bufio.(*Reader).fill(0xc00020d860)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc00020d860, 0x1, 0x0, 0x0, 0x1, 0xc001c62a00, 0x0)
	/usr/local/go/src/bufio/bufio.go:138 +0x4f
net/http.(*persistConn).readLoop(0xc000550120)
	/usr/local/go/src/net/http/transport.go:1677 +0x1a3
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1357 +0xae8

goroutine 799 [IO wait]:
internal/poll.runtime_pollWait(0x7fa81ef5a540, 0x72, 0xffffffffffffffff)
	/usr/local/go/src/runtime/netpoll.go:182 +0x56
internal/poll.(*pollDesc).wait(0xc000555e18, 0x72, 0x1000, 0x1000, 0xffffffffffffffff)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:87 +0x9b
internal/poll.(*pollDesc).waitRead(...)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:92
internal/poll.(*FD).Read(0xc000555e00, 0xc001c8b000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x19b
net.(*netFD).Read(0xc000555e00, 0xc001c8b000, 0x1000, 0x1000, 0x2, 0x42deec, 0xc001aefb88)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0002293e8, 0xc001c8b000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x69
net/http.(*persistConn).Read(0xc001c5d680, 0xc001c8b000, 0x1000, 0x1000, 0xc001aefc88, 0x404ff5, 0xc001c632c0)
	/usr/local/go/src/net/http/transport.go:1524 +0x7b
bufio.(*Reader).fill(0xc001c7d800)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc001c7d800, 0x1, 0x0, 0x0, 0x1, 0xc001bd4600, 0x0)
	/usr/local/go/src/bufio/bufio.go:138 +0x4f
net/http.(*persistConn).readLoop(0xc001c5d680)
	/usr/local/go/src/net/http/transport.go:1677 +0x1a3
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1357 +0xae8

goroutine 903 [runnable]:
net/http.(*connReader).backgroundRead(0xc0003b01b0)
	/usr/local/go/src/net/http/server.go:676
created by net/http.(*connReader).startBackgroundRead
	/usr/local/go/src/net/http/server.go:673 +0xca

goroutine 916 [IO wait]:
internal/poll.runtime_pollWait(0x7fa81ef18878, 0x72, 0xffffffffffffffff)
	/usr/local/go/src/runtime/netpoll.go:182 +0x56
internal/poll.(*pollDesc).wait(0xc000460518, 0x72, 0x0, 0x1, 0xffffffffffffffff)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:87 +0x9b
internal/poll.(*pollDesc).waitRead(...)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:92
internal/poll.(*FD).Read(0xc000460500, 0xc0003b02e1, 0x1, 0x1, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x19b
net.(*netFD).Read(0xc000460500, 0xc0003b02e1, 0x1, 0x1, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0004e6010, 0xc0003b02e1, 0x1, 0x1, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x69
net/http.(*connReader).backgroundRead(0xc0003b02d0)
	/usr/local/go/src/net/http/server.go:677 +0x58
created by net/http.(*connReader).startBackgroundRead
	/usr/local/go/src/net/http/server.go:673 +0xca

goroutine 859 [IO wait]:
internal/poll.runtime_pollWait(0x7fa81ef19900, 0x72, 0xffffffffffffffff)
	/usr/local/go/src/runtime/netpoll.go:182 +0x56
internal/poll.(*pollDesc).wait(0xc000460b18, 0x72, 0x1000, 0x1000, 0xffffffffffffffff)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:87 +0x9b
internal/poll.(*pollDesc).waitRead(...)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:92
internal/poll.(*FD).Read(0xc000460b00, 0xc00064b000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x19b
net.(*netFD).Read(0xc000460b00, 0xc00064b000, 0x1000, 0x1000, 0x1, 0x42deec, 0xc00051bb88)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc00000e9a0, 0xc00064b000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x69
net/http.(*persistConn).Read(0xc0005ab7a0, 0xc00064b000, 0x1000, 0x1000, 0xc00051bc88, 0x404ff5, 0xc00189b200)
	/usr/local/go/src/net/http/transport.go:1524 +0x7b
bufio.(*Reader).fill(0xc001af99e0)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc001af99e0, 0x1, 0x0, 0x0, 0x1, 0xc001bd0300, 0x0)
	/usr/local/go/src/bufio/bufio.go:138 +0x4f
net/http.(*persistConn).readLoop(0xc0005ab7a0)
	/usr/local/go/src/net/http/transport.go:1677 +0x1a3
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1357 +0xae8

goroutine 860 [select]:
net/http.(*persistConn).writeLoop(0xc0005ab7a0)
	/usr/local/go/src/net/http/transport.go:1958 +0x113
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1358 +0xb0d
```
Line `33` of `/opt/backend/src/github.com/vinylrecords/middleware.go`:
```
	globalRequestData["X-Request-Id"] = UUID
```

## Environment

- go version: `go1.12.5`
- gin version (or commit ref): 	`v1.4.1-0.20190930062212-beb879e4754a`
- operating system: `Linux`

c:\>curl 0.0.0.0:8080
"Failed to connect to 0.0.0.0 port 8080: Address not available"
Connecting to address 0.0.0.0:8080 is not allowed on windows. From http://msdn.microsoft.com/en-us/library/aa923167.aspx

" ... If the address member of the structure specified by the name parameter is
all zeroes, connect will return the error WSAEADDRNOTAVAIL. ..."

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With issues:
 - Before this issue,I was using Google and stackoverflow to search this question however failed.
 - The information of fail is : `No versions of github.com/mattn/go-isatty met constraints`

## Description

 - I have tried under macOS and Centos 7.5 but all failed
 - dep version:v0.5.4
 - go version:1.13.1
 - gin version (or commit ref):1.4.0
 - operating system:Centos 7.5
 - I am in China and I used VPN to over the wall.But still failed and the error information did't changed.
 - The detailed error information is:

```

[root@iZ2zedtt8r7h3t86u0o36sZ main]# dep ensure -v
# Gopkg.lock is out of sync with Gopkg.toml and project imports:
github.com/gin-gonic/gin: imported or required, but missing from Gopkg.lock's input-imports

Root project is "main"
 1 transitively valid internal packages
 1 external packages imported from 1 projects
(0)   ✓ select (root)
(1)	? attempt github.com/gin-gonic/gin with 1 pkgs; 22 versions to try
(1)	    try github.com/gin-gonic/gin@v1.4.0
(1)	✓ select github.com/gin-gonic/gin@v1.4.0 w/4 pkgs
(2)	? attempt github.com/gin-contrib/sse with 1 pkgs; 2 versions to try
(2)	    try github.com/gin-contrib/sse@v0.1.0
(2)	✓ select github.com/gin-contrib/sse@v0.1.0 w/1 pkgs
(3)	? attempt gopkg.in/yaml.v2 with 1 pkgs; 9 versions to try
(3)	    try gopkg.in/yaml.v2@v2.2.4
(3)	✓ select gopkg.in/yaml.v2@v2.2.4 w/1 pkgs
(4)	? attempt github.com/golang/protobuf with 1 pkgs; 9 versions to try
(4)	    try github.com/golang/protobuf@v1.3.2
(4)	✓ select github.com/golang/protobuf@v1.3.2 w/1 pkgs
(5)	? attempt github.com/ugorji/go with 1 pkgs; 16 versions to try
(5)	    try github.com/ugorji/go@v1.1.7
(5)	✓ select github.com/ugorji/go@v1.1.7 w/1 pkgs
(6)	? attempt github.com/mattn/go-isatty with 1 pkgs; 12 versions to try
(6)	    try github.com/mattn/go-isatty@v0.0.10
(6)	✗   unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
(6)	    try github.com/mattn/go-isatty@v0.0.9
(6)	✗   unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
(6)	    try github.com/mattn/go-isatty@v0.0.8
(6)	✗   unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
(6)	    try github.com/mattn/go-isatty@v0.0.7
(6)	✗   unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
(6)	    try github.com/mattn/go-isatty@v0.0.6
(6)	✗   unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
(6)	    try github.com/mattn/go-isatty@v0.0.5
(6)	✗   unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
(6)	    try github.com/mattn/go-isatty@v0.0.4
(6)	✗   unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
(6)	    try github.com/mattn/go-isatty@v0.0.3
(6)	✗   unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
(6)	    try github.com/mattn/go-isatty@v0.0.2
(6)	✗   unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
(6)	    try github.com/mattn/go-isatty@v0.0.1
(6)	✗   unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
(6)	    try github.com/mattn/go-isatty@master
(6)	✗   unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
(6)	    try github.com/mattn/go-isatty@cygwin-msys2
(6)	✗   unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
(6)	  ← no more versions of github.com/mattn/go-isatty to try; begin backtrack
(5)	← backtrack: no more versions of github.com/ugorji/go to try
(4)	← backtrack: no more versions of github.com/golang/protobuf to try
(3)	← backtrack: no more versions of gopkg.in/yaml.v2 to try
(2)	← backtrack: no more versions of github.com/gin-contrib/sse to try
(1)	← backtrack: no more versions of github.com/gin-gonic/gin to try
(1)	  ? continue github.com/gin-gonic/gin with 4 pkgs; 21 more versions to try
(1)	    try github.com/gin-gonic/gin@v1.3.0
(2)	✗   github.com/gin-gonic/gin@v1.3.0 not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@v1.2
(2)	✗   github.com/gin-gonic/gin@v1.2 not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@v1.1.4
(2)	✗   github.com/gin-gonic/gin@v1.1.4 not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@v1.1.3
(2)	✗   github.com/gin-gonic/gin@v1.1.3 not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@v1.1.2
(2)	✗   github.com/gin-gonic/gin@v1.1.2 not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@v1.1.1
(2)	✗   github.com/gin-gonic/gin@v1.1.1 not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@v1.1
(2)	✗   github.com/gin-gonic/gin@v1.1 not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@v1.0
(2)	✗   github.com/gin-gonic/gin@v1.0 not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@v0.6
(2)	✗   github.com/gin-gonic/gin@v0.6 not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@v0.5
(2)	✗   github.com/gin-gonic/gin@v0.5 not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@v0.4
(2)	✗   github.com/gin-gonic/gin@v0.4 not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@v0.3
(2)	✗   github.com/gin-gonic/gin@v0.3 not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@v0.1
(2)	✗   github.com/gin-gonic/gin@v0.1 not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@v1.0-rc.2
(2)	✗   github.com/gin-gonic/gin@v1.0-rc.2 not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@master
(2)	✗   github.com/gin-gonic/gin@master not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@benchmarks
(2)	✗   github.com/gin-gonic/gin@benchmarks not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@better-bind-errors
(2)	✗   github.com/gin-gonic/gin@better-bind-errors not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@new-catch-all
(2)	✗   github.com/gin-gonic/gin@new-catch-all not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@thinkerou-patch-1
(2)	✗   github.com/gin-gonic/gin@thinkerou-patch-1 not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@v0.2b
(2)	✗   github.com/gin-gonic/gin@v0.2b not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	    try github.com/gin-gonic/gin@v1.0rc1
(2)	✗   github.com/gin-gonic/gin@v1.0rc1 not allowed by constraint 1.4.0:
(2)	    1.4.0 from (root)
(1)	← backtrack: no more versions of github.com/gin-gonic/gin to try
  ✗ solving failed

Solver wall times by segment:
  b-deduce-proj-root: 1m0.001119643s
     b-list-versions:  13.371261867s
         b-list-pkgs:   3.085453845s
              b-gmal:   1.211076456s
     b-source-exists:    47.896423ms
             satisfy:      2.05326ms
         select-atom:      909.666µs
            unselect:      676.923µs
            new-atom:      313.452µs
           backtrack:      144.925µs
         select-root:       74.906µs
               other:       29.529µs

  TOTAL: 1m17.721010895s

Solving failure: No versions of github.com/mattn/go-isatty met constraints:
	v0.0.10: unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
	v0.0.9: unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
	v0.0.8: unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
	v0.0.7: unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
	v0.0.6: unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
	v0.0.5: unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
	v0.0.4: unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
	v0.0.3: unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
	v0.0.2: unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
	v0.0.1: unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
	master: unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout
	cygwin-msys2: unable to deduce repository and source type for "golang.org/x/sys/unix": unable to read metadata: unable to fetch raw metadata: failed HTTP request to URL "http://golang.org/x/sys/unix?go-get=1": Get http://golang.org/x/sys/unix?go-get=1: dial tcp 216.239.37.1:80: i/o timeout

```
Can you help me? Thank you very much
https://github.com/gin-gonic/gin/blob/0ce46610292cc8877a914b1cee41acd5dc9da7ae/context.go#L519
 according to https://github.com/golang/go/wiki/CodeReviewComments#error-strings, Error strings should not be capitalized.
I am planning to create support for dynamic pages, where user/admin can create page using rich text, and assign it a path (actually, it would be a tree-like structure with "infinite" depth).

So, I will need routing, which handles calls in following order:

1. static-path routes (API calls, fixed function pages,... and this is already supported by gin),
2. dynamic-path "routes", which are handled by dynamic pages functionality.

Is it possible to do so with gin?
import "github.com/gin-gonic/gin" before, why route tree len too big

![](https://pic2.hanmaker.com/86fd264a56bcbdacc7.png?imageHeight=650#imageWidth=264)
![](https://pic2.hanmaker.com/4226c5498abb6b2286.png?imageHeight=1197#imageWidth=578)

The tree becomes normal after using gin.Default
![](https://pic2.hanmaker.com/237d634d0aa1a015b6.png?imageHeight=929#imageWidth=436)

this is my gin version gin@1.4.0
Calling `ctx.Query` involves calling `url.Query`, which needs to parse all the query strings. While `ctx.Query` will typically be called at most once in a handler, it might be called several times per request in the different middleware stages.

I have not quantified the overhead of doing so, but depending on the depth of the middleware pipeline, there might actually be some latency increase just because of parsing the query strings again and again.

Making `ctx.Query` cache the result of `url.Query` would make subsequent calls to `ctx.Query` faster. Does this look like a good idea to you? Can you anticipate any issue that might occur? If this sounds good to you, I can make a PR and evaluate the impact on latency.
since validator  version   has upgraded to v9  #1015 .
but these files have no change:
[https://github.com/gin-gonic/gin/blob/master/README.md](url) 
[https://github.com/gin-gonic/examples/blob/master/custom-validation/server.go](url) 
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: go version go1.12.6 windows/amd64
- gin version (or commit ref):  v1.3.0
- operating system: Win10

## Description
The below lines won't use the lower case from jsoniter, no matter with the flag `-tags=jsoniter` or not, the `Marshal()` method blocked there, did some one had successfully make it work?

```go

import	"github.com/json-iterator/go"
import	"github.com/json-iterator/go/extra"

func handler(ctx *gin.Context) {
    extra.SetNamingStrategy(extra.LowerCaseWithUnderscores)
    var s, _ = jsoniter.Marshal(j)
    ctx.String(http.StatusOK, string(s))
}
```


### Why mention this pr
In data binding
http header uses the SoupdBindHeader function, the tag is the header
JSON uses the SoupdBindJSON function, the tag is json
uri uses the ShoulddBindUri function, the tag is uri
In design, keep a tag and a function one-to-one correspondence.
However, both ShouldBind and ShoulddBindQuery use form tags.

This pr just separates the query from the form, based on the considerations below.

* Behind the good aspects plus new features, do not worry about breaking the form data binding.
* Used in conjunction with github.com/guonaihong/gout http client, people can easily bind data with gin and then forward the data to the next service node with gout

### demo
```go
package main

import (
	"github.com/gin-gonic/gin"
        "github.com/guonaihong/gout"
)

type testQuery struct {
	Size int    `query:"size"`
	Page int    `query:"page"`
	Ak   string `query:"ak"`
}

func nextSever() {
        r := gin.Default()

	r.GET("/query", func(c *gin.Context) {
		q := testQuery{}
		err := c.ShouldBindQuery2(&q)
		if err != nil {
			return
		}
		c.JSON(200, q)
	})
        r.Run(":1234")
}

func main() {
        go nextSever()
	r := gin.Default()

	r.GET("/query", func(c *gin.Context) {
		q := testQuery{}
		err := c.ShouldBindQuery2(&q)
		if err != nil {
			return
		}
                // Send to the next service
                code := 0 // http code
                err := gout.GET("127.0.0.1:1234/query").SetQuery(q).Code(&code).Do()
                if err != nil || code != 200 { /* todo Need to handle errors here */}
		c.JSON(200, q)
	})

	r.Run()
}

// http client
// curl '127.0.0.1:8080/query?size=10&page=20&ak=test'
```




Add a new struct type use for output the custom log information in gin.HanlderFunc with gin log style.

Unit testing result:
![image](https://user-images.githubusercontent.com/32036069/66711616-c751ab00-edc1-11e9-9dca-e7fbd32600a4.png)

Preview of Actual Use Effect:
![image](https://user-images.githubusercontent.com/32036069/66711713-be61d900-edc3-11e9-94ae-947aac7610b7.png)

Usage demo code:
```go
package main

import (
	"github.com/gin-gonic/gin"
	"log"
)

var GlobalGinStyleLogger *gin.StyleLogger

func init() {
	GlobalGinStyleLogger = gin.NewGinStyleLogger(nil, nil)
}

func ginStylLoggerDemo(c *gin.Context) {
	GlobalGinStyleLogger.Fprintln(c, 500, "<custom log information here>")
	c.Status(200)
}

func main() {
	router := gin.Default()
	router.GET("/example", ginStylLoggerDemo)
	err := router.Run(":8080")
	if nil != err {
		log.Fatal(err)
	}
}
```





## First, why call writeContentType() in twice?
When I do the research for source code of go-gonic/gin for building more EFFECTIVE json way, render.Render interface got my attention: Because when you call c.JSON() method, you'll call the writeContentType() function in ``render.go`` **twice**, though the "content-type" header just be replaced, but I think it is unnecessary.

## Second, build json in effictive way
Cuz encoding/json using a lot of reflect, so the performance for using ``encoding/json`` is unsatisfactory, now I see a solution of serializing to json using strongly typed way, so I want to build a new Type for render.Render, and I could use ``github.com/darjun/json-gen`` to make the performance upper.

[github.com/darjun/json-gen](https://github.com/darjun/json-gen)

### My Solution:

Assume the new Type is Response, so we create the ``Render()`` and ``WriteContentType()`` methods on it: ``WriteContentType()`` is simple, so we talk about the ``Render()`` method.

In the source code for ``gin.render.JSON.Render()``, it build json by this way:

```go
encoder := json.NewEncoder(w) // w type is http.ResponseWriter
err := encoder.Encode(&obj) // obj is interface{}
```

Now I build a new Interface called JSONify, it just contain only one method:

```go
type JSONify interface {
    Map()  *jsongen.Map
}
```

So the nested data structure need to implemente this interface too, we just call the top-level data structure's ``Map()`` method in ``Render()`` method, performance improvements can range from 75% to 90%.

### Demo:

> go version go1.10.1 linux/amd64

```go
package main

import (
	"net/http"
    "fmt"
    "time"
    "encoding/json"
	jsongen "github.com/darjun/json-gen"
)

type JSONify interface {
    Map() *jsongen.Map
}

type Response struct {
    Code    int         `json:"code"`
    Message string      `json:"message"`
    Data    JSONify     `json:"data"`
}

func (response Response) Map() *jsongen.Map {
	m := jsongen.NewMap() // m type *jsongen.Map
    m.PutInt("code", int64(response.Code)) // response.Code's type decide by CPU(runtime.GOARCH).
    m.PutString("message", response.Message)
    m.PutMap("data", response.Data.Map())
    return m
}

type ResponseData struct {
    Name      string   `json:"name"`
    Score     float64  `json:"score"`
    Friends   []string `json:"friends"`
}

func (data ResponseData) Map() *jsongen.Map {
	m := jsongen.NewMap()
	m.PutString("name", data.Name)
	m.PutFloat("score", data.Score)
	m.PutStringArray("friends", data.Friends)
	return m
}

func (response Response) WriteContentType(w http.ResponseWriter) {
    writeContentType(w, jsonContentType)
}

func (response Response) Render(w http.ResponseWriter) error {
    writeContentType(w, jsonContentType)
    
    m := response.Map()
    w.Write(m.Serialize(nil))

    return nil
}

func writeContentType(w http.ResponseWriter, value []string) {
	header := w.Header()
    if val := header["Content-Type"]; len(val) == 0 {
        header["Content-Type"] = jsonContentType
    }
    return
}

var (
	_ JSONify = Response{}
	_ JSONify = ResponseData{}

	jsonContentType = []string{"application/json; charset=utf-8"}
)

func main() {
    responseData := ResponseData {
    	Name: "Bob",
    	Score: 1.2223,
    	Friends: []string{"Alice", "Cherry"},
    }
    response := Response {
    	Code: 0,
    	Message: "OK",
    	Data: responseData,
    }

    time1 := time.Now()
    m := response.Map()
    bytes := m.Serialize(nil)
    fmt.Println(time.Now().Sub(time1))

    time2 := time.Now()
    bytes, _ = json.Marshal(response)
    fmt.Println(time.Now().Sub(time2))
    fmt.Println(string(bytes))
}
```

## Chinese Version中文版本
## 为什么要调用WriteContentType()两次?

最近在研究序列化, 然后有阅读c.JSON()的代码(因为我的业务逻辑中经常性的使用c.JSON()方法), 然后深挖下去发现gin重复调用了writeContentType()方法(这个方法在gin-gonic/render/render.go)中, 这看上去挺奇怪的, 不是吗?

render.Render接口包含了Render()和WriteContentType()两个方法, 但是却分别在两个方法中都进行了对于Content-Type这个响应头的写操作, 虽然只是对于Map的一次插入而已, 但是我认为这是不必要的, 如果是为了保险, 那么为什么接口还要包含WriteContentType()方法呢?

以上就是我的第一个问题.

## 更加高效的构建JSON的方法

众所周知encoding/json的序列化是低效的, 因为使用了过多的反射和类型断言, 因此在网上看到了使用强类型的方法进行序列化JSON生成的时候, 我就在想能不能使用这种方法在gin中多加入一个强类型JSON生成的接口类型.

使用该库的方法不再赘述, 链接上面有, 只是讲一下我的解决方案的大体思想:

构建一个类似gin.render.JSON的接口类型, 同样实现WriteContentType和Render两个方法, 在Render中调用该类型的Map()方法, (任何自定义数据类型都应该满足这个接口, 目的是返回一个json-gen库中的*Map类型, 可以直接导出序列化数据), 这样就可以完成递归的高效序列化操作, 在Render中只需要调用顶层数据结构的Map()方法, 就可以获取到JSON串了.

我写的demo在上面有, 在结构很简单的时候大概可以有2/3到3/4的性能提升, 面对比较复杂的JSON可以有90%的提升.
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:
- gin version (or commit ref):
- operating system:

## Description

- We now need a function on the master branch, but not on v1.4, when will I ask for a 1.5 tag?


## Screenshots


The method `Binding.Name()` is not used in gin.
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:1.13
- gin version (or commit ref):1.4.0
- operating system:

## Description
When I use gin and build,there is someting wrong go module like this:
`build what5: cannot load github.com/ugorji/go/codec: ambiguous import: found github.com/ugorji/go/codec in multiple modules:
        github.com/ugorji/go v1.1.4 (C:\Users\beihai\go\pkg\mod\github.com\ugorji\go@v1.1.4\codec)
        github.com/ugorji/go/codec v0.0.0-20181022190402-e5e69e061d4f (C:\Users\beihai\go\pkg\mod\github.com\ugorji\go\codec@v0.0.0-20181022190402-e5e69e061d4f)`

So I try to add `github.com/ugorji/go v1.1.7` in my go.mod file,and it works.
Mybe you should fix this in new releases


## Screenshots

![Annotation 2019-10-09 130944](https://user-images.githubusercontent.com/47047644/66453434-e3d6a600-ea96-11e9-9288-83fc1408ff11.png)


- go version: go version go1.12.1 darwin/amd64
- gin version (or commit ref): v1.4.0
- operating system: OSX 10.14.3

## Description
Currently the recovery middleware only adds a recovered error to context when there is a broken pipe:  https://github.com/gin-gonic/gin/blob/master/recovery.go#L75
```
if brokenPipe {
    c.Error(err.(error)) // nolint: errcheck
    c.Abort()
} else {
    c.AbortWithStatus(http.StatusInternalServerError)
}
````

It would be great to have the else case also add the error to the context so that middleware higher in the chain can process those errors (in tracing middleware for example). This could be done by simply adding: `c.Error(errors.New(fmt.Sprintf("%v", err)))` or doing some switching on the err type. 

If this is desirable I can create a PR with the changes.
- go version: go1.12.6 linux/amd64

- gin version (or commit ref): 

github.com/gin-gonic/gin v1.4.0 h1:3tMoCCfM7ppqsR0ptz/wi1impNpT7/9wQtMZ8lr1mCQ=

github.com/gin-gonic/gin v1.4.0/go.mod h1:OW2EZn3DO8Ln9oIKOvM++LBO+5UPHJJDH72/q/3rZdM=

- operating system: CentOS 7 3.10.0-693.2.2.el7.x86_64 #1 SMP Tue Sep 12 22:26:13 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux

## Description
If use Context.JSON,
response header is like

> HTTP/1.1 200 OK
Server: nginx
Date: Thu, 05 Sep 2019 02:23:36 GMT
Content-Type: text/plain; charset=utf-8
Content-Length: 90
Connection: keep-alive
Content-Regulation: application/json; charset=utf-8

the function below works properly.

```
func renderJSON(ctx *gin.Context, resp interface{}) {
	jsonData, err := json.Marshal(resp)
	if err != nil {
		panic(err)
	}
	ctx.Status(http.StatusOK)
	ctx.Header("Content-Type", "application/json; charset=utf-8")
	ctx.Writer.Write(jsonData)
}
```

Every test file should be related to a tested file.
Remove useless tests.
Indirectly request more details of any problems. 
This will help mentors avoid wasting time to understanding new issues.


- go version:
go1.12.9 linux/amd64
- gin version (or commit ref):
1.3.0
- operating system:
ubuntu
## Description
I try to redirect request from my one docker container to another...
but it does not works
there is my docker-compose.yml
```
first_service:
  build: first_service
  ports:
    - 7001:4444
  links:
       - second_service
second_service:
  build: second_service
  ports:
    - 2232:2232
 ```
there is my redirect handler:
```golang
func  redirectToSecondService(context *gin.Context) {
	//lets try to get info through http.Get! It's OK!!
	resp, _ := http.Get("http://second_service:2232/some_endpoint")
	data, _:=ioutil.ReadAll(resp.Body)
	
       //so, now let's try to redirect to the same source! It's not working!!!
	context.Redirect(http.StatusPermanentRedirect, "http://second_service:2232/some_endpoint")
      //I've just tried the "second_service:2232/some_endpoint", "second_service/some_endpoint", "//second_service:2232/some_endpoint"
}

```
I also check my link through `curl second_service:2232/some_endpoint` from my first container and it works fine too
## Screenshots


I (trying) to create an API that responds with "IndentedJSON". The struct is like
```
type Mydata struct {
Name string
Location string
Data interface{}
Other string
}
```
The 'Data' field has JSON. When I use "IndentedJSON" I see the "outer" JSON cleanly rendered, but the inner JSON is escaped. 
EX:
```
{
"Name": "Vijay",
"Location": "Loca1",
"Data": "{\"ids\":[\"AA\",\"BB\"]}",
"Other": ""
}
```

Is there an way to fix this? and print the "clean" JSON (unescaped JSON)
Hi guys,

I would like to know if `BindUri` works with HTTP `POST`, `PATCH` and `PUT` methods?
So far I'm unable to make the validation working as it should.

Route:
```
private.PATCH("/node/properties/:id", nodeSetProperties)
```

Structure:
```
type NodeID struct {
	UUID string `uri:"id" binding:"required" example:"852c5716-d551-4fb0-8995-9a35e9181fa3" format:"string"`
}
```

Handler:
```
func nodeSetProperties(c *gin.Context) {
	var nodeID structure.NodeID
	if err := c.BindUri(&nodeID); err != nil {
		httputil.NewError(c, http.StatusBadRequest, globalRequestData["X-Request-Id"], err)
		return
	}
	code := _nodeSetProperties(c.Param("id"))
	if code == 200 {
		c.JSON(code, gin.H{"return":  "success"})
	}
}
```

I'm agree that it's not the best way how the data should be passed but I'm just wondering. 
Thanks for your help :)

- go version: `1.12.5`
- gin version (or commit ref): `v1.4.0`
- operating system: `Linux`



c.SetCookie("wbtoken", "gsdfw", 3600, "/", "localhost", false, false)
tokenCookie, err := c.Cookie("wbtoken")
if err != nil {
log.Print("tokenCookie2233", err)
return
}

My browser is ie11. I can't set cookies on the IE browser. Here's the test code, and then I'll prompt you for this.
http: named cookie not present






- With issues:
- go version:
- gin version (or commit ref):
- operating system:

## Description
The github repo home page states that

>Gin is a web framework written in Go (Golang). It features a martini-like API with much better performance, up to 40 times faster thanks to httprouter. If you need performance and good productivity, you will love Gin.

We should make it clear that gin is 40 times faster than what? I'm a new user and this is what I was thinking when I first saw this. 

## Screenshots
![image](https://user-images.githubusercontent.com/39968/65819172-1c32e480-e24c-11e9-9405-cf91dedc08f1.png)


can i use gopkg.in/go-playground/validator.v9?
- gin version (or commit ref): master

## Description
```go
func (c *Context) ClientIP() string {
	if c.engine.ForwardedByClientIP {
		clientIP := c.requestHeader("X-Forwarded-For")
		clientIP = strings.TrimSpace(strings.Split(clientIP, ",")[0])
		if clientIP == "" {
			clientIP = strings.TrimSpace(c.requestHeader("X-Real-Ip"))
		}
		if clientIP != "" {
			return clientIP
		}
	}

	if c.engine.AppEngine {
		if addr := c.requestHeader("X-Appengine-Remote-Addr"); addr != "" {
			return addr
		}
	}

	if ip, _, err := net.SplitHostPort(strings.TrimSpace(c.Request.RemoteAddr)); err == nil {
		return ip
	}

	return ""
}
```
In which the X-Forwarded-For header could be easily fabricated, leading to potential risks to authorization, logging, etc. 

## Solution
Consider adding a function name TrustedIP() to retrieve IP of user's request, which uses REMOTE_ADDR

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.



- go version:
1.13

## Description
How to expose pprof handler with gin?


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


Simpler version of https://github.com/gin-gonic/gin/pull/1865


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


With current version of graceful restart or stop example in README( https://github.com/gin-gonic/gin#graceful-restart-or-stop ), server is always blocked by 5 seconds timeout. We shouldn't wait for `ctx.Done()`.

see: https://github.com/gin-gonic/examples/blob/master/graceful-shutdown/graceful-shutdown/server.go#L46-L51

If you try to use `loadTemplate()` several times, every time except first will fail.



Previous version of Readme's multiple services case had issues: if one service did not start for any reason, you would never know about it.



- go version:
`1.12`
- gin version (or commit ref):
`b75d67cd51eb53c3c3a2fc406524c940021ffbda`
- operating system:
Linux

## Description
I have a fairly simple login request:
Handler:
```golang
var requestData LoginRequest

err := c.ShouldBindBodyWith(&requestData, binding.JSON)
if err != nil {
	logger.Log.WithError(err).Error("INVALID_REQUEST_DATA")
	utils.HandleError(c, "INVALID_REQUEST_DATA", err)
	return
}

```
Contract:
```golang
type LoginRequest struct {
	AuthType string `json:"authType" form:"authType" binding:"required"`
	Email    string `json:"email" form:"email" binding:"required"`
	Password string `json:"password" form:"password" binding:"required"`
}

```

I am sending this request:
```bash
curl -X POST \
  http://localhost:3000/v1/users/login/ \
  -H 'Accept: */*' \
  -H 'Accept-Encoding: gzip, deflate' \
  -H 'Cache-Control: no-cache' \
  -H 'Connection: keep-alive' \
  -H 'Content-Length: 80' \
  -H 'Content-Type: application/json' \
  -H 'Host: localhost:3000' \
  -H 'Postman-Token: 939c1ec5-bb55-456a-a9b9-673c4c88ac05,20fe7de2-35fd-4f25-8539-079a5dad7513,879c85af-fb8f-44fd-8fed-89846a919650' \
  -H 'User-Agent: PostmanRuntime/7.15.2' \
  -H 'cache-control: no-cache,no-cache' \
  -d '{
    "email": "akshay@expl.io",
    "authType": "password",
    "password": "abc12345"
}'
```
`ShouldBindWith` always returns `unexpected EOF`
When I tried to find out the root cause, it looks like gin is stripping off some of the json at the end & this is what the handler ends up receiving:

```
"{\n    \"email\": \"akshay@expl.io\",\n    \"authType\": \"password\",\n    \"password\": \"ab"
```

Not sure what is going on here


- go version:
`1.12`
- gin version (or commit ref):
`b75d67cd51eb53c3c3a2fc406524c940021ffbda`
- operating system:
Linux

## Description
I have a fairly simple login request:
Handler:
```golang
var requestData LoginRequest

err := c.ShouldBindBodyWith(&requestData, binding.JSON)
if err != nil {
	logger.Log.WithError(err).Error("INVALID_REQUEST_DATA")
	utils.HandleError(c, "INVALID_REQUEST_DATA", err)
	return
}

```
Contract:
```golang
type LoginRequest struct {
	AuthType string `json:"authType" form:"authType" binding:"required"`
	Email    string `json:"email" form:"email" binding:"required"`
	Password string `json:"password" form:"password" binding:"required"`
}

```

I am sending this request:
```bash
curl -X POST \
  http://localhost:3000/v1/users/login/ \
  -H 'Accept: */*' \
  -H 'Accept-Encoding: gzip, deflate' \
  -H 'Cache-Control: no-cache' \
  -H 'Connection: keep-alive' \
  -H 'Content-Length: 80' \
  -H 'Content-Type: application/json' \
  -H 'Host: localhost:3000' \
  -H 'Postman-Token: 939c1ec5-bb55-456a-a9b9-673c4c88ac05,20fe7de2-35fd-4f25-8539-079a5dad7513,879c85af-fb8f-44fd-8fed-89846a919650' \
  -H 'User-Agent: PostmanRuntime/7.15.2' \
  -H 'cache-control: no-cache,no-cache' \
  -d '{
    "email": "akshay@expl.io",
    "authType": "password",
    "password": "abc12345"
}'
```
`ShouldBindWith` always returns `unexpected EOF`
When I tried to find out the root cause, it looks like gin is stripping off some of the json at the end & this is what the handler ends up receiving:

```
"{\n    \"email\": \"akshay@expl.io\",\n    \"authType\": \"password\",\n    \"password\": \"ab"
```

Not sure what is going on here


The Gin framework is case sensitive for URLs, but the URL is not case sensitive in the browser. For a better user experience, it is recommended to optimize the URL case sensitivity, and use the lowercase path uniformly when registering the handler. Considering the case of URI parameters, you can't directly convert the URL to lowercase or uppercase in the program. You can convert it to lowercase in the node.getValue() method and compare it to achieve case insensitivity.

For example, the more complex URI below:

```
Router := gin.Default()

router.GET("/user/:firstname/:lastname/go42", func(c *gin.Context) {
Fname := c.Param("firstname")
Lname := c.Param("lastname")

c.String(http.StatusOK, "Hello %s %s ", fname, lname)
})

router.Run(":8080")
```

When this feature is implemented. Although the user and go42 in the above program are lowercase when registering, when accessing the following two URLs, they can be accessed normally and the page is rendered.

Localhost:8080/user/Rob/Pike/Go42
Localhost:8080/uSer/Rob/Pike/Go42


use simple method call instead of parsing raw query


my code:
	//get task by id,return task
	r.GET("cms/agent/v1/tasks/:id", handlers.GetTaskById)
	//get task by object_id, return task
	r.GET("cms/agent/v1/tasks/next/:objectId", handlers.GetNextTaskByObject)

error:
.panic: 'next' in new path '/cms/agent/v1/tasks/next/:objectId' conflicts with existing wildcard ':id' in existing prefix '/cms/agent/v1/tasks/:id'

http://127.0.0.1:8080/user/john
When matching the address,it will return a 404 page not found information.

@uneight @thinkerou I also have this problem and already see the example and still get an error. if I want to make file *Optional*, I still get error "http: no such file". how can I bind optional file to struct?

My code:
```
// UpdateUserRequest UpdateUserRequest
type UpdateUserRequest struct {
	CV              *multipart.FileHeader `form:"cv" binding:"omitempty"`
}

var params datatransfers.UpdateUserRequest
if err := c.ShouldBind(&params); err != nil {
	c.Error(err)
	return
}
```

If I don't put `cv` in request, it returned `"http: no such file"`, but it's working just fine if I put `cv` in request

_Originally posted by @jimmy-insignia in https://github.com/gin-gonic/gin/issues/1845#issuecomment-512103411_
The gin single binary template example uses go-asset-builder, but this has a fairly significant bug - https://github.com/jessevdk/go-assets/issues/10 - which means that test code which loads the templates more than once will *ahem* end up with empty templates. As you can see there I tracked it down eventually with an assert;

Having the example use a different system like packr, or recommending loading the templates into a global variable separate to router instantiation, might be a good way to help others avoid this issue.
- go version: go1.12.5 linux/amd64
- gin version (or commit ref):latest
- operating system: debian 10

## Description
if  client's connection is probably attacking,how can I close it immediately?  
'c.Abort()' is graceful,but I want to do it in no time.


### Is there any examples for dynamic/wildcard domain? Like [Iris](https://github.com/kataras/iris/blob/master/_examples/subdomains/wildcard/main.go) dynamic/wildcard subdomain.
 

I added cast helper for complex128 type 
It is recommended that you add an interface to shut down the server 
- Fixed : Adjust the correct test case, the source code is to `pinic`,  but test case is not correctly captured
- Add : Add the test case of code 201

**[The original PR](#2014 )**
- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


delete duplicate code, and keep in line with `GetQueryMap`
Adding Gin to my go.mod on a new project, go 1.12.5, seeing this error....

cannot load github.com/ugorji/go/codec: ambiguous import: found github.com/ugorji/go/codec in multiple modules:
	github.com/ugorji/go v1.1.4 (/Users/ben/go/pkg/mod/github.com/ugorji/go@v1.1.4/codec)
	github.com/ugorji/go/codec v0.0.0-20181209151446-772ced7fd4c2 (/Users/ben/go/pkg/mod/github.com/ugorji/go/codec@v0.0.0-20181209151446-772ced7fd4c2)

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:
build go version go1.12.7 linux/amd64
- gin version (or commit ref):
- operating system:
in docker(from scracth) which run centos 3.10.0-514.10.2.el7.x86_64 #1 SMP Fri Mar 3 00:04:05 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux

## Description
My function is very simple, if a client close http connection, then my backend log stream need close at same time:
```golang
router := gin.Default()
router.GET("/live", logController.Stream)

func StreamLog(client logClient, c *gin.Context) {
	rs, err := client.Stream()
	if err != nil {
		c.String(http.StatusInternalServerError, err.Error())
		return
	}
	defer rs.Close()

	go func() {
		<-c.Writer.CloseNotify()
		log.Println("client closed")
	}()
	sc := bufio.NewScanner(rs)
	c.Stream(func(w io.Writer) bool {
		if sc.Scan() {
			w.Write(sc.Bytes())
			w.Write([]byte("\n"))
		}
		return sc.Err() == nil
	})
}
```

and the gin http server crash in some access cases as following,  gin should catch this panic in the recovery() middleware IMO:

```bash
panic: net/http: CloseNotify called after ServeHTTP finished

goroutine 2675 [running]:
net/http.(*response).CloseNotify(0xc0003a4620, 0x16532c0)
        /go/src/net/http/server.go:1955 +0x5f
github.com/gin-gonic/gin.(*responseWriter).CloseNotify(0xc0001162c0, 0x1)
        /tmp/pkg/mod/github.com/gin-gonic/gin@v1.4.0/response_writer.go:112 +0x57
livelog/web.StreamLog.func1(0xc0001162c0, 0x1637340, 0xc000342160)
        /tmp/src/livelog/web/util.go:49 +0x38
created by livelog/web.StreamLog
        /tmp/src/livelog/web/util.go:48 +0x133
```

## Screenshots


Well,maybe it's an old question!
**I got the following error mesage when i use gin。**
[31m2019/09/08 08:14:30 write tcp 49.250.250.20:9898->223.104.191.124:65360: write: broken pipe
GET /goods/purchase?t=1567901650&channel=Grid&director=01090229&areacode=JS&cid=251906911&sign=5e0a840b0811a5d4e5678c23bda21754&_=1567901649421
Host: 62218.122.97:9898  (real network addr)
Accept: application/json, text/javascript, */*; q=0.01
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,en-US;q=0.8
Connection: keep-alive
User-Agent: Mozilla/5.0 (Linux; Android 6.0; Redmi Note 4X Build/MRA58K; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/57.0.2987.132 Mobile Safari/537.36 Html5Plus/1.0
X-Requested-With: com.tydic.ydmh

**but when i search access log， i found the http status is 200 OK。
[GIN] 2019/09/08 - 08:14:30 | 200 |   5.11835173s | 223.104.191.124 | GET      /goods/purchase?t=1567901650&channel=Grid&director=01090229&areacode=JS&cid=251906911&sign=5e0a840b0811a5d4e5678c23bda21754&_=1567901649421

it confused me， i got a panic，but the connection is 200. who knows why？**

Gin version is v1.4.0 ，and the golang version is go1.13
- go version: 1.12
- gin version (or commit ref): 1.3.0

## Description
I have a route defined like this:
```go
appRt.GET("/*request", s.AppDispatchRequest)
```

The wildcard `request` parameter should get the full path after the `/`, and I extract it like this:
```go
uri := c.Param("request")
```

The issue I'm having is that if I pass a path with some URL Encoded slashes (`%2F`), they get recursively decoded. So if for example I request an URI like `/run/cmd/S123L%2FA`, then the value of `uri` is `/run/cmd/S123L/A`, which is incorrect, as I don't expect the slashes to be decoded. This could be a security issue because a proxy in front of the http server could miss the fact that the path will be interpreted differently by it. Correct me if I'm wrong though.

The current workaround is to use RequestURI. 

## Screenshots
<img width="667" alt="Screenshot 2019-09-06 at 19 56 02" src="https://user-images.githubusercontent.com/42315498/64449605-999d8600-d0e0-11e9-8b16-38f0be99bcdf.png">

#2043 
add rwmutex to ensure the security when we use multiple goroutines.


#2043 
- struct:

```go
id  []int    `form:"id[]"`
....
c.ShouldBind(&request)
```

- request:

```bash
> curl -X POST  http://localhost:8000/api/test 'content-type: multipart/form-data'  -F 'id[]=[1,2,3]' 
> curl -X POST  http://localhost:8000/api/test 'content-type: multipart/form-data'  -F 'id[]=["1","2","3"]' 
```

then i got errors like below:

```bash
> error:strconv.ParseInt: parsing "[1,2,3]": invalid syntax
> error:strconv.ParseInt: parsing "[\"1\",\"2\",\"3\"]": invalid syntax
```

- gin version (or commit ref): 1.4.0
- operating system: Linux


- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:  v1.11.5
- gin version (or commit ref):
- operating system: 

## Description

## Screenshots


I searched for old issues but I can't find anything. If it exists, just link it and close the issue.

[GIN] 2019/09/06 - 08:33:33 | 200 |  1.187118477s |       127.0.0.1 | POST     /v1/get_data

I want to get these informations (date, time, execution_time etc.) How can I do that?

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


Hello
It is possible to have a new release?
With go1.13 and gin 1.4.0 I have some troubles installing dependencies:
```
github.com/xxxxxxx/handlers imports
	github.com/gin-gonic/gin imports
	github.com/gin-gonic/gin/binding imports
	github.com/ugorji/go/codec: ambiguous import: found github.com/ugorji/go/codec in multiple modules:
	github.com/ugorji/go v1.1.4 (/home/denouche/workspace/pkg/mod/github.com/ugorji/go@v1.1.4/codec)
	github.com/ugorji/go/codec v0.0.0-20181204163529-d75b2dcb6bc8 (/home/denouche/workspace/pkg/mod/github.com/ugorji/go/codec@v0.0.0-20181204163529-d75b2dcb6bc8)
```

This is working using master, that's why I ask for a release.
Thanks in advance!

```go
package main

import (
	"github.com/gin-gonic/gin"
)

func main() {
	router := gin.Default()
	router.POST("/", func(c *gin.Context) {
		var s string
		c.BindPlain(&s)
		c.String(200, s)
	})

	router.Run()
}

// client
// curl -d "test string" 127.0.0.1:8080
// output
// test string
```


GIN
```go
router.Static("/release", "./release")
router.Run(":80")
```
GO Server 
```go
http.Handle("/", http.FileServer(http.Dir("./")))
http.ListenAndServe(":80", nil)
```
Through this method, http header
```
Range: bytes=1-1024
```
**Gin**: Segment download error , couldn't download all. only Download only part
**GO Server**: Segment download always OK 
add RWMutex for context can be safely called in multiple goroutines.


In Java, you can use ‘/*’ to do global routing. Can gin be implemented? I have read the documentation and have not found a similar method. Please enlighten me.
Can I use '*.txt' for suffix matching?
```
func GetMachineInfo(c *gin.Context) {
	var msg = "ok"
		paramMap := make(map[string]interface{}, 0)
		for k, v := range c.Request.URL.Query() {
			if len(v) == 1 && len(v[0]) !=0 {
				paramMap[k] = v[0]
			} else {
				msg="err"
				break
			}
		}
		c.JSON(http.StatusOK,gin.H{
			"status": 0,
			"msg":    msg,
			"data": paramMap,
		})
	}
}
```
go version go1.12.9 linux/amd64
github.com/gin-gonic/gin v1.4.0

When i want set cookie, and read cookie, is not work:

```Code```:

```
package main

import (
	"log"
	"net/http"

	"github.com/gin-gonic/gin"
)

func main() {
	router := gin.Default()
	router.GET("/", func(context *gin.Context) {
		log.Println("before set cookie,show cookies:", context.Request.Cookies())
		context.SetCookie("userCookie", "test", 1000, "/", "localhost", false, true)
		log.Println("after set cookie,show cookies:", context.Request.Cookies())
		_, err := context.Request.Cookie("userCookie")
		if err != nil {
			log.Println(err.Error())

		}
		context.String(http.StatusOK, "INDEX")
	})
	_ = router.Run()
}

```

```Log```:

```
[GIN-debug] Listening and serving HTTP on :8080
2019/08/28 11:13:15 before set cookie,show cookies: [pga4_session=45a6cacd-7775-4ad6-8591-fcdc9a633e45!WwkgKWYfD+8187cf7fgM9QWhe88=]
2019/08/28 11:13:15 after set cookie,show cookies: [pga4_session=45a6cacd-7775-4ad6-8591-fcdc9a633e45!WwkgKWYfD+8187cf7fgM9QWhe88=]
2019/08/28 11:13:15 http: named cookie not present
[GIN] 2019/08/28 - 11:13:15 | 200 |     180.379µs | 192.168.124.100 | GET      /

```
Hi,

GRPC is becoming a new standard for communication in between microservices and I was wondering if it would be possible to add to `c.BindProtobuf()` method to accommodate this new use case?

Here is an architecture example:
```
[Web] <-- REST API --> [Gateway] <-- GRPC --> [Microservices]
```

The problem is that the struct generated by GRPC does not have a `form` tag to map data. This makes `c.Bind()` not usable in this case.

The only solution at this point is to create a new struct, use it to bind the incoming data, and copy the content of the struct to the GRPC struct.

Adding a `bindProtobuf` method would allow mapping directly the incoming data to the structures generated by GRPC -> `c.BindProtobuf(&protopb.User{})`

This could be done by using the `protobuf.name`'s value generated by GRPC instead of the `form`'s value used in most `c.Bind()` methods:
```
type User struct {
	Username string `protobuf:"varint,1,opt,name=username,proto3" json:"username,omitempty"`
}
```

Would that be possible or is it out of scope?
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:
- gin version (or commit ref):
- operating system:

## Description

## Screenshots


The current implementation of `gin.Context` does satisfy the `context.Context` interface, but it returns only `default`/`nil` values.

This MR changes this to use the values from the underlying `http.Request` instead.

This allows for example to use `opencensus` middleware for cross service tracing which uses the context to transfer tracing-IDs.
This pull requests adds the option to enable `DisallowUnknownFields` on the JSON decoder, similarly to how enabling `UseNumber` works.
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: go version go1.11.4 darwin/amd64
- gin version (or commit ref):
- operating system: Linux risk-gateway-stage-747b7bb89f-ztd85 4.14.106-97.85.amzn2.x86_64 #1 SMP Fri Mar 15 17:07:54 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux
- Docker Image: amazonlinux:1

## Description
I started an http service. 
This service crashes every ten minutes. 
The operating environment is docker. 
Container orchestration tool is aws eks. 

## Request help
I don't know how to analyze this problem.
Can you help me tell me what caused this?
Or tell me what tools are available for analysis?
Thank you very much

## Standard output when the container crashes
cp: overwrite '/data/conf/risk/liveme-risk-gateway/US_EAST_1/app.toml'? cp: overwrite '/data/conf/risk/liveme-risk-gateway/US_EAST_1/common.toml'? cp: overwrite '/data/conf/risk/liveme-risk-gateway/US_EAST_1/mysql.toml'? cp: overwrite '/data/conf/risk/liveme-risk-gateway/US_EAST_1/project.json'? cp: overwrite '/data/conf/risk/liveme-risk-gateway/US_EAST_1/redis.toml'? cp: overwrite '/data/conf/risk/liveme-risk-gateway/baoconf.toml'? cp: overwrite '/data/conf/risk/liveme-risk-gateway/featuremix/app.toml'? cp: overwrite '/data/conf/risk/liveme-risk-gateway/featuremix/common.toml'? cp: overwrite '/data/conf/risk/liveme-risk-gateway/featuremix/mysql.toml'? cp: overwrite '/data/conf/risk/liveme-risk-gateway/featuremix/project.json'? cp: overwrite '/data/conf/risk/liveme-risk-gateway/featuremix/redis.toml'? cp: overwrite '/data/conf/risk/liveme-risk-gateway/local/app.toml'? cp: overwrite '/data/conf/risk/liveme-risk-gateway/local/common.toml'? cp: overwrite '/data/conf/risk/liveme-risk-gateway/local/mysql.toml'? cp: overwrite '/data/conf/risk/liveme-risk-gateway/local/project.json'? cp: overwrite '/data/conf/risk/liveme-risk-gateway/local/redis.toml'? cp: overwrite '/data/conf/risk/liveme-risk-gateway/local_docker/app.toml'? cp: overwrite '/data/conf/risk/liveme-risk-gateway/local_docker/mysql.toml'? cp: overwrite '/data/conf/risk/liveme-risk-gateway/local_docker/project.json'? fatal error: concurrent map writes

goroutine 280116 [running]:
runtime.throw(0x106a339, 0x15)
	/usr/local/go/src/runtime/panic.go:608 +0x72 fp=0xc000f51788 sp=0xc000f51758 pc=0x42ca62
runtime.mapassign_faststr(0xeee280, 0xc000ffed80, 0x1067ffc, 0x13, 0x1b3fe80)
	/usr/local/go/src/runtime/map_faststr.go:199 +0x3da fp=0xc000f517f0 sp=0xc000f51788 pc=0x413eba
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/gin-gonic/gin.(*Context).Set(...)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/gin-gonic/gin/context.go:185
gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core.GetContextIp(0xc0003f2160, 0xc000389bc0, 0x20)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core/request.go:21 +0x139 fp=0xc000f51860 sp=0xc000f517f0 pc=0xb9a3e9
gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core.AddRequestLog(0xc0004d6060, 0xc0003f2160, 0x2)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core/log.go:254 +0x366 fp=0xc000f51ce8 sp=0xc000f51860 pc=0xb898c6
gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core.LogKV(0x1059ad4, 0x4, 0x10626a9, 0xd, 0x106370f, 0xe, 0xc0003f2160, 0xc000f51f68, 0x2, 0x2, ...)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core/log.go:418 +0x321 fp=0xc000f51eb0 sp=0xc000f51ce8 pc=0xb8e4e1
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*libraryFactorManage).fetch(0xc0002408c0, 0x1090600)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_library.go:68 +0x21c fp=0xc000f51f98 sp=0xc000f51eb0 pc=0xdc697c
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*libraryFactorManage).Do.func1(0xc0002408c0, 0xc000bfde60)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_library.go:97 +0x55 fp=0xc000f51fd0 sp=0xc000f51f98 pc=0xdd1335
runtime.goexit()
	/usr/local/go/src/runtime/asm_amd64.s:1333 +0x1 fp=0xc000f51fd8 sp=0xc000f51fd0 pc=0x459ab1
created by gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*libraryFactorManage).Do
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_library.go:91 +0x273

goroutine 1 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a8f8d60, 0x72, 0x0)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000590498, 0x72, 0xc000462300, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000590498, 0xffffffffffffff00, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Accept(0xc000590480, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:384 +0x1a0
net.(*netFD).accept(0xc000590480, 0x40d41f, 0xc000226000, 0xa0)
	/usr/local/go/src/net/fd_unix.go:238 +0x42
net.(*TCPListener).accept(0xc0001ba070, 0xc000c57d38, 0x494f6254, 0xd653e19b3127451f)
	/usr/local/go/src/net/tcpsock_posix.go:139 +0x2e
net.(*TCPListener).AcceptTCP(0xc0001ba070, 0xc000c57d60, 0x497566, 0x5d5e79a0)
	/usr/local/go/src/net/tcpsock.go:247 +0x47
net/http.tcpKeepAliveListener.Accept(0xc0001ba070, 0xc000c57db0, 0x18, 0xc000000300, 0x698235)
	/usr/local/go/src/net/http/server.go:3232 +0x2f
net/http.(*Server).Serve(0xc00034b5f0, 0x11d61c0, 0xc0001ba070, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:2826 +0x22f
net/http.(*Server).ListenAndServe(0xc00034b5f0, 0xc00034b5f0, 0xc00058c730)
	/usr/local/go/src/net/http/server.go:2764 +0xb6
net/http.ListenAndServe(0x1061346, 0xc, 0x11cbae0, 0xc000467440, 0x1, 0xc000467440)
	/usr/local/go/src/net/http/server.go:3004 +0x74
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/gin-gonic/gin.(*Engine).Run(0xc000467440, 0xc000407f78, 0x1, 0x1, 0x0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/gin-gonic/gin/gin.go:287 +0x138
main.main()
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/main.go:11 +0x7b

goroutine 18 [chan send, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/random.randomBase(0xc000376000)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/random/base.go:24 +0x4f
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/random.init.0
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/random/base.go:19 +0x14d

goroutine 19 [sleep]:
time.Sleep(0x2540be400)
	/usr/local/go/src/runtime/time.go:105 +0x14f
gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core.init.0.func1()
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core/log.go:93 +0xee
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core.init.0
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core/log.go:85 +0x8b

goroutine 20 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0001bc0a8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0001bc0a0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0002b6f00, 0xc0002a3800)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 34 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x5, 0xc0003d9cf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x5, 0xc0003d9cf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc0003d9cf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000392000, 0x1090b00, 0xc000392000, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc000396000)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 35 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc000396000, 0xc0001bc0a0, 0xc000210ec0, 0x36, 0xc000210ec0, 0x36, 0xc0001b80a0, 0xc0002b6f00)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 36 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0003fc7b8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0003fc7b0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0003b6000, 0xc0003fc740)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 37 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x9, 0xc00043dcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x9, 0xc00043dcf4, 0x7, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000392ec0, 0x1090b00, 0xc000392ec0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc000396140)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 38 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc000396140, 0xc0003fc7b0, 0xc0003a2280, 0x38, 0xc0003a2280, 0x38, 0xc0003f8d10, 0xc0003b6000)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 39 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0003fcc18)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0003fcc10)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0003b6100, 0xc0003fcbb0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 40 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0xd, 0xc000485cf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0xd, 0xc000485cf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc000485cf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000393120, 0x1090b00, 0xc000393120, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0003961e0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 41 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0003961e0, 0xc0003fcc10, 0xc0003a2d80, 0x38, 0xc0003a2d80, 0x38, 0xc0003f92c0, 0xc0003b6100)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 42 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0003fcfb8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0003fcfb0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0003b6300, 0xc0003fcf50)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 43 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x11, 0xc000527cf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x11, 0xc000527cf4, 0x7, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000393300, 0x1090b00, 0xc000393300, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0003962d0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 44 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0003962d0, 0xc0003fcfb0, 0xc0003a3440, 0x3a, 0xc0003a3440, 0x3a, 0xc0003f9660, 0xc0003b6300)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 45 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0004bc9c8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0004bc9c0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0003b6c00, 0xc0004bc950)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 46 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x15, 0xc00055fcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x15, 0xc00055fcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc00055fcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc0004c2240, 0x1090b00, 0xc0004c2240, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc000396460)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 47 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc000396460, 0xc0004bc9c0, 0xc0003a3d80, 0x39, 0xc0003a3d80, 0x39, 0xc0004b0af0, 0xc0003b6c00)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 189 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a8f8bc0, 0x72, 0xc000dafa58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc0001c0198, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc0001c0198, 0xc000216000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc0001c0180, 0xc000216000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc0001c0180, 0xc000216000, 0x1000, 0x1000, 0xc000dafb88, 0xc000dafb68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0004f82a0, 0xc000216000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc0004fc810, 0xc000216000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc000409680)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc000409680, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc000226140, 0x11d6540, 0xc0001ce280, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc000226140, 0x11d6540, 0xc0001ce280)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 52 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc000180cd8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc000180cd0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc000592600, 0xc000516690)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 8 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x19, 0xc0005fbcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x19, 0xc0005fbcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc0005fbcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc00003b420, 0x1090b00, 0xc00003b420, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0000b0af0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 9 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0000b0af0, 0xc000180cd0, 0xc0005be300, 0x54, 0xc0005be300, 0x54, 0xc000192c80, 0xc000592600)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 53 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc00003e1b8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc00003e1b0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc000592800, 0xc000516720)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 49 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x1d, 0xc00061bcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x1d, 0xc00061bcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc00061bcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc0001ca040, 0x1090b00, 0xc0001ca040, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0001d4050)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 66 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0001d4050, 0xc00003e1b0, 0xc0005c82d0, 0x50, 0xc0005c82d0, 0x50, 0xc000030010, 0xc000592800)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 67 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc000516798)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc000516790)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0001cc200, 0xc00003e6f0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 54 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x21, 0xc00063bcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x21, 0xc00063bcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc00063bcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc0005c2500, 0x1090b00, 0xc0005c2500, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc000396500)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 55 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc000396500, 0xc000516790, 0xc0003949c0, 0x58, 0xc0003949c0, 0x58, 0xc0005b8740, 0xc0001cc200)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 56 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc000516b98)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc000516b90)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc000592c00, 0xc000516b30)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 57 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x25, 0xc00065bcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x25, 0xc00065bcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc00065bcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc0005c3120, 0x1090b00, 0xc0005c3120, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0005b2aa0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 58 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0005b2aa0, 0xc000516b90, 0xc0005bf080, 0x54, 0xc0005bf080, 0x54, 0xc0005b9160, 0xc000592c00)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 59 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0001bc0c8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0001bc0c0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc000593500, 0xc000516e80)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 10 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x29, 0xc00067bcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x29, 0xc00067bcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc00067bcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000474000, 0x1090b00, 0xc000474000, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0004e5810)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 11 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0004e5810, 0xc0001bc0c0, 0xc0005c8820, 0x50, 0xc0005c8820, 0x50, 0xc0001b8010, 0xc000593500)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 12 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc000516ee8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc000516ee0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0002b6500, 0xc0001bc240)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 60 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x2d, 0xc00069bcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x2d, 0xc00069bcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc00069bcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000393020, 0x1090b00, 0xc000393020, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0005b2d70)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 61 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0005b2d70, 0xc000516ee0, 0xc0004c0960, 0x58, 0xc0004c0960, 0x58, 0xc0001aecd0, 0xc0002b6500)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 62 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc00003e778)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc00003e770)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc000593900, 0xc0005170b0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 68 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x31, 0xc0006bbcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x31, 0xc0006bbcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc0006bbcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc0001ca0c0, 0x1090b00, 0xc0001ca0c0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0001d41e0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 69 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0001d41e0, 0xc00003e770, 0xc000207020, 0x54, 0xc000207020, 0x54, 0xc000030db0, 0xc000593900)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 70 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0001bc2c8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0001bc2c0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0001cc700, 0xc00003e8e0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 13 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x35, 0xc0006dbcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x35, 0xc0006dbcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc0006dbcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000474760, 0x1090b00, 0xc000474760, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0004e5950)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 14 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0004e5950, 0xc0001bc2c0, 0xc0001f04b0, 0x50, 0xc0001f04b0, 0x50, 0xc0001b88c0, 0xc0001cc700)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 15 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0001c40b8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0001c40b0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0002b6800, 0xc0001bc5a0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 21 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x39, 0xc0006fbcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x39, 0xc0006fbcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc0006fbcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc0004c2000, 0x1090b00, 0xc0004c2000, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0002a4050)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 22 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0002a4050, 0xc0001c40b0, 0xc0004c0fc0, 0x58, 0xc0004c0fc0, 0x58, 0xc000282000, 0xc0002b6800)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 23 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc00003e948)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc00003e940)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0003b6d00, 0xc0001c4890)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 71 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x3d, 0xc00071bcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x3d, 0xc00071bcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc00071bcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000388160, 0x1090b00, 0xc000388160, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0001d46e0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 72 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0001d46e0, 0xc00003e940, 0xc00003d020, 0x54, 0xc00003d020, 0x54, 0xc000031540, 0xc0003b6d00)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 73 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc00003e9d8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc00003e9d0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0001cc800, 0xc00003e970)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 74 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x41, 0xc00073bcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x41, 0xc00073bcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc00073bcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc0003881a0, 0x1090b00, 0xc0003881a0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0001d47d0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 75 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0001d47d0, 0xc00003e9d0, 0xc0001f07d0, 0x50, 0xc0001f07d0, 0x50, 0xc000031640, 0xc0001cc800)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 76 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0001c49c8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0001c49c0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0001cc900, 0xc00003eae0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 24 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x45, 0xc00075bcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x45, 0xc00075bcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc00075bcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc0004c3920, 0x1090b00, 0xc0004c3920, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0000b0140)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 25 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0000b0140, 0xc0001c49c0, 0xc000395ce0, 0x58, 0xc000395ce0, 0x58, 0xc000282fa0, 0xc0001cc900)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 26 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc000517118)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc000517110)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0003b7100, 0xc0001c4f30)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 63 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x49, 0xc00077bcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x49, 0xc00077bcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc00077bcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000393c40, 0x1090b00, 0xc000393c40, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0005b3090)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 64 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0005b3090, 0xc000517110, 0xc00003d800, 0x54, 0xc00003d800, 0x54, 0xc0001af570, 0xc0003b7100)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 65 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0001bc628)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0001bc620)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc000593d00, 0xc000517240)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 16 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x4d, 0xc0007abcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x4d, 0xc0007abcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc0007abcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000474c60, 0x1090b00, 0xc000474c60, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0004e5a40)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 82 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0004e5a40, 0xc0001bc620, 0xc0005c8d70, 0x50, 0xc0005c8d70, 0x50, 0xc0001b8e40, 0xc000593d00)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 83 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc00003eb58)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc00003eb50)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0002b6b00, 0xc0001bc750)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 77 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x51, 0xc0007cbcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x51, 0xc0007cbcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc0007cbcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000388220, 0x1090b00, 0xc000388220, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0001d4870)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 78 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0001d4870, 0xc00003eb50, 0xc0004c17a0, 0x58, 0xc0004c17a0, 0x58, 0xc0000317c0, 0xc0002b6b00)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 79 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0001c5058)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0001c5050)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0001ccd00, 0xc00003edf0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 27 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x55, 0xc0007fbcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x55, 0xc0007fbcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc0007fbcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc00003aac0, 0x1090b00, 0xc00003aac0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0000b04b0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 28 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0000b04b0, 0xc0001c5050, 0xc00001a4e0, 0x54, 0xc00001a4e0, 0x54, 0xc000283780, 0xc0001ccd00)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 29 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0001bc7d8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0001bc7d0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0003b7400, 0xc0001c5580)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 84 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x59, 0xc00081bcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x59, 0xc00081bcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc00081bcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc0004750a0, 0x1090b00, 0xc0004750a0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0004e5b80)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 85 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0004e5b80, 0xc0001bc7d0, 0xc000038b90, 0x50, 0xc000038b90, 0x50, 0xc0001b9320, 0xc0003b7400)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 86 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc00003ee68)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc00003ee60)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0002b7300, 0xc0001bc990)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 80 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x5d, 0xc00084bcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x5d, 0xc00084bcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc00084bcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000388b40, 0x1090b00, 0xc000388b40, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0001d4b90)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 81 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0001d4b90, 0xc00003ee60, 0xc000794000, 0x58, 0xc000794000, 0x58, 0xc0003f8240, 0xc0002b7300)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 98 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0001c56e8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0001c56e0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0001cd500, 0xc00003f040)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 30 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x61, 0xc00088bcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x61, 0xc00088bcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc00088bcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc00003b340, 0x1090b00, 0xc00003b340, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0000b05f0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 31 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0000b05f0, 0xc0001c56e0, 0xc00001ad80, 0x54, 0xc00001ad80, 0x54, 0xc000283c70, 0xc0001cd500)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 32 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0001bca08)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0001bca00)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0003b7600, 0xc0001c5980)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 87 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x65, 0xc0008abcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x65, 0xc0008abcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc0008abcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc0004757e0, 0x1090b00, 0xc0004757e0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0004e5c70)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 88 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0004e5c70, 0xc0001bca00, 0xc000038eb0, 0x50, 0xc000038eb0, 0x50, 0xc0001b9b80, 0xc0003b7600)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 89 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc00003f0b8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc00003f0b0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0002b7900, 0xc0001bcb70)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 99 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x69, 0xc0008dbcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x69, 0xc0008dbcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc0008dbcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc0003896c0, 0x1090b00, 0xc0003896c0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0001d4f50)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 100 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0001d4f50, 0xc00003f0b0, 0xc000794a20, 0x58, 0xc000794a20, 0x58, 0xc0003f8dc0, 0xc0002b7900)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 101 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc00003f468)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc00003f460)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0001cd900, 0xc00003f290)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 102 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x6d, 0xc000913cf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x6d, 0xc000913cf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc000913cf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc0008740a0, 0x1090b00, 0xc0008740a0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0001d5270)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 103 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0001d5270, 0xc00003f460, 0xc00001b560, 0x54, 0xc00001b560, 0x54, 0xc0003f97e0, 0xc0001cd900)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 104 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0001bcbd8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0001bcbd0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0001cdd00, 0xc00023a170)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 90 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x71, 0xc000955cf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x71, 0xc000955cf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc000955cf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000475f60, 0x1090b00, 0xc000475f60, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0004e5d60)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 91 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0004e5d60, 0xc0001bcbd0, 0xc0001f1220, 0x50, 0xc0001f1220, 0x50, 0xc0004b05c0, 0xc0001cdd00)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 92 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0001c5ac8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0001c5ac0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0002b7f00, 0xc0001bcdc0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 33 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x75, 0xc000985cf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x75, 0xc000985cf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc000985cf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc00003ba20, 0x1090b00, 0xc00003ba20, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0000b0730)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 114 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0000b0730, 0xc0001c5ac0, 0xc000795440, 0x58, 0xc000795440, 0x58, 0xc000498310, 0xc0002b7f00)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 115 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0003fc078)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0003fc070)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0003b7b00, 0xc0003fc010)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 116 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x79, 0xc0009b5cf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x79, 0xc0009b5cf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc0009b5cf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc00093c5e0, 0x1090b00, 0xc00093c5e0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0000b0cd0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 117 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0000b0cd0, 0xc0003fc070, 0xc00045efc0, 0x54, 0xc00045efc0, 0x54, 0xc000498ce0, 0xc0003b7b00)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 118 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0001bce48)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0001bce40)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0003b7e00, 0xc0003fc170)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 93 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x7d, 0xc0009f5cf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x7d, 0xc0009f5cf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc0009f5cf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc00092c680, 0x1090b00, 0xc00092c680, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0004e5e50)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 94 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0004e5e50, 0xc0001bce40, 0xc0000393b0, 0x50, 0xc0000393b0, 0x50, 0xc0004b11a0, 0xc0003b7e00)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 95 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0003fc1d8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0003fc1d0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc000124200, 0xc0001bcfd0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 119 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x81, 0xc000a25cf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x81, 0xc000a25cf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc000a25cf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc00093cc20, 0x1090b00, 0xc00093cc20, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0000b0dc0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 120 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0000b0dc0, 0xc0003fc1d0, 0xc000795ec0, 0x58, 0xc000795ec0, 0x58, 0xc000499210, 0xc000124200)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 121 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc00023a238)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc00023a230)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0009de200, 0xc0003fc7e0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 105 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x85, 0xc000a5dcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x85, 0xc000a5dcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc000a5dcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000874a60, 0x1090b00, 0xc000874a60, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0001d5400)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 106 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0001d5400, 0xc00023a230, 0xc0009e2000, 0x54, 0xc0009e2000, 0x54, 0xc0003f9fd0, 0xc0009de200)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 107 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0001bd068)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0001bd060)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc000a36000, 0xc00023a6a0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 96 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x89, 0xc000a8dcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x89, 0xc000a8dcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc000a8dcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc00092cba0, 0x1090b00, 0xc00092cba0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0004e5f40)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 97 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0004e5f40, 0xc0001bd060, 0xc0001f1540, 0x50, 0xc0001f1540, 0x50, 0xc0002c8dc0, 0xc000a36000)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 130 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0003fc848)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0003fc840)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc000124500, 0xc0001bd1d0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 122 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x8d, 0xc000abdcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x8d, 0xc000abdcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc000abdcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc00093d700, 0x1090b00, 0xc00093d700, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0000b10e0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 123 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0000b10e0, 0xc0003fc840, 0xc000a38540, 0x58, 0xc000a38540, 0x58, 0xc000499af0, 0xc000124500)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 124 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc00023a778)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc00023a770)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0009de600, 0xc0003fca00)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 108 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x91, 0xc000af5cf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x91, 0xc000af5cf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc000af5cf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000875080, 0x1090b00, 0xc000875080, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0001d5590)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 109 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0001d5590, 0xc00023a770, 0xc0009e2900, 0x52, 0xc0009e2900, 0x52, 0xc0004fe470, 0xc0009de600)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 110 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc00023aa98)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc00023aa90)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc000a36100, 0xc00023a9d4)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 111 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x95, 0xc000b15cf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x95, 0xc000b15cf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc000b15cf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000875160, 0x1090b00, 0xc000875160, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0001d5680)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 112 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0001d5680, 0xc00023aa90, 0xc0008eed20, 0x52, 0xc0008eed20, 0x52, 0xc0004fe630, 0xc000a36100)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 113 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0003fca68)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0003fca60)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc000a36600, 0xc00023ae40)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 125 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x99, 0xc000b55cf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x99, 0xc000b55cf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc000b55cf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000a4a1c0, 0x1090b00, 0xc000a4a1c0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0000b1450)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 126 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0000b1450, 0xc0003fca60, 0xc0008ef560, 0x52, 0xc0008ef560, 0x52, 0xc000192dc0, 0xc000a36600)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 127 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0001bd258)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0001bd250)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0009de700, 0xc0003fcb10)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 131 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0x9d, 0xc000b75cf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0x9d, 0xc000b75cf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc000b75cf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc00092cf20, 0x1090b00, 0xc00092cf20, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc000a44050)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 132 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc000a44050, 0xc0001bd250, 0xc0009e2ea0, 0x52, 0xc0009e2ea0, 0x52, 0xc0002c9480, 0xc0009de700)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 133 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc00023b128)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc00023b120)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc000124900, 0xc0001bd320)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 146 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0xa1, 0xc000ba5cf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0xa1, 0xc000ba5cf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc000ba5cf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000875920, 0x1090b00, 0xc000875920, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0001d5770)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 147 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0001d5770, 0xc00023b120, 0xc000a38c60, 0x52, 0xc000a38c60, 0x52, 0xc0004fefc0, 0xc000124900)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 148 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0003fcbe8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0003fcbe0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc000a36800, 0xc00023b290)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 128 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0xa5, 0xc000bddcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0xa5, 0xc000bddcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc000bddcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000a4a260, 0x1090b00, 0xc000a4a260, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0000b1540)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 129 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0000b1540, 0xc0003fcbe0, 0xc0008efc80, 0x52, 0xc0008efc80, 0x52, 0xc000192ef0, 0xc000a36800)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 162 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0001bd388)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0001bd380)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc0009de900, 0xc0003fcf90)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 134 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0xa9, 0xc000c0dcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0xa9, 0xc000c0dcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc000c0dcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc00092d220, 0x1090b00, 0xc00092d220, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc000a44190)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 135 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc000a44190, 0xc0001bd380, 0xc0009e35c0, 0x52, 0xc0009e35c0, 0x52, 0xc0002c98e0, 0xc0009de900)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 136 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc00023b378)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc00023b370)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc000124b00, 0xc0001bd670)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 149 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0xad, 0xc000c3dcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0xad, 0xc000c3dcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc000c3dcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000875c00, 0x1090b00, 0xc000875c00, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc0001d5860)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 150 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc0001d5860, 0xc00023b370, 0xc000a39380, 0x52, 0xc000a39380, 0x52, 0xc0004ff3b0, 0xc000124b00)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 151 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0001bd6d8)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0001bd6d0)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc000a37400, 0xc0004bc320)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 137 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0xb1, 0xc000c85cf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0xb1, 0xc000c85cf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bcb3, 0xc000c85cf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc00092d640, 0x1090b00, 0xc00092d640, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc000a44280)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 138 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc000a44280, 0xc0001bd6d0, 0xc000bca7e0, 0x52, 0xc000bca7e0, 0x52, 0xc0002c9e30, 0xc000a37400)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 139 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0001bdd48)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0001bdd40)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc000125900, 0xc0001bdcc0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 140 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0xb5, 0xc000d3dcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0xb5, 0xc000d3dcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bc64, 0xc000d3dcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000c2ca20, 0x1090b00, 0xc000c2ca20, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc000a44370)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 141 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc000a44370, 0xc0001bdd40, 0xc000a39f80, 0x52, 0xc000a39f80, 0x52, 0xc000c5f8b0, 0xc000125900)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 142 [semacquire, 4 minutes]:
sync.runtime_Semacquire(0xc0002a3338)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0002a3330)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1(0xc000125e00, 0xc0002a32b4)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:345 +0x2e6
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:285 +0x75

goroutine 143 [syscall, 4 minutes]:
syscall.Syscall6(0xe8, 0xb9, 0xc000d1dcf4, 0x7, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0)
	/usr/local/go/src/syscall/asm_linux_amd64.s:44 +0x5
gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix.EpollWait(0xb9, 0xc000d1dcf4, 0x7, 0x7, 0xffffffffffffffff, 0x42bc64, 0xc000d1dcf0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/golang.org/x/sys/unix/zsyscall_linux_amd64.go:1760 +0x72
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*fdPoller).wait(0xc000c2d300, 0x1090b00, 0xc000c2d300, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify_poller.go:86 +0x91
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.(*Watcher).readEvents(0xc000a44500)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:192 +0x195
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify.NewWatcher
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/fsnotify/fsnotify/inotify.go:59 +0x1a8

goroutine 144 [select, 4 minutes]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1.1(0xc000a44500, 0xc0002a3330, 0xc000a42ac0, 0x3a, 0xc000a42ac0, 0x3a, 0xc000c98220, 0xc000125e00)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:306 +0xec
created by gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper.(*Viper).WatchConfig.func1
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/spf13/viper/viper.go:304 +0x29f

goroutine 180 [select, 4 minutes]:
database/sql.(*DB).connectionOpener(0xc0005a8540, 0x11d6540, 0xc0004ecb40)
	/usr/local/go/src/database/sql/sql.go:1001 +0xe8
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:671 +0x15d

goroutine 181 [select, 4 minutes]:
database/sql.(*DB).connectionResetter(0xc0005a8540, 0x11d6540, 0xc0004ecb40)
	/usr/local/go/src/database/sql/sql.go:1014 +0xfb
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:672 +0x193

goroutine 280053 [runnable]:
net/http.(*persistConn).writeLoop(0xc000939560)
	/usr/local/go/src/net/http/transport.go:1885 +0x113
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1339 +0x966

goroutine 186 [select, 4 minutes]:
database/sql.(*DB).connectionOpener(0xc0003c8000, 0x11d6540, 0xc0001ce200)
	/usr/local/go/src/database/sql/sql.go:1001 +0xe8
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:671 +0x15d

goroutine 187 [select, 4 minutes]:
database/sql.(*DB).connectionResetter(0xc0003c8000, 0x11d6540, 0xc0001ce200)
	/usr/local/go/src/database/sql/sql.go:1014 +0xfb
created by database/sql.OpenDB
	/usr/local/go/src/database/sql/sql.go:672 +0x193

goroutine 155 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a8f8c90, 0x72, 0xc000e4da58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000590518, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000590518, 0xc0005eb000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc000590500, 0xc0005eb000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc000590500, 0xc0005eb000, 0x1000, 0x1000, 0xc000e4db88, 0xc000e4db68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0001ba080, 0xc0005eb000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc000345530, 0xc0005eb000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc0004c4300)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc0004c4300, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc0001d8280, 0x11d6540, 0xc000078640, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc0001d8280, 0x11d6540, 0xc000078640)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 280056 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a883980, 0x72, 0xc000ddba88)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000cec598, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000cec598, 0xc000363000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc000cec580, 0xc000363000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc000cec580, 0xc000363000, 0x1000, 0x1000, 0xc000ddbb70, 0x4569a0, 0xc000e05680)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0001c8170, 0xc000363000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*persistConn).Read(0xc00046a480, 0xc000363000, 0x1000, 0x1000, 0xc000ddbc70, 0x406895, 0xc00045e4e0)
	/usr/local/go/src/net/http/transport.go:1497 +0x75
bufio.(*Reader).fill(0xc0001a9500)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc0001a9500, 0x1, 0x0, 0x0, 0x1, 0xc0008ee720, 0x0)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*persistConn).readLoop(0xc00046a480)
	/usr/local/go/src/net/http/transport.go:1645 +0x1a2
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1338 +0x941

goroutine 280106 [runnable]:
net/http.setRequestCancel.func3(0x0, 0xc000a4c7e0, 0xc000e639a0, 0xc000e1c3cc, 0xc0002075c0)
	/usr/local/go/src/net/http/client.go:320
created by net/http.setRequestCancel
	/usr/local/go/src/net/http/client.go:320 +0x24e

goroutine 279916 [select]:
net/http.(*persistConn).writeLoop(0xc0002e30e0)
	/usr/local/go/src/net/http/transport.go:1885 +0x113
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1339 +0x966

goroutine 508 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a883f30, 0x72, 0xc001163a58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000cac398, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000cac398, 0xc000e88000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc000cac380, 0xc000e88000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc000cac380, 0xc000e88000, 0x1000, 0x1000, 0xc001163b88, 0xc001163b68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0004f8fb0, 0xc000e88000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc00093f110, 0xc000e88000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc00036a9c0)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc00036a9c0, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc00026f040, 0x11d6540, 0xc000381940, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc00026f040, 0x11d6540, 0xc000381940)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 277109 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a9086c8, 0x72, 0xc000f21a58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000f1af98, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000f1af98, 0xc0010ad000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc000f1af80, 0xc0010ad000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc000f1af80, 0xc0010ad000, 0x1000, 0x1000, 0xc000f21b88, 0xc000f21b68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc00000ef70, 0xc0010ad000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc0001b5f20, 0xc0010ad000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc000c28060)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc000c28060, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc000226000, 0x11d6540, 0xc0001b1580, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc000226000, 0x11d6540, 0xc0001b1580)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 90331 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a8f8e30, 0x72, 0xc000db1a58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc0004adf18, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc0004adf18, 0xc000942000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc0004adf00, 0xc000942000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc0004adf00, 0xc000942000, 0x1000, 0x1000, 0xc000db1bb8, 0xc000db1b68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0004f8818, 0xc000942000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc0004fd290, 0xc000942000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc000fbc240)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc000fbc240, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc000290fa0, 0x11d6540, 0xc000e99680, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc000290fa0, 0x11d6540, 0xc000e99680)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 784 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a8f8af0, 0x72, 0xc001081a58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000591198, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000591198, 0xc00105b000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc000591180, 0xc00105b000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc000591180, 0xc00105b000, 0x1000, 0x1000, 0xc001081b88, 0xc001081b68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0001c95e0, 0xc00105b000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc00093fe90, 0xc00105b000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc000383440)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc000383440, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc00026e140, 0x11d6540, 0xc000bf6c00, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc00026e140, 0x11d6540, 0xc000bf6c00)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 7863 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a884270, 0x72, 0xc000fa9a58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc0002bd918, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc0002bd918, 0xc000cb2000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc0002bd900, 0xc000cb2000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc0002bd900, 0xc000cb2000, 0x1000, 0x1000, 0xc000fa9b88, 0xc000fa9b68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0004f8600, 0xc000cb2000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc0010381e0, 0xc000cb2000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc0004d7320)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc0004d7320, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc0002adea0, 0x11d6540, 0xc001092980, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc0002adea0, 0x11d6540, 0xc001092980)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 11296 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a8840d0, 0x72, 0xc001161a58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000590a18, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000590a18, 0xc000e55000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc000590a00, 0xc000e55000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc000590a00, 0xc000e55000, 0x1000, 0x1000, 0xc001161bb8, 0xc001161b68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc00000e5a8, 0xc000e55000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc00093e930, 0xc000e55000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc0009a3620)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc0009a3620, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc000fb2140, 0x11d6540, 0xc001040540, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc000fb2140, 0x11d6540, 0xc001040540)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 280052 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a908118, 0x72, 0xc001067a88)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc0001a7398, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc0001a7398, 0xc001025000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc0001a7380, 0xc001025000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc0001a7380, 0xc001025000, 0x1000, 0x1000, 0xc001067b70, 0x4569a0, 0xc000cbf800)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0001c8130, 0xc001025000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*persistConn).Read(0xc000939560, 0xc001025000, 0x1000, 0x1000, 0xc001067c70, 0x406895, 0xc00045e360)
	/usr/local/go/src/net/http/transport.go:1497 +0x75
bufio.(*Reader).fill(0xc0001a86c0)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc0001a86c0, 0x1, 0x0, 0x0, 0x1, 0xc00045eb40, 0x0)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*persistConn).readLoop(0xc000939560)
	/usr/local/go/src/net/http/transport.go:1645 +0x1a2
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1338 +0x941

goroutine 280095 [select]:
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*libraryFactorManage).Do(0xc000119ea0, 0x0, 0x0, 0x0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_library.go:101 +0x318
gitlab.liebaopay.com/liveme/risk/gateway/pkg.LibraryFactor(0x1ad83f1, 0x1, 0xc000392fc0, 0x11, 0xc0005b3130, 0xc00092f6e0, 0xc0003f2160, 0xc000393ec0, 0xc000392fc0, 0x11, ...)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_library.go:163 +0xff
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*factorManage).GetExpressionFromListFactorConfig(0xc000b45040, 0x1ad83f1, 0x1, 0xc000392fc0, 0x11, 0xc0005b3130, 0xc00092f6e0, 0xc0004a1200, 0xc000392fc0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor.go:84 +0x81
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*factorManage).GetExpressionFromListFactorConfig-fm(0x1ad83f1, 0x1, 0xc000392fc0, 0x11, 0xc0005b3130, 0xc00092f6e0, 0xc000392fc0, 0x11)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor.go:51 +0x69
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*factorManage).GetExpression(0xc000b45040, 0x1ad83f1, 0x1, 0xc000392fc0, 0x11, 0xc0005b3130, 0xc00092f6e0, 0x1092a80, 0xc00040fae8)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor.go:60 +0x101
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*ruleManage).ReplaceFactors(0xc001085da0, 0xc0001ce380, 0xc00092f6e0, 0x1ad83f1, 0x1)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/rule.go:65 +0x2a0
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*ruleManage).RunRule(0xc00040fda0, 0xc0001ce380, 0xc00092f6e0, 0xc0001ce380, 0x1b1fb40)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/rule.go:77 +0x3f
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*eventManage).RunRuleConf(0x1b3e668, 0xc0003f2160, 0x1ad83f1, 0x1, 0x1d, 0xc0004bc0b0, 0xe, 0xc000ad3e00, 0x30, 0xc0005960f0, ...)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/event.go:156 +0x2a8
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*eventManage).DoByOrder.func1(0xc00003e960, 0xc0003f2160, 0xc000bfc600, 0x1b3e668, 0x1ad83f1, 0x1, 0x1d, 0xc0004bc0b0, 0xe, 0xc000ad3e00, ...)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/event.go:107 +0x15f
created by gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*eventManage).DoByOrder
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/event.go:91 +0x39e

goroutine 747 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a8f82d0, 0x72, 0xc000db3a58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc0002bc818, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc0002bc818, 0xc000dea000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc0002bc800, 0xc000dea000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc0002bc800, 0xc000dea000, 0x1000, 0x1000, 0xc000db3b88, 0xc000db3b68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0001c8070, 0xc000dea000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc000c61710, 0xc000dea000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc000368c00)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc000368c00, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc000230aa0, 0x11d6540, 0xc000380400, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc000230aa0, 0x11d6540, 0xc000380400)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 280103 [select]:
net/http.(*persistConn).roundTrip(0xc000939560, 0xc000a4c810, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/transport.go:2101 +0x56a
net/http.(*Transport).roundTrip(0x1b12be0, 0xc000a36f00, 0xc000a4c7e0, 0xc000e1c3cc, 0xc000e1c3d0)
	/usr/local/go/src/net/http/transport.go:465 +0x9b1
net/http.(*Transport).RoundTrip(0x1b12be0, 0xc000a36f00, 0x1b12be0, 0xbf4fbc4b719e3107, 0x458ee3b9d6)
	/usr/local/go/src/net/http/roundtrip.go:17 +0x35
net/http.send(0xc000a36e00, 0x11cc740, 0x1b12be0, 0xbf4fbc4b719e3107, 0x458ee3b9d6, 0x1b1fb40, 0xc0001c9270, 0xbf4fbc4b719e3107, 0xc000e4f728, 0x1)
	/usr/local/go/src/net/http/client.go:250 +0x14b
net/http.(*Client).send(0xc0005b7b60, 0xc000a36e00, 0xbf4fbc4b719e3107, 0x458ee3b9d6, 0x1b1fb40, 0xc0001c9270, 0x0, 0x1, 0x1ee)
	/usr/local/go/src/net/http/client.go:174 +0xfa
net/http.(*Client).do(0xc0005b7b60, 0xc000a36e00, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/client.go:641 +0x2a8
net/http.(*Client).Do(0xc0005b7b60, 0xc000a36e00, 0xc000cedb80, 0x45, 0xc000a36d00)
	/usr/local/go/src/net/http/client.go:509 +0x35
gitlab.liebaopay.com/liveme/risk/gateway/libs/elastic/v7.(*Client).PerformRequest(0xc0005c0000, 0x11d6580, 0xc00003e0b0, 0x1059628, 0x4, 0xc0001c3bf0, 0x2d, 0xc000a4c6f0, 0x0, 0x0, ...)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/libs/elastic/v7/client.go:1350 +0x411
gitlab.liebaopay.com/liveme/risk/gateway/libs/elastic/v7.(*IndicesExistsService).Do(0xc000e4fd78, 0x11d6580, 0xc00003e0b0, 0x1b3e668, 0x0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/libs/elastic/v7/indices_exists.go:136 +0x167
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*aggrFactorESData).add(0xc0005a86c0, 0x0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_aggr.go:74 +0x1fe
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*aggrFactorESData).Add(0xc0005a86c0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_aggr.go:53 +0x4f
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*aggrFactor).Add(0xc000259220, 0xc00093cbc0, 0x11, 0xc0001d54a0, 0xc00092f6e0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_aggr.go:455 +0x75
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*aggrFactor).WalkAggrFactor.func1(0xc000ff3840, 0xc000259220, 0x1b3e668, 0xc00092f6e0, 0xc00093cbc0, 0x11)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_aggr.go:407 +0xc8
created by gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*aggrFactor).WalkAggrFactor
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_aggr.go:395 +0x1f7

goroutine 279607 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a908ba8, 0x72, 0xc00106ba88)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000eccf98, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000eccf98, 0xc000ec8000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc000eccf80, 0xc000ec8000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc000eccf80, 0xc000ec8000, 0x1000, 0x1000, 0xc00106bb70, 0x4569a0, 0xc000cbec00)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0005892c0, 0xc000ec8000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*persistConn).Read(0xc000ce9d40, 0xc000ec8000, 0x1000, 0x1000, 0xc00106bc70, 0x406895, 0xc000794a80)
	/usr/local/go/src/net/http/transport.go:1497 +0x75
bufio.(*Reader).fill(0xc0009da3c0)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc0009da3c0, 0x1, 0x0, 0x0, 0x1, 0xc00001ab40, 0x0)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*persistConn).readLoop(0xc000ce9d40)
	/usr/local/go/src/net/http/transport.go:1645 +0x1a2
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1338 +0x941

goroutine 280094 [semacquire]:
sync.runtime_Semacquire(0xc00003e968)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc00003e960)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*eventManage).DoByOrder(0x1b3e668, 0xc0003f2160, 0x1ad83f1, 0x1, 0x1d, 0xc0004bc0b0, 0xe, 0xc000ad3e00, 0x30, 0xc0005960f0, ...)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/event.go:110 +0x3cb
gitlab.liebaopay.com/liveme/risk/gateway/v1/views.PostEvent.func3(0xc0004f7a20, 0xc0003f2160, 0x1b3e668, 0xc00092f6e0, 0x1ad83f1, 0x1, 0xc0004f8650, 0xc00100eba0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/v1/views/event.go:111 +0x1c3
created by gitlab.liebaopay.com/liveme/risk/gateway/v1/views.PostEvent
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/v1/views/event.go:98 +0x4fd

goroutine 5878 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a908c78, 0x72, 0xc001167a58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000cad918, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000cad918, 0xc000e43000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc000cad900, 0xc000e43000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc000cad900, 0xc000e43000, 0x1000, 0x1000, 0xc001167bb8, 0xc001167b68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0001c8c10, 0xc000e43000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc0004a11a0, 0xc000e43000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc00102eae0)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc00102eae0, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc000281360, 0x11d6540, 0xc001010f00, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc000281360, 0x11d6540, 0xc001010f00)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 280104 [select]:
net/http.(*persistConn).roundTrip(0xc00046a480, 0xc00009df20, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/transport.go:2101 +0x56a
net/http.(*Transport).roundTrip(0x1b12be0, 0xc000592b00, 0xc00009dce0, 0xc000ff398c, 0xc000ff3990)
	/usr/local/go/src/net/http/transport.go:465 +0x9b1
net/http.(*Transport).RoundTrip(0x1b12be0, 0xc000592b00, 0x1b12be0, 0xbf4fbc4b718d136c, 0x458ed29c3e)
	/usr/local/go/src/net/http/roundtrip.go:17 +0x35
net/http.send(0xc000592900, 0x11cc740, 0x1b12be0, 0xbf4fbc4b718d136c, 0x458ed29c3e, 0x1b1fb40, 0xc0001c8548, 0xbf4fbc4b718d136c, 0xc000e33728, 0x1)
	/usr/local/go/src/net/http/client.go:250 +0x14b
net/http.(*Client).send(0xc0005b7b60, 0xc000592900, 0xbf4fbc4b718d136c, 0x458ed29c3e, 0x1b1fb40, 0xc0001c8548, 0x0, 0x1, 0x0)
	/usr/local/go/src/net/http/client.go:174 +0xfa
net/http.(*Client).do(0xc0005b7b60, 0xc000592900, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/client.go:641 +0x2a8
net/http.(*Client).Do(0xc0005b7b60, 0xc000592900, 0xc000038be0, 0x46, 0xc000592700)
	/usr/local/go/src/net/http/client.go:509 +0x35
gitlab.liebaopay.com/liveme/risk/gateway/libs/elastic/v7.(*Client).PerformRequest(0xc0005c0000, 0x11d6580, 0xc00003e0b0, 0x1059628, 0x4, 0xc0001c3560, 0x2d, 0xc00009da10, 0x0, 0x0, ...)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/libs/elastic/v7/client.go:1350 +0x411
gitlab.liebaopay.com/liveme/risk/gateway/libs/elastic/v7.(*IndicesExistsService).Do(0xc000e33d78, 0x11d6580, 0xc00003e0b0, 0x1b3e668, 0x0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/libs/elastic/v7/indices_exists.go:136 +0x167
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*aggrFactorESData).add(0xc0005a8480, 0x0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_aggr.go:74 +0x1fe
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*aggrFactorESData).Add(0xc0005a8480)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_aggr.go:53 +0x4f
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*aggrFactor).Add(0xc000259220, 0xc000875040, 0x11, 0xc0003963c0, 0xc00092f6e0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_aggr.go:455 +0x75
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*aggrFactor).WalkAggrFactor.func1(0xc000ff3840, 0xc000259220, 0x1b3e668, 0xc00092f6e0, 0xc000875040, 0x11)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_aggr.go:407 +0xc8
created by gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*aggrFactor).WalkAggrFactor
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_aggr.go:395 +0x1f7

goroutine 279608 [select]:
net/http.(*persistConn).writeLoop(0xc000ce9d40)
	/usr/local/go/src/net/http/transport.go:1885 +0x113
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1339 +0x966

goroutine 259 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a8f8470, 0x72, 0xc000f4fa58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc0001c0398, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc0001c0398, 0xc000e23000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc0001c0380, 0xc000e23000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc0001c0380, 0xc000e23000, 0x1000, 0x1000, 0xc000f4fb88, 0xc000f4fb68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc000588ee0, 0xc000e23000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc000194e70, 0xc000e23000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc0004c5020)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc0004c5020, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc000460280, 0x11d6540, 0xc0001cffc0, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc000460280, 0x11d6540, 0xc0001cffc0)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 280105 [runnable]:
net/http.setRequestCancel.func3(0x0, 0xc00009dce0, 0xc000e3f7c0, 0xc000ff398c, 0xc00001baa0)
	/usr/local/go/src/net/http/client.go:320
created by net/http.setRequestCancel
	/usr/local/go/src/net/http/client.go:320 +0x24e

goroutine 952 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a8f83a0, 0x72, 0xc000c5da58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc0001a7318, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc0001a7318, 0xc000d09000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc0001a7300, 0xc000d09000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc0001a7300, 0xc000d09000, 0x1000, 0x1000, 0xc000c5db88, 0xc000c5db68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc00000ede8, 0xc000d09000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc0004a07b0, 0xc000d09000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc00007cf60)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc00007cf60, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc000187b80, 0x11d6540, 0xc0002b94c0, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc000187b80, 0x11d6540, 0xc0002b94c0)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 279869 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a8f8a20, 0x72, 0xc000d61a88)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc0002bcb98, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc0002bcb98, 0xc000da8000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc0002bcb80, 0xc000da8000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc0002bcb80, 0xc000da8000, 0x1000, 0x1000, 0xc000d61b70, 0x4569a0, 0xc000b90780)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0001c9538, 0xc000da8000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*persistConn).Read(0xc0000b2900, 0xc000da8000, 0x1000, 0x1000, 0xc000d61c70, 0x406895, 0xc000206de0)
	/usr/local/go/src/net/http/transport.go:1497 +0x75
bufio.(*Reader).fill(0xc000f56000)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc000f56000, 0x1, 0x0, 0x0, 0x1, 0xc00001b2c0, 0x0)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*persistConn).readLoop(0xc0000b2900)
	/usr/local/go/src/net/http/transport.go:1645 +0x1a2
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1338 +0x941

goroutine 55715 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a9250b0, 0x72, 0xc000c59a58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc0001c1818, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc0001c1818, 0xc000d89000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc0001c1800, 0xc000d89000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc0001c1800, 0xc000d89000, 0x1000, 0x1000, 0xc000c59b88, 0xc000c59b68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0001c8b98, 0xc000d89000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc000195800, 0xc000d89000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc000d8cfc0)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc000d8cfc0, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc000230d20, 0x11d6540, 0xc000bf6a80, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc000230d20, 0x11d6540, 0xc000bf6a80)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 2107 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a884680, 0x72, 0xc000e09a58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000f08118, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000f08118, 0xc001077000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc000f08100, 0xc001077000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc000f08100, 0xc001077000, 0x1000, 0x1000, 0xc000e09b88, 0xc000e09b68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0004f82e0, 0xc001077000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc0004fca20, 0xc001077000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc000ad0000)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc000ad0000, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc00026e000, 0x11d6540, 0xc0010401c0, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc00026e000, 0x11d6540, 0xc0010401c0)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 280114 [runnable]:
net/http.setRequestCancel.func3(0x0, 0xc000ffea80, 0xc000932640, 0xc00003eb9c, 0xc00045fb60)
	/usr/local/go/src/net/http/client.go:320
created by net/http.setRequestCancel
	/usr/local/go/src/net/http/client.go:320 +0x24e

goroutine 13388 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a9082b8, 0x72, 0xc000f23a58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000f1ae98, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000f1ae98, 0xc001036000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc000f1ae80, 0xc001036000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc000f1ae80, 0xc001036000, 0x1000, 0x1000, 0xc000f23bb8, 0xc000f23b68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc000588ce8, 0xc001036000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc000f19c50, 0xc001036000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc0001b3320)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc0001b3320, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc000fb34a0, 0x11d6540, 0xc000fc0b80, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc000fb34a0, 0x11d6540, 0xc000fc0b80)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 279915 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a908388, 0x72, 0xc000d72a88)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000ced098, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000ced098, 0xc000ffd000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc000ced080, 0xc000ffd000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc000ced080, 0xc000ffd000, 0x1000, 0x1000, 0xc000d72b70, 0x4569a0, 0xc00101e780)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0004f91c0, 0xc000ffd000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*persistConn).Read(0xc0002e30e0, 0xc000ffd000, 0x1000, 0x1000, 0xc000d72c70, 0x406895, 0xc000a39bc0)
	/usr/local/go/src/net/http/transport.go:1497 +0x75
bufio.(*Reader).fill(0xc000936d80)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc000936d80, 0x1, 0x0, 0x0, 0x1, 0xc00045ea80, 0x0)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*persistConn).readLoop(0xc0002e30e0)
	/usr/local/go/src/net/http/transport.go:1645 +0x1a2
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1338 +0x941

goroutine 280078 [select]:
net/http.(*persistConn).writeLoop(0xc0002bed80)
	/usr/local/go/src/net/http/transport.go:1885 +0x113
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1339 +0x966

goroutine 279217 [select]:
net/http.(*persistConn).writeLoop(0xc00106c120)
	/usr/local/go/src/net/http/transport.go:1885 +0x113
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1339 +0x966

goroutine 357 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a8844e0, 0x72, 0xc000e0ba58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000c9a498, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000c9a498, 0xc000e71000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc000c9a480, 0xc000e71000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc000c9a480, 0xc000e71000, 0x1000, 0x1000, 0xc000e0bb88, 0xc000e0bb68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0001ba338, 0xc000e71000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc0007e61e0, 0xc000e71000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc000bfd380)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc000bfd380, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc000460d20, 0x11d6540, 0xc000380640, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc000460d20, 0x11d6540, 0xc000380640)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 280096 [select]:
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*libraryFactorManage).Do(0xc0002408c0, 0x0, 0x0, 0x0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_library.go:101 +0x318
gitlab.liebaopay.com/liveme/risk/gateway/pkg.LibraryFactor(0x1ad83f1, 0x1, 0xc00093cbe0, 0x11, 0xc0001d5310, 0xc00092f6e0, 0xc0003f2160, 0xc0008742a0, 0xc00093cbe0, 0x11, ...)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_library.go:163 +0xff
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*factorManage).GetExpressionFromListFactorConfig(0xc000b451a0, 0x1ad83f1, 0x1, 0xc00093cbe0, 0x11, 0xc0001d5310, 0xc00092f6e0, 0xc0007e7b00, 0xc00093cbe0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor.go:84 +0x81
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*factorManage).GetExpressionFromListFactorConfig-fm(0x1ad83f1, 0x1, 0xc00093cbe0, 0x11, 0xc0001d5310, 0xc00092f6e0, 0xc00093cbe0, 0x11)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor.go:51 +0x69
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*factorManage).GetExpression(0xc000b451a0, 0x1ad83f1, 0x1, 0xc00093cbe0, 0x11, 0xc0001d5310, 0xc00092f6e0, 0x1092a80, 0xc00040fae8)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor.go:60 +0x101
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*ruleManage).ReplaceFactors(0xc000e53da0, 0xc0001cfac0, 0xc00092f6e0, 0x1ad83f1, 0x1)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/rule.go:65 +0x2a0
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*ruleManage).RunRule(0xc00040fda0, 0xc0001cfac0, 0xc00092f6e0, 0xc0001cfac0, 0x1b1fb40)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/rule.go:77 +0x3f
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*eventManage).RunRuleConf(0x1b3e668, 0xc0003f2160, 0x1ad83f1, 0x1, 0x1d, 0xc0004bc0b0, 0xe, 0xc000ad3e00, 0x30, 0xc0005960f0, ...)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/event.go:156 +0x2a8
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*eventManage).DoByOrder.func1(0xc00003e960, 0xc0003f2160, 0xc000bfc600, 0x1b3e668, 0x1ad83f1, 0x1, 0x1d, 0xc0004bc0b0, 0xe, 0xc000ad3e00, ...)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/event.go:107 +0x15f
created by gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*eventManage).DoByOrder
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/event.go:91 +0x39e

goroutine 280097 [select]:
net/http.(*persistConn).roundTrip(0xc00106c120, 0xc000ffeae0, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/transport.go:2101 +0x56a
net/http.(*Transport).roundTrip(0x1b12be0, 0xc000da4600, 0xc000ffea80, 0xc00003eb9c, 0xc00003ebb0)
	/usr/local/go/src/net/http/transport.go:465 +0x9b1
net/http.(*Transport).RoundTrip(0x1b12be0, 0xc000da4600, 0x1b12be0, 0xbf4fbc4b71959615, 0x458edb1ef1)
	/usr/local/go/src/net/http/roundtrip.go:17 +0x35
net/http.send(0xc000da4500, 0x11cc740, 0x1b12be0, 0xbf4fbc4b71959615, 0x458edb1ef1, 0x1b1fb40, 0xc0004f8ce0, 0xbf4fbc4b71959615, 0xc001074fd8, 0x1)
	/usr/local/go/src/net/http/client.go:250 +0x14b
net/http.(*Client).send(0xc0005b7b60, 0xc000da4500, 0xbf4fbc4b71959615, 0x458edb1ef1, 0x1b1fb40, 0xc0004f8ce0, 0x0, 0x1, 0xc0004b0790)
	/usr/local/go/src/net/http/client.go:174 +0xfa
net/http.(*Client).do(0xc0005b7b60, 0xc000da4500, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/client.go:641 +0x2a8
net/http.(*Client).Do(0xc0005b7b60, 0xc000da4500, 0xc000473bf0, 0x0, 0x0)
	/usr/local/go/src/net/http/client.go:509 +0x35
gitlab.liebaopay.com/liveme/risk/gateway/libs/elastic/v7.(*Client).PerformRequest(0xc0005c0000, 0x11d6580, 0xc00003e0b0, 0x1059708, 0x4, 0xc00049cc60, 0x30, 0xc000473b60, 0xeee280, 0xc000473bf0, ...)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/libs/elastic/v7/client.go:1350 +0x411
gitlab.liebaopay.com/liveme/risk/gateway/libs/elastic/v7.(*SearchService).Do(0xc001075798, 0x11d6580, 0xc00003e0b0, 0x9, 0xc00046a748, 0x1)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/libs/elastic/v7/search.go:460 +0x120
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*aggrFactorESSearch).SumCompute(0xc000bfc840, 0x0, 0x0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_aggr.go:207 +0x9da
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*aggrFactor).Get(0xc001075958, 0xc000874a00, 0x11, 0xe66a40, 0xc0005b2be0, 0xc00092f6e0, 0x42c051, 0x1092a80, 0xc001085960)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_aggr.go:481 +0x414
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*factorManage).GetExpressionFromAxFactorConfig(0xc000b44a20, 0x1ad83f1, 0x1, 0xc000874a00, 0x11, 0xc0005b2be0, 0xc00092f6e0, 0xc000268540, 0xc000874a00)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor.go:99 +0xc7
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*factorManage).GetExpressionFromAxFactorConfig-fm(0x1ad83f1, 0x1, 0xc000874a00, 0x11, 0xc0005b2be0, 0xc00092f6e0, 0xc000874a00, 0x11)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor.go:54 +0x69
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*factorManage).GetExpression(0xc000b44a20, 0x1ad83f1, 0x1, 0xc000874a00, 0x11, 0xc0005b2be0, 0xc00092f6e0, 0x1092a80, 0xc00040fae8)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor.go:60 +0x101
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*ruleManage).ReplaceFactors(0xc001075da0, 0xc0001cf580, 0xc00092f6e0, 0x1ad83f1, 0x1)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/rule.go:65 +0x2a0
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*ruleManage).RunRule(0xc00040fda0, 0xc0001cf580, 0xc00092f6e0, 0xc0001cf580, 0x1b1fb40)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/rule.go:77 +0x3f
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*eventManage).RunRuleConf(0x1b3e668, 0xc0003f2160, 0x1ad83f1, 0x1, 0x1d, 0xc0004bc0b0, 0xe, 0xc000ad3e00, 0x30, 0xc0005960f0, ...)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/event.go:156 +0x2a8
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*eventManage).DoByOrder.func1(0xc00003e960, 0xc0003f2160, 0xc000bfc600, 0x1b3e668, 0x1ad83f1, 0x1, 0x1d, 0xc0004bc0b0, 0xe, 0xc000ad3e00, ...)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/event.go:107 +0x15f
created by gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*eventManage).DoByOrder
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/event.go:91 +0x39e

goroutine 279868 [select]:
net/http.(*persistConn).writeLoop(0xc000aad0e0)
	/usr/local/go/src/net/http/transport.go:1885 +0x113
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1339 +0x966

goroutine 280057 [select]:
net/http.(*persistConn).writeLoop(0xc00046a480)
	/usr/local/go/src/net/http/transport.go:1885 +0x113
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1339 +0x966

goroutine 280115 [runnable]:
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/gin-gonic/gin.(*Context).Set(...)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/gin-gonic/gin/context.go:185
gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core.GetContextIp(0xc0003f2160, 0xc000389bc0, 0x20)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core/request.go:21 +0x139
gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core.AddRequestLog(0xc000bfda40, 0xc0003f2160, 0x2)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core/log.go:254 +0x366
gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core.LogKV(0x1059ad4, 0x4, 0x10626a9, 0xd, 0x106370f, 0xe, 0xc0003f2160, 0xc000eddf68, 0x2, 0x2, ...)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core/log.go:418 +0x321
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*libraryFactorManage).fetch(0xc000119ea0, 0x1090600)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_library.go:68 +0x21c
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*libraryFactorManage).Do.func1(0xc000119ea0, 0xc000bfd860)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_library.go:97 +0x55
created by gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*libraryFactorManage).Do
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_library.go:91 +0x273

goroutine 280092 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a8845b0, 0x72, 0xc000fb9e58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000cacc98, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000cacc98, 0xc000b3a200, 0x1, 0x1)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc000cacc80, 0xc000b3a2e1, 0x1, 0x1, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc000cacc80, 0xc000b3a2e1, 0x1, 0x1, 0xc000380598, 0xc000fb9f68, 0x4606e5)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc000588ee8, 0xc000b3a2e1, 0x1, 0x1, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).backgroundRead(0xc000b3a2d0)
	/usr/local/go/src/net/http/server.go:676 +0x5a
created by net/http.(*connReader).startBackgroundRead
	/usr/local/go/src/net/http/server.go:672 +0xd2

goroutine 279867 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a883d90, 0x72, 0xc001068a88)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000f09a98, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000f09a98, 0xc000f52000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc000f09a80, 0xc000f52000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc000f09a80, 0xc000f52000, 0x1000, 0x1000, 0xc001068b70, 0x4569a0, 0xc000eed680)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0001c9530, 0xc000f52000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*persistConn).Read(0xc000aad0e0, 0xc000f52000, 0x1000, 0x1000, 0xc001068c70, 0x406895, 0xc000206cc0)
	/usr/local/go/src/net/http/transport.go:1497 +0x75
bufio.(*Reader).fill(0xc0004d7ce0)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc0004d7ce0, 0x1, 0x0, 0x0, 0x1, 0xc00001aa20, 0x0)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*persistConn).readLoop(0xc000aad0e0)
	/usr/local/go/src/net/http/transport.go:1645 +0x1a2
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1338 +0x941

goroutine 279911 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a884410, 0x72, 0xc001069a88)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000f1be98, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000f1be98, 0xc0008ed000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc000f1be80, 0xc0008ed000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc000f1be80, 0xc0008ed000, 0x1000, 0x1000, 0xc001069b70, 0x4569a0, 0xc000e07c80)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0004f8f00, 0xc0008ed000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*persistConn).Read(0xc0010b6480, 0xc0008ed000, 0x1000, 0x1000, 0xc001069c70, 0x406895, 0xc000a391a0)
	/usr/local/go/src/net/http/transport.go:1497 +0x75
bufio.(*Reader).fill(0xc000d8d860)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc000d8d860, 0x1, 0x0, 0x0, 0x1, 0xc00001b200, 0x0)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*persistConn).readLoop(0xc0010b6480)
	/usr/local/go/src/net/http/transport.go:1645 +0x1a2
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1338 +0x941

goroutine 279272 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a925180, 0x72, 0xc000dd7a88)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc0001a6f18, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc0001a6f18, 0xc00103f000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc0001a6f00, 0xc00103f000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc0001a6f00, 0xc00103f000, 0x1000, 0x1000, 0xc000dd7b70, 0x4569a0, 0xc000e05380)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0005890d8, 0xc00103f000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*persistConn).Read(0xc0010b6120, 0xc00103f000, 0x1000, 0x1000, 0xc000dd7c70, 0x406895, 0xc0004c1da0)
	/usr/local/go/src/net/http/transport.go:1497 +0x75
bufio.(*Reader).fill(0xc000d8c780)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc000d8c780, 0x1, 0x0, 0x0, 0x1, 0xc000207da0, 0x0)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*persistConn).readLoop(0xc0010b6120)
	/usr/local/go/src/net/http/transport.go:1645 +0x1a2
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1338 +0x941

goroutine 5976 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a884340, 0x72, 0xc001165a58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc0001a6398, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc0001a6398, 0xc000797000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc0001a6380, 0xc000797000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc0001a6380, 0xc000797000, 0x1000, 0x1000, 0xc001165b88, 0xc001165b68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0001c8a48, 0xc000797000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc000194f60, 0xc000797000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc000bfc900)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc000bfc900, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc000fd39a0, 0x11d6540, 0xc000fc00c0, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc000fd39a0, 0x11d6540, 0xc000fc00c0)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 279870 [select]:
net/http.(*persistConn).writeLoop(0xc0000b2900)
	/usr/local/go/src/net/http/transport.go:1885 +0x113
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1339 +0x966

goroutine 3586 [semacquire]:
sync.runtime_Semacquire(0xc0004f7a28)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc0004f7a20)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/v1/views.PostEvent(0xc0003f2160, 0x0, 0x0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/v1/views/event.go:122 +0x50e
gitlab.liebaopay.com/liveme/risk/gateway/v1.decoratorHandler.func1(0xc0003f2160)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/v1/routers.go:23 +0x33
gitlab.liebaopay.com/liveme/risk/gateway/decorators.LogHandler.func1(0xc0003f2160)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/decorators/log.go:17 +0x190
gitlab.liebaopay.com/liveme/risk/gateway/v1.validatorHandler.func1(0xc0003f2160)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/v1/routers.go:17 +0x2f
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/gin-gonic/gin.(*Context).Next(0xc0003f2160)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/gin-gonic/gin/context.go:108 +0x43
gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core.LoggerWithWriter.func1(0xc0003f2160)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core/api_errors.go:245 +0xad
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/gin-gonic/gin.(*Context).Next(0xc0003f2160)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/gin-gonic/gin/context.go:108 +0x43
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/gin-gonic/gin.(*Engine).handleHTTPRequest(0xc000467440, 0xc0003f2160)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/gin-gonic/gin/gin.go:361 +0x5ab
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/gin-gonic/gin.(*Engine).ServeHTTP(0xc000467440, 0x11d59c0, 0xc0004b4380, 0xc0009dfe00)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/gin-gonic/gin/gin.go:326 +0x132
net/http.serverHandler.ServeHTTP(0xc00034b5f0, 0x11d59c0, 0xc0004b4380, 0xc0009dfe00)
	/usr/local/go/src/net/http/server.go:2741 +0xab
net/http.(*conn).serve(0xc000187c20, 0x11d6540, 0xc000197500)
	/usr/local/go/src/net/http/server.go:1847 +0x646
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 3112 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a883a50, 0x72, 0xc000e31a58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc0001a6898, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc0001a6898, 0xc00101a000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc0001a6880, 0xc00101a000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc0001a6880, 0xc00101a000, 0x1000, 0x1000, 0xc000e31bb8, 0xc000e31b68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc00000e960, 0xc00101a000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc000b3a930, 0xc00101a000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc000369620)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc000369620, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc000fd2000, 0x11d6540, 0xc001093f40, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc000fd2000, 0x11d6540, 0xc001093f40)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 32086 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a908798, 0x72, 0xc000f4da58)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000f09398, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000f09398, 0xc0001f6000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc000f09380, 0xc0001f6000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc000f09380, 0xc0001f6000, 0x1000, 0x1000, 0xc000f4db88, 0xc000f4db68, 0x68e79a)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0004f8ce8, 0xc0001f6000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*connReader).Read(0xc00046fda0, 0xc0001f6000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:786 +0xfc
bufio.(*Reader).fill(0xc0009dae40)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc0009dae40, 0x4, 0x0, 0x0, 0x0, 0x0, 0x58c3eb)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*conn).readRequest(0xc000fb3860, 0x11d6540, 0xc001011640, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/http/server.go:963 +0xb27
net/http.(*conn).serve(0xc000fb3860, 0x11d6540, 0xc001011640)
	/usr/local/go/src/net/http/server.go:1788 +0x49e
created by net/http.(*Server).Serve
	/usr/local/go/src/net/http/server.go:2851 +0x2f5

goroutine 280099 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a884820, 0x72, 0xc000fab028)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000f1ba18, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000f1ba18, 0xc0010d4000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc000f1ba00, 0xc0010d4000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc000f1ba00, 0xc0010d4000, 0x1000, 0x1000, 0x44a986, 0xc000db6000, 0x46)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc00000e928, 0xc0010d4000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
bufio.(*Reader).fill(0xc000383da0)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).ReadSlice(0xc000383da0, 0xc000fab10a, 0xc000fab230, 0x4a0438, 0xc000f1ba00, 0x0, 0x0)
	/usr/local/go/src/bufio/bufio.go:341 +0x36
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/garyburd/redigo/redis.(*conn).readLine(0xc000260460, 0xbf4fbc49b190a2bb, 0x43ed9aa59d, 0x1b1fb40, 0x72, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/garyburd/redigo/redis/conn.go:431 +0x38
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/garyburd/redigo/redis.(*conn).readReply(0xc000260460, 0xbf4fbc49b190a2bb, 0x43ed9aa59d, 0x1b1fb40, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/garyburd/redigo/redis/conn.go:504 +0x40
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/garyburd/redigo/redis.(*conn).DoWithTimeout(0xc000260460, 0xb2d05e00, 0x105c1cb, 0x6, 0xc0009d88a0, 0x2, 0x2, 0xc000ff3d00, 0x6, 0x1b3fe80, ...)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/garyburd/redigo/redis/conn.go:665 +0x160
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/garyburd/redigo/redis.(*conn).Do(0xc000260460, 0x105c1cb, 0x6, 0xc0009d88a0, 0x2, 0x2, 0xc000dc0e10, 0x0, 0xc000945500, 0x4d2700)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/garyburd/redigo/redis/conn.go:616 +0x73
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/garyburd/redigo/redis.(*pooledConnection).Do(0xc0009d8880, 0x105c1cb, 0x6, 0xc0009d88a0, 0x2, 0x2, 0x10, 0xe9ae40, 0x1, 0xc000dc0e10)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/garyburd/redigo/redis/pool.go:433 +0xa0
gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core.(*RedisClient).Do(0xc000dc0dd0, 0x105c1cb, 0x6, 0xc0009d88a0, 0x2, 0x2, 0x2, 0xc0001c3650, 0x26, 0xc00001bf20)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/git.liebaopay.com/liveme/liveme-sdk-go/core/redis.go:489 +0x6f
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*libraryData).Search(0xc000fab5d8, 0xc000dc0dd0, 0xc0001c3650, 0x26, 0xc0004f7780, 0x6, 0xc000fab688)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_library.go:140 +0x135
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*exprEnvManage).IsInListGroup(0xc0001c85d0, 0xc0004f7780, 0x6, 0xc0001cb040, 0x11, 0x414700)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/expr_env_func_data.go:15 +0x12b
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*exprEnvManage).IsInListGroup-fm(0xc0004f7780, 0x6, 0xc0001cb040, 0x11, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/expr_env.go:31 +0x52
reflect.Value.call(0xee58e0, 0xc000dc0be0, 0x13, 0x10595a0, 0x4, 0xc0004ae960, 0x2, 0x2, 0x104f6c0, 0x1, ...)
	/usr/local/go/src/reflect/value.go:447 +0x454
reflect.Value.Call(0xee58e0, 0xc000dc0be0, 0x13, 0xc0004ae960, 0x2, 0x2, 0x13, 0x11, 0xc0001cb7a0)
	/usr/local/go/src/reflect/value.go:308 +0xa4
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/antonmedv/expr/vm.(*VM).Run(0xc000fabd48, 0xc0008623c0, 0xeee280, 0xc0004ae4b0, 0xc000fabe08, 0x2)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/antonmedv/expr/vm/vm.go:253 +0x39c9
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/antonmedv/expr/vm.Run(0xc0008623c0, 0xeee280, 0xc0004ae4b0, 0x0, 0x0, 0x0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/antonmedv/expr/vm/vm.go:25 +0x13c
gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/antonmedv/expr.Run(0xc0008623c0, 0xeee280, 0xc0004ae4b0, 0x0, 0x0, 0xc0008623c0, 0x0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/vendor/github.com/antonmedv/expr/expr.go:125 +0x3f
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*exprManage).ParseExpression(0xc000fabee0, 0xc0005bf140, 0x5e, 0xc00092f6e0, 0x0, 0x0, 0x1, 0xc000c4f718)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/expr.go:26 +0x160
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*aggrFactor).Filter(0xc000259220, 0xc00003b9c0, 0x11, 0xc0005b2be0, 0xc00092f6e0, 0xc0005b2be0, 0x21)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_aggr.go:422 +0x402
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*aggrFactor).Add(0xc000259220, 0xc00003b9c0, 0x11, 0xc0005b2be0, 0xc00092f6e0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_aggr.go:454 +0x53
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*aggrFactor).WalkAggrFactor.func1(0xc000ff3840, 0xc000259220, 0x1b3e668, 0xc00092f6e0, 0xc00003b9c0, 0x11)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_aggr.go:407 +0xc8
created by gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*aggrFactor).WalkAggrFactor
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_aggr.go:395 +0x1f7

goroutine 279273 [select]:
net/http.(*persistConn).writeLoop(0xc0010b6120)
	/usr/local/go/src/net/http/transport.go:1885 +0x113
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1339 +0x966

goroutine 280077 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a907f78, 0x72, 0xc000ddaa88)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc000f1ad18, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc000f1ad18, 0xc00110a000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc000f1ad00, 0xc00110a000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc000f1ad00, 0xc00110a000, 0x1000, 0x1000, 0xc000ddab70, 0x4569a0, 0xc000e05680)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc0001c87e8, 0xc00110a000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*persistConn).Read(0xc0002bed80, 0xc00110a000, 0x1000, 0x1000, 0xc000ddac70, 0x406895, 0xc0007945a0)
	/usr/local/go/src/net/http/transport.go:1497 +0x75
bufio.(*Reader).fill(0xc00028a720)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc00028a720, 0x1, 0x0, 0x0, 0x1, 0xc00001a840, 0x0)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*persistConn).readLoop(0xc0002bed80)
	/usr/local/go/src/net/http/transport.go:1645 +0x1a2
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1338 +0x941

goroutine 280093 [semacquire]:
sync.runtime_Semacquire(0xc000ff3848)
	/usr/local/go/src/runtime/sema.go:56 +0x39
sync.(*WaitGroup).Wait(0xc000ff3840)
	/usr/local/go/src/sync/waitgroup.go:130 +0x64
gitlab.liebaopay.com/liveme/risk/gateway/pkg.(*aggrFactor).WalkAggrFactor(0xc000259220, 0xc00092f6e0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/pkg/factor_aggr.go:411 +0x2e9
gitlab.liebaopay.com/liveme/risk/gateway/v1/views.PostEvent.func2(0xc0004f7a20, 0xc0003f2160, 0x1ad83f1, 0x1, 0xc00092f6e0)
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/v1/views/event.go:95 +0xa0
created by gitlab.liebaopay.com/liveme/risk/gateway/v1/views.PostEvent
	/go/src/gitlab.liebaopay.com/liveme/risk/gateway/v1/views/event.go:88 +0x466

goroutine 279216 [IO wait]:
internal/poll.runtime_pollWait(0x7f1b8a925250, 0x72, 0xc000586a88)
	/usr/local/go/src/runtime/netpoll.go:173 +0x66
internal/poll.(*pollDesc).wait(0xc0002bd418, 0x72, 0xffffffffffffff00, 0x11cde60, 0x1ad2750)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a
internal/poll.(*pollDesc).waitRead(0xc0002bd418, 0xc000e21000, 0x1000, 0x1000)
	/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d
internal/poll.(*FD).Read(0xc0002bd400, 0xc000e21000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179
net.(*netFD).Read(0xc0002bd400, 0xc000e21000, 0x1000, 0x1000, 0xc000586b70, 0x4569a0, 0xc000cbec00)
	/usr/local/go/src/net/fd_unix.go:202 +0x4f
net.(*conn).Read(0xc000588fd8, 0xc000e21000, 0x1000, 0x1000, 0x0, 0x0, 0x0)
	/usr/local/go/src/net/net.go:177 +0x68
net/http.(*persistConn).Read(0xc00106c120, 0xc000e21000, 0x1000, 0x1000, 0xc000586c70, 0x406895, 0xc0004c1200)
	/usr/local/go/src/net/http/transport.go:1497 +0x75
bufio.(*Reader).fill(0xc000f57860)
	/usr/local/go/src/bufio/bufio.go:100 +0x10f
bufio.(*Reader).Peek(0xc000f57860, 0x1, 0x0, 0x0, 0x1, 0xc0008eea80, 0x0)
	/usr/local/go/src/bufio/bufio.go:132 +0x3f
net/http.(*persistConn).readLoop(0xc00106c120)
	/usr/local/go/src/net/http/transport.go:1645 +0x1a2
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1338 +0x941

goroutine 279912 [select]:
net/http.(*persistConn).writeLoop(0xc0010b6480)
	/usr/local/go/src/net/http/transport.go:1885 +0x113
created by net/http.(*Transport).dialConn
	/usr/local/go/src/net/http/transport.go:1339 +0x966
Is it possible to access the gin.Context object from a template function? Specifically, I would like to read the content of an HTTP header.

### Description
I have a post data form，When the form input is out of order, the program redirects to the previous page and prompts for some error messages
#### The solution I tried 1
```golang
if err != nil {
    c.Redirect(http.StatusMovedPermanently,"/register")
    c.Abort()
    return
}
```
I don't know how to carry data to a html page this way. I've tried to use session, but it makes the problem more complicated.

#### The solution I tried 2
```golang
if err != nil {
    flash := map[string]interface{}{
        "code":http.StatusConflict,
        "message":[]string{"The email address already exists"},
    }
    c.HTML(http.StatusFound,"auth/register.html",flash)
    return
}
```
One of the deadliest problems with this approach is that the template is loaded, but pressing F5 to refresh the page prompts you to submit the form repeatedly

### Problem
After validation fails, how can you present the form validation information on the template
We have to use Gin with a special listener in some situations.

For example, if we want to upgrade Gin server graceful, we may use the third party lib to support this feature such as [tableflip](https://github.com/cloudflare/tableflip)

Here's some example code

```Go
upg, err := tableflip.New(tableflip.Options{})
if err != nil {
	panic(err)
}
defer upg.Stop()

go func() {
	sig := make(chan os.Signal, 1)
	signal.Notify(sig, syscall.SIGHUP)
	for range sig {
		err := upg.Upgrade()
		if err != nil {
			log.Println("Upgrade failed:", err)
			continue
		}

		log.Println("Upgrade succeeded")
	}
}()

ln, err := upg.Fds.Listen("tcp", "localhost:8080")
if err != nil {
	log.Fatalln("Can't listen:", err)
}

go router.RunListener(ln)

if err := upg.Ready(); err != nil {
	panic(err)
}
<-upg.Exit()

time.AfterFunc(30*time.Second, func() {
	os.Exit(1)
})

_ = server.Shutdown(context.Background())
```
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:
1.12.5
- gin version (or commit ref):
latest master
- operating system:

## Description
when i run the program in my local environment, the fullpath is success.
but once run in the linux server, the fullpath doest match the request url

## Screenshots

I'm trying to call bind multiple times to bind to two different models during the same request.  It only works the first time I call it, it ends up not binding anything the second time. I suspect this is because a buffer is being read and not being reset.  Is there a fix or workaround for this?

The README.md has a minor typo.  It says 'Listen and server on 0.0.0.0:8080'.  It should say 'Listen and serve on 0.0.0.0:8080'.

typo fix

Add localhost to reservedLocalIps, for situations where it's sitting behind something like nginx on the same host.

Should be capital G in Get.

Hello , i seriously having problem handling CORS stuff. there is no detailed routing available , not cors support by default , gin is not usable without these functionality. do something guys.

Hello , i want to have support for global route , i mean suppose i want route that can response if no other route is found. like route.Any("*",handler) . i don't know if there is any functionality like it or not. it would be great. 

Added some info on how to get form and URL params

MVC pattern is the de facto standard for web app. I have tried to implement it with Gin by myself, but it looks naive and maybe too simple.

So, will Gin supports MVC?

Mostly a "cosmetic" fix ;)

It would be nice to integrate into development mode adding the file and linenumber that added an error to  to populate a caller field.

Internal to the log package this is what is used to determine the caller, can't use this with the logging middleware for Gin because it would always report the line inside the Gin logger that does the printf.

``` go
if l.flag&(Lshortfile|Llongfile) != 0 {
   // release lock while getting caller info - it's expensive.
   l.mu.Unlock()
   var ok bool
   _, file, line, ok = runtime.Caller(calldepth)
   if !ok {
    file = "???"
    line = 0
   }
   l.mu.Lock()
}
```

I think it would have to be a change to when you register an error, it would need to do runtime.Caller then, and populate a field in the Error that would be added to the logline if in dev mode.

Thoughts?

``` go
router.GET("/api/test/basic_data_set_link", control.GetBasicDataSetLink())
router.GET("/api/:user_id/requestedgroups", control.GetRequestedGroups()) 
```

the above two lines conflict, and cause panic.
but it seems no problem.  so, what's wrong with my code ??
thanks.

Hello everyone,

Just finished my exams and pushed for release candidate a new version.
# Changelog

Here is the changelog:
### Gin 0.5 (Jan 4, 2015)
- [NEW] Content Negotiation
- [FIX] Solved security bug that allow a client to spoof ip
- [FIX] Fix unexported/ignored fields in binding
# Contributors

Here is all the people that helped on it. Please forgive if I forgot someone.

**@andredublin (Andre Dublin)**
- Fix typo in comment

**@bredov (Ludwig Valda Vasquez)**
- Fix html templating in debug mode

**@dickeyxxx (Jeff Dickey)**
- Add example about serving static files

**@dutchcoders (DutchCoders)**
- ★ Fix security bug that allows client to spoof ip
- Fix typo. r.HTMLTemplates -> SetHTMLTemplate

**@jamie-stackhouse (Jamie Stackhouse)**
- Add more shortcuts for router methods

**@JasonSoft (Jason Lee)**
- Fix typo in comment

**@kelcecil (Kel Cecil)**
- Fix readme typo

**@loongmxbt (Saint Asky)**
- Fix typo in example

**@mirzac (Mirza Ceric)**
- Fix debug printing

**@mopemope (Yutaka Matsubara)**
- Add Pluggable View Renderer Example

**@se77en (Damon Zhao)**
- Improve color logging

**@slimmy (Jimmy Pettersson)**
- Added messages for required bindings

**@smira (Andrey Smirnov)**
- Add support for ignored/unexported fields in binding

**@yosssi (Keiji Yoshida)**
- Fix link in README
# Future plans

_Short-term:_ I will update the contrib repository with this version on friday, any pull request is welcome.

_Medium-term:_ Next version is expected when I resolve nearly all issues. Hope to do it within a month.

_Long-term:_ Before the month of June I hope to push the v1.0 with a stable API.
# Help wanted

Now that I finished my exams, I have plenty time to focus on this project and I hope keep up to what you expect from Gin.

Thank you all.

when using expvar the router seems to be eating the request to /debug/vars and 404s ... is there a way to get it to continue on to expvar?

http://golang.org/pkg/expvar/

In current gin version, if we use demo like this

``` go
func main() {
    r := gin.Default()
    // If no other routers match /user/john, it will redirect to /user/join/
    r.GET("/user/:name/*action", func(c *gin.Context) {
        name := c.Params.ByName("name")
        action := c.Params.ByName("action")
        message := name + " is " + action
        c.String(200, message)
    })

    // Listen and server on 0.0.0.0:8080
    r.Run(":8080")
}
```

It cannot handle request **/user/john**, but it could handle **/user/john/**, and the demo is extrally copied from the readme, the  actually reason that why the demo in readme can handle **/user/john**  is that it's handled by

``` go
  r.GET("/user/:name", func(c *gin.Context) {
        name := c.Params.ByName("name")
        message := "Hello "+name
        c.String(200, message)
    })
```

not the

``` go
 r.GET("/user/:name/*action", func(c *gin.Context) {
        name := c.Params.ByName("name")
        action := c.Params.ByName("action")
        message := name + " is " + action
        c.String(200, message)
    })
```

Fortunately， the latest [httprouter](https://github.com/julienschmidt/httprouter) solve this problem, if url like **/user/john** cannot be handled by other routers, it will redirect 301 to **/user/john/**

Why so slow to update?
Are you going to give up this project?

Content type charset is not specified for renderers, currently there's no way to configure it. I believe this might be a sane default.

I had use gin in several of my golang apps .  

In order to make my app more flexible , I want dynamicall bind http path to handle function , such as

( demo code )

there is a array of http path :   urls_path = [ "/someGet" , "/somePost"  "/somePut" ]

foreach one in urls_path:
     if one == "/someGET" :
               bind(one , getting)
     else if one == "/somePost":
               bind(one, posting)
      else 
                bind(one, putting)

the final result will the same as  writting them statically in golang code: 
    r.GET("/someGet", getting)
    r.POST("/somePost", posting)
    r.PUT("/somePut", putting)

Can I ?

I am having trouble understanding how to respond with HTTP 204 (no content) using `gin.Context`.

Tried `context.JSON(204, nil)` or just `gin.H{}` but both complain that the body is not empty.

```
Error #01: http: request method or response status code does not allow body
     Meta: [<nil>]
```

Any help or pointer much appreciated!

Thanks

Can not direct output html piece to browser. 

``` go
router.GET("/query", func(c *gin.Context) {
       c.String(200, "html format  code ");

    })
```

Should allow user write custom header infos , such as `"text/html"`. 

``` go
c.Request.Header.Set("Content-Type", "text/html");
```

is overrided by `c.String` function.

Getting similar output to:

```
$ gin -i
[gin] listening on port 3000
[GIN-debug] GET   /*filepath                --> github.com/gin-gonic/gin.func·005 (3 handlers)
[GIN-debug] HEAD  /*filepath                --> github.com/gin-gonic/gin.func·006 (3 handlers)
[GIN-debug] GET   /*filepath                --> github.com/gin-gonic/gin.func·005 (3 handlers)
panic: a Handle is already registered for this path
```

With code:

```
r := gin.Default()

r.Static("/", "./templates")
r.Static("/", "./public")
```

I want to mount both `./templates` and `./public` onto the root path.. I understand the implications of file conflicts, however this is possible with Martini (or express-js for that matter).

It seems that registering two file handlers for the same path is impossible (by design). What's the best way to go around this?

Thanks for making Gin! Its awesome :).

in readme, it says:
#### HTML rendering

Using LoadHTMLTemplates()

``` go
func main() {
    r := gin.Default()
    r.LoadHTMLGlob("templates/*")
    r.GET("/index", func(c *gin.Context) {
        obj := gin.H{"title": "Main website"}
        c.HTML(200, "index.tmpl", obj)
    })

    // Listen and server on 0.0.0.0:8080
    r.Run(":8080")
}
```

``` html
<h1>
    {{ .title }}
</h1>
```

From my understanding, I create a folder names templates in binary's folder, put index.tmpl in the templates folder. And then run binary in its own folder.  

But It says cannot find specific file.  

If I move index.tmpl to binary's folder, everything's ok.

What's wrong?

I run "go get" command to import Gin-Gonic but there's an error in gin.go, line 44

go get github.com/gin-gonic/gin
../../go/src/github.com/gin-gonic/gin/gin.go:44: undefined: sync.Pool

For example, in my REST api, I want anything destined for the /proxy endpoint to be proxied to another server running on a different ip/port.  

Go has `httputil.NewSingleHostReverseProxy` built-in to provide this functionality, but I'm not seeing how I would tell gin to use this for an endpoint.  Any tips?

Just like  the path of GitHub, github.com/julienschmidt/httprouter  can't support it.
thanks.

I get code from example with [html templates](https://github.com/gin-gonic/gin#html-rendering). I created file `site.go` in folder `/path/to/site` and run it with command `cd /path/to/site; go run site.go`

``` go
package main
import (
    "github.com/gin-gonic/gin"
)

func main() {
    r := gin.Default()
    r.LoadHTMLTemplates("templates/*")
    r.GET("/", func(c *gin.Context) {
        obj := gin.H{"Title": "Hello"}
        c.HTML(200, "index.tmpl", obj)
    })
    r.Run(":8080")
}

```

It gives error:

``` bash
[GIN] 2015/01/05 - 16:56:35 | 500 |    662.277us | [::1]:64119  GET /
Error #01: open index.tmpl: no such file or directory 
     Meta: [index.tmpl map[Title:Hello]]
```

Although I create file `/path/to/site/templates/index.tmpl`.

Hi, guys.
I just wrote middleware for gin framework. To serve embedded by [go-bindata ](https://github.com/jteeuwen/go-bindata) static files. See it [here](https://github.com/olebedev/staticbin). 
Thoughts?

Hi there,
I have a new bug related to Gin using websockets with either the gorillatoolkit or sockjs (ws emulation).
If the user reload a page or if I use the socket system on more than one page (obviously not on an SPA site) I got this error :

`http: response.WriteHeader on hijacked connection`

...every time I hit reload. If I do that many times then the socket messages begins to lag, sometimes more than 1 minute !

I'm sure it's somewhat gin related because I've tried the same setup with httprouter only and it never show the same error message.

Perhaps just for this web socket route I should bypass the Gin Context but is that possible ? (I mean using an handler function with: `_(w http.ResponseWriter, r *http.Request, _ httprouter.Params))` ?

fixes #162 , #171 

Forgive the n00b question but I didn't see anything documented.  My app is on github here: https://github.com/chriscantu/team-sync 

I would like to catch any runtime error in my app and return a generic 500 error with a default message body.  How can I do this with Gin?

@manucorporat Are you planning to release a new version any time soon?

With all things being great the most annoying bug is when i'm trying to start a new server. 
If there's another application is listening on the same port gin goes into panic. I know this has been
fixed in master, been waiting for new release for a while. 

I've really come to like Gin but – upon looking around – I'm left wondering if it's still being maintained.

It would be nice for me if binding supports unsigned int in `setWithProperType` function.

Maybe just needs another case like this:

``` golang
case reflect.Uint, reflect.Uint8, reflect.Uint16, reflect.Uint32, reflect.Uint64:
        if val == "" {
            val = "0"
        }
        uintVal, err := strconv.ParseUint(val, 10, 64)
        if err != nil {
            return err
        } else {
            structField.SetUint(uintVal)
        }
```

can we add einhorn binding on start so that we have zero-downtime restart
see goji for reference.
their einhorn implementation is very beautiful.

The X-Forwarded-For can be used to spoof the real client ip. The middleware
introduced in this patch (which should only be used when having servers
in front of this servers) will filter all defined proxies (or local ip
addresses by default) and replace the RemoteAddr with the real client
ip.

Gin by default includes helpers for registering a patch handler, what we are currently doing is adopting the RFC7386 for our PATCH handlers. This makes it slightly easier to work with, in that a user simply defines a JSON object, where null is special type meaning unset the value stored here.

[RFC7386](https://tools.ietf.org/html/rfc7386)

Below I've put in some example json, and a example patch request.

I'm unsure what the best API would be that Gin could provide, but I thought I would open conversation.

Maybe for Gin it is simply an API where a map[string]interface{} is added to the route on the Gin Context on the route and it populates it? Then it is up to the user of a PATCH handler to look for keys they intend to allow PATCH's to effect?

I realize this may be out of scope for the core project, but maybe it would work as a route middleware part of contrib? Thoughts?

_Example JSON_

```
{
    "id": "7eaea4a6-8a53-4054-b0dd-304ec01fca46",
    "url": "http://localhost:8080/test/videos/7eaea4a6-8a53-4054-b0dd-304ec01fca46",
    "title": "This is a new awesome video",
    "status": 0,
    "created_at": "2014-12-03T16:01:48.521122Z",
    "updated_at": "2014-12-03T16:01:48.521122Z",
    "deleted_at": null,
    "published_at": null,
    "tags": [],
    "author": {
        "id": "539ea7af-d366-4d13-9446-d427fb72a910",
        "url": "http://localhost:8080/test/users/539ea7af-d366-4d13-9446-d427fb72a910",
        "email": "test@test.com",
        "profile": {
            "title": "Developer"
        }
    },
    "updater": {
        "id": "539ea7af-d366-4d13-9446-d427fb72a910",
        "url": "http://localhost:8080/test/users/539ea7af-d366-4d13-9446-d427fb72a910",
        "email": "test@test.com",
        "profile": {
            "title": "Developer"
        }
    }
}
```

_Patch Request_

```
PATCH /object/7eaea4a6-8a53-4054-b0dd-304ec01fca46 HTTP/1.1
Content-Type: application/merge-patch+json
{
  "tags": ["sports"],
  "title": "This is a patched awesome video"
}
```

Im currently experimenting with various middleware handlers for gin and noticed
that setting response header after calling `c.Next()` does not work. Here's an example:

``` go
func BeforeAfterMiddleware() gin.HandlerFunc {
  return func(c *gin.Context) {
    c.Writer.Header().Set("X-Before", "Foo")
    c.Next()
    c.Writer.Header().Set("X-After", "Bar")
  }
}
```

Only `X-Before` header is set when request is complete.
Is it a bug or am i doing something wrong?

Minus the small reformat that Goimports automatically made with the structure of imports, this just adds a few helper methods to the Router Group that would help us as we are using them in our project.

If you want, I can remove the import reordering.

Thanks for Gin!

It would be nice to separate the ListenAndServeTLS() into two steps that would allow more control over starting and stopping server instances.

Maybe something like:
g.ListenTLS()  returns a listener
and
g.Server(listener) to serve the gin Engine handlers

This would allow one to wrap a control channel around a listener to do things like graceful shutdowns/cleanups.

Would be nice to implement JSON render option similar to Martinit's render option that allows for Human-readable JSON Formatting on json output

The router currently returns 404 when there's a matching path, but no matching verb. Instead it should return a 405

I appended my issue to #145, but I just made some changes to render.go that "fix the problem I was having." Here is a gist of my modifications:

https://gist.github.com/boboTjones/703c686fbd7e300f0d24

Specifically,

https://gist.github.com/boboTjones/703c686fbd7e300f0d24#file-render-go-L100


I have something like this:

``` go
    r = gin.Default()
    ...
    r.POST("/v1/faces", func(c *gin.Context) {
        ...bla bla bla...
        _, err = io.Copy(out, file)
        if err != nil {
            fmt.Println(err)
            c.String(500, "error happened")
            return
        }
                ...bla bla bla...
       })
```

When I run this, I get a 200 error code and a blank response body. The console event says:

```
[GIN] 2014/12/08 - 08:45:07 | 200 |    915.646us | ::1 POST /v1/faces
```

I tried `c.String(500, "internal server error")` in a very simple GET handler and that worked. 

I'm binding models like so:

```
var foo models.Foo

passed := c.Bind(&foo); if !passed {
    return
}
```

If there's invalid input, the request fails, however there's no response body, and the response's content-type is text/plain. How can I customize the response to provide a JSON-based error message?

Hi I'm getting `reflect.Value.Interface: cannot return value obtained from unexported field or method` when posting JSON with a timestamp

``` sh
$ curl -XPOST -H 'Content-Type: application/json' localhost:8080/message -d '{"room":"#test","stamp":"2014-12-07T09:03:48.537930194Z","message":"This is test"}'
```

``` go
package main

import (
    "github.com/gin-gonic/gin"
    "net/http"
    "time"
)

type Message struct {
    Room        string `json:"room" binding:"required"`
    Stamp       time.Time `json:"stamp" binding:"required"`
    Message     string `json:"message" binding:"required"`
}

func messageGet(c *gin.Context) {
    ts := time.Now().UTC()
    msg := Message{Room: "#test", Stamp: ts, Message: "This is test"}
    c.JSON(200, msg)
}

func messagePost(c *gin.Context) {
    var msg Message
    c.Bind(&msg) // <-- errors here
    c.JSON(200, msg)
}

func main() {
    r := gin.Default()
    r.GET("/message", messageGet)
    r.POST("/message", messagePost)

    http.Handle("/", r)
    err := http.ListenAndServe(":8080", nil)
    if err != nil {
        panic("ListenAndServe: " + err.Error())
    }
}
```

If I remove the `binding:"required"` on Stamp it works again.

I get :

./binding.go:38: undefined: binding

for the line:

```
    c.BindWith(&form, binding.Form) // You can also specify which binder to use. We support binding.Form, binding.JSON and binding.XML.
```

I tried all kinds of things, but couldn't figure this out. One thing I noticed, which seems suspicious, is a comment that says "todo" in binding.go:

var (
        JSON = jsonBinding{}
        XML  = xmlBinding{}
        Form = formBinding{} // todo
)

I had to change, around line 30:

user := c.Get(gin.AuthUserKey).(string)

to

user := c.MustGet(gin.AuthUserKey).(string)


Pongo2 is one of the finest template engine that i've tried.

https://github.com/flosch/pongo2

So, instead of showing `runtime error: invalid memory address or nil pointer dereference`, it would be nice to show that `foo.tmpl does not exists` when calling `ctx.HTML`

How to get and set Cookie from gin.Context?
Also, how to get User-Agent, Client's IP Address?

This is the traditional Go http way of doing things, but why hew to tradition? Because it handles a failure to bind to the specified address in a much cleaner way than the current code, for one thing. I'd much rather not bury the relevant information in a skyscraper of panic traceback data when people try to run my server and have something else on :8080 already.

Example of the Traditional Way, as applied to Gin:

``` go
package main

import (
    "log"

    "github.com/gin-gonic/gin"
)

func Main() {
    g := gin.Default()
    g.GET("/ping", func(c *gin.Context) {
        c.String(200, "pong")
    })
    log.Println(g.Run()) // Returns an error, so we log.Println it!
}
```

This also helps to catch other edge cases, providing a nice way of bubbling up fatal server failures where a traceback would be pointless/inappropriate.

In the http module usually you can do:

`req.Body = http.MaxBytesReader(rw, req.Body, 5 << 20)`

and have a byte limit on POST request as big as you want. In gin there is no Body so it is very hard to change these settings.

Is there a workaround? Can you implement a POST max size limit configuration?

The struct value I am binding to has an unexported field and it appears to cause `binding.Validate` to panic. Relevant stack below.

```
2014/11/26 22:43:28 PANIC: reflect.Value.Interface: cannot return value obtained from unexported field or method
/usr/local/Cellar/go/1.3.3/libexec/src/pkg/reflect/value.go:1081 (0x8159c)
    valueInterface: panic("reflect.Value.Interface: cannot return value obtained from unexported field or method")
/usr/local/Cellar/go/1.3.3/libexec/src/pkg/reflect/value.go:1070 (0x8146c)
    Value.Interface: return valueInterface(v, true)
/Users/ruthb/Code/go/src/github.com/gin-gonic/gin/binding/binding.go:177 (0x14722f)
    Validate: fieldValue := val.Field(i).Interface()
/Users/ruthb/Code/go/src/github.com/gin-gonic/gin/binding/binding.go:41 (0x145e91)
    jsonBinding.Bind: return Validate(obj)
<autogenerated>:2 (0x1477da)
/Users/ruthb/Code/go/src/github.com/gin-gonic/gin/context.go:216 (0xe36df)
    (*Context).BindWith: if err := b.Bind(c.Request, obj); err != nil {
/Users/ruthb/Code/go/src/github.com/gin-gonic/gin/context.go:212 (0xe33ef)
    (*Context).Bind: return c.BindWith(obj, b)
/Users/ruthb/Code/go/src/github.com/cbmi/origins/service/account.go:24 (0x64dcd)
    postAccounts: c.Bind(&a)
```

Is there oauth2 integration/plugin for gin? (just like github.com/GoIncremental/negroni-oauth2 or github.com/martini-contrib/oauth2)

It would be better IMHO if the project renamed into gin-gonic or something else, since there are already "https://github.com/codegangsta/gin" --> tool for autorestart 

One thing I like about Martini is that I can use [gin](https://github.com/codegangsta/gin) and [fresh](https://github.com/pilu/fresh).

Can this be done with (this) `gin`?

I use this middleware:
https://github.com/gin-gonic/contrib/tree/master/static

like this:

r := gin.Default()
r.Use(static.Serve("/assets")) 
r.NotFound(static.Serve("/assets"))

but,it's not work!

my project tree
![cd9fac54-3c30-4782-a194-b01ec2e792e7](https://cloud.githubusercontent.com/assets/6874537/5156757/308c91f2-731a-11e4-8faa-86380dfd41e7.png)

Fix NoRoute function name in NotFound404 comment.

This is low priority but I figured I would raise it for reference. The default clause in gin.SetMode is missing the statement that TestMode is also supported.
[mode.go#L35](https://github.com/gin-gonic/gin/blob/master/mode.go#L35)

One thing I really like about [go-restful](https://github.com/emicklei/go-restful) is their [built-in Swagger integration](https://github.com/emicklei/go-restful/blob/master/examples/restful-user-service.go). Check out the example project: https://github.com/emicklei/mora#swagger

Some things I really love about Gin is the focus on performance, and overall, it just seems like a much better designed framework. However, I think that auto-generated documentation with Swagger is pretty awesome. It makes it easy for new engineers to get up-to-speed quickly by reading through the docs, and I especially love the way you can [auto-generate API clients for lots of different languages](https://github.com/swagger-api/swagger-codegen).

I'm not sure how involved this change would be, I'm not sure if this could be done as an extension. But we could probably take lots of inspiration from (or just copy) [the swagger code from go-restful](https://github.com/emicklei/go-restful/tree/master/swagger) (MIT licensed).

Anyway, this is not a huge priority for me, just a nice to have.

is it possible to set the [Router](https://github.com/julienschmidt/httprouter/blob/master/router.go#L112) options? Specifically, to set `RedirectTrailingSlash`?

Check this out:
https://blog.golang.org/context

Future versions of Go will quite possibly make Contexts, used for canceling work and passing data around widely branching distributed systems across protocol and machine boundaries, built into the core libraries and/or language. The Go team at Google is pushing for all new code written in the community to use these Context objects so we have interoperability between open source libraries in the wild and Google Go code. The author of this article (Sameer Ajmani) just gave a great talk on this at GothamGo in NYC. I just want to call attention to the issue since Gin is an awesome, forward-looking framework, and it would be a shame to not be able to easily use it in a large, distributed system with various actors written in Go simply because it was not adapted to use Contexts. I will post back on this issue with a link to Sameer's talk when it's online.

Thanks for reading!

Here I come again ^_^

The client post an ajax request to the server, and the server return with different format(html or string) like below:

client ajax:

``` js
var login_suc = false;
function authenticate(username, password) {
  $.ajax
  ({
    type: "POST",
    //the url where you want to sent the userName and password to
    url: "/login",
    contentType: "application/json",
    async: false,
    cache:false,
    //json object to sent to the authentication url
    data: '{"username": "' + username + '", "password" : "' + password + '"}',
    success: function(data) {
      console.log("login.success");
      login_suc = true;
    },
    error: function(xhr, status, data) {
      console.log("login.failed");
      login_suc = false;
    }
  });
}
```

server handler:

``` go
func API_Login_Check(c *gin.Context) {

    var json LoginJSON
    c.Bind(&json)
    c.JSON(200, json)

    // session, _ := GetSession(c)

    if json.Username == "admin" && json.Password == "admin" {
        data, err := Asset("static/index.html")
        if err != nil {
            c.String(400, err.Error())
            return
        }
        c.Data(200, "text/html; charset=utf-8", data)
    } else {
        c.String(400, "Login failed!")
        return
    }
}
```

But the ajax always run into the error function even if i pass the right username and password("admin"),
Any idea will be appreciated!

I want to handle with session, such as cookies and so on, is there some function to do this?

Hi There,
I find it hard to integrate a sockjs server (http://godoc.org/gopkg.in/igm/sockjs-go.v2/sockjs) as the handler return an http.Handler type.

Here's the initializer:

``` go
var messageHandler = sockjs.NewHandler("/api/messages", sockjs.DefaultOptions, func(session sockjs.Session) {
    go func() {
        receiveMessage(session)
    }()
})
```

I can't just wrap it in a `func (c *gin.Context)` so I guess there's probably another way..?
Thanks for help. 

Hi all, I tried JSON with gin, but it does not work!
The html like below:

``` html
<form class="form-signin">
              <input id="username" type="text" class="form-control" placeholder="username" required autofocus>
              <input id="password" type="password" class="form-control" placeholder="password" required>
              <button id="btnSubmit" class="btn btn-lg btn-primary btn-block" type="submit">
                Sign in</button>
              <label class="checkbox pull-left">
                <input type="checkbox" value="remember-me">
```

The js like below:

``` js
$(document).ready(function () {
  //event handler for submit button
  $("#btnSubmit").click(function () {
    //collect userName and password entered by users
    var username = $("#username").val();
    var password = $("#password").val();

    alert(username);
    alert(password);
    //call the authenticate function
    authenticate(username, password);
  });
});

//authenticate function to make ajax call
function authenticate(userName, password) {
  $.ajax
  ({
    type: "POST",
    //the url where you want to sent the userName and password to
    url: "/login",
    dataType: 'json',
    async: false,
    //json object to sent to the authentication url
    data: '{"username": "' + userName + '", "password" : "' + password + '"}',
    success: function () {
      //do any process for successful authentication here
    }
  })
}
```

and the gin router function like below:

``` go
type LoginJSON struct {
    username string `json:"username" binding:"required"`
    password string `json:"password" binding:"required"`
}

func API_Login_Check(c *gin.Context) {
    data, err := Asset("static/login.html")

    var json LoginJSON
    ret := c.Bind(&json)

    fmt.Println(ret)
    fmt.Println(json.username)
    fmt.Println(json.password)
    ...
}
```

When run it, get the following error:

```
2014/11/15 22:09:51 PANIC: reflect.Value.Interface: cannot return value obtained from unexported field or method
/usr/local/go/src/pkg/reflect/value.go:1081 (0x8a7bc)
    valueInterface: panic("reflect.Value.Interface: cannot return value obtained from unexported field or method")
/usr/local/go/src/pkg/reflect/value.go:1070 (0x8a68c)
    Value.Interface: return valueInterface(v, true)
/Users/loushuai/workspace/go/src/github.com/gin-gonic/gin/binding/binding.go:177 (0xf4eef)
    Validate: fieldValue := val.Field(i).Interface()
/Users/loushuai/workspace/go/src/github.com/gin-gonic/gin/binding/binding.go:63 (0xf3d6c)
    formBinding.Bind: return Validate(obj)
<autogenerated>:6 (0xf577a)
/Users/loushuai/workspace/go/src/github.com/gin-gonic/gin/context.go:216 (0x59dff)
    (*Context).BindWith: if err := b.Bind(c.Request, obj); err != nil {
/Users/loushuai/workspace/go/src/github.com/gin-gonic/gin/context.go:212 (0x59b0f)
    (*Context).Bind: return c.BindWith(obj, b)
/Users/loushuai/workspace/go/src/pgweb/api.go:46 (0x22b8)
    API_Login_Check: ret := c.Bind(&json)
```

I'm new to gin and web develop, any idea will be appreciated.

Hi,

I've written a middleware package, but I'm having trouble denying access gracefully with gin, without getting either "Error #01: Permission denied! Meta: Operation aborted" or "[GIN] WARNING. Headers were already written!".

Here is the example I'm working on for gin, which uses the permissions package:

https://github.com/xyproto/permissions/blob/master/examples/gin/main.go

Any advise is appreciated!

Best regards,
Alexander F Rødseth

Setting up an API and I'm very new to Go and Gin.  I am able to return data from each URL until I attempt to integrate `AuthRequired()`

``` go
// User Functions - located in users.go
    user := r.Group("/user")
    user.Use(AuthRequired())
        {
            user.GET("/info", userInfo)
            user.PUT("/update", updateUser)
        user.DELETE("/delete", deleteUser)
        }
```

I'm assuming `AuthRequired` is calling a function.  That function will then return success or fail based off the parameters provided.  When a user is created or logged in, they get a token, that token + email, if found as a matching pair in the DB will grant them access.  

``` go
//Authenticate User
func AuthRequired() gin.HandlerFunc {
    return func(c *gin.Context) {
        //Get token and e-mail from header
        token := c.Request.Header.Get("AuthToken")
        email := c.Request.Header.Get("AuthEmail")

        //check to see if email & token were provided
        if len(token) == 0 || len(email) == 0 {     
        }   
        //Find email in database
        //Compare stored token with token provided in header
        //Return - Authentication was success or fail
    }
}
```

In binding.go line 90

``` go
formStruct.Elem().Field(i).Set(slice)
```

It will throw error since on line 68

``` go
formStruct := reflect.ValueOf(ptr).Elem()
```

formStruct will never be an interface or ptr on line 90. it will Panic.
change line 90 to:

``` go
formStruct.Field(i).Set(slice)
```

it will work properly.
~Keyang

hi!
here is my code.

``` go
func main() {
    gin.SetMode(gin.DebugMode)
    r := gin.Default()
    r.LoadHTMLTemplates("templates/*")
    r.GET("/", controllers.AddMember())
    r.GET("/member/:nick", controllers.GetMemberByNick())
    r.GET("/html", func(c *gin.Context) {
        obj := gin.H{"title": "Main website"}
        c.HTML(200, "templates/index.tmpl", obj)
    })
    r.Run(":8080")
}
```

here is GetMemberByNick():

``` go
func GetMemberByNick() gin.HandlerFunc {
    return func(c *gin.Context) {
        m := services.GetMemberByNick(c)
        if m != nil {
            c.HTML(200, "index.tmpl", m)
        } else {
            msg["status"] = "0"
            msg["info"] = "not found"
            c.JSON(200, msg)
        }

    }
}
```

here is my project

![d69c1268-a08b-460a-aa41-87dc246202b9](https://cloud.githubusercontent.com/assets/6874537/4963827/64fd51e2-6730-11e4-9887-a631759f90e2.png)

but,I cannot get the template("/member/:nick" and "/html")

can you help? thanks.

https://github.com/gin-gonic/gin/issues/116

Not a big deal, but, in the description it says : 
"Gin is a web framework **for in** Golang. It features...", where it should say : "Gin is a web framework **written in** Golang. It features..." or "Gin is a web framework **for** Golang. It features...".

As Title

There's a small typo on the HTML POST form binding example. This PR fixes it.

Hi, this doesn't work on a group level i.e when the middleware is attached to a r.group.
When i make an options request which is handled by a cors middleware, it just returns a 404 error.

It however works when the middleware is attached to the main route. I would like to expose some auth headers only for auth end points, so the option of wrapping all routes with Access-Control-Expose-Headers that mention it exposes certain headers even though they don't would be messy.

This is related to https://github.com/gin-gonic/gin/issues/29


Does gin have an equivalent to martini's map function?

This makes me sad:

``` bash
bryans-mbp:server bryanstenson$ [feature/use-gin*] go version
go version go1.2.2 darwin/amd64
bryans-mbp:server bryanstenson$ [feature/use-gin*] go get github.com/gin-gonic/gin
# github.com/gin-gonic/gin
../../../gin-gonic/gin/gin.go:44: undefined: sync.Pool
```

how can i do this? by url path len
    router.GET("/:b/:a", func(c *gin.Context) {
        c.String(500, "1")
    })
    router.GET("/:c/:b/:a", func(c *gin.Context) {
        c.String(500, "2")
    })
    router.GET("/:d/:c/:b/:a", func(c *gin.Context) {
        c.String(500, "3")
    })

I don't understand why it's not using the Template reference in debug mode?

``` golang
func (_ htmlDebugRender) Render(w http.ResponseWriter, code int, data ...interface{}) error {
    writeHeader(w, code, "text/html")
    file := data[0].(string)
    obj := data[1]
    t, err := template.ParseFiles(file)
    if err != nil {
        return err
    }
    return t.ExecuteTemplate(w, file, obj)
}
```

How am I use suppose to use a custom templates directory in debug mode? Currently, it can only detect templates that are in the root directory. Meaning, if I place my templates in `static/*` directory, Gin is not able to detect it which makes setting `LoadHTMLFiles()` useless in debug mode.

Samples come directly from README are broken due to the gin_mode checking from both LoadHTMLGlob & LoadHTMLFiles

``` go
    if gin_mode == debugCode {
        engine.HTMLRender = render.HTMLDebug
    } else {
        templ := template.Must(template.ParseGlob(pattern))
        engine.SetHTMLTemplate(templ)
    }
```

I have the following middleware that checks if a session(gorilla) is set before allowing the request to pass through. 

``` go
package middlewares

import (
    "errors"

    "github.com/gin-gonic/gin"
    "github.com/goinggo/tracelog"
    "github.com/gorilla/sessions"
)

var emptySession = errors.New("Empty session.")

func UserAuth(store *sessions.CookieStore) gin.HandlerFunc {
    return func(c *gin.Context) {
        session := c.MustGet("session").(*sessions.Session)
        if session.Values["uid"] == nil {
            tracelog.CompletedError(emptySession, "UserAuth", "Checking of session uid value")
            c.JSON(401, gin.H{"message": "Empty Session.", "status": 401})
            c.Abort(401)
        }
    }
}
```

How can I prevent Gin from spitting the following error?

```
ERROR: 2014/10/08 16:26:44 userAuth.go:17: UserAuth : Checking of session uid value : Completed : ERROR : Empty session.
TRACE: 2014/10/08 16:26:44 response_writer.go:44: [GIN] WARNING. Headers were already written!
```

Note that it only happens when no sessions are set.

This is the same as #123, just a bit shorter version :)

Without this change following code would panic on `Validate`:  `reflect.Value.Interface: cannot return value obtained from unexported field or method`

```
  struct A {
     Name string `binding:"required"`
     field string
  }

...
c.Bind(&A{})
```

How could you get the [ace templating system](https://github.com/yosssi/ace) to work with Gin?

So far, it doesn't work ...

```
r.GET("/", func(c *gin.Context) {
r.LoadHTMLTemplates("templates/*")
    obj := gin.H{"title": "Main website"}
    c.HTML(200, "index.tmpl", obj)
})
```

must run hello from the source directory else won't find index.tmpl

do you have some demo script that's more complete to work on? beego.me is very good at their documentation. i would like to know how to display and where to put the template... 

Hey I have the following code:

```html
<input type="checkbox" name="colors" value="red">Red&nbsp;
<input type="checkbox" name="colors" value="green">Green&nbsp;
<input type="checkbox" name="colors" value="blue">Blue&nbsp;
<input type="checkbox" name="colors" value="black">Black&nbsp;
<input type="checkbox" name="colors" value="white">White&nbsp;
```

What is the correct way to bind them (using Bind Middleware) to obtain all data from them? I'm binding to an string but I only get the first one, if I bind to a slice I get an error.

Any ideas? Does Bind support this?

This is done in other languages by naming the group as an array:

```
<input type="checkbox" name="colors[]" value="purple">Purple&nbsp;
```

Then my struct will have a slice to bind. But I can't seem to make it work here.

How do you do something like this? 

``` go
  c.BindWith(&user, binding.JSON, []string{"FirstName", "LastName", "Title"})
```

That is I only want a known set of fields to be hydrated for a handler. The field list can change per handler. I guess I could create a new DTO struct per hander but that doesn't seem very DRY.

I'm working on an angularjs app, with gin as the backed stack.

If I set html5Mode to true, I need to configure my server to play along by means of this (https://github.com/angular-ui/ui-router/wiki/Frequently-Asked-Questions#how-to-configure-your-server-to-work-with-html5mode)

The question is .. can anybody provide guidance on how to build such a redirect middleware ?

Context should have the ability to create custom headers.

*gin.Context.JSON should be able to return an empty array as that is valid json.

How to setup / run the socket.io compatible server ? https://github.com/googollee/go-socket.io/

Tried 2 methods

```
server, err := socketio.NewServer(nil)
1) server.ServeHTTP ( c.Writer, c.Request )
2) http.Handle("/socket.io/", server)
```

But can't connect from the client, loops in

```
 POST /socket.io/
  GET /socket.io/
 POST /socket.io/
  GET /socket.io/
```

Just a little check so it does not panic if the struct contains an unexported field.

A utility method that complements context.Get and context.MustGet that lets you specify a default value to be returned if the key doesn't exist.



``` go
    r := gin.Default()
    r.Static("/static", "./static")

    r.LoadHTMLTemplates("./templates/*")
    r.GET("/index", func(c *gin.Context) {
        obj := gin.H{"title": "Main website"}
        c.HTML(200, "index.tmpl", obj)
    })
```

this code display "404 page not found"

``` go
    gin.SetMode(gin.ReleaseMode)
    r := gin.Default()
    r.Static("/static", "./static")

    r.LoadHTMLTemplates("./templates/*")
    r.GET("/index", func(c *gin.Context) {
        obj := gin.H{"title": "Main website"}
        c.HTML(200, "index.tmpl", obj)
    })
```

this code display rendered HTML Templets
is it bug? or deliberately?

> i can't English well. so a little strange Sentence There may be
> understand my poor English.. :(

Hi,

Can you recommend a session package I can use? I looked at gorrila sessions but it requires gorilla context which I don't like since Gin already has context implementation. I would appreciate your input.

Awesome framework.

Thanks!

Hi There,
I guess I didn't "get" it with "c.Set()" and "c.Get()"...
In the examples it seems simple but if I copy the example just like it is on the readme page, well the compiler complain with : 
 "multiple-value c.Get() in single-value context"

either with : 
myvar, err := c.Get("myvar").(string)
or
myvar := c.Get("myvar").(string)

after setting it in a middleware like this:

c.Set("myvar", "varvalue")

What is the catch ?
Note that it's working well with MustGet but I don't want a panic if empty...

Thanks for the Great Gin, the last Go Framework I've tried and keep.

We're using jsonapi spec - http://jsonapi.org/ and we need to use `application/vnd.api+json` as the content-type. Would be great if gin allows content-type to be changed when using c.JSON().

post data bind Structure of combine slices ，Binding framework resolution not correct data structure

client post data:
map[
password:[123] 
question_answers[0][code]:[q11] 
question_answers[0][group]:[g11] 
question_answers[0][answer]:[12345]
question_answers[1][code]:[q21] 
question_answers[1][group]:[g21] 
question_answers[1][answer]:[56789]
]

server bind struct:

``` go
type SecretQuestionAnswer struct {
    Password        string   `form:"password"`
    QuestionAnswers []SecretQuestionAnswerItem `form:"question_answers[]"`
}
type SecretQuestionAnswerItem struct {
    Code   string `form:"code"`
    Group  string `form:"group"`
    Answer string `form:"answer"`
}
```

goin bind code:

``` go
                // this exists is false
        inputValue, exists := form[inputFieldName]
        if !exists {
            continue
        }

        numElems := len(inputValue)
        if structFieldKind == reflect.Slice && numElems > 0 {
            log.Printf("form mapping slice numElems: %v", numElems)
            sliceOf := structField.Type().Elem().Kind()
            slice := reflect.MakeSlice(structField.Type(), numElems, numElems)
            for i := 0; i < numElems; i++ {
                if err := setWithProperType(sliceOf, inputValue[i], slice.Index(i)); err != nil {
                    return err
                }
            }
            val.Field(i).Set(slice)
        } else {
            if err := setWithProperType(typeField.Type.Kind(), inputValue[0], structField); err != nil {
                return err
            }
        }
```

I've coded the Formfile upload-end point with GIN framework and it was nice work. 
however, I couldn't check up that client's browser being turned off also  defers  doesn't work.
I want to check this signal , function , something like that. 

Could you recommend me nice solution about this case of abnormal disconnection. ?

I love the fact that the Bind function can use Form or JSON depending on the content type header.

If would be great if it could support YAML as well (for input) and provide the eqivalent

```
c.YAML(...)
```

methods, equivalent to what is there for JSON.

For some payloads, it can result in a noticeably smaller size on the wire (compared to JSON).

I'm having some issues wrapping my head around setting multiple templates in a bindata file created by go.rice.

I have the following code. 

``` go
import (
  "github.com/gin-gonic/gin"
  "github.com/GeertJohan/go.rice"
  "fmt"
  "html/template"
)
func main() {
  router := gin.Default()
  templateBox, err := rice.FindBox("templates")
  if err != nil {
      fmt.Println(err)
  }

  list := [...]string{"foo.html", "bar.html"}
  for _, x := range list {
    templateString, err := templateBox.String(x)
    if err != nil {
        fmt.Println(err)
    }
    tmplMessage, err := template.New(x).Parse(templateString)
    if err != nil {
        fmt.Println(err)
    }
    router.SetHTMLTemplate(tmplMessage)
  }
  router.GET("/index", func(c *gin.Context) {
      c.HTML(200, "foo.html", gin.H{
          "Message": "Main website",
      })
  })
  router.GET("/bar", func(c *gin.Context) {
      c.HTML(200, "bar.html", gin.H{
          "Message": "so much bar",
      })
  })
  router.Run(":8080")
}
```

So the /bar url works fine byt the /index one doesn't because the /index template is getting overwritten. 

The error I get is

```
[GIN-debug] [ERROR] html/template: "foo.html" is undefined
[GIN] 2016/01/17 - 07:19:40 | 500 |      67.033µs | 127.0.0.1:52467 |   GET     /index
```

I'm wondering if anyone has tackled this issue yet with gin. I'm looking to load a bunch of inherited templates into gin so i can have like _base.html, index.html, login.html and have index and login inherit _base


```
$ go get -x github.com/gin-gonic/gin
   package golang.org/x/net/context: unrecognized import path "golang.org/x/net/context"
```

If I start my web app it starts on port 9000. Then if I stop server (for example by pressing CTRL+Z), server stopped, but port is not released. Why this happened?

My app: https://github.com/pavlik/mimozaflowers/blob/master/server.go#L353

Add methods:
1. H.TrySet(k string, v interface{}) H
2. (_Engine).HTMLTemplateDelims(left, right string);
3. (_Engine).HTMLTemplateFuncs(funcMap template.FuncMap);

Add template package.

Effect:
Support render templates from multiple directories;
support nested template;
support add functions to template;
support modify the templates delimiter.

Folks, 

I was just wondering if there was a way to upload images _not_ using the form, i just have an api which is required upload an image. 

I have check around all of them seem to be a form upload.

I am wondering the best way to ensure the DAE.on does not go down.
1. Error handling on each e try route ?
2. Gin-sentry to catch and send to sentry. The gin-sentry repo has zero info on how to integrate into gin.
3. Restart on fail ?

Thanks..

Writing a package that generates swagger spec using engine.Routes() and reflection, I encountered a fairly specific issue:
All gin.HandlerFunc that are closures will have the same name, not letting me distinguish between them.

Would it be possible to have a Setter to configure custom names for certain gin.HandlerFunc, letting me override runtime.FuncForPC(...).Name() in gin.nameOfFunction() ? 

## Background

using `gin.Default()` and go 1.5

Code:

```
func (c *gin.Context) {
  // end up with NaN
  c.JSON(200, map[string]interface{}{
    "some": math.NaN(),
  })
}
```
## Whats happening

`json.Marshal` cannot marshal a `NaN` value. I happened to end up with `NaN` somehow and spent a long time debugging what was going on with the code, why the error wasn't being reported etc.

Note that gin tried to marshal the value and failed, however didn't print out the error message only returned HTTP 500 back.
## What should be happening

Cause panic() but be it caught via `gin.Recovery()`

The error isn't that I have NaN somewhere in the input but that the error from `json.Marshal` not being handled properly.


I'd be very interested to see the benchmark results of Gizmo as it compares to gin.

Hi,

I have a use case where I have an intermediary page that I have to output some JS and then do a redirect.

Here is a simplified version.

```
package main

import (
    "github.com/gin-gonic/gin"
)

func main() {
    r := gin.New()

    r.GET("/go", func(c *gin.Context) {
        c.Header("Refresh", "10")
        c.Header("Url", "http://www.google.com")
        c.Writer.WriteString(`<script>console.log("Hi!")</script>`)
    })

    r.Run(":8888")
}
```

The page just keeps on refreshing itself.  Never going to the URL despite the headers being written correctly.

Thanks

Loving The framework so far.  Never mind! :)

Hello.
It was corrected because the error had been out with travis by godep updates.
In addition, everyone has added go_import_path to .travis.yml to routing through the test in travis.

It was fixed comments godoc.
This is the three places of "Bind, DefaultQuery, Query" in the Context.

[Fasthttp](https://github.com/valyala/fasthttp) provides an http server optimized for high performance. It doesn't allocate memory in hot paths - the same approach is used by [httprouter](https://github.com/julienschmidt/httprouter).

With fasthttp gin may become even faster. See also [fasthttprouter](https://github.com/buaazp/fasthttprouter), httprouter fork based on fasthttp.

合并原作者的更新

Hi. Yesterday there was a new release of [godep](https://github.com/tools/godep/releases/tag/v35). When running `godep restore` in gin with the new version on a Mac an error is thrown while restoring one of the projects dependencies in [go-colorable](https://github.com/mattn/go-colorable):

```
~ $ cd $GOPATH
goworkspace $ go get -u github.com/gin-gonic/gin
goworkspace $ cd src/github.com/gin-gonic/gin/
gin $ godep restore
godep: error restoring dep (github.com/mattn/go-colorable): Unable to find dependent package github.com/mattn/go-isatty in context of /<redacted>/goworkspace/src/github.com/mattn/go-colorable
gin $ godep version
godep v35 (darwin/amd64/go1.5.1)
gin $
```

I use a middleware,like this

``` go
type functinTyoe func(*gin.Context) map[string]interface{}

func Default(f functinTyoe) gin.HandlerFunc {
    return func(c *gin.Context) {
        data := f(c)
        if data["rtncode"] == 0 {
            c.JSON(200, data)
            c.Abort()
        }
        c.Next()
    }
} 
```

the func f is to validate json data, it likes this:

``` go
var login Login
if c.BindJSON(&login) != nil {      
}
```

after that,I cannot get the data in controller like this:

``` go
var user models.User
c.BindJSON(&user)
```

this user has no data

any way to resolve it？thx！

'DELETE' is 6 chars and breaks indent of the routes dump (only 5 chars were reserved for the HTTP method).

I can't install validator with go get.
Is locked download with -v.
Work on mac, ubuntu but not on centos.
i have go 1.5.1

How to add funcsmap to template?

The following test should pass, but actually it fails.

```
func TestValidationSuccess(t *testing.T) {
    type HogeStruct struct {
        Hoge int `json:"hoge" binding:"required"`
    }

    var obj HogeStruct
    req := requestWithBody("POST", "/", `{"hoge": 0}`)
    err := JSON.Bind(req, &obj)
    assert.NoError(t, err)
}
```

The reason is a validator problem. See more detail hasValue in gopkg.in/bluesuncorp/validator.v5/baked_in.go

In the function, the validation checks with the following line

```
        return field != nil && field != reflect.Zero(reflect.TypeOf(field)).Interface()
```

But this is wrong. Because whenever "field == 0", it always fails. Actually if "field != 0", it succeeds. (In my previous test, {"hoge":1} succeeds.)

There are a couple of approaches.
1. Ask bluesuncorp/validator to fix the problem
2. Not to use bluesuncorp/validator and fix the problem by ourselves.

What do you think? I wonder most of the people don't use Bind() function and parse JSON by themselves?

Been waiting for v1 to be released...

Hey!

I could have missed it, but is there any way to get the port number the server listens on when I start it on port 0?

My use case would be: running a normal http server on port 80, which would sometimes spawn another http servers but on port 0. In those spawned servers I would like to get the actual tcp port they're listening on (and then save it to the database or whatever...)

What is `Keys`, `Errors`, `Accepted`? https://github.com/gin-gonic/gin/blob/52fcc5dbf6e94df33ad313858fb94b713e9d1b4a/context.go#L36

Need example show us how to generate rss output.
Please show us the way. thanks.

hello guys , i think its time that we should start giving http 2 related support to make gin very good and efficient.

I'm having a issue with some middleware ... i'm not sure if it's a bug, or more likely the way i'm using it  ... The service consumes the json payload, perform some check, aborts the context if required otherwise the proxy middleware forwards the require on. The proxy works fine for the urls not hitting the handler, but when it hits the handler, even with the context not abort the proxy middleware handler is never called, it just returns a 200 but is never forwarded .... Any help would be much appreciated!
#### **Gin Setup**

``` go
// step: create the gin router
router := gin.Default()

// step: handle operations related to replication controllers]
{
    replicationEndpoint := "/api/v1/namespaces/:namespace/replicationcontrollers"
    router.POST(replicationEndpoint, service.handleReplicationController)
}
router.Use(service.proxyHandler())
```
#### **Handler**

``` go
func (r *Service) handleReplicationController(cx *gin.Context) {

     READ PAYLOAD, PERFORM SOME CHECK AND SET THE BODY TO ORIGINAL CONTENT 
     // check the content is still there
    dump, err := httputil.DumpRequest(cx.Request, true)
    if err == nil {
        glog.V(10).Infof("%s", dump)
    }     

    glog.V(10).Infof("continuing the chain, is aborted: %t", cx.IsAborted())
}
```
#### **Decode Input**

``` go
// decode the payload and set the request body back to the original content
func (r *Service) decodeInput(req *http.Request, data interface{}) (string, error) {
    // step: read in the content payload
    content, err := ioutil.ReadAll(req.Body)
    if err != nil {
        glog.Errorf("unable to read in the content, error: %s", err)
        return "", err
    }
    defer func() {
        // we need to set the content back
        req.Body = ioutil.NopCloser(bytes.NewReader(content))
    }()

    rdr := strings.NewReader(string(content))

    // step: decode the json
    err = json.NewDecoder(rdr).Decode(data)
    if err != nil {
        glog.Errorf("unable to decode the request body, error: %s", err)
        return "", err
    }

    return string(content), nil
}
```
#### **Proxy Middleware**

``` go
func (r *Service) proxyHandler() gin.HandlerFunc {
    return func(cx *gin.Context) {
        fmt.Println("PROXYING ON")

        // step: does the connection need upgrading?
        if cx.Request.Header.Get("Upgrade") != "" {
            if err := r.hijackRequest(cx); err != nil {
                glog.Errorf("unable to upgrade the connetcion, %s", err)
            }
            return
        }

        // step: pass into the reverse proxy
        r.proxy.ServeHTTP(cx.Writer, cx.Request)
    }
}
```
#### **Output**

``` shell
PROXYING ON
[GIN] 2015/11/16 - 12:07:10 | 200 |  130.368449ms | 127.0.0.1 |   GET     /api
I1116 12:07:10.975621   20514 handlers.go:57] continuing the chain, is aborted: false
[GIN] 2015/11/16 - 12:07:10 | 200 |       19.52µs | 127.0.0.1:40498 |   POST    /api/v1/namespaces/default/replicationcontrollers
```

This is a continuation of #206 since the author closed it.
The idea is that when an error is raised, we should be able to find where the error came from. Currently, for many error sources, such as `context.JSON()`, we don't get to control the error message, so we can't add anything to identify the source, or what was going on at the time.
The best way to solve this would be to get a stack trace. If the `gin.Error` struct had a field for holding a stack trace, we could set a flag on the engine (which would be inherited by context) that would control whether or not to gather a stack trace on `Context.Error()`.
The loggers could then do what they want with the stack trace, such as showing the line number of the first frame outside the `gin` package, or the full stack.

Edit: It would probably also be good to capture the timestamp inside the error. This just in case there is a large delay going back down through the middleware stack before you get to the logger.

Use a map instead of a slice to store the preprocessed Accounts table.

I cant disable RedirectTrailingSlash

```
gin.SetMode(gin.ReleaseMode)
r := gin.Default()
r.RedirectTrailingSlash = false
r.RedirectFixedPath = true
r.StaticFS("/", http.FileSystem(root))
r.Run(":8080")
```

```
curl -v http://localhost:8080/metadata/
*   Trying 127.0.0.1...
* Connected to localhost (127.0.0.1) port 8080 (#0)
> GET /metadata/ HTTP/1.1
> Host: localhost:8080
> User-Agent: curl/7.44.0
> Accept: */*
> 
< HTTP/1.1 301 Moved Permanently
< Location: ../metadata
< Date: Wed, 11 Nov 2015 10:07:33 GMT
< Content-Length: 0
< Content-Type: text/plain; charset=utf-8
< 
* Connection #0 to host localhost left intact
```

I am looking for a long time , add this document will
help who were looking for graceful restart/stop like me.

Signed-off-by: ZhiFeng Hu hufeng1987@gmail.com

I realized this method, because I need to use a more compact pongo2 engine.

other way fix it: #449 

An example is if you wanted users to have their own subdomains like GitHub Pages: `{username}.github.io`

Sorry, was bugging me :smile: 


Looking at the commit, the last one is September... I'd like to use gin, but I'm afraid what this WF going to. Go version is 1.4, too. Could anyone know anything?

Getting this error:
# gopkg.in/bluesuncorp/validator.v5

../../../gopkg.in/bluesuncorp/validator.v5/validator.go:41:17: error: reference to undefined identifier ‘sync.Pool’
 var structPool *sync.Pool
                 ^
../../../gopkg.in/bluesuncorp/validator.v5/validator.go:331:21: error: reference to undefined identifier ‘sync.Pool’
  structPool = &sync.Pool{New: newStructErrors}
                     ^
../../../gopkg.in/bluesuncorp/validator.v5/validator.go:331:25: error: expected ‘;’ or ‘}’ or newline
  structPool = &sync.Pool{New: newStructErrors}
                         ^
../../../gopkg.in/bluesuncorp/validator.v5/validator.go:333:2: error: expected declaration
  return &Validate{
  ^
../../../gopkg.in/bluesuncorp/validator.v5/validator.go:337:1: error: expected declaration
 }
 ^
../../../gopkg.in/bluesuncorp/validator.v5/validator.go:352:21: error: reference to undefined identifier ‘sync.Pool’
  structPool = &sync.Pool{New: newStructErrors}
                     ^
../../../gopkg.in/bluesuncorp/validator.v5/validator.go:352:25: error: expected ‘;’ or ‘}’ or newline
  structPool = &sync.Pool{New: newStructErrors}
                         ^
../../../gopkg.in/bluesuncorp/validator.v5/validator.go:353:1: error: expected declaration
 }
 ^
../../../gopkg.in/bluesuncorp/validator.v5/validator.go:331:46: error: missing return at end of function
  structPool = &sync.Pool{New: newStructErrors}
                                              ^

Hi,

I try to use Gin. 

Gin returns broken JSON responses ..

Example:

``` go

package api

import (
    "appengine"
    "encoding/json"
    "github.com/gin-gonic/gin"
    "net/http"
)

// Json Response for failures
type ErrorJson struct {
    Code int    `json:"code"`
    Msg  string `json:"msg"`
}

func init() {

    r := gin.Default()

    noAuth := r.Group("/api/auth")
    {
        noAuth.GET("/index", Index)

        noAuth.POST("/login", Login)

    }

    api := r.Group("/api")
    {
        api.GET("/index", Index)
    }

    http.Handle("/", r)
}

func Login(c *gin.Context) {

    defer recoverAndJSONResponse(c)

    nick := c.PostForm("nick")

    user := NewAnonUser(nick)

    ctx := createContext(c.Request)

    _, err := user.saveOnDatastore(ctx)

    if err == nil {

        panic("User was not seved !")

    }

    jsonRes, err := json.Marshal(user)

    if err != nil {

        panic(err.Error())

    }

    c.JSON(http.StatusOK, jsonRes) // output: "eyJjb2RlIjo1MDAsIm1zZyI6IlVua25vd24gRXJyb3IgISJ9"


}


```

CURL:

``` sh
 curl -v --form nick=Test http://localhost:8080/api/auth/login
* Hostname was NOT found in DNS cache
*   Trying 127.0.0.1...
* Connected to localhost (127.0.0.1) port 8080 (#0)
> POST /api/auth/login HTTP/1.1
> User-Agent: curl/7.38.0
> Host: localhost:8080
> Accept: */*
> Content-Length: 143
> Expect: 100-continue
> Content-Type: multipart/form-data; boundary=------------------------8b68796dd6c0e302
> 
< HTTP/1.1 100 Continue
< HTTP/1.1 500 Internal Server Error  
< content-type: application/json; charset=utf-8
< Cache-Control: no-cache
< Expires: Fri, 01 Jan 1990 00:00:00 GMT
< Content-Length: 51
* Server Development/2.0 is not blacklisted
< Server: Development/2.0
< Date: Fri, 30 Oct 2015 11:28:45 GMT
* HTTP error before end of send, stop sending
< 
"eyJjb2RlIjo1MDAsIm1zZyI6IlVua25vd24gRXJyb3IgISJ9" // What is that ??
* Closing connection 0

```

I  have tested some JSON response with Gin. All of it are broken responses like as "eyJjb2RlIjo1MDAsIm1zZyI6IlVua25vd24gRXJyb3IgISJ9"

It looks Gin generates encoded json response and I don't know that coding...

```
rtn, _ := queryAvatarFromDB(uid, size)  //rtn is byte array
    if rtn {
        c.Writer.Header().Set("Content-Type", "image/jpg")
                //how to output []byte to image?
    } else {
        c.String(404, "")
    }
```

This repository change name, please update the import to reflect the new name

I just implemented a timeout middleware in gin, and it's working, but, in log i get some warnings. 
Any idea guys of what can be happening?

``` go
func Filter(t time.Duration) func(c *gin.Context) {
    return func(c *gin.Context) {
        finish := make(chan struct{})

        go func() {
            c.Next()
            finish <- struct{}{}
        }()

        select {
        case <-time.After(t):
            c.JSON(504, "timeout")
            c.Abort()
        case <-finish:
        }
    }
}
```

Log output:

``` shell
[GIN-debug] [WARNING] Headers were already written. Wanted to override status code 504 with 200
[GIN-debug] [ERROR] Conn.Write wrote more than the declared Content-Length
[GIN-debug] [WARNING] Headers were already written. Wanted to override status code 200 with 500
```

I took a stab at clarifying the `context.Abort` func. Seems there's some confusion for us newbies as to how it's supposed to be used.

Sorry to bother you, but golang.org is blocked in China. It's hard to `go get` code here.

So how about change "golang.org/x/net/context" to "github.com/golang/net/context"

I know `context.JSON()` returns the serialised object with content type `"application/json; charset=utf-8"`. But I want to skip serialising by returning **cached** plain text, because my object does not change constantly.

Is it possible to use something like `context.String()` but set content type `"application/json; charset=utf-8"`?

Thanks.

`utils.parseAccept()` drops quality values (`q=`) when parsing Accept headers.
So `Context.NegociateFormat` can not use them.

This should at least be documented until a fix is available.

Reference: https://tools.ietf.org/html/rfc7231#section-5.3.1

Hi folks,

I'm having trouble accessing array post data. I have the following data in postman:

```
set[]height = 80
set[]width = 90
set[]height = 60
set[]width = 100
```

Then I'm just outputting the input data in the terminal using `fmt.Println(c.Request.MultipartForm.Value)
` for that I got `map[set[]height:[500 600] set[]width:[800 800]]` and when I try to access the 'set' data, using `fmt.Println(c.Request.MultipartForm.Value["set"])` I get `[]`. 

I'm fairly new to Go, so I might just be doing something totally stupid... Thanks for your patience. 

fix query parameter name

```
router.LoadHTMLGlob("template/*/*.html")
```

My wish was: load html from template directory and it's subdirecty.

for example, a template file will be template/account/register.tmpl

Hello. Is there any way to use custom context?
E.g.:

``` go
func ViewHandler(ctx *AppContext) {
    //code
}
```

When I use c.JSON () on the server to return a JSON data, the data returned by the server in the Chrome browser to see the data is always more than a blank line

Hey!

My problem is a bit complex, but I hope someone can help me. I have an API server made with gin and an Angular app on client side. The authentication is done with JWT. So far so good, everything works.

Since websocket doesn't support `authorization` header I thougt I'll make the websocket urls like this: `/ws/:token/whatever` and use a middleware to validate the token. This is working, no problem there.

Here comes the problem though: Let's say I want to invalidate a user's tokens. I destroy them on server side, that's okay, but I also want to tell the user on the client side via websocket to remove the token from localStorage and then log him out. Obviously on a refresh, or state change, or whatever else the user would get `401` anyway, but I would like to sign him out still.

There is a basic websocket example in #51, but it doesn't solve my problem.
Basically: how can I write to an exact websocket from another API call?

Example: admin calls `/api/admin/user/sessions/clear`, posts the user id. This calls a function `ClearSessions()`. How can this `ClearSessions()` function also write to the user's websocket (`/ws/:token/whatever`)?

Thanks!

contribution : https://github.com/0x4139/ginAuthentication

Is there a way set router path to case-insensitive?

Method `c.PostFormExists(key)` returns `true` if field with given name exists in the form.

Right now there is no way to check if field exists in the form or not.
The functionality needed for example for `PATCH` requests when result of binding to a `string` gives false positive for field existence check.

Let's say we have struct for binding:

``` go
type UserPayload struct {
    Gender    string `json:"gender" form:"gender"`
}

...

var userPayload UserPayload
c.Bind(&userPayload)
```

Now if I `POST/PATCH/PUT` both empty user object `{}` or user object with empty field `{gender: ""}` 
`userPayload.Gender` will be equal to an empty string. 

Hope my explanation is clear, but please feel free with any questions.
Thanks.

App engine example doesnt work ...I got this error:
ERROR    2015-10-09 18:09:35,445 http_runtime.py:391] bad runtime process port ['[GIN-debug] GET   /                         --> main34740.func\xc2\xb7001 (1 handlers)\n']

One common problem with template rendering is that an error in template.Execute will write a partially rendered page to the response writer. 

The standard way to deal with this seems to be rendering templates to a temporary buffer and only flushing to the http response on success. 

Buffers can be retained and reused to reduce gc pressure for added benefit. It seems a schema like this could be worked into the core render code, but I am not sure if that is a direction you want to go with this. I could certainly make my own renderer to do this. Thoughts?

I've been reading the GoDoc for an easy way to do this but I haven't found anything that stuck out.

The situation:
- Building a REST API with gin and JWTs for authorization
- Handler chain composed of generic handler which checks for a JWT token in the header before passing onto specific endpoint handler
- First handler reads the header and parses the JWT for claims, wanting to store this information somehow in the *gin.Context so that the next handler can use it?

I'd like to avoid reading the JWT twice or putting that read in every specific endpoint handler. I'm sure there is an easy way but I'm missing it!

Thank you.

``` go
router.GET("/list-:id-:page", handler) //panic
```

why not support?

``` go
router.GET("/list-:id/:page", handler) //pass
```

Possible wrong copy/paste TODO

Possible a wrong copy/paste from gin_test.go

Any chance we could change Binding.Bind(_http.Request, interface{}) error to Binding.Bind(_http.Request, ...interface{}). I'm always parsing hash maps from the server. It would be nice to get multiple objects out of them using reflection and map[string]json.RawMessage. You don't have to make that the default implementation, and it wouldn't be a breaking change. I would just like to be able to write a binding that does this myself.

To that end, is there any way we could spin off rendering json into a "rendering" package, much like the "binding" package and then change Context.JSON(int, interface{}) to Context.JSON(int, ...interface{}). Again, I would like to be able to dynamically construct a map[string]interface{} from multiple models with reflection . This would also not be a breaking change. 

UPDATE: It looks like you already have a "render" package. I'm not sure if it can do what I wan't it to do though.

If neither of these changes sound outlandish to you, I would be happy to make them myself when I have time. But if these changes seem like ones you would not want to incorporate into the framework and support, I won't bother. Gin is really promising, but I just need a way to do these two things for me to switch. Thanks.

I defined `router.PUT("/admin/sourcesentences/:id/update", routes.UpdateSourceSentence)`

When the web app runs, it prints `[GIN-debug] PUT   /admin/sourcesentences/:id/update --> myproject/routes.UpdateSourceSentence (4 handlers)`.

But when I really send a PUT request via http form (I override POST), I always get 404 `[GIN] 2015/10/02 - 23:03:36 | 404 |      89.501µs | [::1]:56720 |   PUT     /admin/sourcesentences/40/update`

At last, I have to use POST.

I want to add a custom function to my html templates. I copied code from `gin.LoadHTMLGlob` and added `Funcs(funcMap)`, but the custom function only works in release mode. 

``` go
// Modified code from gin.LoadHTMLGlob
func loadHTMLGlob(engine *gin.Engine, pattern string) {
    funcMap := template.FuncMap{
        "customFunc": customFunc, // A custom template function
    }
    //if gin.IsDebugging() {
    //  debugPrintLoadTemplate(template.Must(template.New("").Funcs(funcMap).ParseGlob(pattern)))
    //  engine.HTMLRender = render.HTMLDebug{Glob: pattern}
    //} else {
    templ := template.Must(template.New("").Funcs(funcMap).ParseGlob(pattern))
    engine.SetHTMLTemplate(templ)
    //}
}
```

After researching, I found the cause. In debug mode, `debugPrintLoadTemplate(template.Must(template.New("").Funcs(funcMap).ParseGlob(pattern)))` only checks templates but does not really use them. gin always reloads templates without calling Funcs(funcMap) when rendering. 

I have to comment out the related code for debug mode. Custom function works now. But I have to restart the app to let the modified template work when developing. It's a little inconvenient. 
#### It will be great if gin supports custom template functions. I think many people need custom template functions.

I am not confident enough to make a pull request. I suggest adding a variable like funcMap and modifying code in gin/render/html.go like this:

``` go
func (r HTMLDebug) loadTemplate() *template.Template {
    t := template.New("")
    if funcMap != nil {
        t.Funcs(funcMap) // Set funcMap for custom template functions
    }
    if len(r.Files) > 0 {
        return template.Must(t.ParseFiles(r.Files...))
    }
    if len(r.Glob) > 0 {
        return template.Must(t.ParseGlob(r.Glob))
    }
    panic("the HTML debug render was created without files or glob pattern")
}
```

Hi guys,

I was wondering if it was possible to:
- Transform an incoming request, I have a multipart image to convert into a base64 string and wrap it into a JSON payload, then I have several templates for the json (one per routes).
- Transform the output response by nesting the request of 4 routes queried with the previous transorm and combine results ?

I am looking to do something like https://github.com/daniel-j-h/DistributedSearch

Is it possible to do it with gin ? What would be the best golang http routeur to do that fast and with a low memory footprint ?

Cheers,
Luc

I have something akin to this:

``` go
import mw "middleware"

someGroup := engine.Group("/some/path") 
{
   // inject middleware for all the following routes
   someGroup.Use(mw.FuncAbc())
   someGroup.Use(mw.FuncBcd())

   // both these routes use the middleware above
   someGroup.POST("/foo", fooHandler)
   someGroup.GET("/foo/bar", fooBarHandler)
}
```

...which works just fine, but I was a bit surprised when I then appended something like this:

``` go
someGroup := engine.Group("/some/path") 
{
   // inject middleware for all the following routes
   someGroup.Use(mw.FuncAbc())
   someGroup.Use(mw.FuncBcd())

   // both these routes use the middleware above
   someGroup.POST("/foo", fooHandler)
   someGroup.GET("/foo/bar", fooBarHandler)

   // this only runs middleware Cde, not Abc or Bcd
   someGroup.POST("/baz", mw.FuncCde(), bazHandler)
}
```

By specifying the middleware as part of the argument to the http method, it seems to eradicate middleware that is set on the group level.  Is this the intention?

Is the only workaround to specify all middleware handlers in each HTTP post method, a.k.a.:

``` go
someGroup.POST("/baz", mw.FuncAbc(), mw.FuncBdc(), mw.FuncCde(), bazHandler)
```

This seems clunky and repetitive.  I would have thought that specifying a handler for an http method on a group where global middleware settings were configured at the group level, would not be overwritten on a per-method basis?

I want to write a custom logger that, for 5xx errors, will log the response body, but I can't find any documentation on getters for the body, only setters. I imagine the body is streamed or takes an io.Writer shape so this is probably a little more complex; but would appreciate any guidance

I want to compress the http response with gzip or deflate, the algorithm is determined by "Accept-Encoding" of request header. 
How to do it?

Thanks.

I've made a sample code to explain what's happening:

``` go
package main

import (
    "net/http"

    "github.com/gin-gonic/gin"
)

func main() {
    r := gin.Default()
    r.RedirectTrailingSlash = true
    r.RedirectFixedPath = true

    r.GET("/login", func(c *gin.Context) {
        form := "<form method='POST' action='/login/do'><input type='submit' /></form>"
        c.Header("Content-Type", "text/html")
        c.String(http.StatusOK, form)
    })

    r.POST("/login/do", func(c *gin.Context) {
        c.Redirect(http.StatusTemporaryRedirect, "/welcome")
    })

    r.GET("/welcome", func(c *gin.Context) {
        c.String(http.StatusOK, "Welcome")
    })

    r.Run(":8888")
}
```

When it tries to redirect from a POST to `/login/do` to `/welcome` the result is 404 (`404 page not found`).
But if I try to go directly to `/welcome` everything works fine.

Am I doing something wrong?

Hi! I have a code:

``` go
    type select struct {
        Active bool     `form:"active" json:"active" xml:"active"`  //def: true
        Nick   string   `form:"nick" json:"nick" xml:"nick"`        //def: "anonymous"
        // ........
    }
    var s struct
    c.Bind(&s)
```

Necessary to achieve these results:

```
http://......?active=true&nick=aa    // s.Active: true,   s.Nick: "aa"

http://......?active=false&nick=bb   // s.Active: false,  s.Nick: "bb"

http://......?none                   // s.Active: true,   s.Nick: "anonymous"
```

Are there ways to achieve these results?

After update template html files, is there anyway that gin could reload those files into memory without restart whole service?

please consider RawJSON  pull request.  I needed it for a case where I already had the JSON in a byte slice and I just wanted to write it out without incurring additional overhead costs of unmarshalling then re-marshalling it.  This is useful for cases such as redis with lua returning the raw JSON bytes of when you use a library like https://github.com/pquerna/ffjson where you need better performance for JSON.  

I also replaced the hardcoded test paths in the assertions so that it is easier for contributors to run the tests.

New to gin and am experimenting with intercepting 404, so far I have this:

``` go
...
r := gin.Default()
r.Use(createAndReload())
...
func createAndReload() gin.HandlerFunc {
    return func(c *gin.Context) {
        c.Next()
        status := c.Writer.Status()
        if status == 404 {
          createFile(c)
          c.Redirect(301, c.Request.URL.Path)
        }
    }
}
...
```

The intended behavior is that when you hit a 404 page gin creates that page (a static file) and then refreshes/reloades or "redirects" the user to the same page, which now exists.

But I'm having trouble overwriting 404, the above code just serves a 404 page with some additional text:

```
404 page not found
<a href="/test1">Moved Permanently</a>.
```

Do I have to do a `/:page` route that handles this so it never actually enters a 404 state, or can I continue using `r.StaticFS("/wiki", http.Dir(buildDir))` and when the static file doesn't exist I just intercept the process?

Also one problem with the `/:page` route solution, the content I want to serve is just static html so .StaticFS seems ideal, I can't serve through c.JSON or c.String, but maybe through c.HTML, but that requires me to make gin aware of "HTML Templates" which I guess would be `router.LoadHTMLGlob(buildDir+"/*")` but I'm not sure if that can "adjust" to created and deleted files in the build dir like .StaticFS can, which would leave me with somehow removing and adding "templates" (actualy just static html in this case) as they get added and removed in the filesystem.

I am trying to use context#BindJSON but it returns EOF. If I replace it with a JSON Decoder it works fine.

A sample of the code:
http://hastebin.com/torosarosi.go

Anyone know as to why it may be returning EOF?

Hello,

I need to parse a POST request which has something like 

```
",eventType=Exit,Name=Zone0,SiteID=test,DeviceID=00b09dc9e,DT=2015-09-18T03:07:37\r\n"
```

in the body. Unfortunately it is comma separated. Is there a way to configure a custom Binder for these type of requests ? Is there an example somewhere ?

Thanks for the great software !

hi everybody,
I'm new to golang and I'm working on our http api server with gin.
There are some time-consuming operation in some of our http handlers, and we just want the client to wait util results return so we didn't put those codes in another go routine or turn to another worker process.
While after running for hours, even the simplest api will not get any response.
e.g. such code would make clients wait till death:

``` go
api.GET("/_ping", func(c *gin.Context) {
    c.String(200, "pong")           
})
```

so I think this is not because of our time-consuming codes, but gin itself, right? Or are there any other possibilities I should check?
We copied gin source code to our proj several month ago with godep, so gin we are using differs from the latest.
thanks a lot

How to do dependency injection with Gin, for example for testing/mocking, or to have a Middleware that make a Copy of the database session in each request? (ie. MongoDB)

Have searched far and wide and I can't find any examples.

I'm currently injecting my DB Session Copy into the context map via middleware (defer close) and then extracting it with a function inside my handler with type assertion, I think that's the correct/only way, but it just doesn't feel right.

Hi there, I've been using gin quite extensively in one of my projects, and there are often times I'd like to only return the status code (no body). Would you be open to a pull request that allows the following:

```
c.NoContent(http.StatusOK)
```

or even simply:

```
c.Status(http.StatusOK)
```

Currently I'm doing `c.Response().WriteHeader(http.StatusOK)`, however, I think the above helper functions are a bit more readable and more consistent with how I interact with gin for everything else. Thanks!

AFAIK, there is no explanation for it anywhere, neither in Godoc nor in github readme.
so I suggest to add them to godoc and readme

Angular suggest adding prefix `)]}',\n` to all json responses.
Google adds `while(1);`.

What about adding `SecureJson` or `SafeJson` or `AngularJson` method which would write JSON with prefix?

How can I use .Delims with gin?
I can do it in Go

``` go
t := template.Must(template.New("index.html").Delims("[[", "]]").ParseFiles("templates/index.html"))
```

but I can't do it in gin.

Thanks. 


After calling `c.Bind(&form)`, is it possible to provide a custom validation error message per field rather than the generic "Field validation for '...' failed on the '...' tag"

Hi!!

I'm using Gin framework for a web server. I start to see some weird errors popping up. It wasn't there before:

```
Go error encoding/hex: invalid byte: U+0075 'u'
Go error encoding/hex: invalid byte: U+0075 'u'
Go error encoding/hex: invalid byte: U+0075 'u'
Go error encoding/hex: invalid byte: U+0075 'u'
Go error encoding/hex: invalid byte: U+0075 'u'
Go error encoding/hex: invalid byte: U+0075 'u'
Go error encoding/hex: invalid byte: U+0075 'u'
Go error encoding/hex: invalid byte: U+0075 'u'
[GIN] 2015/09/10 - 23:41:28 | 200 |    8.505736ms | 17.218.239.229 |   HEAD    /
Go error encoding/hex: invalid byte: U+0075 'u'
```

The program is not shut down but this message makes me nervous. It doesn't appear every fixed time (like every minute), but it does come and appear after a while. Does anyone knok how to fix this bug (how to find the troubling file) and is it related to Gin?

I use angular and have code like

``` html
<div> {{someval}} </div>
```

When using html rendering it is failing 'cos go try to process as template and it can't.
It working good when

``` go
r.StaticFile("/", "./public/index.html")
```

But if I try

``` go
r.StaticFile("/*", "./public/index.html")
```

to working with html5 routing in angular, server fails with 

```
URL parameters can not be used when serving a static file
```

How can I solve it?


I have implemented a middleware to check App IDs:

```
func CheckAppId(appC *core.Context) gin.HandlerFunc {
    return func(c *gin.Context) {
        //get Basic Auth credentials
        appId, token, _ := c.Request.BasicAuth()

        if appId == "" {
            c.JSON(http.StatusOK, gin.H{"code": "MISSING_APP_ID", "message": "Your request is missing an application id"})
            c.Abort() //finish here if this block is executed
        }

        //find app_id in database
        app := core.App{}
        err := appC.Db.C("apps").Find(bson.M{"id" : appId}).One(&app)
        if err != nil { //no app found
            c.JSON(http.StatusOK, gin.H{"code": "INVALID_APP_ID", "message": "The application id provided could not be found"})
            c.Abort()
        }

        c.Next()
    }
}
```

When I make a request with BasicAuth credentials everything is fine but when I make a request without any credentials both JSON responses are being returned even though I have `c.Abort()` included in the code. It should abort after the first conditional without moving on to the next. Is there something I'm doing wrong here?

These two fields are very helpful to generate documentation with
swagger.

hi
i try to test POST request : 

``` go
package main

import (
    "fmt"

    "github.com/gin-gonic/gin"
)

type FOO struct {
    URL string `json:"url" binding:"required"`
}

func main() {
    r := gin.Default()
    r.GET("/ping", func(c *gin.Context) {
        c.String(200, "pong")
    })
    r.POST("/foo", func(c *gin.Context) {
        var url FOO
        c.BindJSON(&url)
        fmt.Printf("URL to store: %v\n", url)
    })
    r.Run(":8080") // listen an
}

```

But i can't bind to JSON : 

``` bash
$ curl -i -X  POST http://localhost:8080/foo \
  -H "Accept: application/json" -H "Content-type: application/json" \
  -d '{ "url": "http://www.google.fr" }'
HTTP/1.1 400 Bad Request
Date: Mon, 07 Sep 2015 12:15:57 GMT
Content-Length: 0
Content-Type: text/plain; charset=utf-8
```

Any idea ? where i make an error ?
Thanks.

By this API the user can pass any net.Listener object to Engine.

It can be used by user's test code which run a Engine and bind to
a free port, then pass the real addres to the test function.

And I think if we added this API then the Engine.RunUnix is
unnecessary.

I have a systemd service that runs a docker container which runs my program using gin. I noticed that when I issue a `systemctl stop firewall` it stops successfully but it shows as failed due to the exit status not being 0. I've masked a few things below but it gives you the general idea of the output:

```
firewall.service - My firewall service
   Loaded: loaded (/etc/systemd/system/firewall.service; disabled; vendor preset: disabled)
   Active: failed (Result: exit-code) since Fri 2015-09-04 21:33:31 UTC; 3min 18s ago
  Process: 32695 ExecStop=/usr/bin/docker stop firewall (code=exited, status=0/SUCCESS)
 Main PID: 32386 (code=exited, status=2)

Sep 04 21:32:12 docker[32366]: c7923528965d: Download complete
Sep 04 21:32:12 docker[32366]: c7923528965d: Download complete
Sep 04 21:32:12 docker[32366]: Status: Image is up to date for <IP>:<PORT>/firewall:1.0
Sep 04 21:32:12 systemd[1]: Started My firewall service.
Sep 04 21:33:31 systemd[1]: Stopping My firewall service...
Sep 04 21:33:31 docker[32695]: firewall
Sep 04 21:33:31 systemd[1]: firewall.service: main process exited, code=exited, status=2/INVALIDARGUMENT
Sep 04 21:33:31 systemd[1]: Stopped My firewall service.
Sep 04 21:33:31 systemd[1]: Unit firewall.service entered failed state.
Sep 04 21:33:31 systemd[1]: firewall.service failed.
```

Could this be from docker trying to gracefully stop the process running inside the container but gin is throwing this exit code upon being stopped?

``` Go
type IRouter interface {
    IRoutes
    Group(string, ...HandlerFunc) IRouter 
}
```

Hi,

how can I pass a var (db connection pointer) to a route handler like this:

apiV1.GET("/users/:userid", userHandler)

so that I can use in userHandler ?

Now I use a global var but I want to move the handler functions to another package

I couldn't find big open source projects which uses gin. Is there a list or could we create a list?

 github.com/gin-gonic/gin
../../src/github.com/gin-gonic/gin/gin.go:56: cannot use engine.handle404 (type func(http.ResponseWriter, *http.Request)) as type http.Handler in assignment:
 func(http.ResponseWriter, *http.Request) does not implement http.Handler (missing ServeHTTP method)
../../src/github.com/gin-gonic/gin/gin.go:57: cannot use engine.handle405 (type func(http.ResponseWriter, *http.Request)) as type http.Handler in assignment:
 func(http.ResponseWriter, *http.Request) does not implement http.Handler (missing ServeHTTP method)

Refs https://github.com/gin-gonic/gin/issues/1182


folling -> following
i install gin by line `go get github.com/gin-gonic/gin`

it was alway running, can not stop

i open folder  `/root/go`,

```
[root@ip-172-31-30-214 src]# du -lh --max-depth=1 ./*
752K	./github.com/gin-contrib
3.0M	./github.com/gin-gonic
4.9M	./github.com/golang
5.5M	./github.com/ugorji
14M	./github.com
108K	./gopkg.in/go-playground
112K	./gopkg.in
[root@ip-172-31-30-214 src]# 

```

it has download some file , but half an hour , it alway runing.
I'm building a new project in Golang world and I wanna try this amazing framework. What do you think about GraphQL?

Is it worth having a framework like Gin for this purpose?

If I search "graphql" in these issues nothing appears.
My code like this:


       
       router := gin.New()
 	
       friend := router.Group("/friend")
        {
	      friend.GET("/", controller.GetFirends)
       }

I received a redirect response with statusCode 301 , while I request the path   /friend with GET method.

part of #1075

```
type QueryInfo struct {
	IDInfo
	//other code
}
type CommitInfo struct {
	IDInfo `binding:"required"`
	//other code
}
type IDInfo struct {
	UserID int `form: "user_id"`
}
```
when i want to query. the `UserID` is not required.
But,it is required in commit .


i write code like this,but it's not work. what should i do?
[This commit](https://github.com/gin-gonic/gin/commit/26c3f42095b8a1378617eb4756fbf8282cb1ae89#diff-a92bf789c90ffd65fa08f76b7fa75160) caused breaking changes for anyone who had updated to using [validator v9](gopkg.in/go-playground/validator.v9) from v8.

Moreover it prevents anyone from changing the the [binding.Validator](https://github.com/gin-gonic/gin/blob/master/binding/binding.go#L45) to use any other validation library besides `go-playground/validator.v8`, although I love that gin has adopted my library as their default, there are others and why the [binding.StructValidator](https://github.com/gin-gonic/gin/blob/master/binding/binding.go#L31) interface exists in the first place.

Lastly the addition was unnecessary, even if it made it more convenient, anyone could have just created a new instance of validator registered what they wanted and created a struct comply with [binding.StructValidator](https://github.com/gin-gonic/gin/blob/master/binding/binding.go#L31), much like in my instructions on [updating to use v9 of validator](https://github.com/go-playground/validator/tree/v9/_examples/gin-upgrading-overriding); which is also broken due to this change.

As an alternative, I believe that an example of how to override the default validator would be more beneficial and could easily be copy-paste.

I sincerely hope this can be corrected, although I am not a member of the gin team, I feel very close to this project and IMHO, this put in many blockers for gin's codebase and adoption going forward.
```
    var currenttime = time.Now()
    startlabel := currenttime
    if c.BindJSON(&kccomparereq) == nil {
        cost := time.Now().Sub(currenttime)
        fmt.Println("====[", startlabel, "]====After Bind Json, time cost: ", cost)
    }
```
Hi, I use gin for my web server, and recently I found some requests take more time then it should be.
So I track all part of time cost of the request, then I find some request, BindJson function is slow, which
is about *5s*, and most of time it is several ms.

I try to switch from standard json to jsoniter, but the resul is the same, there are stil some 2s.

The request is a image base64 data, which is always ~80k, I log the size, and there is not different from other requests.

I try to google but can't find any thing help, and thanks for your job, gin is really awesome.
part of #1075
Gin takes `:` and `name` as tag of parameter in path, such as `http://localhost:4123/user/:name`. If gin get the request `http://localhost:4123/user/:name`, gin will accept it, it will be better if gin respond with 400 because the format `:name` should be only used by gin clearly.
Hi,

I need to handle all requests in one route.
For example, I have website with many urls, smth like /, /users, /users/list ... etc
I want to use only one route to handle all this, something like 
r.Any("*", handle) and all my requests need to handle by this route.
How can I make it?

Thanks for help

Is it possible to sub-group routes?
i.e.
```golang
func main (){
      r = gin.Default()
      v1 := r.Group("/api/v1"){
            auth := v1.Group("/auth/"){
                auth.GET("/users", userListHandler)
                auth.POST("/login", loginHandler)
            }
      }
}
```
This would allow mixing and matching api versions and functions.
I came across this while going through the [documentation of Bind](https://godoc.org/github.com/gin-gonic/gin#Context.Bind).
thanks
part of #1075
```
package main

import "github.com/gin-gonic/gin"

func main() {
	r := gin.Default()
	r.GET("/ping", func(c *gin.Context) {
		c.JSON(200, gin.H{
			"message": "pong",
		})
	})
	r.Run() // listen and serve on 0.0.0.0:8080
}
```

```
$ curl -i http://127.0.0.1:8080/ping
```
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
Date: Mon, 18 Dec 2017 10:16:51 GMT
Content-Length: 18

{"message":"pong"}


```
$ curl -I http://127.0.0.1:8080/ping
```
HTTP/1.1 404 Not Found
Content-Type: text/plain
Date: Mon, 18 Dec 2017 10:17:13 GMT
Content-Length: 18


same url

I'm trying to implement Server Push.
I've taken the code from this blog post: https://blog.golang.org/h2push
```
pusher, ok := ctx.Writer.(http.Pusher)
if ok {
	log.Println("Push ok")
	pusher.Push("/img/logo.png", nil)
} else {
	log.Println("push not ok")
}		
```
Where ctx - *gin.Context
It returns "push not ok". Original example works in my browser.
Any ideas? Or any way to get original http.ResponseWriter from gin.Context?
Of course, there is https and browser shows h2 protocol.

I found few issues as I was adopting gin into our environment. Im pretty sure some of them has been address already. I solve these issues on my own, have solution for all of them but its not compatible with API gin provides right now. Everything is against master branch.

1) Bind json Method
Not sure about custom parser gin is using as dependency... But decoder is not best solution.
https://ahmet.im/blog/golang-json-decoder-pitfalls/

2) Validator
Validator should not be part of gin. I suggest rather define interface for validations and use interface to validate.
github.com/go-playground/validator
brings 
github.com/go-playground/universal-translator
that brings this
github.com/go-playground/locales
and probably others
you get the idea why this is not cool

3)  Write Headers Now
Lets say you have stack of middlewares and on top there is one handling errors.
if you `AbortWithStatus` somewhere is stack, this will write headers and error middleware has no chance to change headers after that.

maybe better here https://github.com/gin-gonic/gin/blob/master/gin.go#L320 ?

4) HTTP router
I found the issue already somewhere I think `/resource/:id` `/resource/batch` are not working together. Honestly I did not fix this one for myself, no need, but still issue.

Let me know what do you think...
Regards.

Hey guys, I get a problem here

I want to use the gin for `/debug/pprof` and `/debug/vars` routing. I use `gin.WrapH(http.DefaultServeMux)` as the handler for prefix routing rule.

But in my code, I can not reach `/debug/pprof/heap`. And there is less guide in document for me.

I wonder if here are some misunderstand in my code

```golang
        router.GET("/status", Status)
        rg := router.Group("/debug", gin.WrapH(http.DefaultServeMux))  // here!
        rg.GET("/pprof", gin.WrapH(http.DefaultServeMux))
        rg.GET("/vars", gin.WrapH(http.DefaultServeMux))
```
Prevents possible collision when using string keys, and uses package's data types.

Example usage:

```
package mypackage_with_keys

type _someKeyType int

const (
	CustomKey someKeyType = iota
	AnotherKey
)

func GetCustomData(c *Context) (...) {
	o, has := c.Get(CustomKey)
        .....
	return
}
```
Hello All,

I'm seeking the best way to unit testing my handler: 

In main file:
` func init() {
	db.Connect()
   }

   func main() {
        // Init API
	api := gin.Default()

	// Using Middle-wares get the db session in the context for each request
	api.Use(middlewares.Connect)

        routerProjects := api.Group("/projects")
	{
		// All Projects
		routerProjects.GET("", projects.ListAllProjects)
        }
`

Here is my handler function 
`
func ListAllProjects(c *gin.Context) {

	session := c.MustGet("session").(*mgo.Session)
	db := session.DB("myDB")

	var projects []models.ProjectList
	err := db.C("projects").Find(bson.M{}).All(&projects)

	if err != nil {
		helpers.RespondWithError(400, err.Error(), c)
	}

	c.JSON(200, projects)

}
`

Please advise. Thank you
I can not found these function in gin v1.2 。
Problem:
I can't parse a time string even when setting the time_format value. Here is my struct,

```go
type Class struct {
  StartAt        time.Time      `json:"start_at" time_format:"2006-01-02" time_utc:"1" binding:"required"`
  ChallengeID    uint           `json:"challenge_id" gorm:"index" binding:"required"`
}
```

and the request I am making of which I immediately call `c.ShouldBindJSON(&class)`,

```
POST /my_endpoint HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Cache-Control: no-cache
Postman-Token: 9fe5bfbf-8087-6c48-b30e-c58ec87fceb0

{
	"challenge_id": 1,
	"start_at": "2017-01-08"
}
```
Regardless of sending the correct format, I always get this error back,

`"parsing time \"\"2017-01-08\"\" as \"\"2006-01-02T15:04:05Z07:00\"\": cannot parse \"\"\" as \"T\""`

Any help is appreciated. Thanks!
In the same handler ,c.AbortWithStatus() cannot termination procedure. so ,if without c.Writer.WriteHeaderNow(), the http status can be replaced or not.
  because i only want to return the http status 200ok,other error codes can be placed in the reply JSON.
from example https://github.com/gin-gonic/gin#custom-validators
when the date is wrong 20179-11-14 (wrong year) the binding return time.ParseError! (but must validator.ValidatorErrors) How to check on which struct field Error occurs (if there more than 1 time.Time field)? (and bindind ```field int``` must have validator.ValidatorErrors (if number out of range))
`
package main

import (
	"github.com/gin-gonic/gin"
	"net/http"
)

type User struct {
	UserName *string `form:"user_name" binding:"required"`
}

func main()  {
	r := gin.Default()
	r.GET("/user", getUser)
	r.Run(":8085")
}

func getUser(c *gin.Context) {
	var user User
	if err := c.BindQuery(&user); err == nil {
		c.JSON(http.StatusOK, gin.H{"message": "valid!"})
	} else {
		c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
	}
}
`
Hello !
When I try to test the project github.com/gin-gonic/gin in version 1.2 it fails with

./context.go:663: cannot use sse.Event literal (type sse.Event) as type render.Render in argument to c.Render:
        sse.Event does not implement render.Render (missing WriteContentType method)
./context_test.go:737: cannot use sse.Event literal (type sse.Event) as type render.Render in argument to c.Render:
        sse.Event does not implement render.Render (missing WriteContentType method)
./middleware_test.go:239: cannot use sse.Event literal (type sse.Event) as type render.Render in argument to c.Render:
        sse.Event does not implement render.Render (missing WriteContentType method)
FAIL    github.com/gin-gonic/gin [build failed] 


Thank you very much
change path from '~/go/...' to '$GOPATH/...'
I see that we can use `c.bindJSON()` to attach incoming request bodies to predefined structs. This method also validates the body in the process, which is great.
I am wondering if I can have a standalone middleware that validates incoming request bodies using `c.bindJSON()` AND send the bound&verified body to the handler. This way I can write one single validate middleware for different requests with different structs.
One can set a per-route middleware when registering the handler in say r.GET(url, mw1, mw2, hdlr). Is there a way to modify this per-url middleware - like add or remove...

Thx


comments from https://github.com/gin-gonic/gin/commit/1e1e4fc867b1729f600cf0e3ce096b815503e969#commitcomment-25844435

cc @toravir
This seems like a bit of an issue and gave me a headache for a bit. So if you are using StaticFS to serve a folder you are then unable to catch the 404 errors using NoRoute. This was mentioned in #440 and is a result of http/fs doing it's own error handling. This is a bit problematic when trying to host static files of any kind and also being able to make use of NoRoute to have custom 404 error handling.

```go
r.StaticFS("/", http.Dir("./public/"))

r.NoRoute(func(c *gin.Context) {
        // This cannot be reached as a result of the StaticFS call
	c.File("./public/custom404.html")
})
```
Let's say we want to check if a user is logged in, It would be silly if we had to call isLoggedIn() on every single route. Is there a way we can have gin call isLoggedIn() before any defined routes are called?


Hi, I'm setting gin mode
```
	gin.SetMode("test")
	r := gin.Default()
```

And when I'm running my tests in `t.Parallel()` with flag `-race` -> I'm getting `data race warning`:
```
==================
WARNING: DATA RACE
Write at 0x000005c34cb8 by goroutine 38:
  gitea.io/atlantide/curiosity/vendor/github.com/gin-gonic/gin.SetMode()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/vendor/github.com/gin-gonic/gin/mode.go:56 +0x1fe
  gitea.io/atlantide/curiosity/config/routes.GinRouter()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/config/routes/routes.go:33 +0x2ba
  gitea.io/atlantide/curiosity/test/controllers.(*SessionsControllerSuite).TestCreate()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/test/controllers/sessions_controller_test.go:124 +0xec6
  runtime.call32()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/runtime/asm_amd64.s:514 +0x47
  reflect.Value.Call()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/reflect/value.go:302 +0xc0
  gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite.Run.func2()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite/suite.go:102 +0x31f
  testing.tRunner()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/testing/testing.go:657 +0x107

Previous write at 0x000005c34cb8 by goroutine 44:
  gitea.io/atlantide/curiosity/vendor/github.com/gin-gonic/gin.SetMode()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/vendor/github.com/gin-gonic/gin/mode.go:56 +0x1fe
  gitea.io/atlantide/curiosity/config/routes.GinRouter()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/config/routes/routes.go:33 +0x2ba
  gitea.io/atlantide/curiosity/test/controllers.(*UsersControllerSuite).TestCreate()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/test/controllers/users_controller_test.go:164 +0xc9d
  runtime.call32()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/runtime/asm_amd64.s:514 +0x47
  reflect.Value.Call()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/reflect/value.go:302 +0xc0
  gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite.Run.func2()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite/suite.go:102 +0x31f
  testing.tRunner()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/testing/testing.go:657 +0x107

Goroutine 38 (running) created at:
  testing.(*T).Run()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/testing/testing.go:697 +0x543
  gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite.runTests()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite/suite.go:121 +0xd6
  gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite.Run()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite/suite.go:108 +0x709
  gitea.io/atlantide/curiosity/test/controllers.TestSessionsControllerSuite()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/test/controllers/sessions_controller_test.go:236 +0x6c
  testing.tRunner()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/testing/testing.go:657 +0x107

Goroutine 44 (running) created at:
  testing.(*T).Run()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/testing/testing.go:697 +0x543
  gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite.runTests()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite/suite.go:121 +0xd6
  gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite.Run()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite/suite.go:108 +0x709
  gitea.io/atlantide/curiosity/test/controllers.TestUsersControllerSuite()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/test/controllers/users_controller_test.go:489 +0x6c
  testing.tRunner()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/testing/testing.go:657 +0x107
==================
==================
WARNING: DATA RACE
Write at 0x00000526da40 by goroutine 38:
  gitea.io/atlantide/curiosity/vendor/github.com/gin-gonic/gin.SetMode()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/vendor/github.com/gin-gonic/gin/mode.go:60 +0x103
  gitea.io/atlantide/curiosity/config/routes.GinRouter()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/config/routes/routes.go:33 +0x2ba
  gitea.io/atlantide/curiosity/test/controllers.(*SessionsControllerSuite).TestCreate()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/test/controllers/sessions_controller_test.go:124 +0xec6
  runtime.call32()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/runtime/asm_amd64.s:514 +0x47
  reflect.Value.Call()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/reflect/value.go:302 +0xc0
  gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite.Run.func2()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite/suite.go:102 +0x31f
  testing.tRunner()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/testing/testing.go:657 +0x107

Previous write at 0x00000526da40 by goroutine 44:
  gitea.io/atlantide/curiosity/vendor/github.com/gin-gonic/gin.SetMode()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/vendor/github.com/gin-gonic/gin/mode.go:60 +0x103
  gitea.io/atlantide/curiosity/config/routes.GinRouter()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/config/routes/routes.go:33 +0x2ba
  gitea.io/atlantide/curiosity/test/controllers.(*UsersControllerSuite).TestCreate()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/test/controllers/users_controller_test.go:164 +0xc9d
  runtime.call32()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/runtime/asm_amd64.s:514 +0x47
  reflect.Value.Call()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/reflect/value.go:302 +0xc0
  gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite.Run.func2()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite/suite.go:102 +0x31f
  testing.tRunner()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/testing/testing.go:657 +0x107

Goroutine 38 (running) created at:
  testing.(*T).Run()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/testing/testing.go:697 +0x543
  gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite.runTests()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite/suite.go:121 +0xd6
  gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite.Run()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite/suite.go:108 +0x709
  gitea.io/atlantide/curiosity/test/controllers.TestSessionsControllerSuite()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/test/controllers/sessions_controller_test.go:236 +0x6c
  testing.tRunner()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/testing/testing.go:657 +0x107

Goroutine 44 (running) created at:
  testing.(*T).Run()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/testing/testing.go:697 +0x543
  gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite.runTests()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite/suite.go:121 +0xd6
  gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite.Run()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/vendor/github.com/stretchr/testify/suite/suite.go:108 +0x709
  gitea.io/atlantide/curiosity/test/controllers.TestUsersControllerSuite()
      /Users/apple/Developer/goproject/src/gitea.io/atlantide/curiosity/test/controllers/users_controller_test.go:489 +0x6c
  testing.tRunner()
      /Users/apple/.gimme/versions/go1.8.1.darwin.amd64/src/testing/testing.go:657 +0x107
==================
```
Maybe reason in yr code `ginMode = testCode` ?: 
```
func SetMode(value string) {
	switch value {
	case DebugMode:
		ginMode = debugCode                         <<<<<<<<<<< ?????
	case ReleaseMode:
		ginMode = releaseCode                         <<<<<<<<<<< ?????
	case TestMode:
		ginMode = testCode                                <<<<<<<<<<< ?????
	default:
		panic("gin mode unknown: " + value)
	}
	modeName = value                                      <<<<<<<<<<< ?????
}
```
Your are changing global var from function, it looks like this is not safe.
The warning in this context is not dangerous, but it will be better to fix this ASAP

Is it possible to use Http2/push with gin?

``` go
func pushHandler(c *gin.Context) {

	if pusher, ok := c.Writer.(http.Pusher); ok {
		if err := pusher.Push("/app.css", nil); err != nil {
                    // log error
		}
	}
	c.Status(http.StatusOK)
}
```

I would like to be able to use http2/push with router.StaticFile(). Is it possible to configure this to push the linked assets, or would I have to manually handle the endpoint?
``` go
router.StaticFile("/index.html", "../public/index.html")
```
``` go
router := gin.Default()
router.GET("/index", indexHandler)
router.Run()
```
``` go
func indexHandler(c *gin.Context) {
	if pusher, ok := c.Writer.(http.Pusher); ok {
		if err := pusher.Push("/style.css", nil); err != nil {

		}
               if err != nil { // if the first asset fails, there is no sense in pushing the others
                   pusher.Push("/favicon.png", nil)
                   pusher.Push("/app.js", nil)
               }

	}
        // send index bytes
	c.Status(http.StatusOK)
}
```

use simple demo app, compile to exe file on ubuntu named as demo
```java
package main

import "github.com/gin-gonic/gin"

func main() {
	r := gin.Default()
	r.GET("/ping", func(c *gin.Context) {
		c.JSON(200, gin.H{
			"message": "pong",
		})
	})
	r.Run() // listen and serve on 0.0.0.0:8080
}
```
```Dockerfile
FROM alpine:latest
RUN apk --no-cache add ca-certificates
ADD demo /bin
CMD [ "demo" ]
```
build docker image and run
```bash
docker build -t test .
docker run test
```
result: 
standard_init_linux.go:178: exec user process caused "no such file or directory"

if I run the service in ubuntu docker image, there is no such issue.
```Dockerfile
FROM ubuntu:xenial
ADD demo /bin
CMD [ "demo" ]
```
Can we make it clear what is missing?
Hi, @appleboy I recommit the pull request for changing the param position of `assert.Equal`, thanks!

There have been number of pull requests merged into master after v1.2 (released on 2nd July), but none of them have been marked as a release. 

Due to this, GoDep is not fetching the latest code base and users are not able to use the latest functionalities.


Is there a way to use the validator bindings to verify a path parameter's format?

eg, if the id for a delete should be a uuid:

DELETE /foo/\<id\>

is there a way to make

id := c.Param("id")

trigger the equivalent to this validate call?

validate.Var(id, "uuid")

Thanks.
Gin's request validation feature is not working when the request body (JSON) represents an array of objects

Ex:

```
type item struct {
    Field1 string `binding:"required"`
    Field2 string `binding:"required"`
}

var items []item

err := c.BindJSON(&items)

```
To be more clear, the validation logic in gin is expecting the root object to be a struct and hence bails out when an array type gets passed. 

The browser will cache 301

![image](https://user-images.githubusercontent.com/17244565/32720036-f8c551da-c827-11e7-96e3-989dd773269a.png)

Hello all, i would like to ask is it possible to set middleware after handler executing.
Because in code example i provide middleware "after" does not working. Please tell me if i do something
wrong

```
package main

import (
	"github.com/gin-gonic/gin"
	"fmt"
)

func middleware(t string) func(c *gin.Context) {
	return func(c *gin.Context) {
		fmt.Println(t)
	}
}

func handler(c *gin.Context) {
	fmt.Println("handler")
}

func main() {
	router := gin.Default()

	v1 := router.Group("/v1")
	v1.Use(middleware("before handler"))
	v1.GET("/", handler)
        # this middleware does not execute after handler
	v1.Use(middleware("after"))

	router.Run(":3001")
}
```
Now travis not run some test cases on `binding` and `render` dir.
Hi, @javierprovecho @appleboy @tboerger should we add these test case?
Thanks!
The pull request includes the follow points:

- update `Makefile` for running `coverage.sh`
- add `coverage.sh` to run code coverage rate
- add `render` and `binding` to `coverage.sh`
- update `binding_test.go` which code coverage rate is `99.23%`
- update `render_test.go` which code coverage rate is `100%`
- update `.gitignore`
Signed-off-by: Bo-Yi Wu <appleboy.tw@gmail.com>


Though HTTP RFC 2396 defines path separator to be single slash, 
but many multiplexers allow use of // i.e.
```
GET /a/b
GET /a//b
```
produce the same result.

Can this be done in gin-gonic one day ?
Hi, 
**Is there any way to bind both GET and POST data same time?**

The issue is, we have to support some parameters for both GET and POST because sometimes we get them as GET parameters while sometimes we get them as POST

ex
`id` can get via either GET or POST. BTW real case is more complex than this example
### GET Param
/api/some_request?id=001

### Post Data
```json
{
  "fname": "Fname",
  "lname": "Lname"
}
```

### Go code
```go
type User struct { 
	ID string `json:"id"` 
	Fname string `json:"fname"` 
	Lname string `json:"lname"` 
}

func (h *UserHandler) Post(c *gin.Context) {
    var user User
    err := c.ShouldBindWith(&user, binding.Form)


}
```

I tried binding.Form and binding.JSON but non is working 
Is it possible to plug in another router, such as gorilla mux, with Gin?

I am trying to add certain REST endpoints, but this router does not allow them. I'm at the point now where I've (unfortunately) coupled the router and it's grouping mechanisms tightly to my app, so migrating to a new router will be a tedious process.

I really like the way gin with it's versioning and middleware and so on; it is perfect for my use cases. It just has one problem which is the lack of ability to use standard REST endpoints. Having to do really ugly things with query params to solve this problem.

The problem is, I sometimes need endpoints like `/items/username/:username`, `/items/:id/foo`, `/items/:slug/bar` and so on all at the same time, but this router does not allow mixing those endpoints together because of the ambiguity. It can't differentiate the three obviously different paths.

How could I swap out the `authorized.GET` with a mux `router.Get`? Anyone have a solution to this?:

```go
        authorized := c.Router.Group("/v1").Use(middleware.Authorized())
	{
                authorized.GET(
			"/items",
			middleware.RateLimit(100, time.Minute * 5),
			ctrl.AllPaginated,
		)
		authorized.POST(
			"/items",
			middleware.RateLimit(100, time.Minute * 5),
			ctrl.Create,
		)
		authorized.PUT(
			"/items/:slug",
			middleware.RateLimit(100, time.Minute * 5),
			ctrl.UpdateBySlug,
		)
		authorized.DELETE(
			"/items/:slug",
			middleware.RateLimit(100, time.Minute * 5),
			ctrl.SoftDeleteBySlug,
		)
	}
```
I think is usefull define an instance identification (uuid ?) and print it in logger middleware.
With this option is easy write a debug file for every transaction identified by istance_id inside the name.
And from the log you can go back to the debug file.


I use go1.9.2  gin1.2, and i follows the README.md.

when i run "go run main.go"  after "curl https://raw.githubusercontent.com/gin-gonic/gin/master/examples/basic/main.go > main.go",  it shows:

github.com/gin-gonic/gin/context.go:471:29: undefined: binding.Query
github.com/gin-gonic/gin/context.go:505:31: undefined: binding.Query
github.com/gin-gonic/gin/context.go:673:17: undefined: render.SecureJSON
github.com/gin-gonic/gin/mode.go:68:2: undefined: binding.EnableDecoderUseNumbe


So  why?
Hi guys,

we discovered a problem here with the RedirectTrailingSlash feature.

func redirectTrailingSlash does redirect to absolute URLs which is a problem when the server is hidden behind a foward proxy. The redirect MUST NOT use an absolute URL, but a relative one.

In my example below the proper redirect would be "zip/" instead of "/zip/". This is the same way the Go fileserver does it. 

Do you prefer a pull request or are you going to fix this?

Martin

`martin@easydb-vm:~$ curl -XPOST -v http://10.150.0.4:4000/test/zip
* Hostname was NOT found in DNS cache
*   Trying 10.150.0.4...
* Connected to 10.150.0.4 (10.150.0.4) port 4000 (#0)
> POST /test/zip HTTP/1.1
> User-Agent: curl/7.38.0
> Host: 10.150.0.4:4000
> Accept: */*
>
< HTTP/1.1 307 Temporary Redirect
< Location: /zip/
< Date: Tue, 07 Nov 2017 15:06:10 GMT
< Content-Length: 0
< Content-Type: text/plain; charset=utf-8
<
* Connection #0 to host 10.150.0.4 left intact
`


hi, 
when i do ping on server with go run main.go, i.e. without docker it's return me right headers, but when i run docker it's not return me cors headers.
i use middleware:
func CorsMiddleware() gin.HandlerFunc {
	return func(c *gin.Context) {
		c.Writer.Header().Set("Access-Control-Allow-Origin", os.Getenv("CLIENT_URL"))
		c.Writer.Header().Set("Access-Control-Max-Age", "86400")
		c.Writer.Header().Set("Access-Control-Allow-Methods", "POST, GET, OPTIONS, PUT, DELETE, UPDATE")
		c.Writer.Header().Set("Access-Control-Allow-Headers",
			"Origin, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization, token, info, timestamp, user")
		c.Writer.Header().Set("Access-Control-Expose-Headers", "Content-Length")
		c.Writer.Header().Set("Access-Control-Allow-Credentials", "true")

		if c.Request.Method == "OPTIONS" {
			fmt.Println("OPTIONS")
			c.AbortWithStatus(200)
		} else {
			c.Next()
		}
	}
}
and i append to docker this config value:
"api-cors-header" : "*",
<img width="1440" alt="screen shot 2017-11-06 at 16 11 20" src="https://user-images.githubusercontent.com/2378114/32443836-7de40c74-c311-11e7-8f33-74db32a128fd.png">
what's wrong with headers and how correct do it with docker, thanks
I have some group of routes. I want to handle different  `NoRoute` for each of groups.
Is there a way to do that? 

example:

```golang
show := router.Group("/show")
{
	show.GET("/show/:filename", ShowFile)
	show.NoRoute(ShowNoRoute)
}
```
What do you think guys? For newcomers it takes time to figure out how to test gin routes. I personally found questions on stackoverflow and couple blog posts. 
This may save a bit of time.

waiting for your ideas/proposal.

Changes:

1. Modified basic example and added test file
2. Added testing doc to readme file


Maybe we can use the `MarshalXML` of `gin.H` for reducing duplicate codes.
BUT should it have loop ref？

the following struct will raise err if "Field" does not exist
```
type Foo struct {
    Field time.Time `json:"field" binding:"required"`
}
```

but the following will not
```
type JSONDate time.Time
type Foo struct {
    Field JSONDate `json:"field" binding:"required"`
}
```
Context.Errors is of type errorMsgs ... this breaks a cardinal rule in Go, that any field that is exported should be of a type that is exported.   The main problem is that you can't get godoc on what Context.Errors *is*. You have to go looking through the code.

It shouldn't break anyone's code to change errorMsgs to an exported type, since no other code can declare it right now.  It would *probably* be safe to turn Context.Errors into an interface with the same methods as errorMsgs, but that could potentially break someone that is converting the value into an []*Error.

diff:
![image](https://user-images.githubusercontent.com/4488261/32150554-90487ee4-bd4f-11e7-9d34-a45e1cc421aa.png)

When I start my router, I get this error:

```bash
...
[GIN-debug] GET    /v1/taxes/:taxId          --> microservices/wwwapi/controller.(*TaxController).FindByID-fm (7 handlers)
[GIN-debug] PUT    /v1/taxes/:taxId          --> microservices/wwwapi/controller.(*TaxController).UpdateByID-fm (7 handlers)
[GIN-debug] DELETE /v1/taxes/:taxId          --> microservices/wwwapi/controller.(*TaxController).SoftDeleteByID-fm (7 handlers)
[GIN-debug] GET    /v1/users/username/:userId --> microservices/wwwapi/controller.(*UserController).FindByUsername-fm (7 handlers)
[GIN-debug] GET    /v1/users/:userId         --> microservices/wwwapi/controller.(*UserController).FindByID-fm (7 handlers)
panic: wildcard route ':userId' conflicts with existing children in path '/v1/users/:userId'
...
```

But the error makes no sense because if you look at the `taxes` endpoint, it has a `GET`, `PUT`, and `DELETE` all on the same `/v1/taxes/:taxId` endpoint, but when I try it for the users endpoint it gives me that error.

Why is this happening? Makes no sense... you'd think it would give me the same error for both endpoints.
`validator` allows for struct level validation - https://github.com/go-playground/validator/releases/tag/v8.7. This adds a method, `RegisterStructValidation`, to the `StructValidator` interface and implements the same in `defaultValidator`. A test for the same has also present. I added an example but did not included the entire example in README.md. Not everybody would need this feature and the readme is already a bit large.


The constant is `ReleaseMode`, as defined in [mode.go](https://github.com/gin-gonic/gin/blob/1e88466d234a82ce4aeca904bce8a0b93fac3d42/mode.go#L16).
Hello
I am working on a project where I need to setup the multiple sub-domains with the routes. I tried code with two sub-domains, but in my case it would be 100 sub-domains. I tried the following code for this:
<pre>
package main

import (
    "github.com/gin-gonic/gin"
    "net/http"
    "strings"
)

type Subdomains map[string]http.Handler

func (subdomains Subdomains) ServeHTTP(w http.ResponseWriter, r *http.Request) {
    domainParts := strings.Split(r.Host, ".")

    if mux := subdomains[domainParts[0]]; mux != nil {
        mux.ServeHTTP(w, r)
    } else {
        http.Error(w, "Not found", 404)
    }
}

func main() {
    r := gin.Default()
    r2 := gin.Default()
    hs := make(Subdomains)
    hs["admin"] = r
    hs["analytics"] = r2
    r.GET("/ping", adminHandlerOne)
    r2.GET("/ping", adminHandlerOne)
    http.ListenAndServe(":9090", hs)
}
func adminHandlerOne(c *gin.Context) {
    c.JSON(200, gin.H{
        "message": "pong",
    })
}
</pre>

But I think that this is not good. Is anybody know the proper way to do this?
I tried to do this with loop also, but it did't work for me.

Golang "error" is recommended.
example:
```go
// MustGet returns the value for the given key if it exists, otherwise it panics.
func (c *Context) MustGet(key string) interface{} {
	if value, exists := c.Get(key); exists {
		return value
	}
	panic("Key \"" + key + "\" does not exist")
}
```
I have some specific problem with go get github.com/gin-gonic/gin
Please tell me how to fix it?

package gopkg.in/go-playground/validator.v8: unrecognized import path "gopkg.in/
go-playground/validator.v8" (https fetch: Get https://gopkg.in/go-playground/val
idator.v8?go-get=1: dial tcp 45.33.37.13:443: connectex: No connection could be
made because the target machine actively refused it.)
package gopkg.in/yaml.v2: unrecognized import path "gopkg.in/yaml.v2" (https fet
ch: Get https://gopkg.in/yaml.v2?go-get=1: dial tcp 45.33.37.13:443: connectex:
No connection could be made because the target machine actively refused it.)

C:\gopath\src\ucs_api_21_08_2017\api_v4>go get -u gopkg.in/gin-gonic/gin.v1
package gopkg.in/gin-gonic/gin.v1: unrecognized import path "gopkg.in/gin-gonic/
gin.v1" (https fetch: Get https://gopkg.in/gin-gonic/gin.v1?go-get=1: dial tcp 4
5.33.37.13:443: connectex: No connection could be made because the target machin
e actively refused it.)
ref #1052 

---

TODOs:
- [x] test case using this new api

TODO(add cases) have completed, but it need #1168 merged firstly.
This blog discusses why GetBody is used [blog](http://noypi-linux.blogspot.com/2017/04/golang-fast-http-mux-with.html)
[code here](https://github.com/noypi/router/blob/master/context.go)

```
router.Use(func(w http.ResponseWriter, r *http.Request) {
	context := ContextR(r)
	signature += "A"
	context.AbortWithError(500, errors.New("foo"))
})
```

**_Updates_**

Here is the changes done:

https://github.com/noypi/router/commit/82586b8967933e131ecfa7d1a2eeaadb2ade0e78#diff-05a3aa0ab9e5687ff167e0ef3ae4c5a6
My purpose is  limiting the size of uploaded file and rejecting as soon as client hits the limit.  So Firstly I added http.MaxBytesReader at ServeHttp function in gin.go file. Secondly, creating a middleware to call ParseForm for triggering the tooLargeError when uploaded file is too big. But nothing happened.  
After reading the source code of net/http package,  find out that
1. ParseFrom won't handle the "form-data" type request, must using ParseMultipartForm instead.
2. Once replace ParseFrom by ParseMultipartForm in middleware, it affects the other type's normal request as returning a "Content-Type isn't multipart/form-data" error.
3.  Function c.PostForm("fieldname") doesn't return a Error for us when clients hits limit .

Here is my solution：
1. Still using middleware,  but using GetRawData() API to trigger the tooLargeError from MaxByteReader.
2. Write the raw data buffer back to c.Request.Body so that it won't affect the continue processing. 

The related codes in middleware look like this: 
```
func MaxSizeAllowed(n int64) gin.HandlerFunc {
	return func(c *gin.Context) {
		fmt.Println("-----------------in middle ----ware size is ",n )
		c.Request.Body = http.MaxBytesReader(c.Writer, c.Request.Body, n)

		buff, errRead := c.GetRawData()

		if errRead != nil {
			fmt.Println("-----------------in middle --- hit ", errRead)
			c.String(http.StatusRequestEntityTooLarge,"too large" )
			conn, bufrw, err := c.Writer.Hijack()

			if err != nil {
				c.Abort()
				return
			}

			bufrw.Flush()
			conn.Close()
			c.Abort()
			return
		}

		buf := bytes.NewBuffer(buff)  
		c.Request.Body = ioutil.NopCloser(buf) 

		fmt.Println("-----------------in middle ---no hit " )
	}
}

```

at gin server, we can call USE function easily like this:
```
	router := gin.Default()
	router.Use(streamlimit.MaxSizeAllowed(100<<10))
``` 

It works! But there are two problems remain.
1.  I just treat the errRead as the file over size error type since I can't find the exactly error type in net/http source code. If you know the exactly error type, please tell me, Thx.
2. Using the io.ioutil.ReadAll() in GetRawData will cause c.Request.Body becomes empty. So I have to write back them at last. This should cause performance loss. 

Please let me know if you have better or easier solution. Thanks.
   
I send this object
```
[{symbol:btc active:true} {symbol:eth active:true} {symbol:xmr active:true} {symbol:bch active:true} {symbol:xrp active:true} {symbol:ltc active:true} {symbol:xem active:true} {symbol:dash active:true} {symbol:miota active:true}]
```
with this type
```go
type Coin struct {
	symbol string `form:"symbol" json:"symbol" binding:"required"`
	active bool   `form:"active" json:"active" binding:"required"`
}
```
response is this
```
{"data":[{},{},{},{},{},{},{},{},{}],"message":"OK"}
```
like this
```go
var coins []Coin
coins = [...]
fmt.Printf("%+v", coins)

c.JSON(http.StatusOK, gin.H{"message": "OK", "data": coins})
```

how do I make this work?
Fixes #1133 
The RunUnix socket is not usable in the current state.  The socket should be set to 0777 permission after being created.
``` go
orderRouter := offline.Group("order")
{
	orderRouter.GET("", order.QueryOrders)
	orderRouter.POST("", order.Add)
	orderRouter.GET("/:id", order.GetById)
	orderRouter.PATCH("/:id", order.Patch)
	payRouter := orderRouter.Group("wxpay")
	{
	        payRouter.GET("/:id", order.WxPay)
	}
}
```
errors：
``` log
path segment 'wxpay/:id' conflicts with existing wildcard ':id' in path '/v1/offline/order/wxpay/:id'
```
why????

Fairly new to this community. Not sure if this counts as a feature.
![capture](https://user-images.githubusercontent.com/1090114/31733999-ead9a278-b45a-11e7-9f44-9ea4b4320cd3.PNG)

- List route handlers at startup,
- Also, number of handlers running.

Would be nice to have this to get better understanding of handlers running.

Sorry for multiple commit builds, new to travis-ci.
Feature:

1. List out the handlers which are running before startup.
Gin support graceful code reload for debug ? 
`dep` is slated to be the official Go dependency management tool. It is ready for production use. This PR switches from `govendor` to `dep`. I also renamed the `examples` folders to `_examples` so that the dependencies are not pulled in by `dep`.

Packages used by examples removed from vendor:
- github.com/dustin/go-broadcast
- github.com/gin-gonic/autotls
- github.com/manucorporat/stats
- github.com/thinkerou/favicon
- golang.org/x/crypto/acme/autocert
- golang.org/x/sync/errgroup

Almost all other dependency revisions were changed to more recent commits:

| pkg | Old | New |
|-----|-----|-----|
| github.com/golang/protobuf | [5a0f697c](https://github.com/golang/protobuf/commit/5a0f697c9ed9d68fef0116532c6e05cfeae00e55) | [130e6b02](https://github.com/golang/protobuf/commit/130e6b02ab059e7b717a096f397c5b60111cae74) |
| github.com/json-iterator/go | [36b14963](https://github.com/json-iterator/go/commit/36b14963da70d11297d313183d7e6388c8510e1e) | [6240e1e7](https://github.com/json-iterator/go/commit/6240e1e7983a85228f7fd9c3e1b6932d46ec58e2) (`v1.0.3`) |
| github.com/mattn/go-isatty | [57fdcb98](https://github.com/mattn/go-isatty/commit/57fdcb988a5c543893cc61bce354a6e24ab70022) | [0360b2af](https://github.com/mattn/go-isatty/commit/0360b2af4f38e8d38c7fce2a9f4e702702d73a39) (`v0.0.3`) |
| github.com/stretchr/testify | [976c720a](https://github.com/stretchr/testify/commit/976c720a22c8eb4eb6a0b4348ad85ad12491a506) | [69483b4b](https://github.com/stretchr/testify/commit/69483b4bd14f5845b5a1e55bca19e954e827f1d0) (`v1.1.4`) |
| github.com/ugorji/go | [c88ee250](https://github.com/ugorji/go/commit/c88ee250d0221a57af388746f5cf03768c21d6e2) | [f76f59a9](https://github.com/ugorji/go/commit/f76f59a92f8224c695c0e2c401b9ad17e820a8f5) |
| golang.org/x/net/context | [d4c55e66](https://github.com/golang/net/commit/d4c55e66d8c3a2f3382d264b08e3e3454a66355a) (`release-branch.go1.7`) | [a04bdaca](https://github.com/golang/net/commit/a04bdaca5b32abe1c069418fb7088ae607de5bd0) |
| gopkg.in/go-playground/validator.v8 | [5f57d222](https://github.com/go-playground/validator/commit/5f57d2222ad794d0dffb07e664ea05e2ee07d60c) (`v8.18.1`) | [5f1438d3](https://github.com/go-playground/validator/commit/5f1438d3fca68893a817e4a66806cea46a9e4ebf) (`v8.18.2`) |
| gopkg.in/yaml.v2 | [a5b47d31](https://github.com/go-yaml/yaml/commit/a5b47d31c556af34a302ce5d659e6fea44d90de0) | [eb3733d1](https://github.com/go-yaml/yaml/commit/eb3733d160e74a9c7e442f435eb3bea458e1d19f) |

**Note:** The revision was not changed for the package `github.com/gin-contrib/sse`.

I have a use case like this
```
type IDData struct {
	ID      string `json:"id" binding:"required"`
	Type    string `json:"type" binding:"required"` // this value should be buzz or fizz only
}

type request struct {
	IDS []IDData        `json:"ids" binding:"required,dive"`
	Timespan int64      `json:"timespan" binding:"required"`
}
```

I need to validate the `type` value of IDData struct to be only `buzz` or `fizz` else throw error.
Is there any validator for this case.
Is it even possible? With bare http:

```
server := http.Server{
    Addr:      cfg.ListenHttps,
    Handler:   http.HandlerFunc(handler),
    TLSConfig: tlsConf,
}
server.ListenAndServeTLS("", "")
```
Hello I am working on a rest api using golang with gin as a router. Also I am using jwt authentication process for the api.  I saved the token to the encrypted session which indicates whether or not they are logged in. I would like to use a middleware to verify whether or not this token exists, and then kick the user back to the login page if it does not. I want to exclude some routes from using the authentication middleware. I have some of my routes in which I don't want the authentication middleware. Can anybody know how I can achieve this?
Right now I have tried the following code under middleware:

if c.Request.URL.Path != "/api/v1/login" && c.Request.URL.Path != "/api/v1/signup" &&  c.Request.URL.Path != "/api/v1/signup"{
    // authentication process
}	 
I have number of routes and all are using the same group "/api/v1/".
What is the best way to ignore the  authentication middleware from some of the routes.
There is no way to remove the route?
gin.Context is not a interface, how to extend it?
### version
go: `latest(go1.9 darwin/amd64)`
gin: `latest(v1.2)`

### code

For each request, I would like to wait for five seconds and then respond `{ "message": "pong" }`

```golang
package main

import (
	"time"

	"github.com/gin-gonic/gin"
)

func main() {
	r := gin.Default()

	r.GET("/ping", func(c *gin.Context) {
		time.Sleep(time.Second * 5)
		c.JSON(200, gin.H{
			"message": "pong",
		})
	})

	r.Run() // listen and serve on 0.0.0.0:8080
}
```

### what happen

In issue #968 (one request, one goroutine), It seems that each request will run in different goroutine. When I open two tabs `localhost:8080/ping` in chrome simultaneously. I expect two tabs both wait for 5 seconds and get `{ "message": "pong" }`. But the second tab wait for 10 seconds, which means the second request is not started processing until first request is finished. They aren't processed concurrently.
See the picture below, I open two tabs simultaneously. First request is finished at `11:13:21` but second request finished at `11:13:26`. They should both be finished at `11:13:21` if they run in different goroutine.
![](https://i.imgur.com/7sdqyNP.png)

### if using two different browsers

But when I use two different browsers(chrome and firefox). It works perfectly. Two requests is processed in the same time period, and they are both finished at `11:20:00`.
![](https://i.imgur.com/jzo9zjo.png)

It's very strange, Is there any clue?





ref: #1115
When testing a gin handler using a `httptest.NewRecorder`, when using (inside the handler) `c.Status(404)` to set the status code, and then bailing out of the request, then the status from the recorder is wrongly returned as `200`.

On the other hand if we use `c.JSON(404, gin.H{})` then the status code inside the recorder is correct.

The expected behavior is of course to always receive in the recorder the status that was set inside the handler.

Example code reproducing the bug bellow, both tests are expected to PASS but only the one using JSON does.

Having a `main.go` with the following code:
```go
package main

import (
	"net/http"
	"os"

	"github.com/gin-gonic/gin"
)

func main() {
	port := ":" + os.Getenv("PORT")

	r := gin.Default()
	r.GET("/fail1", failStatus)
	r.GET("/fail2", failJson)
	r.Run(port)
}

func failStatus(c *gin.Context) {
	c.Status(http.StatusNotFound)
}

func failJson(c *gin.Context) {
	c.JSON(http.StatusNotFound, gin.H{"error": true})
}
```

And a `main_test.go`:
```go
package main

import (
	"net/http"
	"net/http/httptest"
	"testing"

	"github.com/gin-gonic/gin"
)

func TestFailStatus(t *testing.T) {
	gin.SetMode(gin.TestMode)

	rec := httptest.NewRecorder()
	c, _ := gin.CreateTestContext(rec)
	c.Request, _ = http.NewRequest("GET", "/fail1", nil)

	failStatus(c)

	res := rec.Result()
	if res.StatusCode != http.StatusNotFound { // Should be 404
		t.Fatalf("Expecting status to be 404 got %v", res.StatusCode)
	}
}

func TestFailJson(t *testing.T) {
	gin.SetMode(gin.TestMode)

	rec := httptest.NewRecorder()
	c, _ := gin.CreateTestContext(rec)
	c.Request, _ = http.NewRequest("GET", "/fail1", nil)

	failJson(c)

	res := rec.Result()
	if res.StatusCode != http.StatusNotFound { // Should be 404
		t.Fatalf("Expecting status to be 404 got %v", res.StatusCode)
	}
}
```
fix https://github.com/gin-gonic/gin/issues/346
Attempt to optimize package dependency #1847 

First step: remove msgpack and protobuf from binding and render;
Second strep: test...
benchmark program:

```go
func BenchmarkGetPostFormArrayNew(b *testing.B) {
	c, _ := CreateTestContext(httptest.NewRecorder())
	c.Request = createMultipartRequest()

	var obj struct {
		Foo          string    `form:"foo"`
		Bar          string    `form:"bar"`
		BarAsInt     int       `form:"bar"`
		Array        []string  `form:"array"`
		ID           string    `form:"id"`
		TimeLocal    time.Time `form:"time_local" time_format:"02/01/2006 15:04"`
		TimeUTC      time.Time `form:"time_utc" time_format:"02/01/2006 15:04" time_utc:"1"`
		TimeLocation time.Time `form:"time_location" time_format:"02/01/2006 15:04" time_location:"Asia/Tokyo"`
		BlankTime    time.Time `form:"blank_time" time_format:"02/01/2006 15:04"`
	}
	c.Bind(&obj)

	for i := 0; i < b.N; i++ {
		c.GetPostFormArray("array")
	}
}
```

result:

```
$ go test -benchmem -run=^$ github.com/gin-gonic/gin -bench ^BenchmarkGetPostFormArray
goos: darwin
goarch: amd64
pkg: github.com/gin-gonic/gin
BenchmarkGetPostFormArrayOld-4          50000000                32.4 ns/op             0 B/op          0 allocs/op
BenchmarkGetPostFormArrayNew-4          50000000                22.3 ns/op             0 B/op          0 allocs/op
PASS
ok      github.com/gin-gonic/gin        2.847s
```
 * worked with more complex situations
 * the original pr not work when add a short route with the same prefix
 to some already added routes

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


See the benchmark results:

```
$ go test -benchmem -run=^$ github.com/gin-gonic/gin -bench ^BenchmarkGetQueryMap
goos: darwin
goarch: amd64
pkg: github.com/gin-gonic/gin
BenchmarkGetQueryMapOld-4        1000000              1810 ns/op             880 B/op         11 allocs/op
BenchmarkGetQueryMapNew-4        3000000               404 ns/op             336 B/op          2 allocs/op
PASS
ok      github.com/gin-gonic/gin        4.442s
```
- go version go1.12 linux/amd64
- gin commit 6e320c97e83a61df3daa0f28695a736bece3104b
- Ubuntu inside Windows Subsystem for Linux

## Description
We were pretty excited to perform code cleanup after #1826 was merged into master. We removed the git checkout and the #1390 patch present in our CI pipeline and worked based upon the latest master. 

We noticed that one endpoint stopped working as expected and discovered that it was being misreported as a different route. As a test, we removed the erroneous route, but the endpoint in question still reported a wrong route path. 

For now, we have restored the #1390 patch on top of commit e5261480fde106ac5385f00fb00f9bc6b4035485 and this resolved the issue. 
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: go version go1.11.4 darwin/amd64
- gin version (or commit ref): 1.4.0
- operating system: osx

## Description
```go
type Data sturct {
 	Name        string   `json:"name,omitempty" bson:"name,omitempty" binding:"required"`
        Number      string             `json:"number,omitempty" bson:"number,omitempty" binding:"required"`
}


//route
var json models.Data
err := c.ShouldBindJSON(&json)
// it's ok for check condition required
```
How to use same struct without check condition binding? 
I use BindJson() have error required when empty field requried.


````go
func main() {
	router := gin.Default()

	// This handler will match /user/john but will not match /user/ or /user
	//router.GET("/user/:name", func(c *gin.Context) {
	//	name := c.Param("name")
	//	c.String(http.StatusOK, "Hello %s", name)
	//})

	// However, this one will match /user/john/ and also /user/john/send
	// If no other routers match /user/john, it will redirect to /user/john/
	router.GET("/user/:name/*action", func(c *gin.Context) {
		name := c.Param("name")
		action := c.Param("action")
		message := name + " is " + action
		c.String(http.StatusOK, message)
	})

	router.Run(":8080")
}
```` 
when i annotate `router.GET("/user/:name"`, is it mean that no other routers match /user/john? However, when i accessed the/user/john, it did not redirect to /user/john/.
Hello, I believe most web programers have met a function wanted, middleware logic Or.
## What it used like?
```go
    ...
    r:= gin.Default()
    r.Use(Or(Auth1, Auth2, Auth3, Auth4 ...))
    r.GET(/", handler)
    ...
```
As it expresses,  one of Auth1-4 has passed, then all passed.

## How I profile?
gin/context.go
```go
type Context struct{
...
+ stashIndex int8
...
}
+ func (c *Context) Stash() {
+     c.stashIndex = c.index
+ }
+ func (c *Context) StashApply(
     c.index = c.stashIndex
){}

+ func Or(mids ...func(c *gin.Context)) func(*gin.Context) {
+ 	return func(c *gin.Context) {
+		for _, v := range mids {
+                      c.Stash()
+			v(c)
+			if !c.IsAborted() {
+				 return
+			} else {
+                             c.StashApply()
+                              continue
+                      }
+		}
+             c.Abort()
+	}
+}
```
Ok, here is the imaging case without testing, if you agree, I'll make it good and pr. 



Drop go1.8/go1.9 support to stay somewhat close to go's supported versions and keep people from having to do workarounds to stay compatible with older versions of go. 
Once `go1.13` is released all supported versions of go will have built in `go mod` support. Trying to maintain 2 different package managers in gin long term seems unwise.  Once we remove support for `go1.10` we should also remove support for `govender`

   
- With issues:
build command-line-arguments: cannot load github.com/ugorji/go/codec: ambiguous import: found github.com/ugorji/go/codec in multiple modules:
	github.com/ugorji/go v1.1.4 (/home/lucas/local/work/pkg/mod/github.com/ugorji/go@v1.1.4/codec)
	github.com/ugorji/go/codec v0.0.0-20181209151446-772ced7fd4c2 (/home/lucas/local/work/pkg/mod/github.com/ugorji/go/codec@v0.0.0-20181209151446-772ced7fd4c2)

- go version:
go version go1.12.5 linux/amd64
- gin version (or commit ref):
- operating system:

## Description

## Screenshots
![image](https://user-images.githubusercontent.com/37990195/58156456-b1bfd580-7ca8-11e9-96bd-a3f700e5b578.png)


* strings.ToLower comparison changed to strings.EqualFold.
* Rewrite switch statement with only one case as if.


Guys, you wrote in description to release [v1.4.0](https://github.com/gin-gonic/gin/releases/tag/v1.4.0) that included PR [NEW context: inherits context cancellation and deadline from http.Request context for Go>=1.7 #1690](https://github.com/gin-gonic/gin/pull/1690), but you reverted this code. Why?
- go version: go1.12.4 linux/amd64
- gin version (or commit ref): v1.4.0
- operating system: Linux Ubuntu 4.15.0-50-generic

## Description
Gin validates form data after calling mapForm. So if form (golang struct) has field with type int and user sends data in string format (for example it sends number in quotes), Bind method (I mean json binding) returns *strconv.NumError which can not be associated with specific field. How to resolve this situations?
`{
"age": 1
}`

`{
"age": "1"
}`

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:
go version go1.12.5 windows/amd64
- gin version (or commit ref):
 v1.4.0
- operating system:
windows 10 amd 64

## Description
How to custom http error handling
## Screenshots
eg
https://echo.labstack.com/guide/error-handling

- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: go1.10.1 linux/amd64
- gin version (or commit ref): 202f8fc58af47ab5c8e834662ee7fc46deacc37d
- operating system: CentOS 7

## Description
When use AbortWithStatusJSON in an HandlerFunc the program works well, but if use Abort() + JSON() instead, the program is stuck.
`
ctx.Abort()
		
ctx.JSON(101, err)   // stuck
		
ctx.AbortWithStatusJSON(200, err)  // works
`

## Screenshots


- go version: 1.12.5
- operating system:
Distributor ID:	Ubuntu
Description:	Ubuntu 18.10
Release:	18.10
Codename:	cosmic


## Description

why these two those lines give error 

    admin.PUT("/customer/:fixed", adminController.UpdateCustomer)
    admin.PUT("/customer/package/:fixed", adminController.UpdateCustomerPackage)

here panic message

`panic: 'package' in new path '/admin/customer/package/:fixed' conflicts with existing wildcard ':fixed' in existing prefix '/admin/customer/:fixed'`

anyone can explain, and I dont get it for solution from here [github](https://github.com/gin-gonic/gin/issues/205)



I've tried using both the ```static``` and ```CORS``` middleware, they both seem to have the same problem, which suggests to me something is wrong with my configuration.

When I import the following.

```go
import (
	"github.com/gin-contrib/cors"
	"github.com/gin-gonic/gin"
)
```

Then I try use the example:

```go
	router := gin.New()

	router.Use(cors.New(cors.Config{
		AllowOrigins:     []string{"https://foo.com"},
		AllowMethods:     []string{"PUT", "PATCH"},
		AllowHeaders:     []string{"Origin"},
		ExposeHeaders:    []string{"Content-Length"},
		AllowCredentials: true,
		AllowOriginFunc: func(origin string) bool {
			return origin == "https://github.com"
		},
		MaxAge: 12 * time.Hour,
	}))
```

I get the following error:

```
cannot use cors.New(cors.Config literal) (type "github.com/gin-gonic/gin".HandlerFunc) as type "mend/vendor/github.com/gin-gonic/gin".HandlerFunc in argument to router.Use
```
I want  make gin more easy and comfortable to use http.Server configuration
Before
```go
r := gin.Default()
  r.GET("/ping", func(c *gin.Context) {
    c.JSON(200, gin.H{
      "message": "pong",})
})
server := &http.Server{Addr: ":8080",Handler:r}
server .ReadTimeout = time.Duration(time.Second*5)
server.ListenAndServe()
```
After comfortable and friendly
```go
r := gin.Default()
  r.GET("/ping", func(c *gin.Context) {
    c.JSON(200, gin.H{
      "message": "pong",})
})
server := &http.Server{ReadTimeout:time.Duration(time.Second*5),}
r.RunServer(server,":8080")
```


- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: go1.12.2 linux/amd64
- gin version (or commit ref): 1.40
- operating system: ubuntun 18.04

## Description
i run the example `single' about upload file, when i change the size 
```go
	router.MaxMultipartMemory = 1 << 20 // 8 MiB

```
upload a file about 5M , and the server is wok well, not report error.
log output this
```txt
multipart/form-data; boundary=----WebKitFormBoundaryQkcX28gBHaBuvNvL
[GIN] 2019/05/15 - 14:21:14 | 200 |   36.831221ms |             ::1 | POST     /upload

```

## Screenshots


I so love gin route, tree struct route is so perfect
if I want use http.Server config ReadTimeout , Only just do 

```go
r := gin.Default()
  r.GET("/ping", func(c *gin.Context) {
    c.JSON(200, gin.H{
      "message": "pong",})
})
service := &http.Server{Addr: ":9991",Handler:r}
service.ReadTimeout = time.Duration(time.Second*5)
service.ListenAndServe()
```

But I wantn't use like that,I want gin have a config Param. if  gin have a idea like that ,I want pull my request.




- go version: 1.12.1 darwin/amd64
- gin version (or commit ref): 1.40
- operating system: macOS Mojave 10.14.4

I call BindJSON function but it never throwing an error (bypassing validation) when the request body is either blank or have a key "username".
```go
if err := c.BindJSON(&req); err != nil {
    c.JSON(http.StatusBadRequest, gin.H{"error": "Bad request"})
    return
}
```
My struct:
```go
type RemoveUserRequest struct {
    Username string `json:"username" binding:"required"`
}
```


Could be helpful to have func's like `DefaultQueryInt` for example.

then we could write something like

```
limit, err := c.DefaultQueryInt("limit", 50)
if err != nil {
  // query is not an integer, we can response a statuscode 400 
}
```

Or what's the best way to use `c.DefaultQuery` for types like int, float, bool or time.
is there a best practise to implement?
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: 1.12.5
- gin version (or commit ref): 
  ```
  github.com/gin-gonic/gin v1.4.0 h1:3tMoCCfM7ppqsR0ptz/wi1impNpT7/9wQtMZ8lr1mCQ=
  github.com/gin-gonic/gin v1.4.0/go.mod h1:OW2EZn3DO8Ln9oIKOvM++LBO+5UPHJJDH72/q/3rZdM=
  ```
- operating system: ubuntu 18.04

## Description

When I update gin to v1.4.0 build error:
``` log
build myproject: cannot load github.com/ugorji/go/codec: ambiguous import: found github.com/ugorji/go/codec in multiple modules:
        github.com/ugorji/go v1.1.4 (/home/harrison/Dropbox/project/go_path/pkg/mod/github.com/ugorji/go@v1.1.4/codec)
        github.com/ugorji/go/codec v0.0.0-20190320090025-2dc34c0b8780 (/home/harrison/Dropbox/project/go_path/pkg/mod/github.com/ugorji/go/codec@v0.0.0-20190320090025-2dc34c0b8780)
Makefile:15: recipe for target 'server' failed
```
I google this error got this ugorji/go#279

## Screenshots


- go version: 1.11
- gin version (or commit ref): 1.4
- operating system: linux

## Description

`Code`

```go
type request struct{
	File   *multipart.FileHeader `form:"file" binding:"required"`
}
......
var req = request{}
var mf, _ = c.FormFile("file")
fmt.Println(mf.Size)
if err := c.ShouldBind(&req); err != nil {
	fmt.Println(err)
	c.JSON(http.StatusBadRequest, errHandler(err))
}
```

`Request`

```http
POST /api/import?sync HTTP/1.1
Host: localhost:8000
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW
Accept: */*
Cache-Control: no-cache
Host: localhost:8000
accept-encoding: gzip, deflate
content-length: 4059
Connection: keep-alive
cache-control: no-cache

Content-Disposition: form-data; name="file"; filename="/home/xxxx/Downloads/xxxxx.xlsx


------WebKitFormBoundary7MA4YWxkTrZu0gW--
```

Console

```shell
4059
Key: 'request.File' Error:Field validation for 'File' failed on the 'required' tag
2019-xx-xxTxx:xx:xx+xx:00 [WARN] [clientIP:::1] [dataLength:61] [latency:3.014 ms] [method:POST] [path:/api/import] [reqLength:4059] [statusCode:400] [xxxxx] 
```
{{range $k,$v := .varList}}
     <tr>
          <td class='center' style="width: 30px;">{{$k}}</td>
    </tr>
{{end}}
- go version:1.10
- gin version (or commit ref):1.4.0
- operating system:centos 6.10

## Description
During the running of the program, Engine.trees was tampered with, causing some api 404
## Screenshots
![image](https://user-images.githubusercontent.com/10007955/57533649-d941a480-7370-11e9-924f-1cfe10a57faf.png)
![image](https://user-images.githubusercontent.com/10007955/57533669-e5c5fd00-7370-11e9-9dd7-844c4b4b94f0.png)
![image](https://user-images.githubusercontent.com/10007955/57540086-748d4680-737e-11e9-8cfc-72a99545d50d.png)


``` golang
package main

import (
	"github.com/gin-gonic/gin"
)

type appkey struct {
	Appkey string `json:"appkey" form:"appkey"`
}

type Query struct {
	Page int `json:"page" form:"page"`
	Size int `json:"size" form:"size"`
	appkey
}

func main() {

	router := gin.Default()
	router.POST("/login", func(c *gin.Context) {

		var q2 Query

		if c.ShouldBindQuery(&q2) == nil {
			c.JSON(200, &q2)
		}
	})
	router.Run(":8088")
}
```
http client:

old:
``` bash
curl -X POST "127.0.0.1:8088/login?appkey=china&page=1&size=10"
{"page":1,"size":10,"appkey":""}
```
now:
``` bash
curl -X POST "127.0.0.1:8088/login?appkey=china&page=1&size=10"
{"page":1,"size":10,"appkey":"china"}
```




- go version: go1.12.5 linux/amd64
- gin version (or commit ref): v1.4.0
- operating system: Linux Mint 19 Cinnamon 4.15.0-48-generic

## Description
If i try to bind multipart data to struct (one text field and file field) without file, error on the field with file has type *errors.errorString. So this error type has not information to associate error text with form field. But if text field is empty (not file field), error type is gopkg.in/go-playground/validator.v8/ValidationErrors

```go
type ImageUploadForm struct {
	Email string                `form:"email" binding:"required"`
	Img   *multipart.FileHeader `form:"img" binding:"required"`
}
///
var imgForm ImageUploadForm
if err := c.MustBindWith(&imgForm, binding.FormMultipart); err != nil {
	c.Error(err)
	return
}
```
## Screenshots
![Снимок экрана от 2019-05-10 10-40-40](https://user-images.githubusercontent.com/10630525/57510806-538e0c80-7310-11e9-9541-6efe39320697.png)

![Снимок экрана от 2019-05-10 10-44-51](https://user-images.githubusercontent.com/10630525/57510947-ae276880-7310-11e9-8bdd-1caa187e98bc.png)

Aligns behaviour according to documentation.

Closes #1890.
https://github.com/gin-gonic/gin/blob/094f9a9105f8e7b971a01a64677eef5a1f7bcd9b/mode.go#L31-L32 contradicts https://github.com/gin-gonic/gin/blob/094f9a9105f8e7b971a01a64677eef5a1f7bcd9b/debug.go#L52-L59

The same for https://github.com/gin-gonic/gin/blob/094f9a9105f8e7b971a01a64677eef5a1f7bcd9b/debug.go#L99-L103 contradicts https://github.com/gin-gonic/gin/blob/094f9a9105f8e7b971a01a64677eef5a1f7bcd9b/mode.go#L40-L41
hello 

How do I know that the browser is disconnecting this connection?
I found that the routing path does not support the following url param form, router.GET("/:name/*action", func(c *gin.Context) {
Name := c.Param("name")
Action := c.Param("action")
Message := name + " is " + action
c.String(http.StatusOK, message)
})
But when I use gorilla/mux or go-chi/chi framework, they both support, can support such a path in gin, because many developers do have such a requirement, your gin package has not supported this Function, can it be supported in versions after 1.4.0?
golang1.12.5 version:
Gin is using the golang1.12.5 version, and the go mod mechanism is enabled. When the project code is compiled, the compilation does not pass, and the gin/json package cannot be found.




//main
package main

import (
	"fmt"
)

func main()  {

	r := router.NewRouter()
	r.Run(addr)
}
//router
package router

import (
	"github.com/gin-gonic/gin"
	"xflow-be/controller"
)
func NewRouter() *gin.Engine {
	app := gin.New()
	skelCtl := controller.NewSkelController()
	skelGroup := app.Group("/skel")
	{
		skelGroup.POST("/get", skelCtl.Get)
		skelGroup.POST("/del", skelCtl.Del)
		skelGroup.POST("/list", skelCtl.List)
		skelGroup.POST("/add", skelCtl.Add)
		skelGroup.POST("/update", skelCtl.Update)
		skelGroup.POST("/get_by_field", skelCtl.GetByField)
	}
	return app
}
//controller
package controller

type SkelController struct {
	BaseController
}

func NewSkelController() *SkelController {
	return &SkelController{}
}
func (ts *SkelController) List(ctx *gin.Context) {
	if ents, err := ts.newService().List(); err != nil {
		ts.ReplyFail(ctx, err)
	} else {
		ts.ReplyOk(ctx, ents)
	}
}


- go version: 1.12
## Description

Using FetRawData from an copied context delete the original context body

```
func RequestLogger() gin.HandlerFunc {

	return func(c *gin.Context) {

		c.Set("HostIP", c.ClientIP())
		cCp := c.Copy()

		go func() {
			logger := cCp.MustGet("logger").(utils.LogDataInterface)
			internalCode := msgmanager.CreateInternalCode(severities.INFO, services.PDF, sources.SAMESERVICE, operations.NA, entities.NA)

			if cCp.Request.Method == "POST" {
				data, _ := cCp.GetRawData()
				logger.LogData(0, cCp, "Request using POST Method", gelf.LOG_INFO, data, internalCode, nil)
			} else {
				logger.LogData(0, cCp, "Request using GET Method, look at URL for data", gelf.LOG_INFO, nil, internalCode, nil)
			}
		}()

		c.Next()
	}
}
```

**data, _ := cCp.GetRawData()** This line sometimes delete "c" body.

This happen just like in 10% of calls.

Changing **GetRawData** for **ShouldBindBodyWith** fix the problem.

```
func RequestLogger() gin.HandlerFunc {

	return func(c *gin.Context) {

		c.Set("HostIP", c.ClientIP())
		cCp := c.Copy()

		go func() {
			logger := cCp.MustGet("logger").(utils.LogDataInterface)
			internalCode := msgmanager.CreateInternalCode(severities.INFO, services.PDF, sources.SAMESERVICE, operations.NA, entities.NA)

			if cCp.Request.Method == "POST" {
				var data interface{}
				_ = cCp.ShouldBindBodyWith(&data, binding.JSON)
				logger.LogData(0, cCp, "Request using POST Method", gelf.LOG_INFO, data, internalCode, nil)
			} else {
				logger.LogData(0, cCp, "Request using GET Method, look at URL for data", gelf.LOG_INFO, nil, internalCode, nil)
			}
		}()

		c.Next()
	}
}
```

## Screenshots

![image](https://user-images.githubusercontent.com/21007927/57225149-731cf080-7003-11e9-838c-a15830a9cbba.png)


Now that @appleboy  and @thinkerou  are able to do releases. I would like to propose some changes in the process.
**Issue**:
1. Things land on master for months before an official release. This causes a few issues,

* People might wrongfully think new features or methods on master before a release are covered under the Semantic Versioning guarantees.
 
* Releasing a `PATCH` will end up releasing code that was on master, waiting for the next `MINOR` release. This has a side effect of making us slow to release `PATCH`'s because we know it's going to effect everything currently on master.

**Proposal**:

I would like to propose we cut a branch from master for the next `MINOR` release after we do a release then we merge all the new issues for that Milestone into that.

e.x:   When we release  `1.4.0` we create a `1.5.0` branch and take all new feature pull requests into the `1.5.0` branch. This way if we need to preform a `PATCH` release we can quickly merge a `PATCH` into master and then release `1.4.1`, without having to bring in all the current work we are doing for `1.5.0`.  Once `1.5.0`  closes all the milestones or meets it's deadline and becomes stable, It's merged into master and tagged `1.5.0` and we cut a `1.6.0` branch and start over.

Feedback welcome!
Engine is private .
But sometimes we need to call HandleContext inside a function .
like this:
```go
func HelloWord(c *gin.Context){
	c.Request.URL.Path = "/test2"
	c.Forward()
}
```

add support http forward


#1263's merged solution take no effect for multi files uploading.

my code:
```go
// MailUpload struct for e-mail
type MailUpload struct {
	Mail string 			     `json:"mail" form:"mail" binding:"required"`
	Attachments  []*multipart.FileHeader `json:"attachment,omitempty" form:"attachments" binding:"required"` // change form to "attachments[]" take no effect also.
}

func Mail(c *gin.Context) {
	var postData MailUpload
	err := c.Bind(&postData)
	if err != nil {
		fmt.Println(err)
		c.String(http.StatusBadRequest, err.Error())
	} else {
		fmt.Printf("%#v\n", postData)
		c.String(http.StatusOK, "ok")
	}
}
```

request send command by curl:
```bash
curl -v -H "Content-Type:multipart/form-data" -X POST http://localhost:8080/api/latest/newmail -F "attachments[]=@./2019-5-1_day_trends.png" -F mail=123
```

my error: `Key: 'MailUpload.Attachments' Error:Field validation for 'Attachments' failed on the 'required' tag`
- go version: not relevant
- gin version (or commit ref): 1.3.0
- operating system: not relevant

## Description
Gin uses the package function `log.Printf` to log debug information, notably during startup, as follows:

```
func debugPrint(format string, values ...interface{}) {
	if IsDebugging() {
		log.Printf("[GIN-debug] "+format, values...)
	}
}
```
This function `log.Printf` uses the standard logger which writes to stderr. I want to direct Gin's debug log to another logger (native or logrus), but using a static logger prevents me from doing so. It would be easy to allow a custom logger to be passed to Gin.

PS: I know you can plug a middleware logger, but that won't solve my problem, since I want the debug log...


## Screenshots


https://github.com/gin-gonic/gin/issues/1123#issuecomment-487372935
This PR try to provide a type of solution.
I look forward to more suggestion and feedback.
What is this ? session ? I mean where does it stored?  In the memory ? and when does it expired?

`
func ReverseProxy(host string) gin.HandlerFunc {
	return func(c *gin.Context) {
		director := func(req *http.Request) {
			req.URL.Scheme = "http"
			req.URL.Host = host
		}
		proxy := &httputil.ReverseProxy{Director: director}
		proxy.ServeHTTP(c.Writer, c.Request)

	}
}`


- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: go 1.12.4
- gin version (or commit ref): 1.3.0
- operating system: Mac/Linux

## Description
My work function alway is signature
```go
function(ctx context.Contex, req SomeStrcut) ( ret OtherStrcut,err error)
```
I wish to add a wrap function to wrap it, when err is nil
I return 
```go
c.JSON(200, 
    gin.H{
      "code":err.Code,
      "msg":err.Error(),
      "data":nil,
     }
```
other return 
```go
c.JSON(200, 
    gin.H{
      "code":0,
      "msg":"",
      "data":ret,
     }
```
and , if gin must implement `func (c *gin.Context) to add router
I try to write as 
```go
func Sum(ctx context.Context, req Req) (ret Resp, err error) {
	return
}
```
```go
func Router() *gin.Engine {
	r := gin.Default()

	r.POST("/sum", func(c *gin.Context) {
		var req controller.Req
		err := c.ShouldBindJSON(&req)
		if err != nil && err != io.EOF {
			WriteJSON(c, nil, err)
			return
		}

		resp, err := controller.Sum(c.Request.Context(), req)
		WriteJSON(c, resp, err)
	})

	return r
}

func WriteJSON(c *gin.Context, resp interface{}, err error) {
	if err != nil {
		c.JSON(200, gin.H{
			"code":    400,
			"message": err.Error(),
			"data":    nil,
		})
	} else {
		c.JSON(200, gin.H{
			"code":    0,
			"message": "",
			"data":    resp,
		})
	}
}
```
but I must add this repeat code when I add a function, have better solution to write it ?


## Screenshots


## Description
I am a gin beginner, and code just like this:
```
url = "http://user:password@127.0.0.1:8000"
router.POST("/test", testHandler)
func testHandler(c *gin.Context) {
    //c.Request.URL
}
```
I want to get **"user","password"** from `c.Request.URL`, but I got only `/test` when I print the  `c.Request.URL`.

Does anyone have an idea?



```
func ReverseProxy(host string) gin.HandlerFunc {
	return func(c *gin.Context) {
		director := func(req *http.Request) {
			req.URL.Scheme = "http"
			req.URL.Host = host
		}
		proxy := &httputil.ReverseProxy{Director: director}
		proxy.ServeHTTP(c.Writer, c.Request)

	}
}
```
how to set gin.Context.Keys from source to target server
main.go
------
```
package main

import (
	"github.com/gin-gonic/gin"

)

func main(){
	router := gin.Default()
	router.GET("/", Verify)
	router.Run(":8080")
}
```
verify.go
----
``` 
package main

import (
	"net/http"
	"github.com/gin-gonic/gin"

)
func Verify(c *gin.Context){
		c.String(http.StatusOK, "verrrrify!")
}
```
-----
```
go run main.go 
# command-line-arguments
./main.go:10:18: undefined: Verify
```
hi guys, for some reason I want to convert a http.Request and http.response to gin.context, could anybody do that?
- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


I want to trim the common prefix of requestUrl in the middleware ,

` if ok :=strings.HasPrefix(requestURI,"/api");ok {
		 c.Request.URL.Path = strings.TrimPrefix(requestURI,"/api")
            c.Request.RequestURI = strings.TrimPrefix(requestURI,"/api")
		}`
but it don't work
## Description

## Screenshots


I want to implement such a function, convert the id parameter in the following route into an int type, what should I do?
```go
package main

import "github.com/gin-gonic/gin"

func main() {
	r := gin.Default()
        r.use(TestMiddleware)
	r.GET("/test/:id", func(c *gin.Context) {
		c.JSON(200, gin.H{
			"message": "pong",
		})
	})
	r.Run() // listen and serve on 0.0.0.0:8080
}

func TestMiddleware(c *gin.Context) {
     //I want to change the type of this id parameter from string to int type here.what should I do?
    c.Next()
}
```

Load new html templates to the exists HTMLRender.
This method won't create a new template instance.
So we can load templates from different path and use golang template `define` tag to give the templates proper name.
Golang's `filepath.Glob` doesn't support glob dir recursively.
This method may be helpful.

May be related with #1296.
- go version: go1.12.3 linux/amd64
- gin version (or commit ref):  1.4
- operating system: Debian GNU/Linux 8 (jessie)

## Description
When I visit a particular path, I get "**2019/04/23 14:29:45 write tcp 127.0.0.1:7070->127.0.0.1:34514: write: connection reset by peer**" in the production environment. But everything works fine in testing (without nginx). Please How do I debug this problem. Thank you.
- With issues:
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version: 1.8+
- gin version (or commit ref): all
- operating system: linux

## Description
I think bilibili-common copy or reference from gin.

## Screenshots
https://github.com/xiaozaiziwyt/backup-openbilibili-go-common/blob/af2bea9c31465a9a2a5ef362b4f08667d2334109/library/net/http/blademaster/context.go#L30



## Description

## Screenshots





Ok, it very strange bug and i solve it, but i post it here, so maybe if some one have similar problem, can also easy solve it.

Ok i have two GET url controller functions:

```
	r.GET("/arc/predp", GetPredprArcList)
	r.GET("/arc/predpid", GetPredpIDArcList)

```

When i develop and test it locally it works just fine, but when i put it on production server with https i have strange problem:

`/arc/predp` works just fine, but `/arc/predpid` not processed at all, i just put 
`fmt.Println("\nArc ID List")` in `GetPredpIDArcList` and it never writes in output.

But, when i try to use Yandex.Browser and enable it `Turbo mode`, it similar Opera `Turbo mode` all works just fine, but in Firefox it works us described above.

So i try change URL's to like this:

```
	r.GET("/arc_predp", GetPredprArcList)
	r.GET("/arc_predpid", GetPredpIDArcList)

```

and all works just fine.

It all very strange and i hope this helps some one or maybe there is really some bug in Gin and it helps fix it.
I currently have an issue with Heroku and SSL. Heroku does SSL termination and for the application purposes will see HTTP traffic. However, what I wish to do, is redirect the http calls to https ones. What I can see is there's a special header ```X-Forwarded-Proto``` which can be either https, http. So far my attempts have managed me redirecting my API routes to https ones, but my static files are not redirected. 


`import "github.com/gin-gonic/gin"

func Receive(c *gin.Context) {
  // Gets JSON ecnoded data
  rawData, err := c.GetRawData()
  if err != nil {
      return nil, err
  }

  logger.Info("Raw data received - ", rawData)
}`

This code snippet works when I pass a Json object **{"key":"value"}** but gives an error - **"unexpected end of JSON input"** when I pass an array like - **[{"key":"val"},{"key": "val"}]** as the input.

Any help on this would be appreciated.
If the graceful closing of the port being listened to, does not make the code I am executing uninterrupted?

There is a shutdown method in the net/http server, gin does not know how to call
Following the similar pattern as sql drivers.
I extract xml, json, msgpack, protobuf and yaml into separate module.
This PR may break compat with previous versions.

For example: https://github.com/sapk-fork/gin-examples/blob/test-modular/basic/main.go

I think we can maybe re-add json and xml as default.

Related #1847 (issue) & #1852 (previous non-breaking solution)
- With issues:There is no way to protect from csrf attack in gin-goind
  - Use the search tool before opening a new issue.
  - Please provide source code and commit sha if you found a bug.
  - Review existing issues and provide feedback or react to them.

- go version:1.12
- gin version (or commit ref):
- operating system:windows 10

## Description
the only package to use for csrf middleware for gin-gonic is 
https://github.com/utrack/gin-csrf/
it was not powerful
and it's not working any more...

what should we do?


So when BindJson happen but error occure because of some data type it will send error. 

```
func (c *Context) BindJSON(obj interface{}) error {
	return c.MustBindWith(obj, binding.JSON)
}
```
and then here the the other method "MustBindWith"
```
func (c *Context) BindUri(obj interface{}) error {
	if err := c.ShouldBindUri(obj); err != nil {
		c.AbortWithError(http.StatusBadRequest, err).SetType(ErrorTypeBind) // nolint: errcheck
		return err
	}
	return nil
}
```
As we can see all bind error will write an error header and abort the process, but as the request is a json, the error should be a json also. My client is complaining because inconsistent (in my case, as I use GZip, the error return as appliation/x-gzip)

So I am thinking if the bind is bindJSON, the error should be AbortWithStatusJSON instead of AbortWithError.
![image](https://user-images.githubusercontent.com/16441057/55926722-0f421a80-5c45-11e9-9084-a5a699bb2278.png)
l want to return validate field in json, not struct field

This PR add a build tag `nomsgpack` to exclude heavy deps `github.com/ugorji/go/codec` that may be not needed for most project. The goal is to reduce the resulting binary size. This could maybe improve some performances but that not the goal so I haven't bench it.

I go for the no impact by default by using a negate tag so that without change it will not impact project depending on this lib.

~~I will try to provide some results of binary size based on https://github.com/gin-gonic/examples.~~ -> see [comment](https://github.com/gin-gonic/gin/pull/1852#issuecomment-481043187)

Should fix (or at least a mitigation to) #1847 
 
This is a starting point for the `v1.4.0` release issue #1732.
This also merges in #1631 after fixing the conflicts.

When I tried to run main.go it gives an error being "cannot find package "github.com/golang/protobuf/proto""

```
package main

import "github.com/gin-gonic/gin"

func main() {
	r := gin.Default()
	r.GET("/ping", func(c *gin.Context) {
		c.JSON(200, gin.H{
			"message": "pong",
		})
	})
	r.Run() // listen and serve on 0.0.0.0:8080
}
```


This is a starting point for the v1.4.0  release issue #1732.

Looking for feedback or patches for anything that needs to be changed.

- go version: 1.12.1
- gin version (or commit ref): ffcbe77b1e6222b4e0e97eb1920adc1813fb2224 (latest master)
- operating system: mac

## Description
handlers should be reset in HandleContext, or it may cause group handlers been called more than once.

## Reproduce
Consider the following minimal example, when "/1" been accessed, there are two lines of "1" logged as expected, but when "/2" is accessed, there will be three lines of "1" logged, which I think is a bug.

```golang
func main() {
	r := gin.New()
	grp := r.Group("", Handler)
	grp.GET("/1", Handler)

	r.NoRoute(func(c *gin.Context) {
		c.Request.URL.Path = "/1"
		r.HandleContext(c)
	})

	r.Run(":8080")
}

func Handler(c *gin.Context) {
	log.Println("1")
}
```


Using go 1.12, latest version of gin to date, I analysed my executable and I see that 11MB are occupied by the dependency `github.com/ugorji/go/codec`. Does really gin need all of this package?

#1844 #1838 
Keep the documentation in readme until full available on the new website.
I tried to binding `multipart.FileHeader` to struct but not working, help plz!!
I send request used Postman:

![post_information_1](https://user-images.githubusercontent.com/20114873/55578923-9e34cb80-5749-11e9-8970-7c6c8ae2bdd9.jpg)
![post_information_2](https://user-images.githubusercontent.com/20114873/55578930-a12fbc00-5749-11e9-8010-91cae8875269.jpg)


- Go Version: go 1.12 linux/amd64
- Operating System: Ubuntu 16.04

This is code:

Struct:

```go
ExtractAttributeRequest struct {
		Image       *multipart.FileHeader `form:"image" binding:"required"`
		ImageBase64 string                `form:"image_base64"`
}
```

Binding part:

```go
var req ExtractAttributeRequest
err := c.MustBindWith(&req, binding.FormMultipart)
```

And i got this error message: `Key: 'ExtractAttributeRequest.Image' Error:Field validation for 'Image' failed on the 'required' tag`

The new document site is great, but it's still under construction.

Would you please keep the old document in README until the new one is REAL ready for use?

Thank you
I'm aware removing `go1.6`/`go1.7` was scheduled for `v1.5.0` but given the amount of time that has passed we now have `go1.12` so supporting only `go1.9+` is older than `go` supports.





Made a 100% coverage of `form_mapping.go` from the `form_mapping_test.go` file.
And rewrote to the more readable test functions.
Using context.Param(key) on a context.Copy inside a goroutine
may lead to incorrect value on a high load, where another request
overwrite a Param

- With pull requests:
  - Open your pull request against `master`
  - Your pull request should have no more than two commits, if not you should squash them.
  - It should pass all tests in the available continuous integrations systems such as TravisCI.
  - You should add/modify tests to cover your proposed code changes.
  - If your pull request contains a new feature, please document it on the README.


- go version: v1.11
- gin version (or commit ref):latest
- operating system:ubuntu 16.04LTS

## Description
To return 404 error for all un-defined routes, there is `r.NoRoute`. To send 405 error to unsupported method, is there anything available?

- go version: 1.11.5
- gin version (or commit ref): 1.3.0
- operating system: unix

## Description
We are using gin-gonic which internally uses json-iterator(even though not being used in the project). When I vendor all the dependencies I find that json-iterator have a dependency on cells-v1.4.1 which is AGPL 3.0 and shouldn't be used.

Please can we update to not use such dependencies which overrides the default License permissions for json-iterator

## Screenshots
<img width="551" alt="Screen Shot 2019-04-03 at 9 31 45 AM" src="https://user-images.githubusercontent.com/10854334/55482867-64ea4780-55f3-11e9-8d3a-877f315c8e2d.png">


Hi,

Where did all the super handy documentation in the README.md go? The new site is not really usable and misses a lot of the detailed stuff that was here before.

I'm now using the version at this commit to look up stuff. https://github.com/gin-gonic/gin/blob/f38a3fe65f102dd765e097166e6a41f9e99777f6/README.md

Please bring back the README.md as it was, the new site makes Gin not a very attractive to use Go project.


- go version:1.12.1
- gin version (or commit ref):latest
- operating system:10.14.2

## Description
I'v add my application configuration to a .env file , and load it by GoDotEnv , gin can get the env var "PORT" but not "GIN_MODE".
## Screenshots
![image](https://user-images.githubusercontent.com/9475864/55464120-fc1fc100-562c-11e9-9980-1b186aa0eb75.png)

![image](https://user-images.githubusercontent.com/9475864/55464153-0c37a080-562d-11e9-9749-35b1ddfa3c07.png)
```go
package main

import (
	"fmt"
	"github.com/gin-gonic/gin"
	"github.com/joho/godotenv"
	"os"
	"log"
)

func init()  {
	err := godotenv.Load()
	if err != nil {
		log.Fatal("Error loading .env file")
	}

}

func main() {
	fmt.Println(os.Getenv("PORT"))
	fmt.Println(os.Getenv("GIN_MODE"))

	//gin.SetMode(gin.ReleaseMode)
	r := gin.Default()
	r.GET("/ping", func(c *gin.Context) {
		c.JSON(200, gin.H{
			"message": "pong",
		})
	})
	r.Run() // listen and serve on 0.0.0.0:8080
}
```
This PR replaces the contents of that header with a *. This prevents
credential leak in logs.


Example:
`
type T struct {
    Foo int
}
`

response,will tips:
`
{"Foo":42}
`

but i want to get 
`
{"foo":42}
`

In many cases, it is very difficult to define lowercase one by one. Is there a simple way?
Current State:
Getting started with minimalistic examples

What is needed:
Comprehensive guide, a step by step approach. This framework has a lot of potential but new users like me struggle to find answers.
```
//controller.go

func OneApi(c *gin.Context) {
	appG := app.Gin{C: c}
	appG.Response(http.StatusOK, 200, 'helloword')
}
```
```
//app.go

type Gin struct {
	C *gin.Context
}

func (g *Gin) Response(httpCode, code int, data interface{}) {
	g.C.JSON(httpCode, gin.H{
		"code": code,
		"data": data,
	})
	return
}

```

This is the way I realize now.
But I think it's not a best way，because it must write 'app.gin{C:c}' when i want to call Response().

This is not very important as we can hit the website "gin-gonic.com" through https, but you may create a permanent redirect from http to https. The official website responds with 404 in http and this is the link in README file.

Regards
## Description

Replicate:

Go to https://gin-gonic.com/search

search "goroutines"

click any link

## Screenshots

![screen](https://user-images.githubusercontent.com/46532969/55095989-754c7080-508f-11e9-9c38-d958d10648e6.png)

fixes #1823



Refactor mapping to interface `setter` - for supporting a multipart request.

Benchmarks of a simple form mapping (with many fields and one field respectively):
```
⇒  benchcmp old.bch new.bch
benchmark                  old ns/op     new ns/op     delta
BenchmarkMapFormFull-4     2332          2358          +1.11%
BenchmarkMapFormName-4     218           235           +7.80%

benchmark                  old allocs     new allocs     delta
BenchmarkMapFormFull-4     12             12             +0.00%
BenchmarkMapFormName-4     1              1              +0.00%

benchmark                  old bytes     new bytes     delta
BenchmarkMapFormFull-4     200           200           +0.00%
BenchmarkMapFormName-4     8             8             +0.00%
```
## go version:
- go version go1.12.1 windows/amd64
- operating system: windows10
- gin version: gin v1.3.0

## Description
Different packages  and same struct name function  routing error
## Error
```
github.com/abner-xu/gincms/router
duplicate "".(*IndexController).Index-fm.stkobj
<autogenerated>:1: symbol "".(*IndexController).Index-fm.stkobj listed multiple times
```

## Screenshots
![](http://ww1.sinaimg.cn/large/aaba1596gy1g1gcnpbk9uj208j05wa9y.jpg)
routerCode
```
package router
import (
	"github.com/abner-xu/gincms/controller/admin"
	"github.com/abner-xu/gincms/controller/home"
	"github.com/gin-gonic/gin"
)
func RouterInit() *gin.Engine {
	r := gin.Default()
	//home API
	homeIndex := &home.IndexController{}
	r.GET("/home/index/index", homeIndex.Index)
	//admin API
	adminIndex := &admin.IndexController{}
	r.GET("/admin/index/index", adminIndex.Index)
	return r
}
```

controllerCode
```
//==controller/admin package  code
package admin
import (
	"net/http"
	"github.com/gin-gonic/gin"
)
type IndexController struct{}
func (this *IndexController) Index(ctx *gin.Context) {
	ctx.JSON( http.StatusOK, gin.H{
		"message": "111",
	})
}


//controller/home package  code
package home
import (
	"net/http"
	"github.com/gin-gonic/gin"
)
type IndexController struct{}
func (this *IndexController) Index(ctx *gin.Context) {
	ctx.JSON( http.StatusOK, gin.H{
		"message": "2222",
	})
}
```

https://github.com/gin-gonic/gin/pull/1677

Ordinary log can change log format.
but, panic log cannot change.

https://github.com/gin-gonic/gin/blob/master/recovery.go#L41-L78
`recovery.go` always use fmt.
This is a proposed change to return handler full path from the Context.

### Where it can be useful?

When using lambda functions as a handler names returned from `(*Context).HandlerName` become not lean. With this change it becomes easy to analyse which route was called exactly. This can be useful when trying to find out which routes are not being called in the app.

### Alternatives

It is possible to create a wrapper around route definition:

```go
func logGET(router *gin.Engine, path string, handler func (*gin.Context)) {
    router.GET(path, func (c *gin.Context) {
        // Do something with path
        handler(c)
    })
}

...

logGET(router, "/user/:id", func (c *gin.Context) {
    c.Status(200)
})
```

This approach is doable but considering that Gin already holds full path in its structures I though that it might be better to just expose it.

P.S. README no longer contains any docs so I am not certain where I should document this feature.


relevant issue/pull request: #1282 #1823 
request method is websocket, user can set `isWebsocket`; address is IPv6, user can set `IPv6`.
like this:

```
type LogFormatterParams struct {
	Request *http.Request

	// TimeStamp shows the time after the server returns a response.
	TimeStamp time.Time
	// StatusCode is HTTP response code.
	StatusCode int
	// Latency is how much time the server cost to process a certain request.
	Latency time.Duration
	// ClientIP equals Context's ClientIP method.
	ClientIP string
	// Method is the HTTP method given to the request.
	Method string
	// Path is a path the client requests.
	Path string
	// ErrorMessage is set if error has occurred in processing the request.
	ErrorMessage string
	// BodySize is the size of the Response Body
	BodySize int
	// Keys are the keys set on the request's context.
	Keys map[string]interface{}
	// isTerm shows whether does gin's output descriptor refers to a terminal.
	isTerm bool
	isWebsocket bool
        isIPv6 bool
}
```
default value is `false`.

## Description

I'm trying to bind JSON and a URI in one request but havn't found out how to yet. 

Here's my struct:

```go
type ResetPassword struct {
	Code     string `uri:"code" binding:"required"`
	Password string `json:"password" binding:"required,min=6,max=20"`
}
```

I'm using `c.Bind()`:

```go
func verifyPasswordReset(c *gin.Context) {
	var data ResetPassword
	if err := c.Bind(&data); err != nil {
		c.JSON(400, gin.H{"error": err})
		return
	}
	fmt.Printf("%+v\n", data)
	c.JSON(http.StatusOK, data)
}
```

When I make this request it says the code is required:

```
curl -H "content-type:application/json" -d '{"password":"hunter15"}' "localhost:8080/user/password_reset/jksakhdkh"                                                                     Sun Mar 24 14:29:27 2019
{"error":{".Code":{"FieldNamespace":".Code","NameNamespace":"Code","Field":"Code","Name":"Code","Tag":"required","ActualTag":"required","Kind":24,"Type":{},"Param":"","Value":""}}}
```

I found a related issue #811 but it wasn't actually solved before being closed.

- go version: `go version go1.10.4 linux/amd64`
- gin version (or commit ref): `5acf6601170bb49a1958c055d66d54ba152dc34b`
- operating system: `elementary OS 5.0 Juno`

## Description
If a request takes long like web sockets the logging gets a bit messed up  
see the screenshot  
This request takes long because it's a web-socket

## Screenshots
![Screenshot from 2019-03-22 11-55-43](https://user-images.githubusercontent.com/15320763/54820524-c5968d80-4c9f-11e9-8250-3276de92d79d.png)


